<%@ Page Language="C#" %>

<!DOCTYPE html>

<script runat="server">
    protected void Page_Load(object sender, EventArgs e)
    {
       
    }
</script>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link href="/Common/CSS/jquery/jquery.css" type="text/css" rel="stylesheet" />
    <link href="/Common/CSS/jquery/ui.jqgrid.css" type="text/css" rel="stylesheet" />
    <title></title>
    <script src="/Common/jquery/jquery.js"></script>
    <script src="/Common/jquery/jquery-ui.js"></script>
    <script src="/Common/jquery/jquery.custom.js"></script>
    <script src="/Common/jquery/jquery.jqGrid.js"></script>
    <script src="/Common/jquery/i18n/grid.locale-ua.js"></script>
    <script src="script/metaform.js"></script>

    <script type="text/javascript">
        $(function () {
            $("#jtab").jqGrid({
                url: '/barsroot/cim/controls/metahandler.ashx',
                editurl: '/barsroot/cim/controls/metahandler.ashx',
                datatype: 'json',
                postData: { ActionPage: 'TransportType', Action: 'Fill' },
                height: 'auto'  ,
                colNames: ['Ідентифікатор', 'Найменування', 'Країна', 'Aдреса', 'Коментар'],
                colModel: [
           		    { name: 'BENEF_ID', width: 60, sortable: true, key: true },
           		    { name: 'BENEF_NAME', width: 200, sortable: true, editable: true },
           		    { name: 'COUNTRY_NAME', width: 200, sortable: true, editable: true },
                    { name: 'BENEF_ADR', width: 200, sortable: true, editable: true },
                    { name: 'COMMENTS', width: 200, sortable: true, editable: true }
                ],
                rowNum: 10,
                rowList: [10, 20, 30],
                pager: '#jpager',
                gridview: true,
                sortname: 'UserId',
                prmNames: { nd: null },
                jsonReader: { cell: "", search: "isSearch" },
                viewrecords: true,
                sortorder: 'asc',
                caption: "Довідник бенефіціарів"
            });

            $.extend($.jgrid.edit, {
                savekey: [true, 13],
                closeOnEscape: true,
                closeAfterEdit: true,
                closeAfterAdd: true,
                reloadAfterSubmit: false,
                recreateForm: true
            });
            $.extend($.jgrid.del, {
                delData: { ActionPage: 'TransportType', Action: 'Delete' },
                reloadAfterSubmit: false,
                closeOnEscape: true
            });
            $.extend($.jgrid.search, {
                multipleSearch: true,
                recreateFilter: true,
                closeOnEscape: true,

                overlay: false
            });
            $("#jtab").jqGrid('navGrid', '#jpager', {},
                { width: 300, editData: { ActionPage: 'TransportType', Action: 'Update' } },
                {
                    width: 500, editData: { ActionPage: 'TransportType', Action: 'Insert' },
                    afterSubmit: function (response, postdata) {
                        // if we use reloadAfterSubmit: false we need to do some additional
                        // actions
                        //
                        // we use id twice: one in id attribute of the row (<tr>)
                        // and one more time in the UserId. To update UserId
                        // we have to modify explicitly UserId property in the postdata.
                        // The response.responseText should contains the id of new item
                        // generated on the server (typically from the database)
                        postdata.UserId = response.responseText;
                        // now we need return the data with include new id generated by
                        // the server. It will set correct id attribute on the new row (<tr>)
                        return [true, '', response.responseText];
                    }
                },
                {},
                { width: 460 }
            );

        });

        
       
    </script>

</head>
<body>
    <form id="metaform" runat="server">
        <table id="jtab"></table>
        <div id="jpager"></div>
    </form>
</body>
</html>
