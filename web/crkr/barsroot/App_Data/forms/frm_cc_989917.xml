<xmlform caption="Отримання з дороги цінностей по КД" captiontype="OnlyTitle" maxwidth="1000" minwidth="1000">
  <grids>
    <grid id="Id1" pagesize="10" showpagesizebox="true" title="Отримання з дороги цінностей по КД">
        <datasource>
        <sql>
          select a.nls, a.nms, abs(a.ostc/100) as ostc, abs(a.ostb/100) as ostb, sum(v.s) as s, (abs(a.ostc)-sum(v.s*100))/100 as riz, v.acc as acc, a.branch as branch
          from v_cc_989917 v, accounts a
          where v.acc = a.acc
          --and a.nbs = 9899 and ob22 = '17'
          group by a.nls, a.nms, a.ostc, v.acc, a.ostb, a.branch
        </sql>
      </datasource>
      <rowselection method="SingleRowServer"/>

      <fields>
        <field name="NLS" datatype="String" key="false" >
          <column caption="Рахунок дороги" show="true"></column>
        </field> 

        <field name="NMS" datatype="String" key="false" >
          <column caption="Назва рахунку дороги" show="true"></column>
        </field>

        <field name="OSTB" datatype="Decimal" key="false" >
          <column caption="Плановий залишок " show="true"></column>
        </field>

        <field name="OSTC" datatype="Decimal" key="false" >
            <column caption="Фактичний залишок " show="true"></column>
        </field>

        <field name="S" datatype="Decimal" key="false" >
          <column caption="Сума картотеки" show="true"></column>
        </field>

        <field name="RIZ" datatype="Decimal" key="false" >
          <column caption="Розбіжність" show="true"></column>
        </field>

        <field name="ACC" datatype="Int64" key="true" >
          <column caption="ACC" show="false"></column>
        </field>
      
        <field name="BRANCH" datatype="String" key="true" >
          <column caption="BRANCH" show="false"></column>
        </field>
    
    
      </fields>  
    
    </grid>
    
    
    <grid id="Id2" pagesize="10" showpagesizebox="true" title="Оприбуткувати документи:" >
      
      <filters buttontext="Пошук"  columnscount="2">
        <filter caption="Референс договора" columnindex="1" id="f1" field="ND" condition="Equal" ></filter>
        <filter caption="ПІБ позичальника"  columnindex="2" id="f2" field="FIO" condition="LikeBoth" ></filter>
      </filters>
      
      <rowselection method="CheckBox"/>
      <datasource>
        <sql>
          select REF1, OPL, BRANCH, NLSB, NAM_B, S, upper(FIO) as fio, ND, VA_KC, NLSA, REF2, acc
          from v_cc_989917 where acc = :ACC
        </sql>
        <parameters>
          <parameter name="ACC"  type="MasterGrid" masterid="Id1" masterkeyfield="ACC"></parameter>
        </parameters>
      </datasource>

      <buttons>
        <button id="Bt1" caption="Оприбуткувати цінності" type="Image" imagename="checks" hint="Оприбуткувати цінності">
          <command type="PlSqlBlock">
            <sql>
              begin
              update v_cc_989917 set opl = 1 where ref1 = :REF1;
              end;
            </sql>
            <parameters>
              <parameter name="REF1" type="DataField" altname="ref1"  datatype="Int64"></parameter>
            </parameters>
          </command>
          
        </button>
      </buttons>

      <fields>
        <field name="REF1" datatype="Int64" key="true" >
          <column caption="Референс вхідного" show="true"></column>
        </field>

        <field name="OPL" datatype="Int64" key="false" >
          <column caption="Оприбуткувати" show="false"></column>
            
        </field>

        <field name="S" datatype="Int64" key="false" >
          <column caption="Кількість" show="true"></column>
        </field>

        <field name="FIO" datatype="String" key="false" >
          <column caption="ПІБ позичальника" show="true"></column>
        </field>

        <field name="ND" datatype="Int64" key="false" >
          <column caption="Референс договора" show="true"></column>
        </field>
        
      <field name="VA_KC" datatype="Int64" key="false" >
          <column caption="Вид цінності" show="true"></column>
        </field>
        
      

      </fields>
      
      
    </grid>
    
    
    
  </grids>
</xmlform>
