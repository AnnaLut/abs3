@using Kendo.Mvc.UI
@using BarsWeb.Areas.Bills.Model
@{
    @* View для работы с взыскателями (поиск, редактирование и т.д.)! *@
    Layout = "~/Views/Shared/_LayoutKendo.cshtml";
}
<link href="~/Areas/Bills/Css/Main.css" rel="stylesheet" />
<link href="~/Areas/Bills/Css/FontsAndGridStyle.css" rel="stylesheet" />
<script src="~/Areas/Bills/Scripts/ScanDialog.js"></script>
<script src="~/Areas/Bills/Scripts/SignVega.js"></script>
<script src="~/Areas/Bills/Scripts/Main.js?v.2.1"></script>
<div class="page-header" style="margin: 10px 0 10px !important;">
    <h2 id="title">Централізована система обліку та реструктуризації заборгованості за рішеннями судів</h2>
</div>
<div style="margin-bottom: 5px;">
    <button type="button" class="btn btn-primary btn-xs btn-filter selected" id="All" onclick='ShowAll();' disabled>Всі</button>
    <button type="button" class="btn btn-default btn-xs btn-filter" id="NotConfirmed" onclick='ShowNotConfirmed();'>Не підтверджені</button>
    <button type="button" class="btn btn-default btn-xs btn-filter" id="Dismissed" onclick='ShowDismissed();'>Відбраковані <span class='glyphicon glyphicon-exclamation-sign'></span></button>
    <button type="button" class="btn btn-default btn-xs btn-filter" id="Extradited" onclick='ShowExtradited();'>Видані</button>
</div>

<div style="margin-bottom: 50px;">
    @(Html.Kendo().Grid<Receiver>()
        .Name("grid")
        .Columns(col =>
        {
            col.Bound(x => x.IMPORTANT_FLAG).Title("").Width(30).ClientTemplate("#=importantFlagTemplate(data)#"); // Не менять положение в списке: поиск значения реализован по индексу
            col.Bound(x => x.IMPORTANT_TXT).Hidden(true);  // Не менять положение в списке: поиск значения реализован по индексу
            col.Bound(x => x.STATUS).Hidden(true); // Не менять положение в списке: поиск значения реализован по индексу
            col.Bound(x => x.EXP_ID).Hidden(true);  // Не менять положение в списке: поиск значения реализован по индексу
            col.Bound(x => x.APPLREADY).Hidden(true);  // Не менять положение в списке: поиск значения реализован по индексу
            col.Bound(x => x.SNDDOC).Hidden(true);  // Не менять положение в списке: поиск значения реализован по индексу
            col.Bound(x => x).ClientTemplate("#=data.NAME#").Title("ПІБ/Найменування").HeaderHtmlAttributes(new { style = "white-space: normal" }).Width(120);
            col.Bound(x => x.EXPECTEDNAME).Title("ПІБ/Найменування ОЧІКУВАНОГО стягувача").HeaderHtmlAttributes(new { style = "white-space: normal" }).Width(120);
            col.Bound(x => x.INN).Title("ІПН/ЄДРПОУ").HeaderHtmlAttributes(new { style = "white-space: normal" }).Width(120);
            col.Bound(x => x.DOC_NO).Title("Номер документу").HeaderHtmlAttributes(new { style = "white-space: normal" }).Width(120);
            col.Bound(x => x.DOC_DATE).Hidden(true);
            col.Bound(x => x.DOC_WHO).Hidden(true);
            col.Bound(x => x.CL_TYPE).ClientTemplate("#=SetUser(CL_TYPE)#").Title("Тип клієнта</br>(юо/фо)").HeaderHtmlAttributes(new { style = "white-space: normal" }).Width(120);
            col.Bound(x => x.AMOUNT).Title("Сума запиту в грн").Format("{0:n2}").HeaderHtmlAttributes(new { style = "white-space: normal" }).HtmlAttributes(new { style = "text-align: right" }).Width(160);
            col.Bound(x => x.STATUS_NAME).Title("Статус у банку").HeaderHtmlAttributes(new { style = "white-space: normal" }).Width(160);
            col.Bound(x => x.BRANCH).Title("Відділення, яке проводить роботу з отримувачем").HeaderHtmlAttributes(new { style = "white-space: normal" }).Width(120);
            col.Bound(x => x.LAST_DT).Format("{0:dd.MM.yyyy}").Title("Остання дата змін").HeaderHtmlAttributes(new { style = "white-space: normal" }).HtmlAttributes(new { style = "text-align: center" }).Width(120);
            col.Bound(x => x.CURRENCY).Hidden(true);
            col.Bound(x => x.CUR_RATE).Hidden(true);
            col.Bound(x => x.CURRENCY).Hidden(true);
            col.Bound(x => x.PHONE).Hidden(true);
            col.Bound(x => x.DOC_DATE).Hidden(true);
            col.Bound(x => x.DOC_WHO).Hidden(true);
            col.Bound(x => x.ACCOUNT).Hidden(true);
            col.Bound(x => x.REQ_ID).Hidden(true);
            col.Bound(x => x.EXT_STATUS).Hidden(true);
            col.Bound(x => x.EXT_STATUS_NAME).Title("Статус ДКСУ").Width(160);
        })
        .Resizable(resizable => resizable.Columns(true))
        .Reorderable(reorderable => reorderable.Columns(true))
        .Scrollable()
        .Selectable()
        .Events(ev => ev.Change("Selected").DataBound("DataBound"))
        .HtmlAttributes(new { style = "min-height: 50px; height: 100%;" })
        .ToolBar(toolbar =>
        {
            toolbar.Template(@<text>
               <button class="k-button" id="search-button" title="Пошук рішення" onclick="SearchReceiver(); this.blur(); return false;">
                   <span style="color: darkgoldenrod" class="glyphicon glyphicon-search"></span>
               </button>
               <button class="k-button" id="remove" title="Видалити отримувача" onclick="removeReceiver(); this.blur(); return false;">
                   <span style="color: red" class="glyphicon glyphicon-remove"></span>
               </button>
               <button class='k-button' title="Редагувати данні по стягувачу" onclick='ShowEditReceiver(); this.blur(); return false;'>
                   <span style="color: green" class="glyphicon glyphicon-pencil"></span>
               </button>
               <button class="k-button" id="create-request-button" title="Резервування стягувача по рішенню" style="background-color: lightgray;" disabled="disabled" onclick="createRequest(); this.blur(); return false;">
                   <span style="color: steelblue" class="glyphicon glyphicon-circle-arrow-up"></span>
               </button>
               <button class="k-button" id="print-bill" style="background-color: lightgray;" disabled="disabled" title="Завантаження заяви про видачу векселів" onclick="DownloadAcceptance('act'); return false; this.blur();">
                   <span class="k-icon k-i-pdf"></span>
               </button>
               @*<button class="k-button" id="print-bill" title="Відправити запит для формування заяви на погашення (з ДКСУ)" style="background-color: lightgray;" disabled="disabled" onclick="billRequest('printBill'); this.blur(); return false;">
                   <span class="k-icon k-i-pdf"></span>
               </button>
               <button class="k-button" id="download-application" title="Завантажити форму заяви на погашення (збережену)" style="background-color: lightgray;" disabled="disabled" onclick="downloadApplication(); this.blur(); return false;">
                   <span class="glyphicon glyphicon-save-file"></span>
               </button>*@
               <button class="k-button" id="scan-doc" title="Відсканувати заяву на погашення" style="background-color: lightgray;" disabled="disabled" onclick="showDialogScanPhoto(); this.blur(); return false;">
                   <span class="k-icon k-i-pdf" style="background-position-x: -292px; background-position-y: -101px;"></span>
               </button>
               <button class="k-button" id="attach-application" title="додати документ" style="background-color: lightgray;" disabled="disabled" onclick="attachDocument(); this.blur(); return false;">
                   <span class="glyphicon glyphicon-plus" style="color: darkseagreen; background-position-x: -292px; background-position-y: -101px;"></span>
               </button>
               <button class="k-button" id="upload-scan-doc" title="Сканкопії документів (відправка, сканування)" style="background-color: lightgray;" disabled="disabled" onclick="uploadScanDocs(); this.blur(); return false;">
                   <span style="color: steelblue" class="glyphicon glyphicon-floppy-disk"></span>
               </button>
               <button class="k-button" id="update-bill" title="Зберегти зміни у заяві по судовому рішенню (відправити до ДКСУ)" style="background-color: lightgray;" disabled="disabled" onclick="SendRequest('UpdateRq'); this.blur(); return false;">
                   <span style="color: tomato" class="glyphicon glyphicon-export"></span>
               </button>
               <button class="k-button" id="get-resolution" title="Оновити статуси (з ДКСУ)" onclick="updateStatuses(); this.blur(); return false;">
                   <span style="color: green" class="glyphicon glyphicon-refresh"></span>
               </button>
               <button class="k-button" id="set-req-rec" title="Відправити фактичного/очікуваного стягувача на формування витягу" style="background-color: lightgray;" disabled="disabled" onclick="billRequest('setRecRecReq'); this.blur(); return false;">
                   <span style="color: darkolivegreen" class="glyphicon glyphicon-lock"></span>
               </button>
               <button class="k-button" id="protocol" title="Переглянути дії користувача" onclick='ShowActionProtocol(); this.blur(); return false;'>
                   <span style="color: gray" class="glyphicon glyphicon-list-alt"></span>
               </button>
               <button class="k-button" id="branch" title="Показати тільки відділення" onclick='ShowOnlyBranch(); this.blur(); return false;'>
                   <span class="glyphicon glyphicon-home"></span>
               </button>

           </text>);
               })
         .Sortable()
         .Filterable()
         .Pageable(page => page
           .Refresh(true)
           .PageSizes(new List<Int32> { 5, 10, 20, 50 })
           .ButtonCount(10))
         .DataSource(dataSource => dataSource
             .Ajax()
             .Read(read => read.Action("Receivers_read", "Bills"))
             .PageSize(10)
         )
    )
</div>
<div id="windowContainer"></div>
<div id="windowContainerCustomers"></div>

