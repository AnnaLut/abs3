@using Kendo.Mvc.UI
@using Newtonsoft.Json
@model BarsWeb.Models.USER_PARAM
@{
    Layout = null;
    var theme = Session["theme"] != null ? Session["theme"].ToString() : "bootstrap";
    var isBkackTheme = BarsWeb.Infrastructure.Constants.ThemesList.FirstOrDefault(i => i.Pattern == "Kendo" && i.Name == theme && i.IsBlack) != null;
    var btTheme = isBkackTheme ? "inverse" : "default";
    var logo = isBkackTheme ? "_white": "";
    var sessionId = Session.SessionID;

    System.Globalization.DateTimeFormatInfo cultureInfo = System.Globalization.CultureInfo.GetCultureInfo("uk-UA").DateTimeFormat;
    DateTime bdate = Convert.ToDateTime(Model.BANKDATE);

    string[] ROLES_LIST = new string[] { string.Empty };
    if (!string.IsNullOrEmpty(Model.ROLES))
    {
        ROLES_LIST = Model.ROLES.Split(',');
    }
    //для роботи з _LayoutKendo
    bool isKendo = false;
    var getType = HttpContext.Current.Request.Params.GetValues("type");
    if (getType != null)
    {
        isKendo = (getType[0].ToLower() == "kendo");
    }
}

@if (barsroot.ServicesClass.GetGlobalParam("ENABLE_COMET_JS") == "1")
{
  <script src="@Url.Content("~/comet/js/comet.js")"></script>
}
else
{
  <script type="text/javascript" src="/barsroot/Scripts/crypto/barsCrypto.js?v1.0.4"></script>
  <script type="text/javascript" src="/barsroot/Scripts/jquery/jquery.iecors.js"></script>
  <script>
      function startNewSession() {
          var data = { "url": location.href };
          barsCrypto.startIe(data,
              function (res) {
              },
              function (err) {
              })
      }
      $(function() {
          getMessCount();
      });
      function getMessCount() {
          var url = '/barsroot/messagesctrl/count/';
          $.ajax({
              type: 'POST',
              url: url,
              success: function (data) {
                  var count = parseInt(data,10);
                  if (count != NaN) {
                      var buttMess = $('#btnMessage');
                      var messCount = buttMess.find('.count');
                      if (count == 0) {
                          messCount.remove();
                      } else {
                          if (messCount.length == 0) {
                              messCount = $('<div/>', { 'class': 'count', id: '#btnMessageCount' });
                              buttMess.prepend(messCount);
                          }
                          var oldCount = parseInt(messCount.eq(0).text(), 10) || 0;
                          if (oldCount < count) {
                              barsUiMess('Перевірте нові повідомлення', '<div class="btn_mess" style="width: 24px; height: 24px;float:left;margin:3px 4px 0 0;"></div>Нові повідомлення',
                                  1,
                                  function() {
                                      showMessage();
                                  });
                          }
                          messCount.html(count);
                      }
                  }
                  window.setTimeout(function () { getMessCount(); },60000);
              },
              error: function() {

              }
          });
      }

      var _CurrentBranchInfo = "@ViewBag.CurrentBranchInfo";

  </script>
}
<script src="@Url.Content("~/Scripts/Views/Home/header.js")"></script>

@if (!isKendo)
{
    <style>
        .btn-refresh {
            position: absolute;
            top: 0;
            right: 0;
            width: 28px;
        }
         .progress {
             border-radius: 4px;
             margin-top: 5px;
             position: relative;
             width: 100%;
             height: 20px;
             background-color: #edf1f2;
         }
        .progress .progress-bar {
            border-bottom-left-radius: 4px;
            border-top-left-radius: 4px;
            height: 20px;
            background-color: #27c24c;
        }
        .progress .progress-label {
            text-align: center;
        }
    </style>
    <link href="~/Content/Themes/ModernUI/css/popbox.css" rel="stylesheet" />
    <link href="~/Content/Themes/Kendo/kendo.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/Themes/Kendo/kendo.common.min.css" rel="stylesheet" />
    <style>
        #userProfile {
            font-family: arial, sans-serif;
            font-size: small;

        }
        #userProfile .user-data {
            margin: 10px;
        }
        #userProfile .user-control {
            margin: 0;
            background-color: #f4f4f4;
            border-top: 1px solid #ccc;
            padding: 7px 0;
        }
        #userProfile a {
            font-size: small;
        }
        #userProfile a:hover {
            text-decoration: underline;
        }
        .bf_bold {
            font-weight: bold;
        }
        .bf_w {
            color: #666;
        }
        #userGatges .toolbar a {
            background-color: #ffffff;
            margin: 10px;
        }
        #userGatges .toolbar a:hover {
            background-color: #dbdbdb;
        }
        #userToolkit .toolbar a {
            background-color: #ffffff;
            margin: 10px;
        }
        #userToolkit .toolbar a:hover {
            background-color: #bdbdbd;
        }
    </style>
    <div>

        <div class="toolbar" style="width: 600px;">
            <a id="btnProfile" class="btn_mypage" href="#" onclick=" showProfile();return false; ">
                <div>
                    <span class="label">Профіль</span>
                </div>
            </a>
            <a id="btnMessage" class="btn_mess" href="#" onclick=" showMessage();return false; ">
                <div>
                    <span class="label">Повідомл...</span>
                </div>
            </a>
            <a id="btnAudit" class="btn_audit" href="#" onclick=" showAudit();return false; ">
                <div>
                    <span class="label">Журнал</span>
                </div>
            </a>
            <a id="btnTasks" class="btn-tasks" href="#" onclick="showTasks();return false; ">
                <div>
                    <span class="label">Процеси</span>
                </div>
            </a>
            <a id="btnGatges" class="btn_gatges" href="#" onclick=" showGatges();return false; ">
                <div>
                    <span class="label">Додатки</span>
                </div>
            </a>
            <a id="btnToolkit" class="btn_toolkit" href="#" onclick="showToolkit();return false;">
                <div>
                    <span class="label">Інструмен...</span>
                </div>
            </a>
            <a id="btnBranches" class="btn_branches" href="#" onclick="showBranches();return false;">
                <div>
                    <span class="label">Відділення</span>
                </div>
            </a>
        </div>
  
        <div class="logo">
            <a href="@Url.Content("~/")">
                <img alt="logo" id="imgCompanyLogo" src="@Url.Content("~/Content/logo/logo.png")" style="margin-left: 5px;" />
            </a>
        </div>
        <div title="Банківська дата @Model.BANKDATE" style="display: block; width: 55px; height: 63px; background-color: #fff; float: left;border-right: 1px solid #DBDBDB; border-left: 1px solid #DBDBDB;">
            <div style="width: 55px; height: 17px; background-color: #DBDBDB; color: #535b5e; font-size: 12px; text-align: center;">@bdate.ToString("MMMM", cultureInfo)</div>
            <div style="width: 55px; height: 22px; line-height: 1; font-size: 28px; color: #05b7f9; text-align: center;">@bdate.ToString("dd")</div>
            <div style="width: 55px; height: 16px; font-size: 12px; color: #195e8d; text-align: center; font-weight: bold;padding-top: 6px;">@bdate.ToString("yyyy")</div>
        </div>
        <div style="float: left; margin: 9px 9px 0 9px; background: #DBDBDB;">
            @Html.Action("Branches", "Home", new {selectedBranch = Model.TOBO, selectedBranchName = Model.TOBONAME, selectedRoles = Model.ROLES})
        </div>

        @if (!string.IsNullOrWhiteSpace(Bars.Configuration.ConfigurationSettings.AppSettings["Product.Title"]))
        {
            <div style="float: left; margin: 6px 0 0 10px; font-weight: 600; color: #465371; overflow: hidden;">
                @Html.Raw(Bars.Configuration.ConfigurationSettings.AppSettings["Product.Title"])
            </div>
        }  
    </div>



    <div  style="display: none" id="userProfile">
        <div class="user-data">
            <table style="text-align: left;">
                <tr>
                    <td><span class="bf_w">Користувач:</span></td>
                    <td><span class="bf_bold">@User.Identity.Name</span></td>
                </tr>
                <tr>
                    <td><span class="bf_w">ПІБ:</span></td>
                    <td><span class="bf_bold">@Model.USER_FULLNAME</span></td>
                </tr>
                <tr>
                    <td><span class="bf_w">Ідентифікатор:</span></td>
                    <td><span class="bf_bold">@Model.USER_ID</span></td>
                </tr>    
                <tr>
                    <td><span class="bf_w">Ключ:</span></td>
                    <td><span class="bf_bold">@Model.IDOPER</span></td>
                    <td><a href="#" onclick="showVerifyKey();return false;">Перевірка ключа</a></td>
                </tr>     
                <tr>
                    <td><span class="bf_w">Відділення:</span></td>
                    <td><span class="bf_bold" title="@Model.TOBONAME">@Model.TOBO</span></td>
                </tr>    
                <tr>
                    <td><span class="bf_w">Ролі:</span></td>
                    @if (ROLES_LIST.Length > 2)
                    {
                        <td><span class="bf_bold">@Html.DropDownList("ROLES_LIST", new SelectList(ROLES_LIST))</span></td>
                    }
                    else
                    {
                        <td><span class="bf_bold">@Model.ROLES</span></td>
                    }
                </tr>     
            </table>
            <div style="background-color: #f4f4f4; border: 1px solid #ccc; margin-top: 10px;">
                <div style="text-align: center">Технічна іформація</div>
                <table>
                    <tr>
                        <td><span class="bf_w">WEB-сервер:</span></td>
                        <td><span class="bf_bold">@Server.MachineName (@Dns.GetHostAddresses(Server.MachineName).FirstOrDefault(i => i.AddressFamily.ToString() == "InterNetwork"))</span></td>
                    </tr>
                    <tr>
                        <td><span class="bf_w">База даних:</span></td>
                        <td><span class="bf_bold">@ViewBag.DbName</span></td>
                    </tr>
                    <tr>
                        <td><span class="bf_w">Номер сессії:</span></td>
                        <td>
                            <span class="bf_bold">@sessionId</span>&nbsp;&nbsp;&nbsp;&nbsp;
                            <a href="#" title="Відкрити нове вікно з новою сесією" onclick="startNewSession()">нова сесія</a>
                        </td>
                    </tr>
                </table>
            </div>

        </div>
        <div class="user-control" style="text-align: center;">
            <a href="@Url.Content("~/account/changepassword/")" style="margin-right: 30px;">змінити пароль</a>
            <a href="#" onclick=" return logout('@Url.Action("PrepareLogOut", "Account")','@Url.Action("LogOut", "Account")'); ">вихід</a>
        </div>
    </div>

    <div  id="userMessage" style="width: 300px; height: 400px; padding: 0; display: none;"></div>

    <div id="userAudit" style="width: 350px; height: 400px; padding: 0; display: none;"></div>

    <div id="userTasks" style="width: 350px; height: 400px; padding: 0; display: none;"></div>

    <div id="userGatges" style="width: 235px; height: 80px; display: none; margin-right: 60px">
        <div class="toolbar">
            <a id="btnCalc"  class="btn_calc" href="#" onclick=" showCalc();return false; ">
                <div>
                    <span class="label">Кальк...</span>
                </div>
            </a>
            <a id="btnConv" class="btn_euro" href="#" onclick=" showConverter();return false; ">
                <div>
                    <span class="label">Конверт...</span>
                </div>
            </a>
            <a id="btnNews" class="btn_news" href="#" onclick=" showNews();return false; ">
                <div>
                    <span class="label">Оголош...</span>
                </div>
            </a>
        </div>
    </div>
    <div id="userToolkit" style="width: 155px; height: 80px; display: none; margin-right: 60px">
        <div class="toolbar">
            <a id="btnAcc" class="btn_acc" href="#" onclick=" showAccounts();return false; ">
                <div>
                    <span class="label">Рахун...</span>
                </div>
            </a>
            <a id="btnDoc" class="btn_doc" href="#" onclick=" showDocuments();return false; ">
                <div>
                    <span class="label">Докум...</span>
                </div>
            </a>
        </div>
    </div>

    <div id="userBranches" style="width: 350px; height: 400px; padding: 0; display: none;overflow-y: scroll;">        
        <div class="branchPanel">
            <h4>Доступні відділення</h4>
            <div id="treeview"></div>
        </div>
    </div>

    <style>
        .branchPanel {
            margin-left: 20px;
        }
    </style>

}
else
{

    <style>
        #navBar {
            margin-bottom: 0;
            border: none;
            position: absolute;
            width: 100%;
            z-index: 2;
        }
        #navBar .container-fluid {
            padding-right: 0;
            padding-left: 0;
        }
        #navBar .container-fluid > .navbar-header {
            margin-right: 0;
            margin-left: 0;
        }

        #navBar .nav-bar-image-button {
            padding: 5px 10px 0 10px;
            text-align: center;
        }
        #navBar .nav-bar-image-button-text {
            font-size: 10px;
            display: block;
            line-height: 15px;
        }

        .userProfile-controls {
            border-width: 1px 0 0 0;
            border-radius: 0;
            padding: 10px 0;
            width: 100%;
            margin-bottom: 0
        }

        .bf-w {
            font-size: 12px;
        }
        .bf-bold {
            font-weight: bold;
        }
        .bf-block {
            margin: 0 0 5px 10px;
        }

        .bank-date-button {
            text-align: center;
            display: inline-block; 
            width: 60px; 
            height: 50px;
            margin: 0;
            padding: 0;
            background-color: #fff;
            float: left; 
            border:1px solid #ccc; 
            border-radius: 4px
        }
        .bank-date-button-month {
            line-height: 1;
            height: 14px; 
            background-color: #485e87; 
            color: #fff; 
            font-size: 12px; 
            border-radius: 4px;
            border-bottom-left-radius: 0 4px;
            border-bottom-right-radius:4px 0;
        }
        .bank-date-button-day {
            height: 18px; 
            line-height: 1; 
            font-size: 20px; 
            color: #05b7f9; 
            text-align: center;
        }
        .bank-date-button-year {
            margin: 2px 4px 0 4px;
            border-top: 1px dotted #ccc;
            line-height: 1;
            font-size: 12px; 
            color: #485e87; 
            font-weight: bold;
        }
    </style>

    <div class="navbar navbar-@btTheme k-header" id="navBar" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header" style="width:220px;">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="@Url.Content("~/")" style="margin-left: 10px">
                    <img alt="logo" id="imgCompanyLogo" src="@Url.Content("~/Content/logo" + logo + ".png")" />
                </a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav navbar-left">
                    @*<li>
                        <a href="#" style="padding:0 5px 0 10px;">
                            <div title="Банківська дата @Model.BANKDATE" class="bank-date-button">
                                <div class="bank-date-button-month">@bdate.ToString("MMMM", _cultureInfo)</div>
                                <div class="bank-date-button-day">
                                    @bdate.ToString("dd")@*<span class="bank-date-button-year">/@bdate.ToString("yyyy")</span>* @
                                </div>
                                <div class="bank-date-button-year" style="">@bdate.ToString("yyyy")</div>
                            </div>
                        </a>
                    </li>*@
                    <li>
                        <div id="branchesList" style="margin-top: 5px;width: 250px"></div>
                    </li>
                </ul>
                @*<ul class="nav navbar-nav">
                              <li class="active"><a href="#">Link</a></li>
                              <li><a href="#">Link</a></li>
                              <li><a href="#">Link</a></li>
                              <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <span class="caret"></span></a>
                                <ul class="dropdown-menu" role="menu">
                                  <li><a href="#">Action</a></li>
                                  <li><a href="#">Another action</a></li>
                                  <li><a href="#">Something else here</a></li>
                                  <li class="divider"></li>
                                  <li class="dropdown-header">Nav header</li>
                                  <li><a href="#">Separated link</a></li>
                                  <li><a href="#">One more separated link</a></li>
                                </ul>
                              </li>
                            </ul>*@
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" style="padding:0 5px 0 10px;">
                            <div title="Банківська дата @Model.BANKDATE" class="bank-date-button">
                                <div class="bank-date-button-month">@bdate.ToString("MMMM", cultureInfo)</div>
                                <div class="bank-date-button-day">
                                    @bdate.ToString("dd")
                                </div>
                                <div class="bank-date-button-year" style="">@bdate.ToString("yyyy")</div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-bar-image-button">
                            <div class="pf-icon pf-24 pf-alert"></div><span class="nav-bar-image-button-text">Сповіщення</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick=" onBtUserMailClick(this); return false; " class="nav-bar-image-button">
                            <div class="pf-icon pf-24 pf-mail"></div>
                            <span class="nav-bar-image-button-text">Повідомлення</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick=" onBtUserProfileClick(this); return false; " id="bt-userProfile" class="nav-bar-image-button">
                            <div class="pf-icon pf-24 pf-user"></div>
                            <span class="nav-bar-image-button-text">Профіль</span>
                        </a>
                    </li>
                </ul>
            </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
    </div>

    <div id="userProfile" style="display:none; right:0;">
        <table>
            <tr>
                <td style="vertical-align: top;">
                    <div style="width: 64px; height: 64px; border: 1px solid red;border-radius: 50%;overflow: hidden">
                        <div class="pf-icon pf-64 pf-user_symbol_blue-picture"></div>
                    </div>
                </td>
                <td style="vertical-align: top;">
                    <div class="bf-block">
                        <div class="bf-w">Користувач:</div>
                        <div class="bf-bold">@User.Identity.Name</div>
                    </div>
                    <div class="bf-block">
                        <div class="bf-w">ПІБ:</div>
                        <div class="bf-bold">@Model.USER_FULLNAME</div>
                    </div>
                    <div class="bf-block">
                        <div class="bf-w">Ідентифікатор:</div>
                        <div class="bf-bold">@Model.USER_ID</div>
                    </div>
                    <div class="bf-block">
                        <div class="bf-w">Ключ:</div>
                        <div class="bf-bold">@Model.IDOPER</div>
                    </div>
                    <div class="bf-block">
                        <div class="bf-w">Відділення:</div>
                        <div class="bf-bold" title="@Model.TOBONAME">@Model.TOBO</div>
                    </div>
                </td>
            </tr>
        </table>
        <div class="well" style="padding: 5px;">
            <div style="text-align: center">Технічна іформація</div>
            <table>
                <tr>
                    <td><span class="bf-w">WEB-сервер:</span></td>
                    <td><span class="bf-bold">@Server.MachineName (@Dns.GetHostAddresses(Server.MachineName).FirstOrDefault(i => i.AddressFamily.ToString() == "InterNetwork"))</span></td>
                </tr>
                <tr>
                    <td><span class="bf-w">База даних:</span></td>
                    <td><span class="bf-bold">@ViewBag.DbName</span></td>
                </tr>
            </table>
        </div>

        <div class="userProfile-controls well" style="text-align: center;">
            <a href="@Url.Content("~/account/changepassword/")" style="margin-right: 10px;">редагувати профіль</a>
            <a href="@Url.Content("~/account/changepassword/")" style="margin-right: 10px;">змінити пароль</a>
            <a href="@Url.Content("~/account/logout/")" onclick="bars.ui.loader($('body'),true); /*$('body').loader();*/$('#btnProfile').click();">вихід</a>
        </div>
    </div>

@*    @(Html.Kendo().Window()
          .Name("profileWindow1")
          .Title(false)
          .Resizable()
          .Visible(false)
          .Modal(false)
          .Draggable(true)
          .Width(350).Height(327)
          .Content(ProfileWindowContent().ToHtmlString())
          .Position(position => position.Top(50).Left(100))
          .Animation(animation =>
          {
              animation.Open(open =>
              {
                  open.Expand(ExpandDirection.Vertical);
                  open.Fade(FadeDirection.In);
              });
              animation.Close(close =>
              {
                  close.Reverse(true);
                  close.Expand(ExpandDirection.Vertical);
                  close.Fade(FadeDirection.In);
              });
          }))
    
@helper ProfileWindowContent()
{
    <div id="userProfile" >
        <table>
            <tr>
                <td style="vertical-align: top;">
                    <div style="width: 64px; height: 64px; border: 1px solid red;border-radius: 50%;overflow: hidden">
                        <div class="pf-icon pf-64 pf-user_symbol_blue-picture"></div>
                    </div>
                </td>
                <td style="vertical-align: top;">
                    <div class="bf-block">
                        <div class="bf-w">Користувач:</div>
                        <div class="bf-bold">@User.Identity.Name</div>          
                    </div>
                    <div class="bf-block">
                        <div class="bf-w">ПІБ:</div>
                        <div class="bf-bold">@Model.USER_FULLNAME</div>
                    </div>
                    <div class="bf-block">
                        <div class="bf-w">Ідентифікатор:</div>
                        <div class="bf-bold">@Model.USER_ID</div>
                    </div>        
                    <div class="bf-block">
                        <div class="bf-w">Ключ:</div>
                        <div class="bf-bold">@Model.IDOPER</div>
                    </div>   
                    <div class="bf-block">
                        <div class="bf-w">Відділення:</div>
                        <div class="bf-bold" title="@Model.TOBONAME">@Model.TOBO</div>
                    </div>   
                </td>
            </tr>
        </table>
        <div class="well" style="padding: 5px;">
            <div style="text-align: center">Технічна іформація</div>
            <table>
                <tr>
                    <td><span class="bf-w">WEB-сервер:</span></td>
                    <td><span class="bf-bold">@Server.MachineName (@Dns.GetHostAddresses(Server.MachineName).FirstOrDefault(i => i.AddressFamily.ToString() == "InterNetwork"))</span></td>
                </tr>
                <tr>
                    <td><span class="bf-w">База даних:</span></td>
                    <td><span class="bf-bold">@ViewBag.DbName</span></td>
                </tr>
            </table>
        </div>    

        <div class="userProfile-controls well" style="text-align: center;">
            <a href="@Url.Content("~/account/changepassword/")" style="margin-right: 30px;">редагувати профіль</a>      
            <a href="@Url.Content("~/account/changepassword/")" style="margin-right: 30px;">змінити пароль</a>
            <a href="@Url.Content("~/account/logout/")" onclick=" $('body').loader();$('#btnProfile').click(); ">вихід</a>
        </div>

    </div>
}*@

    <script>
        var userParameters = @Html.Raw(JsonConvert.SerializeObject(Model)) ;
        $(function () {
            $("#branchesList").kendoDropDownList({
                dataTextField: "Branch",
                dataValueField: "Branch",
                autoBind: false,
                value: userParameters.TOBO,
                dataSource: {
                    transport: {
                        read: {
                            dataType: "json",
                            url: bars.config.urlContent('/api/kernel/branches/')
                        }
                    },
                    schema: {
                        data: "Data"
                    }
                },
                filter: 'contains',
                width: '250px',
                //valueTemplate: '<div>#= Branch #</div>' +
                // '<div style="font-size:10px;border-bottom:1px solid \\#ссс">#= Name #</div>',
                template: '<div>#= Branch #</div>' +
                    '<div style="font-size:10px;border-bottom:1px solid \\#ссс">#= Name #</div>',
                change:function() {
                    bars.ui.loader($('body'), true);
                    var dataItem = this.dataItem(this.selectedIndex);
                    document.location.replace(bars.config.urlContent('/home/changebranch/') + '?branch=' + dataItem.Branch);
                }
            });
        });

        function onBtUserProfileClick(elem) {
            if ($(elem).parent().hasClass('active')) {
                closeProfile();
            } else {
                showProfile();
            }
        }

        function showProfile() {
            bars.ui.dialog({
                    id: 'profileWindow',
                    title: false,
                    modal: false,
                    position: {
                        top: 50,
                        right:10,
                        left: 'inherit'
                    },
                    width: 350,
                    height:30,
                    /*buttons: [
                    {
                        text:'bt1'
                    }, {
                        text:'bt2'
                    }, {
                        text: 'bt3'
                    }
                ],*/
                    "animation":{
                        "open":
                        {
                            "effects": "expand:vertical fade:in",
                            "duration": 400
                        },
                        "close": {
                            "effects": "expand:vertical fade:in",
                            "duration": 400,
                            "reverse": true
                        }
                    }
                }).html($('#userProfile').html())
                .parent().css({ right: '5px', left: 'inherit' });


            var profile = $("#profileWindow");
            $('#bt-userProfile').parent().addClass('active');
            //profile.parent().css({ right: '5px', left: 'inherit' });

            $(document).bind('click.popupBox', function(event) {
                closeProfile(event);
            });
            $('iframe').contents().bind('click.popupBox', function(event) {
                closeProfile(event);
            });
            profile.data("kendoWindow").open();
        }

        function closeProfile(event) {
            if (!event || ($(event.target).closest('#bt-userProfile').length == 0 && $(event.target).closest('#profileWindow').length == 0)) {
                var profile = $("#profileWindow");
                $('#bt-userProfile').parent().removeClass('active');
                profile.data("kendoWindow").close();
                $(document).unbind('click.profileClose');
                $('iframe').contents().unbind('click.popupBox');
            }
        }

        function onBtUserMailClick(elem) {
            var splitter = $("#mainSplitter #mainHorizontalSplitter").data("kendoSplitter");
            var pane = $("#right-pane");
            var $elem = $(elem);
            if ($elem.parent().hasClass('active')) {
                $elem.parent().removeClass('active');
                splitter.toggle("#right-pane", false);
                kendo.ui.progress(pane, false);
            } else {
                $elem.parent().addClass('active');
                splitter.toggle("#right-pane", true);
                kendo.ui.progress(pane, true);
                pane.load('/barsroot/messagesctrl/index/', function() {
                    kendo.ui.progress(pane, false);
                });
            }
        }
        
    </script>
}