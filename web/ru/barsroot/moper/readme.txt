-- 1. Роль приложения BarsWeb.MOper
CREATE ROLE WR_MOPER;

GRANT WR_DOC_INPUT TO WR_MOPER;

GRANT SELECT, INSERT, UPDATE, DELETE ON MOPER_ACCERTED_FILES TO WR_MOPER;
GRANT SELECT ON MOPER_NM3_ACC TO WR_MOPER;
GRANT SELECT ON BANKS TO WR_MOPER;
GRANT SELECT, INSERT ON FDAT TO WR_MOPER;
GRANT SELECT ON NOSEP TO WR_MOPER;
GRANT SELECT ON PARAMS TO WR_MOPER;
GRANT SELECT ON SALDO TO WR_MOPER;
GRANT SELECT ON SALDOD TO WR_MOPER;
GRANT SELECT ON SALDOK TO WR_MOPER;
GRANT SELECT ON TTS TO WR_MOPER;

GRANT EXECUTE ON F_OURMFO TO WR_MOPER;
GRANT EXECUTE ON TOBOPACK TO WR_MOPER;
GRANT EXECUTE ON WEB_UTL TO WR_MOPER;
GRANT EXECUTE ON CHK TO WR_MOPER;

-- 2. Таблица оплаченых файлов MOPER
CREATE TABLE MOPER_ACCERTED_FILES
(
  FNAME        VARCHAR2(100),
  FSUM         VARCHAR2(100),
  ACCDAT       DATE DEFAULT SYSDATE
);


COMMENT ON TABLE MOPER_ACCERTED_FILES IS 'Таблица оплаченых файлов MOPER';

COMMENT ON COLUMN MOPER_ACCERTED_FILES.FNAME IS 'Имя файла';

COMMENT ON COLUMN MOPER_ACCERTED_FILES.FSUM IS 'Контрольная сумма файла';

COMMENT ON COLUMN MOPER_ACCERTED_FILES.ACCDAT IS 'Дата оплаты';


ALTER TABLE MOPER_ACCERTED_FILES ADD CONSTRAINT XPK_MOPER_ACCERTED_FILES PRIMARY KEY (FNAME, FSUM)
    USING INDEX TABLESPACE &idx_sml;
    
CREATE PUBLIC SYNONYM MOPER_ACCERTED_FILES FOR BARS.MOPER_ACCERTED_FILES;

-- test
-- INSERT INTO MOPER_ACCERTED_FILES VALUES('UM_G054X.dbf', '9BEAA7CB', to_date('22.11.1984', 'dd.MM.yyyy'));
-- COMMIT;

-- 3. Представление для выбора счетов ответных межбанковских платежей MOPER
CREATE OR REPLACE VIEW MOPER_NM3_ACC 
AS
SELECT * FROM ACCOUNTS WHERE TIP = '90D';

CREATE PUBLIC SYNONYM MOPER_NM3_ACC FOR BARS.MOPER_NM3_ACC;

