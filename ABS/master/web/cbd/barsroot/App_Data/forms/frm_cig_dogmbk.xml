<xmlform captiontype="OnlyTitle">
  <grids>
    <grid id="gv" pagesize="10" showpagesizebox="true" title="Фінансова інформація по МБК" showfilter="true">
      <datasource>
        <sql>
          select b.ID,b.DOG_ID, cc.rnk, b.LIMIT_CURR,b.LIMIT_SUM as LIMIT_SUM,b.UPDATE_DATE,
          b.CREDIT_USAGE,b.RES_CURR,b.RES_SUM as RES_SUM,b.OVERDUE_CURR,b.OVERDUE_SUM as OVERDUE_SUM,b.BRANCH, b.sync_date
          from
          (
          SELECT C.ID,
          C.DOG_ID,
          c.sync_date,
          T.LCV AS LIMIT_CURR,
          C.LIMIT_SUM,
          C.UPDATE_DATE,
          D20.TXT AS CREDIT_USAGE,
          T1.LCV AS RES_CURR,
          C.RES_SUM,
          T2.LCV AS OVERDUE_CURR,
          C.OVERDUE_SUM,
          c.branch
          FROM cig_dog_credit c,
          tabval$global t,
          cig_d20 d20,
          tabval$global t1,
          tabval$global t2
          WHERE     C.LIMIT_CURR_ID = T.KV
          AND C.CREDIT_USAGE = D20.ID
          AND C.RES_CURR_ID = T1.KV
          AND C.OVERDUE_CURR_ID = T2.KV
          )b, cig_dog_general cg, cig_customers cc
          where b.dog_id = :dog_id
          and cg.contract_type = 7
          and b.branch = :branch
          and b.branch = cg.branch
          and b.branch = cc.branch
          and b.dog_id=cg.id
          and cg.cust_id=cc.cust_id
		  union all
		  select b.ID,b.DOG_ID, cc.rnk, b.LIMIT_CURR,b.LIMIT_SUM as LIMIT_SUM,b.UPDATE_DATE,
          b.CREDIT_USAGE,b.RES_CURR,b.RES_SUM as RES_SUM,b.OVERDUE_CURR,b.OVERDUE_SUM as OVERDUE_SUM,b.BRANCH, b.sync_date
          from
          (
          SELECT C.ID,
          C.DOG_ID,
          c.sync_date,
          T.LCV AS LIMIT_CURR,
          C.LIMIT_SUM,
          C.UPDATE_DATE,
          D20.TXT AS CREDIT_USAGE,
          T1.LCV AS RES_CURR,
          C.USED_SUM as RES_SUM,
          null AS OVERDUE_CURR,
          null as OVERDUE_SUM,
          c.branch
          FROM cig_dog_noninstalment c,
          tabval$global t,
          cig_d20 d20,
          tabval$global t1
          WHERE     C.LIMIT_CURR_ID = T.KV
          AND C.CREDIT_USAGE = D20.ID
          AND C.USED_CURR_ID = T1.KV
          )b, cig_dog_general cg, cig_customers cc
          where b.dog_id = :dog_id
          and cg.contract_type = 6
          and b.branch = :branch
          and b.branch = cg.branch
          and b.branch = cc.branch
          and b.dog_id=cg.id
          and cg.cust_id=cc.cust_id
          order by 1 desc
        </sql>
        <parameters>
          <parameter name="dog_id" datatype="Int64" type="QueryString"></parameter>
          <parameter name="branch" datatype="String" type="QueryString"></parameter>
        </parameters>
      </datasource>
      <!--
      <buttons defaulttype="Button">
        <button caption="Назад" hint="На попередню сторінку" id="btnBack">
          <command type="Redirect" url="/barsroot/barsweb/dynform.aspx?form=frm_cig_dogs" checkselectedrow="false">
          </command>
        </button>
      </buttons>
      -->
      <rowselection method="SingleRow" />
      <fields>
        <field name="UPDATE_DATE" key="false" datatype="DateTime" sort="default">
          <column show="true" caption="Дата оновлення" formatstring="{0:dd.MM.yyyy HH:mm:ss}" align="center" />
        </field>
        <field name="SYNC_DATE" key="false" datatype="DateTime" sort="default">
          <column show="true" caption="Дата синхронізації" formatstring="{0:dd.MM.yyyy HH:mm:ss}" align="center" />
        </field>
        <field name="BRANCH" key="false" datatype="String">
          <column show="true" caption="Відділення" align="left" />
        </field>
        <field name="ID" key="true" datatype="Int64" sort="desc">
          <column show="true" caption="Код" align="right">
          </column> 
        </field>
        <field name="DOG_ID" key="false" datatype="Int64">
          <column show="false" caption="Код таблиці договорів CIG" align="right">
          </column>
        </field>
        <field name="RNK" key="false" datatype="Int64">
          <column show="true" caption="Код клієнта (РНК)" align="Center">
          </column>
        </field>
        <field name="LIMIT_CURR" key="false" datatype="String">
          <column show="true" caption="Валюта" align="Center" />
        </field>
        <field name="LIMIT_SUM" key="false" datatype="Decimal">
          <column show="true" caption="Сума ліміту" align="right" />
        </field>
        <field name="CREDIT_USAGE" key="false" datatype="String">
          <column show="true" caption="Остання операція за кредитом" align="left" />
        </field>
        <field name="RES_CURR" key="false" datatype="String">
          <column show="false" caption="Сума залишку (валюта)" align="left" />
        </field>
        <field name="RES_SUM" key="false" datatype="Decimal">
          <column show="true" caption="Сума залишку" align="right" />
        </field>
        <field name="OVERDUE_CURR" key="false" datatype="String">
          <column show="false" caption="Сума прострокованої заборгованості(валюта)" align="left" />
        </field>
        <field name="OVERDUE_SUM" key="false" datatype="Decimal">
          <column show="true" caption="Сума прострокованої заборгованості" align="right" />
        </field>
      </fields>
    </grid>
  </grids>
</xmlform>