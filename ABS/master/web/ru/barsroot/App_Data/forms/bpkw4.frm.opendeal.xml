<?xml version="1.0" encoding="utf-8"?>
<xmlform captiontype="OnlyTitle" caption="Реєстрація нової картки">
  <customforms>
    <customform name="frmBpkW4Deal" title="Реєстрація нової картки" buttonsposition="Bottom">
      <datasource>
        <sql>
          select bars_ow.check_opencard(:rnk, :card_code) msg from dual
        </sql>
        <parameters>
          <parameter type="QueryString" name="rnk" datatype="Int64"></parameter>
          <parameter type="QueryString" name="card_code" datatype="String" ></parameter>
        </parameters>
      </datasource>
      <customfields>
        <customfield name="MSG" datatype="String" label="" datasourcefield="msg">
          <uicontrol controlwidth="170" readonly="true">
          </uicontrol>
        </customfield>
      </customfields>
      <buttons defaulttype="Button">
        <button id="btnOpenCard" caption="Зареєструвати картку" hint="Реєстрація картки">
          <command type="PlSqlBlock" successmessage="Картку зареєстровано" successurl="/barsroot/barsweb/dynform.aspx?form=bpkw4.frm.portfolio">
            <sql>
              declare
              l_nd number;
              l_reqid number;
              begin
              bars_ow.open_card(:RNK, :CARD_CODE, :BRANCH,
              :FIRST_NAME, :LAST_NAME, :SEC_NAME, :WORK, :OFFICE, :WDATE, :PROECT_CODE, :TERM, l_nd, l_reqid);
              end;
            </sql>
            <parameters>
              <parameter type="FormField" name="RNK"></parameter>
              <parameter type="FormField" name="CARD_CODE"></parameter>
              <parameter type="FormField" name="BRANCH"></parameter>
              <parameter type="FormField" name="FIRST_NAME"></parameter>
              <parameter type="FormField" name="LAST_NAME"></parameter>
              <parameter type="FormField" name="SEC_NAME"></parameter>
              <parameter type="FormField" name="WORK"></parameter>
              <parameter type="FormField" name="OFFICE"></parameter>
              <parameter type="FormField" name="WDATE"></parameter>
              <parameter type="FormField" name="PROECT_CODE"></parameter>
              <parameter type="FormField" name="TERM"></parameter>
            </parameters>
          </command>
        </button>
        <button id="btnBackToPortfolio" caption="Повернутися до портфелю" hint="Повернутися до портфелю">
          <command type="Redirect" url="/barsroot/barsweb/dynform.aspx?form=bpkw4.frm.portfolio"></command>
        </button>
      </buttons>
    </customform>
  </customforms>
</xmlform>