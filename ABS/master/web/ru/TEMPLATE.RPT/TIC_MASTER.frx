<?xml version="1.0" encoding="utf-8"?>
<Report ScriptLanguage="CSharp" ReferencedAssemblies="System.dll&#13;&#10;System.Drawing.dll&#13;&#10;System.Windows.Forms.dll&#13;&#10;System.Data.dll&#13;&#10;System.Xml.dll&#13;&#10;Oracle.DataAccess&#13;&#10;FastReport.Oracle" ReportInfo.Created="04/18/2013 18:20:22" ReportInfo.Modified="03/03/2015 16:46:13" ReportInfo.CreatorVersion="2013.2.2.0">
  <ScriptText>using System;
using System.Collections;
using System.Collections.Generic;
using System.Collections.Specialized;
using System.ComponentModel;
using System.Windows.Forms;
using System.Drawing;
using System.Data;
using FastReport;
using FastReport.Data;
using FastReport.Dialog;
using FastReport.Barcode;
using FastReport.Table;
using FastReport.Utils;
using System.Data.Sql;
using Oracle.DataAccess.Client;
using Oracle.DataAccess.Types;

namespace FastReport
{
  public class ReportScript
  {
    // Коллекция пар тег - значение параметров тикета 
    StringDictionary TicParams = new StringDictionary();

    private void _StartReport(object sender, EventArgs e)
    {
      // Обработка флага отображения бух. модели
      Parameter buh = Report.GetParameter(&quot;p_buh&quot;);
      BUH_MODEL_H.Visible = (Convert.ToInt32(buh.Value) == 1 ? true : false);
      BUH_MODEL_B.Visible = (Convert.ToInt16(buh.Value) == 1 ? true : false);

      // Инициализация массива параметров тикета     
      string StrVar = &quot;&quot;; 
      string StrVal = &quot;&quot;; 
      
      OracleDataConnection frxcon = (OracleDataConnection)Report.Dictionary.Connections[0];
      OracleConnection con = (OracleConnection)frxcon.GetConnection();
      OracleCommand cmd = con.CreateCommand();
      
      cmd.CommandType = CommandType.StoredProcedure;
      cmd.CommandText = &quot;tic.getListAttr&quot;;

      Parameter parRef = Report.GetParameter(&quot;p_ref&quot;);
      cmd.Parameters.Add(&quot;ref&quot;, OracleDbType.Decimal, parRef.Value, ParameterDirection.Input);  //0
      cmd.Parameters.Add(&quot;tab&quot;, OracleDbType.Varchar2, &quot;OPER&quot;, ParameterDirection.Input);  //1
      cmd.Parameters.Add(&quot;mode&quot;, OracleDbType.Decimal, 0, ParameterDirection.Input);  //2
      cmd.Parameters.Add(&quot;name&quot;, OracleDbType.Varchar2, 20, null, ParameterDirection.InputOutput); //3
      cmd.Parameters.Add(&quot;vars&quot;, OracleDbType.Varchar2, 20000, StrVar, ParameterDirection.InputOutput); //4
      cmd.Parameters.Add(&quot;vals&quot;, OracleDbType.Varchar2, 20000, StrVal, ParameterDirection.InputOutput); //5
      cmd.Parameters.Add(&quot;tt&quot;, OracleDbType.Varchar2, 3, null, ParameterDirection.InputOutput); //6
      cmd.Parameters.Add(&quot;ext&quot;, OracleDbType.Decimal, null, ParameterDirection.InputOutput); //7
      
      con.Open();
      try
      {
        cmd.ExecuteNonQuery();
        StrVar = cmd.Parameters[&quot;vars&quot;].Value.ToString();
        StrVal = cmd.Parameters[&quot;vals&quot;].Value.ToString();
      }
      finally
      {
        con.Close();
      }
      
      // Инициализация коллекции параметров тикета
      InitTicParams(StrVar, StrVal);
    }

    // Инициализация коллекции параметров тикета
    private void InitTicParams(string StrVar, string StrVal)
    {
      // разбиваем строки по разделителю '~'
      string[] VarArray = StrVar.Split('~');
      string[] ValArray = StrVal.Split('~');

      // берем длину по меньшей
      int length = Math.Min(VarArray.Length, ValArray.Length);

      // добавляем параметры в коллекцию
      for (int i = 0; i &lt; length; i++)
      {
        if (!TicParams.ContainsKey(VarArray[i]))
          TicParams.Add(VarArray[i], ValArray[i]);
      }
    }
    // Получение значения параметра тикета
   
    /*
    public string Tag(string Var)
    {
      if (TicParams.ContainsKey(Var)) 
        return TicParams[Var]; 
      else 
        return &quot;&quot;;
    }
   */
    
    public string Tag( string Var, string Type)
    {
      string  Var_;
      
      if (TicParams.ContainsKey(Var))
      {  
        //(G) General:. . . . . . . . . -1234
        //(N) Number: . . . . . . . . . -1,234.00
        //(P) Percent:. . . . . . . . . -123,456.50 %
        
        Var_ = TicParams[Var].Trim();
        
        
        if      (Type == &quot;N&quot;) {return  Format(&quot;{0:N}\n&quot;, Convert.ToDecimal( Var_.Replace(&quot;.&quot;,&quot;,&quot;)))      ;}
        else if (Type == &quot;G&quot;) {return  Format(&quot;{0:G}\n&quot;, Convert.ToDecimal( Var_.Replace(&quot;.&quot;,&quot;,&quot;)))      ;}
        else if (Type == &quot;P&quot;) {return  Format(&quot;{0:P}\n&quot;, Convert.ToDecimal( Var_.Replace(&quot;.&quot;,&quot;,&quot;))/100)  ;}  
        else    {return  (Var_).Trim() ;}  
        
      } 
      else 
        return &quot;&quot;;
    }
    
    public string Tag(string Var, bool Par )
    {
      if (TicParams.ContainsKey(Var) &amp;&amp; Par) 
        return Tag(Var,&quot;&quot;); 
      else 
        return &quot;&quot;;
    }
    
    public string Tag(string Var)
    {
      if (TicParams.ContainsKey(Var)) 
        return Tag(Var,&quot;&quot;); 
      else 
        return &quot;&quot;;
    }

    
    private void ReportTitle1_BeforePrint(object sender, EventArgs e)
    {
      bool P1_vis = Picture1.Visible;
      bool P2_vis = Picture2.Visible;
      
      if   (  ((Decimal)Report.GetColumnValue(&quot;PICT.LENG&quot;)) == 0 )
      { ReportTitle1.Visible =  false;
        Picture1.Visible =  false;
        Picture2.Visible =  false; 
      }  
      else
      {
        Picture1.Visible =  P1_vis;
        Picture2.Visible =  P2_vis;


        // ширина і висота
        if (((Decimal)Report.GetColumnValue(&quot;PICT.HEIGHT&quot;))&gt;0   )
        {  
          Picture1.Height =   Convert.ToSingle(((Decimal)Report.GetColumnValue(&quot;PICT.HEIGHT&quot;)));
          Picture2.Height =   Convert.ToSingle(((Decimal)Report.GetColumnValue(&quot;PICT.HEIGHT&quot;)));
        }
        
        if ( ((Decimal)Report.GetColumnValue(&quot;PICT.WIDTH&quot;)) &gt; 0 )        
        {
          Picture1.Width  =   Convert.ToSingle( ((Decimal)Report.GetColumnValue(&quot;PICT.WIDTH&quot;))) ;
          Picture2.Width  =   Convert.ToSingle( ((Decimal)Report.GetColumnValue(&quot;PICT.WIDTH&quot;))) ;
        }
      }
    }
  }  
}
</ScriptText>
  <Dictionary>
    <OracleDataConnection Name="sberdev" ConnectionString="rijcmlq9SEZoacNJntaKIKp6mVF18t3N5WTocA0ARXAZ2I9tsXqxlsPHbqkZZ8j2333FaUp7NEZKfwRzqgcHIjxaWbZyzvucy6DbFwOIFiDwk+JyqI=">
      <TableDataSource Name="Table" Alias="BUH_MODEL" DataType="System.Int32" Enabled="true" SelectCommand="SELECT o.tt,o.dk,a.nls,a.kv,t.dig, trunc(o.fdat) fdat1,o.s/t.denom,gl.p_icurval(a.kv, o.s, o.fdat)/100,o.txt,r.nls,r.kv&#13;&#10;                                             FROM opldok o, accounts a, tabval$global t, accounts r &#13;&#10;                                             WHERE t.kv=a.kv and a.acc=o.acc and r.acc(+)=a.accc and o.ref=:p_ref and o.sos is not null&#13;&#10;                                             ORDER BY o.fdat, a.kv, o.stmt, o.tt, o.dk">
        <Column Name="TT" DataType="System.String"/>
        <Column Name="DK" DataType="System.Int16"/>
        <Column Name="NLS" DataType="System.String"/>
        <Column Name="KV" DataType="System.Int16"/>
        <Column Name="DIG" DataType="System.Int64"/>
        <Column Name="FDAT1" DataType="System.DateTime"/>
        <Column Name="O.S/T.DENOM" DataType="System.Decimal"/>
        <Column Name="GL.P_ICURVAL(A.KV,O.S,O.FDAT)/100" DataType="System.Decimal"/>
        <Column Name="TXT" DataType="System.String"/>
        <Column Name="NLS1" DataType="System.String"/>
        <Column Name="KV1" DataType="System.Int16"/>
        <CommandParameter Name="p_ref" DataType="107" Expression="[p_ref]" DefaultValue="-1"/>
      </TableDataSource>
      <TableDataSource Name="Table6" Alias="DK" DataType="System.Int32" Enabled="true" SelectCommand="select o.dk as &quot;DK&quot; &#13;&#10;    from oper o&#13;&#10;where o.ref=:p_ref">
        <Column Name="DK" DataType="System.Int16"/>
        <CommandParameter Name="p_ref" DataType="107" Expression="[p_ref]" DefaultValue="-1"/>
      </TableDataSource>
      <TableDataSource Name="Table1" Alias="PICT" DataType="System.Int32" Enabled="true" SelectCommand="select o.dk as &quot;DK&quot; ,&#13;&#10;          t.data_body as Pict,&#13;&#10;          nvl(DBMS_LOB.GETLENGTH (t.data_body),0) as leng,&#13;&#10;          T.HEIGHT,&#13;&#10;          T.WIDTH&#13;&#10;    from oper o, tickets_advertising t&#13;&#10;where o.ref = :p_ref&#13;&#10;  and t.id = ADVT_PACK.GET_ADVT_ID(o.tt)">
        <Column Name="DK" DataType="System.Int16"/>
        <Column Name="PICT" DataType="System.Byte[]" BindableControl="Picture"/>
        <Column Name="LENG" DataType="System.Decimal"/>
        <Column Name="HEIGHT" DataType="System.Decimal"/>
        <Column Name="WIDTH" DataType="System.Decimal"/>
        <CommandParameter Name="p_ref" DataType="113" Expression="[p_ref]" DefaultValue="-1"/>
      </TableDataSource>
    </OracleDataConnection>
    <Parameter Name="p_ref" DataType="System.Int32" Expression="38382201"/>
    <Parameter Name="p_buh" DataType="System.Int32" Expression="0"/>
  </Dictionary>
  <ReportPage Name="Page1" Guides="75.98,162.92,9.45,75.6,162.54,275.94,275.56,341.71,342.09,464.94,464.56,589.3,710.64,708.75,340.2,585.9" StartPageEvent="_StartReport">
    <ReportTitleBand Name="ReportTitle1" Width="718.2" Height="28.35" CanGrow="true" CanShrink="true" BeforePrintEvent="ReportTitle1_BeforePrint">
      <PictureObject Name="Picture2" Left="360.61" Width="340.2" Height="28.35" CanGrow="true" CanShrink="true" DataColumn="PICT.PICT"/>
      <PictureObject Name="Picture1" Width="340.2" Height="28.35" CanGrow="true" CanShrink="true" DataColumn="PICT.PICT"/>
    </ReportTitleBand>
    <DataBand Name="Data1" Top="32.35" Width="718.2" Height="434.7"/>
    <DataBand Name="BUH_MODEL_B" Top="531.75" Width="718.2" Height="18.9" CanGrow="true" Guides="0,18.9" DataSource="Table">
      <TextObject Name="Text3" Left="75.98" Width="86.94" Height="18.9" Border.Lines="Right, Top, Bottom" Text="[BUH_MODEL.FDAT1]" Format="Date" Format.Format="d" HorzAlign="Center" VertAlign="Center" Font="Arial, 9pt"/>
      <TextObject Name="Text1" Left="9.45" Width="66.15" Height="18.9" Border.Lines="All" Text="[BUH_MODEL.TT]" HorzAlign="Center" VertAlign="Center" Font="Arial, 9pt"/>
      <TextObject Name="Text4" Left="162.54" Width="113.4" Height="18.9" Border.Lines="Right, Top, Bottom" Text="[BUH_MODEL.NLS]" VertAlign="Center" Font="Arial, 9pt" TabWidth="55"/>
      <TextObject Name="Text2" Left="275.56" Width="66.15" Height="18.9" Border.Lines="Right, Top, Bottom" Text="[BUH_MODEL.KV]" HorzAlign="Center" VertAlign="Center" Font="Arial, 9pt"/>
      <TextObject Name="Text5" Left="342.09" Width="122.85" Height="18.9" Border.Lines="Right, Top, Bottom" Text="[IIf([BUH_MODEL.DK]==0,[BUH_MODEL.O.S/T.DENOM],null)]" HorzAlign="Right" VertAlign="Center" Font="Arial, 9pt"/>
      <TextObject Name="Text6" Left="464.56" Width="124.74" Height="18.9" Border.Lines="Right, Top, Bottom" Text="[IIf([BUH_MODEL.DK]==0,null,[BUH_MODEL.O.S/T.DENOM])]" HorzAlign="Right" VertAlign="Center" Font="Arial, 9pt"/>
      <TextObject Name="Text7" Left="589.3" Width="121.34" Height="18.9" Border.Lines="Right, Top, Bottom" Text="[BUH_MODEL.GL.P_ICURVAL(A.KV,O.S,O.FDAT)/100]" HorzAlign="Right" VertAlign="Center" Font="Arial, 9pt"/>
      <DataHeaderBand Name="BUH_MODEL_H" Top="471.05" Width="718.2" Height="56.7" Guides="28.35,56.7,0">
        <TextObject Name="Text8" Left="9.45" Top="28.35" Width="66.15" Height="28.35" Border.Lines="All" Text="Тип&#13;&#10;трн." HorzAlign="Center" VertAlign="Center" Font="Arial, 9pt"/>
        <TextObject Name="Text15" Left="9.45" Width="699.3" Height="28.35" Border.Lines="Top" Border.Style="Dash" Text="     Перелік транзакцій для документа # [p_ref]" VertAlign="Center" Font="Arial, 9pt"/>
        <TextObject Name="Text9" Left="75.6" Top="28.35" Width="86.94" Height="28.35" Border.Lines="Top, Bottom" Text="Дата &#13;&#10;валютування" Format="Date" Format.Format="d" HorzAlign="Center" VertAlign="Center" Font="Arial, 9pt"/>
        <TextObject Name="Text10" Left="162.54" Top="28.35" Width="113.4" Height="28.35" Border.Lines="All" Text="Рахунок" HorzAlign="Center" VertAlign="Center" Font="Arial, 9pt" TabWidth="55"/>
        <TextObject Name="Text11" Left="275.56" Top="28.35" Width="66.15" Height="28.35" Border.Lines="Right, Top, Bottom" Text="Валюта" HorzAlign="Center" VertAlign="Center" Font="Arial, 9pt"/>
        <TextObject Name="Text12" Left="340.2" Top="28.35" Width="124.74" Height="28.35" Border.Lines="Right, Top, Bottom" Text="Дебет" HorzAlign="Center" VertAlign="Center" Font="Arial, 9pt"/>
        <TextObject Name="Text13" Left="464.56" Top="28.35" Width="124.74" Height="28.35" Border.Lines="Right, Top, Bottom" Text="Кредит" HorzAlign="Center" VertAlign="Center" Font="Arial, 9pt"/>
        <TextObject Name="Text14" Left="585.9" Top="28.35" Width="124.74" Height="28.35" Border.Lines="Right, Top, Bottom" Text="Еквівалент" HorzAlign="Center" VertAlign="Center" Font="Arial, 9pt"/>
      </DataHeaderBand>
    </DataBand>
    <PageFooterBand Name="PageFooter1" Top="554.65" Width="718.2" Height="18.9"/>
  </ReportPage>
</Report>
