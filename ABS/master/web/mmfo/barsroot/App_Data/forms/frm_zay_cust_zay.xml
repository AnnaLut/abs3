<?xml version="1.0" encoding="utf-8" ?>
<xmlform caption="">
  <grids>
    <grid id="gv2" pagesize="2" showpagesizebox="true" title="Параметри клієнтів">
      <filters caption="Фільтри" buttontext="Знайти" columnscount="3" width="50%">
        <filter field="rnk" caption ="РНК" columnindex="1" condition="Equal" id="fltrrnk">
          <uicontrol></uicontrol>
        </filter>
        <filter field="okpo" caption ="ЗКПО" columnindex="2" condition="Equal" id="fltrokpo">
          <uicontrol></uicontrol>
        </filter>
        <filter field="nmk" caption="ПІБ (назва)" columnindex="3" condition="LikeBoth" id="fltrname">
          <uicontrol></uicontrol>
        </filter>
      </filters>
      <datasource>
        <sql>
          select z.rnk, c.nmk, c.okpo, c.branch, z.nls29, z.nlsv, z.mfov, z.nls26, z.mfo26, z.tel, z.fio, z.nls_kom, z.nls_kom2, z.custacc4cms
            from cust_zay z, customer c
           where z.rnk = c.rnk
             and (c.custtype = 2 or (c.custtype = 3 and trim(c.sed) = '91'))
           order by nls29, nmk
        </sql>
      </datasource>
      <rowselection method="SingleRow"/>
      <editform style="Dialog" title="Параметри клієнта {0} (РНК {1}) для біржевих заявок " height="750" width="1000" columnscount="3">
        <buttons defaulttype="Button">
          <button id="btnEdit" caption="Редагувати|Зберегти|Вiдмiнити" hint="Редагувати рядок|Зберегти рядок|Вiдмiнити редагування" confirmmessage="">
            <command type="Edit" successmessage="Збережені зміни в параметрах клієнта!">
              <sql>
                begin
                  bars_zay.upd_custzay (
                    p_mode    => 1,
                    p_rnk     => :rnk,
                    p_nls29   => :nls29,
                    p_nls26   => :nls26,
                    p_mfo26   => :mfo26,
                    p_okpo26  => :okpo,
                    p_tel     => :tel,
                    p_fio     => :fio,
                    p_mfov    => :mfov,
                    p_nlsv    => :nlsv,
                    p_nls_kom     => :nls_kom,
                    p_nls_kom2    => :nls_kom2,
                    p_custacc4cms => :custacc4cms );
                end;
              </sql>
              <parameters>
                <parameter type="DataField" name="rnk" />
                <parameter type="DataField" name="nls29" />
                <parameter type="DataField" name="nls26" />
                <parameter type="DataField" name="mfo26" />
                <parameter type="DataField" name="okpo" />
                <parameter type="DataField" name="tel" />
                <parameter type="DataField" name="fio" />
                <parameter type="DataField" name="mfov" />
                <parameter type="DataField" name="nlsv" />
                <parameter type="DataField" name="nls_kom" />
                <parameter type="DataField" name="nls_kom2" />
                <parameter type="DataField" name="custacc4cms" />
              </parameters>
            </command>
          </button>
          <button id="btnInsert" caption="Додати|Зберегти|Вiдмiнити" hint="Додати рядок|Зберегти рядок|Вiдмiнити додавання" confirmmessage="Зберегти параметри клієнта?">
            <command type="Insert" successmessage="Збережені параметри клієнта!">
              <sql>
                begin
                  bars_zay.upd_custzay (
                    p_mode    => 0,
                    p_rnk     => :rnk,
                    p_nls29   => :nls29,
                    p_nls26   => :nls26,
                    p_mfo26   => :mfo26,
                    p_okpo26  => :okpo,
                    p_tel     => :tel,
                    p_fio     => :fio,
                    p_mfov    => :mfov,
                    p_nlsv    => :nlsv,
                    p_nls_kom     => :nls_kom,
                    p_nls_kom2    => :nls_kom2,
                    p_custacc4cms => :custacc4cms );
                end;
              </sql>
              <parameters>
                <parameter type="DataField" name="rnk" />
                <parameter type="DataField" name="nls29" />
                <parameter type="DataField" name="nls26" />
                <parameter type="DataField" name="mfo26" />
                <parameter type="DataField" name="okpo" />
                <parameter type="DataField" name="tel" />
                <parameter type="DataField" name="fio" />
                <parameter type="DataField" name="mfov" />
                <parameter type="DataField" name="nlsv" />
                <parameter type="DataField" name="nls_kom" />
                <parameter type="DataField" name="nls_kom2" />
                <parameter type="DataField" name="custacc4cms" />
              </parameters>
            </command>
          </button>
          <button id="btnDel" caption="Видалити|Зберегти|Вiдмiнити" hint="Видалити рядок|Зберегти рядок|Вiдмiнити видалення" confirmmessage="Ви дійсно бажаєте видалити дані по клієнту?">
            <command type="Delete" successmessage="Видалено!">
              <sql>
                begin
                  bars_zay.upd_custzay(
                    p_mode => 2,
                    p_rnk  => :rnk );
                end;
              </sql>
              <parameters>
                <parameter type="DataField" name="rnk" />
              </parameters>
            </command>
          </button>
          <button caption="Закрити" id="btnClose">
            <command type="Close" />
          </button>
        </buttons>
      </editform>

      <buttons defaulttype="Button">
        <button caption="Рахунки клієнта" hint="Перегляд відкритих рахунків клієнта" id="btnCUSACC" type="Image" imagename="book_open">
          <command type="Redirect" url="/barsroot/customerlist/CustAcc.aspx?type=0" checkselectedrow="true">
            <parameters>
              <parameter datatype="Int64" name="rnk" altname="rnk" type="DataField"></parameter>
            </parameters>
          </command>
        </button>

        <button caption="Картка клієнта" hint="Перегляд картки клієнта" id="btnCUSCARD" type="Image" imagename="form_blue">
          <command type="Redirect" url="/barsroot/clientregister/registration.aspx?(readonly=\d+)*(client=\w+)|(rnk=\d+)" checkselectedrow="true">
            <parameters>
              <parameter datatype="Int64" name="rnk" altname="rnk" type="DataField"></parameter>
            </parameters>
          </command>
        </button>
      </buttons>

      <fields>
        <field name="rnk" datatype="Int64" key="true">
          <column caption="РНК клієнта" align="Right" show="true"></column>
          <form show="true" rwmode="RW" required="true" columnindex="1" index="1" titleindex="1" >
            <uicontrol type="ReadOnlyReference"  addemptyitem="true" controlwidth="130" formname="frm.ref.customer" formfieldname="drnk" formheight="700" formwidth="750">
              <rels>
                <rel destname="NMK" srcname="nmk"></rel>
                <rel destname="OKPO" srcname="okpo"></rel>
                <rel destname="BRANCH" srcname="branch"></rel>
              </rels>
            </uicontrol>
          </form>
        </field>
        <field name="nmk" datatype="String">
          <column caption="Назва клієнта" align="Left" show="true"></column>
          <form show="true" rwmode="RO" titleindex="0" columnindex="1" index="2" ></form>
        </field>
        <field name="okpo" datatype="String">
          <column caption="ОКПО клієнта" align="Right" show="true"></column>
          <form show="true" rwmode="RO" columnindex="1" index="3" ></form>
        </field>
        <field name="branch" datatype="String">
          <column caption="Відділення" align="Left" show="true"></column>
          <form show="true" rwmode="RO" columnindex="1" index="4" ></form>
        </field>
        <field name="nls29" datatype="Int64">
          <column caption="Торговий рахунок для списання" show="true" align="Right" ></column>
          <form show="true" rwmode="RW" columnindex="2" index="1"></form>
        </field>
         <field name="mfo26" datatype="Int64">
          <column caption="МФО для зарахування" show="true" align="Right"></column>
          <form show="true" rwmode="RW" columnindex="2" index="2"></form>
        </field>
         <field name="nls26" datatype="Int64">
          <column caption="Розрахунковий рахунок для зарахування" show="true" align="Right"></column>
          <form show="true" rwmode="RW" columnindex="2" index="2"></form>
        </field>
        <field name="mfov" datatype="Int64">
          <column caption="МФО повернення залишку" show="true" align="Right"></column>
          <form show="true" rwmode="RW" columnindex="2" index="3"></form>
        </field>
        <field name="nlsv" datatype="Int64">
          <column show="true" caption="Рахунок повернення залишку ГРН" align="Right"></column>
          <form show="true" rwmode="RW" columnindex="2" index="4"></form>
        </field>
        <field name="tel" datatype="String">
          <column caption="Тел.уповнов.працівника" align="Right" show="true"></column>
          <form show="true" rwmode="RW" columnindex="1" index="5" ></form>
        </field>
        <field name="fio" datatype="String">
          <column caption="ПІБ уповнов.працівника" align="Right" show="true"></column>
          <form show="true" rwmode="RW" columnindex="1" index="6" ></form>
        </field>
        <field name="nls_kom" datatype="Int64">
          <column caption="Рахунок комісії банка (купівля)" align="Right" show="true"></column>
          <form show="true" rwmode="RW" columnindex="3" index="4" ></form>
        </field>
        <field name="nls_kom2" datatype="Int64">
          <column caption="Рахунок комісії банка (продаж)" align="Right" show="true"></column>
          <form show="true" rwmode="RW" columnindex="3" index="5" ></form>
        </field>
        <field name="custacc4cms" datatype="Int64">
          <column caption="Альт.рахунок клієнта для списання комісії" align="Right" show="true"></column>
          <form show="true" rwmode="RW" columnindex="3" index="6" ></form>
        </field>
      </fields>
     </grid>
  </grids>
</xmlform>
