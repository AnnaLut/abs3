<?xml version="1.0" encoding="utf-8"?>
<xmlform caption="Налаштування скоринга"  captiontype="OnlyTitle" version="1.0.0" minwidth="1000" maxwidth="1000">
  <grids>
    <grid  id="gr1" title="Скорингові питання" >
      <datasource>
        <sql>
          select f.name, f.kod, f.idf, f.ord, t.val, t.name as name2
          from  FIN_QUESTION f, (select * from FIN_QUESTION_reply where idf = 32 and kod = 'TIP'   ) t
          where f.idf in( 33, 31) order by f.idf desc, f.ord asc, t.val
        </sql>
      </datasource>
      <rowselection method="SingleRowServer"/>
      <filters columnscount="1" buttontext="Пошук"   >
        <filter id="ft1" caption="Тип клієнта"  columnindex="1"  field="VAl" condition="Equal"  allowemptyvalue="false" >
          <uicontrol type="DropDownList" addemptyitem="false" table="(select val, name from FIN_QUESTION_reply where idf = 32 and kod = 'TIP' )" valuefield="NAME" keyfield="val"  ></uicontrol>
        </filter>
      </filters>

     
      <fields>
        <field name="KOD" key="true" datatype="String">
          <column caption="KOD" show="true" align="Left"></column>
        </field>
        <field name="NAME" key="false" datatype="String">
          <column caption="Питання" show="true" align="Left"></column>
        </field>
        <field name="NAME2" key="false" datatype="String">
          <column caption="Тип клієнта" show="true" align="Left"></column>
        </field>
        <field name="VAl" key="true" datatype="String" >
          <column caption="VAl" show="false" align="Left"></column>
        </field>

      </fields>
      
    </grid>

    <grid id="gr2" title="Scoring" >
      <datasource>
        <sql>
          select ord, id, kod,min_val, (select name from FIN_OBU_SIGN_TYPES where id = t.min_sign ) as min, 'KL1 ' as zn,  (select name from FIN_OBU_SIGN_TYPES where id = t.max_sign ) as max, max_val, score, min_sign, max_sign
          from FIN_OBU_SCORING t
          where kod = :kod and id = :id
          order by t.ord
        </sql>
        <parameters>
          <parameter type="MasterGrid" masterid="gr1" masterkeyfield="KOD" name="KOD" altname="kod"  datatype="String"></parameter>
          <parameter type="MasterGrid" masterid="gr1" masterkeyfield="VAl" name="ID" altname="id"  datatype="String"></parameter>
        </parameters>
      </datasource>
      <rowselection method="None"/>

      <buttons defaulttype="Button">
          <button id="ins"  type="Button"  caption="Вставити"     >  
          <command type="PlSqlBlock"  checkselectedrow="false"      >
            <sql>
              begin
              insert into FIN_OBU_SCORING (id, kod, MIN_VAL,MIN_SIGN,MAX_SIGN, MAX_VAL, SCORE, ORD   )
              values (:ID, :KOD, :MIN_VAL,:MIN_SIGN,:MAX_SIGN, :MAX_VAL, :SCORE, 1   );
              exception when others then
              raise_application_error(-(20000),'/' ||'     '||'Відсутні дані за звітний період - ',TRUE);
              end;
            </sql>
            <parameters>
              <parameter  type="MasterGrid" masterid="gr1" masterkeyfield="VAL"  datatype="String" name="ID"  ></parameter>
            </parameters>
            <customfields columnscount="4">
              <customfield name="MIN_VAL" label="МІн. значення" datatype="Int64" columnindex="1"></customfield>
              <customfield name="MIN_SIGN"     label="Умова" datatype="Int64" columnindex="1" >
                <uicontrol type="DropDownList" addemptyitem="true" table="(select id, name from FIN_OBU_SIGN_TYPES)" keyfield="id" valuefield="name"></uicontrol>
              </customfield>
              <customfield name="KOD"     label="KOD" datatype="String" required="false" columnindex="2">
                <uicontrol type="">
              </uicontrol>
              </customfield>
              <customfield name="MAX_SIGN"     label="Умова" datatype="Int64" columnindex="3">
                <uicontrol type="DropDownList" addemptyitem="true" table="(select id, name from FIN_OBU_SIGN_TYPES)" keyfield="id" valuefield="name"></uicontrol>
              </customfield>
              <customfield name="MAX_VAL" label="Мax. значення" datatype="Int64" columnindex="3"></customfield>
              <customfield name="SCORE"   label="Бали" datatype="Int64" columnindex="2"></customfield>
              
              </customfields>
            
             </command>
           
        </button>
      </buttons>

      <editform style="Dialog"  height="200" width="500" columnscount="3">
        <buttons defaulttype="Button" >
          <button  id="btnIns" caption="Додати|Зберегти|Вiдмiнити" hint="Додати|Зберегти|Вiдмiнити" confirmmessage=""  >
            <command type="Insert"    >
              <sql>
                begin
                --raise_application_error(-(20000),'/' ||'     '||'Відсутні дані за звітний період - ',TRUE);

                insert into FIN_OBU_SCORING (id, kod, MIN_VAL,MIN_SIGN,MAX_SIGN, MAX_VAL, SCORE, ORD   )
                values (:ID, :KOD, :MIN_VAL,:MIN_SIGN,:MAX_SIGN, :MAX_VAL, :SCORE, :ORD   );
                exception when others then
                raise_application_error(-(20000),'/' ||'     '||'Відсутні дані за звітний період - ',TRUE);
                end;
              </sql>
              <parameters>
                <parameter   type="MasterGrid" masterid="gr1" masterkeyfield="KOD" datatype="String" name="KOD" ></parameter>
                <parameter   type="MasterGrid" masterid="gr1" masterkeyfield="VAL" datatype="String" name="ID" ></parameter>
                <parameter   type="DataField"  name="MIN_VAL" ></parameter>
                <parameter   type="DataField"  name="MIN_SIGN" ></parameter>
                <parameter   type="DataField"  name="MAX_SIGN" ></parameter>
                <parameter   type="DataField"  name="MAX_VAL" ></parameter>
                <parameter   type="DataField"  name="SCORE" ></parameter>
                <parameter   type="DataField"  name="ORD" ></parameter>
              </parameters>
              </command>
          </button>

          <button  id="btnEdit" caption="Редагувати|Зберегти|Вiдмiнити" hint="Редагувати|Зберегти рядок|Вiдмiнити" confirmmessage=""  >
            <command type="Edit"  >
              <sql>
                begin
                raise_application_error(-(20000),'/' ||'     '||'Відсутні дані за звітний період - ',TRUE);
                null;
                end;
              </sql>
              <parameters>
                <parameter  type="DataField" datatype="String" name="ID" ></parameter>
                <parameter  type="DataField" datatype="String" name="KOD" ></parameter>
              </parameters>
              </command>
          </button>
          
        </buttons>
      </editform>
      
      <fields>

        <field name="ID" datatype="String" key="TRUE" >
          <column caption="ID" align="Right" show="true"></column>
          <form columnindex="1" rwmode="RW" show="false" required="true"></form>
        </field>
        
        <field name="MIN_VAL" datatype="Int64" key="false" >
          <column caption="МІн. значення" align="Right" show="true"></column>
          <form columnindex="1" rwmode="RW" show="true" required="true"></form>
                  </field>

        <field name="MIN" datatype="String" key="false" >
          <column caption="Умова" align="Right" show="true"></column>
          <form columnindex="1" rwmode="RW" show="false" required="true">
              </form>
        </field>

        <field name="MIN_SIGN" datatype="Int64" key="false" >
          <column caption="Умова" align="Right" show="false"></column>
          <form columnindex="1" rwmode="RW" show="true" required="true">
            <uicontrol type="DropDownList" addemptyitem="true" table="(select id, name from FIN_OBU_SIGN_TYPES)" keyfield="id" valuefield="name"></uicontrol>
          </form>
        </field>

        <field name="KOD" datatype="String" key="TRUE" >
          <column caption="KOD" align="Right" show="true"></column>
          <form columnindex="2" rwmode="RO" show="true" required="true">
            <uicontrol type="TextBox" >
              <defaultvalue type="Constant" value="******"/>
            </uicontrol>
            </form>
        </field>

        <field name="MAX" datatype="String" key="false" >
          <column caption="Умова" align="Right" show="true"></column>
          <form columnindex="3" rwmode="RW" show="false" required="true">
            </form>
        </field>

        <field name="MAX_SIGN" datatype="Int64" key="false" >
          <column caption="Умова" align="Right" show="false"></column>
          <form columnindex="3" rwmode="RW" show="true" required="true">
            <uicontrol type="DropDownList" addemptyitem="true" table="(select id, name from FIN_OBU_SIGN_TYPES)" keyfield="id" valuefield="name"></uicontrol>
          </form>
        </field>

        <field name="MAX_VAL" datatype="Int64" key="false" >
          <column caption="Мax. значення" align="Right" show="true"></column>
          <form columnindex="3" rwmode="RW" show="true" required="true"></form>
        </field>

        <field name="SCORE" datatype="Int64" key="false" >
          <column caption="Бали" align="Right" show="true"></column>
          <form columnindex="2" rwmode="RW" show="true" required="true"></form>
        </field>


        <field name="ORD" datatype="Int64" key="true" >
          <column caption="Sort" align="Right" show="true"></column>
          <form columnindex="2" rwmode="RW" show="true" required="true"></form>
        </field>

      </fields>
      
      
      
      
    </grid>


    
  </grids>
  
</xmlform>
