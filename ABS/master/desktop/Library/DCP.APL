.head 0 +  Application Description: технологические операции по обработке
файлов системы ДЦП
.head 1 -  Outline Version - 4.0.26
.head 1 +  Design-time Settings
.data VIEWINFO
0000: 6F00000001000000 FFFF01000D004347 5458566965775374 6174650400010000
0020: 0000000000B70000 002C000000020000 0003000000000000 0077020000F8FFFF
0040: FFE2FFFFFF000000 0000000000DE0100 0041010000010000 0001000000010000
0060: 000F4170706C6963 6174696F6E497465 6D01000000075769 6E646F7773
.enddata
.data DT_MAKERUNDLG
0000: 020000001E5C4241 525339385C524553 4F555243455C4943 4F5C4D6F6E65792E
0020: 69636F135C424152 5339385C42494E5C 4463702E45786516 5C4241525339385C
0040: 42494E5C6E657761 70702E646C6C165C 4241525339385C42 494E5C6E65776170
0060: 702E617063000001 010115513A5C4345 4E545552415C6E65 776170702E72756E
0080: 15513A5C43454E54 5552415C6E657761 70702E646C6C1551 3A5C43454E545552
00A0: 415C6E6577617070 2E61706300000101 01135C4241525339 385C42494E5C6463
00C0: 702E617064165C42 41525339385C4249 4E5C6E6577617070 2E646C6C165C4241
00E0: 525339385C42494E 5C6E65776170702E 6170630000010101 15513A5C43454E54
0100: 5552415C6E657761 70702E61706C1551 3A5C43454E545552 415C6E6577617070
0120: 2E646C6C15513A5C 43454E545552415C 6E65776170702E61 70630000010101
.enddata
.head 2 -  Outline Window State: Normal
.head 2 +  Outline Window Location and Size
.data VIEWINFO
0000: 6600040003002D00 0000000000000000 0000B71E5D0E0500 1D00FFFF4D61696E
0020: 0000000000000000 0000000000000000 0000003B00010000 00000000000000E9
0040: 1E800A00008600FF FF496E7465726E61 6C2046756E637469 6F6E730000000000
0060: 0000000000000000 0000000000003200 0100000000000000 0000E91E800A0000
0080: DF00FFFF56617269 61626C6573000000 0000000000000000 0000000000000000
00A0: 3000010000000000 00000000F51E100D 0000F400FFFF436C 6173736573000000
00C0: 0000000000000000 0000000000000000
.enddata
.data VIEWSIZE
0000: D000
.enddata
.head 3 -  Left:   -0.013"
.head 3 -  Top:    0.0"
.head 3 -  Width:  8.013"
.head 3 -  Height: 4.969"
.head 2 +  Options Box Location
.data VIEWINFO
0000: 0418B80BB80B2500
.enddata
.data VIEWSIZE
0000: 0800
.enddata
.head 3 -  Visible? Yes
.head 3 -  Left:   4.15"
.head 3 -  Top:    1.885"
.head 3 -  Width:  3.8"
.head 3 -  Height: 2.073"
.head 2 +  Class Editor Location
.head 3 -  Visible? No
.head 3 -  Left:   0.575"
.head 3 -  Top:    0.094"
.head 3 -  Width:  5.063"
.head 3 -  Height: 2.719"
.head 2 +  Tool Palette Location
.head 3 -  Visible? No
.head 3 -  Left:   6.388"
.head 3 -  Top:    0.729"
.head 2 -  Fully Qualified External References? Yes
.head 2 -  Reject Multiple Window Instances? No
.head 2 -  Enable Runtime Checks Of External References? Yes
.head 2 -  Use Release 4.0 Scope Rules? No
.head 1 +  Libraries
.head 2 -  Dynalib: Global.apd
.head 2 -  Dynalib: Message.apd
.head 2 -  Dynalib: Absapi.apd
.head 2 -  Dynalib: Nsiapi.apd
.head 2 -  Dynalib: DOCVIEW.APD
.head 2 -  Dynalib: Watchdog.apd
.head 2 -  Dynalib: Ssplashd.apd
.head 2 -  Dynalib: Dblogin.apd
.head 2 -  Dynalib: License.apd
.head 2 -  Dynalib: Dfltrapi.apd
.head 2 -  Dynalib: CHCKINNR.APD
.head 2 -  File Include: Winbars2.apl
.head 2 -  File Include: Winapi.apl
.head 2 -  File Include: Ttp32.apl
.head 2 -  File Include: Docfun6.apl
.head 2 -  File Include: signfile.apl
.head 2 -  File Include: Constant.apl
.head 2 -  File Include: Gentbl.apl
.head 2 -  File Include: GenFcls.apl
.head 2 -  File Include: Genfiltr.apl
.head 2 -  File Include: Gentimer.apl
.head 2 -  File Include: GenButn.apl
.head 2 -  File Include: Xsalcpt.apl
.head 2 -  File Include: Xsalimg.apl
.head 2 -  File Include: Vtmeter.apl
.head 2 -  File Include: Vtdos.apl
.head 2 -  File Include: Vtlbx.apl
.head 2 -  File Include: Vttblwin.apl
.head 2 -  File Include: Vtfile.apl
.head 2 -  File Include: vtcomm.apl
.head 2 -  File Include: vtmisc.apl
.head 2 -  File Include: vtstr.apl
.head 2 -  File Include: GENLIST.APL
.head 1 +  Global Declarations
.head 2 +  Window Defaults
.head 3 +  Tool Bar
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Form Window
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Dialog Box
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Top Level Table Window
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Data Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Multiline Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Spin Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Background Text
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Pushbutton
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Radio Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Check Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Option Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Group Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Child Table Window
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  List Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Combo Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Line
.head 4 -  Line Color: Use Parent
.head 3 +  Frame
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: 3D Face Color
.head 3 +  Picture
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 2 +  Formats
.head 3 -  Number: 0'%'
.head 3 -  Number: #0
.head 3 -  Number: ###000
.head 3 -  Number: ###000;'($'###000')'
.head 3 -  Date/Time: hh:mm:ss AMPM
.head 3 -  Date/Time: M/d/yy
.head 3 -  Date/Time: MM-dd-yy
.head 3 -  Date/Time: dd-MMM-yyyy
.head 3 -  Date/Time: MMM d, yyyy
.head 3 -  Date/Time: MMM d, yyyy hh:mm AMPM
.head 3 -  Date/Time: MMMM d, yyyy hh:mm AMPM
.head 3 -  Date/Time: hhhh:mm:ss
.head 2 +  External Functions
.head 3 +  Library name: IctBob.Dll
.head 4 +  Function: llopen
.head 5 -  Description: открытие файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: HANDLE
.head 5 +  Parameters
.head 6 -  ! первый параметр: имя файла, второй: тип открытия
.head 6 -  String: LPCSTR
.head 6 -  Number: INT
.head 4 +  Function: llcreat
.head 5 -  Description: создание файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: HANDLE
.head 5 +  Parameters
.head 6 -  ! первый параметр: имя файла, второй: тип открытия
.head 6 -  String: LPCSTR
.head 6 -  Number: INT
.head 4 +  Function: llclose
.head 5 -  Description: закрытие файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: HANDLE
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 4 +  Function: llread
.head 5 -  Description: чтение файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: UINT
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 6 -  String: LPVOID
.head 6 -  Number: UINT
.head 4 +  Function: llwrite
.head 5 -  Description:
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: UINT
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 6 -  String: LPCSTR
.head 6 -  Number: UINT
.head 4 +  Function: lllseek
.head 5 -  Description:
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: LONG
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 6 -  Number: LONG
.head 6 -  Number: INT
.head 4 +  Function: llstr2str
.head 5 -  Description: преобразование строки HEXtoBIN
.head 5 -  Export Ordinal: 0
.head 5 -  Returns
.head 5 +  Parameters
.head 6 -  String: LPSTR
.head 6 -  Receive String: LPVOID
.head 6 -  Number: ULONG
.head 3 +  ! Library name: seclogin.dll
.head 4 +  Function: DestroyAllBridges
.head 5 -  Description: int DestroyAllBridges() ! уничтожает все мосты в шлюзе
.head 5 -  Export Ordinal: 0
.head 5 +  Returns 
.head 6 -  Number: INT
.head 5 -  Parameters 
.head 2 +  Constants
.data CCDATA
0000: 3000000000000000 0000000000000000 00000000
.enddata
.data CCSIZE
0000: 1400
.enddata
.head 3 +  System
.head 3 +  User
.head 4 -  !
.head 4 -  ! Number: O_RDWR 		= 0x0002
.head 4 -  ! Number: O_CREAT		= 0x0100
.head 4 -  ! Number: O_TRUNC		= 0x0200
.head 4 -  ! Number: O_BINARY	= 0x8000
.head 4 -  ! Number: _SH_DENYRW	= 0x10
.head 4 -  ! Number: _S_IREAD	= 0000400
.head 4 -  ! Number: _S_IWRITE	= 0000200
.head 4 -  ! Number: _SH_DENYNO	= 0x40
.head 4 -  !
.head 4 -  String: AppCode    = 'DCP '
.head 4 -  String: AppVersion = '02'
.head 4 -  String: AppForm_DCP      = '01'
.head 4 -  String: AppForm_DCPA     = '02'
.head 4 -  String: AppForm_DCPState = '03'
.head 2 +  Resources
.head 2 +  Variables
.head 3 -  String: AppForm
.head 3 -  Number: nFetchRes
.head 3 -  Window Handle: hWinDCP
.head 3 -  Window Handle: hWinDCPA
.head 3 -  Window Handle: hWinDCPT
.head 3 -  Window Handle: hWinDCPState
.head 3 -  Window Handle: hWinDCPASign
.head 3 -  Number: nUsers
.head 3 -  Date/Time: dtExpDate
.head 3 -  Date/Time: dtWBDate
.head 2 +  Internal Functions
.head 3 +  Function: Func_DCP	! __exported
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Window Handle: hWndParent
.head 5 -  Number: nMode
.head 5 -  Number: nPar
.head 5 -  String: strPar01
.head 5 -  String: strPar02
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  Select Case nMode
.head 6 +  Case 1		! Прием &P
.head 7 +  If not IsWindow(hWinDCP)
.head 8 -  Set hWinDCP = SalCreateWindow( Tbl_DCP, hWndParent, nMode, nPar, strPar01, strPar02 )
.head 7 +  Else
.head 8 -  Call SalBringWindowToTop ( Tbl_DCP )
.head 7 -  Break
.head 6 +  ! Case 2
.head 7 +  If not IsWindow(hWinDCPA)
.head 8 -  Set hWinDCPA = SalCreateWindow( Frm_DCPA, hWndParent, nMode, nPar, strPar01, strPar02 )
.head 7 +  Else 
.head 8 -  Call SalBringWindowToTop(Frm_DCPA)
.head 7 -  Break 
.head 6 +  Case 2		! Формирование &A
.head 7 +  If not IsWindow(hWinDCPA)
.head 8 -  Set hWinDCPA = SalCreateWindow(Tbl_DCPA, hWndParent, nMode, nPar, strPar01, strPar02)
.head 7 +  Else
.head 8 -  Call SalBringWindowToTop(hWinDCPA)
.head 7 -  Break
.head 6 +  Case 3		! Состояние документов
.head 7 +  If not IsWindow(hWinDCPState)
.head 8 -  Set hWinDCPState = SalCreateWindow( Tbl_DCPState, hWndParent, nMode, nPar, strPar01, strPar02 )
.head 7 +  Else
.head 8 -  Call SalBringWindowToTop(Tbl_DCPState)
.head 7 -  Break
.head 6 +  Case 4		! Подпись документов перед формированием &A
.head 7 +  If not IsWindow(hWinDCPASign)
.head 8 -  Set hWinDCPASign = SalCreateWindow(Tbl_DCPA, hWndParent, nMode, nPar, strPar01, strPar02)
.head 7 +  Else
.head 8 -  Call SalBringWindowToTop(hWinDCPASign)
.head 7 -  Break
.head 6 +  Case 6		! Прием &OA, &TA
.head 7 +  If not IsWindow(hWinDCPT)
.head 8 -  Set hWinDCPA = SalCreateWindow(Tbl_DCPA, hWndParent, nMode, nPar, strPar01, strPar02)
.head 7 +  Else
.head 8 -  Call SalBringWindowToTop(hWinDCPT)
.head 7 -  Break
.head 6 +  Default
.head 7 -  Break
.head 3 +  Function: ShowApdVersion
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Window Handle: hWnd
.head 5 -  String: AppForm
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: strText
.head 5 -  Number: nLength
.head 4 +  Actions
.head 5 -  Call SalStrSetBufferLength(strText, 160)
.head 5 -  Set nLength = SalGetWindowText(hWnd, strText, 160)
.head 5 -  Call SalSetWindowText(hWnd, AppVersion || AppForm || ' ' || SalStrTrimX(strText))
.head 2 +  Named Menus
.head 2 +  Class Definitions
.data RESOURCE 0 0 1 452609039
0000: 470300007B010000 0000000000000000 0200000500FFFF01 00160000436C6173
0020: 73566172004F7574 6C696E6552006567 496E666F4E003C00 00076300446F6344
0040: 4350A000C0000006 00000083010D0000 00FFFFE40D000001 FE00FF831A000000
0060: 01FB00FF0F270000 00EE0100FF3F3400 B800000100FFFFE0 4100000001FE00FF
0080: 4301804E00000001 0000000963536900 676E46696C65A000 D9000600B3010D00
00A0: FFFFE60D0001FE00 FF9B1A0001FB00FF 6F2700EE0100FFBF 34B9000100FFFFE6
00C0: 410001FE00FF0301 8022000000000200 00000A6347650C6E 4674657274800000
00E0: 0004000000470204 0000F40100000F80 010000FE008D0400 010DFD00FF071100
0100: 000002F700FF1F15 0000DC000100FF7F 010C802200030000 30000B63474446FE
0120: 69EC0004001D0200 0100FD0093800100 007F046300010D00 FFFFCD110002FD00
0140: FF37150001F700FF 1F01804132000004 000D006352616469 6F4C69007374426F
0160: 78860000E4000500 00D9010D00FF7F0D 7200000100FFFFCD 1A0001FD00FF3727
0180: 0001F700FFDF34DC 000100FF7F
.enddata
.head 3 +  Functional Class: cDocDCP
.head 4 -  Description: Класс документа для электронных клиентов
.head 4 +  Derived From
.head 5 -  Class: cDoc
.head 5 -  ! Class: cSignFile
.head 4 +  Class Variables
.head 5 -  Boolean: _bInited ! признак инициализации
.head 5 -  Number: _nTimeout ! таймаут в минутах до переинициализации ЭЦП
.head 5 -  Number: m_nSignLen
.head 4 +  Instance Variables
.head 5 -  : fileSigner
.head 6 -  Class: cSignFile
.head 5 -  Long String: m_lsSignDCP
.head 5 -  String: sSignTypeDCP
.head 5 -  String: _strSignType     ! тип ЭЦП
.head 5 -  String: _strOpenKeyDir   ! директория таблицы откр. ключей
.head 5 -  String: _strSecretKeyDrv ! устройство секретного ключа
.head 5 -  String: _strKeyID        ! ID секретного ключа
.head 5 -  String: _strPassword     ! пароль
.head 5 -  String: _strDate         ! дата+время в форм. 'yyyy/MM/dd hhhh:mm:ss'
.head 5 -  String: strErrorSign
.head 4 +  Functions
.head 5 +  Function: sDocDCP   ! Переподписывам документ перед формированием &A
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  Number: nRef
.head 7 -  String: sSignData
.head 7 -  String: sOperNBU
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: nErrorSign
.head 7 -  String: strErrorSign
.head 7 -  String: szTempBuf
.head 7 -  Number: nInd
.head 7 -  Number: min_status
.head 7 -  Number: nSignLen
.head 7 -  Number: nCertLen
.head 7 -  Number: nSignHandle
.head 7 -  Number: nCertHandle
.head 6 +  Actions
.head 7 -  Set m_lsSignDCP = STRING_Null
.head 7 +  If sSignTypeDCP = 'NBU'
.head 8 +  If GetGlobalOption('NBUBANK') = '1'
.head 9 -  ! Для НБУ ничего не нужно
.head 9 +  ! If NOT SqlPrepare(hSql(), "SELECT sign INTO :m_lsSignDCP FROM oper WHERE ref=:nRef") 
.head 10 -  Return FALSE
.head 9 +  ! If not SqlSetLongBindDatatype(1, BLOB_BYTE)
.head 10 -  Return FALSE
.head 9 +  ! If not SqlExecute(hSql())
.head 10 -  Return FALSE
.head 9 +  ! If NOT SqlFetchNext(hSql(), nFetchRes)
.head 10 -  Return FALSE
.head 9 -  Set nErrorSign = 0
.head 8 +  Else
.head 9 -  ! Нужна подпись NBU на документ
.head 9 +  If GetGlobalOption("SEPNUM") = '2'
.head 10 +  If not InitDCPIdOperDocNBU()
.head 11 -  Return FALSE
.head 9 -  Call SalStrSetBufferLength(m_lsSignDCP, 65)
.head 9 -  Set nErrorSign = RSA_ZAH(87,-1,1,sSignData,444,0,m_lsSignDCP,sOperNBU)
.head 7 +  Else If sSignTypeDCP = 'UNI'
.head 8 +  If NOT SqlPrepare(hSql(), "SELECT sign INTO :m_lsSignDCP FROM oper WHERE ref=:nRef") 
.head 9 -  Return FALSE
.head 8 +  If not SqlSetLongBindDatatype(1, BLOB_BYTE)
.head 9 -  Return FALSE
.head 8 +  If not SqlExecute(hSql())
.head 9 -  Return FALSE
.head 8 +  If NOT SqlFetchNext(hSql(), nFetchRes)
.head 9 -  Return FALSE
.head 8 -  Set nErrorSign = 0
.head 7 +  Else
.head 8 -  Call SalStrSetBufferLength( m_lsSignDCP, 129 )
.head 8 -  Set nErrorSign = nsignPutOPSignOnMemory(sSignData,444,m_lsSignDCP)
.head 7 +  If nErrorSign = 0
.head 8 -  Return TRUE
.head 7 +  Else
.head 8 +  If GetSignType() = 'NBU'
.head 9 -  Set strErrorSign = 'Ошибка наложения ЭЦП НБУ: '||NumberToStr(nErrorSign)
.head 9 -  Call MessageErrorEx(strErrorSign)
.head 8 +  Else If GetSignType() = 'VEG'
.head 9 -  Set strErrorSign = 'Ошибка наложения ЭЦП VEGA: '
||SalNumberToStrX(SalNumberMod( nErrorSign, 4096 ),0)
.head 9 -  Call MessageErrorEx(strErrorSign)
.head 8 +  Else If GetSignType() = 'UNI'
.head 9 -  Call MessageErrorEx( UNIFormatGSSMessage(min_status, nErrorSign) )
.head 8 +  Else ! обработка ошибок ЭЦП
.head 9 -  Call nsignMapError2Text(strErrorSign,nErrorSign)
.head 9 -  Call nsignExitOPSign()
.head 9 -  Call MessageErrorEx(StrDosToWinX(strErrorSign))
.head 7 -  Return FALSE
.head 5 +  Function: SetVariablesDCPIdOperDocNBU
.head 6 -  Description: установить значения внутр. переменных
.head 6 -  Returns
.head 6 +  Parameters
.head 7 -  String: strSignType  ! тип ЭЦП
.head 7 -  String: strOpenKeyDir  ! директория таблицы откр. ключей
.head 7 -  String: strSecretKeyDrv ! устройство секретного ключа
.head 7 -  String: strKeyID ! ID секретного ключа
.head 7 -  String: strDate  ! дата+время в форм. 'yyyy/MM/dd hhhh:mm:ss'
.head 7 -  Number: nTimeout ! таймаут в минутах до переинициализации ЭЦП
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Set _strSignType = strSignType
.head 7 -  Set _strOpenKeyDir = strOpenKeyDir
.head 7 -  Set _strSecretKeyDrv = strSecretKeyDrv
.head 7 -  Set _strKeyID = strKeyID
.head 7 -  Set _strDate = strDate
.head 7 -  Set _nTimeout = nTimeout
.head 5 +  Function: InitDCPIdOperDocNBU
.head 6 -  Description: Инициализация ЭЦП
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 -  Parameters
.head 6 +  Static Variables
.head 7 -  Number: nTim
.head 7 -  Number: nCredLifeSec
.head 7 -  Number: nCredLifeDays
.head 6 +  Local variables
.head 7 -  Number: lTim
.head 7 -  Number: nErrorSign
.head 7 -  String: strPinCode
.head 7 -  Number: min_status
.head 7 -  Number: nDay
.head 7 -  Number: nPinResult
.head 6 +  Actions
.head 7 +  If not GetSignOn( )
.head 8 -  Return TRUE
.head 7 -  Set lTim = nTim
.head 7 -  Set nTim = SalDateHour(SalDateCurrent())*60 + SalDateMinute(SalDateCurrent())
.head 7 +  If _bInited and nTim-lTim < _nTimeout
.head 8 -  Return TRUE
.head 7 -  Call SalMessageBox('Необходим ключ ' || sSignTypeDCP || ' ' || _strKeyID, 'Инициализация', MB_Ok)
.head 7 -  Set nErrorSign = NUMBER_Null
.head 7 -  Set strPinCode = ''
.head 7 -  Call WaitCursorOff(  )
.head 7 +  While TRUE
.head 8 -  Set nPinResult = SalModalDialog(dlgAskPinCode, hWndForm, strPinCode)
.head 8 -  Set _strPassword = strPinCode
.head 8 +  If nPinResult
.head 9 -  Set m_nSignLen = 64
.head 9 +  If _bInited
.head 10 -  Set nErrorSign = CLOSE_ZAH()
.head 10 -  Set _bInited = FALSE
.head 9 -  Set nErrorSign = INIT_ZAH( _strOpenKeyDir,
    _strSecretKeyDrv, _strKeyID, _strDate, _strPassword)
.head 9 +  If nErrorSign = -70
.head 10 -  Call MessageErrorEx('Последний день действия секретного ключа '||_strKeyID)
.head 9 +  Else If nErrorSign > -77 And nErrorSign < -70
.head 10 -  Set nDay = - nErrorSign - 70
.head 10 -  Call MessageErrorEx('Действие ключа '||_strKeyID||' прекращается через ' ||NumberToStr(nDay) || ' ' || GetDayStrByNum(nDay))
.head 9 +  Else If nErrorSign
.head 10 -  Break
.head 9 -  Call SaveInfoToLog('Инициализация ЭЦП - OK')
.head 9 -  Set _bInited = TRUE
.head 9 -  Return TRUE
.head 8 +  Else
.head 9 -  Set _bInited = FALSE
.head 9 -  Break
.head 7 +  If nErrorSign                 ! обработка ошибок ЭЦП
.head 8 +  If GetSignType() = 'NBU'
.head 9 -  Set strErrorSign =
'Ошибка '||NumberToStr(nErrorSign)
|| ' инициализации ЭЦП НБУ. Ключ '||_strKeyID
|| PutCrLf() || GetSepSignMsg(nErrorSign)
.head 9 -  Call MessageErrorEx(strErrorSign)
.head 8 +  ! Else If GetSignType() = 'UNI'
.head 9 -  Call MessageErrorEx( strErrorSign )
.head 7 -  Return FALSE
.head 5 +  Function: DeinitDCPIdOperDocNBU
.head 6 -  Description: деинициализация ЭЦП
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: nErrorSign
.head 7 -  Number: min_status
.head 6 +  Actions
.head 7 +  If not GetSignOn( )
.head 8 -  Return TRUE
.head 7 -  Set nErrorSign = NUMBER_Null
.head 7 +  If _strSignType = 'NBU'
.head 8 -  Set nErrorSign = CLOSE_ZAH()
.head 7 -  Set _bInited = FALSE
.head 7 +  If nErrorSign
.head 8 -  Return FALSE
.head 7 -  Return TRUE
.head 2 +  Default Classes
.head 3 -  MDI Window: cBaseMDI
.head 3 -  Form Window:
.head 3 -  Dialog Box:
.head 3 -  Table Window:
.head 3 -  Quest Window:
.head 3 -  Data Field:
.head 3 -  Spin Field:
.head 3 -  Multiline Field:
.head 3 -  Pushbutton: ctb_pbOk
.head 3 -  Radio Button:
.head 3 -  Option Button:
.head 3 -  Check Box:
.head 3 -  Child Table:
.head 3 -  Quest Child Window: cQuickDatabase
.head 3 -  List Box:
.head 3 -  Combo Box: cGenComboBox_NumId
.head 3 -  Picture:
.head 3 -  Vertical Scroll Bar:
.head 3 -  Horizontal Scroll Bar:
.head 3 -  Column:
.head 3 -  Background Text:
.head 3 -  Group Box:
.head 3 -  Line:
.head 3 -  Frame:
.head 3 -  Custom Control:
.head 2 +  Application Actions
.head 3 +  ! On SAM_AppStartup
.head 4 -  Call SplashOpenWindow('Dcp.bmp')
.head 4 -  Call Sleep( 1500 )
.head 4 -  ! Инициализация начальных  параметров
.head 4 -  Call GetConfigSettings()
.head 4 -  !
.head 4 -  ! Call DBSpy_Init(GetDbs()) ! в жопу
.head 4 -  !
.head 4 -  Call SplashCloseWindow()
.head 4 +  If not DatabaseLogin(dtWBDate)
.head 5 -  Call SalQuit()
.head 4 -  Call SetWorkBankDate(dtWBDate)
.head 4 -  ! Основной вызов
.head 4 -  ! Call SalCreateWindow(tbl_NOK, hWndNULL, 4)
.head 4 -  Call Func_DCP(hWndMDI,1,3,'','')
.head 3 +  ! On SAM_SqlError
.head 4 -  Call ShowSqlError(wParam, lParam)
.head 4 -  Return FALSE
.head 3 +  ! On SAM_AppExit
.head 4 -  Call SaveInfoToLog(MSG_DisconnectDbs() || GetDbs())
.head 4 +  If hSqlAux3()
.head 5 -  Call SqlDisconnect(hSqlAux3())
.head 4 +  If hSqlAux2()
.head 5 -  Call SqlDisconnect(hSqlAux2())
.head 4 +  If hSqlAux()
.head 5 -  Call SqlDisconnect(hSqlAux())
.head 4 +  If hSql()
.head 5 -  Call SqlDisconnect(hSql())
.head 4 -  Call DBSpy_Disconnect()
.head 4 -  ! ! если работаем через шлюз ==> удалить все мосты
.head 4 +  If UseGateway()
.head 5 -  Call DestroyAllBridges()
.head 4 -  Call SalQuit()
.head 1 +  Table Window: Tbl_DCP		! 01 - ДЦП. Прием и обработка &P
.head 2 -  Class: cGenericTable
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: ДЦП  -  Поставка проти оплати
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? Class Default
.head 2 -  Visible? Class Default
.head 2 -  Display Settings
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Class Default
.head 3 -  Initial State: Class Default
.head 3 -  Maximizable? Class Default
.head 3 -  Minimizable? Class Default
.head 3 -  System Menu? Class Default
.head 3 -  Resizable? Class Default
.head 3 -  Window Location and Size
.head 4 -  Left:   0.15"
.head 4 -  Top:    0.95"
.head 4 -  Width:  14.55"
.head 4 -  Width Editable? Class Default
.head 4 -  Height: Class Default
.head 4 -  Height Editable? Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 3 -  View: Class Default
.head 3 -  Allow Row Sizing? Class Default
.head 3 -  Lines Per Row: Class Default
.head 2 -  Memory Settings
.head 3 -  Maximum Rows in Memory: Class Default
.head 3 -  Discardable? Class Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Class Default
.head 4 -  Location? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Size: 0.679"
.head 4 -  Size Editable? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 3 +  Contents
.head 4 +  Data Field: dDAT
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Data
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Editable? No
.head 5 -  Display Settings
.head 6 -  Window Location and Size
.head 7 -  Left:   0.267"
.head 7 -  Top:    0.083"
.head 7 -  Width:  1.143"
.head 7 -  Width Editable? Yes
.head 7 -  Height: 0.25"
.head 7 -  Height Editable? Yes
.head 6 -  Visible? Yes
.head 6 -  Border? Yes
.head 6 -  Justify: Center
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Font Name: Default
.head 6 -  Font Size: Default
.head 6 -  Font Enhancement: Default
.head 6 -  Text Color: Default
.head 6 -  Background Color: Default
.head 6 -  Input Mask: Unformatted
.head 5 -  Message Actions
.head 4 +  Data Field: dTime
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cClock
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Data
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Editable? No
.head 5 -  Display Settings
.head 6 -  Window Location and Size
.head 7 -  Left:   0.267"
.head 7 -  Top:    0.333"
.head 7 -  Width:  1.143"
.head 7 -  Width Editable? Yes
.head 7 -  Height: 0.25"
.head 7 -  Height Editable? Yes
.head 6 -  Visible? Yes
.head 6 -  Border? Yes
.head 6 -  Justify: Center
.head 6 -  Format: Class Default
.head 6 -  Country: Default
.head 6 -  Font Name: Default
.head 6 -  Font Size: Default
.head 6 -  Font Enhancement: Default
.head 6 -  Text Color: Default
.head 6 -  Background Color: Default
.head 6 -  Input Mask: Unformatted
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbRef
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cTimer
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: Прийняти &P
.head 5 -  Window Location and Size
.head 6 -  Left:   1.5"
.head 6 -  Top:    0.095"
.head 6 -  Width:  1.967"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 0.5"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Yes
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\Tocenter.bmp
.head 5 -  Picture Transparent Color: Gray
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 +  If nPar = 1 OR nPar = 3
.head 8 -  Call pbRef.Init(nInterval, 0, TRUE)
.head 6 +  On UM_TimerFired
.head 7 -  Call SalSendMsg(hWndForm, SAM_User, 0, 0)
.head 4 -  !
.head 4 +  Pushbutton: pbIns
.head 5 -  Class Child Ref Key: 33
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? No
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDel
.head 5 -  Class Child Ref Key: 34
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   3.7"
.head 6 -  Top:    0.2"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Вилучити необроблену строку файлу &P'
.head 6 +  On SAM_Click
.head 7 -  Call DelStr()
.head 7 -  Call SalSendMsg( pbRefresh, SAM_Click, 0, 0 )
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 35
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   6.0"
.head 6 -  Top:    0.2"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbUpdate
.head 5 -  Class Child Ref Key: 36
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? No
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 2096
.head 5 -  Class Child Ref Key: 37
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? No
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbSearch
.head 5 -  Class Child Ref Key: 38
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   4.15"
.head 6 -  Top:    0.2"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbFilter
.head 5 -  Class Child Ref Key: 44
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   4.6"
.head 6 -  Top:    0.2"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDetails
.head 5 -  Class Child Ref Key: 39
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   5.05"
.head 6 -  Top:    0.2"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Перегляд сформованого документу'
.head 6 +  On SAM_Click
.head 7 +  If Tbl_DCP.REF != NUMBER_Null
.head 8 -  Call DocViewContentsEx(hWndMDI, Tbl_DCP.REF)
.head 4 +  Pushbutton: pbPrint
.head 5 -  Class Child Ref Key: 40
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   5.5"
.head 6 -  Top:    0.2"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 2097
.head 5 -  Class Child Ref Key: 41
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? No
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 42
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   8.1"
.head 6 -  Top:    0.2"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 2098
.head 5 -  Class Child Ref Key: 43
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? No
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 -  !
.head 4 +  Pushbutton: pbTicket
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbOk
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   6.6"
.head 6 -  Top:    0.2"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \bars98\RESOURCE\BMP\EDIT.BMP
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Роздрукувати тікет'
.head 6 +  On SAM_Click
.head 7 +  If ID
.head 8 -  Call PrintTicket()
.head 4 +  Pushbutton: pb_Opl
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbExecute
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   7.05"
.head 6 -  Top:    0.2"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Виконати платежі'
.head 6 +  On SAM_Click
.head 7 -  Call Pay()
.head 7 -  Call SalSendMsg(pbRefresh, SAM_Click, 0, 0)
.head 4 +  Pushbutton: pbArch
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbBrowse
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   7.5"
.head 6 -  Top:    0.2"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Архів всіх документів'
.head 7 -  Set bArch = TRUE
.head 6 +  On SAM_Click
.head 7 +  If bArch
.head 8 -  Call SalHideWindow(ND)
.head 8 -  Call SalHideWindow(VOB_NAME)
.head 8 -  Set Tbl_DCP.strSqlPopulate = sSel || sOrd
.head 8 -  Set strTip = IifS(nPar=1, 'Прийняті документи', 'Необроблені документи')
.head 7 +  Else
.head 8 -  Call SalShowWindow(ND)
.head 8 -  Call SalShowWindow(VOB_NAME)
.head 8 +  If nPar = 1 AND sFileList = ""
.head 9 -  Set Tbl_DCP.strSqlPopulate = ""
.head 8 +  Else
.head 9 -  Set Tbl_DCP.strSqlPopulate = sSel || sWhere || 
IifS(nPar=1, IifS(sFileList="", "", " AND substr(DCP_P.FN,2,11) in (" || sFileList || ")"), "") || sOrd
.head 8 -  Set strTip = 'Архів всіх документів'
.head 7 -  Set bArch = NOT bArch
.head 7 -  Call SalSendMsg(pbRefresh, SAM_Click, 0, 0)
.head 2 +  Contents
.head 3 +  Column: REF
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Реф
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Right
.head 4 -  Width:  0.8"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: ND
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: № док.
.head 4 -  Visible? Yes
.head 4 -  Editable? Yes
.head 4 -  Maximum Data Length: 10
.head 4 -  Data Type: String
.head 4 -  Justify: Right
.head 4 -  Width:  1.0"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: VOB
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Visible? No
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Left
.head 4 -  Width:  Default
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: VOB_NAME
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Вид док.
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  2.0"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 +  Message Actions
.head 5 +  On SAM_DoubleClick
.head 6 -  Set nSelectVob = VOB
.head 6 -  Set sSelectVob = VOB_NAME
.head 6 +  If SalModalDialog(dlg_SelectVob, hWndForm, IifS(MFOA=MFOB, sTt1, sTt2), nSelectVob, sSelectVob)
.head 7 -  Set VOB = nSelectVob
.head 7 -  Set VOB_NAME = sSelectVob
.head 3 +  Column: MFOA
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: МФО-А
.head 4 -  Visible? No
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Right
.head 4 -  Width:  0.867"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: MDOA
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: МДО-А
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: 9
.head 4 -  Data Type: String
.head 4 -  Justify: Right
.head 4 -  Width:  0.8"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: NLSA
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Рах-A
.head 4 -  Visible? Yes
.head 4 -  Editable? Yes
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  1.4"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value: 1
.head 6 -  Uncheck Value: 0
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 +  Message Actions
.head 5 +  On SAM_SetFocus
.head 6 +  If REF != NUMBER_Null
.head 7 -  Call SalSetFocus(pbFilter)
.head 5 +  On SAM_Validate
.head 6 +  If REF = NUMBER_Null
.head 7 +  If NOT SqlPrepareAndExecute(  hSqlAux2(),
"SELECT substr(a.nms,1,38), a.acc, c.okpo 
 INTO :Tbl_DCP.NAMA, :Tbl_DCP.ACC, :Tbl_DCP.OKPOA 
 FROM accounts a, cust_acc b, customer c 
 WHERE a.kv=:nBaseVal AND a.nls=:Tbl_DCP.NLSA AND a.dazs is null AND 
       a.acc=b.acc AND b.rnk=c.rnk")
OR NOT SqlFetchNext(hSqlAux2(), nFetchRes)
.head 8 -  Set Tbl_DCP.NLSA = ''
.head 7 +  If Tbl_DCP.NLSA = ''
.head 8 -  Set Tbl_DCP.ACC = NUMBER_Null
.head 8 -  Set Tbl_DCP.NAMA = ''
.head 7 -  Call SqlPrepareAndExecute( hSql(),
   "UPDATE dcp_p set acc=:Tbl_DCP.ACC, okpoa=:Tbl_DCP.OKPOA 
    WHERE ID=:Tbl_DCP.ID")
.head 7 -  Call SqlCommitEx( hSqlAux2(),'')
.head 3 +  Column: NAMA
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Платник
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  2.0"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value: 1
.head 6 -  Uncheck Value: 0
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: OKPOA
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: ОКПО-А
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Right
.head 4 -  Width:  1.0"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: MFOB
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: МФО-Б
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Right
.head 4 -  Width:  0.8"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: MDOB
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: МДО-Б
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: 9
.head 4 -  Data Type: String
.head 4 -  Justify: Right
.head 4 -  Width:  0.8"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: NLSB
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Рах-Б
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  1.4"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value: 1
.head 6 -  Uncheck Value: 0
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: NAMB
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Отримувач
.head 4 -  Visible? Yes
.head 4 -  Editable? Yes
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  2.0"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value: 1
.head 6 -  Uncheck Value: 0
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: OKPOB
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: ОКПО-Б
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Right
.head 4 -  Width:  1.0"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: S
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Сума пл
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Right
.head 4 -  Width:  1.5"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Decimal
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: NAZN
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Призначення пл
.head 4 -  Visible? Yes
.head 4 -  Editable? Yes
.head 4 -  Maximum Data Length: 160
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  3.0"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 +  Message Actions
.head 5 +  On SAM_DoubleClick
.head 6 +  If REF = NUMBER_Null
.head 7 -  Set lsTmp = NAZN
.head 7 -  Call SalModalDialog(dlg_MemoEditor, hWndForm, 'Редагування призначення пдатежу', lsTmp)
.head 7 -  Set NAZN = Subs(SalStrTrimX(lsTmp), 1, 160)
.head 3 -  !
.head 3 +  Column: ID_UG
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Ном.оп.
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: 8
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  0.8"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: DAT_UG
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Дата розр.
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Date/Time
.head 4 -  Justify: Center
.head 4 -  Width:  1.1"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Date
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: N_UG
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Ном. уг.
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: 30
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  0.8"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: D_UG
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Дата уг.
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Date/Time
.head 4 -  Justify: Center
.head 4 -  Width:  1.0"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Date
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: OZN_SP
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Признак
.head 4 -  Visible? No
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: 16
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  0.883"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: FN
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Файл &P
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  1.4"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: ID
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: ROWID
.head 4 -  Visible? No
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Left
.head 4 -  Width:  1.233"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: ACC
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: ACC
.head 4 -  Visible? No
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Left
.head 4 -  Width:  1.233"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 2 +  Functions
.head 3 +  Function: Klient1_PL  ! Цикл по пакетам 
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sMaska
.head 5 -  String: smMass[*]
.head 5 -  Number: nFileCount
.head 5 -  Number: nTek
.head 5 -  String: sFileName
.head 4 +  Actions
.head 5 +  If IsBankDayOpen()
.head 6 -  ! обработка файлов из основной дир.
.head 6 -  Set sMaska = strPathDCP_In || '\\&P' || sBankSAB || '**.***'
.head 6 -  Call SalArraySetUpperBound(smMass, 1, -1)
.head 6 -  Set nFileCount = VisDosEnumFiles(sMaska, FA_Standard, smMass)
.head 6 -  Set Tbl_DCP.strSqlPopulate = ""
.head 6 -  Set sFileList = ""
.head 6 +  If nFileCount > 0 ! обработка файлов
.head 7 -  Set nTek = 0
.head 7 +  While nTek < nFileCount
.head 8 -  Set sFileName = smMass[nTek]
.head 8 -  Set sFileList = IifS(sFileList="", "'" || Subs(sFileName,2,11) || "'", sFileList || ",'" || Subs(sFileName,2,11) || "'")
.head 8 -  Call SaveInfoToLog('DCP. Прием файла ' || sFileName)
.head 8 -  ! Принимаем файл
.head 8 +  If NOT Kontrol1(sFileName)
.head 9 -  Call SaveInfoToLog('DCP. Файл ' || sFileName || ' НЕ принят')
.head 8 +  Else
.head 9 -  Call SaveInfoToLog('DCP. Файл ' || sFileName || ' принят')
.head 8 -  Set nTek = nTek + 1
.head 6 +  Else
.head 7 -  Call MessageNoWait('Немає файлів &P' || sBankSAB || '*.* у ' || strPathDCP_In, 'Інформація', 5, 0)
.head 6 -  If nPar = 1 and sFileList = ""
.head 6 +  Else
.head 7 -  Set Tbl_DCP.strSqlPopulate = sSel || sWhere || 
IifS(nPar=1, IifS(sFileList="", "", " AND substr(DCP_P.FN,2,11) in (" || sFileList || ")"), "") || sOrd
.head 5 -  Return TRUE
.head 3 +  Function: Kontrol1    ! контроль 1-го пакета (Сухова)
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sFile
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  String: sErrMes
.head 5 -  Number: hF
.head 5 -  String: sTmp
.head 5 -  Date/Time: dDatFile
.head 5 -  String: sFN
.head 5 -  !
.head 5 -  Number: nSos1
.head 5 -  Number: nSos5
.head 5 -  Number: nRef
.head 5 -  String: sStornoReasonId
.head 5 -  String: sStornoReason
.head 5 -  Number: nCheckId
.head 5 -  Number: nRefCount
.head 5 -  Number: nmRef[*]
.head 5 -  Number: i
.head 5 -  Boolean: bOk1
.head 4 +  Actions
.head 5 -  Set bOk = FALSE
.head 5 -  Set sErrMes = ''
.head 5 +  Loop
.head 6 -  Set hF = llopen(strPathDCP_In || '\\' || sFile, 0)
.head 6 +  If hF <= 0
.head 7 -  Set sErrMes = 'Невозможно открыть'
.head 7 -  Break
.head 6 -  ! == Ош.Имени файла / в заголовке
.head 6 -  ! читаем имя файла
.head 6 -  Set sTmp = Spac(12)
.head 6 -  Call lllseek(hF, 102, FILE_SeekBegin)
.head 6 -  Call llread(hF, sTmp, 12)
.head 6 +  If SalStrUpperX(sTmp) != SalStrUpperX(sFile)
.head 7 -  Set sErrMes = 'Ош.Имени /в заголовке ' || sTmp
.head 7 -  Break
.head 6 -  ! == Файл уже принимался?
.head 6 -  ! читаем дату файла
.head 6 -  Set sTmp = Spac(10)
.head 6 -  Call lllseek(hF, 114, FILE_SeekBegin)
.head 6 -  Call llread(hF, sTmp, 10)
.head 6 -  Set dDatFile = SalDateConstruct( 2000+Val(Subs(sTmp,1,2)), Val(Subs(sTmp,3,2)), Val(Subs(sTmp,5,2)), 
    Val(Subs(sTmp,7,2)), Val(Subs(sTmp,9,2)), 0 )
.head 6 -  Call SqlPrepareAndExecute(hSql(), 
"SELECT fn INTO :sFN
   FROM dcp_zag 
  WHERE upper(fn) = upper('" || sFile || "')
    and dat = :dDatFile" )
.head 6 +  If SqlFetchNext(hSql(), nFetchRes)
.head 7 -  Call SaveInfoToLog('DCP. Файл ' || sFile || ': Прийняти повторно?')
.head 7 +  If IDYES = SalMessageBox('Файл ' || sFile || ' вже було прийнято раніше.' || PutCrLf() ||
   'Прийняти файл повторно?', 'Увага!', MB_IconQuestion|MB_YesNo)
.head 8 -  Call SaveInfoToLog('DCP. Файл ' || sFile || ' принимается повторно')
.head 8 -  ! Есть платежи по файлу?
.head 8 -  Call SqlPrepareAndExecute(hSql(), 
"SELECT count(p1.ref), count(p5.ref) INTO :nSos1, :nSos5 
 FROM dcp_p d, oper p1, oper p5 
 WHERE upper(d.fn) = upper('" || sFile || "') 
   and dat = :dDatFile
   and d.ref=p1.ref(+) AND p1.sos(+)=1 AND d.ref=p5.ref(+) AND p5.sos(+)=5")
.head 8 +  If SqlFetchNext(hSql(), nFetchRes)
.head 9 -  ! Если документ оплачен, повторно не принимаем
.head 9 +  If nSos5 > 0
.head 10 -  Call SalMessageBox('Файл ' || sFile || ' не може бути прийнято повторно - документ вже оплачено.', 'Увага!', MB_IconStop | MB_Ok)
.head 10 -  Call SaveInfoToLog('DCP. Файл ' || sFile || ' не може бути прийнято повторно - документ вже оплачено.')
.head 10 -  Break
.head 9 -  ! Неоплаченные документы можно сторнировать
.head 9 +  If nSos1 > 0
.head 10 -  Call SaveInfoToLog('DCP. Файл ' || sFile || ': Виконати BACK-операції для введених(не оплачених) платежів?')
.head 10 +  If IDYES = SalMessageBox('Виконати BACK-операції для введених(не оплачених) платежів?', 'Увага!', MB_IconQuestion|MB_YesNo) 
.head 11 -  Set sStornoReasonId = ''
.head 11 -  Set sStornoReason = ''
.head 11 +  If FunNSIGet('BP_REASON', '', sStornoReasonId,  sStornoReason)
.head 12 +  If sStornoReasonId
.head 13 -  Set bOk1 = FALSE
.head 13 -  Set nCheckId = GetGlobalOptionEx('BACKVISA')
.head 13 -  ! Сторнируем все документы
.head 13 -  Set nRefCount = 0
.head 13 -  Call SqlPrepareAndExecute(hSql(), 
"SELECT p.ref INTO :nRef FROM dcp_p d, oper p 
 WHERE upper(d.fn)=upper('" || sFile || "') 
   and dat = :dDatFile
   AND d.ref=p.ref AND p.sos<5 AND p.sos>0")
.head 13 +  While SqlFetchNext(hSql(), nFetchRes)
.head 14 -  Set nmRef[nRefCount] = nRef
.head 14 -  Set nRefCount = nRefCount + 1
.head 13 +  If nRefCount > 0 
.head 14 -  Set i = 0
.head 14 +  While i < nRefCount
.head 15 +  If NOT DocumentStorno(nmRef[i], 5, Val(sStornoReasonId), nCheckId, 0)
.head 16 -  Call SalMessageBox('Невозможно выполнить операцию изъятия, REF' || Str(nmRef[i]), 'Внимание!', MB_IconStop|MB_Ok)
.head 16 -  Call SaveInfoToLog('DCP. Невозможно выполнить операцию изъятия, REF' || Str(nmRef[i]))
.head 16 -  Break
.head 15 -  Call SaveFInfoToLog('DCP. Выполнено изъятие операции, REF' || Str(nRef) )
.head 15 -  Set bOk1 = TRUE
.head 15 -  Set i = i + 1
.head 13 +  If bOk1
.head 14 +  If NOT DeleteFromDCP(hSql(), sFile, dDatFile)
.head 15 -  Break
.head 13 +  Else
.head 14 -  Break
.head 12 +  Else
.head 13 -  Call SalMessageBox('Файл ' || sFile || ' не прийнято!', 'Повідомлення', MB_IconStop|MB_Ok)
.head 13 -  Call SaveInfoToLog('DCP. Отказ от повторного приема файла ' || sFile)
.head 13 -  Break
.head 11 +  Else
.head 12 -  Call SalMessageBox('Файл ' || sFile || ' не прийнято!', 'Повідомлення', MB_IconStop|MB_Ok)
.head 12 -  Call SaveInfoToLog('DCP. Отказ от повторного приема файла ' || sFile)
.head 12 -  Break
.head 10 +  Else
.head 11 -  Call SalMessageBox('Файл ' || sFile || ' не прийнято!', 'Повідомлення', MB_IconStop | MB_Ok)
.head 11 -  Call SaveInfoToLog('DCP. Отказ от повторного приема файла ' || sFile)
.head 11 -  Break
.head 9 -  ! ? Просто удаляем...
.head 9 +  Else
.head 10 +  If NOT DeleteFromDCP(hSql(), sFile, dDatFile)
.head 11 -  Break
.head 8 -  ! Если платежей нет, удаляем информацию о файле для повторного приема
.head 8 +  Else
.head 9 +  If NOT DeleteFromDCP(hSql(), sFile, dDatFile)
.head 10 -  Break
.head 7 -  ! Не принимать файл повторно
.head 7 +  Else
.head 8 -  Call SaveInfoToLog('DCP. Отказ от повторного приема файла ' || sFile)
.head 8 -  Break
.head 6 -  ! == сохраняем инф. о файле в БД
.head 6 +  If NOT SqlPrepareAndExecute(hSql(), "INSERT INTO dcp_zag(fn,dat) VALUES(upper(:sFile),:dDatFile)")
.head 7 -  Call SqlRollbackEx(hSql(), 'DCP. Файл ' || sFile || ' не принят: Не удалось сохранить информацию о файле')
.head 7 -  Break
.head 6 -  ! == обрабатываем файл
.head 6 +  If not Paket1(hF, sFile, dDatFile)
.head 7 -  Set sErrMes = 'Ош. '
.head 7 -  Break
.head 6 -  Set bOk = TRUE
.head 6 -  Break
.head 5 +  If NOT bOk
.head 6 -  Call llclose(hF)
.head 6 +  If sErrMes
.head 7 -  Call MessageError('Файл ' || sFile || ': ' || sErrMes )
.head 5 -  Return bOk
.head 3 +  Function: Paket1      ! Обработка 1-го пакета
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: hF
.head 5 -  String: sFile
.head 5 -  Date/Time: dDatFile
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sTmp
.head 5 -  Number: nKol
.head 5 -  Number: nTek
.head 5 -  Number: nT
.head 5 -  String: sT
.head 5 -  !
.head 5 -  String: MFOA
.head 5 -  String: MDOA
.head 5 -  String: MFOB
.head 5 -  String: MDOB
.head 5 -  String: NLSB
.head 5 -  String: OKPOB
.head 5 -  Number: S
.head 5 -  String: ID_UG
.head 5 -  Date/Time: DAT_UG
.head 5 -  String: OZN_SP
.head 5 -  String: OKPOA
.head 5 -  String: N_UG
.head 5 -  Date/Time: D_UG
.head 5 -  String: sRezerv
.head 5 -  Number: nAcc
.head 5 -  File Handle: hFile
.head 5 -  Number: nLStr
.head 4 +  Actions
.head 5 -  Call lllseek(hF, 124, FILE_SeekBegin)
.head 5 -  Set sTmp = Spac(6)
.head 5 -  Call llread(hF, sTmp, 6)
.head 5 -  Set nKol = Val(sTmp)
.head 5 -  Set nTek = 0
.head 5 +  While nTek < nKol
.head 6 -  Set sTmp = Spac(200)
.head 6 -  Call lllseek(hF, 362+312*nTek, FILE_SeekBegin)
.head 6 -  Call llread(hF, sTmp, 200)
.head 6 -  Set MFOA = SalStrTrimX(Left(sTmp, 9))
.head 6 -  Set MDOA = Subs(sTmp, 10, 9)
.head 6 -  Set MFOB = SalStrTrimX(Subs(sTmp, 19, 9))
.head 6 -  Set MDOB = Subs(sTmp, 28, 9)
.head 6 -  Set NLSB = SalStrTrimX(Subs(sTmp, 37, 14))
.head 6 -  Set OKPOB = SalStrTrimX(Subs(sTmp, 51, 14))
.head 6 -  Set S = Val(Subs(sTmp, 65, 16))
.head 6 -  Set ID_UG = Subs(sTmp, 81, 8)
.head 6 -  Set DAT_UG = SalDateConstruct(Val(Subs(sTmp, 89, 4)), Val(Subs(sTmp, 93, 2)),
    Val(Subs(sTmp, 95, 2)), 0, 0, 0)
.head 6 -  Set OZN_SP = Subs(sTmp, 97, 16)
.head 6 -  Set OKPOA = SalStrTrimX(Subs(sTmp, 113, 14))
.head 6 -  ! 15 молодших символів (з 1-го по 15-й) номера договору, як і раніше, міститимуться в позиціях  127-141 інформаційного рядка;
.head 6 -  ! 15 старших символів номера договору (з 16-го по 30-й) міститимуться в позиціях 170-184, які раніше належали полю "Резерв".
.head 6 -  Set N_UG  = Subs(sTmp, 127, 15) || Subs(sTmp, 170, 15)
.head 6 -  Set D_UG  = SalDateConstruct(Val(Subs(sTmp, 142, 4)), Val(Subs(sTmp, 146, 2)),
    Val(Subs(sTmp, 148, 2)), 0, 0, 0)
.head 6 -  Set sRezerv = Subs(sTmp, 150, 91)
.head 6 -  Set nAcc = NUMBER_Null
.head 6 +  If sDefAcc and OKPOA != ''
.head 7 +  If SqlPrepareAndExecute(hSqlAux2(),
"select acc INTO :nAcc
  from accounts a, customer c
 where a.rnk = c.rnk
   and c.okpo = :OKPOA
   and a.nls like :sDefAcc and a.kv = :nBaseVal and a.dazs is null
   and rownum = 1")
.head 8 -  Call SqlFetchNext(hSqlAux2(), nFetchRes)
.head 6 +  If NOT SqlPrepareAndExecute(hSql(), 
"INSERT INTO dcp_p(MFOA,MDOA,MFOB,MDOB,NLSB,OKPOB,S,ID_UG,DAT_UG,OZN_SP,FN,DAT,OKPOA,N_UG,D_UG, ACC, reserve)
 VALUES(:MFOA,:MDOA,:MFOB,:MDOB,:NLSB,:OKPOB,:S,:ID_UG,:DAT_UG,:OZN_SP,upper(:sFile),:dDatFile,:OKPOA,:N_UG,:D_UG, :nAcc, :sRezerv)")
.head 7 -  Call SqlRollbackEx(hSql(), 'DCP. Файл ' || sFile || ' не принят: Не удалось сохранить информацию о платежах')
.head 7 -  Return FALSE
.head 6 -  Set nTek = nTek + 1
.head 5 -  Call llclose(hF)
.head 5 -  Call SqlCommitEx(hSql(), 'DCP. Принят файл ' || sFile)
.head 5 -  ! 0 = OK
.head 5 +  If 0 = SalFileCopy(strPathDCP_In || '\\' || sFile, strBackUpDir || '\\' || sFile, TRUE)
.head 6 -  Call VisFileSetAttribute(strPathDCP_In || '\\' || sFile, FA_ReadOnly, FALSE)
.head 6 -  Call SalFileOpen(hFile, strPathDCP_In || '\\' || sFile, OF_Delete)
.head 5 -  Call SalStatusSetText(hWndForm, '')
.head 5 -  Return TRUE
.head 3 +  Function: DeleteFromDCP
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Sql Handle: hSql_
.head 5 -  String: sFN
.head 5 -  Date/Time: dFD
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If NOT SqlPrepareAndExecute(hSql_, 
"DELETE FROM dcp_p WHERE fn=upper('" || sFN || "') and dat = :dFD" )
.head 6 -  Call SqlRollbackEx(hSql_, 'DCP. Не удалось удалить информацию по файлу ' || sFN)
.head 6 -  Call SalMessageBox('Не удалось удалить информацию по файлу ' || sFN, 'Внимание!', MB_IconStop | MB_Ok)
.head 6 -  Return FALSE
.head 5 +  If NOT SqlPrepareAndExecute(hSql_, 
"DELETE FROM dcp_zag WHERE fn=upper('" || sFN || "') and dat = :dFD" )
.head 6 -  Call SqlRollbackEx(hSql_, 'DCP. Не удалось удалить информацию по файлу ' || sFN)
.head 6 -  Call SalMessageBox('Не удалось удалить информацию по файлу ' || sFN, 'Внимание!', MB_IconStop | MB_Ok)
.head 6 -  Return FALSE
.head 5 -  Call SqlCommitEx(hSql_, 'DCP. Удалена информация по файлу ' || sFN)
.head 5 -  Return TRUE
.head 3 +  Function: Pay
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  Number: nRow
.head 5 -  Number: nRef
.head 5 -  String: sDrec
.head 5 -  String: sTT
.head 5 -  Number: nPrty
.head 4 +  Actions
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  Set bOk = TRUE
.head 5 -  Set nRow = TBL_MinRow
.head 5 +  While SalTblFindNextRow(hWndForm, nRow, 0, 0)
.head 6 -  Call SalTblSetContext(hWndForm, nRow)
.head 6 +  If REF= NUMBER_Null AND ACC != NUMBER_Null
.head 7 -  Set nRef = NUMBER_Null
.head 7 -  Set sDrec = '#d' || MDOA || MDOB || ID_UG ||
            Str(SalDateYear(DAT_UG))||
            Right(Str(100+SalDateMonth(DAT_UG)),2)||
            Right(Str(100+SalDateDay  (DAT_UG)),2)||
            OZN_SP||'#'
.head 7 -  Set sTT   = IifS(MFOA=MFOB, sTt1, sTt2)
.head 7 -  Set nPrty = IifN(MFOA=MFOB, 0, 3)
.head 7 -  ! nPrty=3 для $A
.head 7 -  Call ccDoc.SetDoc(nRef, sTT, 1, IifN(VOB=NUMBER_Null, 6, VOB), ND, dDAT, dDAT, dDAT, dDAT, 
     NLSA, NAMA, MFOA, '', nBaseVal, S*100, OKPOA, 
     NLSB, NAMB, MFOB, '', nBaseVal, S*100, OKPOB, 
     NAZN, sDrec, GetIdOper(), '', NUMBER_Null, nPrty)
.head 7 -  Set ccDoc.m_sDrec = sDrec
.head 7 +  If NOT (ccDoc.oDoc() AND SqlPrepareAndExecute(hSqlAux2(), 
"UPDATE dcp_p set ref=:ccDoc.m_nRef WHERE ID=:Tbl_DCP.ID"))
.head 8 -  Call SqlRollbackEx(hSqlAux2(), 'DCP. Невозможно оплатить документ!')
.head 8 -  Call SalMessageBox('Неможливо оплатити документ!', 'Помилка!', MB_IconExclamation)
.head 8 -  Set bOk = FALSE
.head 8 -  Break
.head 7 -  Set REF = ccDoc.m_nRef
.head 7 -  Call SqlCommitEx(hSqlAux2(), 'DCP. Оплачен документ на сумму ' || Str(S*100) || ' (REF ' || Str(REF) || ')')
.head 5 -  Call SalWaitCursor(FALSE)
.head 5 -  Return bOk
.head 3 +  Function: DelStr
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nRow
.head 4 +  Actions
.head 5 -  Set nRow = TBL_MinRow
.head 5 +  While SalTblFindNextRow(hWndForm, nRow, ROW_Selected, 0)
.head 6 -  Call SalTblSetContext(hWndForm, nRow)
.head 6 +  If SqlPrepareAndExecute(hSql(), "DELETE from dcp_p WHERE ref is null AND id=:Tbl_DCP.ID" ) 
.head 7 -  Call SqlCommitEx(hSql(), 'DCP. Удалена строка из DCP_P ' || Tbl_DCP.FN )
.head 6 +  Else
.head 7 -  Call SqlRollback(hSql())
.head 5 -  Return TRUE
.head 3 +  Function: PrintTicket
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sVars
.head 5 -  String: sVals
.head 5 -  String: strTempl
.head 5 -  String: strReport
.head 4 +  Actions
.head 5 -  Set strTempl  = GetTemplateDir() || '\\' || sTemplateName || '.qrd'
.head 5 -  Set strReport = GetPrnDir() || '\\dcp'||SalFmtFormatDateTime(SalDateCurrent() ,'hhhmmss') || '.txt'
.head 5 -  !
.head 5 +  If not SqlPLSQLCommand(hSql(), "dcp.get_print_value(ID, sTemplateName, sVars, sVals)")
.head 6 -  Return FALSE
.head 5 -  Set sVars = sVars || '~MFOA~MDOA~MFOB~MDOB~NLSB~OKPOB~S~ID_UG~DAT_UG~OZN_SP~OKPOA~N_UG~D_UG~NAZN'
.head 5 -  Set sVals = sVals || '~' || MFOA || '~' || MDOA || '~' || MFOB || '~' || MDOB || '~' || NLSB || '~' || OKPOB || '~' ||
    Str(S) || '~' || ID_UG || '~' || SalFmtFormatDateTime(DAT_UG,'dd/MM/yyyy') || '~' || OZN_SP || '~' || OKPOA || '~' || N_UG || '~' ||
    SalFmtFormatDateTime(D_UG,'dd/MM/yyyy') || '~' || VisStrSubstitute(NAZN, '~', '`')
.head 5 -  !
.head 5 +  If DosReport(strTempl, strReport, sVars, sVals, 0)
.head 6 -  Call SalMessageBox('Сформовано файл ' || strReport, 'Повідомлення', MB_Ok)
.head 5 -  Return TRUE
.head 2 +  Window Parameters
.head 3 -  Number: nMode
.head 3 -  Number: nPar	! 1-прием файла &P, 2-обработка, 3-всё
.head 3 -  String: strPar01
.head 3 -  String: strPar02
.head 2 +  Window Variables
.head 3 -  Number: nInterval
.head 3 -  String: strPathDCP_In
.head 3 -  String: strBackUpDir
.head 3 -  !
.head 3 -  Number: nBaseVal
.head 3 -  String: sBankSAB
.head 3 -  String: sDefAcc
.head 3 -  String: sTt1
.head 3 -  String: sTt2
.head 3 -  Number: nVob1
.head 3 -  Number: nVob2
.head 3 -  String: sVob1
.head 3 -  String: sVob2
.head 3 -  Boolean: bArch
.head 3 -  String: sSel
.head 3 -  String: sWhere
.head 3 -  String: sOrd
.head 3 -  Number: nSos
.head 3 -  Number: nCol
.head 3 -  ! String: sNAZN
.head 3 -  : ccDoc
.head 4 -  Class: cDocDCP
.head 3 -  String: lsTmp
.head 3 -  !
.head 3 -  String: sFileList
.head 3 -  Number: nSelectVob
.head 3 -  String: sSelectVob
.head 3 -  String: sTemplateName
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SetWindowFullSize(hWndForm)
.head 4 -  Call SalUseRegistry(FALSE, '')
.head 4 -  Set nInterval = SalGetProfileInt(INI_ElektroKlients, 'DCP_Interval', 600, GetIniFileName())
.head 4 -  Call SalGetProfileString(INI_ElektroKlients, 'DCP_IN', '', strPathDCP_In, GetIniFileName())
.head 4 -  Call SalGetProfileString(INI_ElektroKlients, 'DCP_BackUpDir', '', strBackUpDir, GetIniFileName())
.head 4 -  Set nBaseVal = GetBaseVal()
.head 4 -  Set sBankSAB = GetBankSab()
.head 4 -  Set dDAT     = GetBankDate()
.head 4 -  Set sDefAcc  = GetValueStr("select val from dcp_params where par = 'DEF_ACC'")
.head 4 -  ! Set sNAZN    = 'Поставка проти оплати за ДЦП.'
.head 4 -  Set sTt1     = 'ЦП1'
.head 4 -  Set sTt2     = 'ЦП2'
.head 4 +  If NOT SqlPrepareAndExecute(hSql(), 
"SELECT a.vob, a.name INTO :nVob1, :sVob1 
   FROM vob a, tts_vob b 
  WHERE a.vob=b.vob and b.tt=:sTt1
  ORDER BY ord") 
OR NOT SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Set nVob1 = 6
.head 5 -  Set sVob1 = 'Меморiальний ордер'
.head 4 +  If NOT SqlPrepareAndExecute(hSql(), 
"SELECT a.vob, a.name INTO :nVob2, :sVob2 
   FROM vob a, tts_vob b 
  WHERE a.vob=b.vob and b.tt=:sTt2
  ORDER BY ord") 
OR NOT SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Set nVob2 = 6
.head 5 -  Set sVob2 = 'Меморiальний ордер'
.head 4 -  Call SqlPrepareAndExecute(hSql(), "select upper(val) into :sTemplateName from dcp_params where par = 'TEMPLATE_NAME'")
.head 4 +  If not SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Set sTemplateName = STRING_Null
.head 4 +  If not sTemplateName
.head 5 -  Call SalDisableWindow(pbTicket)
.head 4 -  !
.head 4 -  Set hWndForm.Tbl_DCP.strFilterTblName = 'DCP_P'
.head 4 -  Set hWndForm.Tbl_DCP.strPrintFileName = 'DCP_P'
.head 4 -  Set sSel = 
"SELECT DCP_P.MFOA,    DCP_P.MDOA,   DCP_P.MFOB,  DCP_P.MDOB,   DCP_P.NLSB, 
        DCP_P.OKPOB,   DCP_P.S/100,  DCP_P.ID_UG, DCP_P.DAT_UG, DCP_P.OZN_SP, 
        DCP_P.FN, substr(b.nb,1,38), DCP_P.acc,   DCP_P.ID,     DCP_P.ref, 
        DCP_P.OKPOA,   DCP_P.N_UG,   DCP_P.D_UG,
        substr(dcp.get_nazn_by_mask(dcp_p.id), 1, 160)
   INTO :Tbl_DCP.MFOA, :Tbl_DCP.MDOA,:Tbl_DCP.MFOB, :Tbl_DCP.MDOB,  :Tbl_DCP.NLSB, 
        :Tbl_DCP.OKPOB,:Tbl_DCP.S,   :Tbl_DCP.ID_UG,:Tbl_DCP.DAT_UG,:Tbl_DCP.OZN_SP, 
        :Tbl_DCP.FN,   :Tbl_DCP.NAMB,:Tbl_DCP.ACC,  :Tbl_DCP.ID,    :Tbl_DCP.REF, 
        :Tbl_DCP.OKPOA,:Tbl_DCP.N_UG,:Tbl_DCP.D_UG, :Tbl_DCP.NAZN
   FROM DCP_P, banks b 
  WHERE DCP_P.mfob=b.mfo "
.head 4 -  Set sWhere = " AND DCP_P.REF IS NULL "
.head 4 -  Set sOrd   = " ORDER BY DCP_P.MFOB, DCP_P.FN"
.head 4 +  If nPar = 1	! прием файла &P
.head 5 -  Call SalSetWindowText(hWndForm, 'ДЦП. Прийом файлів &P')
.head 5 -  Call SalDisableWindow(pb_Opl)
.head 5 -  Call SalDisableWindow(pbDel)
.head 5 -  Call SalDisableWindow(pbDetails)
.head 5 -  Call SalDisableWindow(pbFilter)
.head 5 -  Call SalDisableWindow(Tbl_DCP.NLSA)
.head 5 -  Call SalDisableWindow(Tbl_DCP.NAZN)
.head 5 -  Call SalHideWindow(hWndForm.Tbl_DCP.REF)
.head 5 -  Call SalHideWindow(hWndForm.Tbl_DCP.ND)
.head 5 -  Call SalHideWindow(hWndForm.Tbl_DCP.VOB_NAME)
.head 5 -  Call SalHideWindow(hWndForm.Tbl_DCP.NLSA)
.head 5 -  Call SalHideWindow(hWndForm.Tbl_DCP.NAMA)
.head 5 -  Set hWndForm.Tbl_DCP.strSqlPopulate = ""
.head 4 +  If nPar = 2	! обработка
.head 5 -  Call SalSetWindowText(hWndForm, 'ДЦП. Обробка прийнятих файлів &P')
.head 5 -  Call SalDisableWindow(pbRef)
.head 5 -  Set hWndForm.Tbl_DCP.strSqlPopulate = sSel || sWhere || sOrd
.head 4 +  If nPar = 3	! прием файла &P и обработка
.head 5 -  Call SalSetWindowText(hWndForm, 'ДЦП. Прийом і обробка файлів &P')
.head 5 -  Set hWndForm.Tbl_DCP.strSqlPopulate = sSel || sWhere || sOrd
.head 4 -  Call ShowApdVersion(hWndForm, AppForm_DCP)
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 4 -  Call SalSendClassMessage(SAM_Create, 0, 0)
.head 3 +  On SAM_User
.head 4 -  Call SalWaitCursor(TRUE)
.head 4 -  Call pbRef.Kill()
.head 4 -  Set dTime = SalDateCurrent()
.head 4 -  Call Klient1_PL()
.head 4 -  Call SalSendMsg(pbRefresh, SAM_Click, 0, 0)
.head 4 -  Call pbRef.Init(nInterval, 0, TRUE)
.head 4 -  Call SalWaitCursor(FALSE)
.head 3 +  On UM_Populate
.head 4 -  Call SalTblReset(hWndForm)
.head 4 +  If strSqlPopulate != ''
.head 5 -  Call cQ.Init(strSqlPopulate)
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  Call SalTblDefineSplitWindow(hWndForm, 0, FALSE)
.head 5 -  Set strDSql = cQ.GetFullSQLString(cF)
.head 5 -  Call SalTblPopulate(hWndForm, cMain.hSql(), T(strDSql), TBL_FillAll)
.head 5 -  Call SalTblSetContext(hWndForm, 0)
.head 5 -  Call SalPostMsg(hWndForm, SAM_TblDoDetails, 0, 0)
.head 5 -  Call SalWaitCursor(FALSE)
.head 3 +  On SAM_FetchRowDone
.head 4 +  If ACC != NUMBER_Null
.head 5 +  If SqlPrepareAndExecute(hSqlAux2(), "SELECT nls, substr(nms,1,38) INTO :NLSA, :NAMA FROM accounts WHERE acc=:ACC")
.head 6 -  Call SqlFetchNext(hSqlAux2(), nFetchRes)
.head 4 +  If MFOA = MFOB
.head 5 +  If SalIsNull(REF)
.head 6 -  Set VOB = nVob1
.head 6 -  Set VOB_NAME = sVob1
.head 5 +  If SqlPrepareAndExecute(hSqlAux2(), "SELECT substr(nms,1,38) INTO :NAMB FROM accounts WHERE kv=:nBaseVal AND nls=:NLSB AND dazs is null")
.head 6 -  Call SqlFetchNext(hSqlAux2(), nFetchRes) 
.head 4 +  Else
.head 5 +  If SalIsNull(REF)
.head 6 -  Set VOB = nVob2
.head 6 -  Set VOB_NAME = sVob2
.head 4 +  If REF != NUMBER_Null
.head 5 +  If SqlPrepareAndExecute(hSqlAux2(), "SELECT sos INTO :nSos FROM oper WHERE ref=:REF")
.head 6 -  Call SqlFetchNext(hSqlAux2(), nFetchRes)
.head 6 +  If nSos = 1
.head 7 -  Set nCol = COLOR_DarkGreen
.head 6 +  Else If nSos = 5
.head 7 -  Set nCol = COLOR_Black
.head 6 +  Else If nSos = 3
.head 7 -  Set nCol = COLOR_DarkBlue
.head 6 +  Else If nSos < 0
.head 7 -  Set nCol = COLOR_Red
.head 6 +  Else
.head 7 -  Set nCol = COLOR_DarkGray
.head 5 -  Call SalTblSetCellTextColor(ID_UG,nCol,FALSE)
.head 5 -  Call SalTblSetCellTextColor(DAT_UG,nCol,FALSE)
.head 5 -  Call SalTblSetCellTextColor(N_UG,nCol,FALSE)
.head 5 -  Call SalTblSetCellTextColor(D_UG,nCol,FALSE)
.head 5 -  Call SalTblSetCellTextColor(S,nCol,FALSE)
.head 5 -  Call SalTblSetCellTextColor(REF,nCol,FALSE)
.head 5 -  Call SalTblSetCellTextColor(MFOA,nCol,FALSE)
.head 5 -  Call SalTblSetCellTextColor(MDOA,nCol,FALSE)
.head 5 -  Call SalTblSetCellTextColor(NLSA,nCol,FALSE)
.head 5 -  Call SalTblSetCellTextColor(NAMA,nCol,FALSE)
.head 5 -  Call SalTblSetCellTextColor(OKPOA,nCol,FALSE)
.head 5 -  Call SalTblSetCellTextColor(MFOB,nCol,FALSE)
.head 5 -  Call SalTblSetCellTextColor(MDOB,nCol,FALSE)
.head 5 -  Call SalTblSetCellTextColor(NLSB,nCol,FALSE)
.head 5 -  Call SalTblSetCellTextColor(NAMB,nCol,FALSE)
.head 5 -  Call SalTblSetCellTextColor(OKPOB,nCol,FALSE)
.head 4 +  ! Else
.head 5 -  Set NAZN = sNAZN || ' Угода ' || SalStrTrimX(N_UG) || 
' Дата ' || Right(Str(100+SalDateDay  (D_UG)),2) || '/' ||
            Right(Str(100+SalDateMonth(D_UG)),2) || '/' ||
                  Str(SalDateYear(D_UG))
.head 3 +  On SAM_Close
.head 4 -  Call pbRef.Kill()
.head 1 +  Dialog Box: dlg_MemoEditor
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   0.975"
.head 4 -  Top:    1.354"
.head 4 -  Width:  11.133"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 5.512"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Multiline Field: mlEditor
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 10000
.head 5 -  String Type: Long String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Border? Yes
.head 5 -  Word Wrap? Yes
.head 5 -  Vertical Scroll? Yes
.head 5 -  Window Location and Size
.head 6 -  Left:   -0.017"
.head 6 -  Top:    -0.012"
.head 6 -  Width:  11.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 5.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Courier New
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 4 -  Message Actions
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: Title
.head 3 -  Receive Long String: SQLText
.head 2 -  Window Variables
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalSetWindowText( dlg_MemoEditor, Title )
.head 4 -  Call SalCenterWindow( dlg_MemoEditor )
.head 4 -  Set mlEditor=SQLText
.head 3 +  On SAM_Close
.head 4 -  Set SQLText=mlEditor
.head 1 +  Dialog Box: dlg_SelectVob
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Вибір
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  5.9"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 2.35"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 -  Group Box: Виберіть вид документу
.head 4 -  Resource Id: 23867
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.2"
.head 5 -  Top:    0.1"
.head 5 -  Width:  5.4"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 1.0"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Combo Box: cmbVob
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cGenComboBox_NumId
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.4"
.head 5 -  Top:    0.4"
.head 5 -  Width:  5.0"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 1.036"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Editable? Class Default
.head 4 -  String Type: Class Default
.head 4 -  Maximum Data Length: Class Default
.head 4 -  Sorted? Class Default
.head 4 -  Always Show List? Class Default
.head 4 -  Vertical Scroll? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Input Mask: Class Default
.head 4 -  List Initialization
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 +  If cmbVob.Init(hWndItem)
.head 7 -  Call cmbVob.Populate(hSql(), "vob", "name", "vob", 
"WHERE vob in (select vob from tts_vob where tt='" || sTt || "') ORDER BY vob")
.head 7 -  Call cmbVob.SetSelectById(nVob)
.head 5 +  On SAM_Click
.head 6 -  Call SalSendClassMessage(SAM_Click, 0, 0)
.head 3 -  Frame
.head 4 -  Resource Id: 23868
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.2"
.head 5 -  Top:    1.2"
.head 5 -  Width:  5.4"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.7"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Border Color: 3D Shadow Color
.head 4 -  Background Color: Default
.head 3 +  Pushbutton: pbOk
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cpbOk
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Вибрати
.head 4 -  Window Location and Size
.head 5 -  Left:   2.65"
.head 5 -  Top:    1.3"
.head 5 -  Width:  Class Default
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set nVob = cmbVob.nCurrentId
.head 6 -  Set sVob = cmbVob
.head 6 -  Call SalEndDialog(hWndForm, TRUE)
.head 3 +  Pushbutton: pbCancel
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cpbCancel
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Відмінити
.head 4 -  Window Location and Size
.head 5 -  Left:   4.1"
.head 5 -  Top:    1.3"
.head 5 -  Width:  Class Default
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalEndDialog(hWndForm, FALSE)
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: sTt
.head 3 -  Receive Number: nVob
.head 3 -  Receive String: sVob
.head 2 -  Window Variables
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 4 -  Call SalSetFocus(pbCancel)
.head 1 +  Table Window: Tbl_DCPA		! 02 - ДЦП. Формирование &A
.head 2 -  Class: cGenericTable
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: ДЦП. Формування файлів А, прийом квитанцій Т
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? Class Default
.head 2 -  Visible? Class Default
.head 2 -  Display Settings
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Class Default
.head 3 -  Initial State: Class Default
.head 3 -  Maximizable? Class Default
.head 3 -  Minimizable? Class Default
.head 3 -  System Menu? Class Default
.head 3 -  Resizable? Class Default
.head 3 -  Window Location and Size
.head 4 -  Left:   1.25"
.head 4 -  Top:    1.146"
.head 4 -  Width:  14.367"
.head 4 -  Width Editable? Class Default
.head 4 -  Height: 6.0"
.head 4 -  Height Editable? Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 3 -  View: Class Default
.head 3 -  Allow Row Sizing? Class Default
.head 3 -  Lines Per Row: Class Default
.head 2 -  Memory Settings
.head 3 -  Maximum Rows in Memory: Class Default
.head 3 -  Discardable? Class Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Class Default
.head 4 -  Location? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Size: Class Default
.head 4 -  Size Editable? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 3 +  Contents
.head 4 +  Pushbutton: pbIns
.head 5 -  Class Child Ref Key: 33
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDel
.head 5 -  Class Child Ref Key: 34
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 35
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbUpdate
.head 5 -  Class Child Ref Key: 36
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 19734
.head 5 -  Class Child Ref Key: 37
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  6.0"
.head 6 -  Begin Y:  0.0"
.head 6 -  End X:  6.0"
.head 6 -  End Y:  0.464"
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 -  Line
.head 5 -  Resource Id: 19737
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Coordinates
.head 6 -  Begin X:  5.333"
.head 6 -  Begin Y:  -0.024"
.head 6 -  End X:  5.333"
.head 6 -  End Y:  0.44"
.head 5 -  Visible? Yes
.head 5 -  Line Style: Etched
.head 5 -  Line Thickness: 1
.head 5 -  Line Color: 3D Shadow Color
.head 4 +  Pushbutton: pbSearch
.head 5 -  Class Child Ref Key: 38
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbFilter
.head 5 -  Class Child Ref Key: 44
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDetails
.head 5 -  Class Child Ref Key: 39
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\OPEN.BMP
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbPrint
.head 5 -  Class Child Ref Key: 40
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 19735
.head 5 -  Class Child Ref Key: 41
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 42
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   5.467"
.head 6 -  Top:    0.071"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 19736
.head 5 -  Class Child Ref Key: 43
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbTimer
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cTimer
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: A+T
.head 5 -  Window Location and Size
.head 6 -  Left:   4.017"
.head 6 -  Top:    0.071"
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 0.321"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Yes
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Dark Blue
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_TooltipSetText
.head 7 -  Return XSalTooltipSetText(lParam, IifS(nMode=2, 'Сформувати файл А', 'Прийняти квитанцію Т'))
.head 6 +  On UM_TimerFired
.head 7 +  If nMode = 2
.head 8 -  Call FileA()
.head 7 +  Else If nMode = 6
.head 8 -  Call FileOA()
.head 8 -  Call FileT()
.head 7 -  Call ShowMessage()
.head 4 +  Pushbutton: pbDocSign
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   4.017"
.head 6 -  Top:    0.071"
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.321"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Keyboard Accelerator: (none)
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\EDIT.BMP
.head 5 -  Picture Transparent Color: Gray
.head 5 -  Image Style: Single
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 +  Message Actions
.head 6 +  On SAM_TooltipSetText
.head 7 -  Return XSalTooltipSetText(lParam, 'Підписати документи')
.head 6 +  On SAM_Click
.head 7 -  Call sDocs()
.head 2 +  Contents
.head 3 +  Column: colTime
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cColumnLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Час
.head 4 -  Visible? Class Default
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Class Default
.head 4 -  Data Type: Date/Time
.head 4 -  Justify: Center
.head 4 -  Width:  1.0"
.head 4 -  Width Editable? Class Default
.head 4 -  Format: hhhh:mm:ss
.head 4 -  Country: Class Default
.head 4 -  Input Mask: Class Default
.head 4 -  Cell Options
.head 5 -  Cell Type? Class Default
.head 5 -  Multiline Cell? Class Default
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Class Default
.head 6 -  Vertical Scroll? Class Default
.head 6 -  Auto Drop Down? Class Default
.head 6 -  Allow Text Editing? Class Default
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Class Default
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: colMess
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cColumnLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Повідомлення
.head 4 -  Visible? Class Default
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Class Default
.head 4 -  Data Type: Class Default
.head 4 -  Justify: Class Default
.head 4 -  Width:  6.0"
.head 4 -  Width Editable? Class Default
.head 4 -  Format: Class Default
.head 4 -  Country: Class Default
.head 4 -  Input Mask: Class Default
.head 4 -  Cell Options
.head 5 -  Cell Type? Class Default
.head 5 -  Multiline Cell? Class Default
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Class Default
.head 6 -  Vertical Scroll? Class Default
.head 6 -  Auto Drop Down? Class Default
.head 6 -  Allow Text Editing? Class Default
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Class Default
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: colErrNBU
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cColumnLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Помилка
АРМ-НБУ
.head 4 -  Visible? Class Default
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Class Default
.head 4 -  Data Type: Class Default
.head 4 -  Justify: Center
.head 4 -  Width:  1.0"
.head 4 -  Width Editable? Class Default
.head 4 -  Format: Class Default
.head 4 -  Country: Class Default
.head 4 -  Input Mask: Class Default
.head 4 -  Cell Options
.head 5 -  Cell Type? Class Default
.head 5 -  Multiline Cell? Class Default
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Class Default
.head 6 -  Vertical Scroll? Class Default
.head 6 -  Auto Drop Down? Class Default
.head 6 -  Allow Text Editing? Class Default
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Class Default
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: colNameErrNBU
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cColumnLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Назва помилки
АРМ-НБУ
.head 4 -  Visible? Class Default
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Class Default
.head 4 -  Data Type: Class Default
.head 4 -  Justify: Left
.head 4 -  Width:  4.0"
.head 4 -  Width Editable? Class Default
.head 4 -  Format: Class Default
.head 4 -  Country: Class Default
.head 4 -  Input Mask: Class Default
.head 4 -  Cell Options
.head 5 -  Cell Type? Class Default
.head 5 -  Multiline Cell? Class Default
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Class Default
.head 6 -  Vertical Scroll? Class Default
.head 6 -  Auto Drop Down? Class Default
.head 6 -  Allow Text Editing? Class Default
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Class Default
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: colErrDEP
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cColumnLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Помилка
Депозитарія
.head 4 -  Visible? Class Default
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Class Default
.head 4 -  Data Type: Class Default
.head 4 -  Justify: Center
.head 4 -  Width:  1.0"
.head 4 -  Width Editable? Class Default
.head 4 -  Format: Class Default
.head 4 -  Country: Class Default
.head 4 -  Input Mask: Class Default
.head 4 -  Cell Options
.head 5 -  Cell Type? Class Default
.head 5 -  Multiline Cell? Class Default
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Class Default
.head 6 -  Vertical Scroll? Class Default
.head 6 -  Auto Drop Down? Class Default
.head 6 -  Allow Text Editing? Class Default
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Class Default
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: colNameErrDEP
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cColumnLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Назва помилки
Депозитарія
.head 4 -  Visible? Class Default
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Class Default
.head 4 -  Data Type: Class Default
.head 4 -  Justify: Left
.head 4 -  Width:  4.0"
.head 4 -  Width Editable? Class Default
.head 4 -  Format: Class Default
.head 4 -  Country: Class Default
.head 4 -  Input Mask: Class Default
.head 4 -  Cell Options
.head 5 -  Cell Type? Class Default
.head 5 -  Multiline Cell? Class Default
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Class Default
.head 6 -  Vertical Scroll? Class Default
.head 6 -  Auto Drop Down? Class Default
.head 6 -  Allow Text Editing? Class Default
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Class Default
.head 4 -  List Values
.head 4 -  Message Actions
.head 2 +  Functions
.head 3 +  Function: FileA
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nPr
.head 5 -  String: sSqlRequest
.head 5 -  String: sSqlDelete
.head 5 -  String: sSqlUpdate
.head 5 -  Number: nRef
.head 5 -  Number: nSignDoc
.head 5 -  Number: nRefNum
.head 5 -  Number: nmRef[*]
.head 5 -  Number: nmSignDoc[*]
.head 5 -  Number: i
.head 5 -  String: sFNameA
.head 5 -  String: sSignData
.head 5 -  Date/Time: dCurrentDate
.head 5 -  Number: nExt
.head 5 -  Number: n
.head 4 +  Actions
.head 5 -  Set bMessA = TRUE
.head 5 -  ! счетчик файлов
.head 5 -  Call SqlPrepareAndExecute(hSql(), "select nvl(max(to_number(substr(fna,-3))),0) into :nExt from dcp_p where trunc(data) = trunc(sysdate)")
.head 5 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Set nPr = 1
.head 5 +  While nPr <= 2
.head 6 -  ! oper
.head 6 +  If nPr = 1
.head 7 -  Set sSqlRequest = "SELECT d.ref, decode(o.sign,null,0,1) INTO :nRef, :nSignDoc FROM dcp_a d, oper o WHERE d.ref=o.ref"
.head 7 -  Set sSqlDelete  = "DELETE FROM dcp_a WHERE ref=:nRef"
.head 7 -  Set sSqlUpdate  = "UPDATE dcp_p SET fna=:sFNameA, data=:dCurrentDate WHERE ref=:nRef"
.head 6 -  ! arc_rrp
.head 6 +  Else If nPr = 2
.head 7 -  Set sSqlRequest = "SELECT d.rec, decode(o.sign,null,0,1) INTO :nRef, :nSignDoc FROM dcp_b d, arc_rrp o WHERE d.rec=o.rec"
.head 7 -  Set sSqlDelete  = "DELETE FROM dcp_b WHERE rec=:nRef"
.head 7 -  Set sSqlUpdate  = "INSERT INTO dcp_p(ref, fna, data) VALUES(:nRef, :sFNameA, :dCurrentDate)"
.head 6 -  Set nRefNum = 0
.head 6 +  If SqlPrepareAndExecute(hSql(), sSqlRequest)
.head 7 +  While SqlFetchNext(hSql(), nFetchRes)
.head 8 -  Set nmRef[nRefNum] = nRef
.head 8 -  Set nmSignDoc[nRefNum] = nSignDoc
.head 8 -  Set nRefNum = nRefNum + 1
.head 6 -  Set i = 0
.head 6 +  While i < nRefNum
.head 7 -  Set bMessA = FALSE
.head 7 -  Set nRef = nmRef[i]
.head 7 -  Set nSignDoc = nmSignDoc[i]
.head 7 +  Loop
.head 8 -  Set dCurrentDate = SalDateCurrent()
.head 8 +  If GetSignOn() and nSignDoc = 0
.head 9 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 9 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE)
.head 9 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 9 -  Set hWndForm.Tbl_DCPA.colMess = "РЕФ " || Str(nRef) || ": Документ не підписано, файл НЕ сформовано"
.head 9 -  Call SaveInfoToLog('DCP. ' || hWndForm.Tbl_DCPA.colMess)
.head 9 -  Set nColor = COLOR_Red
.head 9 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 9 -  Break
.head 8 -  Set nExt = nExt + 1
.head 8 -  Set sFNameA = '&A' || GetBankSab() || MD(GetBankDate()) || '.' || Right('000'||Str(nExt),3)
.head 8 +  If NOT WrtFile(sFNameA, nRef, nPr)
.head 9 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 9 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 9 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 9 -  Set hWndForm.Tbl_DCPA.colMess = "РЕФ " || Str(nRef) || ": Помилка формування файла"
.head 9 -  Call SaveInfoToLog('DCP. ' || hWndForm.Tbl_DCPA.colMess)
.head 9 -  Set nColor = COLOR_Red
.head 9 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 9 -  Break
.head 8 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 8 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 8 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 8 -  Set hWndForm.Tbl_DCPA.colMess = "РЕФ " || Str(nRef) || ": Сформовано файл " || sFNameA
.head 8 -  Call SaveInfoToLog('DCP. ' || hWndForm.Tbl_DCPA.colMess)
.head 8 -  Set nColor = COLOR_Blue
.head 8 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 8 +  If nPr = 1
.head 9 -  ! НБУ: если документ порождается не по файлу &a, а вручную добавляется реф. в dcp_a,
.head 9 -  ! внесем реф. в dcp_p
.head 9 -  Call SqlPrepareAndExecute(hSqlAux2(), "select count(*) into :n from dcp_p where ref = :nRef")
.head 9 -  Call SqlFetchNext(hSqlAux2(), nFetchRes)
.head 9 +  If n = 0
.head 10 +  If NOT SqlPrepareAndExecute(hSqlAux2(), "insert into dcp_p(ref, fn, dat) values(:nRef, :sFNameA, :dCurrentDate)")
.head 11 -  Call SqlRollback(hSqlAux2())
.head 11 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 11 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 11 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 11 -  Set hWndForm.Tbl_DCPA.colMess = "РЕФ " || Str(nRef) || ": Помилка INSERT dcp_p"
.head 11 -  Call SaveInfoToLog('DCP. ' || hWndForm.Tbl_DCPA.colMess)
.head 11 -  Set nColor = COLOR_DarkRed
.head 11 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 11 -  Break
.head 8 +  If NOT SqlPrepareAndExecute(hSqlAux2(), sSqlUpdate)
.head 9 -  Call SqlRollback(hSqlAux2())
.head 9 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 9 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 9 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 9 -  Set hWndForm.Tbl_DCPA.colMess = "РЕФ " || Str(nRef) || ": Помилка UPDATE dcp_p"
.head 9 -  Call SaveInfoToLog('DCP. ' || hWndForm.Tbl_DCPA.colMess)
.head 9 -  Set nColor = COLOR_DarkRed
.head 9 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 9 -  Break
.head 8 -  Call SqlCommit(hSqlAux2())
.head 8 +  If NOT SqlPrepareAndExecute(hSqlAux2(), sSqlDelete)
.head 9 -  Call SqlRollback(hSqlAux2())
.head 9 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 9 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 9 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 9 -  Set hWndForm.Tbl_DCPA.colMess = "РЕФ " || Str(nRef) || ": Помилка DELETE FROM dcp_a"
.head 9 -  Call SaveInfoToLog('DCP. ' || hWndForm.Tbl_DCPA.colMess)
.head 9 -  Set nColor = COLOR_DarkRed
.head 9 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 9 -  Break
.head 8 -  Call SqlCommit(hSqlAux2())
.head 8 -  Break
.head 7 -  Set i = i + 1
.head 6 -  Set nPr = nPr + 1
.head 5 -  Return TRUE
.head 3 +  Function: FileOA
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sMaska
.head 5 -  String: sMass[*]
.head 5 -  Number: nKol
.head 5 -  Number: nTek
.head 5 -  String: sFile
.head 5 -  Date/Time: dCurrentDate
.head 5 -  Date/Time: dDatF
.head 5 -  Number: hF
.head 5 -  String: sTmp
.head 5 -  String: sFNameA
.head 5 -  String: sErr_NBU
.head 5 -  String: sErr_DEP
.head 5 -  File Handle: hFile
.head 5 -  String: sErr1
.head 5 -  String: sErr2
.head 4 +  Actions
.head 5 -  ! обработка файлов из основной дир.
.head 5 -  Set sMaska = strPathDCP_O || '\\&OA' || '***' || '**.***'
.head 5 -  Call SalArraySetUpperBound(sMass, 1, -1)
.head 5 -  Set nKol = VisDosEnumFiles(sMaska, FA_Standard, sMass)
.head 5 +  If nKol > 0 ! обработка файлов
.head 6 -  Set nTek = 0
.head 6 +  While nTek < nKol
.head 7 -  Set dCurrentDate = SalDateCurrent()
.head 7 -  Set sFNameA  = ""
.head 7 -  Set sErr_NBU = ""
.head 7 -  Set sErr_DEP = ""
.head 7 -  Set sFile = sMass[nTek]
.head 7 -  Set hF = llopen(strPathDCP_O || '\\' || sFile, 2)
.head 7 +  Loop
.head 8 +  If hF <= 0
.head 9 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 9 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 9 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 9 -  Set hWndForm.Tbl_DCPA.colMess = "Файл " || sFile || ": Неможливо відкрити"
.head 9 -  Set hWndForm.Tbl_DCPA.colErrNBU = "-"
.head 9 -  Set hWndForm.Tbl_DCPA.colErrDEP = "-"
.head 9 -  Set nColor = COLOR_DarkRed
.head 9 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 9 -  Break
.head 8 -  ! Имя файла в заголовке
.head 8 -  Set sTmp = Spac(12)
.head 8 -  Call lllseek(hF, 102, FILE_SeekBegin)
.head 8 -  Call llread(hF, sTmp, 12)
.head 8 +  If SalStrUpperX( sTmp ) != SalStrUpperX( sFile )
.head 9 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 9 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 9 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 9 -  Set hWndForm.Tbl_DCPA.colMess = "Файл " || sFile || ": Помилка імені/в заголовке " || sTmp
.head 9 -  Set hWndForm.Tbl_DCPA.colErrNBU = "-"
.head 9 -  Set hWndForm.Tbl_DCPA.colErrDEP = "-"
.head 9 -  Set nColor = COLOR_DarkRed
.head 9 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 9 -  Break
.head 8 -  ! Время создания &OA
.head 8 -  Call lllseek(hF, 102+12, FILE_SeekBegin)
.head 8 -  Set sTmp = Spac(10)
.head 8 -  Call llread(hF, sTmp, 10)
.head 8 -  Set dDatF = SalDateConstruct( 2000+Val(Subs(sTmp,1,2)), Val(Subs(sTmp,3,2)), Val(Subs(sTmp,5,2)), 
Val(Subs(sTmp,7,2)), Val(Subs(sTmp,9,2)), 0 )
.head 8 -  ! Имя файла &A
.head 8 -  Call lllseek(hF, 102+130, FILE_SeekBegin)
.head 8 -  Set sTmp = Spac(12)
.head 8 -  Call llread(hF, sTmp, 12)
.head 8 -  Set sFNameA = sTmp
.head 8 -  ! код ошибки АРМ-НБУ по файлу &A
.head 8 -  Call lllseek(hF, 102+260, FILE_SeekBegin)
.head 8 -  Set sTmp = Spac(4)
.head 8 -  Call llread(hF, sTmp, 4)
.head 8 -  Set sErr_NBU = sTmp
.head 8 -  ! код ошибки ДЕПОЗИТАРИЯ по файлу &A
.head 8 -  Call lllseek(hF, 102+330+6, FILE_SeekBegin)
.head 8 -  Set sTmp = Spac(4)
.head 8 -  Call llread(hF, sTmp, 4)
.head 8 -  Set sErr_DEP = sTmp
.head 8 +  If NOT SqlPrepareAndExecute(hSql(), 
"SELECT err_nbu, err_dep INTO :sErr1, :sErr2 
 FROM dcp_p WHERE upper(fna)=upper(:sFNameA)") 
OR NOT SqlFetchNext(hSql(), nFetchRes)
.head 9 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 9 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 9 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 9 -  Set hWndForm.Tbl_DCPA.colMess = "Файл " || sFile || ": Не знайдено квитуємий файл " || sFNameA
.head 9 -  Set hWndForm.Tbl_DCPA.colErrNBU = "-"
.head 9 -  Set hWndForm.Tbl_DCPA.colErrDEP = "-"
.head 9 -  Set nColor = COLOR_DarkRed
.head 9 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 9 -  Break
.head 8 +  If sErr1='0000' AND sErr2='0000'
.head 9 +  If IDNO = SalMessageBox("Квитанція " || sFile || ": Файл " || sFNameA || " вже зквитовано без помилок. 
Зквитувати з помилками " || sErr_NBU || ", " || sErr_DEP || " ?", "Увага!", MB_IconExclamation | MB_YesNo )
.head 10 -  Break
.head 8 +  If NOT SqlPrepareAndExecute(hSqlAux2(), 
"UPDATE dcp_p 
 SET fnt=:sFile, datt=:dDatF, 
     err_nbu=:sErr_NBU, err_dep=:sErr_DEP 
 WHERE fna=:sFNameA")
.head 9 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 9 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 9 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 9 -  Set hWndForm.Tbl_DCPA.colMess = "Файл " || sFile || ": Помилка квитовки файлу " || sFNameA || " (UPDATE dcp_p)"
.head 9 -  Set hWndForm.Tbl_DCPA.colErrNBU = "-"
.head 9 -  Set hWndForm.Tbl_DCPA.colErrDEP = "-"
.head 9 -  Set nColor = COLOR_DarkRed
.head 9 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 9 -  Break
.head 8 -  Call SqlCommitEx(hSqlAux2(),'')
.head 8 -  !
.head 8 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 8 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 8 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 8 -  Set hWndForm.Tbl_DCPA.colMess = "Файл " || sFile || ": зквитовано " || sFNameA
.head 8 -  Set hWndForm.Tbl_DCPA.colErrNBU = sErr_NBU
.head 8 -  Set hWndForm.Tbl_DCPA.colErrDEP = sErr_DEP
.head 8 -  Set nColor = COLOR_Red
.head 8 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 8 +  If SqlPrepareAndExecute( hSql(),
"SELECT n_er INTO :sTmp FROM s_er WHERE k_er=:sErr_NBU")
.head 9 -  Call SqlFetchNext( hSql(), nFetchRes )
.head 9 -  Set hWndForm.Tbl_DCPA.colNameErrNBU = sTmp
.head 8 +  If SqlPrepareAndExecute( hSql(),
"SELECT n_er INTO :sTmp FROM s_er WHERE k_er=:sErr_DEP")
.head 9 -  Call SqlFetchNext( hSql(), nFetchRes )
.head 9 -  Set hWndForm.Tbl_DCPA.colNameErrDEP = sTmp
.head 8 -  Break
.head 7 -  Call llclose(hF)
.head 7 -  Call SalFileCopy(strPathDCP_O || '\\' || sFile, strBackUpDir || '\\' || sFile, TRUE)
.head 7 -  Call SalFileOpen(hFile, strPathDCP_O || '\\' || sFile, OF_Delete)
.head 7 -  Set nTek = nTek + 1
.head 5 -  Return TRUE
.head 3 +  Function: FileT
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sMaska
.head 5 -  String: sMass[*]
.head 5 -  Number: nKol
.head 5 -  Number: nTek
.head 5 -  String: sFile
.head 5 -  Date/Time: dCurrentDate
.head 5 -  Date/Time: dDatF
.head 5 -  Number: hF
.head 5 -  String: sTmp
.head 5 -  String: sFNameA
.head 5 -  String: sErr_NBU
.head 5 -  String: sErr_DEP
.head 5 -  File Handle: hFile
.head 5 -  String: sErr1
.head 5 -  String: sErr2
.head 4 +  Actions
.head 5 -  Set bMessT = TRUE
.head 5 -  ! обработка файлов из основной дир.
.head 5 -  Set sMaska = strPathDCP_T || '\\&T' || GetBankSab() || '**.***'
.head 5 -  Call SalArraySetUpperBound(sMass, 1, -1)
.head 5 -  Set nKol = VisDosEnumFiles(sMaska, FA_Standard, sMass)
.head 5 +  If nKol > 0 ! обработка файлов
.head 6 -  Set nTek = 0
.head 6 +  While nTek < nKol
.head 7 -  Set dCurrentDate = SalDateCurrent()
.head 7 -  Set bMessT = FALSE
.head 7 -  Set sFNameA  = ""
.head 7 -  Set sErr_NBU = ""
.head 7 -  Set sErr_DEP = ""
.head 7 -  Set sFile = sMass[nTek]
.head 7 -  Set hF = llopen(strPathDCP_T || '\\' || sFile, 2)
.head 7 +  Loop
.head 8 +  If hF <= 0
.head 9 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 9 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 9 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 9 -  Set hWndForm.Tbl_DCPA.colMess = "Файл " || sFile || ": Неможливо відкрити"
.head 9 -  Set hWndForm.Tbl_DCPA.colErrNBU = "-"
.head 9 -  Set hWndForm.Tbl_DCPA.colErrDEP = "-"
.head 9 -  Set nColor = COLOR_DarkRed
.head 9 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 9 -  Break
.head 8 -  ! Имя файла в заголовке
.head 8 -  Set sTmp = Spac(12)
.head 8 -  Call lllseek(hF, 102, FILE_SeekBegin)
.head 8 -  Call llread(hF, sTmp, 12)
.head 8 +  If SalStrUpperX( sTmp ) != SalStrUpperX( sFile )
.head 9 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 9 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 9 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 9 -  Set hWndForm.Tbl_DCPA.colMess = "Файл " || sFile || ": Помилка імені /в заголовке " || sTmp
.head 9 -  Set hWndForm.Tbl_DCPA.colErrNBU = "-"
.head 9 -  Set hWndForm.Tbl_DCPA.colErrDEP = "-"
.head 9 -  Set nColor = COLOR_DarkRed
.head 9 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 9 -  Break
.head 8 -  ! Время создания &T
.head 8 -  Call lllseek(hF, 102+12, FILE_SeekBegin)
.head 8 -  Set sTmp = Spac(10)
.head 8 -  Call llread(hF, sTmp, 10)
.head 8 -  Set dDatF = SalDateConstruct( 2000+Val(Subs(sTmp,1,2)), Val(Subs(sTmp,3,2)), Val(Subs(sTmp,5,2)), 
Val(Subs(sTmp,7,2)), Val(Subs(sTmp,9,2)), 0 )
.head 8 -  ! Имя файла &A
.head 8 -  Call lllseek(hF, 102+22, FILE_SeekBegin)
.head 8 -  Set sTmp = Spac(12)
.head 8 -  Call llread(hF, sTmp, 12)
.head 8 -  Set sFNameA = sTmp
.head 8 -  ! код ошибки АРМ-НБУ по файлу &A
.head 8 -  Call lllseek(hF, 102+34, FILE_SeekBegin)
.head 8 -  Set sTmp = Spac(4)
.head 8 -  Call llread(hF, sTmp, 4)
.head 8 -  Set sErr_NBU = sTmp
.head 8 -  ! код ошибки ДЕПОЗИТАРИЯ по файлу &A
.head 8 -  Call lllseek(hF, 102+38, FILE_SeekBegin)
.head 8 -  Set sTmp = Spac(4)
.head 8 -  Call llread(hF, sTmp, 4)
.head 8 -  Set sErr_DEP = sTmp
.head 8 +  If NOT SqlPrepareAndExecute(hSql(), 
"SELECT err_nbu, err_dep INTO :sErr1, :sErr2 
 FROM dcp_p WHERE upper(fna)=upper(:sFNameA)") 
OR NOT SqlFetchNext(hSql(), nFetchRes)
.head 9 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 9 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 9 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 9 -  Set hWndForm.Tbl_DCPA.colMess = "Файл " || sFile || ": Не знайдено квитуємий файл " || sFNameA
.head 9 -  Set hWndForm.Tbl_DCPA.colErrNBU = "-"
.head 9 -  Set hWndForm.Tbl_DCPA.colErrDEP = "-"
.head 9 -  Set nColor = COLOR_DarkRed
.head 9 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 9 -  Break
.head 8 +  If sErr1='0000' AND sErr2='0000'
.head 9 +  If IDNO = SalMessageBox("Квитанція " || sFile || ": Файл " || sFNameA || " вже зквитовано без помилок. 
Зквитувати з помилками " || sErr_NBU || ", " || sErr_DEP || " ?", "Увага!", MB_IconExclamation | MB_YesNo )
.head 10 -  Break
.head 8 +  If NOT SqlPrepareAndExecute(hSqlAux2(), 
"UPDATE dcp_p 
 SET fnt=:sFile, datt=:dDatF, 
     err_nbu=:sErr_NBU, err_dep=:sErr_DEP 
 WHERE fna=:sFNameA")
.head 9 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 9 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 9 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 9 -  Set hWndForm.Tbl_DCPA.colMess = "Файл " || sFile || ": Помилка квитовки файлу " || sFNameA || " (UPDATE dcp_p)"
.head 9 -  Set hWndForm.Tbl_DCPA.colErrNBU = "-"
.head 9 -  Set hWndForm.Tbl_DCPA.colErrDEP = "-"
.head 9 -  Set nColor = COLOR_DarkRed
.head 9 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 9 -  Break
.head 8 -  Call SqlCommitEx( hSqlAux2(),'')
.head 8 -  !
.head 8 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 8 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 8 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 8 -  Set hWndForm.Tbl_DCPA.colMess = "Файл " || sFile || ": зквитовано " || sFNameA
.head 8 -  Set hWndForm.Tbl_DCPA.colErrNBU = sErr_NBU
.head 8 -  Set hWndForm.Tbl_DCPA.colErrDEP = sErr_DEP
.head 8 +  If sErr_NBU != '0000' OR sErr_DEP != '0000'
.head 9 -  Set nColor = COLOR_Red
.head 8 +  Else
.head 9 -  Set nColor = COLOR_DarkGreen
.head 8 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 8 +  If SqlPrepareAndExecute( hSql(),
"SELECT n_er INTO :sTmp FROM s_er WHERE k_er=:sErr_NBU") 
AND SqlFetchNext( hSql(), nFetchRes )
.head 9 -  Set hWndForm.Tbl_DCPA.colNameErrNBU = sTmp
.head 8 +  If SqlPrepareAndExecute( hSql(),
"SELECT n_er INTO :sTmp FROM s_er WHERE k_er=:sErr_DEP") 
AND SqlFetchNext( hSql(), nFetchRes )
.head 9 -  Set hWndForm.Tbl_DCPA.colNameErrDEP = sTmp
.head 8 -  Break
.head 7 -  Call llclose(hF)
.head 7 -  Call SalFileCopy(strPathDCP_T || '\\' || sFile, strBackUpDir || '\\' || sFile, TRUE)
.head 7 -  Call SalFileOpen(hFile, strPathDCP_T || '\\' || sFile, OF_Delete)
.head 7 -  Set nTek = nTek + 1
.head 5 -  Return TRUE
.head 3 +  Function: WrtFile
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strFn
.head 5 -  Number: nRef
.head 5 -  Number: nPr
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sSignData
.head 5 -  Number: nS
.head 5 -  Long String: lsSignDoc
.head 5 -  !
.head 5 -  Long String: lsSignD
.head 5 -  Number: nFile
.head 5 -  Number: nI
.head 5 -  File Handle: hDelFile
.head 5 -  Long String: lsSign
.head 4 +  Actions
.head 5 +  If not getSignData(2, nPr, nRef, sSignData, nS, lsSignDoc)
.head 6 -  Call MessageInfoEx("РЕФ " || Str(nRef) || ": Не вдалося прочитати дані документа")
.head 6 -  Return FALSE
.head 5 -  Set nFile = _sopen(strPathDCP_Out || '\\' || strFn, 0x00008302, 0x00000010, 0x00000180)
.head 5 +  If nFile != -1
.head 6 -  ! 102 - Служебная строка
.head 6 -  Call _write(nFile, Spac(100) || PutCrLf(), 102)
.head 6 -  !
.head 6 -  ! 196 - Строка заголовка
.head 6 -  Call _write(nFile, strFn || SalFmtFormatDateTime(dBDat, 'yyMMdd') || 
     SalFmtFormatDateTime(SalDateCurrent(), 'hhhhmm') || PadL('1',6) || 
     PadL('0',16) || PadL(Str(nS), 16) || Spac(64) || Spac(6) || Spac(64) || PutCrLf(), 196)
.head 6 -  !
.head 6 -  ! Информационная строка (594)
.head 6 -  ! 444 - основные реквизиты
.head 6 -  Call _write(nFile, sSignData, 444)
.head 6 -  ! + 64 - ЕЦП основних реквізитів платежу 
.head 6 -  Set lsSign = Spac(64)
.head 6 +  If GetSignOn() = 0
.head 7 -  Set lsSign = SalStrRepeatX( ' ', 64 )
.head 6 +  Else
.head 7 -  ! Добываем подпись на документ 
.head 7 -  ! НБУ
.head 7 +  If sDCPSignType = 'UNI' 
or sDCPSignType = 'NBU' and isNbuBank
.head 8 -  Call InsertBuf(lsSign, 0, lsSignDoc, 16, 64)
.head 7 -  ! КБ
.head 7 +  Else If sDCPSignType = 'NBU'
.head 8 -  Call InsertBuf(lsSign, 0, lsSignDoc, 0, 64)
.head 7 +  Else
.head 8 -  Call SaveErrorToLog('Ошибка при обработке ЭЦП на документ.'||PutCrLf()||
'Допустимые значения параметра DCPSignType=(NBU,UNI)')
.head 6 -  Call _write(nFile, lsSign, 64)
.head 6 -  ! + 12 - Найменування файла А
  +  6 - Порядковий номер ІР у файлі А
  +  4 - Час проходження файла А через АРМ-НБУ
  +  4 - Час отримання файла А в ЦОСЕП
  = 26
.head 6 -  Call _write(nFile, strFn || '     1' || Spac(4) || Spac(4), 26)
.head 6 -  ! + 18 - Службова інформація для САБ установ НБУ
.head 6 +  If GetSignOn() = 0
.head 7 -  Call _write(nFile, Spac(18), 18)
.head 6 +  Else
.head 7 -  ! Для НБУ (sep2) заполняем
.head 7 +  If sDCPSignType = 'NBU' AND isNbuBank
.head 8 -  Set lsSign = Spac(1)
.head 8 -  Call InsertBuf(lsSign, 0, lsSignDoc, 0, 1)
.head 8 -  Call _write(nFile, lsSign, 1)
.head 8 -  Set lsSign = Spac(9)
.head 8 -  Call InsertBuf(lsSign, 0, lsSignDoc, 7, 9)
.head 8 -  Call _write(nFile, lsSign, 9)
.head 8 -  Set lsSign = Spac(8)
.head 8 -  Call InsertBuf(lsSign, 0, lsSignDoc, 80, 8)
.head 8 -  Call _write(nFile, lsSign, 8)
.head 7 -  ! Для КБ пусто
.head 7 +  Else
.head 8 -  Call _write(nFile, Spac(18), 18)
.head 6 -  ! + 1 + 7 + 12 + 6 + 4 + 4 + 6 + 2 = 42
.head 6 -  Call _write(nFile, Spac(40) || PutCrLf(), 42)
.head 6 -  ! подписываем файл 
.head 6 +  If GetSignOn( )
.head 7 +  If NOT sFile(nFile, 594)
.head 8 -  Call SalMessageBox('Не удалось подписать файл', 'Ошибка', MB_IconStop)
.head 8 -  Call _close(nFile)
.head 8 -  Call SalFileOpen(hDelFile, strPathDCP_Out || '\\' || strFn, OF_Delete)
.head 8 -  Return FALSE
.head 6 -  Call _close(nFile)
.head 6 -  Call SalFileCopy(strPathDCP_Out || '\\' || strFn, strBackUpDir || '\\' || strFn, TRUE)
.head 6 -  Return TRUE
.head 5 +  Else
.head 6 -  Call MessageInfoEx( 'Ошибка создания файла ' || strPathDCP_Out || '\\' || strFn )
.head 6 -  Return FALSE
.head 3 +  Function: sFile         ! Подписать файл
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Number: nFile
.head 5 -  Number: nLength
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Long String: lsSignF
.head 5 -  Long String: lsSignZ
.head 5 -  Number: nSignLen
.head 5 -  String: sSign
.head 5 -  !
.head 5 -  Number: nErrorSign
.head 5 -  String: strErrorSign
.head 5 -  Number: nN
.head 5 -  String: sN
.head 4 +  Actions
.head 5 -  Set lsSignF = SalStrRepeatX(' ', 88)
.head 5 -  Set lsSignZ = SalStrRepeatX(' ', 88)
.head 5 +  If NOT GetSignOn()	!  ЭЦП отключена - вернуть Пусто
.head 6 -  Return TRUE
.head 5 +  If sDCPSignType = 'NBU'
.head 6 -  Set nSignLen = 64
.head 5 +  Else If sDCPSignType = 'UNI'
.head 6 -  Set nSignLen = 88
.head 5 +  Else
.head 6 -  Set nSignLen = 0
.head 5 -  ! ЕЦП файла
.head 5 -  ! посмотреть, куда записать ЕЦП
.head 5 -  Set nErrorSign = ccDoc.fileSigner.SignFile(
	nFile,
	1,
	102+60+6+2+2*64,
	nLength,
	nLength,
	nSignLen,
	lsSignF	)
.head 5 -  Set sSign = Spac(64)
.head 5 +  If sDCPSignType != 'NBU'
.head 6 -  Call InsertBuf(sSign,0,lsSignF,16,64)
.head 5 +  Else
.head 6 -  Call InsertBuf(sSign,0,lsSignF,0,64)
.head 5 +  If nErrorSign = 0	! 0=ok, ЕЦП файла
.head 6 -  Call _lseek(nFile, 102+60, FILE_SeekBegin)
.head 6 -  Call _write(nFile, sSign, 64)
.head 6 -  Call _commit(nFile)
.head 5 +  If nErrorSign = 0	! 0=ok, ид-р ключа ЕЦП
.head 6 -  Call _lseek(nFile, 102+60+64, FILE_SeekBegin)
.head 6 -  Call _write(nFile, sIdOperNBUFile, 6)
.head 6 -  Call _commit(nFile)
.head 6 -  ! ЕЦП рядку заголовку файла
.head 6 -  Set nErrorSign = ccDoc.fileSigner.SignFile(
	nFile,
	1,
	102,
	60+6+64,
	60+6+64,
	nSignLen,
	lsSignZ	)
.head 6 -  Set sSign = Spac(64)
.head 6 +  If sDCPSignType != 'NBU'
.head 7 -  Call InsertBuf(sSign,0,lsSignZ,16,64)
.head 6 +  Else
.head 7 -  Call InsertBuf(sSign,0,lsSignZ,0,64)
.head 6 +  If nErrorSign = 0	! 0=ok, ЕЦП заголовного рядку
.head 7 -  Call _lseek(nFile, 102+60+64+6, FILE_SeekBegin)
.head 7 -  Call _write(nFile, sSign, 64)
.head 7 -  Call _commit(nFile)
.head 5 +  If nErrorSign = 0
.head 6 -  Return TRUE
.head 5 +  Else
.head 6 -  Set strErrorSign = '>> RSA. Ошибка наложения ЭЦП: ' || NumberToStr(nErrorSign)
.head 6 -  Call MessageAttention(strErrorSign)
.head 5 -  Return FALSE
.head 3 +  Function: MD
.head 4 -  Description: возвращает строку MD (месяц,день) в формате НБУ
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  Date/Time: dDATA
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Return Chr(IifN(SalDateMonth(dDATA)<10, 48, 55) + SalDateMonth(dDATA)) ||
       Chr(IifN(SalDateDay(dDATA)<10, 48, 55) + SalDateDay(dDATA))
.head 3 +  Function: ShowMessage
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If bMessA OR bMessT
.head 6 -  Call MessageNoWait(
  IifS(bMessA=TRUE, '&A: Немає документів для відправки до Депозитарія.' || PutCrLf(), '') || 
  IifS(bMessT=TRUE, '&T: Немає квитанцій в ' || strPathDCP_T, ''), '', 5, 0)
.head 5 -  Set bMessA = FALSE
.head 5 -  Set bMessT = FALSE
.head 5 -  Call SalTblSetContext(hWndForm, nTableRow)
.head 5 -  Call SalSetFocus(hWndForm)
.head 5 -  Call SalTblSetFocusRow(hWndForm, nTableRow)
.head 5 -  Call SalSendMsg(hWndForm, SAM_RowSetContext, 0, 0)
.head 3 +  Function: sDocs
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nPr
.head 5 -  String: sSqlRequest
.head 5 -  String: sSqlSelect
.head 5 -  String: sSqlDelete
.head 5 -  String: sSqlUpdate
.head 5 -  Number: nRef
.head 5 -  Number: nRefNum
.head 5 -  Number: nmRef[*]
.head 5 -  Number: i
.head 5 -  ! String: sFNameA
.head 5 -  String: sSignData
.head 5 -  String: sIdOperDoc
.head 5 -  Date/Time: dCurrentDate
.head 5 -  !
.head 5 -  Number: nS
.head 5 -  Long String: lsSign
.head 4 +  Actions
.head 5 -  Set bMessA = TRUE
.head 5 -  ! Переподписываем только документы из OPER и только для КБ
.head 5 -  Set sSqlRequest = "SELECT ref INTO :nRef FROM dcp_a"
.head 5 -  Set sSqlDelete  = "DELETE FROM dcp_a WHERE ref=:nRef"
.head 5 -  Set nRefNum = 0
.head 5 +  If SqlPrepareAndExecute(hSql(), sSqlRequest)
.head 6 +  While SqlFetchNext(hSql(), nFetchRes)
.head 7 -  Set nmRef[nRefNum] = nRef
.head 7 -  Set nRefNum = nRefNum + 1
.head 5 -  Set i = 0
.head 5 +  While i < nRefNum
.head 6 -  Set bMessA = FALSE
.head 6 -  Set nRef = nmRef[i]
.head 6 +  Loop
.head 7 -  Set dCurrentDate = SalDateCurrent()
.head 7 +  If not getSignData(1, 1, nRef, sSignData, nS, lsSign)
.head 8 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 8 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 8 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 8 -  Set hWndForm.Tbl_DCPA.colMess = "РЕФ " || Str(nRef) || ": Не вдалося прочитати дані документа"
.head 8 -  Call SaveInfoToLog('DCP. ' || hWndForm.Tbl_DCPA.colMess)
.head 8 -  Set nColor = COLOR_Black
.head 8 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 8 -  Break
.head 7 +  If nS = 0	! sos<0
.head 8 -  Break
.head 7 -  ! Переподписываем документ
.head 7 +  If NOT ReSignDoc(nRef, sSignData)
.head 8 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 8 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 8 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 8 -  Set hWndForm.Tbl_DCPA.colMess = "РЕФ " || Str(nRef) || ": Помилка підпису документа"
.head 8 -  Call SaveInfoToLog('DCP. ' || hWndForm.Tbl_DCPA.colMess)
.head 8 -  Set nColor = COLOR_Red
.head 8 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 8 -  Break
.head 7 -  Set nTableRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 7 -  Call SalTblSetRowFlags(hWndForm, nTableRow, ROW_New, FALSE )
.head 7 -  Set hWndForm.Tbl_DCPA.colTime = dCurrentDate
.head 7 -  Set hWndForm.Tbl_DCPA.colMess = "РЕФ " || Str(nRef) || ": Підписано документ"
.head 7 -  Call SaveInfoToLog('DCP. ' || hWndForm.Tbl_DCPA.colMess)
.head 7 -  Set nColor = COLOR_Blue
.head 7 -  Call SalTblSetCellTextColor(hWndForm.Tbl_DCPA.colMess,nColor,FALSE)
.head 7 -  Break
.head 6 -  Set i = i + 1
.head 5 -  Return TRUE
.head 3 +  Function: ReSignDoc
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Number: nRef
.head 5 -  String: sSignData
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Long String: lsSign
.head 4 +  Actions
.head 5 -  Set lsSign = Spac(64)
.head 5 +  If GetSignOn() = 0
.head 6 -  Set ccDoc.m_lsSign = SalStrRepeatX( ' ', 64 )
.head 6 -  Set lsSign = ccDoc.m_lsSign
.head 5 +  Else
.head 6 +  If sDCPSignType = 'NBU' and not isNbuBank
.head 7 -  ! Добываем подпись на документ 
.head 7 +  If NOT ccDoc.sDocDCP(nRef, sSignData, sIdOperNBUDoc)
.head 8 -  ! Call Debug('Ош. извлечения подписи на документ')
.head 8 -  Return FALSE
.head 7 -  Call InsertBuf(lsSign, 0, ccDoc.m_lsSignDCP, 0, 64)
.head 7 -  !
.head 7 +  If not SqlPrepare(hSql(), "update oper set sign=:lsSign, id_o=:sIdOperNBUDoc where ref=:nRef")
or not SqlSetLongBindDatatype(1, BLOB_BYTE)
or not SqlExecute(hSql())
.head 8 -  Call SqlRollback(hSql())
.head 8 -  Return FALSE
.head 7 -  Call SqlCommit(hSql())
.head 5 -  Return TRUE
.head 3 +  Function: getSignData
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nKod	! 1-для переподписывания документа, нужно подставить ключ операциониста, 
		  2-для файла берем уже готовую подпись
.head 5 -  Number: nPr
.head 5 -  Number: nRef
.head 5 -  Receive String: sSignData
.head 5 -  Receive Number: nS		! для nKod=1 - признактого, что документ не подписываем
.head 5 -  Receive Long String: lsSign	! для nKod=2
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sSqlSelect
.head 5 -  String: sSqlDelete
.head 5 -  !
.head 5 -  String: sMfoA
.head 5 -  String: sNlsA
.head 5 -  String: sMfoB
.head 5 -  String: sNlsB
.head 5 -  ! Number: nS
.head 5 -  String: sNamA
.head 5 -  String: sNamB
.head 5 -  String: sNazn
.head 5 -  String: sDRec
.head 5 -  String: sOkpoA
.head 5 -  String: sOkpoB
.head 5 -  Date/Time: dDatD
.head 5 -  Date/Time: dDatP
.head 5 -  Number: nVob
.head 5 -  String: sNd
.head 5 -  Number: nSos
.head 5 -  String: sIdOperDoc
.head 5 -  String: sDRecF
.head 4 +  Actions
.head 5 -  Set sSignData = ''
.head 5 -  Set nS = NUMBER_Null
.head 5 -  ! oper
.head 5 +  If nPr = 1
.head 6 -  Set sSqlSelect = 
"SELECT p.mfoa, p.nlsa, p.mfob, p.nlsb, p.s, 
        p.nam_a, p.nam_b, p.nazn, p.d_rec, p.id_a, p.id_b, 
        p.datd, p.datp, p.vob, p.nd, id_o, sos, sign 
   INTO :sMfoA, :sNlsA, :sMfoB, :sNlsB, :nS,
        :sNamA, :sNamB, :sNazn, :sDRec, :sOkpoA, :sOkpoB, 
        :dDatD, :dDatP, :nVob,  :sNd,   :sIdOperDoc, :nSos, :lsSign 
   FROM oper p 
  WHERE p.ref=:nRef"
.head 6 -  Set sSqlDelete = "DELETE FROM dcp_a WHERE ref=:nRef"
.head 5 -  ! arc_rrp
.head 5 +  Else If nPr = 2
.head 6 -  Set sSqlSelect = 
"SELECT p.mfoa, p.nlsa, p.mfob, p.nlsb, p.s, 
        p.nam_a, p.nam_b, p.nazn, p.d_rec, p.id_a, p.id_b, 
        p.datd, p.datp, p.vob, p.nd, id_o, sos, sign 
   INTO :sMfoA, :sNlsA, :sMfoB, :sNlsB, :nS,
        :sNamA, :sNamB, :sNazn, :sDRec, :sOkpoA, :sOkpoB, 
        :dDatD, :dDatP, :nVob,  :sNd,   :sIdOperDoc, :nSos, :lsSign 
   FROM arc_rrp p 
  WHERE p.rec=:nRef"
.head 6 -  Set sSqlDelete = "DELETE FROM dcp_b WHERE rec=:nRef"
.head 5 -  ! Ищем документ
.head 5 +  If NOT SqlPrepare(hSqlAux2(), sSqlSelect) 
or NOT SqlSetLongBindDatatype(18, BLOB_BYTE)
or NOT SqlExecute(hSqlAux2())
.head 6 -  Return FALSE 
.head 5 -  ! Если документ не нашли или он сторнирован - удаляем из очереди
.head 5 +  If NOT SqlFetchNext(hSqlAux2(), nFetchRes) OR nSos < 0
.head 6 +  If NOT SqlPrepareAndExecute(hSqlAux2(), sSqlDelete)
.head 7 -  Call SqlRollback(hSqlAux2())
.head 7 -  Return FALSE 
.head 6 -  Call SqlCommit(hSqlAux2())
.head 6 -  Set nS = 0	! Признак того, что документ не подписываем
.head 6 -  Return TRUE 
.head 5 -  ! Если ОКПО покупателя ЦБ=0, в доп.рекв. нужно указать паспортные данные,
.head 5 -  ! для этого в оп. ЦП1 добавть доп.рекв. 'Ф', заполнить его в функции доввода доп.рекв.,
.head 5 -  ! дописываем его в sDRec
.head 5 +  If Subs(sOkpoA,1,5) = '00000'
.head 6 -  Call SqlPrepareAndExecute(hSqlAux2(), "select substr(value,1,50) into :sDRecF from operw where ref = :nRef and trim(tag) = 'Ф'")
.head 6 -  Call SqlFetchNext(hSqlAux2(), nFetchRes)
.head 6 -  Set sDRec = sDRec || 'Ф' || sDRecF || '#'
.head 5 +  If GetGlobalOption('SEPNUM') = '2'
.head 6 -  ! Если документ переподписываем - подставляем ключ операциониста NBU,
  если берем подпись для формирования файла 
    или это НБУ (UNI-для него не переподписываем) - берем ключ операциониста 
    из OPER, что есть
.head 6 -  Set sSignData = 
  PadL(sMfoA, 9) || PadL(sNlsA, 14) || 
  PadL(sMfoB, 9) || PadL(sNlsB, 14) || '1' || 
  PadL(Str(nS), 16) || PadL(Str(nVob), 2) || 
  PadR(sNd, 10) || PadL(Str(nBaseVal), 3) ||
  SalFmtFormatDateTime(dDatD, 'yyMMdd') || 
  SalFmtFormatDateTime(dDatP, 'yyMMdd') ||
  PadR(sNamA, 38)  ||
  PadR(sNamB, 38)  || 
  PadR(sNazn, 160) || 
  PadR(sDRec, 60)  || PadR('', 3) || PadR('11', 2) || 
  PadL(sOkpoA, 14) || PadL(sOkpoB, 14) || 
  PadL(Str(nRef), 9) || 
  PadR(IifS(nKod=2 OR sDCPSignType='UNI' OR isNbuBank, sIdOperDoc, sIdOperNBUDoc), 6) || ' 0' || Spac(8)
.head 5 +  Else
.head 6 -  Set sSignData = 
  PadL(sMfoA, 9) || PadL(sNlsA, 14) || 
  PadL(sMfoB, 9) || PadL(sNlsB, 14) || '1' || 
  PadL(Str(nS), 16) || PadL(Str(nVob), 2) || 
  PadR(StrWinToDosX(sNd), 10) || PadL(Str(nBaseVal), 3) ||
  SalFmtFormatDateTime(dDatD, 'yyMMdd') || 
  SalFmtFormatDateTime(dDatP, 'yyMMdd') ||
  PadR(StrWinToDosX(sNamA), 38)  ||
  PadR(StrWinToDosX(sNamB), 38)  || 
  PadR(StrWinToDosX(sNazn), 160) || 
  PadR(StrWinToDosX(sDRec), 60)  || PadR('', 3) || PadR('11', 2) || 
  PadL(sOkpoA, 14) || PadL(sOkpoB, 14) || 
  PadL(Str(nRef), 9) || 
  PadR(IifS(nKod=2 OR sDCPSignType='UNI' OR isNbuBank, sIdOperDoc, sIdOperNBUDoc), 6) || ' 0' || Spac(8)
.head 5 -  Return TRUE
.head 2 +  Window Parameters
.head 3 -  Number: nMode	! 2-формирование &A
		  4-подпись документов перед формированием &A
.head 3 -  Number: nPar
.head 3 -  String: strPar01
.head 3 -  String: strPar02
.head 2 +  Window Variables
.head 3 -  Date/Time: dBDat
.head 3 -  Number: nBaseVal
.head 3 -  Boolean: isNbuBank
.head 3 -  ! Переменные из ini-файла
.head 3 -  Number: nInterval
.head 3 -  String: strPathDCP_Out
.head 3 -  String: strPathDCP_O
.head 3 -  String: strPathDCP_T
.head 3 -  String: strBackUpDir
.head 3 -  String: sIdOperNBUFile
.head 3 -  String: sIdOperNBUDoc
.head 3 -  String: sDCPSignType
.head 3 -  String: strOpenKeyNBU
.head 3 -  !
.head 3 -  String: sOpenKeyDir
.head 3 -  !
.head 3 -  : ccDoc
.head 4 -  Class: cDocDCP
.head 3 -  Number: nTableRow
.head 3 -  Number: nColor
.head 3 -  Boolean: bMessA
.head 3 -  Boolean: bMessT
.head 3 -  !
.head 3 -  Boolean: fDestroy
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SetWindowFullSize(hWndForm)
.head 4 -  !
.head 4 -  Set isNbuBank = GetGlobalOption('NBUBANK') = '1'
.head 4 -  Set dBDat     = GetBankDate()
.head 4 -  Set nBaseVal  = GetBaseVal()
.head 4 -  Set nTableRow = TBL_MinRow
.head 4 -  !
.head 4 -  Call SalUseRegistry(FALSE, '')
.head 4 -  Set nInterval = SalGetProfileInt(INI_ElektroKlients, 'DCP_Interval', 600, GetIniFileName())
.head 4 -  ! DCP_OUT - для файлов &A
.head 4 -  Call SalGetProfileString(INI_ElektroKlients, 'DCP_OUT', '', strPathDCP_Out, GetIniFileName())
.head 4 -  ! DCP_O - для квитанций &OA
.head 4 -  Call SalGetProfileString(INI_ElektroKlients, 'DCP_O', '', strPathDCP_O, GetIniFileName())
.head 4 -  ! DCP_T - для квитанций &T
.head 4 -  Call SalGetProfileString(INI_ElektroKlients, 'DCP_T', '', strPathDCP_T, GetIniFileName())
.head 4 -  ! DCP_BackUpDir - для BACKUP &A, &OA, &T
.head 4 -  Call SalGetProfileString(INI_ElektroKlients, 'DCP_BackUpDir','',strBackUpDir, GetIniFileName())
.head 4 -  ! sIdOperNBUFile - ключ для подписи &A (по умолчанию-ключ операциониста)
.head 4 -  Call SalGetProfileString(INI_ElektroKlients, 'DCP_IdOper', SalStrReplaceX(GetIdOper(), 3, 1, 'B'), sIdOperNBUFile, GetIniFileName())
.head 4 -  ! DCPSignType - тип подписи для &A
.head 4 -  Call SalGetProfileString(INI_ElektroKlients, 'DCPSignType', 'NBU', sDCPSignType, GetIniFileName())
.head 4 -  ! sIdOperNBUDoc - ключ для подписи документа подписью NBU (по умолчанию-ключ операциониста)
Используется, напр., в Сбербанке (док. подписываются VEGA, а в файл надо NBU)
.head 4 -  Call SalGetProfileString(INI_ElektroKlients, 'DCP_IdOperDoc', GetIdOper(), sIdOperNBUDoc, GetIniFileName())
.head 4 -  ! OpenKeyNBU - путь ключей НБУ (внешняя подпись)
Используется, напр., в НБУ (док. подписываются UNI, файл &A - NBU)
.head 4 -  Call SalGetProfileString(INI_DigitalSignature, 'OpenKeyNBU', '.', strOpenKeyNBU, GetIniFileName())
.head 4 -  !
.head 4 -  Set ccDoc.sSignTypeDCP = sDCPSignType
.head 4 -  !
.head 4 -  Call SalDisableWindow(pbRefresh)
.head 4 -  Call SalDisableWindow(pbSearch)
.head 4 -  Call SalDisableWindow(pbFilter)
.head 4 -  Call SalDisableWindow(pbDetails)
.head 4 -  Set hWndForm.Tbl_DCPA.nFlags = GT_ReadOnly
.head 4 -  Set hWndForm.Tbl_DCPA.strPrintFileName = 'DCP_A'
.head 4 -  !
.head 4 +  If GetSignOn()
.head 5 +  If sDCPSignType = 'NBU' AND GetSignType() = 'NBU'
.head 6 -  Set sOpenKeyDir = GetOpenKeyDir()
.head 5 -  ! Для UNI и VEG
.head 5 +  Else
.head 6 -  Set sOpenKeyDir = strOpenKeyNBU
.head 5 -  Call SetSignType(sDCPSignType)
.head 4 -  !
.head 4 +  If nMode = 2
.head 5 -  Call SalSetWindowText(hWndForm, "ДЦП. Формування файлів А")
.head 5 -  Call SalSetWindowText(pbTimer, "A")
.head 5 -  Call SalHideWindow(hWndForm.Tbl_DCPA.colErrNBU)
.head 5 -  Call SalHideWindow(hWndForm.Tbl_DCPA.colNameErrNBU)
.head 5 -  Call SalHideWindow(hWndForm.Tbl_DCPA.colErrDEP)
.head 5 -  Call SalHideWindow(hWndForm.Tbl_DCPA.colNameErrDEP)
.head 5 -  ! Инициализация ключа sIdOperNBUFile для подписи &A
.head 5 -  Set fDestroy = FALSE
.head 5 +  If GetSignOn()
.head 6 -  Call ccDoc.fileSigner.SetVariables(
  sDCPSignType,
  sOpenKeyDir,
  GetSecretKeyDrv(),
  sIdOperNBUFile,
  GetKeyDate(),
  5 )
.head 6 -  Call SalMessageBox('Необходим ключ ' || sDCPSignType || ' ' || sIdOperNBUFile, 'Инициализация', MB_Ok)
.head 6 +  If NOT ccDoc.fileSigner.Init()
.head 7 -  Set fDestroy = TRUE
.head 7 -  Call MessageError("Ошибка инициализации")
.head 7 -  Return SalDestroyWindow(hWndForm)
.head 5 -  ! Запуск таймера
.head 5 -  Call pbTimer.Init(nInterval, 0, TRUE)
.head 4 +  Else If nMode = 4
.head 5 -  Call SalSetWindowText(hWndForm, "ДЦП. Підпис документів для формування файлів &A")
.head 5 -  Call SalDisableWindow(pbTimer)
.head 5 -  Call SalShowWindow(pbDocSign)
.head 5 -  Call SalHideWindow(pbTimer)
.head 5 -  Call SalHideWindow(hWndForm.Tbl_DCPA.colErrNBU)
.head 5 -  Call SalHideWindow(hWndForm.Tbl_DCPA.colNameErrNBU)
.head 5 -  Call SalHideWindow(hWndForm.Tbl_DCPA.colErrDEP)
.head 5 -  Call SalHideWindow(hWndForm.Tbl_DCPA.colNameErrDEP)
.head 5 +  If GetSignOn()
.head 6 -  Call ccDoc.SetVariablesDCPIdOperDocNBU(
  sDCPSignType,
  sOpenKeyDir,
  GetSecretKeyDrv(),
  sIdOperNBUDoc,
  GetKeyDate(),
  5 )
.head 5 +  Else
.head 6 -  Set fDestroy = TRUE
.head 6 -  Call MessageInfo("Не включен режим подписи")
.head 6 -  Return SalDestroyWindow(hWndForm)
.head 4 +  Else If nMode = 6
.head 5 -  Call SalSetWindowText(hWndForm, "ДЦП. Прийом квитанцій Т")
.head 5 -  Call SalSetWindowText(pbTimer, "T")
.head 5 -  ! Запуск таймера
.head 5 -  Call pbTimer.Init(nInterval, 0, TRUE)
.head 4 -  Call ShowApdVersion(hWndForm, AppForm_DCPA)
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 4 -  !
.head 4 -  Call SalSendClassMessage(SAM_Create, 0, 0)
.head 4 -  Call SalWaitCursor(FALSE)
.head 3 +  On SAM_CreateComplete
.head 4 -  Call SalSendClassMessage(SAM_CreateComplete, 0, 0)
.head 4 +  If NOT fDestroy
.head 5 +  If nMode = 2 or nMode = 6
.head 6 -  Call SalSendMsg(pbTimer, UM_TimerFired, 0, 0)
.head 3 +  On SAM_Destroy
.head 4 -  Call SalSendClassMessage(SAM_Destroy, 0, 0)
.head 4 +  If nMode = 2
.head 5 -  Call ccDoc.fileSigner.Deinit()
.head 4 +  Else If nMode = 4
.head 5 -  Call ccDoc.DeinitDCPIdOperDocNBU()
.head 1 +  Table Window: Tbl_DCPState	! 03 - ДЦП. Состояние платежей
.head 2 -  Class: cGenericTable
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: ДЦП. Стан платежів
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? Class Default
.head 2 -  Visible? Class Default
.head 2 -  Display Settings
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Class Default
.head 3 -  Initial State: Class Default
.head 3 -  Maximizable? Class Default
.head 3 -  Minimizable? Class Default
.head 3 -  System Menu? Class Default
.head 3 -  Resizable? Class Default
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  Class Default
.head 4 -  Width Editable? Class Default
.head 4 -  Height: 5.702"
.head 4 -  Height Editable? Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 3 -  View: Class Default
.head 3 -  Allow Row Sizing? Class Default
.head 3 -  Lines Per Row: Class Default
.head 2 -  Memory Settings
.head 3 -  Maximum Rows in Memory: Class Default
.head 3 -  Discardable? Class Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Class Default
.head 4 -  Location? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Size: Class Default
.head 4 -  Size Editable? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 3 +  Contents
.head 4 +  Pushbutton: pbIns
.head 5 -  Class Child Ref Key: 33
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDel
.head 5 -  Class Child Ref Key: 34
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 35
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbUpdate
.head 5 -  Class Child Ref Key: 36
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 2099
.head 5 -  Class Child Ref Key: 37
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbSearch
.head 5 -  Class Child Ref Key: 38
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbFilter
.head 5 -  Class Child Ref Key: 44
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDetails
.head 5 -  Class Child Ref Key: 39
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbPrint
.head 5 -  Class Child Ref Key: 40
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 2100
.head 5 -  Class Child Ref Key: 41
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 42
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 2101
.head 5 -  Class Child Ref Key: 43
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 2 +  Contents
.head 3 +  Column: colId
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Id
.head 4 -  Visible? No
.head 4 -  Editable? Yes
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Left
.head 4 -  Width:  Default
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: colFNameP
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Файл &P
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  1.4"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: colDatP
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Час створення
файлу &P
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Date/Time
.head 4 -  Justify: Center
.head 4 -  Width:  1.6"
.head 4 -  Width Editable? Yes
.head 4 -  Format: DateTime
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: colRef
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Референс
документа
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Left
.head 4 -  Width:  1.2"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: colFNameA
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Файл &A
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  1.4"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: colDatA
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Час створення
файлу &A
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Date/Time
.head 4 -  Justify: Center
.head 4 -  Width:  1.6"
.head 4 -  Width Editable? Yes
.head 4 -  Format: DateTime
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: colFNameT
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Квитанція
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  1.4"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: colDatT
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Час створення
квитанції
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Date/Time
.head 4 -  Justify: Center
.head 4 -  Width:  1.6"
.head 4 -  Width Editable? Yes
.head 4 -  Format: DateTime
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: colErrNBU
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Помилка
АРМ-НБУ
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Center
.head 4 -  Width:  1.2"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: colErrDEP
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Помилка
Депозитарія
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Center
.head 4 -  Width:  1.2"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Number: nMode
.head 3 -  Number: nPar
.head 3 -  String: strPar01
.head 3 -  String: strPar02
.head 2 +  Window Variables
.head 3 -  String: sTmp
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalSetWindowText(hWndForm, "ДЦП. Стан платежів")
.head 4 -  Call ShowApdVersion(hWndForm, AppForm_DCPState)
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 4 -  Call SetWindowFullSize(hWndForm)
.head 4 -  Set Tbl_DCPState.nFlags = GT_ReadOnly
.head 4 -  Set Tbl_DCPState.strPrintFileName = 'DCPState'
.head 4 -  Set Tbl_DCPState.strFilterTblName = 'DCP_P'
.head 4 -  Set Tbl_DCPState.strSqlPopulate =
"SELECT dcp_p.id, dcp_p.ref, dcp_p.fn, dcp_p.dat, dcp_p.fna, dcp_p.data, 
        dcp_p.fnt, dcp_p.datt, dcp_p.err_nbu, dcp_p.err_dep 
   INTO :Tbl_DCPState.colId,     :Tbl_DCPState.colRef, 
        :Tbl_DCPState.colFNameP, :Tbl_DCPState.colDatP, 
        :Tbl_DCPState.colFNameA, :Tbl_DCPState.colDatA, 
        :Tbl_DCPState.colFNameT, :Tbl_DCPState.colDatT, 
        :Tbl_DCPState.colErrNBU, :Tbl_DCPState.colErrDEP 
   FROM dcp_p 
  ORDER BY dcp_p.ref desc"
.head 4 -  Call SalSendClassMessage(SAM_Create, 0, 0)
.head 3 -  ! UM_Populate оставить, т.к. в классе ф-ция T(str) меняет data->datd
.head 3 +  On UM_Populate
.head 4 +  If strSqlPopulate != ''
.head 5 +  If fFilterAtStart
.head 6 -  Set fFilterAtStart = NOT fFilterAtStart
.head 6 +  If NOT SetQueryFilter(cF)
.head 7 -  Call SalDestroyWindow(hWndForm)
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  Call SalTblDefineSplitWindow(hWndForm, 0, FALSE)
.head 5 -  Set strDSql = cQ.GetFullSQLString(cF)
.head 5 -  Call BindList.ActivateBinds()
.head 5 -  Call SalTblPopulate(hWndForm, cMain.hSql(), strDSql, nTabPopulateMethod)
.head 5 -  Call SalTblSetContext(hWndForm, 0)
.head 5 -  Call SalPostMsg(hWndForm, SAM_TblDoDetails, 0, 0)
.head 5 -  Call VisTblAutoSizeColumn(hWndForm, hWndNULL)
.head 5 -  Call SalWaitCursor(FALSE)
.head 3 +  On SAM_FetchRowDone
.head 4 -  ! Документ есть, &A нет (док. не завизирован) - зеленый
.head 4 +  If colRef != NUMBER_Null AND colFNameA = STRING_Null
.head 5 -  Call SalTblSetCellTextColor(colRef,   COLOR_DarkGreen,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colFNameP,COLOR_DarkGreen,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colDatP,  COLOR_DarkGreen,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colFNameA,COLOR_DarkGreen,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colDatA,  COLOR_DarkGreen,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colFNameT,COLOR_DarkGreen,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colDatT,  COLOR_DarkGreen,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colErrNBU,COLOR_DarkGreen,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colErrDEP,COLOR_DarkGreen,FALSE)
.head 4 -  ! &A есть, &T нет - синий
.head 4 +  If colFNameA != STRING_Null AND colFNameT = STRING_Null
.head 5 -  Call SalTblSetCellTextColor(colRef,   COLOR_DarkBlue,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colFNameP,COLOR_DarkBlue,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colDatP,  COLOR_DarkBlue,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colFNameA,COLOR_DarkBlue,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colDatA,  COLOR_DarkBlue,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colFNameT,COLOR_DarkBlue,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colDatT,  COLOR_DarkBlue,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colErrNBU,COLOR_DarkBlue,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colErrDEP,COLOR_DarkBlue,FALSE)
.head 4 -  ! квитанция с ошибкой - красный
.head 4 +  If colErrNBU != STRING_Null AND colErrNBU != '0000' 
OR colErrDEP != STRING_Null AND colErrDEP != '0000'
.head 5 -  Call SalTblSetCellTextColor(colRef,   COLOR_Red,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colFNameP,COLOR_Red,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colDatP,  COLOR_Red,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colFNameA,COLOR_Red,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colDatA,  COLOR_Red,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colFNameT,COLOR_Red,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colDatT,  COLOR_Red,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colErrNBU,COLOR_Red,FALSE)
.head 5 -  Call SalTblSetCellTextColor(colErrDEP,COLOR_Red,FALSE)
.head 3 +  On SAM_DoubleClick
.head 4 -  ! colFNameP = '' для документов из arc_rrp
.head 4 +  If Tbl_DCPState.colFNameP != STRING_Null AND Tbl_DCPState.colRef != NUMBER_Null
.head 5 -  Call DocViewContentsEx(hWndMDI, Tbl_DCPState.colRef)
.head 3 +  On SAM_RowHeaderClick
.head 4 -  Set sTmp = ""
.head 4 -  ! Документ есть, &A нет (док. не завизирован) - зеленый
.head 4 +  If colRef != NUMBER_Null AND colFNameA = STRING_Null
.head 5 -  Set sTmp = "Документ не завізовано"
.head 4 -  ! &A есть, &T нет - синий
.head 4 +  If colFNameA != STRING_Null AND colFNameT = STRING_Null
.head 5 -  Set sTmp = "Немає квитанції T"
.head 4 -  ! квитанция с ошибкой - красный
.head 4 +  If colErrNBU != STRING_Null AND colErrNBU != '0000' 
OR colErrDEP != STRING_Null AND colErrDEP != '0000'
.head 5 -  Set sTmp = "Зквитовано з помилкою"
.head 4 -  Call XSalTooltipSetColors(SalColorGet(colRef, COLOR_IndexCellText), COLOR_LightGray)
.head 4 -  Call XSalTooltipShow(hWndForm, sTmp)
.head 4 -  Call XSalTooltipSetColors(COLOR_Black, COLOR_White)
