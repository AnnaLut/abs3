Application Description: •--------------------------------------•
		• REP_DKU.APL - Выходные формы         •
		•--------------------------------------•
		• Выходные формы код приложения - RPBN •
		• ООО Унити-Барс (C) 1996-1999         •
		• Разработчики: Марценюк М.П.,         •
		•               Сухова Т.А.            •
		•--------------------------------------•
	Outline Version - 4.0.26
	Design-time Settings
.data VIEWINFO
0000: 6F00000001000000 FFFF01000D004347 5458566965775374 6174650400010000
0020: 00000000009E0000 002C000000030000 0003000000000000 005A020000F8FFFF
0040: FFE1FFFFFF000000 00000000002C0300 0064020000010000 0001000000010000
0060: 000F4170706C6963 6174696F6E497465 6D00000000
.enddata
.data DT_MAKERUNDLG
0000: 0200000000001C51 3A5C424152533938 5C4C494252415259 5C4162736170692E
0020: 646C6C1C513A5C42 41525339385C4C49 42524152595C4162 736170692E617063
0040: 00000101011C513A 5C4241525339385C 4C4942524152595C 4162736170692E72
0060: 756E1C513A5C4241 525339385C4C4942 524152595C416273 6170692E646C6C1C
0080: 513A5C4241525339 385C4C4942524152 595C416273617069 2E61706300000101
00A0: 01175C4241525339 385C42494E5C7265 705F646B752E6170 64165C4241525339
00C0: 385C42494E5C4162 736170692E646C6C 165C424152533938 5C42494E5C416273
00E0: 6170692E61706300 00010101001C513A 5C4241525339385C 4C4942524152595C
0100: 4162736170692E64 6C6C1C513A5C4241 525339385C4C4942 524152595C416273
0120: 6170692E61706300 00010101
.enddata
		Outline Window State: Normal
		Outline Window Location and Size
.data VIEWINFO
0000: 6600040003002D00 0000000000000000 0000B71E5D0E0500 1D00FFFF4D61696E
0020: 0000000000000000 0000000000000000 0000003B00010000 00000000000000E9
0040: 1E800A00008600FF FF496E7465726E61 6C2046756E637469 6F6E730000000000
0060: 0000000000000000 0000000000003200 0100000000000000 0000E91E800A0000
0080: DF00FFFF56617269 61626C6573000000 0000000000000000 0000000000000000
00A0: 3000010000000000 00000000F51E100D 0000F400FFFF436C 6173736573000000
00C0: 0000000000000000 0000000000000000
.enddata
.data VIEWSIZE
0000: D000
.enddata
			Left:   -0.013"
			Top:    0.0"
			Width:  8.013"
			Height: 4.969"
		Options Box Location
.data VIEWINFO
0000: 1018B80BB80B2500
.enddata
.data VIEWSIZE
0000: 0800
.enddata
			Visible? Yes
			Left:   4.15"
			Top:    1.885"
			Width:  3.8"
			Height: 2.073"
		Class Editor Location
			Visible? No
			Left:   0.575"
			Top:    0.094"
			Width:  5.063"
			Height: 2.719"
		Tool Palette Location
			Visible? No
			Left:   6.388"
			Top:    0.729"
		Fully Qualified External References? Yes
		Reject Multiple Window Instances? No
		Enable Runtime Checks Of External References? Yes
		Use Release 4.0 Scope Rules? No
	Libraries
		Dynalib: Global.apd
		Dynalib: Message.apd
		Dynalib: Absapi.apd
		Dynalib: nsiapi.apd
		!
		File Include: Constant.apl
		File Include: Gentbl.apl
		! File Include: Vtcal.apl	
		File Include: Genbutn.apl
		File Include: Winbars2.apl
		!
		! File Include: qckdvc.apl
		File Include: Vtarray.apl
		File Include: Vtcal.apl
		File Include: Vtfile.apl
		File Include: vtdos.apl
		File Include: vttblwin.apl
		File Include: VTCOMDLG.APL
		File Include: XSALSPL.APL
		File Include: VTMETER.APL
		File Include: XSALCPT.APL
		File Include: XSALIMG.APL
		File Include: GENLIST.APL
		File Include: GENTBLD.APL
		! File Include: strfnc.apl
		File Include:
		Dynalib: DOCVIEW.Apd
	Global Declarations
		Window Defaults
			Tool Bar
				Display Style? Etched
				Font Name: MS Sans Serif
				Font Size: 8
				Font Enhancement: System Default
				Text Color: System Default
				Background Color: System Default
			Form Window
				Display Style? Etched
				Font Name: MS Sans Serif
				Font Size: 8
				Font Enhancement: System Default
				Text Color: System Default
				Background Color: System Default
			Dialog Box
				Display Style? Etched
				Font Name: MS Sans Serif
				Font Size: 8
				Font Enhancement: System Default
				Text Color: System Default
				Background Color: System Default
			Top Level Table Window
				Font Name: MS Sans Serif
				Font Size: 8
				Font Enhancement: System Default
				Text Color: System Default
				Background Color: System Default
			Data Field
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Multiline Field
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Spin Field
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Background Text
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Pushbutton
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
			Radio Button
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Check Box
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Option Button
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
			Group Box
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Child Table Window
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			List Box
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Combo Box
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Line
				Line Color: Use Parent
			Frame
				Border Color: Use Parent
				Background Color: 3D Face Color
			Picture
				Border Color: Use Parent
				Background Color: Use Parent
		Formats
			Number: 0'%'
			Number: #0
			Number: ###000
			Number: ###000;'($'###000')'
			Date/Time: hh:mm:ss AMPM
			Date/Time: M/d/yy
			Date/Time: MM-dd-yy
			Date/Time: dd-MMM-yyyy
			Date/Time: MMM d, yyyy
			Date/Time: MMM d, yyyy hh:mm AMPM
			Date/Time: MMMM d, yyyy hh:mm AMPM
			Input: 99/99/99
			Number: ###00000
			Date/Time: dd/MM/yyyy
			Date/Time: dd/MM/yy
			Number: #00
			Number: #000
			Date/Time: dd-mm-yyyy hh:mm:ss
			Date/Time: dd-MM-yy hh:mm:ss
		External Functions
			Library name: IctBob.Dll
				Function: llopen
					Description: открытие файла (C++)
					Export Ordinal: 0
					Returns
						Number: HANDLE
					Parameters
						! первый параметр: имя файла,
								  второй: тип открытия
						String: LPCSTR
						Number: INT
				Function: llcreat
					Description: создание файла (C++)
					Export Ordinal: 0
					Returns
						Number: HANDLE
					Parameters
						! первый параметр: имя файла,
								  второй: тип открытия
						String: LPCSTR
						Number: INT
				Function: llclose
					Description: закрытие файла (C++)
					Export Ordinal: 0
					Returns
						Number: HANDLE
					Parameters
						Number: HANDLE
				Function: llread
					Description: чтение файла (C++)
					Export Ordinal: 0
					Returns
						Number: UINT
					Parameters
						Number: HANDLE
						String: LPVOID
						Number: UINT
				Function: llwrite
					Description:
					Export Ordinal: 0
					Returns
						Number: UINT
					Parameters
						Number: HANDLE
						String: LPCSTR
						Number: UINT
				Function: lllseek
					Description:
					Export Ordinal: 0
					Returns
						Number: LONG
					Parameters
						Number: HANDLE
						Number: LONG
						Number: INT
				Function: llstr2str
					Description: преобразование строки HEXtoBIN
					Export Ordinal: 0
					Returns
					Parameters
						String: LPSTR
						Receive String: LPVOID
						Number: ULONG
			Library name: HARAKIRI.DLL
				Function: DeleteBadSymbols
					Description: Удаляет из файла отчета ненужные символы
							и добавляет в него Esc-последовательности
							Параметры:
								Имя файла,
								Строка Esc-последовательностей
								Флаг удаления символа с кодом 12
								Флаг удаления пустых строк (3 и более пустых строки заменяются одной)
					Export Ordinal: 0
					Returns
						Boolean: BOOL
					Parameters
						String: LPSTR
						String: LPSTR
						Boolean: BOOL
						Boolean: BOOL
		Constants
.data CCDATA
0000: 3000000000000000 0000000000000000 00000000
.enddata
.data CCSIZE
0000: 1400
.enddata
			System
			User
				! тип агрегирования территорий для отчетности
				Number: REPAGG_SVOD = 1  ! -  свод  по всем территориям
				Number: REPAGG_SEL  = 2  ! -  выбранные территории
				Number: REPAGG_ALL  = 3  ! -  все территории
				Number: REPAGG_SVOD_AND_SEL  = 4  ! -  свод + выбранные территории
				Number: REPAGG_SVOD_AND_ALL  = 5  ! -  свод + все
				!
		Resources
		Variables
			! ! ===========================================================
			Window Handle: hWin0
			Window Handle: hWin1
			Window Handle: hWin2
			Window Handle: hWin7
			Window Handle: hWin8
			! ! ===========================================================
			! ! - - - - - - - Переменные которые стоит сдесь оставить- - - - - - - - -
			! ! ===========================================================
			Number: ID                      !! Код пользователя из staff
			String: IDNAME                  !! Имя пользователя из staff
			String: app                     !! Код текущего приложения
			String: strRepDate              !! Дата отчета
			String: strBankDate
			String: SHAP                     !! шапка отчета
			String: AMFO                     !! Наше МФО
			String: AQH                      !!  Наименование нашего банка
			String: DRUK                     !! Строка для отчета типа  'Printed : ..... '
			Number: FL_FORMAT      !!  если true - печать в rtf формате
			Number: bFLS                    !! = TRUE без перекодировки, FALSE - с перекодировкой
			String: strBind                      !! Для Print ReportToFile
			String: strInput                     !! Для Print ReportToFile
					
			! ! - - - - - - - - - -рабочие переменные - счетчики - - - - - - - - - - - - - - -
			String: rab
			Number: nInd
			Number: nRet
			Number: nRowType
			Number: nFetchRes
			! - - - - - - - - - - - - Поскольку в таблице report в поле param остались переменные - -
					! - - - - - - - - - - - - sFdat и sFdat2  -  оставим эти переменные - - - - - - - - - - - - - - - - - -
			String: sFdat          !! Дата отчета с (MM-DD-YYYY)
			String: sFdat2         !! Дата отчета по (MM-DD-YYYY)
					
					
			! ! ===========================================================
			! ! ===========================================================
			! ! - - - - - - - Новые переменные - - - - - - - - - - - -
			! ! ===========================================================
			Number: nDay
			Number: nMonth
			Number: nYear
			String: strDateFrom              !! Дата отчета с (DD-MM-YYYY)
			String: strDateTo                  !! Дата отчета по (DD-MM-YYYY)
			String: strMonth[12]              !! Наименов. месяце для календаря
			String: strWeekDays[7]         !! Дни недели для календаря
					
			String: strFileNameTxt          !! Имя файла отчета для TXT
			String: strFileNameRtf          !! Имя файла отчета для RTF
					
			String: strTmplPath               !! Путь + имя файла отчета-шаблона (*.qrp)
			String: strPrintPath               !!  директория куда печатать отчет (=GetPrintDir, а если значение в поле path таблицы report не пустое, тогда это значение)
					
			String: sDeviceDef                !! Параметры для печати отчета (*.rtf)
			String: sDriverDef                  !!  - -//- -
			String: sPortDef                      !!  - -//- -
			String: sDriverDefo                !!  - -//- -
					
					
			String: lstFiles[*]                 !! список выбранных файлов
			Number: nFiles                   !! кол-во выбранных файлов
			Number: nRepFileType             ! тип отчета -- =1 - QRP   !-- =2 - tхt 
			! ! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
			Number: nLevel                          !! кол-во уровней для отчетности (=1 - районы, 2 районы + сельские рады, 3 -районы + сельские рады+cела)
			Number: nCurRep                      !! Если выбрали несколько отчетов - сдесь храниться текущий
			Number: nAvtoGen                    !! Если выбрали несколько отчетов - этот параметр принимает кол-во выбраных (автогенерация)
			Window Handle: hWndDKU   !! Хендл окна frm_DKU
			Number: nPar1                            !! Номер отчета - вынесен сюда из frm_DKU для авто создания отчетов
			String: strPureMask                   !!
			String: strDBFStruct                  !! Струтктура dbf файла 
			File Handle: hSqlA                    !! Хендл на DBF файл  
			String: strDBFValues                  !! Строка значений для вставки в DBF
			String: strDBFFilesToRename[*]        !! Список DBF файлов для переименования (для 412 DBF)
			Number: nCouDBFFilesToRename          !! Кол-во DBF файлов для переименования (для 412 DBF)
			! ! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
		Internal Functions
			Function: ShowOutFormsDKU		! __exported
				Description:
				Returns
				Parameters
					Window Handle: hW
					Number: nMode
					Number: nPar
				Static Variables
				Local variables
				Actions
					!
					If nPar = 0
						If not IsWindow(hWin0)
							Set hWin0 = SalCreateWindow(frm_DKU, hW )
						Else
							Call SalBringWindowToTop(frm_DKU)
					Else If nPar = 1
						If not IsWindow(hWin1)
							Set hWin1 =  SalCreateWindow(frm_Out, hW, 0)
						Else
							Call SalBringWindowToTop(frm_Out)
					Else If nPar = 2
						If not IsWindow(hWin2)
							Set hWin2 =  SalCreateWindow(KL, hW, 0)
						Else
							Call SalBringWindowToTop(KL)
					Else If nPar = 3
						Call SalModalDialog(FormVW, hW)
					Else If nPar = 31
						Call SalModalDialog(FormVWV, hW)
					Else If nPar = 32
						Call SalModalDialog(FormVWN, hW)
					Else If nPar = 4
						Call SalModalDialog(Form412, hW)
					Else If nPar = 5
						Call SalModalDialog(FormFZ, hW)
					Else If nPar = 6
						Call SalModalDialog(dlg_SobakiBe, hW)
					!
					Else If nPar = 7  !! Форма выбора территорий 
						If not IsWindow(hWin1)
							Set hWin1 =  SalCreateWindow(frm_Out, hW, 1)
						Else
							Call SalBringWindowToTop(frm_Out)
					Else If nPar = 80 !! Редактирование отчетных групп
						If not IsWindow(hWin1)
							Set hWin1 =  SalCreateWindow(tbl_RepGroups, hW, 1)
						Else
							Call SalBringWindowToTop(tbl_RepGroups)
					Else If nPar = 8  !! Редактирование отчетных групп  (MIK)
						If not IsWindow(hWin8)
							Set hWin8 =  SalCreateWindow(spl_RepGroups, hW, 1)
						Else
							Call SalBringWindowToTop(spl_RepGroups)
					Else If nPar = 9  !! Блокировка клиентов в клиент-казначействе - перенесено в bars029
						If not IsWindow(hWin1)
							Set hWin1 =  SalCreateWindow(frm_kl_blk, hW)
						Else
							Call SalBringWindowToTop(frm_kl_blk)
					Else If nPar = 10 !! Технологич. работы по клиент-казначейству - перенесено в bars029
						If not IsWindow(hWin1)
							Call SalModalDialog(dlg_kl_PostAll, hW)
						Else
							! Call SalBringWindowToTop(dlg_kl_PostAll)
					! Else If nPar = 11 !! Заключительная выписка ручной вариант
						                                                         If not IsWindow(hWin1)
							                                                         Call SalModalDialog(frm_VpOst, hW, 0)
						                                                         Else 
							                                                         Call SalBringWindowToTop(frm_VpOst)
					! Else If nPar = 12 !! Заключительная выписка автомат
						                                                         If not IsWindow(hWin1)
							                                                         Call SalModalDialog(frm_VpOst, hW, 1)
						                                                         Else 
							                                                         Call SalBringWindowToTop(frm_VpOst)
					! Else If nPar = 13 !! Просмотр файлов клиент-банка
						                                                          If not IsWindow(hWin1)
							                                                          Set hWin1 =  SalCreateWindow(tblKlbFiles, hW)
						                                                          Else 
							                                                          Call SalBringWindowToTop(tblKlbFiles)
			! Function: Maska_NLS
				                                                                                                           Description: 
				                                                                                                           Returns 
					                                                                                                           String: 
				                                                                                                           Parameters 
					                                                                                                           String: slovo
				                                                                                                           Static Variables 
					                                                                                                           String: mas
				                                                                                                           Local variables 
				                                                                                                           Actions 
					                                                                                                           Set mas = '*'
					                                                                                                           Call SalModalDialog(dlg_mas, hWndForm, mas, slovo)
					                                                                                                           Return mas
			Function: Tmp_Kurs
				Description: !! построение временной таблицы лнкыщв на заданную дату
				Returns
					Boolean:
				Parameters
					Receive String: sid
					String: sdat
				Static Variables
				Local variables
					Boolean: fl
					String: sTmp
					String: sSql
					Number: nTmp
				Actions
					Set sTmp=SalStrTrimX(SalStrUpperX( GetDBMS() ))
					Set sid='t2_'|| Str(GetUserId())
					If sTmp ='ORACLE'
						Set sSql="SELECT table_name INTO :sTmp FROM user_tables WHERE table_name=:sid"
					Else
						Set sSql="SELECT tabname INTO :sTmp FROM systables WHERE tabname=:sid"
					! Вычитали из системной таблицы имя временной таблицы
					Call SqlPrepareAndExecute( hSqlAux(),sSql)
					! Удалить если есть
					If SqlFetchNext( hSqlAux(), nTmp )
						Call SqlPrepareAndExecute( hSqlAux(),"DROP table "||sid )
					! Создать временную
					Call SqlPrepareAndExecute( hSqlAux(),
							 "CREATE table "||sid||"(kv int PRIMARY KEY, kurs decimal(20,10) )")
					! Населить временную
					If sTmp ='ORACLE'
						Call SqlPrepareAndExecute( hSqlAux(),
								 T("INSERT INTO "||sid||"(kv,kurs)
								    SELECT c.kv, c.rate_o/c.bsum
								    FROM  cur_rates c
								    WHERE (c.kv,c.vdate)=
								          (SELECT u.kv,max(u.vdate)
								           FROM cur_rates u
								           WHERE u.kv=c.kv and u.vdate<= :sdat
								           GROUP BY u.kv) ") )
					Else
						Call SqlPrepareAndExecute( hSqlAux(),
								 T("INSERT INTO "||sid||"(kv,kurs)
								    SELECT c.kv, c.rate_o/c.bsum
								    FROM  cur_rates c
								    WHERE c.vdate=
								          (SELECT max(u.vdate)
								           FROM cur_rates u
								           WHERE u.kv=c.kv and u.vdate<= :sdat) ") )
					!
					Call SqlPrepareAndExecute( hSqlAux(),"commit" )
					Return fl
			Function: NumberToStrFormat
				Description: !! Превращает число в строку заданной длины (nLen) - дополняя впереди нулями
				Returns
					String: strVal
				Parameters
					Number: nVal
					Number: nLen
					String: strChar
				Static Variables
				Local variables
					Number: i
					String: strVal
				Actions
					Set i=10
					Set strVal = SalNumberToStrX(nVal,0)
					Loop
						If i  > SalNumberPower (10 , nLen - 1)
							Return strVal
							Break
						If nVal < i
							Set strVal =  strChar || strVal
						Set i = i * 10
			Function: StrToStrFormat
				Description: !! Превращает строку в строку заданной длины (nLen) - дополняя впереди символом
				Returns
					String: strVal
				Parameters
					String: sVal
					Number: nLen
					String: strChar
					Boolean: bAlign ! - -  true = right,   false = left
				Static Variables
				Local variables
					Number: i
					String: strRet
				Actions
					Set i=SalStrLength(sVal)
					Set strRet = sVal
					While i < nLen
						If bAlign
							Set strRet = strChar||strRet
						Else
							Set strRet =strRet|| strChar
						Set i=i+1
					Return strRet
			Function: GetPureFileMask
				Description: !!  выполняет - если в поле reports mask=vd1*.* => тогда  = vd1
				Returns
					String: strRet
				Parameters
					String: strMaskIn
				Static Variables
				Local variables
					Number: i
					String: strRet
				Actions
					Set strRet =SalStrLeftX(strMaskIn, SalStrScan(strMaskIn,'*') )
					Return strRet
			Function: Podgot_DKU
				Description: Подготовка во временных таблицах
				Returns
					Boolean:
				Parameters
					Number: ID
					String: strDA
					String: strDA2
					String: maska
					String: para
				Static Variables
				Local variables
					Date/Time: dRab
					Date/Time: dRab2
					String: ppp
					String: strRBSName
				Actions
					Set dRab = MMddyyyyToDate(strDA)
					Set dRab2 = MMddyyyyToDate(strDA2)
					Set ID = GetUserId()
					Set strRBSName = GetGlobalOption('BIG_SEG')
					If strRBSName
						! Make end of transaction and start new
						Call SqlCommit( hSql() )
						! to avoid error with set transaction...
						Call SqlPrepareAndExecute(hSql(), 'SET TRANSACTION USE ROLLBACK SEGMENT ' || SalStrUpperX( strRBSName ))
					If not SqlPLSQLCommand(hSql(), "P_dku" || para || " (ID,dRab,dRab2,maska)")
						Return FALSE
					If not SqlCommitEx(hSql(), 'Подготовка для печати DKU отчетов')
						Return FALSE
					Return TRUE
					Call SalWaitCursor(FALSE)
			Function: SetPrinter
				Description:
				Returns
				Parameters
					Number: nFlg !- 0: DefaultPrinter 1: Generic/Text Only 
				Static Variables
				Local variables
				Actions
					If nFlg=0
						Call SalPrtSetDefault(sDeviceDef, sDriverDef, sPortDef)
					If nFlg=1
						Call SalPrtSetDefault('Generic / Text Only', 'WINSPOOL', 'FILE:')
			Function: zarezDKU
				Description:
				Returns
				Parameters
					String: sFile
				Static Variables
				Local variables
				Actions
					Call SalWaitCursor(TRUE)
					! Set sC12 = ''
					! Set sESC = ''
					! If SqlPrepareAndExecute(hSql(), T('
							     SELECT cse,chr12
							     INTO :sESC,:sC12
							     FROM reprint
							     WHERE id=:nId and dvc=:sDevice'))
						                                                                                                              If SqlFetchNext(hSql(), nE)
							! Call Debug(sESC)
							                                                                                                              If Len(sESC) > 0
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<Esc>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 5, Chr(27))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<esc>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 5, Chr(27))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<ESC>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 5, Chr(27))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<Si>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 4, Chr(15))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<si>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 4, Chr(15))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<SI>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 4, Chr(15))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<So>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 4, Chr(14))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<so>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 4, Chr(14))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<SO>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 4, Chr(14))
									                                                                                                              Else 
										                                                                                                              Break 
								! Loop
									                                                                                                                      Set nL = At('<0>', sESC)
									                                                                                                                      If nL > 0
										                                                                                                                      Set sESC = Stuff(sESC, nL, 3, Chr(0))
									                                                                                                                      Else
										                                                                                                                      Break
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<1>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 3, Chr(1))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<2>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 3, Chr(2))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<4>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 3, Chr(4))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<ff>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 4, Chr(12))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<Ff>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 4, Chr(12))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<FF>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 4, Chr(12))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<Bel>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 5, Chr(7))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<bel>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 5, Chr(7))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<BEL>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 5, Chr(7))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<dc2>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 5, Chr(18))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<Dc2>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 5, Chr(18))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<DC2>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 5, Chr(18))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<dc4>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 5, Chr(20))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<Dc4>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 5, Chr(20))
									                                                                                                              Else 
										                                                                                                              Break 
								                                                                                                              Loop 
									                                                                                                              Set nL = At('<DC4>', sESC)
									                                                                                                              If nL > 0
										                                                                                                              Set sESC = Stuff(sESC, nL, 5, Chr(20))
									                                                                                                              Else 
										                                                                                                              Break 
								! Call Debug(sESC)
					Call DeleteBadSymbols(sFile,'', TRUE, TRUE)
					Call SalWaitCursor(FALSE)
		Named Menus
		Class Definitions
.data RESOURCE 0 0 1 1187014060
0000: E404000017020000 0000000000000000 0200000700FFFF01 00160000436C6173
0020: 73566172004F7574 6C696E6552006567 496E666F8F003C00 000F63004465736B
0040: 746F704C00697374 426F782201C00000 0B00000083010D00 0000FFFFE40D0000
0060: 01FE00FF831A0000 0001FB00FF0F2700 0000EE0100FF3F34 00B800000100FFFF
0080: E04100000001FE00 FF834E00000001FB 00FF0F5B000000EE 0100FF3F6800B800
00A0: 000100FFFFE07500 000001FE00FF8382 00000001FB00FF0F 0180340011000100
00C0: 000B63E04469724C 69036C0000000400 3C0000010DFB00FF 6F0D00EE0100FFBF
00E0: 1AB9000100FFFFE6 270001FE00FF4301 80270000E0020000 000F81547265654C
0100: 690F52000000F003 000000EC010D00FF BF0DB9000100FFFF E61A0001FE00FF43
0120: 01805B0000060300 0C634669F86C654C 41BA00000007009E 00010DFD00FF370D
0140: 0001F700FFDF1ADC 000100FF7F277300 0100FFFFCD340001 FD00FF37410001F7
0160: 00FFDF4EDC000100 FF7F01C080220000 000400000A634765 6E46690174657274
0180: 000000F604008802 0400000100FE00C1 8001000000BF04B1 00010D00FFFFE011
01A0: 00000002FE00FF83 1500000001FB00FF 8F01802281000500 00000BC647444669
01C0: 9F0004BD0002A300 0100007F80F20100 006F0400EC010D00 FFBF11B9000200FF
01E0: FFE6150001FE00FF 4301804100000006 0000000D635261E0 64696F4C69838600
0200: 0000053D00010DFB 00FF4F0D0000EE01 00FFBF1AB9000100 FFFFE6270001FE00
0220: FF9B340001FB00FF 0F
.enddata
			! Functional Class: cKtk
.winattr
.end
				                                                                                                                                                        Description: Класс территории казначества
				                                                                                                                                                        Derived From 
				                                                                                                                                                        Class Variables 
				                                                                                                                                                        Instance Variables 
					                                                                                                                                                        String: sKtk       !-- номер территории
					                                                                                                                                                        String: sKod       !-- часть от  ktk  = substr(ktk, -6, ..)
					                                                                                                                                                        String: sKtkName   !-- наименование территории
					                                                                                                                                                        Number: nDpiId     !-- номер налоговой
					                                                                                                                                                        String: sDpiName   !-- налоговой налоговой
					                                                                                                                                                        String: sId_Key    !-- неомер по tl_terra 
					                                                                                                                                                        Number: nParent  !-- родитель
					                                                                                                                                                        Number: sSvod    !-- = '4' - если для территории в подчиненных нету никого
							                 !-- = '1' - если в подчиненных - есть одна территория
							                 !-- = '0' - если в подчиненных - есть несколько территория
				                                                                                                                                                        Functions 
			! Functional Class: сKtkObl
.winattr
.end
				                                                                                                                                                        Description: Область со всеми своими территориями
				                                                                                                                                                        Derived From 
				                                                                                                                                                        Class Variables 
				                                                                                                                                                        Instance Variables 
					                                                                                                                                                        : Rn[*]  !-- районы
					                                                                                                                                                        : Sr[*]  !-- сель рада
					                                                                                                                                                        : Sl[*]  !-- село
					                                                                                                                                                        Number: nRn
					                                                                                                                                                        Number: nSr
					                                                                                                                                                        Number: nSl
				                                                                                                                                                        Functions 
					                                                                                                                                                        Function: Init
						                                                                                                                                                        Description: 
						                                                                                                                                                        Returns 
						                                                                                                                                                        Parameters 
							                                                                                                                                                        Number: nLevel
							! --- nLevel = 1 - есть районы
							! --- nLevel = 2 - есть сель рады
							! --- nLevel = 3 - есть села
						                                                                                                                                                        Static Variables 
						                                                                                                                                                        Local variables 
							                                                                                                                                                        String: sBigPayersMask
							                                                                                                                                                        String: sSql
							                                                                                                                                                        Number: i
							                                                                                                                                                        Number: k
							                                                                                                                                                        Number: nInd
						                                                                                                                                                        Actions 
							                                                                                                                                                        Call SalWaitCursor(TRUE)
							                                                                                                                                                        Set sBigPayersMask = GetGlobalOption('KTKMASK')                   
							                                                                                                                                                        Set nRn=0
							                                                                                                                                                        Set nSr=0
							                                                                                                                                                        Set nSl=0
							                                                                                                                                                        Set i=0
							! ======================================
							! ------ Выберем районы-----------
							! ======================================
							                                                                                                                                                        Set sSql =
									   " SELECT '*' kod, 0 id, '*********** ВСІ ***********' dpiname, 
									            '*********** ВСІ ***********' ktkname, 0 ktk, '0' id_key, '0' svod, 0 as sortid
									     INTO  :Rn[i].sKod,  :Rn[i].nDpiId,  :Rn[i].sDpiName, :Rn[i].sKtkName,  
									           :Rn[i].sKtk, :Rn[i].sId_Key, :Rn[i].sSvod, :k
									     FROM dual
									     UNION ALL
									     SELECT substr(ktk, -6, 2) kod, d.id id, d.name dpiname, id_key||' - '||k.name ktkname, 
									            ktk, id_key, '0' svod, 2 as sortid
									     FROM terrdpi t, dpa d,  ktk k
									     WHERE t.kod_dpi=d.id AND k.idt = t.ktk AND 
									           substr(ktk, -6,6)= substr(k.idt, -6,2)||'0000' " ||
									     IifS(sBigPayersMask!='', 
									           " 
									            UNION ALL
									            SELECT '"||sBigPayersMask||"' kod,  kod_dpi id, p.name dpiname,  
									                   'ВЕЛИКІ платники районів' ktkname, 0 ktk, '000' id_key, '0' svod, 1 as sortid                       
									            FROM dpa p, terrdpi, ktk
									            WHERE kod_dpi=p.id AND ktkmask=:sBigPayersMask AND 
									                  ktk.idt=ktk", 
									            "") || 
									     " ORDER BY sortid, kod, id "
							! Call Debug(sSql)
							                                                                                                                                                        Call SqlPrepareAndExecute(hSql(), sSql)   
							                                                                                                                                                        While SqlFetchNext ( hSql(), nInd )
								                                                                                                                                                        Set i = i + 1
							                                                                                                                                                        Set nRn = i
							! ======================================
							! ------ Выберем сельские рады-----------
							! ======================================
							                                                                                                                                                        Set i=0
							                                                                                                                                                        Set sSql =
									   " SELECT '*' kod, 0 id, '*********** ВСІ ***********' dpiname, 
									            '*********** ВСІ ***********' ktkname, 0 ktk, '0' id_key, '0' svod, 0 as sortid
									     INTO  :Sr[i].sKod, :Sr[i].nDpiId,  :Sr[i].sDpiName, :Sr[i].sKtkName,  
									           :Sr[i].sKtk, :Sr[i].sId_Key, :Sr[i].sSvod, :k
									     FROM dual
									     UNION ALL
									     SELECT substr(ktk, -6, 4) kod, d.id id, d.name dpiname, 
									            id_key||' - '||k.name ktkname, ktk, id_key, 
									            substr(iif_n(TR.cou,1, '4', '1', '0'),1,1) svod, 1 as sortid
									     FROM terrdpi t, dpa d,  ktk k,
									                 ( SELECT unique substr(ktk, -6,4) sr, count(*) cou
									                    FROM terrdpi, ktk WHERE idt=ktk
									                    GROUP BY  substr(ktk, -6,4)) TR
									     WHERE t.kod_dpi=d.id AND k.idt = t.ktk   AND   substr(ktk, -2,2)='00'
									                    AND TR.sr(+)=substr(ktk, -6,4)
									     ORDER BY sortid, kod , id  desc" 
							! Call Debug(sSql)
							                                                                                                                                                        Call SqlPrepareAndExecute(hSql(), sSql)   
							                                                                                                                                                        While SqlFetchNext ( hSql(), nInd )
								                                                                                                                                                        Set i = i + 1
							                                                                                                                                                        Set nSr = i
							! ======================================
							! ------ Выберем села - если они есть -----------
							! ======================================
							                                                                                                                                                        If nLevel = 3
								                                                                                                                                                        Set i=0
								                                                                                                                                                        Set sSql =
										   " SELECT  UNIQUE substr(ktk, -6,6) kod , d.id id , d.name dpiname, k.id_key||' - '||k.name ktkname, ktk, k.id_key, '1' svod 
										     INTO  :Sl[i].sKod, :Sl[i].nDpiId,  :Sl[i].sDpiName, 
										           :Sl[i].sKtkName,:Sl[i].sKtk, :Sl[i].sId_Key, , :Sl[i].sSvod
										     FROM terrdpi t, dpa d,  ktk k, ktk k2
										     WHERE t.kod_dpi=d.id AND k.idt = t.ktk AND
										           substr(ktk, -4,2)= substr(k2.idt, -4,2)
											   AND  substr(k2.idt, -6,2)=  substr(ktk, -6,2)
											   AND substr(k2.idt, -2,2)<>'00'
										     ORDER BY substr(ktk, -6,6) , d.id  " 
								                                                                                                                                                        Call SqlPrepareAndExecute(hSql(), sSql)   
								                                                                                                                                                        While SqlFetchNext ( hSql(), nInd )
									! Call Debug(Sl[i].sKod)
									                                                                                                                                                        Set i = i + 1
								                                                                                                                                                        Set nSl = i
							! ======================================
							! ------ Сделаем связку - дерево
							! ======================================
							! -- найдем родителей для сел
							                                                                                                                                                        If nLevel = 3
								                                                                                                                                                        Set i=0
								                                                                                                                                                        Set k=1
								                                                                                                                                                        While i < nSl
									                                                                                                                                                        Set Sl[i].nParent = -1
									                                                                                                                                                        While ( k < nSr )
										                                                                                                                                                        If Sr[k].sKod = SalStrLeftX(Sl[i].sKod, 4)
											                                                                                                                                                        Set Sl[i].nParent = k
											                                                                                                                                                        Break 
										                                                                                                                                                        Set k = k +1 
									                                                                                                                                                        Set i= i + 1
							! -- найдем родителей для сельских рад
							                                                                                                                                                        Set i=0
							                                                                                                                                                        Set k=0
							                                                                                                                                                        While i < nSr
								                                                                                                                                                        Set Sr[i].nParent = -1
								! Call Debug('rada - Sr['||SalNumberToStrX(i,0)||'].sKod='|| Sr[i].sKod )
								                                                                                                                                                        While ( k < nRn )
									! Call Debug('Rn['||SalNumberToStrX(k,0)||'].sKod='|| Rn[k].sKod )
									                                                                                                                                                        If Rn[k].sKod = SalStrLeftX(Sr[i].sKod, 2)
										                                                                                                                                                        Set Sr[i].nParent = k
										! Call Debug('For Sr[i].sKod: parent '||Rn[k].sKod)
										                                                                                                                                                        Break 
									                                                                                                                                                        Set k = k +1 
								                                                                                                                                                        Set i= i + 1
							                                                                                                                                                        Call SalWaitCursor(FALSE)
			Form Window Class: cGenericTableSpl3
.data CLASSPROPSSIZE
0000: 3C00
.enddata
.data CLASSPROPS
0000: 56543A53706C6974 746572002B000100 00000000000090B0 A800C8D8D8005880
0020: 7800020000000000 0000010000000100 0000000000000001 00000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				Title:
				Icon File:
				Accesories Enabled? Yes
				Visible? Class Default
				Display Settings
					Display Style? Default
					Visible at Design time? Yes
					Automatically Created at Runtime? No
					Initial State: Normal
					Maximizable? Class Default
					Minimizable? Class Default
					System Menu? Class Default
					Resizable? Class Default
					Window Location and Size
						Left:  
						Top:   
						Width:  15.017"
						Width Editable? Class Default
						Height: 7.345"
						Height Editable? Class Default
					Form Size
						Width:  Class Default
						Height: Class Default
						Number of Pages: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
				Next Class Child Key: 36
				List in Tool Palette? Yes
				Property Template:
				Class DLL Name:
				Description:
				Derived From
				Menu
				Tool Bar
					Display Settings
						Display Style? Class Default
						Location? Class Default
						Visible? Class Default
						Size: 0.427"
						Size Editable? Class Default
						Font Name: Class Default
						Font Size: Class Default
						Font Enhancement: Class Default
						Text Color: Class Default
						Background Color: Class Default
					Contents
						Pushbutton: pbIns
							Class Child Ref Key: 0
							Class ChildKey: 15
							Class: ctb_pbInsert
							Property Template:
							Class DLL Name:
							Title:
							Window Location and Size
								Left:   0.133"
								Top:    0.06"
								Width:  Class Default
								Width Editable? Class Default
								Height: Class Default
								Height Editable? Class Default
							Visible? Class Default
							Keyboard Accelerator: Class Default
							Font Name: Class Default
							Font Size: Class Default
							Font Enhancement: Class Default
							Picture File Name: \BARS98\RESOURCE\BMP\Insert.bmp
							Picture Transparent Color: Class Default
							Image Style: Class Default
							Text Color: Class Default
							Background Color: Class Default
							Message Actions
								On SAM_Create
									Set strTip = 'Вставить новую запись'
								On SAM_Click
									Call SalSendMsg(tbl, UM_Insert, 0, 0)
						Pushbutton: pbDel
							Class Child Ref Key: 0
							Class ChildKey: 16
							Class: ctb_pbDelete
							Property Template:
							Class DLL Name:
							Title:
							Window Location and Size
								Left:   0.583"
								Top:    0.06"
								Width:  Class Default
								Width Editable? Class Default
								Height: Class Default
								Height Editable? Class Default
							Visible? Class Default
							Keyboard Accelerator: Class Default
							Font Name: Class Default
							Font Size: Class Default
							Font Enhancement: Class Default
							Picture File Name:
							Picture Transparent Color: Class Default
							Image Style: Class Default
							Text Color: Class Default
							Background Color: Class Default
							Message Actions
								On SAM_Create
									Set strTip = 'Пометить/Снять пометку на удаление'
								On SAM_Click
									Call SalSendMsg(tbl, UM_Delete, 0, 0)
						Pushbutton: pbRefresh
							Class Child Ref Key: 0
							Class ChildKey: 17
							Class: ctb_pbRefresh
							Property Template:
							Class DLL Name:
							Title:
							Window Location and Size
								Left:   1.033"
								Top:    0.06"
								Width:  Class Default
								Width Editable? Class Default
								Height: Class Default
								Height Editable? Class Default
							Visible? Class Default
							Keyboard Accelerator: Class Default
							Font Name: Class Default
							Font Size: Class Default
							Font Enhancement: Class Default
							Picture File Name:
							Picture Transparent Color: Class Default
							Image Style: Class Default
							Text Color: Class Default
							Background Color: Class Default
							Message Actions
								On SAM_Create
									Set strTip = 'Перечитать записи в таблице'
								On SAM_Click
									Call SalSendMsg(tbl, UM_Populate, 0, 0)
						Pushbutton: pbUpdate
							Class Child Ref Key: 0
							Class ChildKey: 18
							Class: ctb_pbUpdate
							Property Template:
							Class DLL Name:
							Title:
							Window Location and Size
								Left:   1.483"
								Top:    0.06"
								Width:  Class Default
								Width Editable? Class Default
								Height: Class Default
								Height Editable? Class Default
							Visible? Class Default
							Keyboard Accelerator: Class Default
							Font Name: Class Default
							Font Size: Class Default
							Font Enhancement: Class Default
							Picture File Name:
							Picture Transparent Color: Class Default
							Image Style: Class Default
							Text Color: Class Default
							Background Color: Class Default
							Message Actions
								On SAM_Create
									Set strTip = 'Сохранить значения в базе данных'
								On SAM_Click
									Call SalSendMsg(tbl, UM_Update, 0, 0)
						Line
							Resource Id: 19263
							Class Child Ref Key: 0
							Class ChildKey: 19
							Class:
							Coordinates
								Begin X:  1.983"
								Begin Y:  0.417"
								End X:  1.983"
								End Y:  0.0"
							Visible? Yes
							Line Style: Etched
							Line Thickness: 1
							Line Color: 3D Shadow Color
						Pushbutton: pbSearch
							Class Child Ref Key: 0
							Class ChildKey: 20
							Class: ctb_pbSearch
							Property Template:
							Class DLL Name:
							Title:
							Window Location and Size
								Left:   2.083"
								Top:    0.06"
								Width:  Class Default
								Width Editable? Class Default
								Height: Class Default
								Height Editable? Class Default
							Visible? Class Default
							Keyboard Accelerator: Class Default
							Font Name: Class Default
							Font Size: Class Default
							Font Enhancement: Class Default
							Picture File Name:
							Picture Transparent Color: Class Default
							Image Style: Class Default
							Text Color: Class Default
							Background Color: Class Default
							Message Actions
								On SAM_Create
									Set strTip = 'Поиск по значению первичного ключа'
								On SAM_Click
									Call SalSendMsg(hWndForm, UM_Search, 0, 0)
						Pushbutton: pbFilter
							Class Child Ref Key: 0
							Class ChildKey: 21
							Class: ctb_pbFilter
							Property Template:
							Class DLL Name:
							Title:
							Window Location and Size
								Left:   2.533"
								Top:    0.06"
								Width:  Class Default
								Width Editable? Class Default
								Height: Class Default
								Height Editable? Class Default
							Visible? Class Default
							Keyboard Accelerator: Class Default
							Font Name: Class Default
							Font Size: Class Default
							Font Enhancement: Class Default
							Picture File Name:
							Picture Transparent Color: Class Default
							Image Style: Class Default
							Text Color: Class Default
							Background Color: Class Default
							Message Actions
								On SAM_Create
									Set strTip = 'Установить фильтр...'
								On SAM_Click
									If SetQueryFilter(tbl.cF)
										Call SalPostMsg(tbl, UM_Populate, 0, 0)
						Pushbutton: pbDetails
							Class Child Ref Key: 0
							Class ChildKey: 31
							Class: ctb_pbDetail
							Property Template:
							Class DLL Name:
							Title:
							Window Location and Size
								Left:   2.983"
								Top:    0.06"
								Width:  Class Default
								Width Editable? Class Default
								Height: Class Default
								Height Editable? Class Default
							Visible? Class Default
							Keyboard Accelerator: Class Default
							Font Name: Class Default
							Font Size: Class Default
							Font Enhancement: Class Default
							Picture File Name:
							Picture Transparent Color: Class Default
							Image Style: Class Default
							Text Color: Class Default
							Background Color: Class Default
							Message Actions
								On SAM_Create
									Set strTip = 'Подробная информация для строки таблицы'
								On SAM_Click
									Call SalSendMsg(tbl, UM_DoubleClick, 0, 0)
						Pushbutton: pbPrint
							Class Child Ref Key: 0
							Class ChildKey: 22
							Class: ctb_pbPrint
							Property Template:
							Class DLL Name:
							Title:
							Window Location and Size
								Left:   3.433"
								Top:    0.06"
								Width:  Class Default
								Width Editable? Class Default
								Height: Class Default
								Height Editable? Class Default
							Visible? Class Default
							Keyboard Accelerator: F5
							Font Name: Class Default
							Font Size: Class Default
							Font Enhancement: Class Default
							Picture File Name: \BARS98\RESOURCE\BMP\print.bmp
							Picture Transparent Color: Class Default
							Image Style: Class Default
							Text Color: Class Default
							Background Color: Class Default
							Message Actions
								On SAM_Create
									Set strTip = 'Печать таблицы'
								On SAM_Click
									Call SalSendMsg(hWndForm, UM_Print, 0, 0)
						Line
							Resource Id: 19264
							Class Child Ref Key: 0
							Class ChildKey: 23
							Class:
							Coordinates
								Begin X:  3.933"
								Begin Y:  0.417"
								End X:  3.933"
								End Y:  0.0"
							Visible? Yes
							Line Style: Etched
							Line Thickness: 1
							Line Color: 3D Shadow Color
						Pushbutton: pbExit
							Class Child Ref Key: 0
							Class ChildKey: 25
							Class: ctb_pbCancel
							Property Template:
							Class DLL Name:
							Title:
							Window Location and Size
								Left:   4.083"
								Top:    0.06"
								Width:  Class Default
								Width Editable? Class Default
								Height: Class Default
								Height Editable? Class Default
							Visible? Class Default
							Keyboard Accelerator: Esc
							Font Name: Class Default
							Font Size: Class Default
							Font Enhancement: Class Default
							Picture File Name:
							Picture Transparent Color: Class Default
							Image Style: Class Default
							Text Color: Class Default
							Background Color: Class Default
							Message Actions
								On SAM_Create
									Set strTip = 'Завершить работу'
								On SAM_Click
									Call SalSendMsg(hWndForm, UM_Close, 0, 0)
						Line
							Resource Id: 19265
							Class Child Ref Key: 0
							Class ChildKey: 26
							Class:
							Coordinates
								Begin X:  4.633"
								Begin Y:  0.417"
								End X:  4.633"
								End Y:  0.0"
							Visible? Yes
							Line Style: Etched
							Line Thickness: 1
							Line Color: 3D Shadow Color
				Contents
					Child Table: tbl
						Class Child Ref Key: 0
						Class ChildKey: 28
						Class:
						Property Template:
						Class DLL Name:
						Display Settings
							Window Location and Size
								Left:   0.1"
								Top:    0.071"
								Width:  5.683"
								Width Editable? Yes
								Height: 5.083"
								Height Editable? Yes
							Visible? Yes
							Font Name: Default
							Font Size: Default
							Font Enhancement: Default
							Text Color: Default
							Background Color: System Window Color
							View: Table
							Allow Row Sizing? No
							Lines Per Row: Default
						Memory Settings
							Maximum Rows in Memory: Default
							Discardable? No
						Contents
						Functions
							Function: GetFirstEditableColumn
								Description: Получить первую редактируюмую колонку
								Returns
									Window Handle:
								Parameters
									Window Handle: hWndTbl
								Static Variables
								Local variables
									Number: nCol
									Window Handle: hWndCol
								Actions
									Set nCol=1
									Loop
										Set hWndCol = SalTblGetColumnWindow(hWndTbl, nCol, COL_GetPos)
										If hWndCol=hWndNULL
											Break
										If SalTblQueryColumnFlags(hWndCol, COL_Editable) AND
												SalIsWindowVisible(hWndCol)
											Break
										Set nCol=nCol+1
									Return hWndCol
						Window Variables
							Window Handle: hCol
							!
							: cCstTab1
								Class: cABSTab
							: cMain
								Class: cABSConnect
							: cF
								Class: cGenFilter
							: cQ
								Class: cGenQuery
							String: strDSql
						Message Actions
							On UM_Create
								If nTabInstance1
									Call cCstTab1.Init(hWndItem, nTabInstance1, GetUserLoginName(), NOT fNoReposition1)
							On UM_Insert
								If NOT SalTblAnyRows(hWndForm, ROW_New, 0)
									Call SalTblDefineSplitWindow(hWndForm, 3, TBL_Split_Adjustable)
								Set nRow = SalTblInsertRow(hWndForm, TBL_MinRow)
								Set hCol = GetFirstEditableColumn(hWndForm)
								Call SalTblSetContext(hWndForm, nRow)
								Call SalTblSetFocusCell(hWndForm, nRow, hCol, 0, 1)
							On UM_Delete
								Set nRow = TBL_MinRow
								While SalTblFindNextRow(hWndForm, nRow, ROW_Selected, 0)
									If NOT SalTblQueryRowFlags(hWndForm, nRow, ROW_New)
										Call SalTblSetRowFlags(hWndForm, nRow, ROW_MarkDeleted,
												not SalTblQueryRowFlags(hWndForm, nRow, ROW_MarkDeleted))
									Else
										Call SalTblDeleteRow(hWndForm, nRow, TBL_NoAdjust)
							On UM_Populate
								If strSqlPopulate != ''
									If fFilterAtStart
										Call SetQueryFilter(cF)
										Set fFilterAtStart = NOT fFilterAtStart
									Call tbl.cQ.Init(strSqlPopulate)
									Call SalWaitCursor(TRUE)
									Call SalTblDefineSplitWindow(hWndForm, 0, FALSE)
									Set strDSql = cQ.GetFullSQLString(cF)
									Call SalTblPopulate(hWndForm, cMain.hSql(), T(strDSql), TBL_FillAll)
									Call SalTblSetContext(hWndForm, 0)
									Call SalPostMsg(hWndForm, SAM_TblDoDetails, 0, 0)
									Call SalWaitCursor(FALSE)
							On UM_Update
								Call SalWaitCursor(TRUE)
								Call SaveInfoToLog(MSG_SaveDataRef() || ' ' || strTitleAux)
								If strSqlDelete != ''
									Call SqlPrepare(cMain.hSql(), T(strSqlDelete))
									Call SalTblDoDeletes(hWndForm, cMain.hSql(), ROW_MarkDeleted)
								If strSqlInsert != ''
									Call SqlPrepare(cMain.hSql(), T(strSqlInsert))
									Call SalTblDoInserts(hWndForm, cMain.hSql(), TRUE)
								If strSqlUpdate != ''
									Call SqlPrepare(cMain.hSql(), T(strSqlUpdate))
									Call SalTblDoUpdates(hWndForm, cMain.hSql(), TRUE)
								Call SqlCommit(cMain.hSql())
								Call SalTblDefineSplitWindow(hWndForm, 0, FALSE)
								Call SalPostMsg(hWndForm, UM_Populate, 0, 0)
								Call SalWaitCursor(FALSE)
							On UM_DoubleClick
								Call SalSendMsg(SalParentWindow(hWndForm), UM_DoubleClick, wParam, lParam)
							On SAM_ContextMenu
								If nFlags & GT_ReadOnly
									Call SalTrackPopupMenu(hWndForm, 'popupEditP', TPM_CursorX | TPM_CursorY | TPM_CenterAlign, 0, 0)
								Else
									Call SalTrackPopupMenu(hWndForm, 'popupEditF', TPM_CursorX | TPM_CursorY | TPM_CenterAlign, 0, 0)
							On SAM_EndCellTab
								Call SalSendMsg(hWndForm, UM_Insert, 0, 0)
								Return TRUE
							On SAM_CaptionDoubleClick
								Call SalTblSortRows(hWndForm,SalTblQueryColumnID(SalNumberToWindowHandle(wParam)), TBL_SortIncreasing)
							On SAM_CornerClick
								If nTabInstance1
									Call SetTblColumnStatus( hWndItem, cCstTab1 )
							On WM_Paint
								Call cCstTab1.MarkTableAsCustomisable(  )
							On SAM_Destroy
								Call cCstTab1.Destructor(  )
							On SAM_TblDoDetails
								Call SalSendMsg( tbl2, UM_Populate, 0, 0 )
					! cXSalHSplitter: ccSplitter
.winattr class Custom Control:
						Class Child Ref Key: 0
						Class ChildKey: 33
						Class: cXSalHSplitter
						Property Template:
						Class DLL Name:
						Display Settings
							DLL Name: XSal2_32.dll
							MS Windows Class Name: XSal:Splitter32
							Style:  0x00000000
							ExStyle:  0x00000000
							Title:
							Window Location and Size
								Left:   Default
								Top:    Default
								Width:  1.533"
								Width Editable? Yes
								Height: 0.976"
								Height Editable? Yes
							Visible? Yes
							Border? No
							Etched Border? No
							Hollow? Yes
							Vertical Scroll? No
							Horizontal Scroll? No
							Tab Stop? None
							Tile To Parent? Yes
							Font Name: Arial
							Font Size: 10
							Font Enhancement: Italic
							Text Color: Default
							Background Color: Dark Aqua
							DLL Settings
.end
						                     Message Actions 
					Custom Control: ccSplitter
						Class Child Ref Key: 0
						Class ChildKey: 36
						Class: cXSalVSplitter
						Property Template:
						Class DLL Name:
						Display Settings
							DLL Name:
							MS Windows Class Name:
							Style:  Class Default
							ExStyle:  Class Default
							Title:
							Window Location and Size
								Left:   0.0"
								Top:    0.0"
								Width:  Class Default
								Width Editable? Class Default
								Height: Class Default
								Height Editable? Class Default
							Visible? Class Default
							Border? Class Default
							Etched Border? Class Default
							Hollow? Class Default
							Vertical Scroll? Class Default
							Horizontal Scroll? Class Default
							Tab Stop? Class Default
							Tile To Parent? Yes
							Font Name: Class Default
							Font Size: Class Default
							Font Enhancement: Class Default
							Text Color: Class Default
							Background Color: Class Default
							DLL Settings
						Message Actions
					Child Table: tbl2
						Class Child Ref Key: 0
						Class ChildKey: 35
						Class:
						Property Template:
						Class DLL Name:
						Display Settings
							Window Location and Size
								Left:   6.933"
								Top:    0.107"
								Width:  5.5"
								Width Editable? Yes
								Height: 5.0"
								Height Editable? Yes
							Visible? Yes
							Font Name: Default
							Font Size: Default
							Font Enhancement: Default
							Text Color: Default
							Background Color: Default
							View: Table
							Allow Row Sizing? No
							Lines Per Row: Default
						Memory Settings
							Maximum Rows in Memory: 2000
							Discardable? No
						Contents
						Functions
						Window Variables
							Boolean: bSortOrd
							: cCstTab2
								Class: cABSTab
							String: strSqlPopulate	! Строка SQL SELECT
							String: strSqlInsert	! Строка SQL INSERT
							String: strSqlDelete	! Строка SQL DELETE
							String: strSqlUpdate	! Строка SQL UPDATE
						Message Actions
							On UM_Create
								Call SalSendMsgToChildren( hWndForm, UM_QueryLabelText, 0, 0 )
								If nTabInstance2
									Call cCstTab2.Init(hWndItem, nTabInstance2, GetUserLoginName(), NOT fNoReposition2)
							On UM_Populate
								Call SalWaitCursor(TRUE)
								Call SalTblPopulate(hWndForm, hSql(), T(strSqlPopulate),TBL_FillAll)
								Call SalWaitCursor(FALSE)
							On SAM_ColumnSelectClick
								Call SalTblSetColumnFlags( SalNumberToWindowHandle(wParam), COL_Selected, FALSE )
								Set bSortOrd = not bSortOrd
								Call SalTblSortRows(tbl2, SalTblQueryColumnID(SalNumberToWindowHandle(wParam)), bSortOrd)
							On SAM_CornerClick
								If nTabInstance2
									Call SetTblColumnStatus( hWndItem, cCstTab2 )
							On SAM_ContextMenu
								Call SalTblQueryFocus( hWndForm, nRow, hWndCol )
								If SalTblQueryRowFlags ( hWndForm, nRow, ROW_Selected )
									Call Fun_SumCol()
								Else
									If nFlags & GT_ReadOnly
										Call SalTrackPopupMenu(hWndForm, 'popupEditP', TPM_CursorX | TPM_CursorY | TPM_CenterAlign, 0, 0)
									Else
										Call SalTrackPopupMenu(hWndForm, 'popupEditF', TPM_CursorX | TPM_CursorY | TPM_CenterAlign, 0, 0)
							On WM_Paint
								Call cCstTab2.MarkTableAsCustomisable(  )
							On SAM_Destroy
								Call cCstTab2.Destructor(  )
				Class Variables
				Instance Variables
					! Параметры класса:
					! NB: описание переменных -- аналогично cGenericTable (см.!)
					Number: nFlags
					String: strSqlPopulate
					String: strSqlInsert
					String: strSqlDelete
					String: strSqlUpdate
					String: strFilterTblName ! Имя основной таблицы для фильтра
					String: strTitleAux
					String: strPrintFileName ! Имя файла печати (без путей)
					Boolean: fFilterAtStart  ! Начинать население таблицы с фильтра
					Number: nTabInstance1    ! Номер варианта таблицы 1 для динамической настройки
					Number: nTabInstance2    ! Номер варианта таблицы 1 для динамической настройки
					Boolean: fNoReposition1  ! Не использовать настройку положения колонок для таб 1
					Boolean: fNoReposition2  ! Не использовать настройку положения колонок для таб 1
					! Внутренние переменные:
					Number: nRow
					String: strOldTitle
					! ! ! Координаты и размер окна
					Number: nWinX
					Number: nWinY
					Number: nWinW
					Number: nWinH
					! ! Для суммирования колонок
					Window Handle: hWndCol
				Functions
					Function: ReturnValue
						Description:
						Returns
							Number: nRes
						Parameters
						Static Variables
						Local variables
						Actions
							Return 999
					Function: ReInitQueryString
						Description: Переинициализировать служебные SQL строки
						Returns
							Boolean:
						Parameters
						Static Variables
						Local variables
						Actions
							If strSqlPopulate != ''
								Call tbl.cQ.Init(strSqlPopulate)
					Function: Fun_SumCol
						Description: Сумирует SELECTED колонку
						Returns
						Parameters
						Static Variables
						Local variables
							Window Handle: hWndCol
							String: strTitle
							String: strSuma
							Number: nX
							Number: nY
							Number: nW
							Number: nH
						Actions
							Call GetWindowRect( hWndForm, nX, nY, nW, nH )
							Call SalTblObjectsFromPoint( hWndForm, wParam-nX, lParam-nY, nH, hWndCol, nH )
							Set strTitle=PadR(' ',100  )
							Call SalTblGetColumnTitle ( hWndCol, strTitle, 100 )
							If SalIsValidNumber( hWndCol )
								Set nH=SalTblColumnSum( hWndForm, SalTblQueryColumnID( hWndCol ), ROW_Selected, 0 )
								If nH
									Set strTitle=SalStrTrimX(strTitle)
									Set strSuma=SalStrTrimX(SalFmtFormatNumber ( nH, 'Default' ))
									Set nH = SalNumberMax( SalStrLength( strTitle ), SalStrLength( strSuma ) )
									Call XSalTooltipSetColors( COLOR_Black, COLOR_Yellow )
									Call XSalTooltipShow( hWndForm, strTitle ||PutLf()||PadL(strSuma,nH))
									Call XSalTooltipSetColors( COLOR_Black, COLOR_White )
					! Function: GetFirstEditableColumn
						                   Description: Получить первую редактируюмую колонку
						                   Returns 
							                   Window Handle: 
						                   Parameters 
							                   Window Handle: hWndTbl
						                   Static Variables 
						                   Local variables 
							                   Number: nCol
							                   Window Handle: hWndCol
						                   Actions 
							                   Set nCol=1
							                   Loop 
								                   Set hWndCol = SalTblGetColumnWindow(hWndTbl, nCol, COL_GetPos)
								                   If hWndCol=hWndNULL
									                   Break 
								                   If SalTblQueryColumnFlags(hWndCol, COL_Editable) AND
										SalIsWindowVisible(hWndCol)
									                   Break 
								                   Set nCol=nCol+1
							                   Return hWndCol
				Message Actions
					On UM_Create
						Call SalWaitCursor(TRUE)
						Call XConnectGetParams(tbl.cMain)
						If NOT tbl.cMain.Connect()
							Call SalWaitCursor(FALSE)
							Call SalDestroyWindow(hWndForm)
						!
						Call XSalTooltipSetUserDefault()
						Call SaveInfoToLog(MSG_Invoke() || strTitleAux)
						If strTitleAux != ''
							Call SalGetWindowText(hWndForm, strOldTitle, 256)
							Call SalSetWindowText(hWndForm, strOldTitle || ': [' || strTitleAux || ']')
						!
						If strFilterTblName != ''
							Call tbl.cF.Init(strFilterTblName, strFilterTblName)
						Else
							Call SalDisableWindow(pbFilter)
						!
						If nFlags & GT_NoIns
							Call SalDisableWindow(pbIns)
						If nFlags & GT_NoDel
							Call SalDisableWindow(pbDel)
						If nFlags & GT_NoUpd
							Call SalDisableWindow(pbUpdate)
						Call ccSplitter.setBarPosition( 800 )
						Call ccSplitter.setLeftFrame( tbl )
						Call ccSplitter.setRightFrame( tbl2 )
					On SAM_CreateComplete
						Call SalWaitCursor(FALSE)
						If strFilterTblName
							Call SalSendMsg(pbFilter, SAM_Click, 0, 0)
						Else
							Call SalSendMsg(tbl, UM_Populate, 0, 0)
					On UM_DoubleClick
					On UM_Print
						If strPrintFileName
							Call SalGetWindowText(tbl, strOldTitle, 100)
							Call TablePrint(tbl, strOldTitle, GetPrnDir() || '\\' || strPrintFileName, '')
					On UM_Search
						Call TblFindString(tbl,  DFIND_First)
					On UM_Close
						If SalTblAnyRows(tbl, ROW_Edited | ROW_MarkDeleted | ROW_New, 0)
							Call SalMessageBeep(MB_IconQuestion)
							If SalMessageBox('В таблице присутсвуют несохраненные изменения. Игнорировать их?',
									'Внимание!', MB_IconQuestion | MB_YesNo) != IDYES
								Return FALSE
						Call SalDestroyWindow(hWndForm)
					On SAM_Destroy
						If tbl.cMain.IsConnected()
							Call tbl.cMain.Disconnect()
						Call SaveInfoToLog('Выход из диалога: ' || strTitleAux)
		Default Classes
			MDI Window: cBaseMDI
			Form Window:
			Dialog Box:
			Table Window:
			Quest Window:
			Data Field:
			Spin Field:
			Multiline Field:
			Pushbutton:
			Radio Button:
			Option Button:
			Check Box:
			Child Table:
			Quest Child Window: cQuickDatabase
			List Box:
			Combo Box: cGenComboBox_StrId
			Picture:
			Vertical Scroll Bar:
			Horizontal Scroll Bar:
			Column:
			Background Text:
			Group Box:
			Line:
			Frame:
			Custom Control: cCalendarDropDown
		Application Actions
	Form Window: frm_Out
		Class:
		Property Template:
		Class DLL Name:
		Title: Отчетность казначейства
		Icon File:
		Accesories Enabled? Yes
		Visible? Yes
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Automatically Created at Runtime? No
			Initial State: Maximized
			Maximizable? Yes
			Minimizable? Yes
			System Menu? Yes
			Resizable? Yes
			Window Location and Size
				Left:   Default
				Top:    Default
				Width:  14.033"
				Width Editable? Yes
				Height: 6.262"
				Height Editable? Yes
			Form Size
				Width:  Default
				Height: Default
				Number of Pages: Dynamic
			Font Name: Default
			Font Size: Default
			Font Enhancement: None
			Text Color: Default
			Background Color: Default
		Description:
		Named Menus
		Menu
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Top
				Visible? Yes
				Size: 0.458"
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
				Pushbutton: pbExit
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class: ctb_pbOk
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   2.6"
						Top:    0.083"
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name: \BARS98\RESOURCE\BMP\DISCARD.BMP
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							Call SalDestroyWindow(hWndForm)
						On SAM_Create
							Set strTip =  'Завершить'
				Pushbutton: pbTxt
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class: ctb_pbOk
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   1.4"
						Top:    0.083"
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name: \BARS98\RESOURCE\BMP\DETAILS.BMP
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							Call SalSendMsg(tblReps, SAM_DoubleClick, 5, 0)
						On SAM_Create
							Set strTip =  'Сделать текстовый отчет'
				Pushbutton: pbWord
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class: ctb_pbOk
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   0.9"
						Top:    0.083"
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name: \BARS98\RESOURCE\BMP\WORD.BMP
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							Call SalSendMsg(cCalendarFrom, SAM_User, 0, 0)
							Call SalSendMsg(cCalendarTo, SAM_User, 0, 0)
							Set sFdat   = SalStrMidX (strDateFrom, 3, 2 ) || '-' || SalStrMidX (strDateFrom, 0, 2 ) || '-' ||SalStrMidX (strDateFrom, 6, 4 )
							Set sFdat2 = SalStrMidX (strDateTo, 3, 2 )     || '-' || SalStrMidX (strDateTo, 0, 2 )     || '-' ||SalStrMidX (strDateTo, 6, 4 )
							Set strRepDate  = strDateFrom
									
							Set FL_FORMAT = TRUE
							Call SalSendMsg(tblReps, SAM_DoubleClick, 5, 0)
						On SAM_Create
							Set strTip =  'Сделать отчет в формате RTF'
				Pushbutton: pbPrint
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class: ctb_pbPrint
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   1.9"
						Top:    0.083"
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							Set strPrintPath=dfPath
							Set i  = TBL_MinRow
							While SalTblFindNextRow( tblLstFiles, i, ROW_Selected, 0)
								Call SalTblSetContext( tblLstFiles, i )
								If (SalStrScan( tblLstFiles.colFileName ,  '.rtf' )!= -1)         !!== RTF format
									If (   SalLoadApp(GetEditorPath(), strPrintPath||'\\'||tblLstFiles.colFileName  )   = FALSE     )
										Call SalMessageBox('Не удалось загрузить приложение SalLoadApp : GetEditorPath()','Внимание',0)
								Else !!== TXT format
									Call DosDirectPrint(strPrintPath || '\\' || tblLstFiles.colFileName )
								Call SalTblSetRowFlags( tblLstFiles, i ,ROW_Selected, FALSE)
								Set i = i + 1
						On SAM_Create
							Set strTip = 'Распечатать'
				Pushbutton: pbView
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class: ctb_pbOk
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   0.2"
						Top:    0.083"
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name: \BARS98\RESOURCE\BMP\DOCVIEW.BMP
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							Set strPrintPath=dfPath
							Set i = 0
							If (SalStrScan( tblLstFiles.colFileName ,  '.rtf' )!= -1)         !!== RTF format
								If (   SalLoadApp(GetEditorPath(), strPrintPath||'\\'||tblLstFiles.colFileName  )   = FALSE     )
									Call SalMessageBox('Не удалось загрузить приложение SalLoadApp : GetEditorPath()','Внимание',0)
							Else !!== TXT format
								Call DirectView(strPrintPath|| '\\' || tblLstFiles.colFileName  )
										
										
						On SAM_Create
							Set strTip='Просмотреть файл'
		Contents
			Child Table: tblReps
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Display Settings
					Window Location and Size
						Left:   0.35"
						Top:    0.702"
						Width:  4.283"
						Width Editable? Yes
						Height: 2.929"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: Default
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
					View: Table
					Allow Row Sizing? No
					Lines Per Row: Default
				Memory Settings
					Maximum Rows in Memory: Default
					Discardable? No
				Contents
					Column: Kod
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Код
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: Number
						Justify: Left
						Width:  0.586"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: NAME
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Наименование отчета
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  10.0"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: FORM
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: rep
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: param
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: NDAT
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? Yes
						Maximum Data Length: Default
						Data Type: Number
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: maska
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: repw
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Наименование отчета
						Visible? No
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  10.0"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
				Functions
				Window Variables
					Number: nOrderBy              !! способ сортировки в таблице с именами отчетов
					Window Handle: hColumn
				Message Actions
					On SAM_Create
						Call SalPrtGetDefault(sDeviceDef, sDriverDef, sPortDef)
						Call SalTblSetTableFlags(hWndForm, TBL_Flag_SelectableCols, TRUE)
						Call SalSendMsg(tblReps, SAM_User, 0,0)
						Call SalSetFocus(tblReps)
					On SAM_User
						Call SalTblPopulate(tblReps, hSql(), T("
								     SELECT r.id,r.description,r.form,r.name,r.param,
								            r.ndat,  r.mask,  r.namew
								     FROM reports r, app_rep a
								     WHERE a.codeapp=:app and r.id=a.coderep and
								           form = 'frm_DKU'
								     ORDER BY 1,2"), TBL_FillAll)
						Set nOrderBy=ASC
						Call SalTblSetContext( hWndItem, 0 )
						Call SalTblSetRowFlags( hWndItem, 0, ROW_Selected, TRUE )
						If tblReps.NDAT = 0
							Call SalHideWindow(cCalendarFrom)
							Call SalHideWindow(cCalendarTo)
							Call SalHideWindow(frm_Lables.dfTo)
							Call SalHideWindow(frm_Lables.dfFrom)
						If tblReps.NDAT = 1
							Call SalHideWindow(cCalendarTo)
							Call SalShowWindow(cCalendarFrom)
							Set frm_Lables.dfFrom = 'За дату'
							Call SalShowWindow(frm_Lables.dfFrom)
							Call SalHideWindow(frm_Lables.dfTo)
							Call SalSetFocus(frm_Lables.dfFrom)
						If tblReps.NDAT = 2
							Call SalShowWindow(cCalendarFrom)
							Call SalShowWindow(cCalendarTo)
							Set frm_Lables.dfTo = 'По дату'
							Set frm_Lables.dfFrom ='С даты'
							Call SalShowWindow( frm_Lables.dfTo)
							Call SalSetFocus( frm_Lables.dfFrom)
					On SAM_TblDoDetails
						If (tblReps.rep  = STRING_Null )
							Call SalDisableWindow(pbTxt)
						Else
							Call SalEnableWindow(pbTxt)
						If (tblReps.repw  = STRING_Null )
							Call SalDisableWindow(pbWord)
						Else
							Call SalEnableWindow(pbWord)
						! ! =========================================================================
						! ! == По параметру NDAT - будем определять показывать ли календари
						! ! =========================================================================
						If tblReps.NDAT = 0
							Call SalHideWindow(cCalendarFrom)
							Call SalHideWindow(cCalendarTo)
							Call SalHideWindow(frm_Lables.dfTo)
							Call SalHideWindow(frm_Lables.dfFrom)
						If tblReps.NDAT = 1
							Call SalHideWindow(cCalendarTo)
							Call SalShowWindow(cCalendarFrom)
							Set frm_Lables.dfFrom = 'За дату'
							Call SalShowWindow(frm_Lables.dfFrom)
							Call SalHideWindow(frm_Lables.dfTo)
							Call SalSetFocus(frm_Lables.dfFrom)
						If tblReps.NDAT = 2
							Call SalShowWindow(cCalendarFrom)
							Call SalShowWindow(cCalendarTo)
							Set frm_Lables.dfTo = 'По дату'
							Set frm_Lables.dfFrom ='С даты'
							Call SalShowWindow( frm_Lables.dfTo)
							Call SalSetFocus( frm_Lables.dfFrom)
						! ! =========================================================================
						! ! == Населим список уже существующих файлов по данной маске отчета
						! ! =========================================================================
						Call SalTblReset( tblLstFiles )
						Call SalEnableWindow(cCalendarFrom)
						Call SalEnableWindow(cCalendarTo)
						Call SalEnableWindow(pbTxt)
						! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
						Set dfPath = strPrintPath
						Call SalSendMsg(dfPath, SAM_User, 0, 0)
								
					On SAM_ColumnSelectClick
						! Сортировка по номеру отчета
						Call SalWaitCursor( TRUE )
						Set hColumn = SalNumberToWindowHandle( wParam )
						Set nOrderBy = Not nOrderBy
						Call SalTblSortRows( hWndForm, SalTblQueryColumnID( hColumn ), nOrderBy )
						Call SalTblSetColumnFlags( hColumn, COL_Selected, FALSE )
						Call SalWaitCursor( FALSE )
					On UM_ReportFinish
						If not SalIsWindowEnabled(pbView)
							Call SalEnableWindow(pbView)
						If not SalIsWindowEnabled(pbPrint)
							Call SalEnableWindow(pbPrint)
					On SAM_SetFocus
						Call SalSendMsg(tblReps, SAM_TblDoDetails , 0, 0)
					On SAM_DoubleClick
						Call Make_Rep()
			Custom Control: cSpltMain
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cXSalVSplitter
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   0.0"
						Top:    0.0"
						Width:  12.083"
						Width Editable? Class Default
						Height: 5.75"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Yes
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
			Data Field: dfPath
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: Default
					Data Type: String
					Editable? Yes
				Display Settings
					Window Location and Size
						Left:   7.267"
						Top:    2.655"
						Width:  2.386"
						Width Editable? Yes
						Height: 0.3"
						Height Editable? Yes
					Visible? Yes
					Border? Yes
					Justify: Left
					Format: Unformatted
					Country: Default
					Font Name: Default
					Font Size: 10
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
					Input Mask: Unformatted
				Message Actions
					On WM_LbuttonDblClick
						Call SalModalDialog(dlg_DirSelect, hWndForm)
					! ======  Это сообщение будет посылатся каждый раз когда в dfPath ===============================
							!======  (путь к отчету) будет меняться  - т.е. будем перечитывать содержимое каталога==========
					On SAM_User
						!
						Set strFileMask= IifS(tblReps.maska=STRING_Null,   NumberToStrFormat (tblReps.Kod, 3, '0') ||'*.*'
								                                   ,tblReps.maska )
						Set nFiles=VisDosEnumFiles( strPrintPath || '\\' || strFileMask, FA_Standard, strFileList)
						Call SalTblReset( tblLstFiles )
								
						! ===  сфокусируем на только что созданном файле
						Set i = 0
						Set nNewRow=0
						Set strFileNewAdded =  IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt)
						While i < nFiles
							Call SalTblInsertRow ( tblLstFiles, nNewRow )
							Call SalTblSetContext ( tblLstFiles, nNewRow )
							Call SalTblSetRowFlags( tblLstFiles, nNewRow ,ROW_New, FALSE)
							Set tblLstFiles.colFileName = strFileList[ i ]
							Call SalFileGetDateTime( strPrintPath || '\\' || strFileList[ i ],  tblLstFiles.colFileDT )
							Set tblLstFiles.colFileSize = VisFileGetSize( strPrintPath || '\\' || strFileList[ i ] )
									
							If lstFiles[i] = strFileNewAdded
								Set nNewAdded = i
							Set i = i + 1
						If (  nNewAdded  != -1)
							Call SalTblSetContext ( tblLstFiles, nNewAdded )
						Call SalUpdateWindow(tblLstFiles)
			Custom Control: cCalendarFrom
.data CLASSPROPSSIZE
0000: 4400
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 646172436F6D626F 426F78002B000100 0000010101010000
0020: 0200000001010101 0101000000000000 01000000000A6464 2F4D4D2F79797979
0040: 00000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cCalendarDropDown
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   5.95"
						Top:    1.429"
						Width:  1.2"
						Width Editable? Class Default
						Height: 0.25"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: 12
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
					On SAM_Create
						Call GetMonthArray( strMonth )
						Call GetWeekDayArray( strWeekDays )
						Call cCalendarFrom.SetMonthText( strMonth )
						Call cCalendarFrom.SetWeekDayText( strWeekDays )
						! ! - - - - - - - - - - - - Инициализация дат календаря  cCalendarFrom - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  - -
						Call cCalendarFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset,  COLOR_Black, COLOR_Gray, TRUE)
						Call cCalendarFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call cCalendarFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call cCalendarFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call cCalendarFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call cCalendarFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call cCalendarFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call cCalendarFrom.SpecialDate(SPECIAL_OneTime, GetBankDate(), DAY_Unset, SEQ_Unset, COLOR_Blue,  COLOR_Cyan, TRUE)
						Call SqlPrepareAndExecute(  hSql(), T("SELECT fdat  INTO :dSelect  FROM fdat")  )
						Set i = 0
						While SqlFetchNext(hSql(), nFetchRes)
							Call cCalendarFrom.SpecialDate(SPECIAL_OneTime, dSelect,  DAY_Unset, SEQ_Unset, COLOR_Blue, COLOR_Cyan, TRUE)
							Set i = i + 1
						If i = 0
							Call SalMessageBox('Нет доступных дат для выбора','Внимание',0)
									
						Call SalSetWindowText(  cCalendarFrom,  strBankDate)
					On SAM_User
						Call SalGetWindowText( hWndItem, strDateFrom, 12 )
						! Set nDay=SalDateDay( SalStrToDate(  strDateFrom ))
						! Set nMonth = SalDateMonth( SalStrToDate(  strDateFrom ))
						! Set nYear = SalDateYear( SalStrToDate( strDateFrom ))
						! Set strDateFrom =IifS(  nDay>9,  SalNumberToStrX(nDay,0),  "0"|| SalNumberToStrX(nDay,0)  )||  '-' ||
								                                   IifS( nMonth>9, SalNumberToStrX(nMonth,0), '0'||  SalNumberToStrX(nMonth,0) ) || '-' ||SalNumberToStrX(nYear,0)
			Custom Control: cCalendarTo
.data CLASSPROPSSIZE
0000: 4400
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 646172436F6D626F 426F78002B000100 0000010101010000
0020: 0200000001010101 0101000000000000 01000000000A6464 2F4D4D2F79797979
0040: 00000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cCalendarDropDown
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   7.65"
						Top:    1.464"
						Width:  0.914"
						Width Editable? Class Default
						Height: 0.25"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: 12
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
					On SAM_Create
						Call GetMonthArray( strMonth )
						Call GetWeekDayArray( strWeekDays )
						Call cCalendarTo.SetMonthText( strMonth )
						Call cCalendarTo.SetWeekDayText( strWeekDays )
						! ! - - - - - - - - - - - - Инициализация дат календаря  cCalendarTo - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  - -
						Call cCalendarTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset,  COLOR_Black, COLOR_Gray, TRUE)
						Call cCalendarTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call cCalendarTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call cCalendarTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call cCalendarTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call cCalendarTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call cCalendarTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call cCalendarTo.SpecialDate(SPECIAL_OneTime, GetBankDate(), DAY_Unset, SEQ_Unset, COLOR_Blue,  COLOR_Cyan, TRUE)
						Call cCalendarTo.SpecialDate(SPECIAL_OneTime, GetBankDate(), DAY_Unset, SEQ_Unset, COLOR_Blue,  COLOR_Cyan, TRUE)
						Call SqlPrepareAndExecute(  hSql(), T("SELECT fdat  INTO :dSelect  FROM fdat")  )
						Set i = 0
						While SqlFetchNext(hSql(), nFetchRes)
							Call cCalendarTo.SpecialDate(SPECIAL_OneTime, dSelect,  DAY_Unset, SEQ_Unset, COLOR_Blue, COLOR_Cyan, TRUE)
							Set i = i + 1
						If i = 0
							Call SalMessageBox('Нет доступных дат для выбора','Внимание',0)
						Call SalSetWindowText(  cCalendarTo,  strBankDate )
					On SAM_User
						Call SalGetWindowText( hWndItem, strDateTo, 12 )
						Set nDay=SalDateDay( SalStrToDate(  strDateTo ))
						Set nMonth = SalDateMonth( SalStrToDate(  strDateTo ))
						Set nYear = SalDateYear( SalStrToDate( strDateTo ))
						Set strDateTo =IifS(  nDay>9,  SalNumberToStrX(nDay,0),  "0"|| SalNumberToStrX(nDay,0)  )||  '-' ||
								                                   IifS( nMonth>9, SalNumberToStrX(nMonth,0), '0'||  SalNumberToStrX(nMonth,0) ) || '-' ||SalNumberToStrX(nYear,0)
			Custom Control: cSpltRightB
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cXSalHSplitterInvisible
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   5.483"
						Top:    1.893"
						Width:  7.65"
						Width Editable? Class Default
						Height: 2.583"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
			Custom Control: cSpltRight
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cXSalHSplitter
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   5.183"
						Top:    0.321"
						Width:  8.1"
						Width Editable? Class Default
						Height: 4.323"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
			Custom Control: cSpltRightT
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cXSalHSplitterInvisible
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   5.483"
						Top:    0.393"
						Width:  7.6"
						Width Editable? Class Default
						Height: 1.583"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
			Custom Control: cSpltRightTB
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cXSalVSplitterInvisible
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   5.883"
						Top:    1.31"
						Width:  2.9"
						Width Editable? Class Default
						Height: 0.51"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
			Child Table: tblLstFiles
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Display Settings
					Window Location and Size
						Left:   5.65"
						Top:    3.357"
						Width:  6.683"
						Width Editable? Yes
						Height: 0.857"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: 10
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
					View: Table
					Allow Row Sizing? No
					Lines Per Row: Default
				Memory Settings
					Maximum Rows in Memory: 30000
					Discardable? Yes
				Contents
					Column: colFileName
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Имя файла
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  1.383"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colFileDT
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Время/дата созд.
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: Date/Time
						Justify: Left
						Width:  1.8"
						Width Editable? Yes
						Format: hh:mm  dd-MM-yyyy
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colFileSize
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Байт
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: Number
						Justify: Left
						Width:  0.85"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
				Functions
				Window Variables
				Message Actions
					On SAM_Create
						Call SalTblSetTableFlags( hWndItem, TBL_Flag_GrayedHeaders|TBL_Flag_SingleSelection, FALSE )
						Call SalTblSetTableFlags( hWndItem, TBL_Flag_SuppressRowLines|TBL_Flag_SuppressLastColLine, TRUE )
					On SAM_DoubleClick
						Call SalSendMsg (pbView, SAM_Click, 0, 0 )
			Pushbutton: pbAlien
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cpbOk
				Property Template:
				Class DLL Name:
				Title:
				Window Location and Size
					Left:   0.783"
					Top:    3.952"
					Width:  Class Default
					Width Editable? Class Default
					Height: Class Default
					Height Editable? Class Default
				Visible? No
				Keyboard Accelerator: Class Default
				Font Name: Class Default
				Font Size: Class Default
				Font Enhancement: Class Default
				Picture File Name:
				Picture Transparent Color: Class Default
				Image Style: Class Default
				Text Color: Class Default
				Background Color: Class Default
				Message Actions
					On SAM_Click
						Call SalSetWindowText(  cCalendarTo,  strBankDate )
						Call SalSetWindowText(  cCalendarFrom,  strBankDate )
		Functions
			Function: Make_Rep
				Description:
				Returns
				Parameters
				Static Variables
				Local variables
					String: strTmp
					String: strRet
					Number: nError
					Number: nErrorPos
					Date/Time: dtRet
					Number: i
					Window Handle: hColumn
					Window Handle: hWndRet   !!  - -//- -
				Actions
					! =====================================================
					! ==Дадим сообщение календарям SAM_User чтоб прочитать выбранную дату
					! ==Дата в формате == 23-10-2001
					! =====================================================
					Call SalSendMsg(cCalendarFrom, SAM_User, 0, 0)
					Call SalSendMsg(cCalendarTo, SAM_User, 0, 0)
					! ========================================================
					! == Поскольку в таблице report в поле param
							! == остались переменные sFdat и sFdat2  -  присвоим их
					! ========================================================
					Set sFdat   = SalStrMidX (strDateFrom, 3, 2 ) || '-' || SalStrMidX (strDateFrom, 0, 2 ) || '-' ||SalStrMidX (strDateFrom, 6, 4 )
					Set sFdat2 = SalStrMidX (strDateTo, 3, 2 )     || '-' || SalStrMidX (strDateTo, 0, 2 )     || '-' ||SalStrMidX (strDateTo, 6, 4 )
					Set strRepDate  = strDateFrom
					! ========================================
					! - Сreate frm_DKU (если nMode=0) и frm_RepKtk (если nMode=1)
					! ========================================
					If nMode=0
						Set hWndDKU=SalCreateWindow('frm_DKU', hWndForm)
					Else
						Set hWndDKU=SalCreateWindow('frm_RepKtk', hWndForm)
					If hWndDKU = hWndNULL
						Call SalMessageBox('Внимание', 'Не возможно создать окно frm_DKU',0)
						Return -1
					Call SalCenterWindow(hWndDKU)
					!
					! ========================================== 
					! == Населим выбранные отчетыПо каждому выбраному отчету ....
					! ========================================== 
					! Set nAvtoGen = 0
					! While SalTblFindNextRow (  tblReps, nInd, ROW_Selected, 0 )
						                                                                                                                                                        Set nAvtoGen = nAvtoGen+1
					! Set nCurLine=TBL_MinRow
					! While SalTblFindNextRow (  tblReps, nCurLine, ROW_Selected, 0 )
						                                                                                                                                                        Call SalTblSetContext( tblReps, nCurLine)
						                                                                                                                                                        Set i=0
						                                                                                                                                                        Set strTmp = tblReps.param
						                                                                                                                                                        While SalStrScan (strTmp, ',') > -1
							                                                                                                                                                        Set i = SalStrScan (strTmp,',')
							                                                                                                                                                        Set i=i+1
							                                                                                                                                                        Set strTmp = SalStrMidX(strTmp, i, SalStrLength(strTmp) - i )
						                                                                                                                                                        Set nPar1 = SalStrToNumber( strTmp )
						! Set strPureMask = GetPureFileMask(tblReps.maska)
						!
						                                                                                                                                                        Set SHAP = SalNumberToStrX(tblReps.Kod, 0) || ' ' ||  tblReps.NAME
						                                                                                                                                                        Set DRUK = 'Printed: ' || SalFmtFormatDateTime(SalDateCurrent(), "dd/MM/yyyy hh:mm:ss")
						                                                                                                                                                        Set strTmplPath = IifS(FL_FORMAT, GetTemplateDir() || "\\" || tblReps.repw,  GetTemplateDir() || "\\" || tblReps.rep)
		Window Parameters
			Number: nMode
		Window Variables
			Number: nWndX
			Number: nWndY
			String: strPath
			String: strFileMask
			! Эти переменные есть в главных обьявлениях по возможности их нужно от туда убрать
			Number: tek  !! текущая строка выбраного отчета
			Number: nFilesForPrn[*]       !! Если выбрали для печати несколько файлов
			Number: i
			Date/Time: dSelect                !!
			! ! - - - Переменные для вычитки инфы о файлах
			String: strFileList[*]
			Number: nNewRow
			Number: nNewAdded
			String: strFileNewAdded
			Number: nCurLine
		Message Actions
			On SAM_Create
				Call cSpltMain.setLeftFrame( tblReps)
				Call cSpltMain.setRightFrame( cSpltRight )
				Call cSpltMain.setBarPosition( 700 )
						
				Call cSpltRight.setBarSize(20)
				Call cSpltRight.setTopFrame(cSpltRightT)
				Call cSpltRight.setBottomFrame(cSpltRightB)
				Call cSpltRight.setBarPosition( 105 )
				Call cSpltRight.setStyle( XSalSplitter_NotResizable | XSalSplitter_Frame1AbsSize, TRUE )
						
				Call cSpltRightB.setBarSize( 1 )
				Call cSpltRightB.setBarPosition( 60 )
				Call cSpltRightB.setStyle( XSalSplitter_NotResizable | XSalSplitter_Frame1AbsSize, TRUE )
				Call cSpltRightB.setTopFrame(dfPath)
				Call cSpltRightB.setBottomFrame(tblLstFiles)
						
				Call cSpltRightT.setBarSize( 1 )
				Call cSpltRightT.setBarPosition(490 )
				Call cSpltRightT.setStyle( XSalSplitter_NotResizable | XSalSplitter_Frame1AbsSize, TRUE )
				Call cSpltRightT.setBottomFrame(cSpltRightTB)
				Call cSpltRightT.setTopFrame(  SalCreateWindowEx( frm_Lables, hWndForm, 0,0,0,0, CREATE_AsChild )   )
						
				Call cSpltRightTB.setRightFrame(cCalendarTo)
				Call cSpltRightTB.setLeftFrame(cCalendarFrom)
				Call cSpltRightTB.setBarSize( 1 )
				Call cSpltRightTB.setStyle( XSalSplitter_NotResizable, TRUE  )
						
				! - - - -  Это сделано чтоб перерисвывались Lables
				Call SalGetWindowSize ( hWndForm, nWndX, nWndY)
				Call SalSetWindowSize ( hWndForm, nWndX, nWndY)
						
				Set strPrintPath = GetPrnDir()
				Set dfPath = strPrintPath
				!
				! - - - - - - - - - -  Инициализация переменных - - - - - - - - - - -
				Set AMFO = GetBankMfo()
				! Set bFLS = GetAccountStructure(nTmp, nTmp, nTmp, nTmp)
						  ! Старый план счетов
				Set tek = 0
				Set AQH = GetBankName()
				Set strBankDate = SalFmtFormatDateTime( GetBankDate(), 'dd/MM/yyyy')
				Set app = GetCodeApp()
				Set ID = GetUserId()
				Call SqlPrepareAndExecute(hSql(), T("
						     SELECT fio
						     INTO :IDNAME
						     FROM staff
						     WHERE id=:ID"))
				Call SqlFetchNext(hSql(), nFetchRes)
				Set hWndDKU = hWndNULL
				Call SalSetWindowText(  cCalendarTo,  strBankDate )
				Call SalSetWindowText(  cCalendarFrom,  strBankDate )
				!
				Call SalPrtGetDefault(sDeviceDef, sDriverDef, sPortDef)
				!
			On SAM_CreateComplete
				Call SalSetWindowText(  cCalendarTo,  strBankDate )
				Call SalSetWindowText(  cCalendarFrom,  strBankDate )
				Call SalUpdateWindow(cCalendarFrom)
				Call SalUpdateWindow(cCalendarTo)
				! Call WaitCursorOff()
				! Call SalSendMsg(hWndForm,SAM_User,0,0)
			On SAM_Destroy
				If SalStrTrimX(SalStrUpperX(GetDBMS())) = 'ORACLE'
					Call XRoleUnset(hSql(), 'ShowOutForms(hWndMDI,' ||
							     SalNumberToStrX(nMode,0) || ')')
	! Dialog Box: dlg_mas2
.winattr
		Class:
		Property Template:
		Class DLL Name:
		Title: ОТБОР  ПРОВОДОК  ДЛЯ  ПЕЧАТИ
		Accesories Enabled? No
		Visible? Yes
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Type of Dialog: Modal
			Window Location and Size
				Left:   0.625"
				Top:    0.625"
				Width:  5.533"
				Width Editable? Yes
				Height: 1.76"
				Height Editable? Yes
			Absolute Screen Location? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
.end
		                                                                                                           Description: Маска отбора
		                                                                                                           Tool Bar 
			                                                                                                           Contents 
		                                                                                                           Contents 
			                                                                                                           Background Text: "Маска"  ДЕБЕТА счета
			                                                                                                           Data Field: masD
				                                                                                                           Message Actions 
			                                                                                                           Background Text: "Маска"  КРЕДИТА счета
			                                                                                                           Data Field: masK
				                                                                                                           Message Actions 
			                                                                                                           Pushbutton: pb1
				                                                                                                           Message Actions 
					                                                                                                           On SAM_Click
						                                                                                                           Set masD = SalStrTrimX(masD)
						                                                                                                           Set masK = SalStrTrimX(masK)
						                                                                                                           Call SalEndDialog(hWndForm, 0)
			                                                                                                           Pushbutton: pb2
				                                                                                                           Message Actions 
					                                                                                                           On SAM_Click
						                                                                                                           Set masD = '-'
						                                                                                                           Call SalEndDialog(hWndForm, 0)
		                                                                                                           Functions 
		                                                                                                           Window Parameters 
			                                                                                                           Receive String: maskD
			                                                                                                           Receive String: maskK
		                                                                                                           Window Variables 
		                                                                                                           Message Actions 
			                                                                                                           On SAM_Create
				                                                                                                           Call SalCenterWindow(hWndForm)
				                                                                                                           Set masD = '*'
				                                                                                                           Set masK = '*'
			                                                                                                           On SAM_Destroy
				                                                                                                           Set maskD = StrMatches2Like(masD)
				                                                                                                           Set maskK = StrMatches2Like(masK)
	! Dialog Box: dlg_mas
.winattr
		Class:
		Property Template:
		Class DLL Name:
		Title: ОТБОР  СЧЕТОВ  ДЛЯ  ПЕЧАТИ
		Accesories Enabled? No
		Visible? Yes
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Type of Dialog: Modal
			Window Location and Size
				Left:   0.625"
				Top:    0.625"
				Width:  5.533"
				Width Editable? Yes
				Height: 1.5"
				Height Editable? Yes
			Absolute Screen Location? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
.end
		                                                                                                           Description: Маска отбора
		                                                                                                           Tool Bar 
			                                                                                                           Contents 
		                                                                                                           Contents 
			                                                                                                           Background Text: "Маска" для отбора:
			                                                                                                           Data Field: mas
				                                                                                                           Message Actions 
			                                                                                                           Pushbutton: pb1
				                                                                                                           Message Actions 
					                                                                                                           On SAM_Click
						                                                                                                           Set mas = SalStrTrimX(mas)
						                                                                                                           Call SalEndDialog(dlg_mas, 0)
			                                                                                                           Pushbutton: pb2
				                                                                                                           Message Actions 
					                                                                                                           On SAM_Click
						                                                                                                           Set mas = '-'
						                                                                                                           Call SalEndDialog(dlg_mas, 0)
		                                                                                                           Functions 
		                                                                                                           Window Parameters 
			                                                                                                           Receive String: mask
			                                                                                                           String: slovo
		                                                                                                           Window Variables 
		                                                                                                           Message Actions 
			                                                                                                           On SAM_Create
				                                                                                                           Call SalCenterWindow(hWndItem)
				                                                                                                           Call SalSetWindowText(hWndForm, " ОТБОР " || slovo ||
						     " для печати")
				                                                                                                           Set mas = mask
			                                                                                                           On SAM_Destroy
				                                                                                                           Set mask = StrMatches2Like(mas)
				! Set mask = IifS(mas != '*', StrMatches2Like(mas), '')
				! Set mask = IifS(mas != '*', " and trim(Nls) LIKE \'" ||
						  StrMatches2Like(mas) || "\'", ' ')
	Dialog Box: dlg_PeriodSet
		Class:
		Property Template:
		Class DLL Name:
		Title: Установка периода отчета
		Accesories Enabled? No
		Visible? Yes
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Type of Dialog: Modal
			Window Location and Size
				Left:   Default
				Top:    Default
				Width:  5.514"
				Width Editable? Yes
				Height: 1.49"
				Height Editable? Yes
			Absolute Screen Location? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
		Description: Установить период времени для отчета
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Top
				Visible? Yes
				Size: Default
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
		Contents
			Background Text: С:
				Resource Id: 24847
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Window Location and Size
					Left:   0.386"
					Top:    0.208"
					Width:  0.457"
					Width Editable? Yes
					Height: 0.167"
					Height Editable? Yes
				Visible? Yes
				Justify: Right
				Font Name: Default
				Font Size: 10
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Data Field: dfDate1
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: 10
					Data Type: String
					Editable? Yes
				Display Settings
					Window Location and Size
						Left:   0.971"
						Top:    0.167"
						Width:  1.586"
						Width Editable? Yes
						Height: 0.25"
						Height Editable? Yes
					Visible? Yes
					Border? Yes
					Justify: Left
					Format: Unformatted
					Country: Default
					Font Name: Default
					Font Size: Default
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
					Input Mask: Unformatted
				Message Actions
					On SAM_Validate
						If SalIsNull(hWndItem)
							Return VALIDATE_OkClearFlag
						If NOT SalIsValidDateTime(hWndItem)
							Call SalMessageBox('Неверный формат даты!',
									     'Внимание!', MB_Ok)
							Return VALIDATE_Cancel
						Set strDat1 = dfDate1
						Return VALIDATE_Ok
			Background Text: По:
				Resource Id: 24848
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Window Location and Size
					Left:   2.7"
					Top:    0.208"
					Width:  0.529"
					Width Editable? Yes
					Height: 0.167"
					Height Editable? Yes
				Visible? Yes
				Justify: Right
				Font Name: Default
				Font Size: 10
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Data Field: dfDate2
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: 10
					Data Type: String
					Editable? Yes
				Display Settings
					Window Location and Size
						Left:   3.314"
						Top:    0.167"
						Width:  1.586"
						Width Editable? Yes
						Height: 0.25"
						Height Editable? Yes
					Visible? Yes
					Border? Yes
					Justify: Left
					Format: Unformatted
					Country: Default
					Font Name: Default
					Font Size: Default
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
					Input Mask: Unformatted
				Message Actions
					On SAM_Validate
						If SalIsNull(hWndItem)
							Return VALIDATE_OkClearFlag
						If NOT SalIsValidDateTime(hWndItem)
							Call SalMessageBox('Неверный формат даты!',
									     'Внимание!', MB_Ok)
							Return VALIDATE_Cancel
						Set strDat1 = dfDate2
						Return VALIDATE_Ok
			Pushbutton: pbOk
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Утвердить
				Window Location and Size
					Left:   0.657"
					Top:    0.625"
					Width:  1.7"
					Width Editable? Yes
					Height: 0.333"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: Enter
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Picture File Name:
				Picture Transparent Color: None
				Image Style: Single
				Text Color: Default
				Background Color: Default
				Message Actions
					On SAM_Click
						If SalIsNull(dfDate1) Or SalIsNull(dfDate2)
							Call SalMessageBox('Незаполнены поля дат!',
									     'Внимание!', MB_Ok)
							Return FALSE
						Call SalEndDialog(hWndForm, 1)
			Pushbutton: pbCancel
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Отказаться
				Window Location and Size
					Left:   3.0"
					Top:    0.625"
					Width:  1.7"
					Width Editable? Yes
					Height: 0.333"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: (none)
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Picture File Name:
				Picture Transparent Color: None
				Image Style: Single
				Text Color: Dark Red
				Background Color: Default
				Message Actions
					On SAM_Click
						Call SalEndDialog(hWndForm, 0)
		Functions
		Window Parameters
			Receive String: strDat1
			Receive String: strDat2
		Window Variables
		Message Actions
			On SAM_Create
				Call SalCenterWindow(hWndForm)
				Set dfDate1 = strDat1
				Set dfDate2 = strDat2
	Form Window: frm_DKU
		Class:
		Property Template:
		Class DLL Name:
		Title: Перечень отделений районных казначейств
		Icon File:
		Accesories Enabled? Yes
		Visible? No
		Display Settings
			Display Style? Default
			Visible at Design time? No
			Automatically Created at Runtime? No
			Initial State: Normal
			Maximizable? Yes
			Minimizable? Yes
			System Menu? Yes
			Resizable? Yes
			Window Location and Size
				Left:   0.125"
				Top:    0.604"
				Width:  13.533"
				Width Editable? Yes
				Height: 6.333"
				Height Editable? Yes
			Form Size
				Width:  Default
				Height: Default
				Number of Pages: Dynamic
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
		Description: Ведомости по Казначейству
		Named Menus
		Menu
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Bottom
				Visible? Yes
				Size: 0.56"
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
				List Box: lbStatus
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class:
					Property Template:
					Class DLL Name:
					Window Location and Size
						Left:   7.333"
						Top:    0.071"
						Width:  5.95"
						Width Editable? Yes
						Height: 0.381"
						Height Editable? Yes
					Visible? Yes
					Multiple selection? No
					Sorted? No
					Vertical Scroll? Yes
					Font Name: Default
					Font Size: Default
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
					Horizontal Scroll? No
					List Initialization
					Message Actions
				Pushbutton: pbSvod
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class: cpbOk
					Property Template:
					Class DLL Name:
					Title: Сводная
					Window Location and Size
						Left:   0.133"
						Top:    0.06"
						Width:  Class Default
						Width Editable? Class Default
						Height: 0.464"
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name: \BARS98\RESOURCE\BMP\PACH.BMP
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							! Call Debug('Старт работы Make_DkuRep')
							Call Make_DkuRep(1)
				Pushbutton: pbSelected
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class: cpbOk
					Property Template:
					Class DLL Name:
					Title: Выбранных
					Window Location and Size
						Left:   1.383"
						Top:    0.06"
						Width:  Class Default
						Width Editable? Class Default
						Height: 0.464"
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name: \BARS98\RESOURCE\BMP\SELECT.BMP
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							Call Make_DkuRep(2)
				Pushbutton: pbSvodSelected
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class: cpbOk
					Property Template:
					Class DLL Name:
					Title: Свод+Выбор
					Window Location and Size
						Left:   3.883"
						Top:    0.06"
						Width:  Class Default
						Width Editable? Class Default
						Height: 0.464"
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name: \BARS98\RESOURCE\BMP\PACKSEL.BMP
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							Call Make_DkuRep(4)
				Pushbutton: pbSvodAll
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class: cpbOk
					Property Template:
					Class DLL Name:
					Title: Свод+Все
					Window Location and Size
						Left:   5.133"
						Top:    0.06"
						Width:  Class Default
						Width Editable? Class Default
						Height: 0.464"
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name: \BARS98\RESOURCE\BMP\PACHALL.BMP
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							Call Make_DkuRep(5)
				Pushbutton: pbAll
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class: cpbOk
					Property Template:
					Class DLL Name:
					Title: Всех
					Window Location and Size
						Left:   2.633"
						Top:    0.06"
						Width:  Class Default
						Width Editable? Class Default
						Height: 0.464"
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name: \BARS98\RESOURCE\BMP\DOCS.BMP
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							Call Make_DkuRep(3)
				Pushbutton: pbExit
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class: cpbOk
					Property Template:
					Class DLL Name:
					Title: Выход
					Window Location and Size
						Left:   6.483"
						Top:    0.06"
						Width:  0.7"
						Width Editable? Class Default
						Height: 0.464"
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name: \BARS98\RESOURCE\BMP\DISCARD.BMP
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							Call SalDestroyWindow(hWndForm )
							Set hWndDKU = hWndNULL
							Set nAvtoGen=1
				Line
					Resource Id: 55482
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class:
					Coordinates
						Begin X:  6.383"
						Begin Y:  0.095"
						End X:  6.383"
						End Y:  0.488"
					Visible? Yes
					Line Style: Etched
					Line Thickness: 1
					Line Color: Default
				Line
					Resource Id: 55483
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class:
					Coordinates
						Begin X:  7.233"
						Begin Y:  0.095"
						End X:  7.233"
						End Y:  0.488"
					Visible? Yes
					Line Style: Etched
					Line Thickness: 1
					Line Color: Default
		Contents
			Child Table: tbl1 !! Районные Казначейства
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Display Settings
					Window Location and Size
						Left:   0.383"
						Top:    0.107"
						Width:  9.75"
						Width Editable? Yes
						Height: 1.167"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: Default
					Font Enhancement: Bold
					Text Color: Dark Blue
					Background Color: Default
					View: Table
					Allow Row Sizing? No
					Lines Per Row: Default
				Memory Settings
					Maximum Rows in Memory: 3000
					Discardable? No
				Contents
					Column: Kod1
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Тер.
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  0.775"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colDPI
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Код
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: Number
						Justify: Right
						Width:  0.429"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					! Column: col5
.winattr
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? Yes
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
.end
						                                                                                                                                                            List Values
						                                                                                                                                                            Message Actions
					Column: Name1
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Податкова інспекція
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  4.357"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: ktk_name
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Район
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  4.0"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colKtk
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colid_key
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colSab
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
				Functions
				Window Variables
				Message Actions
					On SAM_Create
						! - - -  Вытяним маску территории для БОЛЬШИХ плательщиков
						! -- - 
						Call SalUseRegistry(FALSE, '')
						Call SalGetProfileString('DKU Reports', 'BigPayersMask', '', sBigPayersMask, GetIniFileName())
						! - - вычитаем параметр из таблицы params 
						! ==============================================
						! ==============================================
						Set sBigPayersMask = GetGlobalOption('KTKMASK')
								                   
						Call SalTblPopulate(tbl1, hSql(), "
								        SELECT substr(ktk, -6, 2), d.id, d.name, 
								               id_key||' - '||k.name, ktk, id_key, k.sab
								        INTO  :Kod1,  :colDPI,   :Name1, :ktk_name, :colKtk, :colid_key, :colSab
								        FROM terrdpi t, dpa d,  ktk k
								        WHERE t.kod_dpi=d.id AND k.idt = t.ktk
								                          AND substr(ktk, -6,6)= substr(k.idt, -6,2)||'0000'         
								        ORDER BY substr(ktk, length(ktk)-5,2), d.id", TBL_FillAll)
						!
						If sBigPayersMask!=''
							Call SalTblInsertRow ( tbl1, 0 )
							Call SalTblSetContext ( tbl1, 0 )
							Call SalTblSetRowFlags( tbl1, 0 ,ROW_New, FALSE)
							Set tbl1.Kod1 = sBigPayersMask
							Set tbl1.ktk_name = "ВЕЛИКІ платники районів"
							Set tbl1.colKtk = '0'
							Set tbl1.colid_key = '000'
							Call SqlPrepareAndExecute(hSql(), "SELECT kod_dpi, p.name
									                                   INTO :nIdDpi, :sNameDpi
									                                   FROM dpa p, terrdpi, ktk
									                                   WHERE kod_dpi=p.id AND ktkmask=:sBigPayersMask 
									                                         AND ktk.idt=ktk")
							Set K2s=0
							While SqlFetchNext ( hSql(), K2s )
							Set tbl1.Name1 = sNameDpi
							Set tbl1.colDPI = nIdDpi
						! - - -
						! Call SalTblInsertRow ( tbl1, 0 )
						! Call SalTblSetContext ( tbl1, 0 )
						! Call SalTblSetRowFlags( tbl1, 0 ,ROW_New, FALSE)
						! Set tbl1.Kod1 = '*'
						! Set tbl1.Name1 = '*********** ВСІ ***********'
						! Set tbl1.ktk_name ='*********** ВСІ ***********'
						! Call SalWaitCursor(FALSE)
						! ==============================================
						! ==============================================
						! ==============================================
			Custom Control: cSpltMain
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cXSalHSplitter
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   5.433"
						Top:    1.488"
						Width:  1.45"
						Width Editable? Class Default
						Height: 0.964"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Yes
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
		Functions
			Function: FU_1
				Description: Печать по ОДНОМУ или свода
				Returns
					Number:
				Parameters
					String: sKod          ! - - -  sKod = ktk или =хххх
					String: sSab          ! - - -  sSab
					String: sName
					String: sId_key       ! - - id_key (влияет только на расширение файла)
					String: sKtk_Name
					String: sIsSvod       ! - - -  =0 - для зведенного   =1 для территоріального
					Number: nRepType      ! - - -  Тип отчета =0 - rpt, =1- txt? =2 -dbf
				Static Variables
				Local variables
					String: sXX
					Number: nTmp
					Number: nKtkLen
					Number: i
					File Handle: hFileIn
					Long String: sFileLine
					String: sFileTypeKey ! поскольку мой номер типа файла nRepType - не совпадает с типом файла в доку казны
					String: sRenamedDBFFileName
				Actions
					Call SalWaitCursor(TRUE)
					Set K0 = 0
					Set ID = GetUserId()
					! ================================================================
					! ============ Создаем шаблон файла =============================
					! ================================================================
					! Директория для печати
					Set strPrintPath=  GetDkuRepPath(sKod)
					! Если это 412 DBF - другая директория
					If (nPar1 = 938 or nPar1 = 937) and nRepType=2
						Call SalUseRegistry(FALSE, '')
						Call SalGetProfileString('412', 'DbfPath', strPrintPath, strPrintPath, GetIniFileName())
					If (nPar1 = 43) and nRepType=2
						Call SalUseRegistry(FALSE, '')
						Call SalGetProfileString('PF', 'DbfPath', strPrintPath, strPrintPath, GetIniFileName())
					! -- митниця --
					If nPar1=922
						Set strFileNameTxt = strPureMask || sId_key ||
								   GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 3, 2) ) )
								   ||GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 0, 2) ) ) 
								   ||'.'||SalStrMidX(strDateFrom, 9, 1) || '??'
						Set strFileNameTxt =  SalStrLeftX(strFileNameTxt,10) ||GetNextFileSess(strPrintPath, strFileNameTxt,2,1)
					Else
						! мои форматы 0 - RPT формат, =1 - текстовый, =2 - DBF
						! казначейские 0 - DBF 1 - текстовый,
						Set sFileTypeKey=IifS(nRepType=0, '1', IifS(nRepType=2, '0', '0'))
						Set strFileNameTxt =  strPureMask || sIsSvod
								                     || sFileTypeKey
								                     || GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 3, 2) ) )
								                     || GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 0, 2) ) ) || '?.'||sId_key
						! Call Debug('Имя файла:'||strFileNameTxt)
						If nPar1 = 51
							Set strFileNameRtf =  strPureMask
									                     || GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 3, 2) ) )
									                     || GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 0, 2) ) )
									                     || '000.rtf '  ! - - - а потом переименуем в  sId_key.rtf
									
						Else
							Set strFileNameRtf =  strPureMask   || sIsSvod  ||'3'
									                   || GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 3, 2) ) )
									                   || GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 0, 2) ) ) || '?.rtf '  ! - - - а потом переименуем в  .'||sId_key
									
						Set strFileNameTxt =  SalStrLeftX(strFileNameTxt,7) ||GetNextFileSess(strPrintPath, strFileNameTxt,1,0)||'.'||sId_key
					!
					! Call Debug('Формирование для '||sKod||' файл '||strFileNameTxt)
					Set strBankName = sName
					Set strBankKod = sKtk_Name
					Set sTmp = ' '
					Set SHAP = ' '
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Если это не сводная  вычислим хвост для условия WHERE  (sTmp)
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					Set nKtkLen = SalStrLength( sKod )
					!
					If SalStrScan (sKod, 'x' ) =  -1
						If nPar1 = 400 or nPar1 = 401 or  nPar1 =51
							Set sTmp = "  p.acc in (
									    SELECT acc
									    FROM specparam
									    WHERE "|| IifS(nKtkLen>6, 
									                  " ktk like '"||sKod||"')", 
									                  " substr(ktk, -6,"|| SalNumberToStrX(nKtkLen,0)|| ")  like  '"||sKod||"')" )
						Else
							Set sTmp =  IifS(nKtkLen>6, 
									                 "  ktk like '"||sKod||"'", 
									                 "  substr(ktk, -6 ,"|| SalNumberToStrX(nKtkLen,0)|| ") like '" || sKod||"'"
									                 )
					Else
						Set sTmp= " 1=1 " ! Для условия WHERE 
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Ведомость 2M (3411) - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					If ( nPar1 = 300 or nPar1 = 301  )
						Call VisArrayFillNumber (R,  0, 10)
						Call VisArrayFillNumber (R0, 0, 10)
						! - - - - - сжатая - - - - - - - - - - - - - - -
						If nPar1 = 301
							Set strBind='Group2mLine'
							Set sSql="
									SELECT strformatN(kekd,8,' ')||strformatN(idr,2,' ' )||strformatN( s,15,' ')||strformatN(s1,15,' ')
									FROM
									             (SELECT kekd, idr, name,  sum(s) s, sum(s1) s1
									                          FROM  tmp_dku2mg p    WHERE " || sTmp || "
									                          GROUP BY kekd, idr, name
									                          ORDER BY kekd, idr )
									INTO  :Group2mLine
									ORDER BY kekd "
							Call SqlPrepareAndExecute(hSql(), T(sSql))
							Set nCount=0
							While SqlFetchNext(hSql(),nFetchRes)
								Set nCount = nCount+1
							! - - - - - - -   развенутая 2m - - - - - - - - - - - - - - - - - - - - - -
						Else
							Set strBind='K0,K3,K1,K2,S1,S2,S3,S4,S5,S6,S0,S,NAME'
							Set sSql ="    SELECT kekd, idr, name,  sum(s), sum(s1)
									                          INTO :K2,:K1,:NAME,:S,:S0
									                          FROM  tmp_dku2mg p    WHERE " || sTmp || "
									                          GROUP BY kekd, idr, name
									                          ORDER BY kekd, idr"
					!
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Ведомость 2M (3411, 3421) новая
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					Else If ( nPar1 = 299 OR nPar1 = 298)
						Set strBind='K0, S1,S2,S3,S4,S5,S6,S7,S8,S9,S10, SY1,SY2,SY3,SY4,SY5,SY6,SY7,SY8,SY9,SY10'
						Set sSql =" SELECT kekd, sum(sn1), sum(sn2), sum(sn3), sum(sn4),sum(sn5), sum(sn6),
								                         sum(sn7), sum(sn8), sum(sn9), sum(sn10),
								                         sum(syn1), sum(syn2), sum(syn3), sum(syn4),sum(syn5), sum(syn6),
								                         sum(syn7), sum(syn8),sum(syn9), sum(syn10)
								            INTO :K0,:S1,:S2,:S3,:S4,:S5,:S6,:S7,:S8,:S9,:S10,:SY1,:SY2,:SY3,:SY4,:SY5,:SY6,:SY7,:SY8,:SY9,:SY10
								            FROM  tmp_dku2m p  WHERE " || sTmp ||
								           " GROUP BY kekd " 
								            
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Ведомость 2M (3421) - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					Else If nPar1 = 302
						Call VisArrayFillNumber (R,  0, 10)
						Call VisArrayFillNumber (R0, 0, 10)
						Set strBind=  'K0,K3,K1,K2,S1,S2,S3,S4,S5,S6,S0,S,NAME'
						Set sSql ="
								SELECT  kekd, idr ,name, sum(s) , sum(s1)
								INTO :K2,:K1,:NAME,:S,:S0
								FROM  tmp_dku2mm p
								WHERE  " || sTmp || "
								GROUP BY kekd, idr ,name
								ORDER BY kekd, idr"
					!
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Ведомость N2 (3321) - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					Else If nPar1 = 303
						Set strBind= 'K1,S0,S,S1,S2,S3,S4,S5,S6,S7,S8,S9,S10'
						Set sSql = "
								    SELECT KEKD, sum(S),sum(SY),sum(SDR),sum(SYR),sum(SO),sum(SOY),
								           sum(SR),sum(SRY),sum(SS),sum(SSY),sum(PF),sum(PFY)
								    INTO :K1,:S0,:S,:S9,:S10,:S1,:S2,:S3,:S4,:S5,:S6,:S7,:S8
								    FROM tmp_dkuN2m p
								    WHERE  " || sTmp || "
								    GROUP BY KEKD
								    ORDER BY 1"
					!
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Ведомость N2 (3311) - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					Else If nPar1 = 200
						Set strBind = 'K0,K3,K1,K2,S1,S2,S3,S4,S5,S6,S0,S'
						Set K0 = 3311
						Set sSql = "  SELECT kekd , sum(s),  sum(sy), sum(so), sum(soy), sum(sr), sum(sry),  sum(ss), sum(ssy)
								                          INTO :K2,:S0,:S1,:S2,:S3,:S4,:S5,:S6,:S
								                          FROM  tmp_dkuN2g p
								                          WHERE " || sTmp || "
								                          GROUP BY KEKD  
								                          ORDER BY KEKD"
					!
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Реестры по ПФ и ФСС - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					Else If nPar1 = 40    !! Реестр по Фонду Соц.страха - безробіття  Держ.бюджет
						Set strBind   = 'K0,D1,NAME,S1,S0,S,SIM,NAZN, S2'
						Set SHAP = ' державного бюджету за доходами '
						Set ND    = ' ( Фонд занятості населення )'
						Set sSql="
								    SELECT sim, nam_a, okpo_a, datd, s, s_koef, s_back, nazn
								    INTO :SIM, :NAME, :S1,:D1,:S0,:S, :S2, :NAZN
								    FROM tmp_dkussg p
								    WHERE " || sTmp || "
								    ORDER BY 1,4,2,3"
					Else If nPar1 = 41    !! Реестр по Пенс.Фонду Держ.бюджет
						Set strBind   = 'K0,D1,NAME,S1,S0,S,SIM,NAZN, S2'
						Set SHAP = ' державного бюджету за доходами '
						Set ND    = ' (Пенсійний фонд)'
						Set sSql="
								    SELECT sim, nam_a, okpo_a, datd, s, s_koef, s_back, nazn
								    INTO :SIM, :NAME, :S1,:D1,:S0,:S, :S2, :NAZN
								    FROM tmp_dkupfg p
								    WHERE " || sTmp || "
								    ORDER BY 1,4,2,3"
					Else If nPar1 = 42    !! Реестр Фонду Соц.страха Держ.бюджет
						! Set strBind   = 'K0,K3,K1,K2,NAME,D1,S1,S2,S3,S0,S4,S5,S6,D2,SIM,NAZN,REF'
						Set strBind   = 'K0,D1,NAME,S1,S0,S,SIM,NAZN, S2'
						Set SHAP = ' державного бюджету за доходами '
						Set ND    = ' ( Фонд соціального страхування )'
						! !
						Set sSql="
								    SELECT sim, nam_a, okpo_a, datd, s, s_koef, s_back,nazn
								    INTO :SIM, :NAME, :S1,:D1,:S0,:S,:S2, :NAZN
								    FROM tmp_dkussg p
								    WHERE " || sTmp || "
								    ORDER BY 1,4,2,3"
					! !! устарело
					! Else If nPar1 = 43    !! Реестр по Пенс.Фонду Місц.бюджет
						                                                                                                                     Set strBind   = 'K0,D1,NAME,S1,S0,S,SIM,NAZN, S2'
						                                                                                                                     Set SHAP = ' місцевого бюджету за доходами '
						                                                                                                                     Set ND    = ' (Пенсійний фонд)'
						                                                                                                                     Set sSql="
								    SELECT sim, nam_a, okpo_a, datd, s, s_koef, s_back,nazn
								    INTO :SIM, :NAME, :S1,:D1,:S0,:S, :S2, :NAZN
								    FROM tmp_dkupfm p
								    WHERE  " || sTmp || "
								    ORDER BY 1,4,2,3"
					Else If nPar1 = 43    !! Реестр по Пенс.Фонду Місц.бюджет
						Set strBind   = 'K0,D1,NAME,S1,S0,S,SIM,NAZN,S2'
						Set SHAP = ' місцевого бюджету за доходами '
						Set ND    = ' (Пенсійний фонд)'
						Set sSql="SELECT SIM,MFOA,NLSA,OKPO_A,NAM_A,MFOB,NLSB,
								                 OKPO_B,NAM_B,VOB,ND,DATD,DATP,S,S_KOEF,S_BACK,NAZN
								            INTO :SIM,:MFOA,:NLSA,:S1,:NAME,:MFOB,:NLSB,
								                 :OKPO_B,:NAM_B,:vob,:NOM,:D1,:D2,:S0,:S,:S2,:NAZN
								            FROM tmp_dkupfm p
								           WHERE "|| sTmp ||" ORDER BY SIM,DATD,NAM_A,OKPO_A"
					Else If nPar1 = 44    !! Реестр Фонду Соц.страха Місц.бюджет
						Set strBind   = 'K0,D1,NAME,S1,S0,S,SIM,NAZN,S2'
						Set SHAP = ' місцевого бюджету за доходами '
						Set ND    = ' ( Фонд соціального страхування )'
						Set sSql="SELECT sim, nam_a, okpo_a, datd, s, s_koef, s_back,nazn
								            INTO :SIM, :NAME, :S1,:D1,:S0,:S, :S2, :NAZN
								            FROM tmp_dkussm p
								           WHERE " || sTmp ||" ORDER BY 1,4,2,3"
					!
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - - 412 (МБ/ДБ) - - - - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					Else If nPar1 = 62 or nPar1 = 938  !! 412 - ДБ (txt+dbf)
						!
						Set strBind = 'K0,K3,K2,S0,S1,S2,S3,S4,K0s,K1s,K2s,K3s,S5'
						Set sSql = "
								    SELECT p.GR, p.KVK, p.S230, lpad(p.KEKD, 8, '0'),Sum(p.DD),Sum(p.YYYY)
								    INTO :K3,:K3s,:K2s,:K2,:S1,:S2
								    FROM tmp_dku412g p WHERE " || sTmp || "
								    GROUP BY GR,KVK,S230,KEKD
								    ORDER BY GR,KVK,S230, KEKD"
					Else If nPar1 = 63   or nPar1 = 937  !! 412 - МБ (txt+dbf)
						Set strBind = 'K0,K3,K2,S0,S1,S2,S3,S4,K0s,K1s,K2s,K3s,S5'
						Set sSql = "
								    SELECT p.GR,p.KVK,p.S230,lpad(p.KEKD, 8, '0'),Sum(p.DD),Sum(p.YYYY)
								    INTO :K3,:K3s,:K2s,:K2,:S1,:S2
								    FROM tmp_dku412m p
								    WHERE  " || sTmp || "
								    GROUP BY p.GR,p.KVK,p.S230,p.KEKD
								    ORDER BY p.GR,p.KVK,p.S230,p.KEKD"
					!
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - - - выписки (+ без информационных 939, 940) - - - - - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					Else If (nPar1>=411 and nPar1<=414) or (nPar1>=939 and nPar1<=940)
						Set strBind = 'ACC,NLS,KV,ISO,FDAT,S,ND,MFO,NLSK, NAMK,' ||
								    'USI,REF,RNK,NAZN,OSTF,TT,DAPP,SK,OKPO,NB,VOB,DATP,NMK,NMS'
						Set sSql = "
								    SELECT p.isp,p.nls,p.kv,p.nms,p.acc,p.fdat,
								           p.s/100,p.nd,p.mfo,p.nlsk,p.namk,p.userid,
								           p.ref,p.sk,p.nazn,p.tt,p.ostf/100,p.dapp,
								           p.okpo,p.nb,p.vob,p.datp, m.nmk, m.rnk, s.fio
								    INTO :ISP,:NLS,:KV,:NMS,:ACC,:FDAT,:S,:ND,:MFO,
								         :NLSK,:NAMK,:USI,:REF,:SK,:NAZN,:TT,:OSTF,:DAPP,
								         :OKPO,:NB,:VOB,:DATP,:NMK,:RNK, :FIO
								    FROM cust_acc c, customer m, staff s, "
						If nPar1 = 411      !! Виписки з рахунків(MБ)-доходи
							Set sSql = sSql||" tmp_dkuvpm  "
						Else If nPar1 = 412 !! Виписки з рахунків(ДБ)-доходи
							Set sSql = sSql||" tmp_dkuvpg "
						Else If (nPar1 = 413 or nPar1 = 939)!! Виписки з рахунків(ДБ)-всі
							Set sSql = sSql||" tmp_dkuvpg "
						Else If (nPar1 = 414 or nPar1 = 940)!! Виписки з рахунків(МБ)-всі
							Set sSql =  sSql||" tmp_dkuvpm "
						!
						Set sSql =  sSql||" p  WHERE p.acc=c.acc AND c.rnk=m.rnk AND s.id=p.isp AND "  ||  sTmp ||  "
								    ORDER BY 2,3, 6,7, nvl(p.bis, 0) "
					Else If nPar1 = 51    !! Реестр №1 (Гос.Бюджет)                                                                !! Реєстр № 1
						Set K0 = 0
						Set strBind ='K0,K3,S6,TNAME,K1,K2,D1,NAME,S1,S2,S3,S0,S4,S5,D2,REF,TT'
						Set sSql = "
								 SELECT substr('0000' || p.kekd,-8,4),p.kekd,
								        l.ref,l.tt,o.nd,o.datd,o.id_a,o.mfoa,o.nlsa,
								        decode(l.dk,0,l.s,0),decode(l.dk,1,l.s,0),
								        d.id,d.name
								 INTO :K2,:K1,:REF,:TT,:NAME,:D2,:K3,:S2,:S3,:S0,:S1,:S6,:TNAME
								 FROM opl l, specparam p, oper o, terrdpi t, dpa d
								 WHERE l.fdat= :sFdat  AND substr(l.nls,1,4) IN
								       ('6511','6112','6513','6211','6411','7113') AND
								       t.ktk=p.KTK AND d.id=t.kod_dpi AND
								       l.acc=p.acc AND l.ref=o.ref AND
								       l.sos=5 AND" || sTmp || "
								 ORDER BY d.id,p.kekd"
					!
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - - - Митниця - - - - - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					Else If ( nPar1 = 920  or nPar1 = 922 )  !! 
						Set sSql = "
								SELECT decode(srt, '0', lpadchr(mfo, '0', 9)||rpad(nls,14)
								||'UAH'||to_CHAR(fdat,'YYYYMMDD')||nvl(to_char(dapp,'YYYYMMDD'),'        ')
								||lpad( to_char(ostf),19)||'                  0'||decode(sign(ostf),-1, '-','+')
								||lpad(to_char(bis),6)||lpad(to_char(dos),19)||'                  0'
								||lpad(to_char(s),6)||lpad(to_char(kos),19)||'                  0'
								||lpad(to_char(ostf+kos-dos),19)||'                  0'
								||decode(sign(ostf+kos-dos),-1, '-','+')
								||rpad(nvl(okpo,'              '),14)
								                    ||rpad(namk,38)
								                    ||rpad(nms,60),
								            decode(dk,0,'-','+')
								            ||lpadchr(mfo, '0', 9)
								            ||rpad(decode(dk,0,'0',nlsk),14)
								            ||rpad( nvl(okpo,'              '),14)
								            ||rpad(namk,40)
								            ||lpadchr(mfo2,'0',9)
								            ||rpad(decode(dk,1,'0',nlsk) ,14)
								            ||rpad(nvl(okpo2,'              '),14)
								            ||rpad(namk2,40)
								            ||lpad(nvl(vob,0),2)
								            ||lpad(nvl(nd,' '),10)   
								            ||lpad(to_char((sign(s))*s),19)
								            ||'                  0'
								            ||to_char(datp,'YYYYMMDDHH24MI') 
								            ||nvl( to_char(pdat,'YYYYMMDDHH24MI'), '            ') )
								            ||rpad(nazn,255) 
								        INTO  :sFileLine
								FROM tmp_dkuvpg
								WHERE "  || sTmp || 
								" order by fdat, nls, srt" 
					!
					Else
						Return 0
					!
					Set sTmp = ''
					! ! ==================================================
					! ! Начинаем печать в отчет
					! ! ==================================================
					! - - - - предварителььно установим принтер  - Установка єтого принтера как default  нужна лишь для того чтоб
					! - - - -  при формировании текстового отчета  -  были нормальные параметры вывода
					Set strInput = strBind
					Call SalWaitCursor ( TRUE )
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - - - Будем учитывать сколько записей выбралось в отчет, если не выбралось ничего  - будем
							! - - - - удалять эти файлы
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					Set nCou  = 0
					Set nInd = 0
					! Файл по шаблону RPT
					If nRepType  = 0 
						! Call SaveInfoToLog('REP_DKU: Перед формированием файла '||strFileNameTxt)
						Call SalReportPrintToFile(hWndForm,
								           strTmplPath,
								           strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
								           strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
						! Call SaveInfoToLog('REP_DKU: После формирования файла '||strFileNameTxt)
						If (nInd >4 )
							Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )
							! Call SalPrtSetDefault(sDeviceDef, sDriverDef, sPortDef)
							Call SalWaitCursor ( FALSE )
							Return -1
						! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
						! - - - -  - -  выбрали ли в файл отчета что-то - если нет - удалим этот файл
						! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
						If (nCou = 0 and  VisFileFind(strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt))  )! - - в отчет не было выбрано не одной записи
							If VisFileDelete (strPrintPath ||'\\'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt) ) < 0
								Call SalMessageBox('Не могу удалить файл нулевой длинны - '||strPrintPath ||'\\'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),'Внимание',0)
								Call SalWaitCursor ( FALSE )
								Return -1
							Call SalWaitCursor ( FALSE )
							Return -1
						! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
						! - - если это word формат - переименуем файл
						! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
						If FL_FORMAT
							If nPar1 = 51
								If VisFileRename (strPrintPath ||'\\'|| strFileNameRtf, strPrintPath ||'\\'||  SalStrLeftX(strFileNameRtf,5)||sId_key||'.rtf'  )<0
									Call SalMessageBox('Не могу переименовать файл - '||strPrintPath ||'\\'|| strFileNameRtf,  'Внимание', 0)
									Call SalWaitCursor ( FALSE )
									Return -1
							Else
								If VisFileRename (strPrintPath ||'\\'|| strFileNameRtf, strPrintPath ||'\\'||  SalStrLeftX(strFileNameRtf,9)|| sId_key)<0
									Call SalMessageBox('Не могу переименовать файл - '||strPrintPath ||'\\'|| strFileNameRtf,  'Внимание', 0)
									Call SalWaitCursor ( FALSE )
									Return -1
						! ANNY!!!!!
						If not FL_FORMAT
							Call SaveInfoToLog('REP_DKU: Начало обработки '|| strFileNameTxt)
							Call zarezDKU(  strPrintPath ||'/'|| strFileNameTxt)
							Call SaveInfoToLog('REP_DKU: Конец обработки '|| strFileNameTxt)
					! Файл текстотвый
					Else If nRepType  = 1
						If not  SalFileOpen ( hFileIn,strPrintPath||'\\'||strFileNameTxt, OF_Write )
							Call SalMessageBox(' Невозможно открыть для записи файл '|| strPrintPath||'\\'||strFileNameTxt, 'Внимание!',0)
							Call SalWaitCursor (FALSE )
							Return -1
						Else
							If SqlPrepareAndExecute(hSql(), T(sSql) )
								Set nTmp=0
								Set i=0
								While SqlFetchNext(hSql(), i)
									Call SalFilePutStr ( hFileIn,  sFileLine )
									Set nTmp=nTmp+1
							If not SalFileClose ( hFileIn )
								Call SalMessageBox(' Не возможно закрыть файл '||strPrintPath||'\\'||strFileNameTxt, 'Внимание!',0)
								Call SalWaitCursor (FALSE )
								Return -1
							! -- если данных нету - удалить файл
							If ( nTmp=0 and VisFileFind(strPrintPath||'/'||strFileNameTxt))
								If VisFileDelete (strPrintPath||'\\'||strFileNameTxt) < 0
									Call SalMessageBox('Не могу удалить файл нулевой длинны - '||strPrintPath||'\\'||strFileNameTxt,'Внимание',0)
									Call SalWaitCursor ( FALSE )
									Return -1
							!
					! DBF формат
					Else If nRepType  = 2 
						! Поставим расширение файла - DBF(потом переименуем)
						! Создавать и населять файлы будем в директории PrnDir(), а затем помещать их в директории по территориям
						! Call Debug('Установка соединеия с DBF')
						Set SqlDatabase = 'dBase_Files'
						! Call Debug('Перед установкой соединения с ДБФ коннектом')
						If not SqlConnect(hSqlA)
							Call SalMessageBox(' Невозможно установить соединение с dBase_Files ', 'Внимание!',0)
							Call SalWaitCursor (FALSE )
							Return -1
						!
						If nPar1 = 43    !! Реестр по Пенс.Фонду Місц.бюджет
							! Set strFileNameTxt = SalStrLeftX(strFileNameTxt,SalStrLength(strFileNameTxt)-4)||'.DBF'
							Set strFileNameTxt = SalStrLeftX(strFileNameTxt,SalStrLength(strFileNameTxt)-4)||sId_key||'.DBF'
							Call VisFileCopy( strPrintPath||"\\pf.dbf", strPrintPath||'\\'||strFileNameTxt) 
							! Call Debug(strPrintPath||"\\pf.dbf"||'->'|| strPrintPath||'\\'||strFileNameTxt)
						Else
							Set strFileNameTxt = SalStrLeftX(strFileNameTxt,SalStrLength(strFileNameTxt)-4)||sId_key||'.DBF'
							Call VisFileCopy( strPrintPath||"\\ft.dbf", strPrintPath||'\\'||strFileNameTxt) 
						! Скопируем шаблон ft.dbf в имя нашего файла
						!
						! Соединения hSqlA было инициализировано в функе Make_DKuRep
						! Во внутреннем поле "KO" для 412 должно стоять значение KOBL_412, а не AREACODE
						If SalStrScan (sKod, 'x' ) >= 0
							Set sId_key = GetGlobalOption('KOBL_412')
						! Счетик строк. (Если нету строк вообще - удаляем файл) 
						Set nTmp=0
						If SqlPrepareAndExecute(hSql(), T(sSql) )
							Set dTmp=SalFmtFormatStrDateTime(strDateFrom,'dd-MM-yyyy') 
							! Call Debug(T(sSql))
							! Call Debug('Данные есть для '||sSql)
							If nPar1 = 43
								Set sSql=" INSERT INTO "||SalStrLeftX(strFileNameTxt,SalStrLength(strFileNameTxt)-4)||
										"(DK,MFOA,NLSA,OKPO_A,NAM_A,MFOB,NLSB,OKPO_B,NAM_B,VOB,ND,S,DATD,DATP,NAZN)VALUES
										 (:DK,:MFOA,:NLSA,:OKPO_A,:NAM_A,:MFOB,:NLSB,:OKPO_B,:NAM_B,:vob,:NOM,:S,:D1,:D2,:NAZN) "
								While SqlFetchNext(hSql(), i)
									Set nTmp=nTmp+1
									! Set RN[0]=Str(K3)  ! группа
									! Set RN[1]=StrToStrFormat(Str(K2s),3,'0',TRUE) ! символ s230
									Set DK = IifS(S>=0,'+','-')
									Set OKPO_A=Str(S1)
									Set S=Abs(S)
									Set NAM_A=StrWinToDosX(NAME)
									Set NAM_B=StrWinToDosX(NAM_B)
									Set NAZN=StrWinToDosX(NAZN)
									If not SqlPrepareAndExecute(hSqlA, sSql)
										! Call Debug(strPrintPath||'\\'||strFileNameTxt)
										Call SalMessageBox(' Невозможно вставить строку в файл '|| strPrintPath||'\\'||strFileNameTxt, 'Внимание!',0)
										Call SalWaitCursor (FALSE )
										Return -1
							Else
								Set sSql=" INSERT INTO "||SalStrLeftX(strFileNameTxt,SalStrLength(strFileNameTxt)-4)||"(DT,KO,GR,S230,KOD,T060,T020)  VALUES( :dTmp,:sId_key,:RN[0],:RN[1],:RN[2],:S1,:S2) "
								While SqlFetchNext(hSql(), i)
									Set nTmp=nTmp+1
									Set RN[0]=Str(K3)  ! группа
									Set RN[1]=StrToStrFormat(Str(K2s),3,'0',TRUE) ! символ s230
									Set RN[2]=Str(K2)  ! KEKD
									If not SqlPrepareAndExecute(hSqlA, sSql)
										! Call Debug(strPrintPath||'\\'||strFileNameTxt)
										Call SalMessageBox(' Невозможно вставить строку в файл '|| strPrintPath||'\\'||strFileNameTxt, 'Внимание!',0)
										Call SalWaitCursor (FALSE )
										Return -1
							! переименовать 
							Call SqlCommit(hSqlA)
							Call SqlDisconnect(hSqlA)
							!
							! Удаление пустых 
							If ( nTmp=0 and VisFileFind(strPrintPath||'\\'||strFileNameTxt)  )
								! Call Debug('Данных НЕТУ!!!! Файл есть '||strPrintPath||'\\'||strFileNameTxt)
								If VisFileDelete (strPrintPath||'\\'||strFileNameTxt) < 0
									Call SalMessageBox('Не могу удалить файл нулевой длинны - '||strPrintPath||'\\'||strFileNameTxt,'Внимание',0)
									Call SalWaitCursor ( FALSE )
									Return -1
							Else
								If (nTmp!=0 and VisFileFind(strPrintPath||'\\'||strFileNameTxt))
									Set sRenamedDBFFileName = SalStrLeftX(strFileNameTxt, SalStrLength(strFileNameTxt)-7)||'.'||SalStrMidX(strFileNameTxt,8,3)
									!
									! Set sRenamedDBFFileName = SalStrLeftX(strFileNameTxt, SalStrLength(strFileNameTxt)-4)||'?.'||SalStrRightX(strFileNameTxt,3)
									! Set sRenamedDBFFileName = SalStrLeftX(sRenamedDBFFileName,7) ||GetNextFileSess(strPrintPath, sRenamedDBFFileName,1,0)||'.'||SalStrRightX(sRenamedDBFFileName,3)
									If VisFileRename(strPrintPath||'\\'||strFileNameTxt, strPrintPath||'\\'||sRenamedDBFFileName) < 0
										Call SalMessageBox(' Невозможно переименовать ', 'Внимание!',0)
										Call SalWaitCursor (FALSE )
										Return -1
							!
						! Set nCouDBFFilesToRename=nCouDBFFilesToRename+1
						! Set strDBFFilesToRename[nCouDBFFilesToRename-1]= SalStrLeftX(strFileNameTxt,SalStrLength(strFileNameTxt)-4)
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Посылаем сообщение чтоб перечитался список файлов для новой директории
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					Set frm_Out.dfPath = strPrintPath
					Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
					Call SalWaitCursor(FALSE)
					Return nInd
			Function: GetDkuRepPath
				Description: Возваращает путь к ящикам казначейств
				Returns
					String:
				Parameters
					String: sKtk
				Static Variables
				Local variables
					String: sTmp
				Actions
					Set strPrintPath = GetPrnDir()
					Call SalUseRegistry(FALSE, '')
					Call SalGetProfileString('DKU Reports', 'OutBoxPath', strPrintPath, sTmp, GetIniFileName())
					If SalStrUpperX(sTmp) != SalStrUpperX('None')
						! - - -Если это своодная
						If sKtk='x'
							Set sTmp =  sTmp || '\\' ||'00xx'
						! - - -Если это НЕ своодная
						Else
							! - - если KTK это маска
							If SalStrScan(sKtk,'\\_') > 0
								Set sTmp =  sTmp || '\\' ||'00bp'
							Else
								Set sTmp =  sTmp || '\\' ||'00'||SalStrLeftX (sKtk, 2)
					Else
						Set sTmp = strPrintPath
					If not VisDosExist(sTmp)
						If not SalFileCreateDirectory(sTmp)
							Call SalMessageBox('Не могу создать каталог:' || sTmp, 'Внимание', MB_IconStop)
							Return GetPrnDir()
					Return sTmp
			Function: GetNextFileSess
				Description: Дает новое расширение (сеанс файла)
				Returns
					String:
				Parameters
					String: strPrintDir
					String: strFileName 
					Number: nValLen      ! длинна счетчика 
					Number: nStart       ! c какого номера начинать счетчик
				Static Variables
				Local variables
					String: strRet
					String: strTmp
					Number: nTmp
					String: strFileList[*]
					Number: i
					Number: nFiles
					Number: nMaxNum
					Number: nStartPos
				Actions
					Set nFiles=VisDosEnumFiles( strPrintDir || '\\' || strFileName, FA_Standard, strFileList)
					If nFiles < 0
						Return NumberToStrFormat(nStart, nValLen,'0')
					Set i=1
					Set strTmp='?'
					While i<nValLen
						Set strTmp = strTmp||'?'
						Set i=i+1
					Set nMaxNum=0
					Set i=0
					Set nStartPos=SalStrScan(strFileName, strTmp)
					While i <= nFiles -1
						Set nTmp = SalStrToNumber(    SalStrMidX(strFileList[i],  nStartPos, nValLen  ) )
						If (  nTmp > nMaxNum )
							Set nMaxNum =nTmp
						Set i=i+1
					Return NumberToStrFormat(nMaxNum+1, nValLen,'0')
			Function: Prepare_DkuRep
				Description: ! - - тут подготавливаются временные таблицы для отчетности DKU
				Returns
					Number: nRet
				Parameters
					Number: nPar1
				Static Variables
				Local variables
					! String: strRBSName
				Actions
					Set ID = GetUserId()
					Call SalWaitCursor(TRUE)
					Call SaveInfoToLog('REP_DKU: Начало накопления временной таблицы')
					! - - - - - - для выписок населим сначала tmp_lic
					If (nPar1>=411 and nPar1<=414) or (nPar1>=939 and nPar1<=940)
						If nPar1 = 411              ! - - - МБ (доходы)
							Call Podgot_DKU(ID, sFdat, sFdat, 'DKZ', "vpm") ! накопление во  временные таблицы
						If nPar1 = 412              ! - - - ДБ (доходы)
							Call Podgot_DKU(ID, sFdat, sFdat, 'DKZ', "vpg") ! накопление во  временные таблицы
						If nPar1 = 413              ! - - - ДБ  (ВСЕ)
							Call Podgot_DKU(ID, sFdat, sFdat, '%', "vpg") ! накопление во  временные таблицы
						If nPar1 = 414              ! - - - МБ (ВСЕ)
							Call Podgot_DKU(ID, sFdat, sFdat, '%', "vpm") ! накопление во  временные таблицы
						If nPar1 = 939              ! - - - ДБ (ВСЕ - без информационных)
							Call Podgot_DKU(ID, sFdat, sFdat, '%&i', "vpg") ! накопление во  временные таблицы
						If nPar1 = 940              ! - - - МБ (ВСЕ - без информационных)
							Call Podgot_DKU(ID, sFdat, sFdat, '%&i', "vpm") ! накопление во  временные таблицы
					!
					! - - для 412(txt and dbf)
					If nPar1 = 63  or nPar1 = 62  or  nPar1 = 937  or nPar1 = 938
						! - - ( МБ)
						If nPar1 = 63  or  nPar1 = 937
							Call Podgot_DKU(ID, sFdat, sFdat, '1', "412") ! накопление во  временные таблицы
						! - - ( ДБ)
						Else
							Call Podgot_DKU(ID, sFdat, sFdat, '0', "412") ! накопление во  временные таблицы
						! Если это DBF - создать шаблон файла назначить струтуру файла
						If nPar1 = 937  or nPar1 = 938
							Set strDBFStruct = " (DT   DATE,
									                      KO   CHAR(3),
									                      GR   CHAR(1),
									                      S230 CHAR(3),
									                      KOD  CHAR(8),
									                      T060 NUMBER(16),
									                      T020 NUMBER(16) )"
					!
					! Ведомость на N2
					If nPar1 = 303 or nPar1 =  200
						If nPar1 = 303
							! - - - - 3321
							Call Podgot_DKU(ID, sFdat, sFdat, '*', "N2m") ! накопление во  временные таблицы
						If nPar1 =  200
							Call Podgot_DKU(ID, sFdat, sFdat, '*', "N2g") ! накопление во  временные таблицы
					!
					! Ведомость 2M
					If nPar1 = 300  or  nPar1 = 301 or  nPar1 = 302
						Call SqlPrepareAndExecute(hSql(),'SELECT idr,name INTO :nTmp,:sSql FROM PEREKR_R')
						While SqlFetchNext(hSql(),nFetchRes)
							If nTmp>0 AND nTmp<=10
								Set RN[nTmp]=sSql
						Call VisArrayFillNumber (R,  0, 10)
						Call VisArrayFillNumber (R0, 0, 10)
						! - - - госс бюдж.
						If nPar1 = 300  
							Call Podgot_DKU(ID, sFdat, sFdat, '0', "2m") ! накопление во  временные таблицы
						If nPar1 = 301
							Call Podgot_DKU(ID, sFdat, sFdat, '0', "2m") ! накопление во  временные таблицы
						! - - - местн бюдж.
						If nPar1 = 302
							Call Podgot_DKU(ID, sFdat, sFdat, '1', '2m') ! накопление во  временные таблицы
					!
					! Ведомость 2M - новая
					If nPar1 = 299 or nPar1 = 298 
						! госс  бюджет
						If nPar1 = 299
							Call Podgot_DKU(ID, sFdat, sFdat, '3411', "2mn") 
						! местный бюджет
						Else
							Call Podgot_DKU(ID, sFdat, sFdat, '3421', "2mn") 
					!
					! ! - - -ПФ - ФСС
					If nPar1 >= 40 and  nPar1 <= 44
						If nPar1 = 41    !! Реестр по Пенс.Фонду Держ.бюджет         
							Call Podgot_DKU(ID, sFdat, sFdat, '3411_3', "sspf") ! накопление во  временные таблицы
						Else If nPar1 = 42    !! Реестр Фонду Соц.страха Держ.бюджет 
							Call Podgot_DKU(ID, sFdat, sFdat, '3411_4', "sspf") ! накопление во  временные таблицы
						Else If nPar1 = 43    !! Реестр по Пенс.Фонду Місц.бюджет    
							Call Podgot_DKU(ID, sFdat, sFdat, '3421_3', "sspf") ! накопление во  временные таблицы
							Set strDBFStruct = " (
									  DK      CHAR(1),  
									  MFOA    CHAR(9),
									  NLSA    CHAR(14),
									  OKPO_A  CHAR(14),
									  NAM_A   CHAR(40),
									  MFOB    CHAR(9),
									  NLSB    CHAR(14),
									  OKPO_B  CHAR(14),
									  NAM_B   CHAR(40),
									  VOB     CHAR(2),
									  ND      CHAR(10),
									  S       NUMBER(19),
									  DATD    DATE,
									  DATP    DATE,
									  NAZN    CHAR(160)
									) "
						Else If nPar1 = 44    !! Реестр Фонду Соц.страха Місц.бюджет 
							Call Podgot_DKU(ID, sFdat, sFdat, '3421_4', "sspf") ! накопление во  временные таблицы
						Else If nPar1 = 40    !! Реестр Фонду Соц. страха Безробіття  Держ. Бюджет 
							Call Podgot_DKU(ID, sFdat, sFdat, '3411_5', "sspf") ! накопление во  временные таблицы
					!
					! ! - - - Митниця
					If nPar1 = 920 or nPar1 = 922
						Call Podgot_DKU(ID, sFdat, sFdat2, '%', "mv") ! накопление во  временные таблицы
					! In preparing
					Call SaveInfoToLog('REP_DKU: Конец накопления временной таблицы')
					Return 1
			Function: UnPrepare_DkuRep
				Description: ! - - тут очищаюся (вернее делатся rollback для временных таблиц
				Returns
					Number: nRet
				Parameters
					Number: nPar1
				Static Variables
				Local variables
				Actions
					!
					! - - для 412 - - - - - - - - - - - - -
					! If nPar1 = 63  or nPar1 = 62
					! Call UnPrepare_412()
					!
					Return 1
			Function: Prepare_Rep_InCreate
				Description: ! - - фактически это все действия которые выполняюся при создании формы frm_DKU - вынесено для автосоздания отчетов
						! - - так как при следующем отчете (из списка выбранных ) эта форма не создается заново
				Returns
				Parameters
					Number: nPar1
				Static Variables
				Local variables
				Actions
					If nPar1 = 400 or nPar1 = 401
						Set maska = '3%'
						Set ID = GetUserId()
						Call SalWaitCursor(TRUE)
						Call Podgot_LICS(ID, sFdat, sFdat, maska, 20) ! накопление во
								                                            ! временные
								                                            ! таблицы
						Call SalWaitCursor(FALSE)
			Function: Make_ReportFiles
				Description: Функция после подготовки временных таблиц - режит на файлы
				Returns
				Parameters
					Number: nFormat
					Number: nType
				Static Variables
				Local variables
					String: sRenamedDBFFileName
					String: sTableFileName
				Actions
					! Call Debug('В функции Make_ReportFiles')
					! ====================================
					! == Если формат DBF - подготовить файл
					! ====================================
					If nFormat=2
						! установим текущую директорию (все заточеноо под 412 и PF)
						Call SalUseRegistry(FALSE, '')
						If nPar1 = 43
							Call SalGetProfileString('PF', 'DbfPath', strPrintPath, strPrintPath, GetIniFileName())
							Set sTableFileName = 'pf.dbf'
						Else
							Call SalGetProfileString('412','DbfPath', strPrintPath, strPrintPath, GetIniFileName())
							Set sTableFileName = 'ft.dbf'
						If not SalFileSetCurrentDirectory(strPrintPath)
							Call SalMessageBox(' Невозможно установить директорию '|| strPrintPath||' текущей ', 'Внимание!',0)
							Call SalWaitCursor (FALSE )
							Return -1
						Set sTableFileName = strPrintPath||'\\'||sTableFileName
						If not VisFileFind(sTableFileName) 
							Set SqlDatabase = 'dBase_Files'
							If not SqlConnect(hSqlA)
								Call SalMessageBox(' Невозможно установить соединение с dBase_Files ', 'Внимание!',0)
								Call SalWaitCursor (FALSE )
								Return -1
							Call SqlPrepareAndExecute(hSqlA, "CREATE TABLE " ||sTableFileName||strDBFStruct)
							Call SqlDisconnect(hSqlA)
					! ====================================
					! == Выполним собственно отчет
					! ====================================
					! ------ Сводная-----------
					If nType = 1 or nType = 4 or nType = 5
						Call FU_1( 'x', GetBankSab(),GetBankName() , GetGlobalOption('AREACODE')||'00' , '','2',nFormat)
					! ------ Выбранные или Все--------
					If nType > 1 
						If nType = 3 or nType=5 !-- Все
							If nLevel >= 1
								Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, TRUE, 0, 0)
								! Call SalTblSetRowFlags(tbl1, 0, ROW_Selected, FALSE)
							If nLevel >= 2
								Call SalTblSetFlagsAnyRows(frm_RegPart.tblRada, ROW_Selected, TRUE, 0, 0)
								! Call SalTblSetRowFlags(frm_RegPart.tblRada, 0, ROW_Selected, FALSE)
							If nLevel >= 3
								Call SalTblSetFlagsAnyRows(frm_RegPart.tblSelo, ROW_Selected, TRUE, 0, 0)
							Set nTmp = 0
						Else
							Set nTmp = ROW_Selected
						!
						! -- по районам
						If nLevel >= 1 
							Set nTmp = ROW_Selected
							Set nRow = TBL_MinRow
							While SalTblFindNextRow(tbl1, nRow, nTmp, 0)
								Call SalTblSetContext(tbl1, nRow)
								Call FU_1(tbl1.Kod1, tbl1.colSab, tbl1.Name1, tbl1.colid_key, tbl1.ktk_name,'0',nFormat)
						! -- по сельским радам
						If nLevel >= 2 
							Set nTmp = ROW_Selected
							Set nRow = TBL_MinRow
							While SalTblFindNextRow(frm_RegPart.tblRada, nRow, nTmp, 0)
								Call SalTblSetContext(frm_RegPart.tblRada, nRow)
								Call FU_1(frm_RegPart.tblRada.Kod1, frm_RegPart.tblRada.colSab, frm_RegPart.tblRada.Name1,  frm_RegPart.tblRada.colid_key, frm_RegPart.tblRada.ktk_name, frm_RegPart.tblRada.colIsSvod,nFormat )
						! -- по селам
						If nLevel >= 3 
							Set nTmp = ROW_Selected
							Set nRow = TBL_MinRow
							While SalTblFindNextRow(frm_RegPart.tblSelo, nRow, nTmp, 0)
								Call SalTblSetContext(frm_RegPart.tblSelo, nRow)
								If nRow >= 0
									Call FU_1(frm_RegPart.tblSelo.Kod1, frm_RegPart.tblSelo.colSab, frm_RegPart.tblSelo.Name1, frm_RegPart.tblSelo.colid_key, frm_RegPart.tblSelo.ktk_name,'1',nFormat )
						!
						! ----
						If nType = 3 or nType=5
							If nLevel >= 1
								Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, FALSE, 0, 0)
							If nLevel >= 2
								Call SalTblSetFlagsAnyRows(frm_RegPart.tblRada, ROW_Selected, FALSE, 0, 0)
							If nLevel >= 3
								Call SalTblSetFlagsAnyRows(frm_RegPart.tblSelo, ROW_Selected, FALSE, 0, 0)
						!
						!
					! ------ Если это dbf - переименовать(для того что б не делать для каждого файла connect) -----
					If nFormat=2
						! Call SqlDisconnect(hSqlA)
						Set nRet=0
						! Call Debug('Всего файлов DBF:'||SalNumberToStrX(nCouDBFFilesToRename, 0))
						! While nRet < nCouDBFFilesToRename
							                           If VisFileFind(strPrintPath||'\\'||strDBFFilesToRename[nRet]||'.DBF')
								                           Set sRenamedDBFFileName = SalStrLeftX(strDBFFilesToRename[nRet], SalStrLength(strDBFFilesToRename[nRet])-4)||'?.'||SalStrRightX(strDBFFilesToRename[nRet],3)
								                           Set sRenamedDBFFileName = SalStrLeftX(sRenamedDBFFileName,7) ||GetNextFileSess(strPrintPath, sRenamedDBFFileName,1,0)||'.'||SalStrRightX(sRenamedDBFFileName,3)
										
								                           Call Debug('Переимеов:'||strPrintPath||'\\'||strDBFFilesToRename[nRet]||'.DBF'||' ->> '||strPrintPath||'\\'||sRenamedDBFFileName)
								                           If VisFileRename(strPrintPath||'\\'||strDBFFilesToRename[nRet]||'.DBF', strPrintPath||'\\'||sRenamedDBFFileName) < 0
									                           Call SalMessageBox(' Невозможно переименовать ', 'Внимание!',0)
									                           Call SalWaitCursor (FALSE )
									                           Return -1
							                           Set nRet=nRet+1
					!
			Function: KtlLike
				Description: Сравнивает, попадает ли даное sKtk под маску sKtkMask
				Returns
					Boolean: bIsLike_
				Parameters
					String: sKtk
					String: sKtkMask
				Static Variables
				Local variables
					Number: i
					Boolean: bIsLike
				Actions
					Set i=0
					Set bIsLike=TRUE
					While i<SalStrLength(sKtkMask)
						If SalStrMidX ( sKtkMask, i, 1) !='_'
							If SalStrMidX ( sKtkMask, i, 1) != SalStrMidX ( sKtkMask, i, 1)
								Set bIsLike=FALSE
								Return bIsLike
					Return bIsLike
			Function: ParseParam
				Description:
				Returns
				Parameters
				Static Variables
				Local variables
				Actions
			Function: Make_DkuRep
				Description:
				Returns
				Parameters
					Number: nType !-- (1-свод, 2-выборочные, 3-Все, 4-свод+выборочные, 5 - свод+все)
				Static Variables
				Local variables
					String: sArr[5]
					String: sRepParams[5]
					String: sDeb
					String: strTmp
					Number: nCurLine
				Actions
					! ===================================
					! -- Инициализация
					! ===================================
					Set sArr[0]='"Свод"'
					Set sArr[1]='"Выбор"'
					Set sArr[2]='"Все"'
					Set sArr[3]='"Свод+выбор"'
					Set sArr[4]='"Свод+все"'
					! ====================================
					! == Для каждого выбранного отчета
					! ====================================
					!
					Call SalWaitCursor(TRUE)
					Set nCurLine=TBL_MinRow
					While SalTblFindNextRow (  frm_Out.tblReps, nCurLine, ROW_Selected, 0 )
						Call SalTblSetContext( frm_Out.tblReps, nCurLine)
						Set strTmplPath = IifS(FL_FORMAT, GetTemplateDir() || "\\" || frm_Out.tblReps.repw,  GetTemplateDir() || "\\" || frm_Out.tblReps.rep)
						Set SHAP = SalNumberToStrX(frm_Out.tblReps.Kod, 0) || ' ' ||  frm_Out.tblReps.NAME
						Set DRUK = 'Printed: ' || SalFmtFormatDateTime(SalDateCurrent(), "dd/MM/yyyy hh:mm:ss")
						!
						Set sDeb=NumberToStrFormat( SalDateHour(SalDateCurrent()),2,'0' )||':'
								         ||NumberToStrFormat( SalDateMinute(SalDateCurrent()),2,'0' )||':'  
								         ||NumberToStrFormat(  SalDateSecond (SalDateCurrent()),2,'0' )||
								         '-Нач.'||sArr[nType-1] ||frm_Out.tblReps.NAME 
						Call SalListAdd ( lbStatus, sDeb)
						! ===================================
						! ==Вычленим параметры================
						! ===================================
						Set strPureMask = GetPureFileMask(frm_Out.tblReps.maska)
						Set strTmp = frm_Out.tblReps.param
						!
						Set sRepParams[0]='0'
						Set sRepParams[1]='0'
						Set sRepParams[2]='0'
						!
						Set i = SalStrScan (strTmp,',')
						Set sRepParams[0] = SalStrLeftX(strTmp, i)
						!
						Set strTmp = SalStrMidX(strTmp, i+1, SalStrLength(strTmp)- i )
						Set i = SalStrScan (strTmp,',')
						If i >-1
							! Код отчета
							Set sRepParams[1] = SalStrLeftX(strTmp, i)
							Set strTmp = SalStrMidX(strTmp, i+1, SalStrLength(strTmp)- i )
							Set i = SalStrScan (strTmp,',')
							If i >-1
								! тип формирования
								Set sRepParams[2] = SalStrLeftX(strTmp, i)
							Else
								Set sRepParams[2] = strTmp
							!
						Else
							Set sRepParams[1] =strTmp
						!
						! Код отчета
						Set nPar1 = SalStrToNumber( sRepParams[1] )
						! тип формирования
						Set nRepFileType = SalStrToNumber( sRepParams[2] )
						!
						! ====================================
						! == Подготовим временн. таблицы  
						! ====================================
						Call SalUpdateWindow ( lbStatus )
						Call Prepare_Rep_InCreate(nPar1)
						Call Prepare_DkuRep(nPar1)
						!
						! Цыкл по nRepFileType сделан для случая, если нужно генерить один отчет в разных форматах
						! Set i = nRepFileType
						! While i>=0 
							                                                                                                                                                   If nRepFileType >= 3
								                                                                                                                                                   Set nRepFileType=nRepFileType-1
							! ====================================
							! == Если формат DBF - подготовить файл
							! ====================================
							                                                                                                                                                   Call Debug('Делаем nRepFileType='||Str(nRepFileType))
							                                                                                                                                                   If nRepFileType=2
								! установим текущую директорию (все заточеноо под 412)
								                                                                                                                                                   Call SalUseRegistry(FALSE, '')
								                                                                                                                                                   Call SalGetProfileString('412', 'DbfPath', strPrintPath, strPrintPath, GetIniFileName())
								                                                                                                                                                   If not SalFileSetCurrentDirectory(strPrintPath)
									                                                                                                                                                   Call SalMessageBox(' Невозможно установить директорию '|| strPrintPath||' текущей ', 'Внимание!',0)
									                                                                                                                                                   Call SalWaitCursor (FALSE )
									                                                                                                                                                   Return -1
								                                                                                                                                                   Set SqlDatabase = 'dBase_Files'
								                                                                                                                                                   If not SqlConnect(hSqlA)
									                                                                                                                                                   Call SalMessageBox(' Невозможно установить соединение с dBase_Files ', 'Внимание!',0)
									                                                                                                                                                   Call SalWaitCursor (FALSE )
									                                                                                                                                                   Return -1
								                                                                                                                                                   If not VisFileFind(strPrintPath||"\\ft.dbf ") 
									!
									                                                                                                                                                   Call SqlPrepareAndExecute(hSqlA, "
											     CREATE
											     TABLE " || strPrintPath||"\\ft.dbf "||strDBFStruct)
								                                                                                                                                                   Set nCouDBFFilesToRename=0
							! ====================================
							! == Выполним собственно отчет
							! ====================================
							! ------ Сводная-----------
							                                                                                                                                                   If nType = 1 or nType = 4 or nType = 5
								                                                                                                                                                   Call FU_1( 'x', GetBankSab(),GetBankName() , GetGlobalOption('AREACODE')||'00', '','2')
							! ------ Выбранные или Все--------
							                                                                                                                                                   If nType > 1 
								                                                                                                                                                   If nType = 3 or nType=5 !-- Все
									                                                                                                                                                   If nLevel >= 1
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, TRUE, 0, 0)
										! Call SalTblSetRowFlags(tbl1, 0, ROW_Selected, FALSE)
									                                                                                                                                                   If nLevel >= 2
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(frm_RegPart.tblRada, ROW_Selected, TRUE, 0, 0)
										! Call SalTblSetRowFlags(frm_RegPart.tblRada, 0, ROW_Selected, FALSE)
									                                                                                                                                                   If nLevel >= 3
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(frm_RegPart.tblSelo, ROW_Selected, TRUE, 0, 0)
									                                                                                                                                                   Set nTmp = 0
								                                                                                                                                                   Else 
									                                                                                                                                                   Set nTmp = ROW_Selected
								!
								! -- по районам
								                                                                                                                                                   If nLevel >= 1 
									                                                                                                                                                   Set nTmp = ROW_Selected
									                                                                                                                                                   Set nRow = TBL_MinRow
									                                                                                                                                                   While SalTblFindNextRow(tbl1, nRow, nTmp, 0)
										                                                                                                                                                   Call SalTblSetContext(tbl1, nRow)
										                                                                                                                                                   Call FU_1(tbl1.Kod1, tbl1.colSab, tbl1.Name1, tbl1.colid_key, tbl1.ktk_name,'0')
								! -- по сельским радам
								                                                                                                                                                   If nLevel >= 2 
									                                                                                                                                                   Set nTmp = ROW_Selected
									                                                                                                                                                   Set nRow = TBL_MinRow
									                                                                                                                                                   While SalTblFindNextRow(frm_RegPart.tblRada, nRow, nTmp, 0)
										                                                                                                                                                   Call SalTblSetContext(frm_RegPart.tblRada, nRow)
										                                                                                                                                                   Call FU_1(frm_RegPart.tblRada.Kod1, frm_RegPart.tblRada.colSab, frm_RegPart.tblRada.Name1,  frm_RegPart.tblRada.colid_key, frm_RegPart.tblRada.ktk_name, frm_RegPart.tblRada.colIsSvod )
								! -- по селам
								                                                                                                                                                   If nLevel >= 3 
									                                                                                                                                                   Set nTmp = ROW_Selected
									                                                                                                                                                   Set nRow = TBL_MinRow
									                                                                                                                                                   While SalTblFindNextRow(frm_RegPart.tblSelo, nRow, nTmp, 0)
										                                                                                                                                                   Call SalTblSetContext(frm_RegPart.tblSelo, nRow)
										                                                                                                                                                   If nRow >= 0
											                                                                                                                                                   Call FU_1(frm_RegPart.tblSelo.Kod1, frm_RegPart.tblSelo.colSab, frm_RegPart.tblSelo.Name1, frm_RegPart.tblSelo.colid_key, frm_RegPart.tblSelo.ktk_name,'1' )
								!
								! ----
								                                                                                                                                                   If nType = 3 or nType=5
									                                                                                                                                                   If nLevel >= 1
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, FALSE, 0, 0)
									                                                                                                                                                   If nLevel >= 2
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(frm_RegPart.tblRada, ROW_Selected, FALSE, 0, 0)
									                                                                                                                                                   If nLevel >= 3
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(frm_RegPart.tblSelo, ROW_Selected, FALSE, 0, 0)
								!
								!
							! ------ Если это dbf - переименовать(для того что б не делать для каждого файла connect) -----
							                                                                                                                                                   If nRepFileType=2
								                                                                                                                                                   Call SqlDisconnect(hSqlA)
								! Call Debug('Всего файлов для переименовывания = '||Str(nCouDBFFilesToRename))
								                                                                                                                                                   Set nRet=0
								                                                                                                                                                   While nRet < nCouDBFFilesToRename
									! Call Debug('Rename '||strPrintPath||'\\'||strDBFFilesToRename[nRet]||'.DBF'||'  TO -->>'||             
											            strPrintPath||'\\'||SalStrLeftX(strDBFFilesToRename[nRet],SalStrLength(strDBFFilesToRename[nRet])-3)||'.'||SalStrRightX(strDBFFilesToRename[nRet],3))
									                                                                                                                                                   If VisFileRename(strPrintPath||'\\'||strDBFFilesToRename[nRet]||'.DBF', 
											                 strPrintPath||'\\'||SalStrLeftX(strDBFFilesToRename[nRet],SalStrLength(strDBFFilesToRename[nRet])-3)||'.'||SalStrRightX(strDBFFilesToRename[nRet],3)) < 0
										                                                                                                                                                   Call SalMessageBox(' Невозможно преименовать ', 'Внимание!',0)
										                                                                                                                                                   Call SalWaitCursor (FALSE )
										                                                                                                                                                   Return -1
									                                                                                                                                                   Set nRet=nRet+1
							!
							! сначала делаеться DBF, а потом TXT 
							                                                                                                                                                   If nRepFileType=0 OR  nRepFileType=1 OR  nRepFileType=2 
								                                                                                                                                                   Break 
							                                                                                                                                                   Set i=i-3
							!
						If nRepFileType<3
							Call Make_ReportFiles(nRepFileType, nType)
						Else
							! Тесктовый + DBF
							If nRepFileType=3
								Call Make_ReportFiles(0,nType) !-- текст
								Call Make_ReportFiles(2,nType) !-- dbf 
						Set sDeb=NumberToStrFormat( SalDateHour(SalDateCurrent()),2,'0' )||':'
								         ||NumberToStrFormat( SalDateMinute(SalDateCurrent()),2,'0' )||':'  
								         ||NumberToStrFormat(  SalDateSecond (SalDateCurrent()),2,'0' )||
								         '-Зак.'||sArr[nType-1]||frm_Out.tblReps.NAME 
						Call SalListAdd ( lbStatus, sDeb)
						Call SalUpdateWindow ( lbStatus )
						Call UnPrepare_DkuRep(nPar1) 
					!
					Call SalWaitCursor(FALSE)
		Window Parameters
			! String: sdat
			! Number: nRepPar
		Window Variables
			String: strNbuMfo
			Number: nTmp
			Number: R[*]
			Number: R0[*]
			String: RN[*]
			String: sTmp
			Date/Time: dTmp
			Number: nRow
			Boolean: bTest
			String: sKtk
			String: sSqlR
			String: strBind
			String: sSql
			!
			String: SHAP
			String: strBankName
			String: strBankKod
			String: RUK
			String: NAME
			String: TT
			String: TNAME
			Number: REF
			!
			String: sBigPayersMask
			String: sNameDpi
			Number: nIdDpi
			!
			Number: USI
			Number: K2OLD
			Number: K0
			Number: K0s
			Number: K1
			Number: BIS
			Number: K1s
			Number: K2
			Number: K2s
			Number: K3
			Number: K3s
			Number: S1
			Number: S2
			Number: S3
			Number: S4
			Number: S5
			Number: S6
			Number: S7
			Number: S8
			Number: S9
			Number: S10
			Number: SY1
			Number: SY2
			Number: SY3
			Number: SY4
			Number: SY5
			Number: SY6
			Number: SY7
			Number: SY8
			Number: SY9
			Number: SY10
			Number: S41
			Number: S51
			Number: S61
			Number: S0
			Number: S
			Date/Time: D1
			Date/Time: D2
			String: DK
			String: NOM
			String: NLSA
			String: NLSB
			String: MFOA
			String: MFOB
			String: NAM_A
			String: NAM_B
			String: OKPO_A
			String: OKPO_B
			String: sSqlS
			String: sSqlV
			Number: ACC
			String: NLS
			Number: KV
			String: ISO
			Date/Time: FDAT
			String: ND
			String: MFO
			String: NLSK
			String: NAMK
			String: NAZN
			String: SIM
			String: NB
			String: OKPO
			Date/Time: DAPP
			Number: ISP
			Date/Time: DATP
			String: NMK
			Number: RNK
			Number: SK
			Number: WD
			Number: VOB
			String: vob
			Number: OSTF
			Number: OSTF1
			Number: OBD
			Number: OBK
			Number: nCount
			String: PROB
			String: FIO
			String: maska
			String: maska2
			Number: nrab
			String: NMS
			Number: nKtk   ! - -  Выбранные районы, рады для 412 ф
			Number: i
			Number: nCou
			!
			Number: nTempRef
			String: sdattarh
			Long String: Group2mLine
			! сKtkObl : DKU
			!
		Message Actions
			On SAM_Create
				! Set nPar1=nRepPar
				! Есть ли села
				If ( SqlPrepareAndExecute(hSqlAux(),
						      "SELECT idt INTO :sKtk FROM ktk
						       WHERE substr(idt,-2,2)<>'00' " ) )
						  and ( SqlFetchNext(hSqlAux(), nFetchRes) )
					Set nLevel=3
				Else
					Set nLevel=2
				! - - инициализируем основной сплиттер
				Call cSpltMain.setTopFrame(tbl1)
				Call cSpltMain.setBarPosition( 300 )
				Call cSpltMain.setBottomFrame( SalCreateWindowEx( frm_RegPart, hWndForm, 0,0,0,0, CREATE_AsChild ) )
				Call cSpltMain.setBarSize(1)
				If SqlPrepareAndExecute(hSqlAux(), "
						   SELECT val
						   INTO :strNbuMfo
						   FROM params
						   WHERE par='MFOP'")
					Call SqlFetchNext(hSqlAux(), nFetchRes)
				Set strBankKod  = 'Зведена по області'
				Call Prepare_Rep_InCreate(nPar1)
			On SAM_ReportStart
				Call SetPrinter(1)
				Call SqlPrepare(hSql(), T(sSql))
			On SAM_ReportFetchInit
				If SqlExecute(hSql())
					Return TRUE
				Else
					Return FALSE
			On SAM_ReportFetchNext
				If SqlFetchNext(hSql(), nFetchRes)
					If nPar1 = 3 or nPar1 = 12 or nPar1 = 300 or nPar1 = 302
						Set R[K1] = R[K1] + S
						Set R0[K1] = R0[K1] + S0
					Else If nPar1 = 400 or nPar1 = 401 
						If SqlPrepareAndExecute(hSqlAux(), sSqlR)
							Call SqlFetchNext(hSqlAux(), nFetchRes)
						If SqlPrepareAndExecute(hSqlAux(), sSqlS)
							Call SqlFetchNext(hSqlAux(), nFetchRes)
					Set nCou = nCou + 1
					Return TRUE
			On SAM_ReportNotify
				If lParam = RPT_BeforeReportHeader
					Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
							     'strBankName', strBankName)
					Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
							     'strBankKod', strBankKod)
					If nPar1 = 301  ! - - - -  сжатая 2m
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
								     'sd1',  SalStrMidX(strDateFrom,0,2) || SalStrMidX(strDateFrom,3,2)  || SalStrMidX(strDateFrom,6,4) ||  NumberToStrFormat(nCount, 6,' ')||strFileNameTxt )
					Else
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'sd1', strDateFrom)
					Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'FIO', FIO)
					Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam), 'ISP', ISP)
					Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'NMS', NMS)
					Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'NMK', NMK)
					If nPar1 = 299 
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'NBS', '3411')
					If nPar1 = 298
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'NBS', '3421')
				If lParam = RPT_BeforeBreakHeader1
					Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'strBankName', strBankName)
					Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'strBankKod', strBankKod)
					Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'sd1', strDateFrom)
					Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'FIO', FIO)
					Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam), 'ISP', ISP)
					Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'NMS', NMS)
					Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'NMK', NMK)
					If nPar1 = 400 or nPar1 = 401  or (nPar1>=411 and nPar1<=414)
						Set OBD = 0
						Set OBK = 0
					Else If nPar1 = 41 or nPar1 = 42 or nPar1 = 43 or nPar1 = 44 or nPar1 = 40 
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'SHAP', SHAP)
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'ND', ND)
				If lParam=RPT_BeforeBreakHeader2 !! Смена даты
					Set OBD=0
					Set OBK=0
					Set rab=IifS(OSTF<0,'Дб:',IifS(OSTF>0,'Кр:',''))
					Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'VS',rab)
					Set OSTF1 = OSTF - OBD + OBK
				If lParam = RPT_BeforeBreakHeader4
					If nPar1=50 or nPar1=51
						If SqlPrepareAndExecute(hSqlAux(), "
								   SELECT name INTO :sTmp FROM kkd
								   WHERE ix" || Str(K1)) and
								   SqlFetchNext(hSqlAux(), nFetchRes)
							Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'STT', sTmp)
				If lParam = RPT_BeforeDetail
					If nPar1 = 400 or nPar1 = 401  or (nPar1>=411 and nPar1<=414)
						If S < 0
							Set OBD = OBD - S
						Else
							Set OBK = OBK + S
							Set PROB=''
						Set rab = SalNumberToStrX(SalNumberAbs(S),2) || PROB
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'SS', rab)
				If lParam = RPT_BeforeBreakFooter2
					If nPar1 = 400 or nPar1 = 401 or (nPar1>=411 and nPar1<=414)
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'OBD', OBD)
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'OBK', OBK)
						Set rab=IifS(OSTF1<0,'Дб:',IifS(OSTF1>0,'Кр:',''))
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'VYS',rab)
				! If lParam = RPT_BeforeBreakFooter1
				If lParam = RPT_BeforeReportFooter
					If nPar1 = 3 or nPar1 = 12 or nPar1 = 300 or nPar1 = 302
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R1',  R[1])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R2',  R[2])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R3',  R[3])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R4',  R[4])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R5',  R[5])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R6',  R[6])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R7',  R[7])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R8',  R[8])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R9',  R[9])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R10', R[10])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_1', R0[1])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_2', R0[2])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_3', R0[3])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_4', R0[4])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_5', R0[5])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_6', R0[6])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_7', R0[7])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_8', R0[8])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_9', R0[9])
						Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_10',R0[10])
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN1',RN[1])
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN2',RN[2])
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN3',RN[3])
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN4',RN[4])
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN5',RN[5])
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN6',RN[6])
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN7',RN[7])
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN8',RN[8])
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN9',RN[9])
						Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN10',RN[10])
			On SAM_Close
				Set hWndDKU = hWndNULL
			On SAM_CreateComplete
				Set hWndDKU = hWndForm
			On SAM_ReportFinish
				Call SetPrinter(0)
	Table Window: KL
		Class: cGenericTable
		Property Template:
		Class DLL Name:
		Title:
		Icon File:
		Accesories Enabled? Class Default
		Visible? Class Default
		Display Settings
			Visible at Design time? Yes
			Automatically Created at Runtime? Class Default
			Initial State: Class Default
			Maximizable? Class Default
			Minimizable? Class Default
			System Menu? Class Default
			Resizable? Class Default
			Window Location and Size
				Left:   0.84"
				Top:    0.617"
				Width:  12.614"
				Width Editable? Class Default
				Height: 5.031"
				Height Editable? Class Default
			Font Name: Class Default
			Font Size: Class Default
			Font Enhancement: Class Default
			Text Color: Class Default
			Background Color: Class Default
			View: Class Default
			Allow Row Sizing? Class Default
			Lines Per Row: Class Default
		Memory Settings
			Maximum Rows in Memory: Class Default
			Discardable? Class Default
		Description:
		Named Menus
		Menu
		Tool Bar
			Display Settings
				Display Style? Class Default
				Location? Class Default
				Visible? Class Default
				Size: Class Default
				Size Editable? Class Default
				Font Name: Class Default
				Font Size: Class Default
				Font Enhancement: Class Default
				Text Color: Class Default
				Background Color: Class Default
			Contents
				Pushbutton: pbIns
					Class Child Ref Key: 33
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? No
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbDel
					Class Child Ref Key: 34
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? No
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbRefresh
					Class Child Ref Key: 35
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   8.629"
						Top:    0.052"
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbUpdate
					Class Child Ref Key: 36
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? No
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name: \BARS98\RESOURCE\BMP\Tudasuda.bmp
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 48306
					Class Child Ref Key: 37
					Class ChildKey: 0
					Class: cGenericTable
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? No
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Pushbutton: pbSearch
					Class Child Ref Key: 38
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? No
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbFilter
					Class Child Ref Key: 44
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? No
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbDetails
					Class Child Ref Key: 39
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? No
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbPrint
					Class Child Ref Key: 40
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   9.186"
						Top:    0.052"
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 48307
					Class Child Ref Key: 41
					Class ChildKey: 0
					Class: cGenericTable
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? No
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Pushbutton: pbExit
					Class Child Ref Key: 42
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   9.743"
						Top:    0.052"
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 48308
					Class Child Ref Key: 43
					Class ChildKey: 0
					Class: cGenericTable
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? No
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Data Field: dDat
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class:
					Property Template:
					Class DLL Name:
					Data
						Maximum Data Length: Default
						Data Type: Date/Time
						Editable? Yes
					Display Settings
						Window Location and Size
							Left:   5.6"
							Top:    0.063"
							Width:  2.257"
							Width Editable? Yes
							Height: 0.25"
							Height Editable? Yes
						Visible? Yes
						Border? Yes
						Justify: Center
						Format: Date
						Country: Default
						Font Name: Default
						Font Size: Default
						Font Enhancement: Bold
						Text Color: Default
						Background Color: Default
						Input Mask: Unformatted
					Message Actions
		Contents
			Column: sKod
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: МФО
						 банка
				Visible? Yes
				Editable? No
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  1.171"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
			Column: sName
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Наименование
				Visible? Yes
				Editable? No
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  3.457"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
			Column: s412
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: По отчету банка
						(Ф.412)
				Visible? Yes
				Editable? No
				Maximum Data Length: Default
				Data Type: String
				Justify: Right
				Width:  2.2"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
			Column: k3510
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Поступило
						на счет 3510
				Visible? Yes
				Editable? No
				Maximum Data Length: Default
				Data Type: Number
				Justify: Right
				Width:  1.829"
				Width Editable? Yes
				Format: Decimal
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
			Column: d3510
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Перечислено
						в ГУДКУ
						со счета 3510
						
				Visible? Yes
				Editable? No
				Maximum Data Length: Default
				Data Type: Number
				Justify: Right
				Width:  1.829"
				Width Editable? Yes
				Format: Decimal
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
			Column: Delta
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Разница
				Visible? Yes
				Editable? No
				Maximum Data Length: Default
				Data Type: Number
				Justify: Right
				Width:  1.243"
				Width Editable? Yes
				Format: Decimal
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
		Functions
		Window Parameters
			Number: nPar
		Window Variables
			Number: nS1
			Number: nS2
			Number: nS3
			Number: nTmp
		Message Actions
			On SAM_Create
				!
				Set KL.dDat=GetBankDate()
				Call SalTblSetLockedColumns( hWndForm, 2 )
				Set KL.strPrintFileName = 'f412'
				Set KL.strSqlPopulate="
						 SELECT b.mfo,b.nb,
						        sum(decode(o.dk,1,o.s,0))/100,
						        sum(decode(o.dk,0,decode(o.tt,'PS1',o.s,0),0))/100 ,
						        sum(decode(o.dk,1,o.s,0))/100
						           -sum(decode(o.dk,0,decode(o.tt,'PS1',o.s,0),0))/100
						 INTO :KL.sKod, :KL.sName, :KL.k3510, :KL.d3510, :KL.Delta
						 FROM banks b, opl o
						 WHERE substr(b.mfo,1,5) = '30'||substr(o.nls,12,3) AND
						       o.fdat= :KL.dDat AND substr(o.nls,1,4)='3510'
						 GROUP BY b.mfo,b.nb
						UNION ALL
						SELECT '******','ИТОГО',
						        sum(decode(o.dk,1,o.s,0))/100,
						        sum(decode(o.dk,0,decode(o.tt,'PS1',o.s,0),0))/100 ,
						        sum(decode(o.dk,1,o.s,0))/100
						           -sum(decode(o.dk,0,decode(o.tt,'PS1',o.s,0),0))/100
						 FROM banks b, opl o
						 WHERE substr(b.mfo,1,5) = '30'||substr(o.nls,12,3) AND
						      o.fdat= :KL.dDat AND substr(o.nls,1,4)='3510'
						 ORDER BY 1"
				Call SalSendClassMessage( SAM_Create, 0, 0 )
			On UM_Populate
				Call SalWaitCursor(TRUE)
				Call SalSetWindowText( hWndForm,
						 'Сверка поступлений в бюджет от уполномоченных банкв за '||
						SalFmtFormatDateTime( dDat, 'dd-MM-yyyy') )
				! Set KL.nS1=0
				! Set KL.nS2=0
				! Set KL.nS3=0
				Call SalTblPopulate(hWndForm, cMain.hSql(), KL.strSqlPopulate, TBL_FillAll)
				! Call SalTblDefineSplitWindow (hWndForm, 1, TRUE)
				! Set nTmp = SalTblInsertRow( hWndForm, TBL_MinRow )
				! Call SalTblSetRowFlags( hWndForm, nTmp, ROW_New, FALSE )
				! Call SalTblSetContext(hWndForm, nTmp)
				! Set KL.sName='Итого'
				! Set KL.k3510=KL.nS1
				! Set KL.d3510=KL.nS2
				! Set KL.Delta = KL.nS3
				Call SalWaitCursor(FALSE)
			! On SAM_FetchRowDone
				                                                                                                                                                            Set KL.nS1 = KL.nS1 + KL.k3510
				                                                                                                                                                            Set KL.nS2 = KL.nS2 + KL.d3510
				                                                                                                                                                            Set KL.Delta = KL.k3510 - KL.d3510
				                                                                                                                                                            Set KL.nS3=KL.nS3 + KL.Delta
	Dialog Box: FormVW
		Class:
		Property Template:
		Class DLL Name:
		Title: Формирование файла выписок эл.клиентам (районы)
		Accesories Enabled? Yes
		Visible? No
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Type of Dialog: Modal
			Window Location and Size
				Left:   2.713"
				Top:    0.979"
				Width:  10.1"
				Width Editable? Yes
				Height: 5.821"
				Height Editable? Yes
			Absolute Screen Location? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
		Description: Формирование файла выписок эл.клиентам (районы)
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Top
				Visible? No
				Size: Default
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
		Contents
			Multiline Field: mlText
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: 1024
					String Type: String
					Editable? No
				Display Settings
					Border? No
					Word Wrap? Yes
					Vertical Scroll? No
					Window Location and Size
						Left:   6.7"
						Top:    4.238"
						Width:  3.2"
						Width Editable? Yes
						Height: 1.0"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: 10
					Font Enhancement: Bold
					Text Color: Default
					Background Color: 3D Face Color
				Message Actions
			Pushbutton: pbRun
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Выполнить
				Window Location and Size
					Left:   6.683"
					Top:    3.488"
					Width:  1.5"
					Width Editable? Yes
					Height: 0.298"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: F5
				Font Name: Default
				Font Size: 10
				Font Enhancement: Bold
				Picture File Name:
				Picture Transparent Color: None
				Image Style: Single
				Text Color: Dark Green
				Background Color: Default
				Message Actions
					On SAM_Click
						! Set sFile = sBackDocPath || IifS(bNBU, sFile1, sFile3)
						Set sFile = IifS(bNBU, sBackDocPath || sFile1, VisDosGetEnvString('TEMP') || '\\' || sFile3)
						Call SalHideWindow(ccMeter)
						If SalMessageBox('Выполнять формирование выписок за ' || SalFmtFormatDateTime(dYes, 'dd-MM-yyyy') || ' ?',
								   'ВНИМАНИЕ !!!', MB_YesNo | MB_IconQuestion) = IDNO
							Return 0
						Call SalWaitCursor(TRUE)
						Set sRBSName = GetGlobalOption('BIG_SEG')
						Set mlText = 'Отбор выписок за ' || Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
								    ' ' || Str(SalDateYear(dYes)) || ' г. ...'
						If SqlPrepareAndExecute(hSql(), T("
								   DELETE
								   FROM tmp_sab"))
							Call SqlCommit(hSql())
						Set nRow = TBL_MinRow
						Set nInd = 0
						Call SalArraySetUpperBound(sSelectSAB, 1, -1)
						Call SalArraySetUpperBound(sSelectMFOSAB, 1, -1)
						While SalTblFindNextRow(tbl1, nRow, 0, 0)
							Call SalTblSetContext(tbl1, nRow)
							If tbl1.colOTM = '1'
								Call SqlPrepareAndExecute(hSql(), T("
										     INSERT
										     INTO tmp_sab (sab)
										     VALUES (:tbl1.colSAB)"))
								Set sSelectSAB[nInd] = tbl1.colSAB
								Set sSelectMFOSAB[nInd] = tbl1.colMFOSAB
								Set nInd = nInd + 1
						Call SqlCommit(hSql())
						If bNBU
							If sRBSName
								! Make end of transaction and start new
								Call SqlCommit(hSql())
								! to avoid error with set transaction...
								Call SqlPrepareAndExecute(hSql(), 'SET TRANSACTION USE ROLLBACK SEGMENT ' || SalStrUpperX(sRBSName))
								! Call SaveInfoToLog('Установка роллбэк-сегмента 1')
							If SqlPrepareAndExecute(hSql(), T("
									   DELETE
									   FROM tmp_lick
									   WHERE id=:nUid"))
								Call SqlCommit(hSql())
							Set bOk = TRUE
							Set nKwo = 0
							If sRBSName
								! Make end of transaction and start new
								Call SqlCommit(hSql())
								! to avoid error with set transaction...
								Call SqlPrepareAndExecute(hSql(), 'SET TRANSACTION USE ROLLBACK SEGMENT ' || SalStrUpperX(sRBSName))
								! Call SaveInfoToLog('Установка роллбэк-сегмента 1')
							If SqlPLSQLCommand(hSql(), "p_lick(nUid,dYes)")
								Call SqlCommit(hSql())
								Call SqlPrepareAndExecute(hSql(), T("
										     SELECT count(*)
										     FROM tmp_lick
										     INTO :nKwo
										     WHERE id=:nUid"))
								Call SqlFetchNext(hSql(), nFetchRes)
								Set bOk = nKwo>0
							Else
								Set bOk = FALSE
							If bOk
								Set nPos = 0
								Set nDelta = 100 / nKwo
								If File(sFile)
									Set nI = 0
									While not SalFileOpen(hF, sFile, OF_Delete)
										Set nI = nI + 1
										If nI > 5
											Call SalWaitCursor(FALSE)
											Call MessageNoWait('Невозможно сформировать файл ' || sFile || ', возможно он занят другим приложением.',
													     'ВНИМАНИЕ !!!', 0, 1)
											Set mlText = ''
											Return 0
								Call SalFileGetCurrentDirectory(sOdir)
								Call SalFileSetCurrentDirectory(Left(sBackDocPath, Len(sBackDocPath)-1))
								Set SqlDatabase = 'dBase_Files'
								! родить VWABS.Dbf
								If SqlConnect(hSqlA)
									Set bFL = SqlPrepareAndExecute(hSqlA, "
											    CREATE
											    TABLE " || sFile1 || " (SAB     CHAR(4),
											                            NLS     CHAR(14),
											                            NLSK    CHAR(14),
											                            NAMS    CHAR(38),
											                            NMK     CHAR(38),
											                            MFO     NUMBER(9),
											                            ND      CHAR(10),
											                            ISP     NUMBER(3),
											                            EL      NUMBER(1),
											                            NM      NUMBER(1),
											                            NP      NUMBER(3),
											                            VOB     NUMBER(3),
											                            DK      NUMBER(1),
											                            S       NUMBER(16),
											                            DAOPL   DATE,
											                            ISM     NUMBER(16),
											                            DAPP    DATE,
											                            NAZ     CHAR(160),
											                            POND    CHAR(10),
											                            FN_A    CHAR(12),
											                            D_REC   CHAR(60),
											                            RNK     NUMBER(10),
											                            KOKK    CHAR(14),
											                            TD      CHAR(2),
											                            ISPZ    NUMBER(3),
											                            REF     NUMBER(10),
											                            POLU    CHAR(38),
											                            MINUSA3 NUMBER(16))")
									If sRBSName
										! Make end of transaction and start new
										Call SqlCommit(hSql())
										! to avoid error with set transaction...
										Call SqlPrepareAndExecute(hSql(), 'SET TRANSACTION USE ROLLBACK SEGMENT ' || SalStrUpperX(sRBSName))
										! Call SaveInfoToLog('Установка роллбэк-сегмента 2')
									If bFL
										Set bFL = SqlPrepareAndExecute(hSql(), "
												    SELECT sab,nls,nlsk,nams,nmk,mfo,nd,isp,el,nm,np,vob,dk,s,daopl,ism,dapp,naz,pond,fn_a,d_rec,rnk,kokk,
												           td,ispz,ref,polu,minusa3
												    INTO :sSAB,:sNLS,:sNLSK,:sNAMS,:sNMK,:sMFO,:sND,:nISP,:nEL,:nNM,:nNP,:nVOB,:nDK,:nS,:dDAOPL,:nISM,
												         :dDAPP,:sNAZ,:sPOND,:sFN_A,:sD_REC,:nRNK,:sKOKK,:sTD,:nISPZ,:nREF,:sPOLU,:nMinusA3
												    FROM tmp_lick
												    WHERE id=:nUid")
									If bFL
										Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || " (DAOPL)
												    VALUES (:dYes)")
										If not bFL
											Call SqlRollback(hSqlA)
											Set mlText = 'Ошибка 0 (внесение служебной записи) отбора выписок за ' || Str(SalDateDay(dYes)) || ' ' ||
													    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) || ' г.'
										Else
											Call SalShowWindow(ccMeter)
											While SqlFetchNext(hSql(), nFetchRes)
												Call ccMeter.SetProgress(nPos)
												Call SalUpdateWindow(hWndForm)
												Set sNLSK = IifS(Len(SalStrTrimX(sNLSK))=0, '0', sNLSK)
												Set sNAMS = StrWinToDosX2(sNAMS)
												Set sNMK = StrWinToDosX2(sNMK)
												Set nMFO = Val(sMFO)
												Set sND = StrWinToDosX2(sND)
												Set nISP = Mod(nISP, 100)
												Set sNAZ = StrWinToDosX2(sNAZ)
												Set sD_REC = StrWinToDosX2(sD_REC)
												Set nISPZ = Mod(nISPZ, 100)
												Set sPOLU = StrWinToDosX2(sPOLU)
												Set bFL = SqlPrepareAndExecute(hSqlA, "
														    INSERT
														    INTO " || sFile1 || "
														    VALUES (:sSAB,:sNLS,:sNLSK,:sNAMS,:sNMK,:nMFO,:sND,:nISP,:nEL,:nNM,:nNP,:nVOB,:nDK,:nS,:dDAOPL,
														            :nISM,:dDAPP,:sNAZ,:sPOND,:sFN_A,:sD_REC,:nRNK,:sKOKK,:sTD,:nISPZ,:nREF,:sPOLU,:nMinusA3)")
												If not bFL
													Break
												Else
													! Call SaveInfoToLog('INSERT into DBF: ' || PadR(sNLS, 14) || ' ' || Str(nMFO) || ' ' ||
															     PadR(sNLSK, 14) || ' ' || PadL(Str(nS/100), 20))
												Set nPos = nPos + nDelta
											If bFL
												Call SqlCommit(hSqlA)
												Call ccMeter.SetProgress(100)
												Set mlText = 'Выписки за ' || Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE)
														    || ' ' || Str(SalDateYear(dYes)) || ' г. отобраны.'
											Else
												Call SqlRollback(hSqlA)
												Set mlText = 'Ошибка 2 (запись строки) отбора выписок за ' || Str(SalDateDay(dYes)) || ' ' ||
														    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) || ' г.'
									Call SqlDisconnect(hSqlA)
									If bFL
										If File(sFile)
											Call SalFileCopy(sFile, sBackDocPath || sFile2, TRUE)
											! Call DebugN(VisFileCopy(sFile, sBackDocPath || sFile2))
									Else
										If File(sFile)
											Call VisFileDelete(sFile)
								Call SalFileSetCurrentDirectory(sOdir)
							Else
								Set mlText = 'Ошибка 1 (нет информации) отбора выписок за ' || Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(
										    SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) || ' г.'
						Else ! Treasury
							Set nVWABS = IifN(rb0, 0, IifN(rb1, 1, IifN(rb2, 2, IifN(rb3, 3, IifN(rb4, 4, 5)))))
							Call SalSetWindowText(hWndForm, sWText || ' ' || IifS(nVWABS=2 or nVWABS=3 or nVWABS=5, 'One', 'All') ||
									     IifS(nVWABS=0 or nVWABS=2, '', '+' || IifS(nVWABS>3, 'Deb.', '') || 'Info'))
							Call SaveInfoToLog('VWABS: начало отбора выписок')
							If nVWABS = 2 or nVWABS = 3 or nVWABS = 5
								! вариант по одному SAB
								Set nInd = 0
								Set bBeg1 = TRUE
								Set bBeg2 = TRUE
								Set bBeg3 = TRUE
								While nInd <= LenArray(sSelectSAB)
									Set sSAB_tmp = sSelectSAB[nInd]
									Set sMFOSAB = sSelectMFOSAB[nInd]
									! Set dfSAB = sSAB_tmp
									Set mlText = 'Отбор выписок за ' || Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE)
											    || ' ' || Str(SalDateYear(dYes)) || ' г. ... (' || sSAB_tmp || ')'
									! Call SaveInfoToLog(mlText)
									Call SaveInfoToLog('VWABS: за '||Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE)
											    || ' ' || Str(SalDateYear(dYes)) || ' для ' || sSAB_tmp )
									If sRBSName
										! Make end of transaction and start new
										Call SqlCommit(hSql())
										! to avoid error with set transaction...
										Call SqlPrepareAndExecute(hSql(), 'SET TRANSACTION USE ROLLBACK SEGMENT ' || SalStrUpperX(sRBSName))
										! Call SaveInfoToLog('Установка роллбэк-сегмента 1')
									! Call SaveInfoToLog('VWABS: очистка временной таблицы tmp_lick')
									If SqlPrepareAndExecute(hSql(), T("
											   DELETE
											   FROM tmp_lick
											   WHERE id=:nUid"))
										Call SqlCommit(hSql())
									Set bOk = TRUE
									Set nKwo = 0
									If sRBSName
										! Make end of transaction and start new
										Call SqlCommit(hSql())
										! to avoid error with set transaction...
										Call SqlPrepareAndExecute(hSql(), 'SET TRANSACTION USE ROLLBACK SEGMENT ' || SalStrUpperX(sRBSName))
										! Call SaveInfoToLog('Установка роллбэк-сегмента 1')
									Call SaveInfoToLog('VWABS: начало выполнения процедуры начеления p_lick1'|| IifS(nVWABS=2, '', IifS(nVWABS=3, 'i', 'd')))
									If SqlPLSQLCommand(hSql(), "p_lick1" || IifS(nVWABS=2, '',
											   IifS(nVWABS=3, 'i', 'd')) || "(nUid,dYes,sSAB_tmp,sMFOSAB)")
										Call SqlCommit(hSql())
										Call SaveInfoToLog('VWABS: процедура выполнена')
										Call SqlPrepareAndExecute(hSql(), T("
												     SELECT count(*)
												     FROM tmp_lick
												     INTO :nKwo
												     WHERE id=:nUid"))
										Call SqlFetchNext(hSql(), nFetchRes)
										! Call SaveInfoToLog('VWABS: подсчитано кол-во строк: '||SalNumberToStrX(nKwo,0))
										Set bOk = nKwo>0
										Call SalShowWindow(ccMeter)
									Else
										Set bOk = FALSE
									If bOk
										Set nPos = 0
										Set nDelta = 100 / nKwo
										If bBeg1
											If File(sFile)
												Set nI = 0
												While not SalFileOpen(hF, sFile, OF_Delete)
													Set nI = nI + 1
													If nI > 5
														Call SalWaitCursor(FALSE)
														Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														Set mlText = ''
														Return 0
											Set bBeg1 = FALSE
										! Call SalFileGetCurrentDirectory(sOdir)
										! Call SalFileSetCurrentDirectory(Left(sBackDocPath, Len(sBackDocPath)-1))
										! Set SqlDatabase = 'dBase_Files'
										! родить VWABS.Txt (было VWABS.Dbf)
										If TRUE ! SqlConnect(hSqlA)
											If bBeg2
												! Set bFL = SqlPrepareAndExecute(hSqlA, "
														    CREATE
														    TABLE " || sFile1 || " (SAB     CHAR(4),
														                            NLS     CHAR(14),
														                            NLSK    CHAR(14),
														                            NAMS    CHAR(38),
														                            NMK     CHAR(38),
														                            MFO     NUMBER(9),
														                            ND      CHAR(10),
														                            ISP     NUMBER(3),
														                            EL      NUMBER(1),
														                            NM      NUMBER(1),
														                            NP      NUMBER(3),
														                            VOB     NUMBER(3),
														                            DK      NUMBER(1),
														                            S       NUMBER(16),
														                            DAOPL   DATE,
														                            ISM     NUMBER(16),
														                            DAPP    DATE,
														                            NAZ     CHAR(160),
														                            POND    CHAR(10),
														                            FN_A    CHAR(12),
														                            D_REC   CHAR(60),
														                            RNK     NUMBER(10),
														                            KOKK    CHAR(14),
														                            TD      CHAR(2),
														                            ISPZ    NUMBER(3),
														                            REF     NUMBER(10),
														                            POLU    CHAR(38),
														                            MINUSA3 NUMBER(16))")
												Set bFL = SalFileOpen(hF, sFile, OF_Create | OF_Write)
												! Call SaveInfoToLog('VWABS: открыли файл для записи: ' ||sFile)
												Set bBeg2 = not bFL
												! Call SaveInfoToLog('Open File: ' || sFile)
											Else
												Set bFL = TRUE
											If sRBSName
												! Make end of transaction and start new
												Call SqlCommit(hSql())
												! to avoid error with set transaction...
												Call SqlPrepareAndExecute(hSql(), 'SET TRANSACTION USE ROLLBACK SEGMENT ' || SalStrUpperX(sRBSName))
												! Call SaveInfoToLog('Установка роллбэк-сегмента 2')
											If bFL
												! Call SaveInfoToLog('VWABS: выполнение запроса из временной таблицы')
												Set bFL = SqlPrepareAndExecute(hSql(), "
														    SELECT sab,nls,nlsk,nams,nmk,mfo,nd,isp,el,nm,np,vob,dk,s,daopl,ism,dapp,naz,pond,fn_a,d_rec,rnk,
														           kokk,td,ispz,ref,polu,minusa3
														    INTO :sSAB,:sNLS,:sNLSK,:sNAMS,:sNMK,:sMFO,:sND,:nISP,:nEL,:nNM,:nNP,:nVOB,:nDK,:nS,:dDAOPL,:nISM,
														         :dDAPP,:sNAZ,:sPOND,:sFN_A,:sD_REC,:nRNK,:sKOKK,:sTD,:nISPZ,:nREF,:sPOLU,:nMinusA3
														    FROM tmp_lick
														    WHERE id=:nUid")
											If bFL
												If bBeg3
													! Set bFL = SqlPrepareAndExecute(hSqlA, "
															    INSERT
															    INTO " || sFile1 || " (DAOPL)
															    VALUES (:dYes)")
													Set bFL = SalFileWrite(hF, PadL(DtoS(dYes), 163) || PutCrLf(), 165) = 165
													! Call SaveInfoToLog('VWABS: вставка в файл технической информации')
													Set bBeg3 = not bFL
													! Call SaveInfoToLog('Write File: 165 - begin')
												Else
													Set bFL = TRUE
												If not bFL
													! Call SqlRollback(hSqlA)
													Call SalFileClose(hF)
													! Call SaveInfoToLog('Close File: (error 0) ' || sFile)
													Call VisFileDelete(sFile)
													! Call SaveInfoToLog('Delete File: ' || sFile)
													Set mlText = 'Ошибка 0 (внесение служебной записи) отбора выписок за ' || Str(SalDateDay(dYes)) ||
															    ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) || ' г.'
												Else
													Set sBuffer = ''
													Call SaveInfoToLog('VWABS: начало формирования буффера строк выписки')
													While SqlFetchNext(hSql(), nFetchRes)
														Call ccMeter.SetProgress(nPos)
														Call SalUpdateWindow(hWndForm)
														Set sNLSK = IifS(Len(SalStrTrimX(sNLSK))=0, '0', sNLSK)
														Set sNAMS = StrWinToDosX2(sNAMS)
														Set sNMK = StrWinToDosX2(sNMK)
														Set nMFO = Val(sMFO)
														Set sND = StrWinToDosX2(sND)
														Set nISP = Mod(nISP, 100)
														Set sNAZ = StrWinToDosX2(sNAZ)
														Set sD_REC = StrWinToDosX2(sD_REC)
														Set nISPZ = Mod(nISPZ, 100)
														Set sPOLU = StrWinToDosX2(sPOLU)
														! Set bFL = SqlPrepareAndExecute(hSqlA, "
																    INSERT
																    INTO " || sFile1 || "
																    VALUES (:sSAB,:sNLS,:sNLSK,:sNAMS,:sNMK,:nMFO,:sND,:nISP,:nEL,
																            :nNM,:nNP,:nVOB,:nDK,:nS,:dDAOPL,:nISM,:dDAPP,:sNAZ,
																            :sPOND,:sFN_A,:sD_REC,:nRNK,:sKOKK,:sTD,:nISPZ,:nREF,
																            :sPOLU,:nMinusA3)")
														Set sBuffer = sBuffer || PadR(sSAB, 4) || PadR(sNLS, 14) || PadR(sNLSK, 14) || PadR(sNAMS, 38) ||
																    PadR(sNMK, 38) || PadL(Str(nMFO), 9) || PadR(sND, 10) || PadL(Str(nISP), 3) || PadL(
																    Str(nEL), 1) || PadL(Str(nNM), 1) || PadL(Str(nNP), 3) || PadL(Str(nVOB), 3) || PadL(
																    Str(nDK), 1) || PadL(Str(nS), 16) || PadR(DtoS(dDAOPL), 8) || PadL(Str(nISM), 16) || PadR(
																    DtoS(dDAPP), 8) || PadR(sNAZ, 160) || PadR(sPOND, 10) || PadR(sFN_A, 12) || PadR(sD_REC, 60) ||
																    PadL(Str(nRNK), 10) || PadR(sKOKK, 14) || PadR(sTD, 2) || PadL(Str(nISPZ), 3) ||
																    VisStrRightTrim(PadL(Str(nREF), 10) || PadR(sPOLU, 38) || IifS(nMinusA3>0,
																    PadL(Str(nMinusA3), 16), '')) || PutCrLf()
														If Len(sBuffer) > 64000
															Set bFL = SalFileWrite(hF, sBuffer, Len(sBuffer)) = Len(sBuffer)
															! Call SaveInfoToLog('VWABS: запись буффера в файл')
															! Call SaveInfoToLog('Write File: ' || Str(Len(sBuffer)))
															Set sBuffer = ''
														Else
															Set bFL = TRUE
														If not bFL
															Break
														! Else
															! Call SaveInfoToLog('INSERT into DBF: ' || PadR(sNLS, 14) || ' ' || Str(nMFO) || ' ' ||
																	     PadR(sNLSK, 14) || ' ' || PadL(Str(nS/100), 20))
															! Call SaveInfoToLog('INSERT into TXT: ' || PadR(sNLS, 14) || ' ' || Str(nMFO) || ' ' ||
																	     PadR(sNLSK, 14) || ' ' || PadL(Str(nS/100), 20))
														Set nPos = nPos + nDelta
													If bFL
														! Call SqlCommit(hSqlA)
														If Len(sBuffer) > 0
															Set bFL = SalFileWrite(hF, sBuffer, Len(sBuffer)) = Len(sBuffer)
															! Call SaveInfoToLog('Write File: ' || Str(Len(sBuffer)) || ' - end')
															Call SaveInfoToLog('VWABS: окончание записи в файл')
														! Call SalFileClose(hF)
														! Call SaveInfoToLog('Close File: ' || sFile)
														Call ccMeter.SetProgress(100)
														If bFL
															Set mlText = 'Выписка за ' || Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(
																	    SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) || ' г. отобрана (' || sSAB_tmp ||
																	    ').'
														Else
															Set mlText = 'Ошибка 3 (запись файла) отбора выписок за ' || Str(SalDateDay(dYes)) || ' ' ||
																	    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) || ' г. (' ||
																	    sSAB_tmp || ')'
													Else
														! Call SqlRollback(hSqlA)
														Call SalFileClose(hF)
														Call SaveInfoToLog('VWABS: закрываем сформирвоанный файл')
														! Call SaveInfoToLog('Close File (error 2): ' || sFile)
														Call VisFileDelete(sFile)
														Set mlText = 'Ошибка 2 (запись строки) отбора выписок за ' || Str(SalDateDay(dYes)) || ' ' ||
																    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) || ' г. (' ||
																    sSAB_tmp || ')'
											! Call SqlDisconnect(hSqlA)
											Call SalHideWindow(ccMeter)
										Call SalFileSetCurrentDirectory(sOdir)
									Set nInd = nInd + 1
								If bFL and not bBeg2
									Call SalFileClose(hF)
									! Call SaveInfoToLog('Close File: ' || sFile)
								If File(sFile)
									! Call VisFileCopy(sFile, sBackDocPath || sFile2)
									Call SalFileCopy(sFile, sBackDocPath || sFile4, TRUE)
									Call SaveInfoToLog('Copy File: ' || sFile || ' to ' || sBackDocPath || sFile4)
								If not bBeg3
									Set mlText = 'Выписки за ' || Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г. отобраны.'
									Call SalShowWindow(ccMeter)
									Call ccMeter.SetProgress(100)
								Else
									Set mlText = 'Ошибка 1 (нет информации) отбора выписок за ' || Str(SalDateDay(dYes)) || ' ' ||
											    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) || ' г.'
									Call SalHideWindow(ccMeter)
							Else ! nVWABS = 0 or nVWABS = 1 or nVWABS = 4
								! вариант по всем SABам
								If sRBSName
									! Make end of transaction and start new
									Call SqlCommit(hSql())
									! to avoid error with set transaction...
									Call SqlPrepareAndExecute(hSql(), 'SET TRANSACTION USE ROLLBACK SEGMENT ' || SalStrUpperX(sRBSName))
									! Call SaveInfoToLog('Установка роллбэк-сегмента 1')
								! Call SaveInfoToLog('VWABS: удаление из временной таблицы')
								If SqlPrepareAndExecute(hSql(), T("
										   DELETE
										   FROM tmp_lick
										   WHERE id=:nUid"))
									Call SqlCommit(hSql())
								Set bOk = TRUE
								Set nKwo = 0
								If sRBSName
									! Make end of transaction and start new
									Call SqlCommit(hSql())
									! to avoid error with set transaction...
									Call SqlPrepareAndExecute(hSql(), 'SET TRANSACTION USE ROLLBACK SEGMENT ' || SalStrUpperX(sRBSName))
									! Call SaveInfoToLog('Установка роллбэк-сегмента 1')
								! Set dYes = MMddyyyyToDate(SalFmtFormatDateTime(dYes, 'MM-dd-yyyy'))
								Call SaveInfoToLog('VWABS: перед выполнением процедуры p_lickA' || IifS(nVWABS=0, '', IifS(nVWABS=1, 'i', 'd')) || "(nUid,dYes)")
								If SqlPLSQLCommand(hSql(), "p_lickA" || IifS(nVWABS=0, '', IifS(nVWABS=1, 'i', 'd')) || "(nUid,dYes)")
									Call SqlCommit(hSql())
									Call SaveInfoToLog('VWABS: процедура выполнена')
									Call SqlPrepareAndExecute(hSql(), T("
											     SELECT count(*)
											     FROM tmp_lick
											     INTO :nKwo
											     WHERE id=:nUid"))
									Call SqlFetchNext(hSql(), nFetchRes)
									Set bOk = nKwo>0
								Else
									Set bOk = FALSE
								If bOk
									Set nPos = 0
									Set nDelta = 100 / nKwo
									If File(sFile)
										Set nI = 0
										While not SalFileOpen(hF, sFile, OF_Delete)
											Set nI = nI + 1
											If nI > 5
												Call SalWaitCursor(FALSE)
												Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
														     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
												Set mlText = ''
												Return 0
									! Call SalFileGetCurrentDirectory(sOdir)
									! Call SalFileSetCurrentDirectory(Left(sBackDocPath, Len(sBackDocPath)-1))
									! Set SqlDatabase = 'dBase_Files'
									! родить VWABS.Txt (было VWABS.Dbf)
									If SalFileOpen(hF, sFile, OF_Create | OF_Write) ! SqlConnect(hSqlA)
										! Set bFL = SqlPrepareAndExecute(hSqlA, "
												    CREATE
												    TABLE " || sFile1 || " (SAB     CHAR(4),
												                            NLS     CHAR(14),
												                            NLSK    CHAR(14),
												                            NAMS    CHAR(38),
												                            NMK     CHAR(38),
												                            MFO     NUMBER(9),
												                            ND      CHAR(10),
												                            ISP     NUMBER(3),
												                            EL      NUMBER(1),
												                            NM      NUMBER(1),
												                            NP      NUMBER(3),
												                            VOB     NUMBER(3),
												                            DK      NUMBER(1),
												                            S       NUMBER(16),
												                            DAOPL   DATE,
												                            ISM     NUMBER(16),
												                            DAPP    DATE,
												                            NAZ     CHAR(160),
												                            POND    CHAR(10),
												                            FN_A    CHAR(12),
												                            D_REC   CHAR(60),
												                            RNK     NUMBER(10),
												                            KOKK    CHAR(14),
												                            TD      CHAR(2),
												                            ISPZ    NUMBER(3),
												                            REF     NUMBER(10),
												                            POLU    CHAR(38),
												                            MINUSA3 NUMBER(16))")
										Call SaveInfoToLog('VWABS: открыли файл для записи '||sFile)
										Set bFL = TRUE
										! Call SaveInfoToLog('Open File: ' || sFile)
										If sRBSName
											! Make end of transaction and start new
											Call SqlCommit(hSql())
											! to avoid error with set transaction...
											Call SqlPrepareAndExecute(hSql(), 'SET TRANSACTION USE ROLLBACK SEGMENT ' || SalStrUpperX(sRBSName))
											! Call SaveInfoToLog('Установка роллбэк-сегмента 2')
										If bFL
											! Call SaveInfoToLog('VWABS: выполнение выборки из временной таблицы')
											Set bFL = SqlPrepareAndExecute(hSql(), "
													    SELECT sab,nls,nlsk,nams,nmk,mfo,nd,isp,el,nm,np,vob,dk,s,daopl,ism,dapp,naz,pond,fn_a,d_rec,rnk,
													           kokk,td,ispz,ref,polu,minusa3
													    INTO :sSAB,:sNLS,:sNLSK,:sNAMS,:sNMK,:sMFO,:sND,:nISP,:nEL,:nNM,:nNP,:nVOB,:nDK,:nS,:dDAOPL,:nISM,
													         :dDAPP,:sNAZ,:sPOND,:sFN_A,:sD_REC,:nRNK,:sKOKK,:sTD,:nISPZ,:nREF,:sPOLU,:nMinusA3
													    FROM tmp_lick
													    WHERE id=:nUid")
										If bFL
											! Set bFL = SqlPrepareAndExecute(hSqlA, "
													    INSERT
													    INTO " || sFile1 || " (DAOPL)
													    VALUES (:dYes)")
											Set bFL = SalFileWrite(hF, PadL(DtoS(dYes), 163) || PutCrLf(), 165) = 165
											! Call SaveInfoToLog('Write File: 165 - begin')
											If not bFL
												! Call SqlRollback(hSqlA)
												Call SalFileClose(hF)
												! Call SaveInfoToLog('Close File: (error 0) ' || sFile)
												Call VisFileDelete(sFile)
												! Call SaveInfoToLog('Delete File: ' || sFile)
												Set mlText = 'Ошибка 0 (внесение служебной записи) отбора выписок за ' || Str(SalDateDay(dYes)) || ' '
														    || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) || ' г.'
											Else
												Call SalShowWindow(ccMeter)
												Set sBuffer = ''
												Call SaveInfoToLog('VWABS: начало формирования буффера из строк выписки')
												While SqlFetchNext(hSql(), nFetchRes)
													Call ccMeter.SetProgress(nPos)
													Call SalUpdateWindow(hWndForm)
													Set sNLSK = IifS(Len(SalStrTrimX(sNLSK))=0, '0', sNLSK)
													Set sNAMS = StrWinToDosX2(sNAMS)
													Set sNMK = StrWinToDosX2(sNMK)
													Set nMFO = Val(sMFO)
													Set sND = StrWinToDosX2(sND)
													Set nISP = Mod(nISP, 100)
													Set sNAZ = StrWinToDosX2(sNAZ)
													Set sD_REC = StrWinToDosX2(sD_REC)
													Set nISPZ = Mod(nISPZ, 100)
													Set sPOLU = StrWinToDosX2(sPOLU)
													! Set bFL = SqlPrepareAndExecute(hSqlA, "
															    INSERT
															    INTO " || sFile1 || "
															    VALUES (:sSAB,:sNLS,:sNLSK,:sNAMS,:sNMK,:nMFO,:sND,:nISP,:nEL,:nNM,
															            :nNP,:nVOB,:nDK,:nS,:dDAOPL,:nISM,:dDAPP,:sNAZ,:sPOND,
															            :sFN_A,:sD_REC,:nRNK,:sKOKK,:sTD,:nISPZ,:nREF,:sPOLU,
															            :nMinusA3)")
													Set sBuffer = sBuffer || PadR(sSAB, 4) || PadR(sNLS, 14) || PadR(sNLSK, 14) || PadR(sNAMS, 38) ||
															    PadR(sNMK, 38) || PadL(Str(nMFO), 9) || PadR(sND, 10) || PadL(Str(nISP), 3) || PadL(Str(nEL), 1)
															    || PadL(Str(nNM), 1) || PadL(Str(nNP), 3) || PadL(Str(nVOB), 3) || PadL(Str(nDK), 1) || PadL(
															    Str(nS), 16) || PadR(DtoS(dDAOPL), 8) || PadL(Str(nISM), 16) || PadR(DtoS(dDAPP), 8) ||
															    PadR(sNAZ, 160) || PadR(sPOND, 10) || PadR(sFN_A, 12) || PadR(sD_REC, 60) || PadL(Str(nRNK), 10)
															    || PadR(sKOKK, 14) || PadR(sTD, 2) || PadL(Str(nISPZ), 3) || VisStrRightTrim(PadL(Str(nREF), 10)
															    || PadR(sPOLU, 38) || IifS(nMinusA3>0, PadL(Str(nMinusA3), 16), '')) || PutCrLf()
													If Len(sBuffer) > 64000
														Set bFL = SalFileWrite(hF, sBuffer, Len(sBuffer)) = Len(sBuffer)
														! Call SaveInfoToLog('VWABS: запись буффера (64000byte) в файл')
														Set sBuffer = ''
													Else
														Set bFL = TRUE
													If not bFL
														Break
													! Else
														! Call SaveInfoToLog('INSERT into DBF: ' || PadR(sNLS, 14) || ' ' || Str(nMFO) || ' ' ||
																     PadR(sNLSK, 14) || ' ' || PadL(Str(nS/100), 20))
														! Call SaveInfoToLog('INSERT into TXT: ' || PadR(sNLS, 14) || ' ' || Str(nMFO) || ' ' ||
																     PadR(sNLSK, 14) || ' ' || PadL(Str(nS/100), 20))
													Set nPos = nPos + nDelta
												If bFL
													! Call SqlCommit(hSqlA)
													If Len(sBuffer) > 0
														Set bFL = SalFileWrite(hF, sBuffer, Len(sBuffer)) = Len(sBuffer)
														! Call SaveInfoToLog('VWABS: запись технической информации в файл о завершении данных')
													Call SalFileClose(hF)
													Call SaveInfoToLog('VWABS: закрываем файл')
													Call ccMeter.SetProgress(100)
												Else
													! Call SqlRollback(hSqlA)
													Call SalFileClose(hF)
													! Call SaveInfoToLog('Close File (error 2): ' || sFile)
													Call VisFileDelete(sFile)
													Set mlText = 'Ошибка 2 (запись строки) отбора выписок за ' || Str(SalDateDay(dYes)) || ' ' ||
															    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) || ' г.'
										! Call SqlDisconnect(hSqlA)
										If bFL
											If File(sFile)
												! Call VisFileCopy(sFile, sBackDocPath || sFile2)
												Call SalFileCopy(sFile, sBackDocPath || sFile4, TRUE)
												! Call SaveInfoToLog('VWABS: копируем файл '|| sFile|| ' в ' || sBackDocPath || sFile4)
												Set mlText = 'Выписки за ' || Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE)
														    || ' ' || Str(SalDateYear(dYes)) || ' г. отобраны.'
										Else
											If File(sFile)
												Call VisFileDelete(sFile)
												! Call SaveInfoToLog('Delete File: ' || sFile)
												Set mlText = 'Ошибка 3 (запись файла) отбора выписок за ' || Str(SalDateDay(dYes)) || ' ' ||
														    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) || ' г.'
									! Call SalFileSetCurrentDirectory(sOdir)
								Else
									Set mlText = 'Ошибка 1 (нет информации) отбора выписок за ' || Str(SalDateDay(dYes)) || ' ' ||
											    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) || ' г.'
						Call SalWaitCursor(FALSE)
						! Set dfSAB = ''
			Pushbutton: pbExit
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Выход (Esc)
				Window Location and Size
					Left:   6.683"
					Top:    3.821"
					Width:  1.5"
					Width Editable? Yes
					Height: 0.298"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: Esc
				Font Name: Default
				Font Size: 10
				Font Enhancement: Bold
				Picture File Name:
				Picture Transparent Color: None
				Image Style: Single
				Text Color: Dark Blue
				Background Color: Default
				Message Actions
					On SAM_Click
						! Set sWText = 'ABCDEFGH IJKLMNOP QRSTUVWXYZ ????????????????????????????????? 333 4444 55555 ?
								abcdefgh ijklmnop qrstuvwxyz ????????????????????????????????? ??? ???'
						! Set sBuffer = Spac(Len(sWText))
						! Call CharToOemUkr(sWText, sBuffer)
						! Call Debug(sBuffer)
						Call SalEndDialog(hWndForm, 0)
			Custom Control: cc1
.data CLASSPROPSSIZE
0000: 3600
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 6461720025000100 0000000100010000 0200000001000001
0020: 0101010000000A31 352F30362F313935 360000000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cCalendar
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   6.683"
						Top:    1.488"
						Width:  3.2"
						Width Editable? Class Default
						Height: 1.917"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Bold
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
					On SAM_CustControlCmd
						Call cc1.GetFocusDate(dDada)
						If cc1.IsSpecialDate(SPECIAL_OneTime, dDada, DAY_Unset, SEQ_Unset)
							Call cc1.SpecialDate(SPECIAL_OneTime, dYes, DAY_Unset, SEQ_Unset, COLOR_Blue, COLOR_Cyan, TRUE)
							Set dYes = dDada
							Call cc1.SpecialDate(SPECIAL_OneTime, dYes, DAY_Unset, SEQ_Unset, COLOR_Blue, COLOR_Yellow, TRUE)
					On SAM_Create
						Call cc1.WeekStartSet(2)
			Child Table: tbl1
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Display Settings
					Window Location and Size
						Left:   0.083"
						Top:    -0.012"
						Width:  6.5"
						Width Editable? Yes
						Height: 5.5"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: Default
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
					View: Table
					Allow Row Sizing? No
					Lines Per Row: Default
				Memory Settings
					Maximum Rows in Memory: Default
					Discardable? Yes
				Contents
					Column: colOTM
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Отм.
						Visible? Yes
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  0.533"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Check Box
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value: 1
								Uncheck Value: 0
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colSAB
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Код
						Visible? Yes
						Editable? No
						Maximum Data Length: 4
						Data Type: String
						Justify: Left
						Width:  0.6"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colNMK
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Наименование
						Visible? Yes
						Editable? No
						Maximum Data Length: 38
						Data Type: String
						Justify: Left
						Width:  4.55"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colMFOSAB
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: МФО
						Visible? No
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Right
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
				Functions
				Window Variables
				Message Actions
					On SAM_Create
						Call WaitCursorOn()
						Call SalTblPopulate(tbl1, hSql(), T("
								     SELECT '1',sab,nb,mfo
								     FROM banks
								     INTO :tbl1.colOTM,:tbl1.colSAB,:tbl1.colNMK,:tbl1.colMFOSAB
								     WHERE kodn=4 and blk<>2 and blk<>3 and blk<>9 and fmi='$A' and fmo='$B'
								     ORDER BY sab"), TBL_FillAll)
						Call WaitCursorOff()
			Custom Control: ccMeter
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cMeter
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   6.683"
						Top:    5.238"
						Width:  3.2"
						Width Editable? Class Default
						Height: 0.25"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Dark Gray
					Background Color: Light Gray
					DLL Settings
				Message Actions
			Data Field: dfSAB
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: Default
					Data Type: String
					Editable? No
				Display Settings
					Window Location and Size
						Left:   9.083"
						Top:    3.512"
						Width:  0.833"
						Width Editable? Yes
						Height: 0.226"
						Height Editable? Yes
					Visible? No
					Border? No
					Justify: Right
					Format: Unformatted
					Country: Default
					Font Name: Default
					Font Size: 10
					Font Enhancement: Bold
					Text Color: Blue
					Background Color: Gray
					Input Mask: Unformatted
				Message Actions
			Radio Button: rb0
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: (0) по ВСЕМ, без инфор.
				Window Location and Size
					Left:   6.683"
					Top:    -0.012"
					Width:  3.2"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Bold
				Text Color: Default
				Background Color: Default
				Message Actions
					On SAM_Click
						Call SalSetWindowText(hWndForm, sWText || ' All')
			Radio Button: rb1
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: (1) по ВСЕМ + инфор.
				Window Location and Size
					Left:   6.683"
					Top:    0.238"
					Width:  3.2"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Bold
				Text Color: Default
				Background Color: Default
				Message Actions
					On SAM_Click
						Call SalSetWindowText(hWndForm, sWText || ' All+Info')
			Radio Button: rb2
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: (2) по ОДНОМУ, без инфор.
				Window Location and Size
					Left:   6.683"
					Top:    0.488"
					Width:  3.2"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Bold
				Text Color: Default
				Background Color: Default
				Message Actions
					On SAM_Click
						Call SalSetWindowText(hWndForm, sWText || ' One')
			Radio Button: rb3
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: (3) по ОДНОМУ + инфор.
				Window Location and Size
					Left:   6.683"
					Top:    0.738"
					Width:  3.2"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Bold
				Text Color: Default
				Background Color: Default
				Message Actions
					On SAM_Click
						Call SalSetWindowText(hWndForm, sWText || ' One+Info')
			Radio Button: rb4
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: (4) по ВСЕМ + деб.инфор.
				Window Location and Size
					Left:   6.683"
					Top:    0.988"
					Width:  3.2"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Bold
				Text Color: Default
				Background Color: Default
				Message Actions
					On SAM_Click
						Call SalSetWindowText(hWndForm, sWText || ' All+Deb.Info')
			Radio Button: rb5
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: (5) по ОДНОМУ + деб.инф.
				Window Location and Size
					Left:   6.683"
					Top:    1.238"
					Width:  3.2"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Bold
				Text Color: Default
				Background Color: Default
				Message Actions
					On SAM_Click
						Call SalSetWindowText(hWndForm, sWText || ' One+Deb.Info')
			Pushbutton: pbInvert
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Инвертировать
				Window Location and Size
					Left:   8.283"
					Top:    3.488"
					Width:  1.6"
					Width Editable? Yes
					Height: 0.298"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: (none)
				Font Name: Default
				Font Size: Default
				Font Enhancement: Bold
				Picture File Name:
				Picture Transparent Color: None
				Image Style: Single
				Text Color: Blue
				Background Color: Default
				Message Actions
					On SAM_Click
						Set nRow = TBL_MinRow
						While SalTblFindNextRow(tbl1, nRow, 0, 0)
							Call SalTblSetContext(tbl1, nRow)
							Set tbl1.colOTM = Str(1-Val(tbl1.colOTM))
			Pushbutton: pbMinus
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Снять пометки
				Window Location and Size
					Left:   8.283"
					Top:    3.821"
					Width:  1.6"
					Width Editable? Yes
					Height: 0.298"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: (none)
				Font Name: Default
				Font Size: Default
				Font Enhancement: Bold
				Picture File Name:
				Picture Transparent Color: None
				Image Style: Single
				Text Color: Red
				Background Color: Default
				Message Actions
					On SAM_Click
						Set nRow = TBL_MinRow
						While SalTblFindNextRow(tbl1, nRow, 0, 0)
							Call SalTblSetContext(tbl1, nRow)
							Set tbl1.colOTM = '0'
		Functions
			Function: LenArray
				Description: возвращает длину одномерного массива строк
				Returns
					Number:
				Parameters
					String: smArr[*]
				Static Variables
				Local variables
					Number: nBound
				Actions
					Call SalArrayGetUpperBound(smArr, 1, nBound)
					Return nBound
			! Function: StrWinToDosX1
				                                                                                                                   Description: 
				                                                                                                                   Returns 
					                                                                                                                   String: 
				                                                                                                                   Parameters 
					                                                                                                                   String: sIn
				                                                                                                                   Static Variables 
				                                                                                                                   Local variables 
					                                                                                                                   String: sWin
					                                                                                                                   String: sDos
					                                                                                                                   String: sOut
					                                                                                                                   Number: nI
					                                                                                                                   Number: nJ
				                                                                                                                   Actions 
					                                                                                                                   Set sWin = 'АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЬЪЫЭЮЯІЇЄабвгдеёжзийклмнопрстуфхцчшщьъыэюяіїє№Ґґ'
					                                                                                                                   Set sDos = 'ЂЃ‚ѓ„…р†‡€‰Љ‹ЊЌЋЏђ‘’“”•–—™њљ›ќћџIфт ЎўЈ¤Ґс¦§Ё©Є«¬­®Їабвгдежзиймклнопiхуьту'
					                                                                                                                   Set nI = 1
					                                                                                                                   Set sOut = ''
					                                                                                                                   While nI <= Len(sIn)
						                                                                                                                   Set nJ = At(Subs(sIn, nI, 1), sWin)
						                                                                                                                   If nJ > 0
							                                                                                                                   Set sOut = sOut || Subs(sDos, nJ, 1)
						                                                                                                                   Else 
							                                                                                                                   Set sOut = sOut || Subs(sIn, nI, 1)
						                                                                                                                   Set nI = nI + 1
					                                                                                                                   Return sOut
			Function: StrWinToDosX2
				Description:
				Returns
					String:
				Parameters
					String: sIn
				Static Variables
				Local variables
					String: sOut
				Actions
					! Call SalStrSetBufferLength(sOut, Len(sIn)+1)
					Set sOut = Spac(Len(sIn))
					! Call CharToOemA(VisStrSubstitute(VisStrSubstitute(sIn, 'і', 'i'), 'І', 'I'), sOut)
					Call CharToOemUkr(sIn, sOut)
					! Set sOut = GetValueStr("
							    SELECT substr(convert('" || VisStrSubstitute(sIn, Chr(39), Chr(39)+Chr(39)) || "','RU8PC866','CL8MSWIN1251'),1,200)
							    FROM dual")
					Return sOut
		Window Parameters
		Window Variables
			String: smWeek[7]
			String: smMonth[12]
			Date/Time: dDada
			Date/Time: dYes
			Date/Time: dSelect
			String: sDat
			Number: nI
			Number: nUid
			Number: nFetchRes
			Number: nKwo
			Boolean: bOk
			Boolean: bFL
			String: sBackDocPath
			String: sOdir
			String: sSAB
			String: sNLS
			String: sNLSK
			String: sNAMS
			String: sNMK
			String: sMFO
			Number: nMFO
			String: sND
			Number: nISP
			Number: nEL
			Number: nNM
			Number: nNP
			Number: nVOB
			Number: nDK
			Number: nS
			Date/Time: dDAOPL
			Number: nISM
			Date/Time: dDAPP
			String: sNAZ
			String: sPOND
			String: sFN_A
			String: sD_REC
			Number: nRNK
			String: sKOKK
			String: sTD
			Number: nISPZ
			Number: nREF
			String: sPOLU
			String: sFile
			String: sFile1
			String: sFile2
			String: sFile3
			String: sFile4
			File Handle: hSqlA
			File Handle: hF
			!
			Number: nRow
			!
			Number: nPos
			Number: nDelta
			!
			String: sRBSName
			!
			Number: nMinusA3
			!
			String: sSelectSAB[*]
			String: sSAB_tmp
			String: sSelectMFOSAB[*]
			String: sMFOSAB
			Boolean: bNBU
			Boolean: bBeg1
			Boolean: bBeg2
			Boolean: bBeg3
			Number: nInd
			!
			Number: nVWABS
			String: sWText
			!
			String: sBuffer
		Message Actions
			On SAM_Create
				Call SalCenterWindow(hWndForm)
				Set nUid = GetUserId()
				Set dYes = GetBankDate()
				Set sFile1 = 'VWAB_.Dbf'
				Set sFile2 = 'VWABS.Dbf'
				Set sFile3 = 'VWAB_.Txt'
				Set sFile4 = 'VWABS.Txt'
				Call SalWaitCursor(TRUE)
				Set bNBU = GetGlobalOption('NBUBANK')='1'
				Set nVWABS = Val(GetGlobalOption('VWABS'))
				Set nVWABS = IifN(nVWABS<0 or nVWABS>5, 0, nVWABS)
				If bNBU
					Call SalHideWindow(rb0)
					Call SalHideWindow(rb1)
					Call SalHideWindow(rb2)
					Call SalHideWindow(rb3)
					Call SalHideWindow(rb4)
					Call SalHideWindow(rb5)
				Else
					Set rb0 = nVWABS=0
					Set rb1 = nVWABS=1
					Set rb2 = nVWABS=2
					Set rb3 = nVWABS=3
					Set rb4 = nVWABS=4
					Set rb5 = nVWABS=5
				Call SalGetWindowText(hWndForm, sWText, 99)
				! Call SalSetWindowText(hWndForm, sWText || ' ' || IifS(nVWABS>1, 'One', 'All') || IifS(Mod(nVWABS, 2)=0, '', '+Info'))
				Call SalSetWindowText(hWndForm, sWText || ' ' || IifS(nVWABS=2 or nVWABS=3 or nVWABS=5, 'One', 'All') ||
						     IifS(nVWABS=0 or nVWABS=2, '', '+' || IifS(nVWABS>3, 'Deb.', '') || 'Info'))
				Call SalHideWindow(ccMeter)
				Call SalUseRegistry(FALSE, '')
				Call SalGetProfileString('ElektroKlients', 'BackDocPath', GetPrnDir(), sBackDocPath, GetIniFileName())
				Set sBackDocPath = IifS(Right(sBackDocPath, 1)='\\', sBackDocPath, sBackDocPath || '\\')
				Call cc1.ClearSpecials()
				Set mlText = 'Определение дат возможного выбора информации ...'
				Call SalSetFocus(cc1)
				Call GetMonthArrayRus(smMonth)
				Call GetWeekDayArray(smWeek)
				Call cc1.SetMonthText(smMonth)
				Call cc1.SetWeekDayText(smWeek)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
				Call SqlPrepareAndExecute(hSql(), T("
						     SELECT fdat
						     INTO :dSelect
						     FROM fdat"))
				Set nI = 0
				While SqlFetchNext(hSql(), nFetchRes)
					Call cc1.SpecialDate(SPECIAL_OneTime, dSelect, DAY_Unset, SEQ_Unset, COLOR_Blue, COLOR_Cyan, TRUE)
					Set nI = nI + 1
				If nI = 0
					Set mlText = 'Нет информации для отбора выписок.'
					Call SalHideWindow(ccMeter)
					Call SalHideWindow(pbRun)
					Call SalSetFocus(pbExit)
				Else
					Set mlText = ''
					Call cc1.SetFocusDate(dYes)
				Call SalWaitCursor(FALSE)
			On SAM_CreateComplete
				Call SalSetFocus(tbl1)
				Call SalTblSetFocusCell(tbl1, 0, tbl1.colOTM, 0, 1)
	Dialog Box: FormVWV
		Class:
		Property Template:
		Class DLL Name:
		Title: Формирование валютных выписок эл.клиентам
		Accesories Enabled? Yes
		Visible? No
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Type of Dialog: Modal
			Window Location and Size
				Left:   2.713"
				Top:    0.979"
				Width:  10.05"
				Width Editable? Yes
				Height: 4.369"
				Height Editable? Yes
			Absolute Screen Location? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
		Description: Формирование файла выписок эл.клиентам (районы)
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Top
				Visible? No
				Size: Default
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
		Contents
			Multiline Field: mlText
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: 1024
					String Type: String
					Editable? No
				Display Settings
					Border? No
					Word Wrap? Yes
					Vertical Scroll? No
					Window Location and Size
						Left:   6.683"
						Top:    2.488"
						Width:  3.2"
						Width Editable? Yes
						Height: 1.25"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: 10
					Font Enhancement: Bold
					Text Color: Default
					Background Color: 3D Face Color
				Message Actions
			Pushbutton: pbRun
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Выполнить
				Window Location and Size
					Left:   6.683"
					Top:    2.071"
					Width:  1.5"
					Width Editable? Yes
					Height: 0.298"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: F5
				Font Name: Default
				Font Size: 10
				Font Enhancement: Bold
				Picture File Name:
				Picture Transparent Color: None
				Image Style: Single
				Text Color: Dark Green
				Background Color: Default
				Message Actions
					On SAM_Click
						Call SalWaitCursor(TRUE)
						Call SalTimerKill(hWndItem, 1)
						Call SalDisableWindow(tbl1)
						Set sFile = sBackDocPath || sFile1
						Set mlText = 'Отбор валютных выписок за ' || Str(SalDateDay(dYes)) || ' ' ||
								    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) ||
								    ' г. ...'
						Call SqlPrepareAndExecute(hSql(), T("
								     DELETE
								     FROM tmp_sabv"))
						Set nRow = TBL_MinRow
						While SalTblFindNextRow(tbl1, nRow, 0, 0)
							Call SalTblSetContext(tbl1, nRow)
							If tbl1.colOTM = '1'
								Call SqlPrepareAndExecute(hSql(), T("
										     INSERT
										     INTO tmp_sabv (sab)
										     VALUES (:tbl1.colSAB)"))
						Set bOk = TRUE
						Set nKwo = 0
						Set sRBSName = GetGlobalOption('BIG_SEG')
						If sRBSName
							Call SqlCommit(hSql())
							Call SqlPrepareAndExecute(hSql(), 'SET TRANSACTION USE ROLLBACK SEGMENT ' ||
									     SalStrUpperX(sRBSName))
						! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
						! Call SalMessageBox('Begin exe p_liv','AT',0)
						! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
						If SqlPLSQLCommand(hSql(), "p_liv(nUid,dYes)")
							Call SqlCommit(hSql())
							Call SqlPrepareAndExecute(hSql(), T("
									     SELECT count(*)
									     FROM tmp_licv
									     INTO :nKwo
									     WHERE id=:nUid"))
							Call SqlFetchNext(hSql(), nFetchRes)
							Set bOk = nKwo>0
							! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
							! Call SalMessageBox('END execute p_liv','AT',0)
							! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
						Else
							Set bOk = FALSE
						If bOk
							Set nPos = 0
							Set nDelta = 100 / nKwo
							If File(sFile)
								Set nI = 0
								While not SalFileOpen(hF, sFile, OF_Delete)
									Set nI = nI + 1
									If nI > 5
										Set mlText = ''
										Call SalWaitCursor(FALSE)
										Call SalMessageBeep(-1)
										Call SalMessageBeep(-1)
										Call SalMessageBeep(-1)
										Call SalMessageBeep(-1)
										Call SalMessageBeep(-1)
										Call SalMessageBeep(-1)
										Call SalMessageBeep(-1)
										Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
												     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
										Call SalTimerSet(pbExit, 2, 1)
										Return 0
							Call SalFileGetCurrentDirectory(sOdir)
							Call SalFileSetCurrentDirectory(Left(sBackDocPath, Len(sBackDocPath)-1))
							Set SqlDatabase = 'dBase_Files'
							! родить VWABSV.Dbf
							! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
							! Call SalMessageBox('INCOME TO retrieve from tmp_licv','AT',0)
							! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
							If SqlConnect(hSqlA)
								Set bFL = SqlPrepareAndExecute(hSqlA, "
										    CREATE
										    TABLE " || sFile1 || " (SAB    CHAR(4),
										                            DATP   DATE,
										                            TIMP   CHAR(8),
										                            AAMF   NUMBER(9),
										                            NAQH   CHAR(38),
										                            RNK    NUMBER(6),
										                            NMK    CHAR(38),
										                            NMS    CHAR(38),
										                            KVAL   CHAR(3),
										                            NVAL   CHAR(15),
										                            NLS    CHAR(14),
										                            KVD    NUMBER(3),
										                            ODATE  DATE,
										                            VDATE  DATE,
										                            ISP    NUMBER(3),
										                            DPOTK  DATE,
										                            DPOPK  DATE,
										                            ETALS  NUMBER(5),
										                            KPOTK  NUMBER(12,4),
										                            KPOPK  NUMBER(12,4),
										                            DIGIT  NUMBER(1),
										                            SISV   NUMBER(16),
										                            SIS    NUMBER(16),
										                            NLSK   CHAR(14),
										                            ISPK   CHAR(2),
										                            KVK    NUMBER(3),
										                            ND     NUMBER(3),
										                            ISV    NUMBER(16),
										                            ISR    NUMBER(16),
										                            NAZN   CHAR(220),
										                            DK     NUMBER(1))") and SqlPrepareAndExecute(hSql(), "
										    SELECT sab,rnk,nmk,nms,kval,nval,nls,kvd,odate,vdate,isp,dpotk,dpopk,etals,
										           kpotk,kpopk,digit,sisv,sis,nlsk,ispk,kvk,nd,isv,isr,nazn,dk
										    INTO :sSAB,:nRNK,:sNMK,:sNMS,:sKVAL,:sNVAL,:sNLS,:nKVD,:dODATE,:dVDATE,:nISP,
										         :dDPOTK,:dDPOPK,:nETALS,:nKPOTK,:nKPOPK,:nDIGIT,:nSISV,:nSIS,:sNLSK,
										         :nISPK,:nKVK,:sND,:nISV,:nISR,:sNAZN,:nDK
										    FROM tmp_licv
										    WHERE id=:nUid")
								! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
								! Call SalMessageBox('EXIT FROM retrieve from tmp_licv','AT',0)
								! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
								If bFL
									! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
									! Call SalMessageBox('BEGIN INSERT odate','AT',0)
									! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
									Set bFL = SqlPrepareAndExecute(hSqlA, "
											    INSERT
											    INTO " || sFile1 || " (ODATE)
											    VALUES (:dYes)")
									! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
									! Call SalMessageBox('END INSERT odate','AT',0)
									! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
									If not bFL
										Call SqlRollback(hSqlA)
										Set mlText =
												    'Ошибка 0 (внесение служебной записи) отбора валютных выписок за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
									Else
										! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
										! Call SalMessageBox('BEGIN INSERT *.dbf','AT',0)
										! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
										Call SalShowWindow(cc1)
										While SqlFetchNext(hSql(), nFetchRes)
											Call ccMeter.SetProgress(nPos)
											Set dDATP = SalDateCurrent()
											Set sTIMP = Right('0' || SalFmtFormatDateTime(dDATP, 'hhhh:mm:ss'), 8)
											Set sNMK = StrWinToDosX(sNMK)
											Set sNMS = StrWinToDosX(sNMS)
											Set sKVAL = StrWinToDosX(sKVAL)
											Set sNVAL = StrWinToDosX(sNVAL)
											Set nMFO = Val(sMFO)
											Set nND = Val('000' || Right(sND, 3))
											Set nISP = Mod(nISP, 1000)
											Set sISPK = Right('00' || Str(Mod(nISPK, 100)), 2)
											Set sNAZN = StrWinToDosX(sNAZN)
											Set bFL = SqlPrepareAndExecute(hSqlA, "
													    INSERT
													    INTO " || sFile1 || "
													    VALUES (:sSAB,:dDATP,:sTIMP,:nAAMF,:sNAQH,:nRNK,:sNMK,:sNMS,:sKVAL,
													            :sNVAL,:sNLS,:nKVD,:dODATE,:dVDATE,:nISP,:dDPOTK,:dDPOPK,
													            :nETALS,:nKPOTK,:nKPOPK,:nDIGIT,:nSISV,:nSIS,:sNLSK,:sISPK,
													            :nKVK,:nND,:nISV,:nISR,:sNAZN,:nDK)")
											If not bFL
												Break
											Set nPos = nPos + nDelta
										! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
										! Call SalMessageBox('END INSERT *.dbf','AT',0)
										! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
										If bFL
											Call SqlCommit(hSqlA)
											Call ccMeter.SetProgress(100)
											Set mlText = 'Выписки(В) за ' || Str(SalDateDay(dYes)) || ' ' ||
													    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
													    SalDateYear(dYes)) || ' г. отобраны.'
										Else
											Call SqlRollback(hSqlA)
											Set mlText = 'Ошибка 2 (запись строки) отбора выписок(В) за ' || Str(
													    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
													    ' ' || Str(SalDateYear(dYes)) || ' г.'
								Call SqlDisconnect(hSqlA)
								If bFL
									If File(sFile)
										Call SalFileCopy(sFile, sBackDocPath || sFile2, TRUE)
								Else
									If File(sFile)
										Call SalFileOpen(hF, sFile, OF_Delete)
							Call SalFileSetCurrentDirectory(sOdir)
						Else
							Set mlText = 'Ошибка 1 (нет информации) отбора выписок(В) за ' || Str(
									    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' ||
									    Str(SalDateYear(dYes)) || ' г.'
						Call SalWaitCursor(FALSE)
						Call SalTimerSet(pbExit, 2, 7000)
			Pushbutton: pbExit
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Выход
				Window Location and Size
					Left:   8.383"
					Top:    2.071"
					Width:  1.5"
					Width Editable? Yes
					Height: 0.298"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: F10
				Font Name: Default
				Font Size: 10
				Font Enhancement: Bold
				Picture File Name:
				Picture Transparent Color: None
				Image Style: Single
				Text Color: Dark Blue
				Background Color: Default
				Message Actions
					On SAM_Click
						Call SalEndDialog(hWndForm, 0)
			Custom Control: cc1
.data CLASSPROPSSIZE
0000: 3600
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 6461720025000100 0000000100010000 0200000001000001
0020: 0101010000000A31 352F30362F313935 360000000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cCalendar
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   6.683"
						Top:    0.071"
						Width:  3.2"
						Width Editable? Class Default
						Height: 1.917"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Bold
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
					On SAM_CustControlCmd
						Call cc1.GetFocusDate(dDada)
						If cc1.IsSpecialDate(SPECIAL_OneTime, dDada, DAY_Unset, SEQ_Unset)
							Call cc1.SpecialDate(SPECIAL_OneTime, dYes, DAY_Unset, SEQ_Unset, COLOR_Blue,
									     COLOR_Cyan, TRUE)
							Set dYes = dDada
							Call cc1.SpecialDate(SPECIAL_OneTime, dYes, DAY_Unset, SEQ_Unset, COLOR_Blue,
									     COLOR_Yellow, TRUE)
					On SAM_Create
						Call cc1.WeekStartSet(2)
			Child Table: tbl1
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Display Settings
					Window Location and Size
						Left:   0.083"
						Top:    0.071"
						Width:  6.5"
						Width Editable? Yes
						Height: 3.917"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: Default
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
					View: Table
					Allow Row Sizing? No
					Lines Per Row: Default
				Memory Settings
					Maximum Rows in Memory: Default
					Discardable? Yes
				Contents
					Column: colOTM
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Отм.
						Visible? Yes
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  0.533"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Check Box
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value: 1
								Uncheck Value: 0
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colSAB
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Код
						Visible? Yes
						Editable? No
						Maximum Data Length: 4
						Data Type: String
						Justify: Left
						Width:  0.6"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colNMK
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Наименование
						Visible? Yes
						Editable? No
						Maximum Data Length: 38
						Data Type: String
						Justify: Left
						Width:  4.55"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
				Functions
				Window Variables
				Message Actions
					On SAM_Create
						Call WaitCursorOn()
						Call SalTblPopulate(tbl1, hSql(), T("
								     SELECT '1',sab,nb
								     FROM banks
								     INTO :tbl1.colOTM,:tbl1.colSAB,:tbl1.colNMK
								     WHERE kodn=4 and blk<>2 and blk<>3 and blk<>9 and fmi='$A' and fmo='$B'
								     ORDER BY sab"), TBL_FillAll)
						Call WaitCursorOff()
			Custom Control: ccMeter
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cMeter
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   6.683"
						Top:    3.738"
						Width:  3.2"
						Width Editable? Class Default
						Height: 0.25"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Dark Gray
					Background Color: Light Gray
					DLL Settings
				Message Actions
		Functions
		Window Parameters
		Window Variables
			String: smWeek[7]
			String: smMonth[12]
			Date/Time: dDada
			Date/Time: dYes
			Date/Time: dSelect
			String: sDat
			Number: nI
			Number: nUid
			Number: nFetchRes
			Number: nKwo
			Boolean: bOk
			Boolean: bFL
			String: sBackDocPath
			String: sOdir
			String: sSAB
			String: sNLS
			String: sNLSK
			String: sNAMS
			String: sNMK
			String: sMFO
			Number: nMFO
			String: sND
			Number: nISP
			Number: nEL
			Number: nNM
			Number: nNP
			Number: nVOB
			Number: nDK
			Number: nS
			Date/Time: dDAOPL
			Number: nISM
			Date/Time: dDAPP
			String: sNAZ
			String: sPOND
			String: sFN_A
			String: sD_REC
			Number: nRNK
			String: sKOKK
			String: sTD
			Number: nISPZ
			Number: nREF
			String: sPOLU
			String: sFile
			String: sFile1
			String: sFile2
			File Handle: hSqlA
			File Handle: hF
			!
			Number: nRow
			!
			Number: nPos
			Number: nDelta
			!
			String: sRBSName
			!
			Number: nMinusA3
			!
			Number: nTimeVWV
			String: sTimeVWV
			!
			Date/Time: dDATP
			String: sTIMP
			Number: nAAMF
			String: sNAQH
			String: sNMS
			String: sKVAL
			String: sNVAL
			Number: nKVD
			Date/Time: dODATE
			Date/Time: dVDATE
			Date/Time: dDPOTK
			Date/Time: dDPOPK
			Number: nETALS
			Number: nKPOTK
			Number: nKPOPK
			Number: nDIGIT
			Number: nSISV
			Number: nSIS
			String: sISPK
			Number: nKVK
			Number: nND
			Number: nISV
			Number: nISR
			String: sNAZN
			Number: nISPK
		Message Actions
			On SAM_Create
				Call SalCenterWindow(hWndForm)
				Set nUid = GetUserId()
				Set nAAMF = Val(GetBankMfo())
				Set sNAQH = StrWinToDosX(GetBankName())
				Set dYes = GetBankDate()
				Set sFile1 = 'VWAB_V.Dbf'
				Set sFile2 = 'VWABSV.Dbf'
				Call SalWaitCursor(TRUE)
				Call SalHideWindow(ccMeter)
				Call SalUseRegistry(FALSE, '')
				Call SalGetProfileString('ElektroKlients', 'BackDocPath', GetPrnDir(), sBackDocPath,
						     GetIniFileName())
				Set sBackDocPath = IifS(Right(sBackDocPath, 1)='\\', sBackDocPath, sBackDocPath || '\\')
				Call cc1.ClearSpecials()
				Set mlText = 'Определение дат возможного выбора информации ...'
				Call SalSetFocus(cc1)
				Call GetMonthArrayRus(smMonth)
				Call GetWeekDayArray(smWeek)
				Call cc1.SetMonthText(smMonth)
				Call cc1.SetWeekDayText(smWeek)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call SqlPrepareAndExecute(hSql(), T("
						     SELECT fdat
						     INTO :dSelect
						     FROM fdat"))
				Set nI = 0
				While SqlFetchNext(hSql(), nFetchRes)
					Call cc1.SpecialDate(SPECIAL_OneTime, dSelect, DAY_Unset, SEQ_Unset, COLOR_Blue,
							     COLOR_Cyan, TRUE)
					Set nI = nI + 1
				If nI = 0
					Set mlText = 'Нет информации для отбора выписок.'
					Call SalHideWindow(cc1)
					Call SalHideWindow(pbRun)
					Call SalSetFocus(pbExit)
				Else
					Set mlText = ''
					Call cc1.SetFocusDate(dYes)
				Call SalWaitCursor(FALSE)
			On SAM_CreateComplete
				Call SalSetFocus(tbl1)
				Call SalTblSetFocusCell(tbl1, 0, tbl1.colOTM, 0, 1)
	Dialog Box: FormVWN
		Class:
		Property Template:
		Class DLL Name:
		Title: Формирование внебалансовых выписок эл.клиентам
		Accesories Enabled? Yes
		Visible? No
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Type of Dialog: Modal
			Window Location and Size
				Left:   2.713"
				Top:    0.979"
				Width:  10.05"
				Width Editable? Yes
				Height: 4.369"
				Height Editable? Yes
			Absolute Screen Location? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
		Description: Формирование файла выписок эл.клиентам (районы)
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Top
				Visible? No
				Size: Default
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
		Contents
			Multiline Field: mlText
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: 1024
					String Type: String
					Editable? No
				Display Settings
					Border? No
					Word Wrap? Yes
					Vertical Scroll? No
					Window Location and Size
						Left:   6.683"
						Top:    2.488"
						Width:  3.2"
						Width Editable? Yes
						Height: 1.25"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: 10
					Font Enhancement: Bold
					Text Color: Default
					Background Color: 3D Face Color
				Message Actions
			Pushbutton: pbRun
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Выполнить
				Window Location and Size
					Left:   6.683"
					Top:    2.071"
					Width:  1.5"
					Width Editable? Yes
					Height: 0.298"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: F5
				Font Name: Default
				Font Size: 10
				Font Enhancement: Bold
				Picture File Name:
				Picture Transparent Color: None
				Image Style: Single
				Text Color: Dark Green
				Background Color: Default
				Message Actions
					On SAM_Click
						Call SalWaitCursor(TRUE)
						Call SalTimerKill(hWndItem, 1)
						Call SalDisableWindow(tbl1)
						Set sFile = sBackDocPath || sFile1
						Set mlText = 'Отбор внебалансовых выписок за ' || Str(SalDateDay(dYes)) || ' ' ||
								    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) ||
								    ' г. ...'
						Call SqlPrepareAndExecute(hSql(), T("
								     DELETE
								     FROM tmp_sabn"))
						Set nRow = TBL_MinRow
						While SalTblFindNextRow(tbl1, nRow, 0, 0)
							Call SalTblSetContext(tbl1, nRow)
							If tbl1.colOTM = '1'
								Call SqlPrepareAndExecute(hSql(), T("
										     INSERT
										     INTO tmp_sabn (sab)
										     VALUES (:tbl1.colSAB)"))
						Set bOk = TRUE
						Set nKwo = 0
						Set sRBSName = GetGlobalOption('BIG_SEG')
						If sRBSName
							Call SqlCommit(hSql())
							Call SqlPrepareAndExecute(hSql(), 'SET TRANSACTION USE ROLLBACK SEGMENT ' ||
									     SalStrUpperX(sRBSName))
						! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
						! Call SalMessageBox('Begin exe p_lin','AT',0)
						! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
						If SqlPLSQLCommand(hSql(), "p_lin(nUid,dYes)")
							Call SqlCommit(hSql())
							Call SqlPrepareAndExecute(hSql(), T("
									     SELECT count(*)
									     FROM tmp_licn
									     INTO :nKwo
									     WHERE id=:nUid"))
							Call SqlFetchNext(hSql(), nFetchRes)
							Set bOk = nKwo>0
							! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
							! Call SalMessageBox('END execute p_lin','AT',0)
							! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
						Else
							Set bOk = FALSE
						If bOk
							Set nPos = 0
							Set nDelta = 100 / nKwo
							If File(sFile)
								Set nI = 0
								While not SalFileOpen(hF, sFile, OF_Delete)
									Set nI = nI + 1
									If nI > 5
										Set mlText = ''
										Call SalWaitCursor(FALSE)
										Call SalMessageBeep(-1)
										Call SalMessageBeep(-1)
										Call SalMessageBeep(-1)
										Call SalMessageBeep(-1)
										Call SalMessageBeep(-1)
										Call SalMessageBeep(-1)
										Call SalMessageBeep(-1)
										Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
												     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
										Call SalTimerSet(pbExit, 2, 1)
										Return 0
							Call SalFileGetCurrentDirectory(sOdir)
							Call SalFileSetCurrentDirectory(Left(sBackDocPath, Len(sBackDocPath)-1))
							Set SqlDatabase = 'dBase_Files'
							! родить VWABSN.Dbf
							! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
							! Call SalMessageBox('INCOME TO retrieve from tmp_licn','AT',0)
							! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
							If SqlConnect(hSqlA)
								Set bFL = SqlPrepareAndExecute(hSqlA, "
										    CREATE
										    TABLE " || sFile1 || " (SAB    CHAR(4),
										                            DATP   DATE,
										                            TIMP   CHAR(8),
										                            AAMF   NUMBER(9),
										                            NAQH   CHAR(38),
										                            RNK    NUMBER(6),
										                            NMK    CHAR(38),
										                            NMS    CHAR(38),
										                            KVAL   CHAR(3),
										                            NVAL   CHAR(15),
										                            NBS    CHAR(14),
										                            KV     NUMBER(3),
										                            ODATE  DATE,
										                            VDATE  DATE,
										                            ISP    NUMBER(3),
										                            DPOTK  DATE,
										                            DPOPK  DATE,
										                            ETALS  NUMBER(5),
										                            KPOTK  NUMBER(12,4),
										                            KPOPK  NUMBER(12,4),
										                            DIGIT  NUMBER(1),
										                            FIOI   CHAR(25),
										                            SISV   NUMBER(16),
										                            SIS    NUMBER(16),
										                            NBSK   CHAR(14),
										                            TP     CHAR(2),
										                            NP     NUMBER(3),
										                            ND     CHAR(10),
										                            SV     NUMBER(15),
										                            SR     NUMBER(16),
										                            NAZN   CHAR(100),
										                            DK     NUMBER(1),
										                            PP     NUMBER(1),
										                            VOB    NUMBER(2))") and SqlPrepareAndExecute(hSql(), "
										    SELECT sab,rnk,nmk,nms,kval,nval,nbs,kv,odate,vdate,isp,dpotk,dpopk,etals,
										           kpotk,kpopk,digit,fioi,sisv,sis,nbsk,tp,np,nd,sv,sr,nazn,dk,pp,vob
										    INTO :sSAB,:nRNK,:sNMK,:sNMS,:sKVAL,:sNVAL,:sNBS,:nKV,:dODATE,:dVDATE,:nISP,
										         :dDPOTK,:dDPOPK,:nETALS,:nKPOTK,:nKPOPK,:nDIGIT,:sFIOI,:nSISV,:nSIS,
										         :sNBSK,:sTP,:nNP,:sND,:nSV,:nSR,:sNAZN,:nDK,:nPP,:nVOB
										    FROM tmp_licn
										    WHERE id=:nUid")
								! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
								! Call SalMessageBox('EXIT FROM retrieve from tmp_licv','AT',0)
								! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
								If bFL
									! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
									! Call SalMessageBox('BEGIN INSERT odate','AT',0)
									! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
									Set bFL = SqlPrepareAndExecute(hSqlA, "
											    INSERT
											    INTO " || sFile1 || " (ODATE)
											    VALUES (:dYes)")
									! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
									! Call SalMessageBox('END INSERT odate','AT',0)
									! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
									If not bFL
										Call SqlRollback(hSqlA)
										Set mlText =
												    'Ошибка 0 (внесение служебной записи) отбора внебалансовых выписок за ' ||
												    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE)
												    || ' ' || Str(SalDateYear(dYes)) || ' г.'
									Else
										! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
										! Call SalMessageBox('BEGIN INSERT *.dbf','AT',0)
										! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
										Call SalShowWindow(cc1)
										While SqlFetchNext(hSql(), nFetchRes)
											Call ccMeter.SetProgress(nPos)
											Set dDATP = SalDateCurrent()
											Set sTIMP = Right('0' || SalFmtFormatDateTime(dDATP, 'hhhh:mm:ss'), 8)
											Set sNMK = StrWinToDosX(sNMK)
											Set sNMS = StrWinToDosX(sNMS)
											Set sKVAL = StrWinToDosX(sKVAL)
											Set sNVAL = StrWinToDosX(sNVAL)
											Set sFIOI = StrWinToDosX(sFIOI)
											Set nMFO = Val(sMFO)
											Set nND = Val('000' || Right(sND, 3))
											Set nISP = Mod(nISP, 1000)
											Set sISPK = Right('00' || Str(Mod(nISPK, 100)), 2)
											Set sNAZN = Left(StrWinToDosX(sNAZN), 100)
											Set bFL = SqlPrepareAndExecute(hSqlA, "
													    INSERT
													    INTO " || sFile1 || "
													    VALUES (:sSAB,:dDATP,:sTIMP,:nAAMF,:sNAQH,:nRNK,:sNMK,:sNMS,:sKVAL,
													            :sNVAL,:sNBS,:nKV,:dODATE,:dVDATE,:nISP,:dDPOTK,:dDPOPK,
													            :nETALS,:nKPOTK,:nKPOPK,:nDIGIT,:sFIOI,:nSISV,:nSIS,:sNBSK,
													            :sTP,:nNP,:sND,:nSV,:nSR,:sNAZN,:nDK,:nPP,:nVOB)")
											If not bFL
												Break
											Set nPos = nPos + nDelta
										! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
										! Call SalMessageBox('END INSERT *.dbf','AT',0)
										! !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
										If bFL
											Call SqlCommit(hSqlA)
											Call ccMeter.SetProgress(100)
											Set mlText = 'Выписки(Н) за ' || Str(SalDateDay(dYes)) || ' ' ||
													    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
													    SalDateYear(dYes)) || ' г. отобраны.'
										Else
											Call SqlRollback(hSqlA)
											Set mlText = 'Ошибка 2 (запись строки) отбора выписок(Н) за ' || Str(
													    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
													    ' ' || Str(SalDateYear(dYes)) || ' г.'
								Call SqlDisconnect(hSqlA)
								If bFL
									If File(sFile)
										Call SalFileCopy(sFile, sBackDocPath || sFile2, TRUE)
								Else
									If File(sFile)
										Call SalFileOpen(hF, sFile, OF_Delete)
							Call SalFileSetCurrentDirectory(sOdir)
						Else
							Set mlText = 'Ошибка 1 (нет информации) отбора выписок(Н) за ' || Str(
									    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' ||
									    Str(SalDateYear(dYes)) || ' г.'
						Call SalWaitCursor(FALSE)
						Call SalTimerSet(pbExit, 2, 7000)
			Pushbutton: pbExit
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Выход
				Window Location and Size
					Left:   8.383"
					Top:    2.071"
					Width:  1.5"
					Width Editable? Yes
					Height: 0.298"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: F10
				Font Name: Default
				Font Size: 10
				Font Enhancement: Bold
				Picture File Name:
				Picture Transparent Color: None
				Image Style: Single
				Text Color: Dark Blue
				Background Color: Default
				Message Actions
					On SAM_Click
						Call SalEndDialog(hWndForm, 0)
			Custom Control: cc1
.data CLASSPROPSSIZE
0000: 3600
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 6461720025000100 0000000100010000 0200000001000001
0020: 0101010000000A31 352F30362F313935 360000000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cCalendar
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   6.683"
						Top:    0.071"
						Width:  3.2"
						Width Editable? Class Default
						Height: 1.917"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Bold
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
					On SAM_CustControlCmd
						Call cc1.GetFocusDate(dDada)
						If cc1.IsSpecialDate(SPECIAL_OneTime, dDada, DAY_Unset, SEQ_Unset)
							Call cc1.SpecialDate(SPECIAL_OneTime, dYes, DAY_Unset, SEQ_Unset, COLOR_Blue,
									     COLOR_Cyan, TRUE)
							Set dYes = dDada
							Call cc1.SpecialDate(SPECIAL_OneTime, dYes, DAY_Unset, SEQ_Unset, COLOR_Blue,
									     COLOR_Yellow, TRUE)
					On SAM_Create
						Call cc1.WeekStartSet(2)
			Child Table: tbl1
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Display Settings
					Window Location and Size
						Left:   0.083"
						Top:    0.071"
						Width:  6.5"
						Width Editable? Yes
						Height: 3.917"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: Default
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
					View: Table
					Allow Row Sizing? No
					Lines Per Row: Default
				Memory Settings
					Maximum Rows in Memory: Default
					Discardable? Yes
				Contents
					Column: colOTM
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Отм.
						Visible? Yes
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  0.533"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Check Box
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value: 1
								Uncheck Value: 0
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colSAB
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Код
						Visible? Yes
						Editable? No
						Maximum Data Length: 4
						Data Type: String
						Justify: Left
						Width:  0.6"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colNMK
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Наименование
						Visible? Yes
						Editable? No
						Maximum Data Length: 38
						Data Type: String
						Justify: Left
						Width:  4.55"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
				Functions
				Window Variables
				Message Actions
					On SAM_Create
						Call WaitCursorOn()
						Call SalTblPopulate(tbl1, hSql(), T("
								     SELECT '1',sab,nb
								     FROM banks
								     INTO :tbl1.colOTM,:tbl1.colSAB,:tbl1.colNMK
								     WHERE kodn=4 and blk<>2 and blk<>3 and blk<>9 and fmi='$A' and fmo='$B'
								     ORDER BY sab"), TBL_FillAll)
						Call WaitCursorOff()
			Custom Control: ccMeter
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cMeter
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   6.683"
						Top:    3.738"
						Width:  3.2"
						Width Editable? Class Default
						Height: 0.25"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Dark Gray
					Background Color: Light Gray
					DLL Settings
				Message Actions
		Functions
		Window Parameters
		Window Variables
			String: smWeek[7]
			String: smMonth[12]
			Date/Time: dDada
			Date/Time: dYes
			Date/Time: dSelect
			String: sDat
			Number: nI
			Number: nUid
			Number: nFetchRes
			Number: nKwo
			Boolean: bOk
			Boolean: bFL
			String: sBackDocPath
			String: sOdir
			String: sSAB
			String: sNLS
			String: sNLSK
			String: sNAMS
			String: sNMK
			String: sMFO
			Number: nMFO
			String: sND
			Number: nISP
			Number: nEL
			Number: nNM
			Number: nNP
			Number: nVOB
			Number: nDK
			Number: nS
			Date/Time: dDAOPL
			Number: nISM
			Date/Time: dDAPP
			String: sNAZ
			String: sPOND
			String: sFN_A
			String: sD_REC
			Number: nRNK
			String: sKOKK
			String: sTD
			Number: nISPZ
			Number: nREF
			String: sPOLU
			String: sFile
			String: sFile1
			String: sFile2
			File Handle: hSqlA
			File Handle: hF
			!
			Number: nRow
			!
			Number: nPos
			Number: nDelta
			!
			String: sRBSName
			!
			Number: nMinusA3
			!
			Number: nTimeVWN
			String: sTimeVWN
			!
			Date/Time: dDATP
			String: sTIMP
			Number: nAAMF
			String: sNAQH
			String: sNMS
			String: sKVAL
			String: sNVAL
			Number: nKVD
			Date/Time: dODATE
			Date/Time: dVDATE
			Date/Time: dDPOTK
			Date/Time: dDPOPK
			Number: nETALS
			Number: nKPOTK
			Number: nKPOPK
			Number: nDIGIT
			Number: nSISV
			Number: nSIS
			String: sISPK
			Number: nKVK
			Number: nND
			Number: nISV
			Number: nISR
			String: sNAZN
			Number: nISPK
			! !
			Number: nPP
			Number: nSR
			Number: nSV
			String: sTP
			String: sNBSK
			String: sNBS
			String: sFIOI
			Number: nKV
		Message Actions
			On SAM_Create
				Call SalCenterWindow(hWndForm)
				Set nUid = GetUserId()
				Set nAAMF = Val(GetBankMfo())
				Set sNAQH = StrWinToDosX(GetBankName())
				Set dYes = GetBankDate()
				Set sFile1 = 'VWAB_N.Dbf'
				Set sFile2 = 'VWABSN.Dbf'
				Call SalWaitCursor(TRUE)
				Call SalHideWindow(ccMeter)
				Call SalUseRegistry(FALSE, '')
				Call SalGetProfileString('ElektroKlients', 'BackDocPath', GetPrnDir(), sBackDocPath,
						     GetIniFileName())
				Set sBackDocPath = IifS(Right(sBackDocPath, 1)='\\', sBackDocPath, sBackDocPath || '\\')
				Call cc1.ClearSpecials()
				Set mlText = 'Определение дат возможного выбора информации ...'
				Call SalSetFocus(cc1)
				Call GetMonthArrayRus(smMonth)
				Call GetWeekDayArray(smWeek)
				Call cc1.SetMonthText(smMonth)
				Call cc1.SetWeekDayText(smWeek)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call SqlPrepareAndExecute(hSql(), T("
						     SELECT fdat
						     INTO :dSelect
						     FROM fdat"))
				Set nI = 0
				While SqlFetchNext(hSql(), nFetchRes)
					Call cc1.SpecialDate(SPECIAL_OneTime, dSelect, DAY_Unset, SEQ_Unset, COLOR_Blue,
							     COLOR_Cyan, TRUE)
					Set nI = nI + 1
				If nI = 0
					Set mlText = 'Нет информации для отбора выписок.'
					Call SalHideWindow(cc1)
					Call SalHideWindow(pbRun)
					Call SalSetFocus(pbExit)
				Else
					Set mlText = ''
					Call cc1.SetFocusDate(dYes)
				Call SalWaitCursor(FALSE)
			On SAM_CreateComplete
				Call SalSetFocus(tbl1)
				Call SalTblSetFocusCell(tbl1, 0, tbl1.colOTM, 0, 1)
	Dialog Box: Form412
		Class:
		Property Template:
		Class DLL Name:
		Title: Формирование формы 412 (dbf)
		Accesories Enabled? Yes
		Visible? No
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Type of Dialog: Modal
			Window Location and Size
				Left:   3.938"
				Top:    1.729"
				Width:  9.35"
				Width Editable? Yes
				Height: 2.393"
				Height Editable? Yes
			Absolute Screen Location? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
		Description: Формирование формы 412 (dbf)
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Top
				Visible? No
				Size: Default
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
		Contents
			Multiline Field: mlText
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: 256
					String Type: String
					Editable? No
				Display Settings
					Border? No
					Word Wrap? Yes
					Vertical Scroll? No
					Window Location and Size
						Left:   4.883"
						Top:    0.655"
						Width:  4.3"
						Width Editable? Yes
						Height: 1.333"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: 10
					Font Enhancement: Bold
					Text Color: Default
					Background Color: 3D Face Color
				Message Actions
			Pushbutton: pbRun
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Выполнить
				Window Location and Size
					Left:   4.883"
					Top:    0.071"
					Width:  2.1"
					Width Editable? Yes
					Height: 0.5"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: F5
				Font Name: Default
				Font Size: 10
				Font Enhancement: Bold
				Picture File Name: \BARS98\RESOURCE\BMP\Apply.bmp
				Picture Transparent Color: Gray
				Image Style: Single
				Text Color: Yellow
				Background Color: 3D Face Color
				Message Actions
					On SAM_Click
						If SalMessageBox('Выполнять формирование 412 формы за ' ||
								   SalFmtFormatDateTime(dYes, 'dd-MM-yyyy') || ' ?', 'ВНИМАНИЕ !!!',
								   MB_YesNo | MB_IconQuestion) = IDNO
							Return 0
						Call SalWaitCursor(TRUE)
						Set mlText = 'Формирование 412 формы за ' || Str(SalDateDay(dYes)) || ' ' ||
								    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) ||
								    ' г. ...'
						Set sdat = SalFmtFormatDateTime(dYes, 'MM-dd-yyyy')
						Call SalFileGetCurrentDirectory(sOdir)
						Call SalFileSetCurrentDirectory(Left(sDbfPath, Len(sDbfPath)-1))
						If cbGB
							If cbObl
								Call Form412("
										     SELECT GR,S230,KEKD,Sum(YYYY),Sum(DD)
										     INTO :sGR,:sS230,:sKOD,:nT020,:nT060
										     FROM f412g
										     WHERE fdat=:sdat  and (DD<>0 or YYYY<>0)
										     GROUP BY GR,S230,KEKD
										     ORDER BY GR,S230,KEKD", '2', '0', '0', '0', 'T')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT GR,S230,KEKD,Sum(YYYY),Sum(DD)
										    INTO :sGR,:sS230,:sKOD,:nT020,:nT060
										    FROM f412g
										    WHERE fdat=:sdat  and (DD<>0 or YYYY<>0)
										    GROUP BY GR,S230,KEKD
										    ORDER BY GR,S230,KEKD"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-3) || '000')
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT020' || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
										                                                                                                                                                         Set sKO = Subs(GetGlobalOption('KOBL_412') || '   ', 1, 3)
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sKO,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-3) || '000')
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-3) || '000 за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос ) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
							If cbRaj
								! зведений по території (регіону)
								Call Form412("
										     SELECT t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										            Sum(p.DD)
										     INTO :nDPI,:sTer,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										     FROM f412g p, terrdpi t, ktk k
										     WHERE substr('0' || p.ktk,-8,4) || '0000'=substr('0' || t.ktk,-8,8) and
										           p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt
										     GROUP BY t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key
										     ORDER BY 1,2,3,4,5", '0', '0', '2', '0', 'T')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										           Sum(p.DD)
										    INTO :nDPI,:sTer,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										    FROM f412g p, terrdpi t, ktk k
										    WHERE substr('0' || p.ktk,-8,4) || '0000'=substr('0' || t.ktk,-8,8) and
										          p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt
										    GROUP BY t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key
										    ORDER BY 1,2,3,4,5"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										                                                                                                                                                         Set nNew = Val(sTer)
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '000' || MD(dYes) ||
														     '0.' || Left(Right(sFile, 10), 3))
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT' || sId_Key || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
										                                                                                                                                                         Set bEct=TRUE
										                                                                                                                                                         Set nNew = Val(sTer)
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sId_Key,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '000' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3))
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || '000' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3) || ' за ' || Str(SalDateDay(dYes)) ||
												     ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
												     SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! територіальний
								Call Form412("
										     SELECT t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										            Sum(p.DD)
										     INTO :nDPI,:sTer,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										     FROM f412g p, terrdpi t, ktk k
										     WHERE substr(p.ktk,-4,4)='0000' and
										           substr('0' || p.ktk,-8,4) || '0000'=substr('0' || t.ktk,-8,8) and
										           p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt
										     GROUP BY t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key
										     ORDER BY 1,2,3,4,5", '1', '0', '2', '0', 'T')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										           Sum(p.DD)
										    INTO :nDPI,:sTer,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										    FROM f412g p, terrdpi t, ktk k
										    WHERE substr(p.ktk,-4,4)='0000' and
										          substr('0' || p.ktk,-8,4) || '0000'=substr('0' || t.ktk,-8,8) and
										          p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt
										    GROUP BY t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key
										    ORDER BY 1,2,3,4,5"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										                                                                                                                                                         Set nNew = Val(sTer)
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
														     '0.' || Left(Right(sFile, 10), 3))
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT' || sId_Key || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
										                                                                                                                                                         Set bEct=TRUE
										                                                                                                                                                         Set nNew = Val(sTer)
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sId_Key,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3))
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3) || ' за ' || Str(SalDateDay(dYes)) ||
												     ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
												     SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
							If cbSeS
								! зведений по території (регіону)
								Call Form412("
										     SELECT (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk,
										            Sum(p.YYYY),Sum(p.DD)
										     INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nKtk,:nT020,:nT060
										     FROM f412g p, terrdpi t, ktk k
										     WHERE substr('0' || p.ktk,-8,6) || '00'=substr('0' || t.ktk,-8,8) and
										           p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt and
										           substr(p.ktk,-4,4)<>'0000'
										     GROUP BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk
										     ORDER BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk", '0',
										     '0', '4', '0', 'T')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk,
										           Sum(p.YYYY),Sum(p.DD)
										    INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nKtk,:nT020,:nT060
										    FROM f412g p, terrdpi t, ktk k
										    WHERE substr('0' || p.ktk,-8,6) || '00'=substr('0' || t.ktk,-8,8) and
										          p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt and
										          substr(p.ktk,-4,4)<>'0000'
										    GROUP BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk
										    ORDER BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										                                                                                                                                                         Set nNew = nDPI
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         If bYesSelo
													                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '000' || MD(dYes)
															     || '0.' || Left(Right(sFile, 10), 3))
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT' || sId_Key || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
												                                                                                                                                                         Set bYesSelo = FALSE
										                                                                                                                                                         Set nNew = nDPI
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bYesSelo = Mod(nKtk, 100)>0 or bYesSelo
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sId_Key,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         If bYesSelo
											                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '000' || MD(dYes) ||
													     '0.' || Left(Right(sFile, 10), 3))
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || '000' || MD(dYes) ||
												    '0.' || Left(Right(sFile, 10), 3) || ' за ' || Str(SalDateDay(dYes)) ||
												    ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
												    SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! територіальний
								Call Form412("
										     SELECT (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk,
										            Sum(p.YYYY),Sum(p.DD)
										     INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nKtk,:nT020,:nT060
										     FROM f412g p, terrdpi t, ktk k
										     WHERE substr(p.ktk,-2,2)='00' and substr(p.ktk,-4,4)<>'0000' and
										           substr('0' || p.ktk,-8,6) || '00'=substr('0' || t.ktk,-8,8) and
										           p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt
										     GROUP BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk
										     ORDER BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk", '1',
										     '0', '4', '0', 'T')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										           Sum(p.DD)
										    INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										    FROM f412g p, terrdpi t, ktk k
										    WHERE substr(p.ktk,-2,2)='00' and substr(p.ktk,-4,4)<>'0000' and
										          substr('0' || p.ktk,-8,6) || '00'=substr('0' || t.ktk,-8,8) and
										          p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt
										    GROUP BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key
										    ORDER BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										                                                                                                                                                         Set nNew = nDPI
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
														     '0.' || Left(Right(sFile, 10), 3))
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT' || sId_Key || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
										                                                                                                                                                         Set nNew = nDPI
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sId_Key,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3))
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
												    '0.' || Left(Right(sFile, 10), 3) || ' за ' || Str(SalDateDay(dYes)) ||
												    ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
												    SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
							If cbSel
								Call Form412("
										     SELECT t.ktk,p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),Sum(p.DD)
										     INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										     FROM f412g p, terrdpi t, ktk k
										     WHERE t.ktk=p.ktk and p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and
										           mod(t.ktk,100)>0 and t.ktk=k.idt
										     GROUP BY t.ktk,p.GR,p.S230,p.KEKD,k.id_key
										     ORDER BY t.ktk,p.GR,p.S230,p.KEKD,k.id_key", '1', '0', '6', '0', 'T')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT t.ktk,p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),Sum(p.DD)
										    INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										    FROM f412g p, terrdpi t, ktk k
										    WHERE t.ktk=p.ktk and p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and
										          mod(t.ktk,100)>0 and t.ktk=k.idt
										    GROUP BY t.ktk,p.GR,p.S230,p.KEKD,k.id_key
										    ORDER BY t.ktk,p.GR,p.S230,p.KEKD,k.id_key"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										                                                                                                                                                         Set nNew = nDPI
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
														     '0.' || Left(Right(sFile, 10), 3))
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT' || sId_Key || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
										                                                                                                                                                         Set nNew = nDPI
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sId_Key,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3))
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
												    '0.' || Left(Right(sFile, 10), 3) || ' за ' || Str(SalDateDay(dYes)) ||
												    ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
												    SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
							Set mlText = 'Отбор формы 412 по гос.бюджету за ' || Str(SalDateDay(dYes)) || ' ' ||
									    GetMonthNameRus(SalDateMonth(dYes),TRUE) || ' ' || Str(SalDateYear(dYes)) ||
									    ' г. завершен'
						If cbMB
							If cbObl
								Call Form412("
										     SELECT GR,S230,KEKD,Sum(YYYY),Sum(DD)
										     INTO :sGR,:sS230,:sKOD,:nT020,:nT060
										     FROM f412m
										     WHERE fdat=:sdat  and (DD<>0 or YYYY<>0)
										     GROUP BY GR,S230,KEKD
										     ORDER BY GR,S230,KEKD", '2', '1', '0', '0', 'T')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT GR,S230,KEKD,Sum(YYYY),Sum(DD)
										    INTO :sGR,:sS230,:sKOD,:nT020,:nT060
										    FROM f412m
										    WHERE fdat=:sdat  and (DD<>0 or YYYY<>0)
										    GROUP BY GR,S230,KEKD
										    ORDER BY GR,S230,KEKD"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-3) || '000')
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT120' || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
										                                                                                                                                                         Set sKO = Subs(GetGlobalOption('KOBL_412') || '   ', 1, 3)
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sKO,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-3) || '000')
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-3) || '000 за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос ) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
							If cbRaj
								! зведений по території (регіону)
								Call Form412("
										     SELECT t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										            Sum(p.DD)
										     INTO :nDPI,:sTer,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										     FROM f412m p, terrdpi t, ktk k
										     WHERE substr('0' || p.ktk,-8,4) || '0000'=substr('0' || t.ktk,-8,8) and
										           p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt
										     GROUP BY t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key
										     ORDER BY 1,2,3,4,5", '0', '1', '2', '0', 'T')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										           Sum(p.DD)
										    INTO :nDPI,:sTer,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										    FROM f412m p, terrdpi t, ktk k
										    WHERE substr('0' || p.ktk,-8,4) || '0000'=substr('0' || t.ktk,-8,8) and
										          p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt
										    GROUP BY t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key
										    ORDER BY 1,2,3,4,5"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										                                                                                                                                                         Set nNew = Val(sTer)
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '100' || MD(dYes) ||
														     '0.' || Left(Right(sFile, 10), 3))
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT' || sId_Key || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
										                                                                                                                                                         Set bEct=TRUE
										                                                                                                                                                         Set nNew = Val(sTer)
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sId_Key,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '100' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3))
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || '100' || MD(dYes) ||
												    '0.' || Left(Right(sFile, 10), 3) || ' за ' || Str(SalDateDay(dYes)) ||
												    ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
												    SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! територіальний
								Call Form412("
										     SELECT t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										            Sum(p.DD)
										     INTO :nDPI,:sTer,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										     FROM f412m p, terrdpi t, ktk k
										     WHERE substr(p.ktk,-4,4)='0000' and
										           substr('0' || p.ktk,-8,4) || '0000'=substr('0' || t.ktk,-8,8) and
										           p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt
										     GROUP BY t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key
										     ORDER BY 1,2,3,4,5", '1', '1', '2', '0', 'T')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										           Sum(p.DD)
										    INTO :nDPI,:sTer,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										    FROM f412m p, terrdpi t, ktk k
										    WHERE substr(p.ktk,-4,4)='0000' and
										          substr('0' || p.ktk,-8,4) || '0000'=substr('0' || t.ktk,-8,8) and
										          p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt
										    GROUP BY t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key
										    ORDER BY 1,2,3,4,5"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										                                                                                                                                                         Set nNew = Val(sTer)
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '110' || MD(dYes) ||
														     '0.' || Left(Right(sFile, 10), 3))
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT' || sId_Key || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
										                                                                                                                                                         Set bEct=TRUE
										                                                                                                                                                         Set nNew = Val(sTer)
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sId_Key,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '110' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3))
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || '110' || MD(dYes) ||
												    '0.' || Left(Right(sFile, 10), 3) || ' за ' || Str(SalDateDay(dYes)) ||
												    ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
												    SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
							If cbSeS
								! зведений по території (регіону)
								Call Form412("
										     SELECT (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk,
										            Sum(p.YYYY),Sum(p.DD)
										     INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nKtk,:nT020,:nT060
										     FROM f412m p, terrdpi t, ktk k
										     WHERE substr('0' || p.ktk,-8,6) || '00'=substr('0' || t.ktk,-8,8) and
										           p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt and
										           substr(p.ktk,-4,4)<>'0000'
										     GROUP BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk
										     ORDER BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk", '0',
										     '1', '4', '0', 'T')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk,
										           Sum(p.YYYY),Sum(p.DD)
										    INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nKtk,:nT020,:nT060
										    FROM f412m p, terrdpi t, ktk k
										    WHERE substr('0' || p.ktk,-8,6) || '00'=substr('0' || t.ktk,-8,8) and
										          p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt and
										          substr(p.ktk,-4,4)<>'0000'
										    GROUP BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk
										    ORDER BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										                                                                                                                                                         Set nNew = nDPI
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         If bYesSelo
													                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '100' || MD(dYes)
															     || '0.' || Left(Right(sFile, 10), 3))
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT' || sId_Key || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
												                                                                                                                                                         Set bYesSelo = FALSE
										                                                                                                                                                         Set nNew = nDPI
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bYesSelo = bYesSelo or Mod(nKtk, 100)>0
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sId_Key,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         If bYesSelo
											                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '100' || MD(dYes) ||
													     '0.' || Left(Right(sFile, 10), 3))
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || '100' || MD(dYes) ||
												    '0.' || Left(Right(sFile, 10), 3) || ' за ' || Str(SalDateDay(dYes)) ||
												    ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
												    SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! територіальний
								Call Form412("
										     SELECT (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										            Sum(p.DD)
										     INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										     FROM f412m p, terrdpi t, ktk k
										     WHERE substr(p.ktk,-2,2)='00' and substr(p.ktk,-4,4)<>'0000' and
										           substr('0' || p.ktk,-8,6) || '00'=substr('0' || t.ktk,-8,8) and
										           p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt
										     GROUP BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key
										     ORDER BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key", '1',
										     '1', '4', '0', 'T')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										           Sum(p.DD)
										    INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										    FROM f412m p, terrdpi t, ktk k
										    WHERE substr(p.ktk,-2,2)='00' and substr(p.ktk,-4,4)<>'0000' and
										          substr('0' || p.ktk,-8,6) || '00'=substr('0' || t.ktk,-8,8) and
										          p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt
										    GROUP BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key
										    ORDER BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										                                                                                                                                                         Set nNew = nDPI
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '110' || MD(dYes) ||
														     '0.' || Left(Right(sFile, 10), 3))
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT' || sId_Key || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
										                                                                                                                                                         Set nNew = nDPI
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sId_Key,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '110' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3))
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || '110' || MD(dYes) ||
												    '0.' || Left(Right(sFile, 10), 3) || ' за ' || Str(SalDateDay(dYes)) ||
												    ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
												    SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
							If cbSel
								Call Form412("
										     SELECT t.ktk,p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),Sum(p.DD)
										     INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										     FROM f412m p, terrdpi t, ktk k
										     WHERE t.ktk=p.ktk and p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and
										           mod(t.ktk,100)>0 and t.ktk=k.idt
										     GROUP BY t.ktk,p.GR,p.S230,p.KEKD,k.id_key
										     ORDER BY t.ktk,p.GR,p.S230,p.KEKD,k.id_key", '1', '1', '6', '0', 'T')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT t.ktk,p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),Sum(p.DD)
										    INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										    FROM f412m p, terrdpi t, ktk k
										    WHERE t.ktk=p.ktk and p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and
										          mod(t.ktk,100)>0 and t.ktk=k.idt
										    GROUP BY t.ktk,p.GR,p.S230,p.KEKD,k.id_key
										    ORDER BY t.ktk,p.GR,p.S230,p.KEKD,k.id_key"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										                                                                                                                                                         Set nNew = nDPI
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '110' || MD(dYes) ||
														     '0.' || Left(Right(sFile, 10), 3))
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT' || sId_Key || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
										                                                                                                                                                         Set nNew = nDPI
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sId_Key,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '110' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3))
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || '110' || MD(dYes) ||
												    '0.' || Left(Right(sFile, 10), 3) || ' за ' || Str(SalDateDay(dYes)) ||
												    ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
												    SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
							Set mlText = 'Отбор формы 412 по мест.бюджету за ' || Str(SalDateDay(dYes)) || ' '
									    || GetMonthNameRus(SalDateMonth(dYes),TRUE) || ' ' || Str(SalDateYear(dYes)) ||
									    ' г.  завершен'
						If cbMT      ! По митницях
							If cbObl
								Call Form412("
										     SELECT GR,S230,KEKD,Sum(YYYY),Sum(DD)
										     INTO :sGR,:sS230,:sKOD,:nT020,:nT060
										     FROM f412g
										     WHERE fdat=:sdat  and (DD<>0 or YYYY<>0) and GR IN (6,8)
										     GROUP BY GR,S230,KEKD
										     ORDER BY GR,S230,KEKD", '2', '0', '0', '0', 'M')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT GR,S230,KEKD,Sum(YYYY),Sum(DD)
										    INTO :sGR,:sS230,:sKOD,:nT020,:nT060
										    FROM f412g
										    WHERE fdat=:sdat  and (DD<>0 or YYYY<>0)
										    GROUP BY GR,S230,KEKD
										    ORDER BY GR,S230,KEKD"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-3) || '000')
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT020' || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
										                                                                                                                                                         Set sKO = Subs(GetGlobalOption('KOBL_412') || '   ', 1, 3)
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sKO,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-3) || '000')
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-3) || '000 за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос ) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
							If cbRaj
								! зведений по території (регіону)
								Call Form412("
										     SELECT t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										            Sum(p.DD)
										     INTO :nDPI,:sTer,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										     FROM f412g p, terrdpi t, ktk k
										     WHERE substr('0' || p.ktk,-8,4) || '0000'=substr('0' || t.ktk,-8,8) and
										           p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt and GR IN (6,8)
										     GROUP BY t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key
										     ORDER BY 1,2,3,4,5", '0', '0', '2', '0', 'M')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										           Sum(p.DD)
										    INTO :nDPI,:sTer,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										    FROM f412g p, terrdpi t, ktk k
										    WHERE substr('0' || p.ktk,-8,4) || '0000'=substr('0' || t.ktk,-8,8) and
										          p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt
										    GROUP BY t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key
										    ORDER BY 1,2,3,4,5"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										                                                                                                                                                         Set nNew = Val(sTer)
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '000' || MD(dYes) ||
														     '0.' || Left(Right(sFile, 10), 3))
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT' || sId_Key || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
										                                                                                                                                                         Set bEct=TRUE
										                                                                                                                                                         Set nNew = Val(sTer)
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sId_Key,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '000' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3))
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || '000' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3) || ' за ' || Str(SalDateDay(dYes)) ||
												     ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
												     SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! територіальний
								Call Form412("
										     SELECT t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										            Sum(p.DD)
										     INTO :nDPI,:sTer,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										     FROM f412g p, terrdpi t, ktk k
										     WHERE substr(p.ktk,-4,4)='0000' and
										           substr('0' || p.ktk,-8,4) || '0000'=substr('0' || t.ktk,-8,8) and
										           p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt and GR IN (6,8)
										     GROUP BY t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key
										     ORDER BY 1,2,3,4,5", '1', '0', '2', '0', 'M')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										           Sum(p.DD)
										    INTO :nDPI,:sTer,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										    FROM f412g p, terrdpi t, ktk k
										    WHERE substr(p.ktk,-4,4)='0000' and
										          substr('0' || p.ktk,-8,4) || '0000'=substr('0' || t.ktk,-8,8) and
										          p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt
										    GROUP BY t.KOD_DPI,substr(p.ktk,-6,2),p.GR,p.S230,p.KEKD,k.id_key
										    ORDER BY 1,2,3,4,5"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										                                                                                                                                                         Set nNew = Val(sTer)
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
														     '0.' || Left(Right(sFile, 10), 3))
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT' || sId_Key || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
										                                                                                                                                                         Set bEct=TRUE
										                                                                                                                                                         Set nNew = Val(sTer)
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sId_Key,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3))
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3) || ' за ' || Str(SalDateDay(dYes)) ||
												     ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
												     SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
							If cbSeS
								! зведений по території (регіону)
								Call Form412("
										     SELECT (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk,
										            Sum(p.YYYY),Sum(p.DD)
										     INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nKtk,:nT020,:nT060
										     FROM f412g p, terrdpi t, ktk k
										     WHERE substr('0' || p.ktk,-8,6) || '00'=substr('0' || t.ktk,-8,8) and
										           p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt and
										           substr(p.ktk,-4,4)<>'0000' and GR IN (6,8)
										     GROUP BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk
										     ORDER BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk", '0',
										     '0', '4', '0', 'M')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk,
										           Sum(p.YYYY),Sum(p.DD)
										    INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nKtk,:nT020,:nT060
										    FROM f412g p, terrdpi t, ktk k
										    WHERE substr('0' || p.ktk,-8,6) || '00'=substr('0' || t.ktk,-8,8) and
										          p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt and
										          substr(p.ktk,-4,4)<>'0000'
										    GROUP BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk
										    ORDER BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										                                                                                                                                                         Set nNew = nDPI
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         If bYesSelo
													                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '000' || MD(dYes)
															     || '0.' || Left(Right(sFile, 10), 3))
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT' || sId_Key || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
												                                                                                                                                                         Set bYesSelo = FALSE
										                                                                                                                                                         Set nNew = nDPI
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bYesSelo = Mod(nKtk, 100)>0 or bYesSelo
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sId_Key,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         If bYesSelo
											                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '000' || MD(dYes) ||
													     '0.' || Left(Right(sFile, 10), 3))
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || '000' || MD(dYes) ||
												    '0.' || Left(Right(sFile, 10), 3) || ' за ' || Str(SalDateDay(dYes)) ||
												    ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
												    SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! територіальний
								Call Form412("
										     SELECT (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk,
										            Sum(p.YYYY),Sum(p.DD)
										     INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nKtk,:nT020,:nT060
										     FROM f412g p, terrdpi t, ktk k
										     WHERE substr(p.ktk,-2,2)='00' and substr(p.ktk,-4,4)<>'0000' and
										           substr('0' || p.ktk,-8,6) || '00'=substr('0' || t.ktk,-8,8) and
										           p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt and GR IN (6,8)
										     GROUP BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk
										     ORDER BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,p.ktk", '1',
										     '0', '4', '0', 'M')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),
										           Sum(p.DD)
										    INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										    FROM f412g p, terrdpi t, ktk k
										    WHERE substr(p.ktk,-2,2)='00' and substr(p.ktk,-4,4)<>'0000' and
										          substr('0' || p.ktk,-8,6) || '00'=substr('0' || t.ktk,-8,8) and
										          p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and t.ktk=k.idt
										    GROUP BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key
										    ORDER BY (t.ktk-mod(t.ktk,100))/100,p.GR,p.S230,p.KEKD,k.id_key"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										                                                                                                                                                         Set nNew = nDPI
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
														     '0.' || Left(Right(sFile, 10), 3))
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT' || sId_Key || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
										                                                                                                                                                         Set nNew = nDPI
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sId_Key,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3))
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
												    '0.' || Left(Right(sFile, 10), 3) || ' за ' || Str(SalDateDay(dYes)) ||
												    ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
												    SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
							If cbSel
								Call Form412("
										     SELECT t.ktk,p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),Sum(p.DD)
										     INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										     FROM f412g p, terrdpi t, ktk k
										     WHERE t.ktk=p.ktk and p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and
										           mod(t.ktk,100)>0 and t.ktk=k.idt and GR IN (6,8)
										     GROUP BY t.ktk,p.GR,p.S230,p.KEKD,k.id_key
										     ORDER BY t.ktk,p.GR,p.S230,p.KEKD,k.id_key", '1', '0', '6', '0', 'M')
								! Set bFL = SqlPrepareAndExecute(hSql(), T("
										    SELECT t.ktk,p.GR,p.S230,p.KEKD,k.id_key,Sum(p.YYYY),Sum(p.DD)
										    INTO :nDPI,:sGR,:sS230,:sKOD,:sId_Key,:nT020,:nT060
										    FROM f412g p, terrdpi t, ktk k
										    WHERE t.ktk=p.ktk and p.fdat=:sdat  and (p.DD<>0 or p.YYYY<>0) and
										          mod(t.ktk,100)>0 and t.ktk=k.idt
										    GROUP BY t.ktk,p.GR,p.S230,p.KEKD,k.id_key
										    ORDER BY t.ktk,p.GR,p.S230,p.KEKD,k.id_key"))
								! If bFL
									                                                                                                                                                         Set bMakeFile = FALSE
									                                                                                                                                                         Set nNewTek = -2
									                                                                                                                                                         Set nNew = -1
									                                                                                                                                                         Set bFL = FALSE
									                                                                                                                                                         Set bEct = FALSE
									                                                                                                                                                         While SqlFetchNext(hSql(), nFetchRes)
										                                                                                                                                                         Set bEct = TRUE
										                                                                                                                                                         Set nNew = nDPI
										! смена файла
										                                                                                                                                                         If nNewTek != nNew
											                                                                                                                                                         If bMakeFile
												                                                                                                                                                         Call SqlCommit(hSqlA)
												! переименовать файл
												                                                                                                                                                         Call SqlDisconnect(hSqlA)
												                                                                                                                                                         Set bMakeFile = FALSE
												                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
														     '0.' || Left(Right(sFile, 10), 3))
												                                                                                                                                                         Call VisFileDelete(sFile)
											                                                                                                                                                         Set sFile1 = 'FT' || sId_Key || MD(dYes) || '0.dbf'
											                                                                                                                                                         Set sFile = sDbfPath || sFile1
											                                                                                                                                                         Set nNewTek = nNew
											! удалить файл
											                                                                                                                                                         Set bNoFile = TRUE
											                                                                                                                                                         If File(sFile)
												                                                                                                                                                         Set nI = 0
												                                                                                                                                                         While not SalFileOpen(hF, sFile, OF_Delete)
													                                                                                                                                                         Set nI = nI + 1
													                                                                                                                                                         If nI > 96
														                                                                                                                                                         Call SalWaitCursor(FALSE)
														                                                                                                                                                         Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
																     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
														                                                                                                                                                         Set mlText = ''
														                                                                                                                                                         Set bNoFile = FALSE
														                                                                                                                                                         Break
											! создать новый файл
											                                                                                                                                                         If not bNoFile ! остался файл
												                                                                                                                                                         Break
											                                                                                                                                                         Set SqlDatabase = 'dBase_Files'
											                                                                                                                                                         If SqlConnect(hSqlA)
												                                                                                                                                                         Call SqlPrepareAndExecute(hSqlA, "
														     CREATE
														     TABLE " || sFile1 || " (DT   DATE,
														                             KO   CHAR(3),
														                             GR   CHAR(1),
														                             S230 CHAR(3),
														                             KOD  CHAR(8),
														                             T060 NUMBER(16),
														                             T020 NUMBER(16))")
												                                                                                                                                                         Set bMakeFile = TRUE
										                                                                                                                                                         Set nNew = nDPI
										                                                                                                                                                         Set sKOD = Right('00000000' || sKOD, 8)
										                                                                                                                                                         Set bFL = SqlPrepareAndExecute(hSqlA, "
												    INSERT
												    INTO " || sFile1 || "
												    VALUES (:dYes,:sId_Key,:sGR,:sS230,:sKOD,:nT060,:nT020)")
										                                                                                                                                                         If not bFL
											                                                                                                                                                         Break
									                                                                                                                                                         If bEct
										                                                                                                                                                         Call SqlCommit(hSqlA)
										! переименовать последний файл
										                                                                                                                                                         Call SqlDisconnect(hSqlA)
										                                                                                                                                                         Set bMakeFile = FALSE
										                                                                                                                                                         Call VisFileCopy(sFile, Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
												     '0.' || Left(Right(sFile, 10), 3))
										                                                                                                                                                         Call VisFileDelete(sFile)
									                                                                                                                                                         If bFL
										                                                                                                                                                         Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || '010' || MD(dYes) ||
												    '0.' || Left(Right(sFile, 10), 3) || ' за ' || Str(SalDateDay(dYes)) ||
												    ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(
												    SalDateYear(dYes)) || ' г. создан.'
									                                                                                                                                                         Else
										                                                                                                                                                         Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
												    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
												    ' ' || Str(SalDateYear(dYes)) || ' г.'
								! Else
									                                                                                                                                                         Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' ||
											    Str(SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) ||
											    ' ' || Str(SalDateYear(dYes)) || ' г.'
							Set mlText = 'Отбор формы 412 по гос.бюджету за ' || Str(SalDateDay(dYes)) || ' ' ||
									    GetMonthNameRus(SalDateMonth(dYes),TRUE) || ' ' || Str(SalDateYear(dYes)) ||
									    ' г. завершен'
						Call SalFileSetCurrentDirectory(sOdir)
						Call SalWaitCursor(FALSE)
			Pushbutton: pbExit
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Выход
				Window Location and Size
					Left:   7.083"
					Top:    0.071"
					Width:  2.1"
					Width Editable? Yes
					Height: 0.5"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: F10
				Font Name: Default
				Font Size: 10
				Font Enhancement: Bold
				Picture File Name: \BARS98\RESOURCE\BMP\Discard.bmp
				Picture Transparent Color: Gray
				Image Style: Single
				Text Color: Dark Red
				Background Color: Default
				Message Actions
					On SAM_Click
						Call SalEndDialog(hWndForm, 0)
			Custom Control: cc1
.data CLASSPROPSSIZE
0000: 3600
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 6461720025000100 0000000100010000 0200000001000001
0020: 0101010000000A31 352F30362F313935 360000000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cCalendar
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   -0.017"
						Top:    0.071"
						Width:  2.8"
						Width Editable? Class Default
						Height: 1.917"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Bold
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
					On SAM_CustControlCmd
						Call cc1.GetFocusDate(dDada)
						If cc1.IsSpecialDate(SPECIAL_OneTime, dDada, DAY_Unset, SEQ_Unset)
							Call cc1.SpecialDate(SPECIAL_OneTime, dYes, DAY_Unset, SEQ_Unset,
									     COLOR_Blue, COLOR_Cyan, TRUE)
							Set dYes = dDada
							Call cc1.SpecialDate(SPECIAL_OneTime, dYes, DAY_Unset, SEQ_Unset,
									     COLOR_Blue, COLOR_Yellow, TRUE)
					On SAM_Create
						Call cc1.WeekStartSet(2)
			Check Box: cbObl
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Область
				Window Location and Size
					Left:   2.983"
					Top:    0.083"
					Width:  1.7"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Bold
				Text Color: Default
				Background Color: Default
				Message Actions
			Check Box: cbRaj
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Районы
				Window Location and Size
					Left:   2.983"
					Top:    0.333"
					Width:  1.7"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Bold
				Text Color: Default
				Background Color: Default
				Message Actions
			Check Box: cbSeS
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Сельсоветы
				Window Location and Size
					Left:   2.983"
					Top:    0.583"
					Width:  1.7"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Bold
				Text Color: Default
				Background Color: Default
				Message Actions
			Check Box: cbSel
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Села
				Window Location and Size
					Left:   2.983"
					Top:    0.833"
					Width:  1.7"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Bold
				Text Color: Default
				Background Color: Default
				Message Actions
			Check Box: cbGB
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Гос.бюджет
				Window Location and Size
					Left:   2.983"
					Top:    1.214"
					Width:  1.7"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Bold
				Text Color: Default
				Background Color: Default
				Message Actions
			Check Box: cbMB
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Мест.бюджет
				Window Location and Size
					Left:   2.983"
					Top:    1.464"
					Width:  1.7"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Bold
				Text Color: Default
				Background Color: Default
				Message Actions
			Check Box: cbMT
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Таможня
				Window Location and Size
					Left:   2.983"
					Top:    1.702"
					Width:  1.7"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Bold
				Text Color: Default
				Background Color: Default
				Message Actions
			Frame
				Resource Id: 22106
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Window Location and Size
					Left:   2.883"
					Top:    0.071"
					Width:  1.9"
					Width Editable? Yes
					Height: 1.06"
					Height Editable? Yes
				Visible? Yes
				Corners: Square
				Border Style: Solid
				Border Thickness: 1
				Border Color: Default
				Background Color: Default
			Frame
				Resource Id: 22107
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Window Location and Size
					Left:   2.883"
					Top:    1.167"
					Width:  1.9"
					Width Editable? Yes
					Height: 0.821"
					Height Editable? Yes
				Visible? Yes
				Corners: Square
				Border Style: Solid
				Border Thickness: 1
				Border Color: Default
				Background Color: Default
		Functions
			Function: MD
				Description: возвращает строку MD (месяц,день) в формате НБУ
				Returns
					String:
				Parameters
					Date/Time: dDATA
				Static Variables
				Local variables
					! Number: nMes
					! Number: nDay
				Actions
					! Set nMes = SalDateMonth(dDATA)
					! Set nDay = SalDateDay(dDATA)
					! Return Chr(IifS(nMes<10, 48, 55) + nMes) || Chr(IifS(nDay<10, 48, 55) + nDay)
					Return Chr(IifN(SalDateMonth(dDATA)<10, 48, 55) + SalDateMonth(dDATA)) ||
							       Chr(IifN(SalDateDay(dDATA)<10, 48, 55) + SalDateDay(dDATA))
			Function: Form412
				Description:
				Returns
					Boolean:
				Parameters
					String: sSql       ! строка SELECTа
					String: sOblTerSwo ! 0 - сводная по территории
							                   ! 1 - территориальная
							                   ! 2 - областная
					String: sGbMb      ! 0 - госбюджет
							                   ! 1 - местный бюджет
					String: s0246      ! 0 - область
							                   ! 2 - районы
							                   ! 4 - сельсоветы
							                   ! 6 - села
					String: sForPoint  ! символ перед . в имени файла (0)
					String: sFsuf      ! суффикс имени файла   T или  М
				Static Variables
				Local variables
				Actions
					Set bYesSelo = TRUE
					Set bFL = SqlPrepareAndExecute(hSql(), T(sSql))
					If bFL
						Set bMakeFile = FALSE
						Set nNewTek = -2
						Set nNew = -1
						Set bFL = FALSE
						Set bEct = FALSE
						While SqlFetchNext(hSql(), nFetchRes)
							Set bEct = TRUE
							If s0246 = '2'
								Set nNew = Val(sTer)
							Else If s0246 = '4' or s0246 = '6'
								Set nNew = nDPI
							! смена файла
							If nNewTek != nNew
								If bMakeFile
									Call SqlCommit(hSqlA)
									! переименовать файл
									Call SqlDisconnect(hSqlA)
									Set bMakeFile = FALSE
									If sOblTerSwo = '2'
										Call SalFileCopy(sFile, Left(sFile, Len(sFile)-3) || sArea || '00', TRUE)
									Else
										If (sOblTerSwo = '0' and s0246 = '4' and bYesSelo) or (sOblTerSwo = '0' and
												   s0246 != '4') or sOblTerSwo = '1'
											Call SalFileCopy(sFile, Left(sFile, Len(sFile)-10) || sGbMb || sOblTerSwo ||
													     '0' || MD(dYes) || sForPoint || '.' || Left(Right(sFile, 10), 3), TRUE)
									Call VisFileDelete(sFile)
								If sOblTerSwo = '2'
									Set sFile1 = 'F'|| sFsuf || sGbMb || '20' || MD(dYes) || sForPoint || '.dbf'
								Else
									Set sFile1 = 'F'|| sFsuf || sId_Key || MD(dYes) || sForPoint || '.dbf'
								Set sFile = sDbfPath || sFile1
								Set nNewTek = nNew
								! удалить файл
								Set bNoFile = TRUE
								If File(sFile)
									Set nI = 0
									While not SalFileOpen(hF, sFile, OF_Delete)
										Set nI = nI + 1
										If nI > 96
											Call SalWaitCursor(FALSE)
											Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
													     ', возможно он занят другим приложением.', 'ВНИМАНИЕ !!!', 0, 1)
											Set mlText = ''
											Set bNoFile = FALSE
											Break
								! создать новый файл
								If not bNoFile ! остался файл
									Break
								Set SqlDatabase = 'dBase_Files'
								If SqlConnect(hSqlA)
									Call SqlPrepareAndExecute(hSqlA, "
											     CREATE
											     TABLE " || sFile1 || " (DT   DATE,
											                             KO   CHAR(3),
											                             GR   CHAR(1),
											                             S230 CHAR(3),
											                             KOD  CHAR(8),
											                             T060 NUMBER(16),
											                             T020 NUMBER(16))")
									Set bMakeFile = TRUE
									If sOblTerSwo = '0' and s0246 = '4'
										Set bYesSelo = FALSE
							If s0246 = '2'
								Set nNew = Val(sTer)
							Else If s0246 = '4' or s0246 = '6'
								Set nNew = nDPI
							Set sKOD = Right('00000000' || sKOD, 8)
							If sOblTerSwo = '0' and s0246 = '4'
								Set bYesSelo = Mod(nKtk, 100)>0 or bYesSelo
							Set bFL = SqlPrepareAndExecute(hSqlA, "
									    INSERT
									    INTO " || sFile1 || "
									    VALUES (:dYes,:s" || IifS(sOblTerSwo='2', "KO", "Id_Key") || ",:sGR,:sS230,
									            :sKOD,:nT060,:nT020)")
							If not bFL
								Break
						If bEct
							Call SqlCommit(hSqlA)
							! переименовать последний файл
							Call SqlDisconnect(hSqlA)
							Set bMakeFile = FALSE
							If sOblTerSwo = '2'
								Call SalFileCopy(sFile, Left(sFile, Len(sFile)-3) || sArea || '00', TRUE)
							Else
								If (sOblTerSwo = '0' and s0246 = '4' and bYesSelo) or (sOblTerSwo = '0' and
										   s0246 != '4') or sOblTerSwo = '1'
									Call SalFileCopy(sFile, Left(sFile, Len(sFile)-10) || sGbMb || sOblTerSwo || '0'
											     || MD(dYes) || sForPoint || '.' || Left(Right(sFile, 10), 3), TRUE)
							Call VisFileDelete(sFile)
						If bFL
							If sOblTerSwo = '2'
								Set mlText = 'Файл ' || Left(sFile, Len(sFile)-3) || sArea || '00 за ' || Str(
										    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' '
										    || Str(SalDateYear(dYes)) || ' г. создан.'
							Else
								Set mlText = 'Файл ' || Left(sFile, Len(sFile)-10) || sGbMb || sOblTerSwo || '0'
										    || MD(dYes) || sForPoint || '.' || Left(Right(sFile, 10), 3) || ' за ' || Str(
										    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' '
										    || Str(SalDateYear(dYes)) || ' г. создан.'
							Return TRUE
						Else
							Set mlText = 'Ошибка 2 (нет информации) отбора 412 формы за ' || Str(
									    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' ||
									    Str(SalDateYear(dYes)) || ' г.'
							Return FALSE
					Else
						Set mlText = 'Ошибка 1 (невозможно выполнить запрос) отбора 412 формы за ' || Str(
								    SalDateDay(dYes)) || ' ' || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' ||
								    Str(SalDateYear(dYes)) || ' г.'
						Return FALSE
		Window Parameters
		Window Variables
			String: smWeek[7]
			String: smMonth[12]
			Date/Time: dDada
			Date/Time: dYes
			Date/Time: dSelect
			String: sdat
			String: sTer
			Number: nI
			Number: nUid
			Number: nFetchRes
			Number: nKwo
			Boolean: bOk
			Boolean: bFL
			String: sDbfPath
			String: sOdir
			String: sSAB
			String: sNLS
			String: sNLSK
			String: sNAMS
			String: sNMK
			String: sMFO
			Number: nMFO
			String: sND
			Number: nISP
			Number: nEL
			Number: nNM
			Number: nNP
			Number: nVOB
			Number: nDK
			Number: nS
			Date/Time: dDAOPL
			Number: nISM
			Date/Time: dDAPP
			String: sNAZ
			String: sPOND
			String: sFN_A
			String: sD_REC
			Number: nRNK
			String: sKOKK
			String: sTD
			Number: nISPZ
			Number: nREF
			String: sPOLU
			String: sFile
			String: sFile1
			File Handle: hSqlA
			File Handle: hF
			!
			String: sGR
			String: sS230
			String: sKOD
			Number: nT020
			Number: nT060
			Boolean: bMakeFile
			Number: nNewTek
			Number: nNew
			Boolean: bEct
			Number: nDPI
			Boolean: bNoFile
			String: sKO
			String: sArea
			!
			String: sId_Key
			!
			Number: nKtk
			Boolean: bYesSelo
		Message Actions
			On SAM_Create
				Call SalCenterWindow(hWndForm)
				Set cbObl = TRUE
				Set cbRaj = TRUE
				Set cbSeS = TRUE
				Set cbSel = TRUE
				Set cbGB = TRUE
				Set cbMB = TRUE
				Set cbMT = TRUE
				Set nUid = GetUserId()
				Set dYes = GetBankDate()
				Call SalWaitCursor(TRUE)
				Call SalUseRegistry(FALSE, '')
				Call SalGetProfileString('412', 'DbfPath', GetPrnDir(), sDbfPath, GetIniFileName())
				Set sDbfPath = sDbfPath || IifS(Right(sDbfPath, 1)='\\', '', '\\')
				Set sKO = Left(GetGlobalOption('KOBL_412') || '   ', 3)
				Set sArea = Left(GetGlobalOption('AREACODE') || '0', 1)
				Call cc1.ClearSpecials()
				Set mlText = 'Определение дат возможного выбора информации ...'
				Call SalSetFocus(cc1)
				Call GetMonthArrayRus(smMonth)
				Call GetWeekDayArray(smWeek)
				Call cc1.SetMonthText(smMonth)
				Call cc1.SetWeekDayText(smWeek)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call SqlPrepareAndExecute(hSql(), T("
						     SELECT fdat
						     INTO :dSelect
						     FROM fdat"))
				Set nI = 0
				While SqlFetchNext(hSql(), nFetchRes)
					Call cc1.SpecialDate(SPECIAL_OneTime, dSelect, DAY_Unset, SEQ_Unset, COLOR_Blue,
							     COLOR_Cyan, TRUE)
					Set nI = nI + 1
				If nI = 0
					Set mlText = 'Нет информации для отбора 412 формы.'
					Call SalHideWindow(cc1)
					Call SalHideWindow(pbRun)
					Call SalSetFocus(pbExit)
				Else
					Set mlText = ''
					Call cc1.SetFocusDate(dYes)
				Call SalWaitCursor(FALSE)
	Dialog Box: dlg_DirSelect
		Class:
		Property Template:
		Class DLL Name:
		Title: Директория отчета
		Accesories Enabled? No
		Visible? Yes
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Type of Dialog: System Modal
			Window Location and Size
				Left:   Default
				Top:    Default
				Width:  4.15"
				Width Editable? Yes
				Height: 3.488"
				Height Editable? Yes
			Absolute Screen Location? No
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
		Description:
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Top
				Visible? Yes
				Size: Default
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
		Contents
			Pushbutton: pbCancel
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cpbCancel
				Property Template:
				Class DLL Name:
				Title:
				Window Location and Size
					Left:   2.5"
					Top:    2.619"
					Width:  Class Default
					Width Editable? Class Default
					Height: Class Default
					Height Editable? Class Default
				Visible? Class Default
				Keyboard Accelerator: Class Default
				Font Name: Class Default
				Font Size: Class Default
				Font Enhancement: Class Default
				Picture File Name:
				Picture Transparent Color: Class Default
				Image Style: Class Default
				Text Color: Class Default
				Background Color: Class Default
				Message Actions
					On SAM_Click
						Call SalEndDialog(hWndForm, 0)
					On SAM_SetFocus
						Call SalStatusSetText(hWndForm, 'Завершить')
			Pushbutton: pbOk
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cpbOk
				Property Template:
				Class DLL Name:
				Title: Выбрать
				Window Location and Size
					Left:   0.6"
					Top:    2.619"
					Width:  Class Default
					Width Editable? Class Default
					Height: Class Default
					Height Editable? Class Default
				Visible? Class Default
				Keyboard Accelerator: Class Default
				Font Name: Class Default
				Font Size: Class Default
				Font Enhancement: Class Default
				Picture File Name:
				Picture Transparent Color: Class Default
				Image Style: Class Default
				Text Color: Class Default
				Background Color: Class Default
				Message Actions
					On SAM_Click
						Set strPrintPath = SalStrLeftX ( lbDir.GetSelectedDir()   ,  SalStrLength(lbDir.GetSelectedDir() ) - 1 )
						Set frm_Out.dfPath = SalStrUpperX( strPrintPath )
						Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
						Call SalEndDialog(hWndForm, 0)
			Combo Box: cmbDrive
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cDriveComboBox
				Property Template:
				Class DLL Name:
				Window Location and Size
					Left:   -0.017"
					Top:    2.107"
					Width:  4.1"
					Width Editable? Class Default
					Height: 0.881"
					Height Editable? Class Default
				Visible? Class Default
				Editable? Class Default
				String Type: Class Default
				Maximum Data Length: Class Default
				Sorted? Class Default
				Always Show List? Class Default
				Vertical Scroll? Class Default
				Font Name: Class Default
				Font Size: Class Default
				Font Enhancement: Class Default
				Text Color: Class Default
				Background Color: Class Default
				Input Mask: Class Default
				List Initialization
				Message Actions
					On SAM_Click
						Call lbDir.Populate (cmbDrive.GetSelectedDrive() )
			Frame
				Resource Id: 59084
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Window Location and Size
					Left:   -0.017"
					Top:    2.44"
					Width:  4.1"
					Width Editable? Yes
					Height: 0.75"
					Height Editable? Yes
				Visible? Yes
				Corners: Square
				Border Style: Etched
				Border Thickness: 1
				Border Color: Default
				Background Color: Default
			Frame
				Resource Id: 59085
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Window Location and Size
					Left:   -0.017"
					Top:    -0.012"
					Width:  4.1"
					Width Editable? Yes
					Height: 2.542"
					Height Editable? Yes
				Visible? Yes
				Corners: Square
				Border Style: Etched
				Border Thickness: 1
				Border Color: Default
				Background Color: Default
			List Box: lbDir
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cDirListBox
				Property Template:
				Class DLL Name:
				Window Location and Size
					Left:   -0.017"
					Top:    0.024"
					Width:  4.1"
					Width Editable? Class Default
					Height: 2.083"
					Height Editable? Class Default
				Visible? Class Default
				Multiple selection? Class Default
				Sorted? Class Default
				Vertical Scroll? Class Default
				Font Name: Class Default
				Font Size: Class Default
				Font Enhancement: Class Default
				Text Color: Class Default
				Background Color: Class Default
				Horizontal Scroll? Class Default
				List Initialization
				Message Actions
		Functions
		Window Parameters
		Window Variables
			String: strCurrDir
		Message Actions
			On SAM_Create
				Call SalFileGetCurrentDirectory( strCurrDir )
				Call SalFileSetCurrentDirectory( strPrintPath )
				Call SalCenterWindow( hWndForm )
				Call lbDir.Populate (strPrintPath)
			On SAM_Close
				Call SalFileSetCurrentDirectory( strCurrDir )
	Dialog Box: FormFZ
		Class:
		Property Template:
		Class DLL Name:
		Title: Формирование формы FZ (dbf)
		Accesories Enabled? Yes
		Visible? No
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Type of Dialog: Modal
			Window Location and Size
				Left:   2.425"
				Top:    0.99"
				Width:  8.15"
				Width Editable? Yes
				Height: 2.464"
				Height Editable? Yes
			Absolute Screen Location? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
		Description: Формирование формы FZ (dbf)
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Top
				Visible? No
				Size: Default
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
		Contents
			Multiline Field: mlText
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: 1024
					String Type: String
					Editable? No
				Display Settings
					Border? No
					Word Wrap? Yes
					Vertical Scroll? No
					Window Location and Size
						Left:   3.083"
						Top:    0.738"
						Width:  4.8"
						Width Editable? Yes
						Height: 1.167"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: 10
					Font Enhancement: Bold
					Text Color: Default
					Background Color: 3D Face Color
				Message Actions
			Pushbutton: pbRun
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Выполнить
				Window Location and Size
					Left:   4.283"
					Top:    0.071"
					Width:  1.6"
					Width Editable? Yes
					Height: 0.5"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: F5
				Font Name: Default
				Font Size: 10
				Font Enhancement: Bold
				Picture File Name: \BARS98\RESOURCE\BMP\Apply.bmp
				Picture Transparent Color: None
				Image Style: Single
				Text Color: Yellow
				Background Color: 3D Face Color
				Message Actions
					On SAM_Click
						If SalMessageBox('Выполнять формирование формы FZ за ' ||
								   SalFmtFormatDateTime(dYes, 'dd-MM-yyyy') || ' ?', 'ВНИМАНИЕ !!!',
								   MB_YesNo | MB_IconQuestion) = IDNO
							Return 0
						Call SalWaitCursor(TRUE)
						Set mlText = 'Формирование формы FZ за ' || PutCrLf() || Str(SalDateDay(dYes)) || ' '
								    || GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) ||
								    ' г. ...'
						Set sdat = SalFmtFormatDateTime(dYes, 'MM-dd-yyyy')
						Call SalFileGetCurrentDirectory(sOdir)
						Call SalFileSetCurrentDirectory(Left(sDbfPath, Len(sDbfPath)-1))
						Set sAMFO = GetBankMfo()
						Set sFdat = SalFmtFormatDateTime(dYes, 'MM/dd/yyyy')
						Call Podgot_LICS(nUid, sFdat, sFdat, '3%', 20)
						Set sSql = T("
								    SELECT nls,fdat,s/100,nd,nlsk,ref,nazn,mfo,vob,namk,nb
								    INTO :sNLS,:dDATP,:nS,:sND,:sNLSK,:nREF,:sNAZN,:sMFO,:nVOB,:sNAMK,:sNB
								    FROM tmp_lic
								    WHERE id=:nUid and (bis<2 or bis is null)" || sNlsLikeAll || "
								    ORDER BY substr(nls,1,4) || substr(nls,6,9),fdat,s/100,ref")
						Set bFL = SqlPrepareAndExecute(hSql(), sSql)
						If bFL
							Set bMakeFile = FALSE
							Set nNewTek = -2
							Set nNew = -1
							Set bFL = FALSE
							Set bEct = FALSE
							While SqlFetchNext(hSql(), nFetchRes)
								Set bEct = TRUE
								If nNewTek != nNew
									If bMakeFile
										Call SqlCommit(hSqlA)
										! переименовать файл
										Call SqlDisconnect(hSqlA)
									Set sFile1 = 'FZ' || Right('0' || Str(SalDateDay(dYes)), 2) || Right('0' || Str(
											    SalDateMonth(dYes)), 2) || '.dbf'
									Set sFile = sDbfPath || sFile1
									Set nNewTek = nNew
									! удалить файл
									Set bNoFile = TRUE
									If File(sFile)
										Set nI = 0
										While not SalFileOpen(hF, sFile, OF_Delete)
											Set nI = nI + 1
											If nI > 96
												Call SalWaitCursor(FALSE)
												Call MessageNoWait('Невозможно сформировать файл ' || sFile ||
														     ', возможно он занят другим ' || 'приложением.', 'ВНИМАНИЕ !!!', 0,
														     1)
												Set mlText = ''
												Set bNoFile = FALSE
												Break
									! создать файл
									If not bNoFile ! остался файл
										Break
									Set SqlDatabase = 'dBase_Files'
									If SqlConnect(hSqlA)
										Call SqlPrepareAndExecute(hSqlA, "
												     CREATE
												     TABLE " || sFile1 || " (Kb_a  NUMBER(9),
												                             Kk_a  CHAR(14),
												                             Kb_b  NUMBER(9),
												                             Kk_b  CHAR(14),
												                             D_k   NUMBER(1),
												                             Summa NUMBER(17,2),
												                             Vid   NUMBER(2),
												                             Nd    CHAR(10),
												                             Dat   DATE,
												                             Nk_a  CHAR(27),
												                             Nk_b  CHAR(27),
												                             Np    CHAR(160))")
										Set bMakeFile = TRUE
								Set sKO = 'Dbf'
								Set nMFO = Val(sMFO)
								Set nAMFO = Val(sAMFO)
								Set sND = StrWinToDosX(sND)
								Set sNAMK = StrWinToDosX(sNAMK)
								Set sNB = StrWinToDosX(sNB)
								Set sNAZN = StrWinToDosX(sNAZN)
								Set nDK = 1
								If nS < 0
									! Set sTemp = sNLS
									! Set sNLS = sNLSK
									! Set sNLSK = sTemp
									! Set nTemp = nMFO
									! Set nMFO = nAMFO
									! Set nAMFO = nTemp
									Set nS = 0 - nS
									Set nDK = 0
								Set bFL = SqlPrepareAndExecute(hSqlA, "
										    INSERT
										    INTO " || sFile1 || "
										    VALUES (:nMFO,:sNLSK,:nAMFO,:sNLS,:nDK,:nS,:nVOB,:sND,:dDATP,:sNAMK,:sNB,
										            :sNAZN)")
								If not bFL
									Break
							If bEct
								Call SqlCommit(hSqlA)
								! переименовать последний файл
								Call SqlDisconnect(hSqlA)
							If bFL
								Set mlText = 'Форма FZ за ' || PutCrLf() || Str(SalDateDay(dYes)) || ' ' ||
										    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) ||
										    ' г. отобрана.'
							Else
								Set mlText = 'Ошибка (2) отбора формы FZ за ' || Str(SalDateDay(dYes)) || ' ' ||
										    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) ||
										    ' г.'
						Else
							Set mlText = 'Ошибка (0) отбора формы FZ за ' || Str(SalDateDay(dYes)) || ' ' ||
									    GetMonthNameRus(SalDateMonth(dYes), TRUE) || ' ' || Str(SalDateYear(dYes)) ||
									    ' г.'
						Call SalFileSetCurrentDirectory(sOdir)
						Call SalWaitCursor(FALSE)
			Pushbutton: pbExit
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Выход
				Window Location and Size
					Left:   6.083"
					Top:    0.071"
					Width:  1.6"
					Width Editable? Yes
					Height: 0.5"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: F10
				Font Name: Default
				Font Size: 10
				Font Enhancement: Bold
				Picture File Name: \BARS98\RESOURCE\BMP\Discard.bmp
				Picture Transparent Color: None
				Image Style: Single
				Text Color: Dark Red
				Background Color: Default
				Message Actions
					On SAM_Click
						Call SalEndDialog(hWndForm, 0)
			Custom Control: cc1
.data CLASSPROPSSIZE
0000: 3600
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 6461720025000100 0000000100010000 0200000001000001
0020: 0101010000000A31 352F30362F313935 360000000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cCalendar
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   0.083"
						Top:    0.071"
						Width:  2.8"
						Width Editable? Class Default
						Height: 1.917"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Bold
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
					On SAM_CustControlCmd
						Call cc1.GetFocusDate(dDada)
						If cc1.IsSpecialDate(SPECIAL_OneTime, dDada, DAY_Unset, SEQ_Unset)
							Call cc1.SpecialDate(SPECIAL_OneTime, dYes, DAY_Unset, SEQ_Unset, COLOR_Blue,
									     COLOR_Cyan, TRUE)
							Set dYes = dDada
							Call cc1.SpecialDate(SPECIAL_OneTime, dYes, DAY_Unset, SEQ_Unset, COLOR_Blue,
									     COLOR_Yellow, TRUE)
					On SAM_Create
						Call cc1.WeekStartSet(2)
		Functions
		Window Parameters
		Window Variables
			String: smWeek[7]
			String: smMonth[12]
			Date/Time: dDada
			Date/Time: dYes
			Date/Time: dSelect
			String: sdat
			Number: nI
			Number: nUid
			Number: nFetchRes
			Number: nKwo
			Boolean: bOk
			Boolean: bFL
			String: sDbfPath
			String: sOdir
			String: sSAB
			String: sNLS
			String: sNLSK
			String: sNAMS
			String: sNMK
			String: sMFO
			Number: nMFO
			String: sND
			Number: nISP
			Number: nEL
			Number: nNM
			Number: nNP
			Number: nVOB
			Number: nDK
			Number: nS
			Date/Time: dDAOPL
			Number: nISM
			Date/Time: dDAPP
			String: sNAZ
			String: sPOND
			String: sFN_A
			String: sD_REC
			Number: nRNK
			String: sKOKK
			String: sTD
			Number: nISPZ
			Number: nREF
			String: sPOLU
			String: sFile
			String: sFile1
			File Handle: hSqlA
			File Handle: hF
			!
			String: sGR
			String: sS230
			String: sKOD
			Number: nT020
			Number: nT060
			Boolean: bMakeFile
			Number: nNewTek
			Number: nNew
			Boolean: bEct
			Number: nDPI
			Boolean: bNoFile
			String: sRaj
			String: sKO
			!
			Date/Time: dDATP
			String: sNAZN
			String: sNAMK
			String: sNB
			String: sAMFO
			String: sSql
			String: sFdat
			Number: nAMFO
			String: sTemp
			Number: nTemp
			!
			String: sNlsLike
			String: sNlsLikeAll
			String: smNlsLike[*]
			Number: nK
			Number: nZ
		Message Actions
			On SAM_Create
				Call SalCenterWindow(hWndForm)
				Set nUid = GetUserId()
				Set dYes = GetBankDate()
				Call SalWaitCursor(TRUE)
				Call SalUseRegistry(FALSE, '')
				Call SalGetProfileString('FZ', 'DbfPath', GetPrnDir(), sDbfPath, GetIniFileName())
				Set sDbfPath = sDbfPath || IifS(Right(sDbfPath, 1)='\\', '', '\\')
				Call SalGetProfileString('FZ', 'NlsLike', '', sNlsLike, GetIniFileName())
				Set nI = 0
				Set sTemp = sNlsLike
				Set sNlsLikeAll = ''
				If Len(sTemp) > 0
					Loop
						Set nZ = At(',', sTemp)
						If nZ > 0
							Set smNlsLike[nI] = Left(sTemp, nZ-1)
							Set nI = nI + 1
							Set sTemp = Right(sTemp, Len(sTemp)-nZ)
						Else
							Set smNlsLike[nI] = sTemp
							Set nI = nI + 1
							Break
					If nI > 0
						Set nK = 0
						While nK < nI
							Set sNlsLikeAll = sNlsLikeAll || "nls like '" || smNlsLike[nK] || "' or nlsk like '"
									    || smNlsLike[nK] || "' or "
							Set nK = nK + 1
						Set sNlsLikeAll = ' and (' || Left(sNlsLikeAll, Len(sNlsLikeAll)-4) || ')'
				Call cc1.ClearSpecials()
				Set mlText =
						    'Определение дат возможного выбора информации ...'
				Call SalSetFocus(cc1)
				Call GetMonthArrayRus(smMonth)
				Call GetWeekDayArray(smWeek)
				Call cc1.SetMonthText(smMonth)
				Call cc1.SetWeekDayText(smWeek)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black,
						     COLOR_Gray, TRUE)
				Call SqlPrepareAndExecute(hSql(), T("
						     SELECT fdat
						     INTO :dSelect
						     FROM fdat"))
				Set nI = 0
				While SqlFetchNext(hSql(), nFetchRes)
					Call cc1.SpecialDate(SPECIAL_OneTime, dSelect, DAY_Unset, SEQ_Unset, COLOR_Blue,
							     COLOR_Cyan, TRUE)
					Set nI = nI + 1
				If nI = 0
					Set mlText = 'Нет информации для отбора формы FZ.'
					Call SalHideWindow(cc1)
					Call SalHideWindow(pbRun)
					Call SalSetFocus(pbExit)
				Else
					Set mlText = ''
					Call cc1.SetFocusDate(dYes)
				Call SalWaitCursor(FALSE)
	Form Window: frm_Lables
		Class:
		Property Template:
		Class DLL Name:
		Title:
		Icon File:
		Accesories Enabled? No
		Visible? Yes
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Automatically Created at Runtime? No
			Initial State: Normal
			Maximizable? Yes
			Minimizable? Yes
			System Menu? Yes
			Resizable? Yes
			Window Location and Size
				Left:   Default
				Top:    Default
				Width:  4.7"
				Width Editable? Yes
				Height: 1.19"
				Height Editable? Yes
			Form Size
				Width:  Default
				Height: Default
				Number of Pages: Dynamic
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
		Description:
		Named Menus
		Menu
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Top
				Visible? Yes
				Size: Default
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
		Contents
			Data Field: dfFrom
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: Default
					Data Type: String
					Editable? No
				Display Settings
					Window Location and Size
						Left:   0.283"
						Top:    0.071"
						Width:  1.4"
						Width Editable? Yes
						Height: 0.167"
						Height Editable? Yes
					Visible? Yes
					Border? No
					Justify: Center
					Format: Unformatted
					Country: Default
					Font Name: Default
					Font Size: 10
					Font Enhancement: Default
					Text Color: Default
					Background Color: 3D Face Color
					Input Mask: Unformatted
				Message Actions
			Data Field: dfTo
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: Default
					Data Type: String
					Editable? No
				Display Settings
					Window Location and Size
						Left:   3.183"
						Top:    0.095"
						Width:  0.9"
						Width Editable? Yes
						Height: 0.31"
						Height Editable? Yes
					Visible? Yes
					Border? No
					Justify: Center
					Format: Unformatted
					Country: Default
					Font Name: Default
					Font Size: 10
					Font Enhancement: Default
					Text Color: Default
					Background Color: 3D Face Color
					Input Mask: Unformatted
				Message Actions
			Custom Control: cSpltMain
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cXSalVSplitterInvisible
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   0.186"
						Top:    0.073"
						Width:  4.1"
						Width Editable? Class Default
						Height: 1.0"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Yes
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
		Functions
		Window Parameters
		Window Variables
			Number: nWndX
			Number: nWndY
			Number: nWndH
			Number: nWndW
			Number: nWndX2
			Number: nWndY2
		Message Actions
			On SAM_Create
				Call cSpltMain.setLeftFrame( dfFrom)
				Call cSpltMain.setRightFrame( dfTo )
				Call cSpltMain.setStyle( XSalSplitter_NotResizable , TRUE )
				Set dfTo='По дату'
				Set dfFrom='C даты'
	Form Window: frm_RegPart
		Class:
		Property Template:
		Class DLL Name:
		Title:
		Icon File:
		Accesories Enabled? No
		Visible? Yes
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Automatically Created at Runtime? No
			Initial State: Normal
			Maximizable? Yes
			Minimizable? Yes
			System Menu? Yes
			Resizable? Yes
			Window Location and Size
				Left:   Default
				Top:    Default
				Width:  1.883"
				Width Editable? Yes
				Height: 0.333"
				Height Editable? Yes
			Form Size
				Width:  Default
				Height: Default
				Number of Pages: Dynamic
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
		Description: Составляющие региона
		Named Menus
		Menu
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Top
				Visible? Yes
				Size: Default
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
		Contents
			Custom Control: cSpltMain
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cXSalHSplitter
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   3.933"
						Top:    2.595"
						Width:  1.5"
						Width Editable? Class Default
						Height: 0.964"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Yes
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
			Child Table: tblRada !! Районные Казначейства
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Display Settings
					Window Location and Size
						Left:   0.133"
						Top:    0.119"
						Width:  0.01"
						Width Editable? Yes
						Height: 0.619"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: Default
					Font Enhancement: Bold
					Text Color: Dark Blue
					Background Color: Default
					View: Table
					Allow Row Sizing? No
					Lines Per Row: Default
				Memory Settings
					Maximum Rows in Memory: 3000
					Discardable? No
				Contents
					Column: Kod1
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Тер.
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  0.775"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colDPI
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Код
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: Number
						Justify: Right
						Width:  0.429"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: Name1
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Податкова інспекція
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  4.357"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: ktk_name
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Сільська рада
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  4.0"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colid_key
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colKtk
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colIsSvod
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colSab
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
				Functions
				Window Variables
				Message Actions
					On SAM_Create
						Call SalWaitCursor(TRUE)
						Call SalTblPopulate(tblRada, hSql(), "
								   SELECT substr(ktk, -6,4), substr(iif_n(TR.cou,1, '4', '1', '0'),1,1), 
								          d.id, d.name, id_key||' - '||k.name, id_key, k.sab
								   INTO  :Kod1, :colIsSvod , :colDPI,  :Name1,  :ktk_name,:colid_key, :colSab
								   FROM terrdpi t, dpa d,  ktk k,
								                 ( SELECT unique substr(ktk, -6,4) sr, count(*) cou
								                    FROM terrdpi, ktk WHERE idt=ktk
								                    GROUP BY  substr(ktk, -6,4)) TR
								  WHERE t.kod_dpi=d.id AND k.idt = t.ktk   AND   substr(ktk, -2,2)='00'
								                    AND TR.sr(+)=substr(ktk, -6,4)
								  ORDER BY substr(ktk, -6,4), d.id ", TBL_FillAll)
						! Call SalTblInsertRow ( hWndForm, 0 )
						! Call SalTblSetContext ( hWndForm, 0 )
						! Call SalTblSetRowFlags( hWndForm, 0 ,ROW_New, FALSE)
						! Set Kod1 = '*'
						! Set Name1 = '*********** ВСІ ***********'
						! Set ktk_name ='*********** ВСІ ***********'
						Call SalWaitCursor(FALSE)
					! On SAM_TblDoDetails
						! !=========================================================================
						! !== Населим села (если они есть ) в зависимости от выбранной сельской рады
						! !=========================================================================
						                                                                                                                                                        If (nLevel =3) and (SalStrLength(frm_DKU.tbl1.Kod1)!=8) and wParam=0
							                                                                                                                                                        Set sSql=
									" SELECT  UNIQUE substr(ktk, -6,6), d.id, d.name, k.id_key||' - '||k.name, k.id_key
									  INTO  :tblSelo.Kod1,  :tblSelo.colDPI,   :tblSelo.Name1, 
									        :tblSelo.ktk_name, :tblSelo.colid_key
									  FROM terrdpi t, dpa d,  ktk k, ktk k2
									  WHERE t.kod_dpi=d.id AND k.idt = t.ktk AND substr(ktk, -4,2)= substr(k2.idt, -4,2)
									         AND  substr(k2.idt, -6,2)=  substr(ktk, -6,2)
									       	 AND substr(k2.idt, -2,2)<>'00' AND substr(ktk, -6, 4) 
									         LIKE '"|| 
									IifS(tblRada.Kod1="*", IifS(frm_DKU.tbl1.Kod1="*","",frm_DKU.tbl1.Kod1)||"%",
									     tblRada.Kod1) || "'"
							! Call Debug(sSql)
							                                                                                                                                                        Call SalTblPopulate(tblSelo, hSql(), sSql, TBL_FillAll)
						! - -  выбрали несколько районов, в этом случае - показать все
			Child Table: tblSelo !! Районные Казначейства
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Display Settings
					Window Location and Size
						Left:   2.333"
						Top:    0.31"
						Width:  0.01"
						Width Editable? Yes
						Height: 0.01"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: Default
					Font Enhancement: Bold
					Text Color: Dark Blue
					Background Color: Default
					View: Table
					Allow Row Sizing? No
					Lines Per Row: Default
				Memory Settings
					Maximum Rows in Memory: 3000
					Discardable? No
				Contents
					Column: Kod1
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Тер.
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  0.775"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colDPI
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Код
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: Number
						Justify: Right
						Width:  0.429"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: Name1
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Податкова інспекція
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  4.357"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: ktk_name
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Cело
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  4.0"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colid_key
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colKtk
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colSab
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
				Functions
				Window Variables
				Message Actions
					On SAM_Create
						Call SalWaitCursor(TRUE)
						Call SalTblPopulate(tblSelo, hSql(), "
								 SELECT  UNIQUE substr(ktk, -6,6), d.id, d.name, k.id_key||' - '||k.name, k.id_key, k.sab
								 INTO  :Kod1,  :colDPI,   :tblSelo.Name1, :ktk_name, :colid_key, :colSab
								FROM terrdpi t, dpa d,  ktk k, ktk k2
								 WHERE t.kod_dpi=d.id AND k.idt = t.ktk AND
								       substr(ktk, -4,2)= substr(k2.idt, -4,2)
									  AND  substr(k2.idt, -6,2)=  substr(ktk, -6,2)
									  AND substr(k2.idt, -2,2)<>'00'
								 ORDER BY substr(ktk, -6,6), d.id   ", TBL_FillAll)
						Call SalWaitCursor(FALSE)
					On SAM_ColumnSelectClick
		Functions
		Window Parameters
		Window Variables
			Number: i
			String: sSql
		Message Actions
			On SAM_Create
				! Call cSpltMain.setStyle(  XSalSplitter_Frame2AbsSize, TRUE )
				Call cSpltMain.setBarSize(1)
				Call cSpltMain.setTopFrame( tblRada)
				Call cSpltMain.setBarPosition( 1000 )
				If nLevel =3
					! Call cSpltMainT.setBarSize(1)
					! Call cSpltMainT.setBarPosition( 500 )
					! Call cSpltMainT.setTopFrame(tblRada )
					! Call cSpltMainT.setBottomFrame(tblSelo)
					! Call cSpltMain.setTopFrame( cSpltMainT)
					Call cSpltMain.setBottomFrame(tblSelo)
					Call cSpltMain.setTopFrame( tblRada)
					Call cSpltMain.setBarPosition( 500 )
				! Call cSpltMain.setBottomFrame(SalCreateWindowEx( frm_buttons, hWndForm, 0,0,0,0, CREATE_AsChild ))
	Dialog Box: dlg_SobakiBe
		Class:
		Property Template:
		Class DLL Name:
		Title: Формирование @B
		Accesories Enabled? Yes
		Visible? Yes
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Type of Dialog: Modal
			Window Location and Size
				Left:   0.625"
				Top:    0.625"
				Width:  5.917"
				Width Editable? Yes
				Height: 2.571"
				Height Editable? Yes
			Absolute Screen Location? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
		Description: Формирование Собак БЕ
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Top
				Visible? No
				Size: Default
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
		Contents
			Pushbutton: pbRun
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Выполнить
				Window Location and Size
					Left:   3.283"
					Top:    0.238"
					Width:  2.1"
					Width Editable? Yes
					Height: 0.5"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: F5
				Font Name: Default
				Font Size: 10
				Font Enhancement: Bold
				Picture File Name: \BARS98\RESOURCE\BMP\Apply.bmp
				Picture Transparent Color: Gray
				Image Style: Single
				Text Color: Yellow
				Background Color: 3D Face Color
				Message Actions
					On SAM_Click
						If SalMessageBox('Выполнять формирование @E и @B за ' ||
								   SalFmtFormatDateTime(dYes, 'dd-MM-yyyy') || ' ?', 'ВНИМАНИЕ !!!',
								   MB_YesNo | MB_IconQuestion) = IDNO
							Return 0
						Call SalWaitCursor(TRUE)
						Call SalStatusSetVisible( hWndForm, TRUE )
						! Call Debug(sDbfPath||'@ET01'||MD(dYes)||'1.001')
						Call SobakiBe(sDbfPath||'@B201'||MD(dYes)||'1.001',dYes)  ! -- СДПІ+всі
						Call SobakiEe(sDbfPath,dYes)  ! -- СДПІ+всі+3719
						If GetGlobalOption('SDPI')
							Call SobakiBe(sDbfPath||'@B3'||GetGlobalOption('KOBL_412')||MD(dYes)||'1.001',dYes)  !--тільки СДПІ
							Call SobakiBe(sDbfPath||'@B3'||GetGlobalOption('KOBL_412')||MD(dYes)||'2.001',dYes)  !--без СДПІ
						Call SalWaitCursor(FALSE)
			Pushbutton: pbExit
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Выход
				Window Location and Size
					Left:   3.283"
					Top:    1.321"
					Width:  2.1"
					Width Editable? Yes
					Height: 0.5"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: F10
				Font Name: Default
				Font Size: 10
				Font Enhancement: Bold
				Picture File Name: \BARS98\RESOURCE\BMP\Discard.bmp
				Picture Transparent Color: Gray
				Image Style: Single
				Text Color: Dark Red
				Background Color: Default
				Message Actions
					On SAM_Click
						Call SalEndDialog(hWndForm, 0)
			Custom Control: cc1
.data CLASSPROPSSIZE
0000: 3600
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 6461720025000100 0000000100010000 0200000001000001
0020: 0101010000000A31 352F30362F313935 360000000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cCalendar
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   0.083"
						Top:    0.071"
						Width:  2.8"
						Width Editable? Class Default
						Height: 1.917"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Bold
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
					On SAM_CustControlCmd
						Call cc1.GetFocusDate(dDada)
						If cc1.IsSpecialDate(SPECIAL_OneTime, dDada, DAY_Unset, SEQ_Unset)
							Call cc1.SpecialDate(SPECIAL_OneTime, dYes, DAY_Unset, SEQ_Unset,
									     COLOR_Blue, COLOR_Cyan, TRUE)
							Set dYes = dDada
							Call cc1.SpecialDate(SPECIAL_OneTime, dYes, DAY_Unset, SEQ_Unset,
									     COLOR_Blue, COLOR_Yellow, TRUE)
					On SAM_Create
						Call cc1.WeekStartSet(2)
			Frame
				Resource Id: 42043
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Window Location and Size
					Left:   2.983"
					Top:    0.071"
					Width:  2.7"
					Width Editable? Yes
					Height: 1.917"
					Height Editable? Yes
				Visible? Yes
				Corners: Square
				Border Style: Solid
				Border Thickness: 1
				Border Color: Default
				Background Color: Default
		Functions
			Function: MD
				Description: возвращает строку MD (месяц,день) в формате НБУ
				Returns
					String:
				Parameters
					Date/Time: dDATA
				Static Variables
				Local variables
					! Number: nMes
					! Number: nDay
				Actions
					! Set nMes = SalDateMonth(dDATA)
					! Set nDay = SalDateDay(dDATA)
					! Return Chr(IifS(nMes<10, 48, 55) + nMes) || Chr(IifS(nDay<10, 48, 55) + nDay)
					Return Chr(IifN(SalDateMonth(dDATA)<10, 48, 55) + SalDateMonth(dDATA)) ||
							       Chr(IifN(SalDateDay(dDATA)<10, 48, 55) + SalDateDay(dDATA))
			! Function: SobakiBe
				               Description: Создать файл реестра документов для НИ без таблицы
				               Returns 
					               Boolean: 
				               Parameters 
					               String: strFileName
					               Date/Time: dDatSobak
				               Static Variables 
				               Local variables 
					! File Handle: hDelFile
					               Number: hFile
					               String: sDat1
					               Number: nRec
					               String: sId_key
					!
					               String: ID_KEY
					               String: MFOA
					               String: NLSA
					               String: MFOB
					               String: NLSB
					               Number: DK
					               Number: S
					               Number: VOB
					               String: ND
					               Number: KV
					               Date/Time: DATD
					               Date/Time: DATP
					               String: NAMA
					               String: NAMB
					               String: NAZN
					               String: DREC
					               String: NAZNK
					               String: NAZNS
					               String: OKPOA
					               String: OKPOB
					               String: REF_A
					               Date/Time: DAT_A
					               Date/Time: DAT_B
					               String: sSql
				               Actions 
					               Call SalWaitCursor( TRUE )
					               Set sDat1=SalFmtFormatDateTime(dDatSobak,'MM-dd-yyyy')
					               Set hFile = 0
					               Set nRec  = 0
					               Set sId_key  = 'XXX'
					               Set sSql=
							"SELECT /*+ INDEX(o XIE_FDAT_ACC_SOS_OPLDOK) INDEX(o1 XAK_REF_OPLDOK) INDEX(x) INDEX(a) INDEX(a1) INDEX(s) INDEX(k1) INDEX(k2) */ 
							        k2.id_key,
							        DECODE(o.tt,'R01',x.mfoa,x.tt,x.mfoa,"||GetBankMfo()||"),
							        DECODE(o.tt,'R01',x.nlsa,x.tt,x.nlsa,a1.nls),
							        DECODE(x.tt,o.tt,x.mfob,"||GetBankMfo()||"),
							        DECODE(x.tt,o.tt,x.nlsb,a.nls),o.dk,o.s,
							        DECODE(x.tt,o.tt,x.vob,6),x.nd,x.kv,x.datd, nvl(x.datp,x.datd),
							        DECODE(x.tt,o.tt,x.nam_a,DECODE(o.tt,'R01',x.nam_a,a1.nms)),
							        DECODE(x.tt,o.tt,x.nam_b,a.nms),
							        DECODE(o.tt,'R01',x.nazn,x.tt,x.nazn,o.txt),
							        DECODE(o.tt,'R01',x.d_rec,x.tt,x.d_rec,''),
							        x.id_a,x.id_b,x.ref,o.fdat,o.fdat
							   FROM oper x,opldok o,accounts a,specparam s,ktk k1,ktk k2,opldok o1,accounts a1
							  WHERE o.fdat=:dDatSobak AND s.ktk=k1.idt and k1.idtp=k2.idt AND
							        o.ref=o1.ref AND o1.dk=0 AND o.stmt=o1.stmt AND o1.acc=a1.acc AND
							        o.sos=5 AND  
							        o.ref=x.ref AND o.dk=1 AND o.acc=a.acc AND a.acc=s.acc AND 
							        a.nbs IN ('3111','3121','3113','3123','3141','3151','3161','3131','3311','3321','3411','3412','3421','3153','3717','3712','3422')
							UNION ALL
							SELECT  /*+ INDEX(o XIE_FDAT_ACC_SOS_OPLDOK) INDEX(o2 XAK_REF_OPLDOK) INDEX(x) INDEX(a) INDEX(a2) INDEX(s) INDEX(k1) INDEX(k2) */
							        k2.id_key,
							        DECODE(x.tt,o.tt,x.mfoa,"||GetBankMfo()||"),
							        DECODE(x.tt,o.tt,x.nlsa,a.nls),
							        DECODE(o.tt,'R00',x.mfob,x.tt,x.mfob,"||GetBankMfo()||"),
							        DECODE(o.tt,'R00',x.nlsb,x.tt,x.nlsb,a2.nls),o.dk,o.s,
							        DECODE(x.tt,o.tt,x.vob,6),x.nd,x.kv,x.datd, nvl(x.datp,x.datd),   
							        DECODE(x.tt,o.tt,x.nam_a,a.nms),
							        DECODE(x.tt,o.tt,x.nam_b,a2.nms),        
							        DECODE(o.tt,'R00',x.nazn,x.tt,x.nazn,o.txt),
							        DECODE(o.tt,'R00',x.d_rec,x.tt,x.d_rec,''),
							        x.id_a,
							        DECODE(o.tt,'R00',x.id_b,x.tt,x.id_b,x.id_a),
							        x.ref,o.fdat,to_date(NULL)
							   FROM oper x,opldok o,accounts a,specparam s,ktk k1,ktk k2,opldok o2,accounts a2
							  WHERE o.fdat=:dDatSobak AND s.ktk=k1.idt and k1.idtp=k2.idt AND
							        o.ref=o2.ref AND o2.dk=1 AND o.stmt=o2.stmt AND o2.acc=a2.acc AND
							        o.sos=5 AND 
							        o.ref=x.ref AND o.dk=0 AND o.acc=a.acc AND a.acc=s.acc AND 
							        a.nbs IN ('3111','3121','3113','3123','3141','3151','3161','3131','3311','3321','3411','3412','3421','3153','3717','3712','3422')
							  ORDER BY ID_KEY
							 INTO :ID_KEY,:MFOA,:NLSA,:MFOB,:NLSB,:DK,:S,:VOB,:ND,:KV,
							      :DATD,:DATP,:NAMA,:NAMB,:NAZN,:DREC,:OKPOA,:OKPOB,:REF_A,:DAT_A,:DAT_B "
					               Call SqlPrepareAndExecute(hSqlAux(),sSql)
					               While SqlFetchNext(hSqlAux(),nFetchRes)
						! Set KTK = Right('000'||SalStrTrimX( KTK ),3)
						               If sId_key != ID_KEY
							               If hFile>0
								               Call lllseek( hFile, 102+22, FILE_SeekBegin )
								               Call llwrite( hFile, PadL(Str(nRec),6), 6 )
								               Call llclose(hFile)
								! Пока без BACKUP
								! Call FunBackUpFile( strFileName, Rep_Backup, FALSE )
							               Set sId_key=ID_KEY
							               Set strFileName=SalStrLeftX(strFileName,SalStrLength(strFileName)-3)||sId_key
							               Call SalStatusSetText( hWndForm, strFileName )
							               Set hFile = llcreat(strFileName, 0)
							               Set nRec = 0
							               If hFile<=0
								               Call MessageInfoEx( 'Ошибка создания файла ' || strFileName )
								               Return FALSE
							! Служебная строка
							               Call llwrite( hFile,SalStrRepeatX( ' ', 100 )||PutCrLf(), 102)
							! Заголовок
							               Call llwrite(hFile, Right(strFileName,12) ||
									     SalFmtFormatDateTime(GetBankDate(), 'yyMMdd')   ||
									     Right('0'||SalFmtFormatDateTime(SalDateCurrent(),'hhhhmm'),4)||
									     PadL(Str(nRec),6) || SalStrRepeatX(' ', 166) || PutCrLf(), 196)
							               Call SalStatusSetText( hWndForm, strFileName)
						               Call llwrite(hFile,PadL(MFOA, 9)||PadL(NLSA,14)||PadL(MFOB, 9)||PadL(NLSB,14)||
								                 PadL(SalNumberToStrX(DK,0),1)||PadL(SalNumberToStrX(S,0),16)||
								                 PadL(SalNumberToStrX(VOB,0),2)||
								StrWinToDosX(PadR(ND,10)||PadL(SalNumberToStrX(KV,0),3 )||
								                  SalFmtFormatDateTime( DATD, 'yyMMdd' )||
								                  SalFmtFormatDateTime( DATP, 'yyMMdd' )||
								                  PadR(NAMA,38) || PadR(NAMB,38 ) ||
								                  PadR(NAZN,160)|| PadR(DREC,60)) ||
								PadR(' ',3) ||PadR(' ',2) ||
								PadL(OKPOA,14)||PadL(OKPOB,14)||
								PadL(REF_A,9) ||SalFmtFormatDateTime( DAT_A, 'yyMMdd' )||
								IifS(DAT_B=DATETIME_Null,PadR(' ',6),SalFmtFormatDateTime( DAT_B, 'yyMMdd' ))||  PutCrLf() ,442 )
						               Set nRec=nRec+1
					               If hFile>0
						               Call lllseek( hFile, 102+22, FILE_SeekBegin )
						               Call llwrite( hFile, PadL(Str(nRec),6), 6 )
						               Call llclose(hFile)
						! без BACKUP
						! Call FunBackUpFile( strFileName, Rep_Backup, FALSE )
						               Call SalStatusSetText( hWndForm, 'Готово.')
						! Call MessageInfoEx('Готово.')
					               Call SalWaitCursor( FALSE )
					               Return TRUE
			Function: SobakiBe
				Description: Создать файл реестра документов для НИ без таблицы
				Returns
					Boolean:
				Parameters
					String: strFileName
					Date/Time: dDatSobak
				Static Variables
				Local variables
					! File Handle: hDelFile
					Number: hFile
					String: sDat1
					Number: nRec
					String: sId_key
					!
					String: ID_KEY
					String: MFOA
					String: NLSA
					String: MFOB
					String: NLSB
					Number: DK
					Number: S
					Number: VOB
					String: ND
					Number: KV
					Date/Time: DATD
					Date/Time: DATP
					String: NAMA
					String: NAMB
					String: NAZN
					String: DREC
					String: NAZNK
					String: NAZNS
					String: OKPOA
					String: OKPOB
					String: REF_A
					Date/Time: DAT_A
					Date/Time: DAT_B
					String: sSql
					String: xDpi
					Boolean: bSDPI
				Actions
					Call SalWaitCursor( TRUE )
					! Встановити ознаку СДПІ
					Set bSDPI = SalStrScan(strFileName,'@B3')+1
					! Встановити ознаку тільки СДПІ - 1, без СДПІ - 2
					Set xDpi =SalStrMidX( SalStrRightX(strFileName,12),7,1)
					Set sDat1=SalFmtFormatDateTime(dDatSobak,'MM-dd-yyyy')
					Set hFile = 0
					Set nRec  = 0
					Set sId_key  = 'XXX'
					Set sSql=
							"SELECT /*+ INDEX(o XIE_FDAT_ACC_SOS_OPLDOK) INDEX(o1 XAK_REF_OPLDOK) INDEX(x) INDEX(a) INDEX(a1) INDEX(s) INDEX(k1) INDEX(k2) */
							        k2.id_key,
							        DECODE(o.tt,'R01',x.mfoa,x.tt,x.mfoa,"||GetBankMfo()||"),
							        DECODE(o.tt,'R01',x.nlsa,x.tt,x.nlsa,a1.nls),
							        DECODE(x.tt,o.tt,x.mfob,"||GetBankMfo()||"),
							        DECODE(x.nlsb,a.nls,x.nlsb,a.nls),o.dk,o.s,
							        DECODE(x.tt,o.tt,x.vob,6),x.nd,x.kv,x.datd, nvl(x.datp,x.datd),
							        DECODE(x.tt,o.tt,x.nam_a,DECODE(o.tt,'R01',x.nam_a,a1.nms)),
							        DECODE(x.tt,o.tt,x.nam_b,a.nms),
							        DECODE(o.tt,'R01',x.nazn,'901',x.nazn,x.tt,x.nazn,o.txt),
							        DECODE(o.tt,'R01',x.d_rec,'901',x.d_rec,x.tt,x.d_rec,''),
							        x.id_a,x.id_b,x.ref,o.fdat,o.fdat
							   FROM oper x,opldok o,accounts a,specparam s,ktk k1,ktk k2,opldok o1,accounts a1
							  WHERE o.fdat=:dDatSobak AND s.ktk=k1.idt and k1.idtp=k2.idt AND
							        o.ref=o1.ref AND o1.dk=0 AND o.stmt=o1.stmt AND o1.acc=a1.acc AND
							        o.sos=5 AND
							        o.ref=x.ref AND o.dk=1 AND o.acc=a.acc AND a.acc=s.acc AND
							        a.nbs IN ('3111','3121','3113','3123','3141','3151','3161','3131','3311','3321','3411','3412','3421','3153','3717','3712','3422')
							        "||IifS(bSDPI,
							           IifS(xDpi='1'," AND s.ktk LIKE '%99' ",
							                         " AND s.ktk NOT LIKE '%99' "),'')||"
							UNION ALL
							SELECT  /*+ INDEX(o XIE_FDAT_ACC_SOS_OPLDOK) INDEX(o2 XAK_REF_OPLDOK) INDEX(x) INDEX(a) INDEX(a2) INDEX(s) INDEX(k1) INDEX(k2) */
							        k2.id_key,
							        DECODE(x.tt,o.tt,x.mfoa,"||GetBankMfo()||"),
							        DECODE(x.tt,o.tt,x.nlsa,a.nls),
							        DECODE(o.tt,'R00',x.mfob,x.tt,x.mfob,"||GetBankMfo()||"),
							        DECODE(o.tt,'R00',x.nlsb,x.tt,x.nlsb,a2.nls),o.dk,o.s,
							        DECODE(x.tt,o.tt,x.vob,6),x.nd,x.kv,x.datd, nvl(x.datp,x.datd),
							        DECODE(x.tt,o.tt,x.nam_a,a.nms),
							        DECODE(x.tt,o.tt,x.nam_b,a2.nms),
							        DECODE(o.tt,'R00',x.nazn,x.tt,x.nazn,o.txt),
							        DECODE(o.tt,'R00',x.d_rec,x.tt,x.d_rec,''),
							        x.id_a,
							        DECODE(o.tt,'R00',x.id_b,x.tt,x.id_b,x.id_a),
							        x.ref,o.fdat,to_date(NULL)
							   FROM oper x,opldok o,accounts a,specparam s,ktk k1,ktk k2,opldok o2,accounts a2
							  WHERE o.fdat=:dDatSobak AND s.ktk=k1.idt and k1.idtp=k2.idt AND
							        o.ref=o2.ref AND o2.dk=1 AND o.stmt=o2.stmt AND o2.acc=a2.acc AND
							        o.sos=5 AND
							        o.ref=x.ref AND o.dk=0 AND o.acc=a.acc AND a.acc=s.acc AND
							        a.nbs IN ('3111','3121','3113','3123','3141','3151','3161','3131','3311','3321','3411','3412','3421','3153','3717','3712','3422')
							        "||IifS(bSDPI,
							           IifS(xDpi='1'," AND s.ktk LIKE '%99' ",
							                         " AND s.ktk NOT LIKE '%99' "),'')||"
							  ORDER BY ID_KEY
							 INTO :ID_KEY,:MFOA,:NLSA,:MFOB,:NLSB,:DK,:S,:VOB,:ND,:KV,
							      :DATD,:DATP,:NAMA,:NAMB,:NAZN,:DREC,:OKPOA,:OKPOB,:REF_A,:DAT_A,:DAT_B "
					Call SqlPrepareAndExecute(hSqlAux(),sSql)
					While SqlFetchNext(hSqlAux(),nFetchRes)
						! Set KTK = Right('000'||SalStrTrimX( KTK ),3)
						If sId_key != ID_KEY
							If hFile>0
								Call lllseek( hFile, 102+22, FILE_SeekBegin )
								Call llwrite( hFile, PadL(Str(nRec),6), 6 )
								Call llclose(hFile)
								! Пока без BACKUP
								! Call FunBackUpFile( strFileName, Rep_Backup, FALSE )
							Set sId_key=ID_KEY
							Set strFileName=SalStrLeftX(strFileName,SalStrLength(strFileName)-3)||sId_key
							Call SalStatusSetText( hWndForm, strFileName )
							Set hFile = llcreat(strFileName, 0)
							Set nRec = 0
							If hFile<=0
								Call MessageInfoEx( 'Ошибка создания файла ' || strFileName )
								Return FALSE
							! Служебная строка
							Call llwrite( hFile,SalStrRepeatX( ' ', 100 )||PutCrLf(), 102)
							! Заголовок
							Call llwrite(hFile, Right(strFileName,12) ||
									     SalFmtFormatDateTime(GetBankDate(), 'yyMMdd')   ||
									     Right('0'||SalFmtFormatDateTime(SalDateCurrent(),'hhhhmm'),4)||
									     PadL(Str(nRec),6) || SalStrRepeatX(' ', 166) || PutCrLf(), 196)
							Call SalStatusSetText( hWndForm, strFileName)
						Call llwrite(hFile,PadL(MFOA, 9)||PadL(NLSA,14)||PadL(MFOB, 9)||PadL(NLSB,14)||
								                 PadL(SalNumberToStrX(DK,0),1)||PadL(SalNumberToStrX(S,0),16)||
								                 PadL(SalNumberToStrX(VOB,0),2)||
								StrWinToDosX(PadR(ND,10)||PadL(SalNumberToStrX(KV,0),3 )||
								                  SalFmtFormatDateTime( DATD, 'yyMMdd' )||
								                  SalFmtFormatDateTime( DATP, 'yyMMdd' )||
								                  PadR(NAMA,38) || PadR(NAMB,38 ) ||
								                  PadR(NAZN,160)|| PadR(DREC,60)) ||
								PadR(' ',3) ||PadR(' ',2) ||
								PadL(OKPOA,14)||PadL(OKPOB,14)||
								PadL(REF_A,9) ||SalFmtFormatDateTime( DAT_A, 'yyMMdd' )||
								IifS(DAT_B=DATETIME_Null,PadR(' ',6),SalFmtFormatDateTime( DAT_B, 'yyMMdd' ))||  PutCrLf() ,442 )
						Set nRec=nRec+1
					If hFile>0
						Call lllseek( hFile, 102+22, FILE_SeekBegin )
						Call llwrite( hFile, PadL(Str(nRec),6), 6 )
						Call llclose(hFile)
						! без BACKUP
						! Call FunBackUpFile( strFileName, Rep_Backup, FALSE )
						Call SalStatusSetText( hWndForm, 'Готово.')
						! Call MessageInfoEx('Готово.')
					Call SalWaitCursor( FALSE )
					Return TRUE
			Function: SobakiEe
				Description: Создать файл реестра документов для НИ без таблицы
				Returns
					Boolean:
				Parameters
					String: strPath
					Date/Time: dDatSobak
				Static Variables
				Local variables
					! File Handle: hDelFile
					String: strFileName
					Number: hFile
					String: sDat1
					Number: nRec
					String: sId_key
					!
					String: ID_KEY
					Number: ID
					String: MFOA
					String: NLSA
					String: MFOB
					String: NLSB
					Number: DK
					Number: S
					Number: VOB
					String: ND
					Number: KV
					Date/Time: DATD
					Date/Time: DATP
					String: NAMA
					String: NAMB
					String: NAZN
					String: DREC
					String: NAZNK
					String: NAZNS
					String: OKPOA
					String: OKPOB
					String: REF_A
					Date/Time: DAT_A
					Date/Time: DAT_B
					String: sSql
					String: xDpi
					Boolean: bSDPI
				Actions
					Call SalWaitCursor( TRUE )
					! Встановити ознаку СДПІ
					! Call Debug(strFileName )
					! Set bSDPI = SalStrScan(strFileName,'@B3')+1
					! Встановити ознаку тільки СДПІ - 1, без СДПІ - 2
					! Set xDpi =SalStrMidX( SalStrRightX(strFileName,12),7,1)
					Set sDat1=SalFmtFormatDateTime(dDatSobak,'MM-dd-yyyy')
					Set hFile = 0
					Set nRec  = 0
					Set sId_key  = 'XXX'
					Set sSql=
							"SELECT /*+ INDEX(o XIE_FDAT_ACC_SOS_OPLDOK) INDEX(o1 XAK_REF_OPLDOK) INDEX(x) INDEX(a) INDEX(a1)  */
							        dpi_key(SUBSTR(DECODE(x.tt,o.tt,x.nlsb,a.nls),-4)),
							        DECODE(o.tt,'R01',x.mfoa,x.tt,x.mfoa,"||GetBankMfo()||"),
							        DECODE(o.tt,'R01',x.nlsa,x.tt,x.nlsa,a1.nls),
							        DECODE(x.tt,o.tt,x.mfob,"||GetBankMfo()||"),
							        DECODE(x.nlsb,a.nls,x.nlsb,a.nls),o.dk,o.s,
							        DECODE(x.tt,o.tt,x.vob,6),x.nd,x.kv,x.datd, nvl(x.datp,x.datd),
							        DECODE(x.tt,o.tt,x.nam_a,DECODE(o.tt,'R01',x.nam_a,'XXX',x.nam_a,a1.nms)),
							        DECODE(x.tt,o.tt,x.nam_b,a.nms),
							        DECODE(o.tt,'R01',x.nazn,'901',x.nazn,'XXX',x.nazn,x.tt,x.nazn,o.txt),
							        DECODE(o.tt,'R01',x.d_rec,'901',x.d_rec,'XXX',x.d_rec,x.tt,x.d_rec,''),
							        x.id_a,x.id_b,x.ref,o.fdat,o.fdat
							   FROM oper x,opldok o,accounts a,opldok o1,accounts a1
							  WHERE o.fdat=:dDatSobak AND 
							        o.ref=o1.ref AND o1.dk=0 AND o.stmt=o1.stmt AND o1.acc=a1.acc AND
							        o.sos=5 AND
							        o.ref=x.ref AND o.dk=1 AND o.acc=a.acc AND a.nls LIKE '3719_2%'  and  a.tip='ODB'            
							UNION ALL
							SELECT  /*+ INDEX(o XIE_FDAT_ACC_SOS_OPLDOK) INDEX(o2 XAK_REF_OPLDOK) INDEX(x) INDEX(a) INDEX(a2)  */
							        dpi_key(SUBSTR( DECODE(x.tt,o.tt,x.nlsa,a.nls),-4)),
							        DECODE(x.tt,o.tt,x.mfoa,"||GetBankMfo()||"),
							        DECODE(x.tt,o.tt,x.nlsa,a.nls),
							        DECODE(o.tt,'R00',x.mfob,x.tt,x.mfob,"||GetBankMfo()||"),
							        DECODE(o.tt,'R00',x.nlsb,x.tt,x.nlsb,a2.nls),o.dk,o.s,
							        DECODE(x.tt,o.tt,x.vob,6),x.nd,x.kv,x.datd, nvl(x.datp,x.datd),
							        DECODE(x.tt,o.tt,x.nam_a,a.nms),
							        DECODE(x.tt,o.tt,x.nam_b,a2.nms),
							        DECODE(o.tt,'R00',x.nazn,x.tt,x.nazn,o.txt),
							        DECODE(o.tt,'R00',x.d_rec,x.tt,x.d_rec,''),
							        x.id_a,
							        DECODE(o.tt,'R00',x.id_b,x.tt,x.id_b,x.id_a),
							        x.ref,o.fdat,to_date(NULL)
							   FROM oper x,opldok o,accounts a,opldok o2,accounts a2
							  WHERE o.fdat=:dDatSobak AND 
							        o.ref=o2.ref AND o2.dk=1 AND o.stmt=o2.stmt AND o2.acc=a2.acc AND
							        o.sos=5 AND
							        o.ref=x.ref AND o.dk=0 AND o.acc=a.acc AND a.nls LIKE '3719_2%' and  a.tip='ODB'              
							  ORDER BY 1
							 INTO :ID,:MFOA,:NLSA,:MFOB,:NLSB,:DK,:S,:VOB,:ND,:KV,
							      :DATD,:DATP,:NAMA,:NAMB,:NAZN,:DREC,:OKPOA,:OKPOB,:REF_A,:DAT_A,:DAT_B "
					Call SqlPrepareAndExecute(hSqlAux(),sSql)
					While SqlFetchNext(hSqlAux(),nFetchRes)
						! Set KTK = Right('000'||SalStrTrimX( KTK ),3)
						Set ID_KEY=SalStrRightX('0000'||Str(ID),3)
						If sId_key != ID_KEY
							If hFile>0
								Call lllseek( hFile, 102+22, FILE_SeekBegin )
								Call llwrite( hFile, PadL(Str(nRec),6), 6 )
								Call llclose(hFile)
								! Пока без BACKUP
								! Call FunBackUpFile( strFileName, Rep_Backup, FALSE )
							Set sId_key=ID_KEY
							If ID_KEY='999'
								Set strFileName='@E3'||GetGlobalOption('KOBL_412')||MD(dYes)||'1.001'
							Else
								Set strFileName='@E1'||MD(dYes)||'1.'||sId_key
							Call SalStatusSetText( hWndForm, strPath||strFileName )
							! Call Debug(strFileName )
							Set hFile = llcreat(strPath||strFileName, 0)
							Set nRec = 0
							If hFile<=0
								Call MessageInfoEx( 'Ошибка создания файла ' || strFileName )
								Return FALSE
							! Служебная строка
							Call llwrite( hFile,SalStrRepeatX( ' ', 100 )||PutCrLf(), 102)
							! Заголовок
							Call llwrite(hFile, Left(strFileName||'  ',12) ||
									     SalFmtFormatDateTime(GetBankDate(), 'yyMMdd')   ||
									     Right('0'||SalFmtFormatDateTime(SalDateCurrent(),'hhhhmm'),4)||
									     PadL(Str(nRec),6) || SalStrRepeatX(' ', 166) || PutCrLf(), 196)
							Call SalStatusSetText( hWndForm, strFileName)
						Call llwrite(hFile,PadL(MFOA, 9)||PadL(NLSA,14)||PadL(MFOB, 9)||PadL(NLSB,14)||
								                 PadL(SalNumberToStrX(DK,0),1)||PadL(SalNumberToStrX(S,0),16)||
								                 PadL(SalNumberToStrX(VOB,0),2)||
								StrWinToDosX(PadR(ND,10)||PadL(SalNumberToStrX(KV,0),3 )||
								                  SalFmtFormatDateTime( DATD, 'yyMMdd' )||
								                  SalFmtFormatDateTime( DATP, 'yyMMdd' )||
								                  PadR(NAMA,38) || PadR(NAMB,38 ) ||
								                  PadR(NAZN,160)|| PadR(DREC,60)) ||
								PadR(' ',3) ||PadR(' ',2) ||
								PadL(OKPOA,14)||PadL(OKPOB,14)||
								PadL(REF_A,9) ||SalFmtFormatDateTime( DAT_A, 'yyMMdd' )||
								IifS(DAT_B=DATETIME_Null,PadR(' ',6),SalFmtFormatDateTime( DAT_B, 'yyMMdd' ))||  PutCrLf() ,442 )
						Set nRec=nRec+1
					If hFile>0
						Call lllseek( hFile, 102+22, FILE_SeekBegin )
						Call llwrite( hFile, PadL(Str(nRec),6), 6 )
						Call llclose(hFile)
						! без BACKUP
						! Call FunBackUpFile( strFileName, Rep_Backup, FALSE )
						Call SalStatusSetText( hWndForm, 'Готово.')
						! Call MessageInfoEx('Готово.')
					Call SalWaitCursor( FALSE )
					Return TRUE
		Window Parameters
		Window Variables
			String: smWeek[7]
			String: smMonth[12]
			Date/Time: dYes
			Date/Time: dSelect
			Date/Time: dDada
			String: sDbfPath
			Number: nI
		Message Actions
			On SAM_Create
				Call SalCenterWindow(hWndForm)
				Set dYes = GetBankDate()
				Call SalWaitCursor(TRUE)
				Call SalUseRegistry(FALSE, '')
				Call SalGetProfileString('@B', 'OutPath', GetPrnDir(), sDbfPath,  GetIniFileName())
				Set sDbfPath = sDbfPath || IifS(Right(sDbfPath, 1)='\\', '', '\\')
				Call cc1.ClearSpecials()
				! Set mlText = 'Определение дат возможного выбора информации ...'
				Call SalSetFocus(cc1)
				Call GetMonthArrayRus(smMonth)
				Call GetWeekDayArray(smWeek)
				Call cc1.SetMonthText(smMonth)
				Call cc1.SetWeekDayText(smWeek)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
				Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
				Call SqlPrepareAndExecute(hSql(), T(" SELECT fdat INTO :dSelect FROM fdat"))
				Set nI = 0
				While SqlFetchNext(hSql(), nFetchRes)
					Call cc1.SpecialDate(SPECIAL_OneTime, dSelect, DAY_Unset, SEQ_Unset, COLOR_Blue, COLOR_Cyan, TRUE)
					Set nI = nI + 1
				If nI = 0
					Call SalStatusSetText( hWndForm, 'Нет информации' )
					Call SalHideWindow(cc1)
					Call SalHideWindow(pbRun)
					Call SalSetFocus(pbExit)
				Else
					Call cc1.SetFocusDate(dYes)
				Call SalWaitCursor(FALSE)
	! Dialog Box: dlg_KtkMask
.winattr
		Class:
		Property Template:
		Class DLL Name:
		Title: Выбор маски территории
		Accesories Enabled? No
		Visible? Yes
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Type of Dialog: Modal
			Window Location and Size
				Left:   Default
				Top:    Default
				Width:  4.583"
				Width Editable? Yes
				Height: 2.036"
				Height Editable? Yes
			Absolute Screen Location? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
.end
		                                                                                                                                                        Description: 
		                                                                                                                                                        Tool Bar 
			                                                                                                                                                        Contents 
		                                                                                                                                                        Contents 
			                                                                                                                                                        Pushbutton: pbCancel
				                                                                                                                                                        Message Actions 
					                                                                                                                                                        On SAM_Click
						                                                                                                                                                        Call SalEndDialog(hWndForm, 0)
					                                                                                                                                                        On SAM_SetFocus
						                                                                                                                                                        Call SalStatusSetText(hWndForm, 'Завершить')
			                                                                                                                                                        Pushbutton: pbOk
				                                                                                                                                                        Message Actions 
					                                                                                                                                                        On SAM_Click
						                                                                                                                                                        Call frm_DKU.pbMaskClick(nPar1, dlg_KtkMask.dfKtkMask)
						                                                                                                                                                        Call SalEndDialog(hWndForm, 0)
			                                                                                                                                                        Frame 
			                                                                                                                                                        Line 
			                                                                                                                                                        Data Field: dfKtkMask
				                                                                                                                                                        Message Actions 
		                                                                                                                                                        Functions 
		                                                                                                                                                        Window Parameters 
		                                                                                                                                                        Window Variables 
		                                                                                                                                                        Message Actions 
	Table Window: tbl_RepGroups
		Class: cGenericTable
		Property Template:
		Class DLL Name:
		Title: Редактирование групп отчетов
		Icon File:
		Accesories Enabled? Class Default
		Visible? Class Default
		Display Settings
			Visible at Design time? Yes
			Automatically Created at Runtime? Class Default
			Initial State: Class Default
			Maximizable? Class Default
			Minimizable? Class Default
			System Menu? Class Default
			Resizable? Class Default
			Window Location and Size
				Left:   Default
				Top:    Default
				Width:  16.183"
				Width Editable? Class Default
				Height: 6.071"
				Height Editable? Class Default
			Font Name: Class Default
			Font Size: Class Default
			Font Enhancement: Class Default
			Text Color: Class Default
			Background Color: Class Default
			View: Class Default
			Allow Row Sizing? Class Default
			Lines Per Row: Class Default
		Memory Settings
			Maximum Rows in Memory: 100000
			Discardable? Class Default
		Description:
		Named Menus
		Menu
		Tool Bar
			Display Settings
				Display Style? Class Default
				Location? Class Default
				Visible? Class Default
				Size: 0.44"
				Size Editable? Class Default
				Font Name: Class Default
				Font Size: Class Default
				Font Enhancement: Class Default
				Text Color: Class Default
				Background Color: Class Default
			Contents
				Pushbutton: pbIns
					Class Child Ref Key: 33
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						! On SAM_Click
							! Call InsertData(nChooseState)
				Pushbutton: pbDel
					Class Child Ref Key: 34
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbRefresh
					Class Child Ref Key: 35
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbUpdate
					Class Child Ref Key: 36
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 37407
					Class Child Ref Key: 37
					Class ChildKey: 0
					Class: cGenericTable
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? Class Default
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Pushbutton: pbSearch
					Class Child Ref Key: 38
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbFilter
					Class Child Ref Key: 44
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							If SetQueryFilter( cF )
								Set sFltrWhere=''
								Set sFltrFrom=''
								If cF.GetFilterWhereClause( FALSE )
									Set sFltrWhere = ' AND '|| cF.GetFilterWhereClause( FALSE )
								If cF.GetFilterFromClause( FALSE )
									Set sFltrFrom = ', '|| cF.GetFilterFromClause( FALSE )
							Call SalSendMsg(hWndForm,UM_Populate,0,0)
				Pushbutton: pbDetails
					Class Child Ref Key: 39
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbPrint
					Class Child Ref Key: 40
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 37408
					Class Child Ref Key: 41
					Class ChildKey: 0
					Class: cGenericTable
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? Class Default
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Pushbutton: pbExit
					Class Child Ref Key: 42
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 37409
					Class Child Ref Key: 43
					Class ChildKey: 0
					Class: cGenericTable
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? Class Default
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Option Button: obWholeInfo
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class:
					Property Template:
					Class DLL Name:
					Title: Маски счетов
					Window Location and Size
						Left:   4.683"
						Top:    0.071"
						Width:  1.8"
						Width Editable? Yes
						Height: 0.333"
						Height Editable? Yes
					Visible? Yes
					Font Name: Arial
					Font Size: 8
					Font Enhancement: None
					Picture File Name:
					Picture Transparent Color: None
					Button Style: Radio
					Image Style: Single
					Text Color: Default
					Background Color: Default
					Message Actions
						On SAM_Click
							Call SalHideWindow(tbl_RepGroups.otchgrp)
							Call SalHideWindow(tbl_RepGroups.otchgrp_name)
							Call SalHideWindow(tbl_RepGroups.accgrp_dir)
							Call SalShowWindow(tbl_RepGroups.accgrp)
							Call SalShowWindow(tbl_RepGroups.accgrp_name)
							Call SalShowWindow(tbl_RepGroups.accgrp_filemask)
							Call SalShowWindow(tbl_RepGroups.nlsmask)
							!
							Call SalTblSetColumnFlags ( tbl_RepGroups.accgrp_filemask, COL_Editable, FALSE)
							Call SalTblSetColumnFlags ( tbl_RepGroups.accgrp_name, COL_Editable, FALSE)
							Call SalTblSetColumnFlags ( tbl_RepGroups.accgrp_dir, COL_Editable, FALSE)
							!
							Call cF.Init('REP_ACC', 'acc')
							Set tbl_RepGroups.strPrintFileName ='otch_mask.txt'
							Set sFltrWhere=''
							Set sFltrFrom=''
							Set nChooseState=1
							Set tbl_RepGroups.strSqlPopulate=strSqlPopulateSql[nChooseState-1]
							Call RefreshData(nChooseState)
				Option Button: obAccGroups
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class:
					Property Template:
					Class DLL Name:
					Title: Группы счетов
					Window Location and Size
						Left:   6.483"
						Top:    0.071"
						Width:  1.8"
						Width Editable? Yes
						Height: 0.333"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: Default
					Font Enhancement: Default
					Picture File Name:
					Picture Transparent Color: None
					Button Style: Radio
					Image Style: Single
					Text Color: Default
					Background Color: Default
					Message Actions
						On SAM_Click
							Call SalShowWindow(tbl_RepGroups.otchgrp)
							Call SalDisableWindow(tbl_RepGroups.otchgrp)
							Call SalShowWindow(tbl_RepGroups.otchgrp_name)
							Call SalShowWindow(tbl_RepGroups.accgrp)
							Call SalShowWindow(tbl_RepGroups.accgrp_name)
							Call SalShowWindow(tbl_RepGroups.accgrp_filemask)
							Call SalShowWindow(tbl_RepGroups.accgrp_dir)
							Call SalHideWindow(tbl_RepGroups.nlsmask)
							!
							Call SalTblSetColumnFlags ( tbl_RepGroups.accgrp_filemask, COL_Editable, TRUE)
							Call SalTblSetColumnFlags ( tbl_RepGroups.accgrp_name, COL_Editable,TRUE)
							Call SalTblSetColumnFlags ( tbl_RepGroups.accgrp_dir, COL_Editable, TRUE)
							!
							Call SalTblSetColumnFlags ( tbl_RepGroups.otchgrp, COL_Editable, FALSE)
							Call SalTblSetColumnFlags ( tbl_RepGroups.otchgrp_name, COL_Editable, FALSE)
							!
							Call cF.Init('rep_accg_otchg', 't')
							Set tbl_RepGroups.strPrintFileName='otch_accgrp.txt'
							Set sFltrWhere=''
							Set sFltrFrom=''
							Set nChooseState=2
							Set tbl_RepGroups.strSqlPopulate=strSqlPopulateSql[nChooseState-1]
							Call RefreshData(nChooseState)
				Option Button: obOtchGroups
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class:
					Property Template:
					Class DLL Name:
					Title: Отчетн. группы
					Window Location and Size
						Left:   8.283"
						Top:    0.071"
						Width:  1.8"
						Width Editable? Yes
						Height: 0.333"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: Default
					Font Enhancement: Default
					Picture File Name:
					Picture Transparent Color: None
					Button Style: Radio
					Image Style: Single
					Text Color: Default
					Background Color: Default
					Message Actions
						On SAM_Click
							Call SalShowWindow(tbl_RepGroups.otchgrp)
							Call SalDisableWindow(tbl_RepGroups.otchgrp)
							Call SalShowWindow(tbl_RepGroups.otchgrp_name)
							Call SalHideWindow(tbl_RepGroups.accgrp)
							Call SalHideWindow(tbl_RepGroups.accgrp_name)
							Call SalHideWindow(tbl_RepGroups.accgrp_filemask)
							Call SalHideWindow(tbl_RepGroups.nlsmask)
							Call SalHideWindow(tbl_RepGroups.accgrp_dir)
							Call SalTblSetColumnFlags ( tbl_RepGroups.otchgrp, COL_Editable, TRUE)
							Call SalTblSetColumnFlags ( tbl_RepGroups.otchgrp_name, COL_Editable, TRUE)
							!
							Call cF.Init('rep_otchgrp', 't')
							Set tbl_RepGroups.strPrintFileName='otch_otchgrp.txt'
							Set sFltrWhere=''
							Set sFltrFrom=''
							Set nChooseState=3
							Set tbl_RepGroups.strSqlPopulate=strSqlPopulateSql[nChooseState-1]
							Call RefreshData(nChooseState)
		Contents
			Column: otchgrp
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: № отч.
						группы
				Visible? Yes
				Editable? No
				Maximum Data Length: Default
				Data Type: Number
				Justify: Left
				Width:  0.75"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
			Column: otchgrp_name
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Наименование отчетной группы
				Visible? Yes
				Editable? Yes
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  2.917"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
					On SAM_DoubleClick
						If bInsertingMode AND (nChooseState=1  OR nChooseState=2 )
							Set bTmp=FALSE
							Call SalModalDialog( dlg_RepReference, tbl_RepGroups, 
									3, cConn.hSql(), 
									nTmp, sTmp, sTmp2, bTmp)
							If bTmp
								Set tbl_RepGroups.otchgrp=nTmp
								Set tbl_RepGroups.otchgrp_name=sTmp
			Column: accgrp
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: № группы 
						 счетов
				Visible? Yes
				Editable? No
				Maximum Data Length: Default
				Data Type: Number
				Justify: Left
				Width:  0.967"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
			Column: accgrp_name
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Наименование группы счетов
				Visible? Yes
				Editable? Yes
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  2.783"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
					On SAM_DoubleClick
						If bInsertingMode AND (nChooseState=1)
							Set bTmp=FALSE
							Call SalModalDialog( dlg_RepReference, tbl_RepGroups, 
									2, cConn.hSql(), 
									nTmp, sTmp, sTmp2, bTmp)
							If bTmp
								Set tbl_RepGroups.accgrp=nTmp
								Set tbl_RepGroups.accgrp_name=sTmp
								Set tbl_RepGroups.accgrp_filemask=sTmp2
			Column: accgrp_filemask
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Приставка имени
						     файла
				Visible? Yes
				Editable? Yes
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  1.633"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
			Column: accgrp_dir
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Директория формирования
				Visible? Yes
				Editable? Yes
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  2.7"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
			Column: nlsmask
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Маска лиц.сч.
				Visible? Yes
				Editable? Yes
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  2.4"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
			Column: accgrp_filemask_old
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Приставка имени
						     файла
				Visible? No
				Editable? Yes
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  1.633"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
		Functions
			Function: RefreshData
				Description:
				Returns
				Parameters
					Number: nMode
				Static Variables
				Local variables
				Actions
					If sFltrWhere!='' 
						Set strSqlPopulate=strSqlPopulateFrom[nMode-1]||' '||sFltrFrom||' '||
								                   strSqlPopulateWhere[nMode-1]||' '||sFltrWhere||' '||
								                   strSqlPopulateOrder[nMode-1]  
					Else
						Set strSqlPopulate=strSqlPopulateSql[nMode-1]
					Call SalWaitCursor(TRUE)
					Call SalTblPopulate(hWndForm, cConn.hSql(), T(tbl_RepGroups.strSqlPopulate), TBL_FillAll)
					Call SalWaitCursor(FALSE)
			Function: SaveChanges
				Description:
				Returns
					Number:
				Parameters
					Receive String: sErrMsg
				Static Variables
				Local variables
					Number: nRow1
				Actions
					If bDeletingMode
						Set nRow = TBL_MinRow
						Call SalTblSetContext ( tbl_RepGroups, nRow )
						While SalTblFindNextRow (tbl_RepGroups, nRow, ROW_MarkDeleted, 0 )
							Call SalTblSetContext ( tbl_RepGroups, nRow )
							!
							! маски счетов 
							!
							If nChooseState = 1
								If not SqlPrepareAndExecute(cConn.hSql(), 
										   " DELETE FROM rep_acc
										     WHERE  accgrp=:tbl_RepGroups.accgrp AND
										            nlsmask=:tbl_RepGroups.nlsmask" )
									Set sErrMsg="Не возможно удалить из rep_acc"
									Return -1
							!
							! группы счетов 
							!
							If nChooseState = 2
								If SqlPrepareAndExecute(cConn.hSql(), 
										"DELETE FROM rep_acc WHERE accgrp=:tbl_RepGroups.accgrp")
									If SqlPrepareAndExecute(cConn.hSql(), 
											   " DELETE FROM rep_accg_otchg
											     WHERE accgrp=:tbl_RepGroups.accgrp AND
											           otchgrp =:tbl_RepGroups.otchgrp ")
										If not SqlPrepareAndExecute(cConn.hSql(), 
												   " DELETE FROM rep_accgrp
												     WHERE accgrp=:tbl_RepGroups.accgrp ")             
											Set sErrMsg='Ошибка удаления из таблицы rep_accgrp'
											Return -1
									Else
										Set sErrMsg='Ошибка удаления из таблицы rep_accg_otchg'
										Return -1
								Else
									Set sErrMsg='Ошибка удаления из таблицы rep_acc(маски счетов)'
									Return -1
							!
							! отчетные группы
							!
							If nChooseState = 3
								If SqlPrepareAndExecute(cConn.hSql(), 
										 "delete from rep_acc 
										  where accgrp in 
										    (select accgrp from rep_accg_otchg where otchgrp=:tbl_RepGroups.otchgrp)")
									If SqlPrepareAndExecute(cConn.hSql(), 
											"delete from rep_accg_otchg where otchgrp = :tbl_RepGroups.otchgrp")
										If not SqlPrepareAndExecute(cConn.hSql(), 
												   " DELETE FROM  rep_otchgrp 
												     WHERE otchgrp = :tbl_RepGroups.otchgrp ")
											Set sErrMsg='Ошибка удаления из таблицы rep_otchgrp'
											Return -1
									Else
										Set sErrMsg='Ошибка удаления из таблицы rep_accg_otchg'
										Return -1
								Else
									Set sErrMsg='Ошибка удаления из таблицы rep_acc(маски счетов)'
									Return -1
					!
					! Inserting
					Else If bInsertingMode
						Set nRow = TBL_MinRow
						Call SalTblSetContext ( tbl_RepGroups, nRow )
						While SalTblFindNextRow (tbl_RepGroups, nRow, ROW_New, 0 )
							Call SalTblSetContext ( tbl_RepGroups, nRow )
							If nChooseState = 1
								If not SqlPrepareAndExecute(cConn.hSql(), 
										   " INSERT INTO rep_acc(accgrp, nlsmask)
										     VALUES (:tbl_RepGroups.accgrp,
										             :tbl_RepGroups.nlsmask ) ")
									Set sErrMsg='Ошибка вставки в таблицу rep_acc'
									Return -1
							If nChooseState = 2
								If SqlPrepareAndExecute(cConn.hSql(), 
										       "SELECT nvl(max(accgrp),0) + 1 INTO :nTmp FROM rep_accgrp " )  
									If SqlFetchNext(cConn.hSql(), nRow1) 
										If SqlPrepareAndExecute(cConn.hSql(), 
												   " INSERT INTO rep_accgrp (accgrp, name, filemask, grpdir)
												     VALUES( :nTmp, 
												             :tbl_RepGroups.accgrp_name,
												             :tbl_RepGroups.accgrp_filemask,
												             :tbl_RepGroups.accgrp_dir   ) ")
											If not SqlPrepareAndExecute(cConn.hSql(), 
													        " INSERT INTO rep_accg_otchg (accgrp, otchgrp)
													          VALUES (:nTmp, :tbl_RepGroups.otchgrp) ")
												Set sErrMsg='Ошибка вставки в таблицу rep_accg_otchg'
												Return -1
										Else
											Set sErrMsg='Ошибка вставки в таблицу rep_accgrp'
											Return -1
								Else
									Set sErrMsg='Ошибка выборки из таблицы rep_accgrp'
									Return -1
							If nChooseState = 3
								If not SqlPrepareAndExecute(cConn.hSql(), 
										   " INSERT INTO rep_otchgrp 
										     SELECT nvl(max(otchgrp),0)+1, :tbl_RepGroups.otchgrp_name 
										     FROM rep_otchgrp")
									Set sErrMsg='Ошибка вставки в таблицу rep_otchgrp '
									Return -1
					!
					! Updateing
					Else
						Set nRow = TBL_MinRow
						While SalTblFindNextRow (tbl_RepGroups, nRow, ROW_Edited, 0 )
							Call SalTblSetContext ( tbl_RepGroups, nRow )
							If nChooseState = 1
								If not SqlPrepareAndExecute(cConn.hSql(), 
										   " UPDATE rep_acc 
										     SET nlsmask=:tbl_RepGroups.nlsmask
										     WHERE accgrp=:tbl_RepGroups.accgrp 
										           AND nlsmask=:tbl_RepGroups.accgrp_filemask_old ")
									Set sErrMsg='Ошибка обновления таблицы rep_acc '
									Return -1
							If nChooseState = 2
								If not SqlPrepareAndExecute(cConn.hSql(), 
										   " UPDATE rep_accgrp 
										     SET name    =:tbl_RepGroups.accgrp_name, 
										        filemask =:tbl_RepGroups.accgrp_filemask,
										        grpdir   =:tbl_RepGroups.accgrp_dir  
										     WHERE  accgrp = :tbl_RepGroups.accgrp ")
									Set sErrMsg='Ошибка обновления таблицы rep_accgrp '
									Return -1
							If nChooseState = 3
								If not SqlPrepareAndExecute(cConn.hSql(), 
										   " UPDATE rep_otchgrp 
										     SET name = :tbl_RepGroups.otchgrp_name
										     WHERE otchgrp = :tbl_RepGroups.otchgrp ")
									Set sErrMsg='Ошибка обновления таблицы rep_otchgrp  '
									Return -1
					Call RefreshData(nChooseState)
					Set bDeletingMode=FALSE
					Set bInsertingMode=FALSE
					Return 0
		Window Parameters
			Number: nPar
		Window Variables
			Number: nChooseState  ! =3-отчетные группы, 2-группы счетотв, 1-маски счетоов
			String: strSqlPopulateSql[3]
			String: strSqlPopulateFrom[3]
			String: strSqlPopulateWhere[3]
			String: strSqlPopulateOrder[3]
			: cConn
				Class: cABSConnect
			Boolean: bInsertingMode
			Boolean: bDeletingMode
			String: sTmp
			String: sTmp2
			Number: nTmp
			Number: nRow
			Boolean: bTmp
			String: sErrMsg
			: cF
				Class: cGenFilter
			String: sFltrWhere 
			String: sFltrFrom
		Message Actions
			On SAM_Create
				Call SalHideWindow(tbl_RepGroups.otchgrp)
				Call SalHideWindow(tbl_RepGroups.otchgrp_name)
				Call SalHideWindow(tbl_RepGroups.accgrp_dir)
				Call SalShowWindow(tbl_RepGroups.accgrp)
				Call SalShowWindow(tbl_RepGroups.accgrp_name)
				Call SalShowWindow(tbl_RepGroups.accgrp_filemask)
				Call SalShowWindow(tbl_RepGroups.nlsmask)
				Call SalTblSetColumnFlags ( tbl_RepGroups.accgrp_filemask, COL_Editable, FALSE)
				Call SalTblSetColumnFlags ( tbl_RepGroups.accgrp_name, COL_Editable, FALSE)
				Call SalTblSetColumnFlags ( tbl_RepGroups.accgrp_dir, COL_Editable, FALSE)
				Set nChooseState=1
				Set strFilterTblName='REP_ACC'
				! Set fFilterAtStart=TRUE
				Call cF.Init('REP_ACC', 'acc')
				!
				Call XConnectGetParams(cConn)
				If NOT cConn.Connect()
					Return FALSE
				!
				! ! Маски счетов отчетных групп
				Set strSqlPopulateSql[0]= " SELECT a.accgrp, a.name, a.filemask, 
						                              acc.nlsmask,  acc.nlsmask, a.grpdir 
						                       INTO :tbl_RepGroups.accgrp, 
						                            :tbl_RepGroups.accgrp_name, 
						                            :tbl_RepGroups.accgrp_filemask, 
						                            :tbl_RepGroups.nlsmask,
						                            :tbl_RepGroups.accgrp_filemask_old,
						                            :tbl_RepGroups.accgrp_dir                                  
						                       FROM   rep_accgrp a,
						                              rep_acc acc 
						                       WHERE acc.accgrp=a.accgrp  
						                       ORDER BY a.accgrp, acc.nlsmask "
				! Группы счетов
				Set strSqlPopulateSql[1]= " SELECT o.otchgrp, o.name,
						                              a.accgrp, a.name, a.filemask, a.grpdir 
						                       INTO :tbl_RepGroups.otchgrp,
						                            :tbl_RepGroups.otchgrp_name,
						                            :tbl_RepGroups.accgrp,
						                            :tbl_RepGroups.accgrp_name,
						                            :tbl_RepGroups.accgrp_filemask,
						                            :tbl_RepGroups.accgrp_dir
						                       FROM  rep_otchgrp o, rep_accgrp a, rep_accg_otchg t
						                       WHERE o.otchgrp=t.otchgrp AND a.accgrp =t.accgrp 
						                       ORDER BY o.otchgrp, a.accgrp "
				Set strSqlPopulateSql[2]= " SELECT otchgrp, name 
						                       INTO :tbl_RepGroups.otchgrp,
						                            :tbl_RepGroups.otchgrp_name
						                       FROM  rep_otchgrp t
						                       WHERE 1=1 
						                       ORDER BY otchgrp"
				! Звнесем в массивы для каждого SELECT-а - часть FROM и WHERE 
				! для дальнейшего фильтра
				Set strSqlPopulateFrom[2]="SELECT otchgrp, name 
						                            INTO :tbl_RepGroups.otchgrp,
						                                 :tbl_RepGroups.otchgrp_name
						                            FROM  rep_otchgrp t"
				Set strSqlPopulateFrom[1]="SELECT o.otchgrp, o.name, a.accgrp, a.name, a.filemask, a.grpdir  
						                            INTO :tbl_RepGroups.otchgrp,
						                                 :tbl_RepGroups.otchgrp_name,
						                                 :tbl_RepGroups.accgrp,
						                                 :tbl_RepGroups.accgrp_name,
						                                 :tbl_RepGroups.accgrp_filemask,
						                                 :tbl_RepGroups.accgrp_dir
						                            FROM  rep_otchgrp o, rep_accgrp a, rep_accg_otchg t"
				Set strSqlPopulateFrom[0]=" SELECT a.accgrp, a.name, a.filemask, 
						                              acc.nlsmask,  acc.nlsmask, a.grpdir 
						                            INTO :tbl_RepGroups.accgrp, 
						                                 :tbl_RepGroups.accgrp_name, 
						                                 :tbl_RepGroups.accgrp_filemask, 
						                                 :tbl_RepGroups.nlsmask,
						                                 :tbl_RepGroups.accgrp_filemask_old,
						                                 :tbl_RepGroups.accgrp_dir                              
						                            FROM   rep_accgrp a, rep_acc acc"
				Set strSqlPopulateWhere[2]="WHERE 1=1"
				Set strSqlPopulateWhere[1]="WHERE o.otchgrp=t.otchgrp AND a.accgrp =t.accgrp"
				Set strSqlPopulateWhere[0]="WHERE acc.accgrp=a.accgrp"
				Set strSqlPopulateOrder[2]="ORDER BY otchgrp"
				Set strSqlPopulateOrder[1]="ORDER BY o.otchgrp, a.accgrp"
				Set strSqlPopulateOrder[0]="ORDER BY a.accgrp, acc.nlsmask"
				Set strSqlPopulate=strSqlPopulateSql[0]
				Set tbl_RepGroups.strPrintFileName ='otch_mask.txt'
				Call SalCenterWindow(tbl_RepGroups)
				Call SalSendClassMessage( SAM_Create, 0, 0 )
			On UM_Insert
				Set bInsertingMode=TRUE
				Call SalSendClassMessage(  UM_Insert, wParam, lParam )
			On UM_Update
				If SaveChanges(sErrMsg)<0
					Call SalMessageBox(sErrMsg,'Внимание!',0)
					Call SqlRollback(cConn.hSql())
				Else
					Call SqlCommit(cConn.hSql())
			On UM_Delete
				Set bDeletingMode=TRUE
				Call SalSendClassMessage( UM_Delete, wParam, lParam )
			On UM_Populate
				Call RefreshData(nChooseState)
			On UM_NoFontChange
				Return TRUE
	Dialog Box: dlg_RepReference
		Class: cGenericTableDlg
		Property Template:
		Class DLL Name:
		Title:
		Accesories Enabled? Class Default
		Visible? Class Default
		Display Settings
			Display Style? Class Default
			Visible at Design time? Yes
			Type of Dialog: Class Default
			Window Location and Size
				Left:   Default
				Top:    Default
				Width:  Class Default
				Width Editable? Class Default
				Height: Class Default
				Height Editable? Class Default
			Absolute Screen Location? Class Default
			Font Name: Class Default
			Font Size: Class Default
			Font Enhancement: Class Default
			Text Color: Class Default
			Background Color: Class Default
		Description:
		Tool Bar
			Display Settings
				Display Style? Class Default
				Location? Class Default
				Visible? Class Default
				Size: Class Default
				Size Editable? Class Default
				Font Name: Class Default
				Font Size: Class Default
				Font Enhancement: Class Default
				Text Color: Class Default
				Background Color: Class Default
			Contents
				Pushbutton: pbIns
					Class Child Ref Key: 11
					Class ChildKey: 0
					Class: cGenericTableDlg
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbDel
					Class Child Ref Key: 12
					Class ChildKey: 0
					Class: cGenericTableDlg
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbRefresh
					Class Child Ref Key: 20
					Class ChildKey: 0
					Class: cGenericTableDlg
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbUpdate
					Class Child Ref Key: 15
					Class ChildKey: 0
					Class: cGenericTableDlg
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 32143
					Class Child Ref Key: 19
					Class ChildKey: 0
					Class: cGenericTableDlg
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? Class Default
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Pushbutton: pbSearch
					Class Child Ref Key: 13
					Class ChildKey: 0
					Class: cGenericTableDlg
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbFilter
					Class Child Ref Key: 23
					Class ChildKey: 0
					Class: cGenericTableDlg
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbPrint
					Class Child Ref Key: 14
					Class ChildKey: 0
					Class: cGenericTableDlg
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 32144
					Class Child Ref Key: 21
					Class ChildKey: 0
					Class: cGenericTableDlg
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? Class Default
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Pushbutton: pbOk
					Class Child Ref Key: 16
					Class ChildKey: 0
					Class: cGenericTableDlg
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							Set nId=tbl.colId
							Set sName=tbl.colName
							Set sFileMask=tbl.colFileMask
							Set bOK=TRUE
							Call SalSendClassMessage( SAM_Click, 0, 0 )
				Pushbutton: pbExit
					Class Child Ref Key: 17
					Class ChildKey: 0
					Class: cGenericTableDlg
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 32145
					Class Child Ref Key: 22
					Class ChildKey: 0
					Class: cGenericTableDlg
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? Class Default
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
		Contents
			Child Table: tbl
				Class Child Ref Key: 8
				Class ChildKey: 0
				Class: cGenericTableDlg
				Property Template:
				Class DLL Name:
				Display Settings
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					View: Class Default
					Allow Row Sizing? Class Default
					Lines Per Row: Class Default
				Memory Settings
					Maximum Rows in Memory: Class Default
					Discardable? Class Default
				Contents
					Column: colId
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: № отчетн.гр.
						Visible? Yes
						Editable? Yes
						Maximum Data Length: Default
						Data Type: Number
						Justify: Left
						Width:  1.1"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colName
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Наименование отчетной группыъ
						Visible? Yes
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  2.95"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colFileMask
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
				Functions
				Window Variables
				Message Actions
					On SAM_DoubleClick
						Call SalSendMsg( pbOk, SAM_Click, 0, 0 )
		Functions
		Window Parameters
			Number: nMode ! -3 - otchgroups, 2-accgroups
			Sql Handle: hSql
			Receive Number: nId
			Receive String: sName
			Receive String: sFileMask
			Receive Boolean: bOK
		Window Variables
			String: sSql
		Message Actions
			On SAM_Create
				If nMode=3 
					Set sSql=" SELECT otchgrp, name 
							           INTO :dlg_RepReference.tbl.colId,
							                :dlg_RepReference.tbl.colName
							           FROM  rep_otchgrp  
							           ORDER BY otchgrp"
				If nMode=2
					Set sSql=" SELECT  a.accgrp, a.name, a.filemask
							           INTO  :dlg_RepReference.tbl.colId,
							                 :dlg_RepReference.tbl.colName,
							                 :dlg_RepReference.tbl.colFileMask              
							           FROM  rep_accgrp a
							           ORDER BY a.accgrp "
				Call SalCenterWindow( dlg_RepReference )
				Set strSqlPopulate=sSql
				Set strSqlInsert=""
				Set strSqlUpdate=""
				Set strSqlDelete=""
				Set nFlags=GT_ReadOnly
				Call SalSendClassMessage( SAM_Create, 0, 0 )
	! cGenericTable: frm_kl_blk
.winattr class Table Window:
		Class: cGenericTable
		Property Template:
		Class DLL Name:
		Title: Базовая таблица
		Icon File:
		Accesories Enabled? Yes
		Visible? Yes
		Display Settings
			Visible at Design time? Yes
			Automatically Created at Runtime? No
			Initial State: Normal
			Maximizable? Yes
			Minimizable? Yes
			System Menu? Yes
			Resizable? Yes
			Window Location and Size
				Left:   Default
				Top:    Default
				Width:  16.717"
				Width Editable? Yes
				Height: 8.929"
				Height Editable? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
			View: Table
			Allow Row Sizing? No
			Lines Per Row: Default
		Memory Settings
			Maximum Rows in Memory: Default
			Discardable? No
.end
		                                   Description: 
		                                   Named Menus 
		                                   Menu 
		                                   Tool Bar 
			                                   Contents 
				                                   Pushbutton: pbIns
					                                   Message Actions 
				                                   Pushbutton: pbDel
					                                   Message Actions 
				                                   Pushbutton: pbRefresh
					                                   Message Actions 
				                                   Pushbutton: pbUpdate
					                                   Message Actions 
				                                   Line 
				                                   Pushbutton: pbSearch
					                                   Message Actions 
				                                   Pushbutton: pbFilter
					                                   Message Actions 
				                                   Pushbutton: pbDetails
					                                   Message Actions 
				                                   Pushbutton: pbPrint
					                                   Message Actions 
				                                   Line 
				                                   Pushbutton: pbExit
					                                   Message Actions 
				                                   Line 
		                                   Contents 
		                                   Functions 
		                                   Window Parameters 
		                                   Window Variables 
		                                   Message Actions 
		! Description: 
		! Named Menus 
		! Menu 
		! Tool Bar 
			                                                  Contents 
				                                                  Pushbutton: pbIns
					                                                  Message Actions 
				                                                  Pushbutton: pbDel
					                                                  Message Actions 
				                                                  Pushbutton: pbRefresh
					                                                  Message Actions 
				                                                  Pushbutton: pbUpdate
					                                                  Message Actions 
				                                                  Line 
				                                                  Pushbutton: pbSearch
					                                                  Message Actions 
				                                                  Pushbutton: pbFilter
					                                                  Message Actions 
				                                                  Pushbutton: pbDetails
					                                                  Message Actions 
				                                                  Pushbutton: pbPrint
					                                                  Message Actions 
				                                                  Line 
				                                                  Pushbutton: pbExit
					                                                  Message Actions 
				                                                  Line 
		! Contents 
		! Functions 
		! Window Parameters 
		! Window Variables 
		! Message Actions 
		! Description: Форма блокировки/разблокировки клиентов в клиент-казначействе
		! Named Menus 
		! Menu 
		! Tool Bar 
			                                                          Contents 
				                                                          Pushbutton: pbIns
					                                                          Message Actions 
				                                                          Pushbutton: pbDel
					                                                          Message Actions 
				                                                          Pushbutton: pbRefresh
					                                                          Message Actions 
				                                                          Pushbutton: pbUpdate
					                                                          Message Actions 
				                                                          Line 
				                                                          Pushbutton: pbSearch
					                                                          Message Actions 
				                                                          Pushbutton: pbFilter
					                                                          Message Actions 
				                                                          Pushbutton: pbDetails
					                                                          Message Actions 
				                                                          Pushbutton: pbPrint
					                                                          Message Actions 
				                                                          Line 
				                                                          Pushbutton: pbExit
					                                                          Message Actions 
				                                                          Line 
				                                                          Background Text: Для всех блокировка
				                                                          Combo Box: cbBlkForAll
					                                                          List Initialization 
					                                                          Message Actions 
						                                                          On SAM_Click
							                                                          Set iBlkForAll=cbBlkForAll.GetKey(SalListQuerySelection( cbBlkForAll) )
							                                                          Set iRow = TBL_MinRow
							                                                          While SalTblFindNextRow(hWndForm, iRow, 0, 0)
								                                                          Call SalTblSetContext( hWndForm, iRow )
								                                                          Call frm_kl_blk.cbBlkCode.SetSelectById(iBlkForAll)
								                                                          Call SalSendMsg(frm_kl_blk.cbBlkCode, SAM_AnyEdit, 0, 0)
								                                                          Call SalTblSetRowFlags (hWndForm, iRow, ROW_Edited, TRUE )
								                                                          Call SalSendMsg(frm_kl_blk, UM_Update, 0, 0)
						                                                          On SAM_Create
							                                                          If cbBlkForAll.Init(hWndItem)
								                                                          Call cbBlkForAll.Add(0,"Нету")
								                                                          Call cbBlkForAll.Add(0,"Входящих")
								                                                          Call cbBlkForAll.Add(0,"Исходящих")
								                                                          Call cbBlkForAll.Add(0,"Вход+Исход")
		! Contents 
			                                                          Column: colRnk
				                                                          List Values 
				                                                          Message Actions 
			                                                          Column: colSab
				                                                          List Values 
				                                                          Message Actions 
			                                                          Column: colName
				                                                          List Values 
				                                                          Message Actions 
			                                                          Column: cbBlkCode
				                                                          List Values 
				                                                          Message Actions 
					                                                          On SAM_Create
						                                                          If cbBlkCode.Init( hWndItem )
							                                                          Call cbBlkCode.Add( 0, 'Нету' )
							                                                          Call cbBlkCode.Add( 1, 'Входящих' )
							                                                          Call cbBlkCode.Add( 2, 'Исходящих' )
							                                                          Call cbBlkCode.Add( 3, 'Вход+Исход' )
					                                                          On SAM_AnyEdit
						                                                          Set colBlkCode=cbBlkCode.GetKey( SalListQuerySelection( cbBlkCode) )
			                                                          Column: colBlkCode
				                                                          List Values 
				                                                          Message Actions 
					! On SAM_AnyEdit
						                                                                                                                                           Call frm_kl_blk.cbBlkCode.SetSelectById(iBlkForAll)
			                                                          Column: colchbMakeVP
				                                                          List Values 
				                                                          Message Actions 
			                                                          Column: colPostType
				                                                          List Values 
				                                                          Message Actions 
			                                                          Column: cbPostType
				                                                          List Values 
				                                                          Message Actions 
					                                                          On SAM_Create
						                                                          If cbPostType.Init( hWndItem )
							                                                          Call cbPostType.Add('O', 'Offline' )
							                                                          Call cbPostType.Add('M', 'Mail' )
					                                                          On SAM_AnyEdit
						                                                          Set colPostType=cbPostType.GetKey( SalListQuerySelection( cbPostType) )
						                                                          If (colPostType='M' and colEMail=STRING_Null)
							                                                          Call SalMessageBox('Укажите сначала электронный адресс для клиента', 
									   'Внимание',  MB_IconExclamation) 
							                                                          Set colPostType = 'O'
							                                                          Call cbPostType.SetSelectById( colPostType )
			                                                          Column: colchbAltEmail
				                                                          List Values 
				                                                          Message Actions 
					                                                          On SAM_Click
						                                                          If (colchbAltEmail=0 and colAltEMail=STRING_Null)
							                                                          Call SalMessageBox('Укажите сначала альтернативный электронный адресс', 
									   'Внимание',  MB_IconExclamation) 
							                                                          Set colchbAltEmail = 0
			                                                          Column: colEMail
				                                                          List Values 
				                                                          Message Actions 
			                                                          Column: colAltEMail
				                                                          List Values 
				                                                          Message Actions 
		! Functions 
		! Window Parameters 
		! Window Variables 
			                                                          Number: iBlkForAll
			                                                          Number: iRow
		! Message Actions 
			                                                          On UM_Populate
				                                                          Call SalSendClassMessage(UM_Populate, 0, 0)
			                                                          On SAM_Create
				                                                          Call SalDisableWindow(pbIns)
				                                                          Call SalDisableWindow(pbDel)
				                                                          Set frm_kl_blk.strSqlPopulate =
						   "SELECT cp.rnk, sab, nmk, blk, make_vp,email,post_type, alt_post,  alt_email
						    INTO :frm_kl_blk.colRnk, :frm_kl_blk.colSab, :frm_kl_blk.colName, 
						         :frm_kl_blk.colBlkCode, :colchbMakeVP, :colEMail, :colPostType, :colchbAltEmail, :colAltEMail
						    FROM kl_customer_params cp, customer c 
						    WHERE cp.rnk=c.rnk"
				                                                          Set frm_kl_blk.strSqlUpdate =
						   "UPDATE kl_customer_params 
						           SET  blk =      :frm_kl_blk.colBlkCode,
						                email=     :frm_kl_blk.colEMail,
						                make_VP =  :frm_kl_blk.colchbMakeVP,
						                post_type = :frm_kl_blk.colPostType,
						                alt_post  = :frm_kl_blk.colchbAltEmail, 
						                alt_email = :frm_kl_blk.colAltEMail  
						    WHERE rnk=:frm_kl_blk.colRnk"
				                                                          Call SalSendClassMessage(SAM_Create, 0, 0)
			                                                          On SAM_FetchRowDone
				                                                          Call cbBlkCode.SetSelectById( colBlkCode )
				                                                          Call cbPostType.SetSelectById( colPostType )
	! Dialog Box: dlg_kl_PostAll
.winattr
		Class:
		Property Template:
		Class DLL Name:
		Title:
		Accesories Enabled? No
		Visible? Yes
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Type of Dialog: Modal
			Window Location and Size
				Left:   Default
				Top:    Default
				Width:  12.517"
				Width Editable? Yes
				Height: 6.548"
				Height Editable? Yes
			Absolute Screen Location? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
.end
		                                                          Description: 
		                                                          Tool Bar 
			                                                          Contents 
		                                                          Contents 
			                                                          Child Table: tblCustomer
				                                                          Contents 
					                                                          Column: colSab
						                                                          List Values 
						                                                          Message Actions 
					                                                          Column: colCustName
						                                                          List Values 
						                                                          Message Actions 
				                                                          Functions 
				                                                          Window Variables 
					                                                          String: sSql
				                                                          Message Actions 
					                                                          On SAM_Create
						                                                          Set sSql = "SELECT c.sab,  nmk
								    INTO :tblCustomer.colSab, :tblCustomer.colCustName
								    FROM kl_customer_params cp, customer c 
								    WHERE cp.rnk=c.rnk ORDER BY c.sab"
						                                                          Call SalTblPopulate( tblCustomer, hSql(), sSql, TBL_FillAll )
			                                                          Pushbutton: pbOk
				                                                          Message Actions 
					                                                          On SAM_Click
						                                                          Call WaitCursorOn()
						                                                          If (chbVP)
							                                                          Call SalSendMsg (calVPFrom, SAM_User, 0, 0)
							                                                          Call SalSendMsg (calVPTo, SAM_User, 0, 0 )
							                                                          Set bRet = postRequest('DMVP', dFrom, dTo,'')
							                                                          Set bRet = postRequest('DMVF', dFrom, dTo,'')
						                                                          If (chbVal)
							                                                          Call SalSendMsg (calVal, SAM_User, 0, 0 )
							                                                          Set bRet = postRequest('CURV', dTo, dTo,'')
						                                                          If (chbBanks)
							                                                          Set bRet = postRequest('BNKS', GetBankDate(), GetBankDate(),'')
						                                                          If (chbInfoMess)
							! Если текст был набран вручную или отредактирован  - записать измененное сообщение в таблицу
							                                                          If nCheckedMsgId = 0
								                                                          Set nCheckedMsgId = saveNewMessage(mlMsgText) 
							                                                          If nCheckedMsgId > -1
								                                                          Set bRet = postRequest('INFO', GetBankDate(), GetBankDate(), SalNumberToStrX(nCheckedMsgId,0)  )
						!
						                                                          If bRet
							                                                          Call SalMessageBox('Запрос сформирован и поставлен на отправку', 'Выполнение', 0  )
						!
						                                                          Call WaitCursorOff()
			                                                          Group Box: Послать
			                                                          Check Box: chbVP
				                                                          Message Actions 
					                                                          On SAM_Click
						                                                          If chbVP
							                                                          Call SalEnableWindow(calVPFrom)
							                                                          Call SalEnableWindow(calVPTo)
						                                                          Else 
							                                                          Call SalDisableWindow(calVPFrom)
							                                                          Call SalDisableWindow(calVPTo)
			                                                          Custom Control: calVPFrom
.data CLASSPROPSSIZE
0000: 4400
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 646172436F6D626F 426F78002B000100 0000010101010001
0020: 0200000000010101 0000000000000000 01000000010A6464 2F4D4D2F79797979
0040: 00000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				                                                          Message Actions 
					                                                          On SAM_Create
						                                                          Call calVPFrom.SetMonthText( strMonth )
						                                                          Call calVPFrom.SetWeekDayText( strWeekDays )
						! ! - - - - - - - - - - - - Инициализация дат календаря  cCalendarFrom - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  - -
						                                                          Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset,  COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVPFrom.SpecialDate(SPECIAL_OneTime, GetBankDate(), DAY_Unset, SEQ_Unset, COLOR_Blue,  COLOR_Cyan, TRUE)
						                                                          Call SqlPrepareAndExecute(  hSql(), T("SELECT fdat  INTO :dSelect  FROM fdat")  )
						                                                          Set i = 0
						                                                          While SqlFetchNext(hSql(), nFetchRes)
							                                                          Call calVPFrom.SpecialDate(SPECIAL_OneTime, dSelect,  DAY_Unset, SEQ_Unset, COLOR_Blue, COLOR_Cyan, TRUE)
							                                                          Set i = i + 1
						                                                          If i = 0
							                                                          Call SalMessageBox('Нет доступных дат для выбора','Внимание',0)
									
						                                                          Call SalSetWindowText(  calVPFrom,  strBankDate)
					                                                          On SAM_User
						                                                          Call SalGetWindowText( hWndItem, strDateFrom, 12 )
						                                                          Set dFrom =  SalDateConstruct ( SalDateYear( SalStrToDate(strDateFrom )), 
								                                SalDateMonth( SalStrToDate(strDateFrom )),
								                                SalDateDay( SalStrToDate(strDateFrom )), 0, 0, 0 )
			                                                          Custom Control: calVPTo
.data CLASSPROPSSIZE
0000: 4400
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 646172436F6D626F 426F78002B000100 0000010101010001
0020: 0200000000010101 0000000000000000 01000000010A6464 2F4D4D2F79797979
0040: 00000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				                                                          Message Actions 
					                                                          On SAM_Create
						                                                          Call calVPTo.SetMonthText( strMonth )
						                                                          Call calVPTo.SetWeekDayText( strWeekDays )
						! ! - - - - - - - - - - - - Инициализация дат календаря  cCalendarFrom - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  - -
						                                                          Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset,  COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVPTo.SpecialDate(SPECIAL_OneTime, GetBankDate(), DAY_Unset, SEQ_Unset, COLOR_Blue,  COLOR_Cyan, TRUE)
						                                                          Call SqlPrepareAndExecute(  hSql(), T("SELECT fdat  INTO :dSelect  FROM fdat")  )
						                                                          Set i = 0
						                                                          While SqlFetchNext(hSql(), nFetchRes)
							                                                          Call calVPTo.SpecialDate(SPECIAL_OneTime, dSelect,  DAY_Unset, SEQ_Unset, COLOR_Blue, COLOR_Cyan, TRUE)
							                                                          Set i = i + 1
						                                                          If i = 0
							                                                          Call SalMessageBox('Нет доступных дат для выбора','Внимание',0)
									
						                                                          Call SalSetWindowText(  calVPTo,  strBankDate)
					                                                          On SAM_User
						                                                          Call SalGetWindowText( hWndItem, strDateTo, 12 )
						                                                          Set dTo =  SalDateConstruct ( SalDateYear( SalStrToDate(strDateTo )), 
								                                SalDateMonth( SalStrToDate(strDateTo )),
								                                SalDateDay( SalStrToDate(strDateTo )), 0, 0, 0 )
			                                                          Custom Control: calVal
.data CLASSPROPSSIZE
0000: 4200
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 646172436F6D626F 426F78002B000100 0000010101010001
0020: 0200000000010101 0000000000000000 01000000010A6464 2F4D4D2F79797979
0040: 0000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				                                                          Message Actions 
					                                                          On SAM_Create
						                                                          Call calVal.SetMonthText( strMonth )
						                                                          Call calVal.SetWeekDayText( strWeekDays )
						! ! - - - - - - - - - - - - Инициализация дат календаря  cCalendarFrom - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  - -
						                                                          Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset,  COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                          Call calVal.SpecialDate(SPECIAL_OneTime, GetBankDate(), DAY_Unset, SEQ_Unset, COLOR_Blue,  COLOR_Cyan, TRUE)
						                                                          Call SqlPrepareAndExecute(  hSql(), T("SELECT fdat  INTO :dSelect  FROM fdat")  )
						                                                          Set i = 0
						                                                          While SqlFetchNext(hSql(), nFetchRes)
							                                                          Call calVal.SpecialDate(SPECIAL_OneTime, dSelect,  DAY_Unset, SEQ_Unset, COLOR_Blue, COLOR_Cyan, TRUE)
							                                                          Set i = i + 1
						                                                          If i = 0
							                                                          Call SalMessageBox('Нет доступных дат для выбора','Внимание',0)
									
						                                                          Call SalSetWindowText(  calVPTo,  strBankDate)
					                                                          On SAM_User
						                                                          Call SalGetWindowText( hWndItem, strDateTo, 12 )
						                                                          Set dTo =  SalDateConstruct ( SalDateYear( SalStrToDate(strDateTo )), 
								                                SalDateMonth( SalStrToDate(strDateTo )),
								                                SalDateDay( SalStrToDate(strDateTo )), 0, 0, 0 )
			                                                          Background Text: с
			                                                          Background Text: по
			                                                          Check Box: chbBanks
				                                                          Message Actions 
			                                                          Check Box: chbVal
				                                                          Message Actions 
					                                                          On SAM_Click
						                                                          If chbVal
							                                                          Call SalEnableWindow(calVal)
						                                                          Else 
							                                                          Call SalDisableWindow(calVal)
			                                                          Pushbutton: pbCancel
				                                                          Message Actions 
					                                                          On SAM_Click
						                                                          Call SalEndDialog(hWndForm, 0)
			                                                          Frame 
			                                                          Frame 
			                                                          Check Box: chbInfoMess
				                                                          Message Actions 
					                                                          On SAM_Click
						                                                          If chbInfoMess
							                                                          Call SalEnableWindow(pbMsgFromFile)
							                                                          Call SalEnableWindow(mlMsgText)
							                                                          Call SalEnableWindow(pbMsgFromSavedList)
						                                                          Else 
							                                                          Call SalDisableWindow(pbMsgFromFile)
							                                                          Call SalDisableWindow(mlMsgText)
							                                                          Call SalDisableWindow(pbMsgFromSavedList)
							                                                          Set mlMsgText=''
			                                                          Pushbutton: pbMsgFromSavedList
				                                                          Message Actions 
					! On SAM_Create
						                                                                                                                            Set strTip = 'Редактирование'
					                                                          On SAM_Click
						                                                          Call SalCreateWindow(tbl_MsgList, hWndItem)
					                                                          On SAM_TooltipSetText
						                                                          Return XSalTooltipSetText( lParam, 'Сообщение из сохраненного списка' )
			                                                          Pushbutton: pbMsgFromFile
				                                                          Message Actions 
					! On SAM_Create
						                                                                                                                            Set strTip = 'Из файла'
					                                                          On SAM_Click
						                                                          Set nCheckedMsgId=0
						                                                          Call getMessTextFromFile()
					                                                          On SAM_TooltipSetText
						                                                          Return XSalTooltipSetText( lParam, 'Сообщение из файла' )
			                                                          Multiline Field: mlMsgText
				                                                          Message Actions 
					!
						                                                                                                                           Call SalCreateWindow(tbl_MsgList, hWndItem)
					                                                          On SAM_FieldEdit
						! Если поле редактированли - то сообщение уже не такое, как выбрали из таблицы
						! В этом случае - сохраним его потом в таблицу
						                                                          Set nCheckedMsgId = 0
								
		                                                          Functions 
			                                                          Function: postRequest
				                                                          Description: 
				                                                          Returns 
					                                                          Boolean: 
				                                                          Parameters 
					                                                          String: sRequestName
					! Date: dat1
					                                                          Date/Time: dat1
					                                                          Date/Time: dat2
					                                                          String: sInfo
				                                                          Static Variables 
				                                                          Local variables 
					                                                          Number: iRow
				                                                          Actions 
					                                                          Set iRow = TBL_MinRow
					                                                          While SalTblFindNextRow(tblCustomer, iRow, ROW_Selected, 0)
						                                                          Call SalTblSetContext( tblCustomer, iRow )
						                                                          If not SqlPLSQLCommand(hSql(), "POST_MODULE_REQUEST(sRequestName, tblCustomer.colSab, dat1, dat2, sInfo)")
							                                                          Return FALSE
						                                                          Call SqlCommitEx(hSql(),'')
					                                                          Return TRUE
			                                                          Function: getMessTextFromFile
				                                                          Description: 
				                                                          Returns 
					! String: sMsgText
				                                                          Parameters 
				                                                          Static Variables 
				                                                          Local variables 
					                                                          String: sFileNameFilters[*]
					                                                          String: sSelectedFileName
					                                                          String: sSelectedFilePath
					                                                          String: sFileLine
					                                                          Number: nSelectedFiltr
					                                                          File Handle: hFile
				                                                          Actions 
					                                                          Set sFileNameFilters[0]='All files'
					                                                          Set sFileNameFilters[1]='*.*'
					                                                          Call SalDlgOpenFile (hWndNULL, 'Файл сообщения', sFileNameFilters, 2, nSelectedFiltr, sSelectedFileName, sSelectedFilePath )
					                                                          If VisFileOpen (hFile, sSelectedFilePath, OF_Read) = VTERR_Ok
						                                                          While VisFileReadString (hFile, sFileLine) = VTERR_Ok
							                                                          Set mlMsgText = mlMsgText || sFileLine || SalNumberToChar( 13 ) || SalNumberToChar( 10 )
			                                                          Function: saveNewMessage
				                                                          Description: 
				                                                          Returns 
					                                                          Number: 
				                                                          Parameters 
					                                                          Long String: sMessText
				                                                          Static Variables 
				                                                          Local variables 
					                                                          Number: nMessId
				                                                          Actions 
					                                                          If SqlPrepareAndExecute(hSql(), "SELECT nvl(max(id_mess),0)+1 INTO :nMessId FROM kl_info_messages") AND SqlFetchNext(hSql(), i) 
						                                                          If SqlPrepareAndExecute(hSql(), "INSERT INTO kl_info_messages VALUES(:nMessId, :sMessText)")
							                                                          Call SqlCommit(hSql())
							                                                          Return nMessId
						                                                          Else 
							                                                          Call SalMessageBox('Невозможно вставить новое сообщение','Внимание!', MB_OK)
							                                                          Return -1
					                                                          Else 
						                                                          Call SalMessageBox('Невозможно получить последующий номер для сообщения','Внимание!', MB_OK)
						                                                          Return -1
		                                                          Window Parameters 
		                                                          Window Variables 
			                                                          String: sCheckedMsgText
			                                                          Number: nCheckedMsgId
			                                                          String: sSql
			                                                          String: strMonth[12]              !! Наименов. месяце для календаря
			                                                          String: strWeekDays[7]         !! Дни недели для календаря
			                                                          Number: nFetchRes
			                                                          Number: i
			                                                          Boolean: bRet
			                                                          Date/Time: dSelect
			                                                          Date/Time: dFrom
			                                                          Date/Time: dTo
		                                                          Message Actions 
			                                                          On SAM_Create
				                                                          Call GetMonthArray( strMonth )
				                                                          Call GetWeekDayArray( strWeekDays )
				                                                          Call SalDisableWindow(calVPFrom)
				                                                          Call SalDisableWindow(calVPTo)
				                                                          Call SalDisableWindow(calVal)
				!
				                                                          Call SalDisableWindow(pbMsgFromFile)
				                                                          Call SalDisableWindow(mlMsgText)
				                                                          Call SalDisableWindow(pbMsgFromSavedList)
				!
				                                                          Set nCheckedMsgId = 0
				                                                          Set bRet = FALSE
	Table Window: tbl_MsgList
		Class: cGenericTable
		Property Template:
		Class DLL Name:
		Title: Сообщение клиенту
		Icon File:
		Accesories Enabled? Yes
		Visible? Yes
		Display Settings
			Visible at Design time? Yes
			Automatically Created at Runtime? No
			Initial State: Normal
			Maximizable? Yes
			Minimizable? Yes
			System Menu? Yes
			Resizable? Yes
			Window Location and Size
				Left:   Default
				Top:    Default
				Width:  9.7"
				Width Editable? Yes
				Height: 4.25"
				Height Editable? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
			View: Table
			Allow Row Sizing? No
			Lines Per Row: Default
		Memory Settings
			Maximum Rows in Memory: Default
			Discardable? No
		Description:
		Named Menus
		Menu
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Top
				Visible? Yes
				Size: Default
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
				Pushbutton: pbIns
					Class Child Ref Key: 33
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbDel
					Class Child Ref Key: 34
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbRefresh
					Class Child Ref Key: 35
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbUpdate
					Class Child Ref Key: 36
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 4455
					Class Child Ref Key: 37
					Class ChildKey: 0
					Class: cGenericTable
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? Class Default
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Pushbutton: pbSearch
					Class Child Ref Key: 38
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbFilter
					Class Child Ref Key: 44
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbDetails
					Class Child Ref Key: 39
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbPrint
					Class Child Ref Key: 40
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 4456
					Class Child Ref Key: 41
					Class ChildKey: 0
					Class: cGenericTable
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? Class Default
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Pushbutton: pbExit
					Class Child Ref Key: 42
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 4457
					Class Child Ref Key: 43
					Class ChildKey: 0
					Class: cGenericTable
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? Class Default
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
		Contents
		Functions
		Window Parameters
		Window Variables
		Message Actions
		! Description: 
		! Named Menus 
		! Menu 
		! Tool Bar 
			                                                          Contents 
				                                                          Pushbutton: pbIns
					                                                          Message Actions 
				                                                          Pushbutton: pbDel
					                                                          Message Actions 
				                                                          Pushbutton: pbRefresh
					                                                          Message Actions 
				                                                          Pushbutton: pbUpdate
					                                                          Message Actions 
				                                                          Line 
				                                                          Pushbutton: pbSearch
					                                                          Message Actions 
				                                                          Pushbutton: pbFilter
					                                                          Message Actions 
				                                                          Pushbutton: pbDetails
					                                                          Message Actions 
				                                                          Pushbutton: pbPrint
					                                                          Message Actions 
				                                                          Line 
				                                                          Pushbutton: pbExit
					                                                          Message Actions 
				                                                          Line 
		! Contents 
			                                                          Column: colID
				                                                          List Values 
				                                                          Message Actions 
			                                                          Column: colMess
				                                                          List Values 
				                                                          Message Actions 
			                                                          Column: colMessLength
				                                                          List Values 
				                                                          Message Actions 
		! Functions 
		! Window Parameters 
		! Window Variables 
			                                                          Number: i
			                                                          Long String: lsInfoMess_Part
		! Message Actions 
			                                                          On UM_Populate
				                                                          Call SalSendClassMessage(UM_Populate, 0, 0)
			                                                          On SAM_Create
				                                                          Call SalDisableWindow(pbFilter)
				                                                          Call SalDisableWindow(pbPrint)
				                                                          Call SalDisableWindow(pbDetails)
				                                                          Set tbl_MsgList.strSqlPopulate =
						   "SELECT id_mess, dbms_lob.substr(info_text,100, 1), dbms_lob.getlength(info_text)
						    INTO :tbl_MsgList.colID, :tbl_MsgList.colMess, :tbl_MsgList.colMessLength
						    FROM kl_info_messages"
				                                                          Set tbl_MsgList.strSqlUpdate =
						   "UPDATE kl_info_messages
						    SET  info_text =  :tbl_MsgList.colMess           
						    WHERE id_mess =:tbl_MsgList.colID"
				                                                          Call SalSendClassMessage(SAM_Create, 0, 0)
			                                                          On SAM_DoubleClick
				                                                          Set dlg_kl_PostAll.nCheckedMsgId = colID
				! Поскольку поле типа CLOB и могут быть например файлы
						! вычитаем по-очередно
				!
				                                                          Set i = 1
				                                                          While i < colMessLength
					                                                          Call SqlPrepareAndExecute(hSql(), "
							SELECT dbms_lob.substr((SELECT info_text FROM kl_info_messages WHERE id_mess = :colID),2000,:i)
							INTO :lsInfoMess_Part
							FROM dual")
					                                                          Call SqlFetchNext(hSql(), nFetchRes)
					                                                          Set dlg_kl_PostAll.mlMsgText=dlg_kl_PostAll.mlMsgText||lsInfoMess_Part
					                                                          Set i = i + 2000
				! Set dlg_kl_PostAll.mlMsgText = colMess
				                                                          Set dlg_kl_PostAll.sCheckedMsgText =  dlg_kl_PostAll.mlMsgText
				                                                          Call SalDestroyWindow(hWndItem)
	! Dialog Box: frm_VpOst
.winattr
		Class:
		Property Template:
		Class DLL Name:
		Title: Формирование выписок и остатков по районам
		Accesories Enabled? Yes
		Visible? No
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Type of Dialog: Modal
			Window Location and Size
				Left:   2.425"
				Top:    0.99"
				Width:  8.933"
				Width Editable? Yes
				Height: 6.071"
				Height Editable? Yes
			Absolute Screen Location? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
.end
		                                                         Description: Формирование остатков и заключ. выписки на Казну(dbf)
				Выписка WABS - она включает в себя данные для выписки в казну. Поэтому, 
				если выбрано формирование выписок wabs и на казну - выполняется формирование только выписки 
				wabs c последующим удалением ненужных данных для казны
				
				Список кодов блокировки нужен только для выписки казны. 
				Поскольку выписка wabs включает всегда платежи, кот находятся на транзите 
		                                                         Tool Bar 
			                                                         Contents 
		                                                         Contents 
			                                                         Multiline Field: mlText
				                                                         Message Actions 
			                                                         Pushbutton: pbRun
				                                                         Message Actions 
					!
					                                                         On SAM_Click
						                                                         Call SalWaitCursor(TRUE)
						                                                         Set sFdat = SalFmtFormatDateTime(dYes, 'dd/MM/yyyy')
						!
						                                                         If rbProcessChecked AND cbkazVP AND NOT cbVWABS
							                                                         Call SalMessageBox('Виписки на казну формуються тільки по всім районам', 'Увага',MB_IconExclamation)
							                                                         Set rbProcessChecked=FALSE
							                                                         Set rbProcessAll=TRUE
							                                                         Call SalWaitCursor(FALSE)
						                                                         Else 
							!
							                                                         Set sProcesTime= 'Початок: '||getCurrTime()
							!
							                                                         Set sSabList=''
							                                                         If rbProcessChecked
								                                                         Set nRow = TBL_MinRow
								                                                         While SalTblFindNextRow(tblRegions, nRow, 0, 0)
									                                                         Call SalTblSetContext( tblRegions, nRow )
									                                                         If tblRegions.colOTM='1'
										                                                         Set sSabList=sSabList||IifS(SalStrLength(sSabList)=0, '',',' )||tblRegions.colSAB
							                                                         Else 
								                                                         Set sSabList='%'
							!
							                                                         Set nGetT00DocsForWabs  = SalStrToNumber(SalStrRightX(sVWABSParams, 1))
							                                                         Set nGetT00DocsForKazna = SalStrToNumber(SalStrRightX(sKAZNAParams, 1))
							! WABS.DBF 
							!
							                                                         If cbVWABS
								                                                         Set mlText = 'формування VWABS.DBF ...'
								!
								! Параметры 
								!
								                                                         Set nInfoMsg = SalStrToNumber(SalStrLeftX(sVWABSParams, 1))
								!
								                                                         Call Debug('FOR WABS:  sBlkList='||sBlkList||' T00Docs='||SalNumberToStrX(nGetT00DocsForWabs,0)||' nInfoMsg='||SalNumberToStrX(nInfoMsg,0))
								!
								! Если нужно еще потом делать выписки на казну.
										! Смысл в том, что бы выполнить процедуру населения выписок - один раз. 
										! Выписка wabs включает в себя данные для выписки на казну. Поэтому если выбрано 
										! сделать выписки wabs + казна - выполним только p_dkuvwabs 
										! А уже в ней удаляются доходные счета, док-ты на невыясненных, информационные, которые ненужны в выписке в казну.
										! Единственное, если параметр nGetT00DocWabs <> nGetT00DocKazna, тогда прийдется выполнить две процедуры
								!
								                                                         If cbkazVP and nGetT00DocsForWabs=nGetT00DocsForKazna
									                                                         Set sProcName = "p_dkuvwabs(dYes,sSabList, nInfoMsg, nGetT00DocsForWabs, 1,sBlkList)"
								                                                         Else 
									                                                         Set sProcName = "p_dkuvwabs(dYes,sSabList, nInfoMsg, nGetT00DocsForWabs, 0,sBlkList)"
								                                                         If not SqlPLSQLCommand(hSql(), sProcName)
									                                                         Call SalMessageBox( 'Ошибка выполнения процедуры '||sProcName, '', MB_Ok | MB_IconAsterisk )
									                                                         Return FALSE
								                                                         If not SqlPLSQLCommand(hSql(),"bars_dbf.make_dbf_fromtable('TMP_DKUVWABS','DOS')")
									                                                         Call SalMessageBox( 'Ошибка формирования DBF файла', '', MB_Ok | MB_IconAsterisk )
									                                                         Return FALSE
								                                                         Call PutLoadedDBFToFile(hSql(), (sVWABSPath)||"\\vwabs.dbf")
							!
							! Выписки
							!
							                                                         If cbkazVP
								                                                         Set mlText = 'формування заключ. виписки на Казну ...'
								                                                         Set nInfoMsg = SalStrToNumber(SalStrLeftX(sKAZNAParams, 1))
								                                                         Call Debug('FOR KAZNA:  sBlkList='||sBlkList||' T00Docs='||SalNumberToStrX(nGetT00DocsForKazna,0)||' nInfoMsg='||SalNumberToStrX(nInfoMsg,0))
								!
								! Если процедура по населению выписок еще не была выполнена
								                                                         If not cbVWABS or (nGetT00DocsForWabs!=nGetT00DocsForKazna)
									                                                         Set sProcName = "p_dkukazna(dYes,0, sBlkList, nGetT00DocsForKazna)"
									                                                         If not SqlPLSQLCommand(hSql(), sProcName)
										                                                         Call SalMessageBox( 'Ошибка выполнения процедуры '||sProcName, '', MB_Ok | MB_IconAsterisk )
										                                                         Return FALSE
								!
								                                                         If not SqlPLSQLCommand(hSql(),"bars_dbf.make_dbf_fromtable('TMP_DKUZKLVP','WIN')")
									                                                         Call SalMessageBox( 'Помилка формирмування DBF файлу', '', MB_Ok | MB_IconAsterisk )
									                                                         Return FALSE
								                                                         Call PutLoadedDBFToFile(hSql(), (sKAZNAPath)||"\\"||GetBankSab()||SalFmtFormatDateTime(dYes, 'dd')||SalFmtFormatDateTime(dYes, 'MM')||'.dbf')
								!
								!
							!
							! Остатки  
							!
							                                                         If cbkazOST
								                                                         Set mlText = 'Формирование остатков ...'
								                                                         Set sProcName = "p_dkukazna(dYes,1,sBlkList,nGetT00Docs)"
								                                                         If not SqlPLSQLCommand(hSql(), sProcName)
									                                                         Call SalMessageBox( 'Ошибка выполнения процедуры '||sProcName, '', MB_Ok | MB_IconAsterisk )
									                                                         Return FALSE
								                                                         If not SqlPLSQLCommand(hSql(),"bars_dbf.make_dbf_fromtable('TMP_DKUOST','WIN')")
									                                                         Call SalMessageBox( 'Ошибка формирования DBF файла', '', MB_Ok | MB_IconAsterisk )
									                                                         Return FALSE
								                                                         Call PutLoadedDBFToFile(hSql(), (sKAZNAPath)||"\\"||SalFmtFormatDateTime(dYes, 'dd')||SalFmtFormatDateTime(dYes, 'MM')||'_ost.dbf')
							!
							                                                         Set mlText = 'Выгрузка завершена. '
							                                                         Call SalWaitCursor(FALSE)
							                                                         Set sProcesTime= sProcesTime||'  Окончание: '||getCurrTime()
							                                                         Set mlText = mlText ||sProcesTime
			                                                         Pushbutton: pbExit
				                                                         Message Actions 
					                                                         On SAM_Click
						                                                         Call SalEndDialog(hWndForm, 0)
			                                                         Custom Control: cc1
.data CLASSPROPSSIZE
0000: 3600
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 6461720025000100 0000000100010000 0200000001000001
0020: 0101010000000A31 352F30362F313935 360000000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				                                                         Message Actions 
					                                                         On SAM_CustControlCmd
						                                                         Call cc1.GetFocusDate(dDada)
						                                                         If cc1.IsSpecialDate(SPECIAL_OneTime, dDada, DAY_Unset, SEQ_Unset)
							                                                         Call cc1.SpecialDate(SPECIAL_OneTime, dYes, DAY_Unset, SEQ_Unset, COLOR_Blue,
									     COLOR_Cyan, TRUE)
							                                                         Set dYes = dDada
							                                                         Call cc1.SpecialDate(SPECIAL_OneTime, dYes, DAY_Unset, SEQ_Unset, COLOR_Blue,
									     COLOR_Yellow, TRUE)
					                                                         On SAM_Create
						                                                         Call cc1.WeekStartSet(2)
			                                                         Check Box: cbkazVP
				                                                         Message Actions 
			                                                         Check Box: cbkazOST
				                                                         Message Actions 
			                                                         Check Box: cbVWABS
				                                                         Message Actions 
			                                                         Group Box: Клиент-банк
			                                                         Group Box: Казна
			                                                         Child Table: tblRegions
				                                                         Contents 
					                                                         Column: colOTM
						                                                         List Values 
						                                                         Message Actions 
							                                                         On SAM_AnyEdit
								                                                         Call SalTblSetFlagsAnyRows(tblRegions,ROW_Edited, FALSE, 0, 0) 
					                                                         Column: colSAB
						                                                         List Values 
						                                                         Message Actions 
					                                                         Column: colNMK
						                                                         List Values 
						                                                         Message Actions 
					                                                         Column: colMFOSAB
						                                                         List Values 
						                                                         Message Actions 
				                                                         Functions 
				                                                         Window Variables 
				                                                         Message Actions 
					                                                         On SAM_Create
						                                                         Call WaitCursorOn()
						                                                         Call SalTblPopulate(tblRegions, hSql(), T("
								     SELECT '1',sab,nb,mfo
								     FROM banks
								     INTO :tblRegions.colOTM,:tblRegions.colSAB,:tblRegions.colNMK,:tblRegions.colMFOSAB
								     WHERE kodn=4 and blk<>2 and blk<>3 and blk<>9 and fmi='$A' and fmo='$B'
								     ORDER BY sab"), TBL_FillAll)
						                                                         Call WaitCursorOff()
			                                                         Radio Button: rbProcessAll
				                                                         Message Actions 
					                                                         On SAM_Click
						                                                         If rbProcessAll
							                                                         Call SalDisableWindow(tblRegions)
							! Call XSalTblSetColumnBackColor(tblRegions.colOTM, COLOR_SysWindow)
							                                                         Set nRow = TBL_MinRow
							                                                         While SalTblFindNextRow(tblRegions, nRow, 0, 0)
								                                                         Call SalTblSetContext( tblRegions, nRow )
								                                                         Set tblRegions.colOTM = '1'
			                                                         Radio Button: rbProcessChecked
				                                                         Message Actions 
					                                                         On SAM_Click
						                                                         If rbProcessChecked
							                                                         Call SalEnableWindow(tblRegions)
							                                                         Set nRow = TBL_MinRow
							                                                         While SalTblFindNextRow(tblRegions, nRow, 0, 0)
								                                                         Call SalTblSetContext( tblRegions, nRow )
								                                                         Set tblRegions.colOTM = '0'
		                                                         Functions 
			                                                         Function: getCurrTime
				                                                         Description: 
				                                                         Returns 
					                                                         String: strTime
				                                                         Parameters 
				                                                         Static Variables 
				                                                         Local variables 
				                                                         Actions 
					                                                         Return NumberToStrFormat( SalDateHour(SalDateCurrent()),2,'0' )||':'||
							       NumberToStrFormat( SalDateMinute(SalDateCurrent()),2,'0' )||':'||  
							       NumberToStrFormat(  SalDateSecond (SalDateCurrent()),2,'0' )
		                                                         Window Parameters 
			! флаг =0 - ручной режим, =1 - авторежим
			                                                         Number: nAvtoFlag 
		                                                         Window Variables 
			                                                         String: smWeek[7]
			                                                         String: smMonth[12]
			                                                         Date/Time: dYes
			                                                         Date/Time: dSelect
			                                                         String: sFdat
			                                                         Number: nI
			                                                         Date/Time: dDada
			                                                         String: sVWABSParams
			                                                         String: sKAZNAParams
			                                                         String: sKAZNAPath
			                                                         String: sVWABSPath
			                                                         Number: nInfoMsg
			                                                         String: sBlkList
			                                                         Number: nGetT00DocsForWabs
			                                                         Number: nGetT00DocsForKazna
			                                                         String: sProcesTime
			                                                         String: sProcName
			                                                         String: sSabList
			                                                         Number: nTimerCount
			                                                         Number: nRow
		                                                         Message Actions 
			                                                         On SAM_Create
				                                                         Call SalCenterWindow(hWndForm)
				                                                         Set nTimerCount = 0
				                                                         Set dYes = GetBankDate()
				                                                         Call SalWaitCursor(TRUE)
				                                                         Call cc1.ClearSpecials()
				                                                         Call SalSetFocus(cc1)
				                                                         Call GetMonthArrayRus(smMonth)
				                                                         Call GetWeekDayArray(smWeek)
				                                                         Call cc1.SetMonthText(smMonth)
				                                                         Call cc1.SetWeekDayText(smWeek)
				                                                         Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset,    COLOR_Black,  COLOR_Gray, TRUE)
				                                                         Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset,    COLOR_Black,     COLOR_Gray, TRUE)
				                                                         Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset,   COLOR_Black,     COLOR_Gray, TRUE)
				                                                         Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black,     COLOR_Gray, TRUE)
				                                                         Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset,  COLOR_Black,     COLOR_Gray, TRUE)
				                                                         Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset,    COLOR_Black,     COLOR_Gray, TRUE)
				                                                         Call cc1.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset,  COLOR_Black,     COLOR_Gray, TRUE)
				                                                         Call SqlPrepareAndExecute(hSql(), T("
						     SELECT fdat
						     INTO :dSelect
						     FROM fdat"))
				                                                         Set nI = 0
				                                                         While SqlFetchNext(hSql(), nFetchRes)
					                                                         Call cc1.SpecialDate(SPECIAL_OneTime, dSelect, DAY_Unset, SEQ_Unset, COLOR_Blue,
							     COLOR_Cyan, TRUE)
					                                                         Set nI = nI + 1
				                                                         If nI = 0
					                                                         Set mlText = 'Нет информации для отбора выписки'
					                                                         Call SalHideWindow(cc1)
					                                                         Call SalHideWindow(pbRun)
					                                                         Call SalSetFocus(pbExit)
				                                                         Else 
					                                                         Set mlText = ''
					                                                         Call cc1.SetFocusDate(dYes)
				                                                         Call SalWaitCursor(FALSE)
				                                                         If nAvtoFlag=0
					                                                         Set cbkazVP = FALSE
					                                                         Set cbkazOST = FALSE
					                                                         Set cbVWABS = TRUE
				                                                         If nAvtoFlag=1
					                                                         Set cbVWABS = TRUE
					                                                         Set cbkazVP = FALSE
					                                                         Set cbkazOST = FALSE
					                                                         Call SalDisableWindow(cbkazVP)
					                                                         Call SalDisableWindow(cbkazOST)
					                                                         Call SalDisableWindow(cc1)
					                                                         Call SalTimerSet ( hWndItem, 1, 1000 )
					                                                         Set nTimerCount = 0
				!
				!
				                                                         Call SalUseRegistry(FALSE, '')
				                                                         Call SalGetProfileString('ElektroKlients', 'KaznaDocPath', GetPrnDir(), sKAZNAPath, GetIniFileName())
				                                                         Call SalGetProfileString('ElektroKlients', 'BackDocPath',  GetPrnDir(), sVWABSPath, GetIniFileName())
				                                                         Call SalGetProfileString('ElektroKlients', 'VWABSParams',  '1;0',       sVWABSParams, GetIniFileName())
				                                                         Call SalGetProfileString('ElektroKlients', 'KAZNAParams',  '0;0',       sKAZNAParams, GetIniFileName()) 
				                                                         Call SalGetProfileString('ElektroKlients', 'VPBlkCodes',   '', sBlkList, GetIniFileName()) 
				!
			                                                         On SAM_Timer
				                                                         If nAvtoFlag=1 and nTimerCount = 0
					                                                         Call SalSendMsg( pbRun, SAM_Click, 0, 0 )
					                                                         Set nTimerCount = 1 
				                                                         Else 
					                                                         If nAvtoFlag=1 and nTimerCount = 1
						                                                         Call SalSendMsg( pbExit, SAM_Click, 0, 0 )
					                                                         Call SalWaitCursor(FALSE)
			                                                         On SAM_Destroy
				                                                         If nAvtoFlag=1
					                                                         Call SalTimerKill ( hWndItem, 1 )
	! cGenericTable: tblKlbFiles
.winattr class Table Window:
		Class: cGenericTable
		Property Template:
		Class DLL Name:
		Title: Базовая таблица
		Icon File:
		Accesories Enabled? Yes
		Visible? Yes
		Display Settings
			Visible at Design time? Yes
			Automatically Created at Runtime? No
			Initial State: Normal
			Maximizable? Yes
			Minimizable? Yes
			System Menu? Yes
			Resizable? Yes
			Window Location and Size
				Left:   Default
				Top:    Default
				Width:  11.833"
				Width Editable? Yes
				Height: 5.512"
				Height Editable? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
			View: Table
			Allow Row Sizing? No
			Lines Per Row: Default
		Memory Settings
			Maximum Rows in Memory: Default
			Discardable? No
.end
		                                                          Description: 
		                                                          Named Menus 
		                                                          Menu 
		                                                          Tool Bar 
			                                                          Contents 
				                                                          Pushbutton: pbIns
					                                                          Message Actions 
				                                                          Pushbutton: pbDel
					                                                          Message Actions 
				                                                          Pushbutton: pbRefresh
					                                                          Message Actions 
						                                                          On SAM_Create
							                                                          Set strTip = 'Перечитать данные'
						                                                          On SAM_Click
							                                                          Call SalSendMsg(tblKlbFiles, UM_Populate, 0, 0)
				                                                          Pushbutton: pbUpdate
					                                                          Message Actions 
				                                                          Line 
				                                                          Pushbutton: pbSearch
					                                                          Message Actions 
				                                                          Pushbutton: pbFilter
					                                                          Message Actions 
				                                                          Pushbutton: pbDocs
					                                                          Message Actions 
						                                                          On SAM_Create
							                                                          Set strTip = 'Просмотреть документы файла'
						                                                          On SAM_Click
							! sCond 
							                                                          Call DocViewListInt(hWndMDI,  " ref in (select ref from operw where tag='KLBXF' and value='"||tblKlbFiles.colFileName ||"' )", "Документы" )
				                                                          Pushbutton: pbPrint
					                                                          Message Actions 
				                                                          Line 
				                                                          Pushbutton: pbExit
					                                                          Message Actions 
				                                                          Line 
				                                                          Combo Box: cmbFileDate
					                                                          List Initialization 
					                                                          Message Actions 
						                                                          On SAM_Create
							                                                          Call cmbFileDate.Init(hWndItem)
							                                                          Call cmbFileDate.Populate(hSql(), "rownum", "TO_CHAR(fdat,'DD-MM-YYYY')",
									    "(select fdat from fdat)",
									     "ORDER BY fdat DESC")
							                                                          Call SalListSetSelect(cmbFileDate, 0)
						                                                          On SAM_Click
							                                                          Call SalSendClassMessage( SAM_Click, 0, 0 )
							                                                          Set sTmp = cmbFileDate.GetNameById(cmbFileDate.GetKey(SalListQuerySelection(hWndItem)))
							                                                          Set dDateSelected = SalDateConstruct(SalStrToNumber( SalStrRightX( sTmp, 4 )),
									 SalStrToNumber( SalStrMidX( sTmp, 3, 2 )),
									 SalStrToNumber(SalStrLeftX( sTmp, 2 )), 0, 0, 0)
							                                                          Call SalSendMsg(cmbFileDate, SAM_User, 0, 0)
						                                                          On SAM_User
							                                                          Set nDay = SalDateDay(dDateSelected)
							                                                          Set nMonth = SalDateMonth(dDateSelected)
							                                                          Set nYear = SalDateYear(dDateSelected)
							                                                          If cmbBanks = '*'
								                                                          Set strSab = ''
							                                                          Else 
								                                                          If not SalIsNull(cmbBanks)
									                                                          Set strSab = cmbBanks.GetKey(SalListQuerySelection(cmbBanks))
							                                                          Set dfFileName = '*' || SalStrRightX(strSab,5) || GetCharForDigit(nMonth) || GetCharForDigit(nDay) ||'????'
							                                                          Call SalSendMsg(pbSearchFiles, SAM_Click, 0, 0)
				                                                          Data Field: dfFileName
					                                                          Message Actions 
				                                                          Combo Box: cmbBanks
					                                                          List Initialization 
					                                                          Message Actions 
						                                                          On SAM_Create
							                                                          Call cmbBanks.Init(hWndItem)
							                                                          Call cmbBanks.Populate(hSql(), "sab", "nmk", "customer", " where sab is not null order by nmk")
							                                                          Call cmbBanks.Add('*', '*')
						                                                          On SAM_Click
							                                                          Call SalSendMsg(cmbFileDate, SAM_User, 0, 0)
				                                                          Frame 
				                                                          Pushbutton: pbSearchFiles
					                                                          Message Actions 
						                                                          On SAM_Click
							                                                          Call SalSendMsg(tblKlbFiles, UM_Populate, 0, 0)
						                                                          On SAM_TooltipSetText
							                                                          Return XSalTooltipSetText(lParam, 'Задействовать имя для поиска')
				                                                          Group Box: Типи файлів
				                                                          Group Box: Пошук
				                                                          Radio Button: rbInDirect
					                                                          Message Actions 
				                                                          Radio Button: rbOutDirect
					                                                          Message Actions 
		                                                          Contents 
			                                                          Column: colFileName
				                                                          List Values 
				                                                          Message Actions 
			                                                          Column: colDatF
				                                                          List Values 
				                                                          Message Actions 
			                                                          Column: colDatP
				                                                          List Values 
				                                                          Message Actions 
			                                                          Column: colDocTotal
				                                                          List Values 
				                                                          Message Actions 
			                                                          Column: colDocPayed
				                                                          List Values 
				                                                          Message Actions 
		                                                          Functions 
		                                                          Window Parameters 
		                                                          Window Variables 
			                                                          String: strSab
			                                                          String: sTmp
			                                                          Number: nTmp
			                                                          Date/Time: dDateSelected
			                                                          Number: nDay
			                                                          Number: nMonth
			                                                          Number: nYear
			                                                          String: strSql
			                                                          String: sCond
		                                                          Message Actions 
			                                                          On UM_Populate
				                                                          Call SalSetWindowText(tblKlbFiles, 'Файлы клиент банка')
				                                                          Set hWndCol = hWndNULL
				                                                          Call SalDisableWindow(pbIns)
				                                                          Call SalDisableWindow(pbDel)
				                                                          Call SalDisableWindow(pbUpdate)
				                                                          Call SalDisableWindow(pbPrint)
				                                                          Call SalTblSetLockedColumns(tblKlbFiles, 2)
				                                                          Set strSql = "
						    SELECT pnam, datf, datp, ndoctotal, ndocpayed
						    FROM   xml_gate
						    INTO :tblKlbFiles.colFileName,  :tblKlbFiles.colDatF, :tblKlbFiles.colDatP,
						         :tblKlbFiles.colDocTotal, :tblKlbFiles.colDocPayed
						    WHERE pnam LIKE '" || StrMatches2Like(dfFileName) || "' and
						          datp>=:dDateSelected and datp-1<:dDateSelected ORDER BY pnam, datp"
				                                                          Call WaitCursorOn()
				                                                          Set nRow = 0
				                                                          Call SalTblPopulate(tblKlbFiles, hSqlAux(), T(strSql), TBL_FillAll)
				                                                          Call SalTblDefineSplitWindow (tblKlbFiles, 1, TRUE)
				                                                          Set nTmp = SalTblInsertRow(tblKlbFiles, TBL_MinRow)
				                                                          Call SalTblSetContext(tblKlbFiles, nTmp)
				                                                          Call SalTblSetRowFlags(tblKlbFiles, nTmp, ROW_New, FALSE)
				                                                          Call WaitCursorOff()
			                                                          On SAM_Create
				                                                          Set dDateSelected = GetBankDate()
				                                                          Call PrepareWindow(hWndForm)
				! Call SetWindowFullSize(hWndForm)
				                                                          Call XSalTooltipSetUserDefault()
				                                                          Set nDay   = SalDateDay(GetBankDate())
				                                                          Set nMonth = SalDateMonth(GetBankDate())
				                                                          Set nYear  = SalDateYear(GetBankDate())
				                                                          Set dfFileName = '*' || GetCharForDigit(nMonth) || GetCharForDigit(nDay) || '????'
				                                                          Set rbInDirect = TRUE
				                                                          Set rbOutDirect = FALSE
				                                                          Call SalTblSetTableFlags(tblKlbFiles, TBL_Flag_SingleSelection, TRUE)
				                                                          Call SalTblSetTableFlags(tblKlbFiles, TBL_Flag_SelectableCols, TRUE)
				                                                          Call SalSetFocus(pbExit)
			                                                          On SAM_CreateComplete
				                                                          Call SalSendMsg( pbRefresh, SAM_Click, 0, 0 )
				                                                          Call WaitCursorOff()
			                                                          On SAM_DoubleClick
				                                                          Call SalSendMsg(pbDocs, SAM_Click, 0, 0)
	! Form Window: frm_DKUCat
.winattr
		Class:
		Property Template:
		Class DLL Name:
		Title: Перечень отделений районных казначейств
		Icon File:
		Accesories Enabled? Yes
		Visible? No
		Display Settings
			Display Style? Default
			Visible at Design time? No
			Automatically Created at Runtime? No
			Initial State: Normal
			Maximizable? Yes
			Minimizable? Yes
			System Menu? Yes
			Resizable? Yes
			Window Location and Size
				Left:   0.125"
				Top:    0.604"
				Width:  13.533"
				Width Editable? Yes
				Height: 6.333"
				Height Editable? Yes
			Form Size
				Width:  Default
				Height: Default
				Number of Pages: Dynamic
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
.end
		                                                   Description: Ведомости по Казначейству
		                                                   Named Menus 
		                                                   Menu 
		                                                   Tool Bar 
			                                                   Contents 
				                                                   List Box: lbStatus
					                                                   List Initialization 
					                                                   Message Actions 
				                                                   Pushbutton: pbSvod
					                                                   Message Actions 
						                                                   On SAM_Click
							                                                   Call makeRep(REPAGG_SVOD)
				                                                   Pushbutton: pbSelected
					                                                   Message Actions 
						                                                   On SAM_Click
							                                                   Call makeRep(REPAGG_SEL)
				                                                   Pushbutton: pbSvodSelected
					                                                   Message Actions 
						                                                   On SAM_Click
							                                                   Call makeRep(REPAGG_SVOD_AND_SEL)
				                                                   Pushbutton: pbSvodAll
					                                                   Message Actions 
						                                                   On SAM_Click
							                                                   Call makeRep(REPAGG_SVOD_AND_ALL)
				                                                   Pushbutton: pbAll
					                                                   Message Actions 
						                                                   On SAM_Click
							                                                   Call makeRep(REPAGG_ALL)
				                                                   Pushbutton: pbExit
					                                                   Message Actions 
						                                                   On SAM_Click
							                                                   Call SalDestroyWindow(hWndForm )
							                                                   Set hWndDKU = hWndNULL
							                                                   Set nAvtoGen=1
				                                                   Line 
				                                                   Line 
		                                                   Contents 
			                                                   Child Table: tbl1 !! Районные Казначейства
				                                                   Contents 
					                                                   Column: Kod1
						                                                   List Values 
						                                                   Message Actions 
					                                                   Column: colDPI
						                                                   List Values 
						                                                   Message Actions 
					! Column: col5
.winattr
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? Yes
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
.end
						                                                                                                                                                            List Values
						                                                                                                                                                            Message Actions
					                                                   Column: Name1
						                                                   List Values 
						                                                   Message Actions 
					                                                   Column: ktk_name
						                                                   List Values 
						                                                   Message Actions 
					                                                   Column: colKtk
						                                                   List Values 
						                                                   Message Actions 
					                                                   Column: colid_key
						                                                   List Values 
						                                                   Message Actions 
					                                                   Column: colSab
						                                                   List Values 
						                                                   Message Actions 
				                                                   Functions 
				                                                   Window Variables 
				                                                   Message Actions 
					                                                   On SAM_Create
						! - - -  Вытяним маску территории для БОЛЬШИХ плательщиков
						! -- - 
						                                                   Call SalUseRegistry(FALSE, '')
						                                                   Call SalGetProfileString('DKU Reports', 'BigPayersMask', '', sBigPayersMask, GetIniFileName())
						! - - вычитаем параметр из таблицы params 
						! ==============================================
						! ==============================================
						                                                   Set sBigPayersMask = GetGlobalOption('KTKMASK')
								                   
						                                                   Call SalTblPopulate(tbl1, hSql(), "
								        SELECT substr(ktk, -6, 2), d.id, d.name, 
								               id_key||' - '||k.name, ktk, id_key, k.sab
								        INTO  :Kod1,  :colDPI,   :Name1, :ktk_name, :colKtk, :colid_key, :colSab
								        FROM terrdpi t, dpa d,  ktk k
								        WHERE t.kod_dpi=d.id AND k.idt = t.ktk
								                          AND substr(ktk, -6,6)= substr(k.idt, -6,2)||'0000'         
								        ORDER BY substr(ktk, length(ktk)-5,2), d.id", TBL_FillAll)
						!
						                                                   If sBigPayersMask!=''
							                                                   Call SalTblInsertRow ( tbl1, 0 )
							                                                   Call SalTblSetContext ( tbl1, 0 )
							                                                   Call SalTblSetRowFlags( tbl1, 0 ,ROW_New, FALSE)
							                                                   Set tbl1.Kod1 = sBigPayersMask
							                                                   Set tbl1.ktk_name = "ВЕЛИКІ платники районів"
							                                                   Set tbl1.colKtk = '0'
							                                                   Set tbl1.colid_key = '000'
							                                                   Call SqlPrepareAndExecute(hSql(), "SELECT kod_dpi, p.name
									                                   INTO :nIdDpi, :sNameDpi
									                                   FROM dpa p, terrdpi, ktk
									                                   WHERE kod_dpi=p.id AND ktkmask=:sBigPayersMask 
									                                         AND ktk.idt=ktk")
							                                                   Set K2s=0
							                                                   While SqlFetchNext ( hSql(), K2s )
							                                                   Set tbl1.Name1 = sNameDpi
							                                                   Set tbl1.colDPI = nIdDpi
						! - - -
						! Call SalTblInsertRow ( tbl1, 0 )
						! Call SalTblSetContext ( tbl1, 0 )
						! Call SalTblSetRowFlags( tbl1, 0 ,ROW_New, FALSE)
						! Set tbl1.Kod1 = '*'
						! Set tbl1.Name1 = '*********** ВСІ ***********'
						! Set tbl1.ktk_name ='*********** ВСІ ***********'
						! Call SalWaitCursor(FALSE)
						! ==============================================
						! ==============================================
						! ==============================================
			                                                   Custom Control: cSpltMain
				                                                   Message Actions 
		                                                   Functions 
			! Function: FU_1
				                                                     Description: Печать по ОДНОМУ или свода
				                                                     Returns 
					                                                     Number: 
				                                                     Parameters 
					                                                     String: sKod          ! - - -  sKod = ktk или =хххх
					                                                     String: sSab          ! - - -  sSab
					                                                     String: sName
					                                                     String: sId_key       ! - - id_key (влияет только на расширение файла)
					                                                     String: sKtk_Name
					                                                     String: sIsSvod       ! - - -  =0 - для зведенного   =1 для территоріального
					                                                     Number: nRepType      ! - - -  Тип отчета =0 - rpt, =1- txt? =2 -dbf
				                                                     Static Variables 
				                                                     Local variables 
					                                                     String: sXX
					                                                     Number: nTmp
					                                                     Number: nKtkLen
					                                                     Number: i
					                                                     File Handle: hFileIn
					                                                     Long String: sFileLine
					                                                     String: sFileTypeKey ! поскольку мой номер типа файла nRepType - не совпадает с типом файла в доку казны
				                                                     Actions 
					                                                     Call SalWaitCursor(TRUE)
					                                                     Set K0 = 0
					                                                     Set ID = GetUserId()
					! ================================================================
					! ============ Создаем шаблон файла =============================
					! ================================================================
					! Директория для печати
					                                                     Set strPrintPath=  GetDkuRepPath(sKod)
					! Если это 412 DBF - другая директория
					                                                     If (nPar1 = 938 or nPar1 = 937) and nRepType=2
						                                                     Call SalUseRegistry(FALSE, '')
						                                                     Call SalGetProfileString('412', 'DbfPath', strPrintPath, strPrintPath, GetIniFileName())
					                                                     If (nPar1 = 43) and nRepType=2
						                                                     Call SalUseRegistry(FALSE, '')
						                                                     Call SalGetProfileString('PF', 'DbfPath', strPrintPath, strPrintPath, GetIniFileName())
					! -- митниця --
					                                                     If nPar1=922
						                                                     Set strFileNameTxt = strPureMask || sId_key ||
								   GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 3, 2) ) )
								   ||GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 0, 2) ) ) 
								   ||'.'||SalStrMidX(strDateFrom, 9, 1) || '??'
						                                                     Set strFileNameTxt =  SalStrLeftX(strFileNameTxt,10) ||GetNextFileSess(strFileNameTxt,2,1)
					                                                     Else 
						! мои форматы 0 - RPT формат, =1 - текстовый, =2 - DBF
						! казначейские 0 - DBF 1 - текстовый,
						                                                     Set sFileTypeKey=IifS(nRepType=0, '1', IifS(nRepType=2, '0', '0'))
						                                                     Set strFileNameTxt =  strPureMask || sIsSvod
								                     || sFileTypeKey
								                     || GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 3, 2) ) )
								                     || GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 0, 2) ) ) || '?.'||sId_key
						                                                     If nPar1 = 51
							                                                     Set strFileNameRtf =  strPureMask
									                     || GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 3, 2) ) )
									                     || GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 0, 2) ) )
									                     || '000.rtf '  ! - - - а потом переименуем в  sId_key.rtf
									
						                                                     Else 
							                                                     Set strFileNameRtf =  strPureMask   || sIsSvod  ||'3'
									                   || GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 3, 2) ) )
									                   || GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 0, 2) ) ) || '?.rtf '  ! - - - а потом переименуем в  .'||sId_key
									
						                                                     Set strFileNameTxt =  SalStrLeftX(strFileNameTxt,7) ||GetNextFileSess(strFileNameTxt,1,0)||'.'||sId_key
					!
					                                                     Set strBankName = sName
					                                                     Set strBankKod = sKtk_Name
					                                                     Set sTmp = ' '
					                                                     Set SHAP = ' '
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Если это не сводная  вычислим хвост для условия WHERE  (sTmp)
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					                                                     Set nKtkLen = SalStrLength( sKod )
					!
					                                                     If SalStrScan (sKod, 'x' ) =  -1
						                                                     If nPar1 = 400 or nPar1 = 401 or  nPar1 =51
							                                                     Set sTmp = "  p.acc in (
									    SELECT acc
									    FROM specparam
									    WHERE "|| IifS(nKtkLen>6, 
									                  " ktk like '"||sKod||"')", 
									                  " substr(ktk, -6,"|| SalNumberToStrX(nKtkLen,0)|| ")  like  '"||sKod||"')" )
						                                                     Else 
							                                                     Set sTmp =  IifS(nKtkLen>6, 
									                 "  ktk like '"||sKod||"'", 
									                 "  substr(ktk, -6 ,"|| SalNumberToStrX(nKtkLen,0)|| ") like '" || sKod||"'"
									                 )
					                                                     Else 
						                                                     Set sTmp= " 1=1 " ! Для условия WHERE 
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Ведомость 2M (3411) - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					                                                     If ( nPar1 = 300 or nPar1 = 301  )
						                                                     Call VisArrayFillNumber (R,  0, 10)
						                                                     Call VisArrayFillNumber (R0, 0, 10)
						! - - - - - сжатая - - - - - - - - - - - - - - -
						                                                     If nPar1 = 301
							                                                     Set strBind='Group2mLine'
							                                                     Set sSql="
									SELECT strformatN(kekd,8,' ')||strformatN(idr,2,' ' )||strformatN( s,15,' ')||strformatN(s1,15,' ')
									FROM
									             (SELECT kekd, idr, name,  sum(s) s, sum(s1) s1
									                          FROM  tmp_dku2mg p    WHERE " || sTmp || "
									                          GROUP BY kekd, idr, name
									                          ORDER BY kekd, idr )
									INTO  :Group2mLine
									ORDER BY kekd "
							                                                     Call SqlPrepareAndExecute(hSql(), T(sSql))
							                                                     Set nCount=0
							                                                     While SqlFetchNext(hSql(),nFetchRes)
								                                                     Set nCount = nCount+1
							! - - - - - - -   развенутая 2m - - - - - - - - - - - - - - - - - - - - - -
						                                                     Else 
							                                                     Set strBind='K0,K3,K1,K2,S1,S2,S3,S4,S5,S6,S0,S,NAME'
							                                                     Set sSql ="    SELECT kekd, idr, name,  sum(s), sum(s1)
									                          INTO :K2,:K1,:NAME,:S,:S0
									                          FROM  tmp_dku2mg p    WHERE " || sTmp || "
									                          GROUP BY kekd, idr, name
									                          ORDER BY kekd, idr"
					!
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Ведомость 2M (3411, 3421) новая
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					                                                     Else If ( nPar1 = 299 OR nPar1 = 298)
						                                                     Set strBind='K0, S1,S2,S3,S4,S5,S6,S7,S8,S9,S10, SY1,SY2,SY3,SY4,SY5,SY6,SY7,SY8,SY9,SY10'
						                                                     Set sSql =" SELECT kekd, sum(sn1), sum(sn2), sum(sn3), sum(sn4),sum(sn5), sum(sn6),
								                         sum(sn7), sum(sn8), sum(sn9), sum(sn10),
								                         sum(syn1), sum(syn2), sum(syn3), sum(syn4),sum(syn5), sum(syn6),
								                         sum(syn7), sum(syn8),sum(syn9), sum(syn10)
								            INTO :K0,:S1,:S2,:S3,:S4,:S5,:S6,:S7,:S8,:S9,:S10,:SY1,:SY2,:SY3,:SY4,:SY5,:SY6,:SY7,:SY8,:SY9,:SY10
								            FROM  tmp_dku2m p  WHERE " || sTmp ||
								           " GROUP BY kekd " 
								            
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Ведомость 2M (3421) - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					                                                     Else If nPar1 = 302
						                                                     Call VisArrayFillNumber (R,  0, 10)
						                                                     Call VisArrayFillNumber (R0, 0, 10)
						                                                     Set strBind=  'K0,K3,K1,K2,S1,S2,S3,S4,S5,S6,S0,S,NAME'
						                                                     Set sSql ="
								SELECT  kekd, idr ,name, sum(s) , sum(s1)
								INTO :K2,:K1,:NAME,:S,:S0
								FROM  tmp_dku2mm p
								WHERE  " || sTmp || "
								GROUP BY kekd, idr ,name
								ORDER BY kekd, idr"
					!
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Ведомость N2 (3321) - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					                                                     Else If nPar1 = 303
						                                                     Set strBind= 'K1,S0,S,S1,S2,S3,S4,S5,S6,S7,S8,S9,S10'
						                                                     Set sSql = "
								    SELECT KEKD, sum(S),sum(SY),sum(SDR),sum(SYR),sum(SO),sum(SOY),
								           sum(SR),sum(SRY),sum(SS),sum(SSY),sum(PF),sum(PFY)
								    INTO :K1,:S0,:S,:S9,:S10,:S1,:S2,:S3,:S4,:S5,:S6,:S7,:S8
								    FROM tmp_dkuN2m p
								    WHERE  " || sTmp || "
								    GROUP BY KEKD
								    ORDER BY 1"
					!
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Ведомость N2 (3311) - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					                                                     Else If nPar1 = 200
						                                                     Set strBind = 'K0,K3,K1,K2,S1,S2,S3,S4,S5,S6,S0,S'
						                                                     Set K0 = 3311
						                                                     Set sSql = "  SELECT kekd , sum(s),  sum(sy), sum(so), sum(soy), sum(sr), sum(sry),  sum(ss), sum(ssy)
								                          INTO :K2,:S0,:S1,:S2,:S3,:S4,:S5,:S6,:S
								                          FROM  tmp_dkuN2g p
								                          WHERE " || sTmp || "
								                          GROUP BY KEKD  
								                          ORDER BY KEKD"
					!
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Реестры по ПФ и ФСС - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					                                                     Else If nPar1 = 40    !! Реестр по Фонду Соц.страха - безробіття  Держ.бюджет
						                                                     Set strBind   = 'K0,D1,NAME,S1,S0,S,SIM,NAZN, S2'
						                                                     Set SHAP = ' державного бюджету за доходами '
						                                                     Set ND    = ' ( Фонд занятості населення )'
						                                                     Set sSql="
								    SELECT sim, nam_a, okpo_a, datd, s, s_koef, s_back, nazn
								    INTO :SIM, :NAME, :S1,:D1,:S0,:S, :S2, :NAZN
								    FROM tmp_dkussg p
								    WHERE " || sTmp || "
								    ORDER BY 1,4,2,3"
					                                                     Else If nPar1 = 41    !! Реестр по Пенс.Фонду Держ.бюджет
						                                                     Set strBind   = 'K0,D1,NAME,S1,S0,S,SIM,NAZN, S2'
						                                                     Set SHAP = ' державного бюджету за доходами '
						                                                     Set ND    = ' (Пенсійний фонд)'
						                                                     Set sSql="
								    SELECT sim, nam_a, okpo_a, datd, s, s_koef, s_back, nazn
								    INTO :SIM, :NAME, :S1,:D1,:S0,:S, :S2, :NAZN
								    FROM tmp_dkupfg p
								    WHERE " || sTmp || "
								    ORDER BY 1,4,2,3"
					                                                     Else If nPar1 = 42    !! Реестр Фонду Соц.страха Держ.бюджет
						! Set strBind   = 'K0,K3,K1,K2,NAME,D1,S1,S2,S3,S0,S4,S5,S6,D2,SIM,NAZN,REF'
						                                                     Set strBind   = 'K0,D1,NAME,S1,S0,S,SIM,NAZN, S2'
						                                                     Set SHAP = ' державного бюджету за доходами '
						                                                     Set ND    = ' ( Фонд соціального страхування )'
						! !
						                                                     Set sSql="
								    SELECT sim, nam_a, okpo_a, datd, s, s_koef, s_back,nazn
								    INTO :SIM, :NAME, :S1,:D1,:S0,:S,:S2, :NAZN
								    FROM tmp_dkussg p
								    WHERE " || sTmp || "
								    ORDER BY 1,4,2,3"
					! !! устарело
					! Else If nPar1 = 43    !! Реестр по Пенс.Фонду Місц.бюджет
						                                                                                                                     Set strBind   = 'K0,D1,NAME,S1,S0,S,SIM,NAZN, S2'
						                                                                                                                     Set SHAP = ' місцевого бюджету за доходами '
						                                                                                                                     Set ND    = ' (Пенсійний фонд)'
						                                                                                                                     Set sSql="
								    SELECT sim, nam_a, okpo_a, datd, s, s_koef, s_back,nazn
								    INTO :SIM, :NAME, :S1,:D1,:S0,:S, :S2, :NAZN
								    FROM tmp_dkupfm p
								    WHERE  " || sTmp || "
								    ORDER BY 1,4,2,3"
					                                                     Else If nPar1 = 43    !! Реестр по Пенс.Фонду Місц.бюджет
						                                                     Set strBind   = 'K0,D1,NAME,S1,S0,S,SIM,NAZN,S2'
						                                                     Set SHAP = ' місцевого бюджету за доходами '
						                                                     Set ND    = ' (Пенсійний фонд)'
						                                                     Set sSql="SELECT SIM,MFOA,NLSA,OKPO_A,NAM_A,MFOB,NLSB,
								                 OKPO_B,NAM_B,VOB,ND,DATD,DATP,S,S_KOEF,S_BACK,NAZN
								            INTO :SIM,:MFOA,:NLSA,:S1,:NAME,:MFOB,:NLSB,
								                 :OKPO_B,:NAM_B,:vob,:NOM,:D1,:D2,:S0,:S,:S2,:NAZN
								            FROM tmp_dkupfm p
								           WHERE "|| sTmp ||" ORDER BY SIM,DATD,NAM_A,OKPO_A"
					                                                     Else If nPar1 = 44    !! Реестр Фонду Соц.страха Місц.бюджет
						                                                     Set strBind   = 'K0,D1,NAME,S1,S0,S,SIM,NAZN,S2'
						                                                     Set SHAP = ' місцевого бюджету за доходами '
						                                                     Set ND    = ' ( Фонд соціального страхування )'
						                                                     Set sSql="SELECT sim, nam_a, okpo_a, datd, s, s_koef, s_back,nazn
								            INTO :SIM, :NAME, :S1,:D1,:S0,:S, :S2, :NAZN
								            FROM tmp_dkussm p
								           WHERE " || sTmp ||" ORDER BY 1,4,2,3"
					!
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - - 412 (МБ/ДБ) - - - - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					                                                     Else If nPar1 = 62 or nPar1 = 938  !! 412 - ДБ (txt+dbf)
						!
						                                                     Set strBind = 'K0,K3,K2,S0,S1,S2,S3,S4,K0s,K1s,K2s,K3s,S5'
						                                                     Set sSql = "
								    SELECT p.GR, p.KVK, p.S230, p.KEKD,Sum(p.DD),Sum(p.YYYY)
								    INTO :K3,:K3s,:K2s,:K2,:S1,:S2
								    FROM tmp_dku412g p WHERE " || sTmp || "
								    GROUP BY GR,KVK,S230,KEKD
								    ORDER BY GR,KVK,S230, KEKD"
					                                                     Else If nPar1 = 63   or nPar1 = 937  !! 412 - МБ (txt+dbf)
						                                                     Set strBind = 'K0,K3,K2,S0,S1,S2,S3,S4,K0s,K1s,K2s,K3s,S5'
						                                                     Set sSql = "
								    SELECT p.GR,p.KVK,p.S230,p.KEKD,Sum(p.DD),Sum(p.YYYY)
								    INTO :K3,:K3s,:K2s,:K2,:S1,:S2
								    FROM tmp_dku412m p
								    WHERE  " || sTmp || "
								    GROUP BY p.GR,p.KVK,p.S230,p.KEKD
								    ORDER BY p.GR,p.KVK,p.S230,p.KEKD"
					!
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - - - выписки (+ без информационных 939, 940) - - - - - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					                                                     Else If (nPar1>=411 and nPar1<=414) or (nPar1>=939 and nPar1<=940)
						                                                     Set strBind = 'ACC,NLS,KV,ISO,FDAT,S,ND,MFO,NLSK, NAMK,' ||
								    'USI,REF,RNK,NAZN,OSTF,TT,DAPP,SK,OKPO,NB,VOB,DATP,NMK,NMS'
						                                                     Set sSql = "
								    SELECT p.isp,p.nls,p.kv,p.nms,p.acc,p.fdat,
								           p.s/100,p.nd,p.mfo,p.nlsk,p.namk,p.userid,
								           p.ref,p.sk,p.nazn,p.tt,p.ostf/100,p.dapp,
								           p.okpo,p.nb,p.vob,p.datp, m.nmk, m.rnk, s.fio
								    INTO :ISP,:NLS,:KV,:NMS,:ACC,:FDAT,:S,:ND,:MFO,
								         :NLSK,:NAMK,:USI,:REF,:SK,:NAZN,:TT,:OSTF,:DAPP,
								         :OKPO,:NB,:VOB,:DATP,:NMK,:RNK, :FIO
								    FROM cust_acc c, customer m, staff s, "
						                                                     If nPar1 = 411      !! Виписки з рахунків(MБ)-доходи
							                                                     Set sSql = sSql||" tmp_dkuvpm  "
						                                                     Else If nPar1 = 412 !! Виписки з рахунків(ДБ)-доходи
							                                                     Set sSql = sSql||" tmp_dkuvpg "
						                                                     Else If (nPar1 = 413 or nPar1 = 939)!! Виписки з рахунків(ДБ)-всі
							                                                     Set sSql = sSql||" tmp_dkuvpg "
						                                                     Else If (nPar1 = 414 or nPar1 = 940)!! Виписки з рахунків(МБ)-всі
							                                                     Set sSql =  sSql||" tmp_dkuvpm "
						!
						                                                     Set sSql =  sSql||" p  WHERE p.acc=c.acc AND c.rnk=m.rnk AND s.id=p.isp AND "  ||  sTmp ||  "
								    ORDER BY 2,3, 6,7, nvl(p.bis, 0) "
					                                                     Else If nPar1 = 51    !! Реестр №1 (Гос.Бюджет)                                                                !! Реєстр № 1
						                                                     Set K0 = 0
						                                                     Set strBind ='K0,K3,S6,TNAME,K1,K2,D1,NAME,S1,S2,S3,S0,S4,S5,D2,REF,TT'
						  Set sSql = "
								 SELECT substr('0000' || p.kekd,-8,4),p.kekd,
								        l.ref,l.tt,o.nd,o.datd,o.id_a,o.mfoa,o.nlsa,
								        decode(l.dk,0,l.s,0),decode(l.dk,1,l.s,0),
								        d.id,d.name
								 INTO :K2,:K1,:REF,:TT,:NAME,:D2,:K3,:S2,:S3,:S0,:S1,:S6,:TNAME
								 FROM opl l, specparam p, oper o, terrdpi t, dpa d
								 WHERE l.fdat= :sFdat  AND substr(l.nls,1,4) IN
								       ('6511','6112','6513','6211','6411','7113') AND
								       t.ktk=p.KTK AND d.id=t.kod_dpi AND
								       l.acc=p.acc AND l.ref=o.ref AND
								       l.sos=5 AND" || sTmp || "
								 ORDER BY d.id,p.kekd"
					!
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - - - Митниця - - - - - - - - - - - - - -
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					                                                     Else If ( nPar1 = 920  or nPar1 = 922 )  !! 
						                                                     Set sSql = "
								SELECT decode(srt, '0', lpadchr(mfo, '0', 9)||rpad(nls,14)
								||'UAH'||to_CHAR(fdat,'YYYYMMDD')||nvl(to_char(dapp,'YYYYMMDD'),'        ')
								||lpad( to_char(ostf),19)||'                  0'||decode(sign(ostf),-1, '-','+')
								||lpad(to_char(bis),6)||lpad(to_char(dos),19)||'                  0'
								||lpad(to_char(s),6)||lpad(to_char(kos),19)||'                  0'
								||lpad(to_char(ostf+kos-dos),19)||'                  0'
								||decode(sign(ostf+kos-dos),-1, '-','+')
								||rpad(nvl(okpo,'              '),14)
								                    ||rpad(namk,38)
								                    ||rpad(nms,60),
								            decode(dk,0,'-','+')
								            ||lpadchr(mfo, '0', 9)
								            ||rpad(decode(dk,0,'0',nlsk),14)
								            ||rpad( nvl(okpo,'              '),14)
								            ||rpad(namk,40)
								            ||lpadchr(mfo2,'0',9)
								            ||rpad(decode(dk,1,'0',nlsk) ,14)
								            ||rpad(nvl(okpo2,'              '),14)
								            ||rpad(namk2,40)
								            ||lpad(nvl(vob,0),2)
								            ||lpad(nvl(nd,' '),10)   
								            ||lpad(to_char((sign(s))*s),19)
								            ||'                  0'
								            ||to_char(datp,'YYYYMMDDHH24MI') 
								            ||nvl( to_char(pdat,'YYYYMMDDHH24MI'), '            ') )
								            ||rpad(nazn,255) 
								        INTO  :sFileLine
								FROM tmp_dkuvpg
								WHERE "  || sTmp || 
								" order by fdat, nls, srt" 
					!
					                                                     Else 
						                                                     Return 0
					!
					                                                     Set sTmp = ''
					! ! ==================================================
					! ! Начинаем печать в отчет
					! ! ==================================================
					! - - - - предварителььно установим принтер  - Установка єтого принтера как default  нужна лишь для того чтоб
					! - - - -  при формировании текстового отчета  -  были нормальные параметры вывода
					                                                     Set strInput = strBind
					                                                     Call SalWaitCursor ( TRUE )
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - - - Будем учитывать сколько записей выбралось в отчет, если не выбралось ничего  - будем
							! - - - - удалять эти файлы
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					                                                     Set nCou  = 0
					                                                     Set nInd = 0
					! Call SalPrtGetDefault ( sDeviceDef, sDriverDef, sPortDef )
					! Call Debug(' Default Printer:'||sDeviceDef||' : '||sDriverDef||' : '||sPortDef||PutCrLf()||
							           ' ReportFileNme='||strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt)||
							           '  TemplateName='||strTmplPath   )
					! Файл по шаблону RPT
					                                                     If nRepType  = 0 
						                                                     Call SaveInfoToLog('REP_DKU: Перед формированием файла '||strFileNameTxt)
						                                                     Call SalReportPrintToFile(hWndForm,
								           strTmplPath,
								           strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
								           strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
						                                                     Call SaveInfoToLog('REP_DKU: После формирования файла '||strFileNameTxt)
						                                                     If (nInd >4 )
							                                                     Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )
							! Call SalPrtSetDefault(sDeviceDef, sDriverDef, sPortDef)
							                                                     Call SalWaitCursor ( FALSE )
							                                                     Return -1
						! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
						! - - - -  - -  выбрали ли в файл отчета что-то - если нет - удалим этот файл
						! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
						                                                     If (nCou = 0 and  VisFileFind(strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt))  )! - - в отчет не было выбрано не одной записи
							                                                     If VisFileDelete (strPrintPath ||'\\'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt) ) < 0
								                                                     Call SalMessageBox('Не могу удалить файл нулевой длинны - '||strPrintPath ||'\\'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),'Внимание',0)
								                                                     Call SalWaitCursor ( FALSE )
								                                                     Return -1
							                                                     Call SalWaitCursor ( FALSE )
							                                                     Return -1
						! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
						! - - если это word формат - переименуем файл
						! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
						                                                     If FL_FORMAT
							                                                     If nPar1 = 51
								                                                     If VisFileRename (strPrintPath ||'\\'|| strFileNameRtf, strPrintPath ||'\\'||  SalStrLeftX(strFileNameRtf,5)||sId_key||'.rtf'  )<0
									                                                     Call SalMessageBox('Не могу переименовать файл - '||strPrintPath ||'\\'|| strFileNameRtf,  'Внимание', 0)
									                                                     Call SalWaitCursor ( FALSE )
									                                                     Return -1
							                                                     Else 
								                                                     If VisFileRename (strPrintPath ||'\\'|| strFileNameRtf, strPrintPath ||'\\'||  SalStrLeftX(strFileNameRtf,9)|| sId_key)<0
									                                                     Call SalMessageBox('Не могу переименовать файл - '||strPrintPath ||'\\'|| strFileNameRtf,  'Внимание', 0)
									                                                     Call SalWaitCursor ( FALSE )
									                                                     Return -1
						! ANNY!!!!!
						                                                     If not FL_FORMAT
							                                                     Call SaveInfoToLog('REP_DKU: Начало обработки '|| strFileNameTxt)
							                                                     Call zarezDKU(  strPrintPath ||'/'|| strFileNameTxt)
							                                                     Call SaveInfoToLog('REP_DKU: Конец обработки '|| strFileNameTxt)
					! Файл текстотвый
					                                                     Else If nRepType  = 1
						                                                     If not  SalFileOpen ( hFileIn,strPrintPath||'\\'||strFileNameTxt, OF_Write )
							                                                     Call SalMessageBox(' Невозможно открыть для записи файл '|| strPrintPath||'\\'||strFileNameTxt, 'Внимание!',0)
							                                                     Call SalWaitCursor (FALSE )
							                                                     Return -1
						                                                     Else 
							                                                     If SqlPrepareAndExecute(hSql(), T(sSql) )
								                                                     Set nTmp=0
								                                                     Set i=0
								                                                     While SqlFetchNext(hSql(), i)
									                                                     Call SalFilePutStr ( hFileIn,  sFileLine )
									                                                     Set nTmp=nTmp+1
							                                                     If not SalFileClose ( hFileIn )
								                                                     Call SalMessageBox(' Не возможно закрыть файл '||strPrintPath||'\\'||strFileNameTxt, 'Внимание!',0)
								                                                     Call SalWaitCursor (FALSE )
								                                                     Return -1
							! -- если данных нету - удалить файл
							                                                     If ( nTmp=0 and VisFileFind(strPrintPath||'/'||strFileNameTxt))
								                                                     If VisFileDelete (strPrintPath||'\\'||strFileNameTxt) < 0
									                                                     Call SalMessageBox('Не могу удалить файл нулевой длинны - '||strPrintPath||'\\'||strFileNameTxt,'Внимание',0)
									                                                     Call SalWaitCursor ( FALSE )
									                                                     Return -1
							!
					! DBF формат
					                                                     Else If nRepType  = 2 
						! Поставим расширение файла - DBF(потом переименуем)
						! Создавать и населять файлы будем в директории PrnDir(), а затем помещать их в директории по территориям
						!
						                                                     If nPar1 = 43    !! Реестр по Пенс.Фонду Місц.бюджет
							! Set strFileNameTxt = SalStrLeftX(strFileNameTxt,SalStrLength(strFileNameTxt)-4)||'.DBF'
							                                                     Set strFileNameTxt = SalStrLeftX(strFileNameTxt,SalStrLength(strFileNameTxt)-4)||sId_key||'.DBF'
							                                                     Call VisFileCopy( strPrintPath||"\\pf.dbf", strPrintPath||'\\'||strFileNameTxt) 
							! Call Debug(strPrintPath||"\\pf.dbf"||'->'|| strPrintPath||'\\'||strFileNameTxt)
						                                                     Else 
							                                                     Set strFileNameTxt = SalStrLeftX(strFileNameTxt,SalStrLength(strFileNameTxt)-4)||sId_key||'.DBF'
							                                                     Call VisFileCopy( strPrintPath||"\\ft.dbf", strPrintPath||'\\'||strFileNameTxt) 
						! Скопируем шаблон ft.dbf в имя нашего файла
						!
						! Соединения hSqlA было инициализировано в функе Make_DKuRep
						! Во внутреннем поле "KO" для 412 должно стоять значение KOBL_412, а не AREACODE
						                                                     If SalStrScan (sKod, 'x' ) >= 0
							                                                     Set sId_key = GetGlobalOption('KOBL_412')
						! Счетик строк. (Если нету строк вообще - удаляем файл) 
						                                                     Set nTmp=0
						                                                     If SqlPrepareAndExecute(hSql(), T(sSql) )
							                                                     Set dTmp=SalFmtFormatStrDateTime(strDateFrom,'dd-MM-yyyy') 
							                                                     If nPar1 = 43
								                                                     Set sSql=" INSERT INTO "||SalStrLeftX(strFileNameTxt,SalStrLength(strFileNameTxt)-4)||
										"(DK,MFOA,NLSA,OKPO_A,NAM_A,MFOB,NLSB,OKPO_B,NAM_B,VOB,ND,S,DATD,DATP,NAZN)VALUES
										 (:DK,:MFOA,:NLSA,:OKPO_A,:NAM_A,:MFOB,:NLSB,:OKPO_B,:NAM_B,:vob,:NOM,:S,:D1,:D2,:NAZN) "
								                                                     While SqlFetchNext(hSql(), i)
									                                                     Set nTmp=nTmp+1
									! Set RN[0]=Str(K3)  ! группа
									! Set RN[1]=StrToStrFormat(Str(K2s),3,'0',TRUE) ! символ s230
									                                                     Set DK = IifS(S>=0,'+','-')
									                                                     Set OKPO_A=Str(S1)
									                                                     Set S=Abs(S)
									                                                     Set NAM_A=StrWinToDosX(NAME)
									                                                     Set NAM_B=StrWinToDosX(NAM_B)
									                                                     Set NAZN=StrWinToDosX(NAZN)
									                                                     If not SqlPrepareAndExecute(hSqlA, sSql)
										! Call Debug(strPrintPath||'\\'||strFileNameTxt)
										                                                     Call SalMessageBox(' Невозможно вставить строку в файл '|| strPrintPath||'\\'||strFileNameTxt, 'Внимание!',0)
										                                                     Call SalWaitCursor (FALSE )
										                                                     Return -1
							                                                     Else 
								                                                     Set sSql=" INSERT INTO "||SalStrLeftX(strFileNameTxt,SalStrLength(strFileNameTxt)-4)||"(DT,KO,GR,S230,KOD,T060,T020)  VALUES( :dTmp,:sId_key,:RN[0],:RN[1],:RN[2],:S1,:S2) "
								                                                     While SqlFetchNext(hSql(), i)
									                                                     Set nTmp=nTmp+1
									                                                     Set RN[0]=Str(K3)  ! группа
									                                                     Set RN[1]=StrToStrFormat(Str(K2s),3,'0',TRUE) ! символ s230
									                                                     Set RN[2]=Str(K2)  ! KEKD
									                                                     If not SqlPrepareAndExecute(hSqlA, sSql)
										! Call Debug(strPrintPath||'\\'||strFileNameTxt)
										                                                     Call SalMessageBox(' Невозможно вставить строку в файл '|| strPrintPath||'\\'||strFileNameTxt, 'Внимание!',0)
										                                                     Call SalWaitCursor (FALSE )
										                                                     Return -1
						! -- если данных нету - удалить файл
						                                                     If ( nTmp=0 and VisFileFind(strPrintPath||'\\'||strFileNameTxt))
							                                                     If VisFileDelete (strPrintPath||'\\'||strFileNameTxt) < 0
								                                                     Call SalMessageBox('Не могу удалить файл нулевой длинны - '||strPrintPath||'\\'||strFileNameTxt,'Внимание',0)
								                                                     Call SalWaitCursor ( FALSE )
								                                                     Return -1
						                                                     Call SqlCommit(hSqlA)
						                                                     Set nCouDBFFilesToRename=nCouDBFFilesToRename+1
						                                                     Set strDBFFilesToRename[nCouDBFFilesToRename-1]= SalStrLeftX(strFileNameTxt,SalStrLength(strFileNameTxt)-4)
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					! - - Посылаем сообщение чтоб перечитался список файлов для новой директории
					! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
					                                                     Set frm_Out.dfPath = strPrintPath
					                                                     Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
					                                                     Call SalWaitCursor(FALSE)
					                                                     Return nInd
			! Function: GetDkuRepPath
				                                                     Description: Возваращает путь к ящикам казначейств
				                                                     Returns 
					                                                     String: 
				                                                     Parameters 
					                                                     String: sKtk
				                                                     Static Variables 
				                                                     Local variables 
					                                                     String: sTmp
				                                                     Actions 
					                                                     Set strPrintPath = GetPrnDir()
					                                                     Call SalUseRegistry(FALSE, '')
					                                                     Call SalGetProfileString('DKU Reports', 'OutBoxPath', strPrintPath, sTmp, GetIniFileName())
					                                                     If SalStrUpperX(sTmp) != SalStrUpperX('None')
						! - - -Если это своодная
						                                                     If sKtk='x'
							                                                     Set sTmp =  sTmp || '\\' ||'00xx'
						! - - -Если это НЕ своодная
						                                                     Else 
							! - - если KTK это маска
							                                                     If SalStrScan(sKtk,'\\_') > 0
								                                                     Set sTmp =  sTmp || '\\' ||'00bp'
							                                                     Else 
								                                                     Set sTmp =  sTmp || '\\' ||'00'||SalStrLeftX (sKtk, 2)
					                                                     Else 
						                                                     Set sTmp = strPrintPath
					                                                     If not VisDosExist(sTmp)
						                                                     If not SalFileCreateDirectory(sTmp)
							                                                     Call SalMessageBox('Не могу создать каталог:' || sTmp, 'Внимание', MB_IconStop)
							                                                     Return GetPrnDir()
					                                                     Return sTmp
			! Function: GetNextFileSess
				                                                     Description: Дает новое расширение (сеанс файла)
				                                                     Returns 
					                                                     String: 
				                                                     Parameters 
					                                                     String: strFileName 
					                                                     Number: nValLen
					                                                     Number: nStart
				                                                     Static Variables 
				                                                     Local variables 
					                                                     String: strRet
					                                                     String: strTmp
					                                                     Number: nTmp
					                                                     String: strFileList[*]
					                                                     Number: i
					                                                     Number: nFiles
					                                                     Number: nMaxNum
					                                                     Number: nStartPos
				                                                     Actions 
					                                                     Set nFiles=VisDosEnumFiles( strPrintPath || '\\' || strFileName, FA_Standard, strFileList)
					                                                     If nFiles < 0
						                                                     Return NumberToStrFormat(nStart, nValLen,'0')
					                                                     Set i=1
					                                                     Set strTmp='?'
					                                                     While i<nValLen
						                                                     Set strTmp = strTmp||'?'
						                                                     Set i=i+1
					                                                     Set nMaxNum=0
					                                                     Set i=0
					                                                     Set nStartPos=SalStrScan(strFileName, strTmp)
					                                                     While i <= nFiles -1
						                                                     Set nTmp = SalStrToNumber(    SalStrMidX(strFileList[i],  nStartPos, nValLen  ) )
						                                                     If (  nTmp > nMaxNum )
							                                                     Set nMaxNum =nTmp
						                                                     Set i=i+1
					                                                     Return NumberToStrFormat(nMaxNum+1, nValLen,'0')
			! Function: Prepare_DkuRep
				                                                     Description: ! - - тут подготавливаются временные таблицы для отчетности DKU
				                                                     Returns 
					                                                     Number: nRet
				                                                     Parameters 
					                                                     Number: nPar1
				                                                     Static Variables 
				                                                     Local variables 
					! String: strRBSName
				                                                     Actions 
					                                                     Set ID = GetUserId()
					                                                     Call SalWaitCursor(TRUE)
					                                                     Call SaveInfoToLog('REP_DKU: Начало накопления временной таблицы')
					! - - - - - - для выписок населим сначала tmp_lic
					                                                     If (nPar1>=411 and nPar1<=414) or (nPar1>=939 and nPar1<=940)
						                                                     If nPar1 = 411              ! - - - МБ (доходы)
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, 'DKZ', "vpm") ! накопление во  временные таблицы
						                                                     If nPar1 = 412              ! - - - ДБ (доходы)
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, 'DKZ', "vpg") ! накопление во  временные таблицы
						                                                     If nPar1 = 413              ! - - - ДБ  (ВСЕ)
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '%', "vpg") ! накопление во  временные таблицы
						                                                     If nPar1 = 414              ! - - - МБ (ВСЕ)
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '%', "vpm") ! накопление во  временные таблицы
						                                                     If nPar1 = 939              ! - - - ДБ (ВСЕ - без информационных)
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '%&i', "vpg") ! накопление во  временные таблицы
						                                                     If nPar1 = 940              ! - - - МБ (ВСЕ - без информационных)
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '%&i', "vpm") ! накопление во  временные таблицы
					!
					! - - для 412(txt and dbf)
					                                                     If nPar1 = 63  or nPar1 = 62  or  nPar1 = 937  or nPar1 = 938
						! - - ( МБ)
						                                                     If nPar1 = 63  or  nPar1 = 937
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '1', "412") ! накопление во  временные таблицы
						! - - ( ДБ)
						                                                     Else 
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '0', "412") ! накопление во  временные таблицы
						! Если это DBF - создать шаблон файла назначить струтуру файла
						                                                     If nPar1 = 937  or nPar1 = 938
							                                                     Set strDBFStruct = " (DT   DATE,
									                      KO   CHAR(3),
									                      GR   CHAR(1),
									                      S230 CHAR(3),
									                      KOD  CHAR(8),
									                      T060 NUMBER(16),
									                      T020 NUMBER(16) )"
					!
					! Ведомость на N2
					                                                     If nPar1 = 303 or nPar1 =  200
						                                                     If nPar1 = 303
							! - - - - 3321
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '*', "N2m") ! накопление во  временные таблицы
						                                                     If nPar1 =  200
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '*', "N2g") ! накопление во  временные таблицы
					!
					! Ведомость 2M
					                                                     If nPar1 = 300  or  nPar1 = 301 or  nPar1 = 302
						                                                     Call SqlPrepareAndExecute(hSql(),'SELECT idr,name INTO :nTmp,:sSql FROM PEREKR_R')
						                                                     While SqlFetchNext(hSql(),nFetchRes)
							                                                     If nTmp>0 AND nTmp<=10
								                                                     Set RN[nTmp]=sSql
						                                                     Call VisArrayFillNumber (R,  0, 10)
						                                                     Call VisArrayFillNumber (R0, 0, 10)
						! - - - госс бюдж.
						                                                     If nPar1 = 300  
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '0', "2m") ! накопление во  временные таблицы
						                                                     If nPar1 = 301
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '0', "2m") ! накопление во  временные таблицы
						! - - - местн бюдж.
						                                                     If nPar1 = 302
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '1', '2m') ! накопление во  временные таблицы
					!
					! Ведомость 2M - новая
					                                                     If nPar1 = 299 or nPar1 = 298 
						! госс  бюджет
						                                                     If nPar1 = 299
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '3411', "2mn") 
						! местный бюджет
						                                                     Else 
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '3421', "2mn") 
					!
					! ! - - -ПФ - ФСС
					                                                     If nPar1 >= 40 and  nPar1 <= 44
						                                                     If nPar1 = 41    !! Реестр по Пенс.Фонду Держ.бюджет         
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '3411_3', "sspf") ! накопление во  временные таблицы
						                                                     Else If nPar1 = 42    !! Реестр Фонду Соц.страха Держ.бюджет 
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '3411_4', "sspf") ! накопление во  временные таблицы
						                                                     Else If nPar1 = 43    !! Реестр по Пенс.Фонду Місц.бюджет    
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '3421_3', "sspf") ! накопление во  временные таблицы
							                                                     Set strDBFStruct = " (
									  DK      CHAR(1),  
									  MFOA    CHAR(9),
									  NLSA    CHAR(14),
									  OKPO_A  CHAR(14),
									  NAM_A   CHAR(40),
									  MFOB    CHAR(9),
									  NLSB    CHAR(14),
									  OKPO_B  CHAR(14),
									  NAM_B   CHAR(40),
									  VOB     CHAR(2),
									  ND      CHAR(10),
									  S       NUMBER(19),
									  DATD    DATE,
									  DATP    DATE,
									  NAZN    CHAR(160)
									) "
						                                                     Else If nPar1 = 44    !! Реестр Фонду Соц.страха Місц.бюджет 
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '3421_4', "sspf") ! накопление во  временные таблицы
						                                                     Else If nPar1 = 40    !! Реестр Фонду Соц. страха Безробіття  Держ. Бюджет 
							                                                     Call Podgot_DKU(ID, sFdat, sFdat, '3411_5', "sspf") ! накопление во  временные таблицы
					!
					! ! - - - Митниця
					                                                     If nPar1 = 920 or nPar1 = 922
						                                                     Call Podgot_DKU(ID, sFdat, sFdat2, '%', "mv") ! накопление во  временные таблицы
					! In preparing
					                                                     Call SaveInfoToLog('REP_DKU: Конец накопления временной таблицы')
					                                                     Return 1
			! Function: UnPrepare_DkuRep
				                                                     Description: ! - - тут очищаюся (вернее делатся rollback для временных таблиц
				                                                     Returns 
					                                                     Number: nRet
				                                                     Parameters 
					                                                     Number: nPar1
				                                                     Static Variables 
				                                                     Local variables 
				                                                     Actions 
					!
					! - - для 412 - - - - - - - - - - - - -
					! If nPar1 = 63  or nPar1 = 62
					! Call UnPrepare_412()
					!
					                                                     Return 1
			! Function: Prepare_Rep_InCreate
				                                                     Description: ! - - фактически это все действия которые выполняюся при создании формы frm_DKU - вынесено для автосоздания отчетов
						! - - так как при следующем отчете (из списка выбранных ) эта форма не создается заново
				                                                     Returns 
				                                                     Parameters 
					                                                     Number: nPar1
				                                                     Static Variables 
				                                                     Local variables 
				                                                     Actions 
					                                                     If nPar1 = 400 or nPar1 = 401
						                                                     Set maska = '3%'
						                                                     Set ID = GetUserId()
						                                                     Call SalWaitCursor(TRUE)
						                                                     Call Podgot_LICS(ID, sFdat, sFdat, maska, 20) ! накопление во
								                                            ! временные
								                                            ! таблицы
						                                                     Call SalWaitCursor(FALSE)
			! Function: Make_ReportFiles
				                                                     Description: Функция после подготовки временных таблиц - режит на файлы
				                                                     Returns 
				                                                     Parameters 
					                                                     Number: nFormat
					                                                     Number: nType
				                                                     Static Variables 
				                                                     Local variables 
				                                                     Actions 
					! ====================================
					! == Если формат DBF - подготовить файл
					! ====================================
					                                                     If nFormat=2
						! установим текущую директорию (все заточеноо под 412 и PF)
						                                                     Call SalUseRegistry(FALSE, '')
						                                                     If nPar1 = 43
							                                                     Call SalGetProfileString('PF', 'DbfPath', strPrintPath, strPrintPath, GetIniFileName())
						                                                     Else 
							                                                     Call SalGetProfileString('412','DbfPath', strPrintPath, strPrintPath, GetIniFileName())
						                                                     If not SalFileSetCurrentDirectory(strPrintPath)
							                                                     Call SalMessageBox(' Невозможно установить директорию '|| strPrintPath||' текущей ', 'Внимание!',0)
							                                                     Call SalWaitCursor (FALSE )
							                                                     Return -1
						                                                     Set SqlDatabase = 'dBase_Files'
						                                                     If not SqlConnect(hSqlA)
							                                                     Call SalMessageBox(' Невозможно установить соединение с dBase_Files ', 'Внимание!',0)
							                                                     Call SalWaitCursor (FALSE )
							                                                     Return -1
						                                                     If nPar1 = 43
							                                                     If not VisFileFind(strPrintPath||"\\pf.dbf ") 
								                                                     Call SqlPrepareAndExecute(hSqlA, "CREATE TABLE " || strPrintPath||"\\pf.dbf "||strDBFStruct)
							                                                     Set nCouDBFFilesToRename=0
						                                                     Else 
							                                                     If not VisFileFind(strPrintPath||"\\ft.dbf ") 
								                                                     Call SqlPrepareAndExecute(hSqlA, "CREATE TABLE " || strPrintPath||"\\ft.dbf "||strDBFStruct)
							                                                     Set nCouDBFFilesToRename=0
					! ====================================
					! == Выполним собственно отчет
					! ====================================
					! ------ Сводная-----------
					                                                     If nType = 1 or nType = 4 or nType = 5
						                                                     Call FU_1( 'x', GetBankSab(),GetBankName() , GetGlobalOption('AREACODE')||'00' , '','2',nFormat)
					! ------ Выбранные или Все--------
					                                                     If nType > 1 
						                                                     If nType = 3 or nType=5 !-- Все
							                                                     If nLevel >= 1
								                                                     Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, TRUE, 0, 0)
								! Call SalTblSetRowFlags(tbl1, 0, ROW_Selected, FALSE)
							                                                     If nLevel >= 2
								                                                     Call SalTblSetFlagsAnyRows(frm_RegPart.tblRada, ROW_Selected, TRUE, 0, 0)
								! Call SalTblSetRowFlags(frm_RegPart.tblRada, 0, ROW_Selected, FALSE)
							                                                     If nLevel >= 3
								                                                     Call SalTblSetFlagsAnyRows(frm_RegPart.tblSelo, ROW_Selected, TRUE, 0, 0)
							                                                     Set nTmp = 0
						                                                     Else 
							                                                     Set nTmp = ROW_Selected
						!
						! -- по районам
						                                                     If nLevel >= 1 
							                                                     Set nTmp = ROW_Selected
							                                                     Set nRow = TBL_MinRow
							                                                     While SalTblFindNextRow(tbl1, nRow, nTmp, 0)
								                                                     Call SalTblSetContext(tbl1, nRow)
								                                                     Call FU_1(tbl1.Kod1, tbl1.colSab, tbl1.Name1, tbl1.colid_key, tbl1.ktk_name,'0',nFormat)
						! -- по сельским радам
						                                                     If nLevel >= 2 
							                                                     Set nTmp = ROW_Selected
							                                                     Set nRow = TBL_MinRow
							                                                     While SalTblFindNextRow(frm_RegPart.tblRada, nRow, nTmp, 0)
								                                                     Call SalTblSetContext(frm_RegPart.tblRada, nRow)
								                                                     Call FU_1(frm_RegPart.tblRada.Kod1, frm_RegPart.tblRada.colSab, frm_RegPart.tblRada.Name1,  frm_RegPart.tblRada.colid_key, frm_RegPart.tblRada.ktk_name, frm_RegPart.tblRada.colIsSvod,nFormat )
						! -- по селам
						                                                     If nLevel >= 3 
							                                                     Set nTmp = ROW_Selected
							                                                     Set nRow = TBL_MinRow
							                                                     While SalTblFindNextRow(frm_RegPart.tblSelo, nRow, nTmp, 0)
								                                                     Call SalTblSetContext(frm_RegPart.tblSelo, nRow)
								                                                     If nRow >= 0
									                                                     Call FU_1(frm_RegPart.tblSelo.Kod1, frm_RegPart.tblSelo.colSab, frm_RegPart.tblSelo.Name1, frm_RegPart.tblSelo.colid_key, frm_RegPart.tblSelo.ktk_name,'1',nFormat )
						!
						! ----
						                                                     If nType = 3 or nType=5
							                                                     If nLevel >= 1
								                                                     Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, FALSE, 0, 0)
							                                                     If nLevel >= 2
								                                                     Call SalTblSetFlagsAnyRows(frm_RegPart.tblRada, ROW_Selected, FALSE, 0, 0)
							                                                     If nLevel >= 3
								                                                     Call SalTblSetFlagsAnyRows(frm_RegPart.tblSelo, ROW_Selected, FALSE, 0, 0)
						!
						!
					! ------ Если это dbf - переименовать(для того что б не делать для каждого файла connect) -----
					                                                     If nFormat=2
						                                                     Call SqlDisconnect(hSqlA)
						                                                     Set nRet=0
						                                                     While nRet < nCouDBFFilesToRename
							                                                     If VisFileFind(strPrintPath||'\\'||strDBFFilesToRename[nRet]||'.DBF')
								                                                     If VisFileRename(strPrintPath||'\\'||strDBFFilesToRename[nRet]||'.DBF', 
										                 strPrintPath||'\\'||SalStrLeftX(strDBFFilesToRename[nRet],SalStrLength(strDBFFilesToRename[nRet])-3)||'.'||SalStrRightX(strDBFFilesToRename[nRet],3)) < 0
									                                                     Call SalMessageBox(' Невозможно переименовать ', 'Внимание!',0)
									                                                     Call SalWaitCursor (FALSE )
									                                                     Return -1
							                                                     Set nRet=nRet+1
					!
			! Function: KtlLike
				                                                     Description: Сравнивает, попадает ли даное sKtk под маску sKtkMask
				                                                     Returns 
					                                                     Boolean: bIsLike_
				                                                     Parameters 
					                                                     String: sKtk
					                                                     String: sKtkMask
				                                                     Static Variables 
				                                                     Local variables 
					                                                     Number: i
					                                                     Boolean: bIsLike
				                                                     Actions 
					                                                     Set i=0
					                                                     Set bIsLike=TRUE
					                                                     While i<SalStrLength(sKtkMask)
						                                                     If SalStrMidX ( sKtkMask, i, 1) !='_'
							                                                     If SalStrMidX ( sKtkMask, i, 1) != SalStrMidX ( sKtkMask, i, 1)
								                                                     Set bIsLike=FALSE
								                                                     Return bIsLike
					                                                     Return bIsLike
			! Function: ParseParam
				                                                     Description: 
				                                                     Returns 
				                                                     Parameters 
				                                                     Static Variables 
				                                                     Local variables 
				                                                     Actions 
			! Function: Make_DkuRep
				                                                     Description: 
				                                                     Returns 
				                                                     Parameters 
					                                                     Number: nType !-- (1-свод, 2-выборочные, 3-Все, 4-свод+выборочные, 5 - свод+все)
				                                                     Static Variables 
				                                                     Local variables 
					                                                     String: sArr[5]
					                                                     String: sRepParams[5]
					                                                     String: sDeb
					                                                     String: strTmp
					                                                     Number: nCurLine
				                                                     Actions 
					! ===================================
					! -- Инициализация
					! ===================================
					                                                     Set sArr[0]='"Свод"'
					                                                     Set sArr[1]='"Выбор"'
					                                                     Set sArr[2]='"Все"'
					                                                     Set sArr[3]='"Свод+выбор"'
					                                                     Set sArr[4]='"Свод+все"'
					! ===================================
					! == установим принтер как default нужно при формировании
					! == текстового отчета  чтот б были нормальные параметры вывода
					! ===================================
					! If FL_FORMAT
						                                                                                                                                                        Call SalPrtSetDefault(sDeviceDef, sDriverDef, sPortDef)
					! Else
						                                                                                                                                                        Call SalPrtSetDefault('Generic / Text Only', 'WINSPOOL', 'FILE:')
					! ====================================
					! == Для каждого выбранного отчета
					! ====================================
					!
					                                                     Call SalWaitCursor(TRUE)
					                                                     Set nCurLine=TBL_MinRow
					                                                     While SalTblFindNextRow (  frm_Out.tblReps, nCurLine, ROW_Selected, 0 )
						                                                     Call SalTblSetContext( frm_Out.tblReps, nCurLine)
						                                                     Set strTmplPath = IifS(FL_FORMAT, GetTemplateDir() || "\\" || frm_Out.tblReps.repw,  GetTemplateDir() || "\\" || frm_Out.tblReps.rep)
						                                                     Set SHAP = SalNumberToStrX(frm_Out.tblReps.Kod, 0) || ' ' ||  frm_Out.tblReps.NAME
						                                                     Set DRUK = 'Printed: ' || SalFmtFormatDateTime(SalDateCurrent(), "dd/MM/yyyy hh:mm:ss")
						!
						                                                     Set sDeb=NumberToStrFormat( SalDateHour(SalDateCurrent()),2,'0' )||':'
								         ||NumberToStrFormat( SalDateMinute(SalDateCurrent()),2,'0' )||':'  
								         ||NumberToStrFormat(  SalDateSecond (SalDateCurrent()),2,'0' )||
								         '-Нач.'||sArr[nType-1] ||frm_Out.tblReps.NAME 
						                                                     Call SalListAdd ( lbStatus, sDeb)
						! ===================================
						! ==Вычленим параметры================
						! ===================================
						                                                     Set strPureMask = GetPureFileMask(frm_Out.tblReps.maska)
						                                                     Set strTmp = frm_Out.tblReps.param
						!
						                                                     Set sRepParams[0]='0'
						                                                     Set sRepParams[1]='0'
						                                                     Set sRepParams[2]='0'
						!
						                                                     Set i = SalStrScan (strTmp,',')
						                                                     Set sRepParams[0] = SalStrLeftX(strTmp, i)
						!
						                                                     Set strTmp = SalStrMidX(strTmp, i+1, SalStrLength(strTmp)- i )
						                                                     Set i = SalStrScan (strTmp,',')
						                                                     If i >-1
							                                                     Set sRepParams[1] = SalStrLeftX(strTmp, i)
							!
							!
							                                                     Set strTmp = SalStrMidX(strTmp, i+1, SalStrLength(strTmp)- i )
							                                                     Set i = SalStrScan (strTmp,',')
							                                                     If i >-1
								                                                     Set sRepParams[2] = SalStrLeftX(strTmp, i)
							                                                     Else 
								                                                     Set sRepParams[2] = strTmp
							!
						                                                     Else 
							                                                     Set sRepParams[1] =strTmp
						!
						                                                     Set nPar1 = SalStrToNumber( sRepParams[1] )
						                                                     Set nRepFileType = SalStrToNumber( sRepParams[2] )
						!
						! ====================================
						! == Подготовим временн. таблицы  
						! ====================================
						                                                     Call SalUpdateWindow ( lbStatus )
						                                                     Call Prepare_Rep_InCreate(nPar1)
						                                                     Call Prepare_DkuRep(nPar1)
						!
						! Цыкл по nRepFileType сделан для случая, если нужно генерить один отчет в разных форматах
						! Set i = nRepFileType
						! While i>=0 
							                                                                                                                                                   If nRepFileType >= 3
								                                                                                                                                                   Set nRepFileType=nRepFileType-1
							! ====================================
							! == Если формат DBF - подготовить файл
							! ====================================
							                                                                                                                                                   Call Debug('Делаем nRepFileType='||Str(nRepFileType))
							                                                                                                                                                   If nRepFileType=2
								! установим текущую директорию (все заточеноо под 412)
								                                                                                                                                                   Call SalUseRegistry(FALSE, '')
								                                                                                                                                                   Call SalGetProfileString('412', 'DbfPath', strPrintPath, strPrintPath, GetIniFileName())
								                                                                                                                                                   If not SalFileSetCurrentDirectory(strPrintPath)
									                                                                                                                                                   Call SalMessageBox(' Невозможно установить директорию '|| strPrintPath||' текущей ', 'Внимание!',0)
									                                                                                                                                                   Call SalWaitCursor (FALSE )
									                                                                                                                                                   Return -1
								                                                                                                                                                   Set SqlDatabase = 'dBase_Files'
								                                                                                                                                                   If not SqlConnect(hSqlA)
									                                                                                                                                                   Call SalMessageBox(' Невозможно установить соединение с dBase_Files ', 'Внимание!',0)
									                                                                                                                                                   Call SalWaitCursor (FALSE )
									                                                                                                                                                   Return -1
								                                                                                                                                                   If not VisFileFind(strPrintPath||"\\ft.dbf ") 
									!
									                                                                                                                                                   Call SqlPrepareAndExecute(hSqlA, "
											     CREATE
											     TABLE " || strPrintPath||"\\ft.dbf "||strDBFStruct)
								                                                                                                                                                   Set nCouDBFFilesToRename=0
							! ====================================
							! == Выполним собственно отчет
							! ====================================
							! ------ Сводная-----------
							                                                                                                                                                   If nType = 1 or nType = 4 or nType = 5
								                                                                                                                                                   Call FU_1( 'x', GetBankSab(),GetBankName() , GetGlobalOption('AREACODE')||'00', '','2')
							! ------ Выбранные или Все--------
							                                                                                                                                                   If nType > 1 
								                                                                                                                                                   If nType = 3 or nType=5 !-- Все
									                                                                                                                                                   If nLevel >= 1
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, TRUE, 0, 0)
										! Call SalTblSetRowFlags(tbl1, 0, ROW_Selected, FALSE)
									                                                                                                                                                   If nLevel >= 2
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(frm_RegPart.tblRada, ROW_Selected, TRUE, 0, 0)
										! Call SalTblSetRowFlags(frm_RegPart.tblRada, 0, ROW_Selected, FALSE)
									                                                                                                                                                   If nLevel >= 3
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(frm_RegPart.tblSelo, ROW_Selected, TRUE, 0, 0)
									                                                                                                                                                   Set nTmp = 0
								                                                                                                                                                   Else 
									                                                                                                                                                   Set nTmp = ROW_Selected
								!
								! -- по районам
								                                                                                                                                                   If nLevel >= 1 
									                                                                                                                                                   Set nTmp = ROW_Selected
									                                                                                                                                                   Set nRow = TBL_MinRow
									                                                                                                                                                   While SalTblFindNextRow(tbl1, nRow, nTmp, 0)
										                                                                                                                                                   Call SalTblSetContext(tbl1, nRow)
										                                                                                                                                                   Call FU_1(tbl1.Kod1, tbl1.colSab, tbl1.Name1, tbl1.colid_key, tbl1.ktk_name,'0')
								! -- по сельским радам
								                                                                                                                                                   If nLevel >= 2 
									                                                                                                                                                   Set nTmp = ROW_Selected
									                                                                                                                                                   Set nRow = TBL_MinRow
									                                                                                                                                                   While SalTblFindNextRow(frm_RegPart.tblRada, nRow, nTmp, 0)
										                                                                                                                                                   Call SalTblSetContext(frm_RegPart.tblRada, nRow)
										                                                                                                                                                   Call FU_1(frm_RegPart.tblRada.Kod1, frm_RegPart.tblRada.colSab, frm_RegPart.tblRada.Name1,  frm_RegPart.tblRada.colid_key, frm_RegPart.tblRada.ktk_name, frm_RegPart.tblRada.colIsSvod )
								! -- по селам
								                                                                                                                                                   If nLevel >= 3 
									                                                                                                                                                   Set nTmp = ROW_Selected
									                                                                                                                                                   Set nRow = TBL_MinRow
									                                                                                                                                                   While SalTblFindNextRow(frm_RegPart.tblSelo, nRow, nTmp, 0)
										                                                                                                                                                   Call SalTblSetContext(frm_RegPart.tblSelo, nRow)
										                                                                                                                                                   If nRow >= 0
											                                                                                                                                                   Call FU_1(frm_RegPart.tblSelo.Kod1, frm_RegPart.tblSelo.colSab, frm_RegPart.tblSelo.Name1, frm_RegPart.tblSelo.colid_key, frm_RegPart.tblSelo.ktk_name,'1' )
								!
								! ----
								                                                                                                                                                   If nType = 3 or nType=5
									                                                                                                                                                   If nLevel >= 1
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, FALSE, 0, 0)
									                                                                                                                                                   If nLevel >= 2
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(frm_RegPart.tblRada, ROW_Selected, FALSE, 0, 0)
									                                                                                                                                                   If nLevel >= 3
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(frm_RegPart.tblSelo, ROW_Selected, FALSE, 0, 0)
								!
								!
							! ------ Если это dbf - переименовать(для того что б не делать для каждого файла connect) -----
							                                                                                                                                                   If nRepFileType=2
								                                                                                                                                                   Call SqlDisconnect(hSqlA)
								! Call Debug('Всего файлов для переименовывания = '||Str(nCouDBFFilesToRename))
								                                                                                                                                                   Set nRet=0
								                                                                                                                                                   While nRet < nCouDBFFilesToRename
									! Call Debug('Rename '||strPrintPath||'\\'||strDBFFilesToRename[nRet]||'.DBF'||'  TO -->>'||             
											            strPrintPath||'\\'||SalStrLeftX(strDBFFilesToRename[nRet],SalStrLength(strDBFFilesToRename[nRet])-3)||'.'||SalStrRightX(strDBFFilesToRename[nRet],3))
									                                                                                                                                                   If VisFileRename(strPrintPath||'\\'||strDBFFilesToRename[nRet]||'.DBF', 
											                 strPrintPath||'\\'||SalStrLeftX(strDBFFilesToRename[nRet],SalStrLength(strDBFFilesToRename[nRet])-3)||'.'||SalStrRightX(strDBFFilesToRename[nRet],3)) < 0
										                                                                                                                                                   Call SalMessageBox(' Невозможно преименовать ', 'Внимание!',0)
										                                                                                                                                                   Call SalWaitCursor (FALSE )
										                                                                                                                                                   Return -1
									                                                                                                                                                   Set nRet=nRet+1
							!
							! сначала делаеться DBF, а потом TXT 
							                                                                                                                                                   If nRepFileType=0 OR  nRepFileType=1 OR  nRepFileType=2 
								                                                                                                                                                   Break 
							                                                                                                                                                   Set i=i-3
							!
						                                                     If nRepFileType<3
							                                                     Call Make_ReportFiles(nRepFileType, nType)
						                                                     Else 
							                                                     If nRepFileType=3
								                                                     Call Make_ReportFiles(0,nType) !-- текст
								                                                     Call Make_ReportFiles(2,nType) !-- dbf 
						                                                     Set sDeb=NumberToStrFormat( SalDateHour(SalDateCurrent()),2,'0' )||':'
								         ||NumberToStrFormat( SalDateMinute(SalDateCurrent()),2,'0' )||':'  
								         ||NumberToStrFormat(  SalDateSecond (SalDateCurrent()),2,'0' )||
								         '-Зак.'||sArr[nType-1]||frm_Out.tblReps.NAME 
						                                                     Call SalListAdd ( lbStatus, sDeb)
						                                                     Call SalUpdateWindow ( lbStatus )
						                                                     Call UnPrepare_DkuRep(nPar1) 
					!
					                                                     Call SalWaitCursor(FALSE)
					! ----- поставим назад принтер ------------
					! If not FL_FORMAT
						                                                                                                                                                        Call SalPrtSetDefault(sDeviceDef, sDriverDef, sPortDef)
			                                                   Function: makeRep
				                                                   Description: 
				                                                   Returns 
				                                                   Parameters 
					                                                   Number: nType !- тип агрегирования территорий для отчета см. константы REPAGG_*
				                                                   Static Variables 
				                                                   Local variables 
					                                                   String: sArr[5]
					                                                   String: sRepParams[5]
					                                                   String: sDeb
					                                                   String: strTmp
					                                                   Number: nCurLine
				                                                   Actions 
					! -- Инициализация
					                                                   Set sArr[0]='"Свод"'
					                                                   Set sArr[1]='"Выбор"'
					                                                   Set sArr[2]='"Все"'
					                                                   Set sArr[3]='"Свод+выбор"'
					                                                   Set sArr[4]='"Свод+все"'
					!
					                                                   Call SalWaitCursor(TRUE)
					                                                   Set nCurLine=TBL_MinRow
					                                                   While SalTblFindNextRow (  frm_Out.tblReps, nCurLine, ROW_Selected, 0 )
						                                                   Call SalTblSetContext( frm_Out.tblReps, nCurLine)
						                                                   Set strTmplPath = IifS(FL_FORMAT, GetTemplateDir() || "\\" || frm_Out.tblReps.repw,  GetTemplateDir() || "\\" || frm_Out.tblReps.rep)
						                                                   Set SHAP = SalNumberToStrX(frm_Out.tblReps.Kod, 0) || ' ' ||  frm_Out.tblReps.NAME
						                                                   Set DRUK = 'Printed: ' || SalFmtFormatDateTime(SalDateCurrent(), "dd/MM/yyyy hh:mm:ss")
						!
						                                                   Set sDeb=NumberToStrFormat( SalDateHour(SalDateCurrent()),2,'0' )||':'
								         ||NumberToStrFormat( SalDateMinute(SalDateCurrent()),2,'0' )||':'  
								         ||NumberToStrFormat(  SalDateSecond (SalDateCurrent()),2,'0' )||
								         '-Нач.'||sArr[nType-1] ||frm_Out.tblReps.NAME 
						                                                   Call SalListAdd ( lbStatus, sDeb)
						! ===================================
						! ==Вычленим параметры================
						! ===================================
						                                                   Set strPureMask = GetPureFileMask(frm_Out.tblReps.maska)
						                                                   Set strTmp = frm_Out.tblReps.param
						!
						                                                   Set sRepParams[0]='0'
						                                                   Set sRepParams[1]='0'
						                                                   Set sRepParams[2]='0'
						!
						                                                   Set i = SalStrScan (strTmp,',')
						                                                   Set sRepParams[0] = SalStrLeftX(strTmp, i)
						!
						                                                   Set strTmp = SalStrMidX(strTmp, i+1, SalStrLength(strTmp)- i )
						                                                   Set i = SalStrScan (strTmp,',')
						                                                   If i >-1
							                                                   Set sRepParams[1] = SalStrLeftX(strTmp, i)
							!
							!
							                                                   Set strTmp = SalStrMidX(strTmp, i+1, SalStrLength(strTmp)- i )
							                                                   Set i = SalStrScan (strTmp,',')
							                                                   If i >-1
								                                                   Set sRepParams[2] = SalStrLeftX(strTmp, i)
							                                                   Else 
								                                                   Set sRepParams[2] = strTmp
							!
						                                                   Else 
							                                                   Set sRepParams[1] =strTmp
						!
						                                                   Set nPar1 = SalStrToNumber( sRepParams[1] )
						                                                   Set nRepFileType = SalStrToNumber( sRepParams[2] )
						!
						! ====================================
						! == Подготовим временн. таблицы  
						! ====================================
						                                                   Call SalUpdateWindow ( lbStatus )
						                                                   Call Prepare_Rep_InCreate(nPar1)
						                                                   Call Prepare_DkuRep(nPar1)
						!
						! Цыкл по nRepFileType сделан для случая, если нужно генерить один отчет в разных форматах
						! Set i = nRepFileType
						! While i>=0 
							                                                                                                                                                   If nRepFileType >= 3
								                                                                                                                                                   Set nRepFileType=nRepFileType-1
							! ====================================
							! == Если формат DBF - подготовить файл
							! ====================================
							                                                                                                                                                   Call Debug('Делаем nRepFileType='||Str(nRepFileType))
							                                                                                                                                                   If nRepFileType=2
								! установим текущую директорию (все заточеноо под 412)
								                                                                                                                                                   Call SalUseRegistry(FALSE, '')
								                                                                                                                                                   Call SalGetProfileString('412', 'DbfPath', strPrintPath, strPrintPath, GetIniFileName())
								                                                                                                                                                   If not SalFileSetCurrentDirectory(strPrintPath)
									                                                                                                                                                   Call SalMessageBox(' Невозможно установить директорию '|| strPrintPath||' текущей ', 'Внимание!',0)
									                                                                                                                                                   Call SalWaitCursor (FALSE )
									                                                                                                                                                   Return -1
								                                                                                                                                                   Set SqlDatabase = 'dBase_Files'
								                                                                                                                                                   If not SqlConnect(hSqlA)
									                                                                                                                                                   Call SalMessageBox(' Невозможно установить соединение с dBase_Files ', 'Внимание!',0)
									                                                                                                                                                   Call SalWaitCursor (FALSE )
									                                                                                                                                                   Return -1
								                                                                                                                                                   If not VisFileFind(strPrintPath||"\\ft.dbf ") 
									!
									                                                                                                                                                   Call SqlPrepareAndExecute(hSqlA, "
											     CREATE
											     TABLE " || strPrintPath||"\\ft.dbf "||strDBFStruct)
								                                                                                                                                                   Set nCouDBFFilesToRename=0
							! ====================================
							! == Выполним собственно отчет
							! ====================================
							! ------ Сводная-----------
							                                                                                                                                                   If nType = 1 or nType = 4 or nType = 5
								                                                                                                                                                   Call FU_1( 'x', GetBankSab(),GetBankName() , GetGlobalOption('AREACODE')||'00', '','2')
							! ------ Выбранные или Все--------
							                                                                                                                                                   If nType > 1 
								                                                                                                                                                   If nType = 3 or nType=5 !-- Все
									                                                                                                                                                   If nLevel >= 1
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, TRUE, 0, 0)
										! Call SalTblSetRowFlags(tbl1, 0, ROW_Selected, FALSE)
									                                                                                                                                                   If nLevel >= 2
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(frm_RegPart.tblRada, ROW_Selected, TRUE, 0, 0)
										! Call SalTblSetRowFlags(frm_RegPart.tblRada, 0, ROW_Selected, FALSE)
									                                                                                                                                                   If nLevel >= 3
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(frm_RegPart.tblSelo, ROW_Selected, TRUE, 0, 0)
									                                                                                                                                                   Set nTmp = 0
								                                                                                                                                                   Else 
									                                                                                                                                                   Set nTmp = ROW_Selected
								!
								! -- по районам
								                                                                                                                                                   If nLevel >= 1 
									                                                                                                                                                   Set nTmp = ROW_Selected
									                                                                                                                                                   Set nRow = TBL_MinRow
									                                                                                                                                                   While SalTblFindNextRow(tbl1, nRow, nTmp, 0)
										                                                                                                                                                   Call SalTblSetContext(tbl1, nRow)
										                                                                                                                                                   Call FU_1(tbl1.Kod1, tbl1.colSab, tbl1.Name1, tbl1.colid_key, tbl1.ktk_name,'0')
								! -- по сельским радам
								                                                                                                                                                   If nLevel >= 2 
									                                                                                                                                                   Set nTmp = ROW_Selected
									                                                                                                                                                   Set nRow = TBL_MinRow
									                                                                                                                                                   While SalTblFindNextRow(frm_RegPart.tblRada, nRow, nTmp, 0)
										                                                                                                                                                   Call SalTblSetContext(frm_RegPart.tblRada, nRow)
										                                                                                                                                                   Call FU_1(frm_RegPart.tblRada.Kod1, frm_RegPart.tblRada.colSab, frm_RegPart.tblRada.Name1,  frm_RegPart.tblRada.colid_key, frm_RegPart.tblRada.ktk_name, frm_RegPart.tblRada.colIsSvod )
								! -- по селам
								                                                                                                                                                   If nLevel >= 3 
									                                                                                                                                                   Set nTmp = ROW_Selected
									                                                                                                                                                   Set nRow = TBL_MinRow
									                                                                                                                                                   While SalTblFindNextRow(frm_RegPart.tblSelo, nRow, nTmp, 0)
										                                                                                                                                                   Call SalTblSetContext(frm_RegPart.tblSelo, nRow)
										                                                                                                                                                   If nRow >= 0
											                                                                                                                                                   Call FU_1(frm_RegPart.tblSelo.Kod1, frm_RegPart.tblSelo.colSab, frm_RegPart.tblSelo.Name1, frm_RegPart.tblSelo.colid_key, frm_RegPart.tblSelo.ktk_name,'1' )
								!
								! ----
								                                                                                                                                                   If nType = 3 or nType=5
									                                                                                                                                                   If nLevel >= 1
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, FALSE, 0, 0)
									                                                                                                                                                   If nLevel >= 2
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(frm_RegPart.tblRada, ROW_Selected, FALSE, 0, 0)
									                                                                                                                                                   If nLevel >= 3
										                                                                                                                                                   Call SalTblSetFlagsAnyRows(frm_RegPart.tblSelo, ROW_Selected, FALSE, 0, 0)
								!
								!
							! ------ Если это dbf - переименовать(для того что б не делать для каждого файла connect) -----
							                                                                                                                                                   If nRepFileType=2
								                                                                                                                                                   Call SqlDisconnect(hSqlA)
								! Call Debug('Всего файлов для переименовывания = '||Str(nCouDBFFilesToRename))
								                                                                                                                                                   Set nRet=0
								                                                                                                                                                   While nRet < nCouDBFFilesToRename
									! Call Debug('Rename '||strPrintPath||'\\'||strDBFFilesToRename[nRet]||'.DBF'||'  TO -->>'||             
											            strPrintPath||'\\'||SalStrLeftX(strDBFFilesToRename[nRet],SalStrLength(strDBFFilesToRename[nRet])-3)||'.'||SalStrRightX(strDBFFilesToRename[nRet],3))
									                                                                                                                                                   If VisFileRename(strPrintPath||'\\'||strDBFFilesToRename[nRet]||'.DBF', 
											                 strPrintPath||'\\'||SalStrLeftX(strDBFFilesToRename[nRet],SalStrLength(strDBFFilesToRename[nRet])-3)||'.'||SalStrRightX(strDBFFilesToRename[nRet],3)) < 0
										                                                                                                                                                   Call SalMessageBox(' Невозможно преименовать ', 'Внимание!',0)
										                                                                                                                                                   Call SalWaitCursor (FALSE )
										                                                                                                                                                   Return -1
									                                                                                                                                                   Set nRet=nRet+1
							!
							! сначала делаеться DBF, а потом TXT 
							                                                                                                                                                   If nRepFileType=0 OR  nRepFileType=1 OR  nRepFileType=2 
								                                                                                                                                                   Break 
							                                                                                                                                                   Set i=i-3
							!
						                                                   If nRepFileType<3
							                                                   Call Make_ReportFiles(nRepFileType, nType)
						                                                   Else 
							                                                   If nRepFileType=3
								                                                   Call Make_ReportFiles(0,nType) !-- текст
								                                                   Call Make_ReportFiles(2,nType) !-- dbf 
						                                                   Set sDeb=NumberToStrFormat( SalDateHour(SalDateCurrent()),2,'0' )||':'
								         ||NumberToStrFormat( SalDateMinute(SalDateCurrent()),2,'0' )||':'  
								         ||NumberToStrFormat(  SalDateSecond (SalDateCurrent()),2,'0' )||
								         '-Зак.'||sArr[nType-1]||frm_Out.tblReps.NAME 
						                                                   Call SalListAdd ( lbStatus, sDeb)
						                                                   Call SalUpdateWindow ( lbStatus )
						                                                   Call UnPrepare_DkuRep(nPar1) 
					!
					                                                   Call SalWaitCursor(FALSE)
		                                                   Window Parameters 
			! String: sdat
			! Number: nRepPar
		                                                   Window Variables 
			                                                   String: strNbuMfo
			                                                   Number: nTmp
			                                                   Number: R[*]
			                                                   Number: R0[*]
			                                                   String: RN[*]
			                                                   String: sTmp
			                                                   Date/Time: dTmp
			                                                   Number: nRow
			                                                   Boolean: bTest
			                                                   String: sKtk
			                                                   String: sSqlR
			                                                   String: strBind
			                                                   String: sSql
			!
			                                                   String: SHAP
			                                                   String: strBankName
			                                                   String: strBankKod
			                                                   String: RUK
			                                                   String: NAME
			                                                   String: TT
			                                                   String: TNAME
			                                                   Number: REF
			!
			                                                   String: sBigPayersMask
			                                                   String: sNameDpi
			                                                   Number: nIdDpi
			!
			                                                   Number: USI
			                                                   Number: K2OLD
			                                                   Number: K0
			                                                   Number: K0s
			                                                   Number: K1
			                                                   Number: BIS
			                                                   Number: K1s
			                                                   Number: K2
			                                                   Number: K2s
			                                                   Number: K3
			                                                   Number: K3s
			                                                   Number: S1
			                                                   Number: S2
			                                                   Number: S3
			                                                   Number: S4
			                                                   Number: S5
			                                                   Number: S6
			                                                   Number: S7
			                                                   Number: S8
			                                                   Number: S9
			                                                   Number: S10
			                                                   Number: SY1
			                                                   Number: SY2
			                                                   Number: SY3
			                                                   Number: SY4
			                                                   Number: SY5
			                                                   Number: SY6
			                                                   Number: SY7
			                                                   Number: SY8
			                                                   Number: SY9
			                                                   Number: SY10
			                                                   Number: S41
			                                                   Number: S51
			                                                   Number: S61
			                                                   Number: S0
			                                                   Number: S
			                                                   Date/Time: D1
			                                                   Date/Time: D2
			                                                   String: DK
			                                                   String: NOM
			                                                   String: NLSA
			                                                   String: NLSB
			                                                   String: MFOA
			                                                   String: MFOB
			                                                   String: NAM_A
			                                                   String: NAM_B
			                                                   String: OKPO_A
			                                                   String: OKPO_B
			                                                   String: sSqlS
			                                                   String: sSqlV
			                                                   Number: ACC
			                                                   String: NLS
			                                                   Number: KV
			                                                   String: ISO
			                                                   Date/Time: FDAT
			                                                   String: ND
			                                                   String: MFO
			                                                   String: NLSK
			                                                   String: NAMK
			                                                   String: NAZN
			                                                   String: SIM
			                                                   String: NB
			                                                   String: OKPO
			                                                   Date/Time: DAPP
			                                                   Number: ISP
			                                                   Date/Time: DATP
			                                                   String: NMK
			                                                   Number: RNK
			                                                   Number: SK
			                                                   Number: WD
			                                                   Number: VOB
			                                                   String: vob
			                                                   Number: OSTF
			                                                   Number: OSTF1
			                                                   Number: OBD
			                                                   Number: OBK
			                                                   Number: nCount
			                                                   String: PROB
			                                                   String: FIO
			                                                   String: maska
			                                                   String: maska2
			                                                   Number: nrab
			                                                   String: NMS
			                                                   Number: nKtk   ! - -  Выбранные районы, рады для 412 ф
			                                                   Number: i
			                                                   Number: nCou
			!
			                                                   Number: nTempRef
			                                                   String: sdattarh
			                                                   Long String: Group2mLine
			! сKtkObl : DKU
			!
		                                                   Message Actions 
			                                                   On SAM_Create
				! Set nPar1=nRepPar
				                                                   If ( SqlPrepareAndExecute(hSqlAux(),
						      "SELECT idt INTO :sKtk FROM ktk
						       WHERE substr(idt,-2,2)<>'00' " ) )
						  and ( SqlFetchNext(hSqlAux(), nFetchRes) )
					                                                   Set nLevel=3
				                                                   Else 
					                                                   Set nLevel=2
				! - - инициализируем основной сплиттер
				                                                   Call cSpltMain.setTopFrame(tbl1)
				                                                   Call cSpltMain.setBarPosition( 300 )
				                                                   Call cSpltMain.setBottomFrame( SalCreateWindowEx( frm_RegPart, hWndForm, 0,0,0,0, CREATE_AsChild ) )
				                                                   Call cSpltMain.setBarSize(1)
				                                                   If SqlPrepareAndExecute(hSqlAux(), "
						   SELECT val
						   INTO :strNbuMfo
						   FROM params
						   WHERE par='MFOP'")
					                                                   Call SqlFetchNext(hSqlAux(), nFetchRes)
				                                                   Set strBankKod  = 'Зведена по області'
				                                                   Call Prepare_Rep_InCreate(nPar1)
			                                                   On SAM_ReportStart
				                                                   Call SetPrinter(1)
				                                                   Call SqlPrepare(hSql(), T(sSql))
			                                                   On SAM_ReportFetchInit
				                                                   If SqlExecute(hSql())
					                                                   Return TRUE
				                                                   Else 
					                                                   Return FALSE
			                                                   On SAM_ReportFetchNext
				                                                   If SqlFetchNext(hSql(), nFetchRes)
					                                                   If nPar1 = 3 or nPar1 = 12 or nPar1 = 300 or nPar1 = 302
						                                                   Set R[K1] = R[K1] + S
						                                                   Set R0[K1] = R0[K1] + S0
					                                                   Else If nPar1 = 400 or nPar1 = 401 
						                                                   If SqlPrepareAndExecute(hSqlAux(), sSqlR)
							                                                   Call SqlFetchNext(hSqlAux(), nFetchRes)
						                                                   If SqlPrepareAndExecute(hSqlAux(), sSqlS)
							                                                   Call SqlFetchNext(hSqlAux(), nFetchRes)
					                                                   Set nCou = nCou + 1
					                                                   Return TRUE
			                                                   On SAM_ReportNotify
				                                                   If lParam = RPT_BeforeReportHeader
					                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
							     'strBankName', strBankName)
					                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
							     'strBankKod', strBankKod)
					                                                   If nPar1 = 301  ! - - - -  сжатая 2m
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
								     'sd1',  SalStrMidX(strDateFrom,0,2) || SalStrMidX(strDateFrom,3,2)  || SalStrMidX(strDateFrom,6,4) ||  NumberToStrFormat(nCount, 6,' ')||strFileNameTxt )
					                                                   Else 
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'sd1', strDateFrom)
					                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'FIO', FIO)
					                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam), 'ISP', ISP)
					                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'NMS', NMS)
					                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'NMK', NMK)
					                                                   If nPar1 = 299 
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'NBS', '3411')
					                                                   If nPar1 = 298
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'NBS', '3421')
				                                                   If lParam = RPT_BeforeBreakHeader1
					                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'strBankName', strBankName)
					                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'strBankKod', strBankKod)
					                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'sd1', strDateFrom)
					                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'FIO', FIO)
					                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam), 'ISP', ISP)
					                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'NMS', NMS)
					                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'NMK', NMK)
					                                                   If nPar1 = 400 or nPar1 = 401  or (nPar1>=411 and nPar1<=414)
						                                                   Set OBD = 0
						                                                   Set OBK = 0
					                                                   Else If nPar1 = 41 or nPar1 = 42 or nPar1 = 43 or nPar1 = 44 or nPar1 = 40 
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'SHAP', SHAP)
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'ND', ND)
				                                                   If lParam=RPT_BeforeBreakHeader2 !! Смена даты
					                                                   Set OBD=0
					                                                   Set OBK=0
					                                                   Set rab=IifS(OSTF<0,'Дб:',IifS(OSTF>0,'Кр:',''))
					                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'VS',rab)
					                                                   Set OSTF1 = OSTF - OBD + OBK
				                                                   If lParam = RPT_BeforeBreakHeader4
					                                                   If nPar1=50 or nPar1=51
						                                                   If SqlPrepareAndExecute(hSqlAux(), "
								   SELECT name INTO :sTmp FROM kkd
								   WHERE ix" || Str(K1)) and
								   SqlFetchNext(hSqlAux(), nFetchRes)
							                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'STT', sTmp)
				                                                   If lParam = RPT_BeforeDetail
					                                                   If nPar1 = 400 or nPar1 = 401  or (nPar1>=411 and nPar1<=414)
						                                                   If S < 0
							                                                   Set OBD = OBD - S
						                                                   Else 
							                                                   Set OBK = OBK + S
							                                                   Set PROB=''
						                                                   Set rab = SalNumberToStrX(SalNumberAbs(S),2) || PROB
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'SS', rab)
				                                                   If lParam = RPT_BeforeBreakFooter2
					                                                   If nPar1 = 400 or nPar1 = 401 or (nPar1>=411 and nPar1<=414)
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'OBD', OBD)
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'OBK', OBK)
						                                                   Set rab=IifS(OSTF1<0,'Дб:',IifS(OSTF1>0,'Кр:',''))
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'VYS',rab)
				! If lParam = RPT_BeforeBreakFooter1
				                                                   If lParam = RPT_BeforeReportFooter
					                                                   If nPar1 = 3 or nPar1 = 12 or nPar1 = 300 or nPar1 = 302
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R1',  R[1])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R2',  R[2])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R3',  R[3])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R4',  R[4])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R5',  R[5])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R6',  R[6])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R7',  R[7])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R8',  R[8])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R9',  R[9])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R10', R[10])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_1', R0[1])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_2', R0[2])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_3', R0[3])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_4', R0[4])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_5', R0[5])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_6', R0[6])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_7', R0[7])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_8', R0[8])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_9', R0[9])
						                                                   Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'R_10',R0[10])
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN1',RN[1])
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN2',RN[2])
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN3',RN[3])
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN4',RN[4])
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN5',RN[5])
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN6',RN[6])
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN7',RN[7])
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN8',RN[8])
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN9',RN[9])
						                                                   Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RN10',RN[10])
			                                                   On SAM_Close
				                                                   Set hWndDKU = hWndNULL
			                                                   On SAM_CreateComplete
				                                                   Set hWndDKU = hWndForm
			                                                   On SAM_ReportFinish
				                                                   Call SetPrinter(0)
	Dialog Box: dlg_kl_PostAll
		Class:
		Property Template:
		Class DLL Name:
		Title: Розсилка інформації на клієнтів клієнт-банку
		Accesories Enabled? No
		Visible? Yes
		Display Settings
			Display Style? Default
			Visible at Design time? Yes
			Type of Dialog: Modal
			Window Location and Size
				Left:   Default
				Top:    Default
				Width:  12.4"
				Width Editable? Yes
				Height: 6.381"
				Height Editable? Yes
			Absolute Screen Location? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
		Description:
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Top
				Visible? Yes
				Size: Default
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
		Contents
			Child Table: tblCustomer
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Display Settings
					Window Location and Size
						Left:   0.083"
						Top:    0.071"
						Width:  7.3"
						Width Editable? Yes
						Height: 5.917"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: Default
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
					View: Table
					Allow Row Sizing? No
					Lines Per Row: Default
				Memory Settings
					Maximum Rows in Memory: Default
					Discardable? Yes
				Contents
					Column: colSab
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Ел.код
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  1.067"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colCustName
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Клієнт
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  5.783"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
				Functions
				Window Variables
					String: sSql
				Message Actions
					On SAM_Create
						Set sSql = "SELECT c.sab,  nmk
								    INTO :tblCustomer.colSab, :tblCustomer.colCustName
								    FROM kl_customer_params cp, customer c
								    WHERE cp.rnk=c.rnk ORDER BY c.sab"
						Call SalTblPopulate( tblCustomer, hSql(), sSql, TBL_FillAll )
			Pushbutton: pbOk
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cpbOk
				Property Template:
				Class DLL Name:
				Title: Виконати
				Window Location and Size
					Left:   8.767"
					Top:    5.321"
					Width:  1.317"
					Width Editable? Class Default
					Height: 0.5"
					Height Editable? Class Default
				Visible? Class Default
				Keyboard Accelerator: Class Default
				Font Name: Class Default
				Font Size: Class Default
				Font Enhancement: Class Default
				Picture File Name:
				Picture Transparent Color: Gray
				Image Style: Class Default
				Text Color: Class Default
				Background Color: Class Default
				Message Actions
					On SAM_Click
						Call WaitCursorOn()
						If (chbVP)
							Call SalSendMsg (calVPFrom, SAM_User, 0, 0)
							Call SalSendMsg (calVPTo, SAM_User, 0, 0 )
							Set bRet = postRequest('DMVP', dFrom, dTo,'')
							Set bRet = postRequest('DMVF', dFrom, dTo,'')
						If (chbVal)
							Call SalSendMsg (calVal, SAM_User, 0, 0 )
							Set bRet = postRequest('CURV', dTo, dTo,'')
						If (chbBanks)
							Set bRet = postRequest('BNKS', GetBankDate(), GetBankDate(),'')
						If (chbInfoMess)
							! Если текст был набран вручную или отредактирован  - записать измененное сообщение в таблицу
							If nCheckedMsgId = 0
								Set nCheckedMsgId = saveNewMessage(mlMsgText)
							If nCheckedMsgId > -1
								Set bRet = postRequest('INFO', GetBankDate(), GetBankDate(), SalNumberToStrX(nCheckedMsgId,0)  )
						!
						If bRet
							Call SalMessageBox('Запит сформовано та відіслано на вигрузку', '', 0  )
						!
						Call WaitCursorOff()
			Group Box: Надіслати
				Resource Id: 4451
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Window Location and Size
					Left:   7.483"
					Top:    0.071"
					Width:  4.8"
					Width Editable? Yes
					Height: 5.083"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Check Box: chbVP
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: виписку       з:
				Window Location and Size
					Left:   7.783"
					Top:    0.405"
					Width:  1.7"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
				Message Actions
					! On SAM_Click
						                                        If chbVP
							                                        Call SalEnableWindow(calVPFrom)
							                                        Call SalEnableWindow(calVPTo)
						                                        Else 
							                                        Call SalDisableWindow(calVPFrom)
							                                        Call SalDisableWindow(calVPTo)
			! cCalendarDropDown: calVPFrom
.data CLASSPROPSSIZE
0000: 4400
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 646172436F6D626F 426F78002B000100 0000010101010001
0020: 0200000000010101 0000000000000000 01000000010A6464 2F4D4D2F79797979
0040: 00000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.winattr class Custom Control:
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cCalendarDropDown
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  0x00000000
					ExStyle:  0x00000000
					Title:
					Window Location and Size
						Left:   8.483"
						Top:    0.905"
						Width:  0.0"
						Width Editable? No
						Height: 0.25"
						Height Editable? No
					Visible? No
					Border? No
					Etched Border? No
					Hollow? No
					Vertical Scroll? No
					Horizontal Scroll? No
					Tab Stop? None
					Tile To Parent? No
					Font Name:
					Font Size: 0
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
					DLL Settings
.end
				                                                  Message Actions 
					                                                  On SAM_Create
						                                                  Call calVPFrom.SetMonthText( strMonth )
						                                                  Call calVPFrom.SetWeekDayText( strWeekDays )
						! ! - - - - - - - - - - - - Инициализация дат календаря  cCalendarFrom - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  - -
						                                                  Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset,  COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVPFrom.SpecialDate(SPECIAL_OneTime, GetBankDate(), DAY_Unset, SEQ_Unset, COLOR_Blue,  COLOR_Cyan, TRUE)
						                                                  Call SqlPrepareAndExecute(  hSql(), T("SELECT fdat  INTO :dSelect  FROM fdat")  )
						                                                  Set i = 0
						                                                  While SqlFetchNext(hSql(), nFetchRes)
							                                                  Call calVPFrom.SpecialDate(SPECIAL_OneTime, dSelect,  DAY_Unset, SEQ_Unset, COLOR_Blue, COLOR_Cyan, TRUE)
							                                                  Set i = i + 1
						                                                  If i = 0
							                                                  Call SalMessageBox('Нет доступных дат для выбора','Внимание',0)
									
						                                                  Call SalSetWindowText(  calVPFrom,  strBankDate)
					                                                  On SAM_User
						                                                  Call SalGetWindowText( hWndItem, strDateFrom, 12 )
						                                                  Set dFrom =  SalDateConstruct ( SalDateYear( SalStrToDate(strDateFrom )),
								                                SalDateMonth( SalStrToDate(strDateFrom )),
								                                SalDateDay( SalStrToDate(strDateFrom )), 0, 0, 0 )
			! cCalendarDropDown: calVPTo
.data CLASSPROPSSIZE
0000: 4400
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 646172436F6D626F 426F78002B000100 0000010101010001
0020: 0200000000010101 0000000000000000 01000000010A6464 2F4D4D2F79797979
0040: 00000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.winattr class Custom Control:
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cCalendarDropDown
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  0x00000000
					ExStyle:  0x00000000
					Title:
					Window Location and Size
						Left:   10.383"
						Top:    0.905"
						Width:  0.0"
						Width Editable? No
						Height: 0.25"
						Height Editable? No
					Visible? No
					Border? No
					Etched Border? No
					Hollow? No
					Vertical Scroll? No
					Horizontal Scroll? No
					Tab Stop? None
					Tile To Parent? No
					Font Name:
					Font Size: 0
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
					DLL Settings
.end
				                                                  Message Actions 
					                                                  On SAM_Create
						                                                  Call calVPTo.SetMonthText( strMonth )
						                                                  Call calVPTo.SetWeekDayText( strWeekDays )
						! ! - - - - - - - - - - - - Инициализация дат календаря  cCalendarFrom - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  - -
						                                                  Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset,  COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVPTo.SpecialDate(SPECIAL_OneTime, GetBankDate(), DAY_Unset, SEQ_Unset, COLOR_Blue,  COLOR_Cyan, TRUE)
						                                                  Call SqlPrepareAndExecute(  hSql(), T("SELECT fdat  INTO :dSelect  FROM fdat")  )
						                                                  Set i = 0
						                                                  While SqlFetchNext(hSql(), nFetchRes)
							                                                  Call calVPTo.SpecialDate(SPECIAL_OneTime, dSelect,  DAY_Unset, SEQ_Unset, COLOR_Blue, COLOR_Cyan, TRUE)
							                                                  Set i = i + 1
						                                                  If i = 0
							                                                  Call SalMessageBox('Нет доступных дат для выбора','Внимание',0)
									
						                                                  Call SalSetWindowText(  calVPTo,  strBankDate)
					                                                  On SAM_User
						                                                  Call SalGetWindowText( hWndItem, strDateTo, 12 )
						                                                  Set dTo =  SalDateConstruct ( SalDateYear( SalStrToDate(strDateTo )),
								                                SalDateMonth( SalStrToDate(strDateTo )),
								                                SalDateDay( SalStrToDate(strDateTo )), 0, 0, 0 )
			! cCalendarDropDown: calVal
.data CLASSPROPSSIZE
0000: 4200
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 646172436F6D626F 426F78002B000100 0000010101010001
0020: 0200000000010101 0000000000000000 01000000010A6464 2F4D4D2F79797979
0040: 0000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.winattr class Custom Control:
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cCalendarDropDown
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name: VT:cComboCal:10
					Style:  0x00000000
					ExStyle:  0x00000000
					Title:
					Window Location and Size
						Left:   9.983"
						Top:    2.071"
						Width:  0.0"
						Width Editable? No
						Height: 0.25"
						Height Editable? No
					Visible? No
					Border? No
					Etched Border? No
					Hollow? No
					Vertical Scroll? No
					Horizontal Scroll? No
					Tab Stop? None
					Tile To Parent? No
					Font Name:
					Font Size: 0
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
					DLL Settings
.end
				                                                  Message Actions 
					                                                  On SAM_Create
						                                                  Call calVal.SetMonthText( strMonth )
						                                                  Call calVal.SetWeekDayText( strWeekDays )
						! ! - - - - - - - - - - - - Инициализация дат календаря  cCalendarFrom - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  - -
						                                                  Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset,  COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						                                                  Call calVal.SpecialDate(SPECIAL_OneTime, GetBankDate(), DAY_Unset, SEQ_Unset, COLOR_Blue,  COLOR_Cyan, TRUE)
						                                                  Call SqlPrepareAndExecute(  hSql(), T("SELECT fdat  INTO :dSelect  FROM fdat")  )
						                                                  Set i = 0
						                                                  While SqlFetchNext(hSql(), nFetchRes)
							                                                  Call calVal.SpecialDate(SPECIAL_OneTime, dSelect,  DAY_Unset, SEQ_Unset, COLOR_Blue, COLOR_Cyan, TRUE)
							                                                  Set i = i + 1
						                                                  If i = 0
							                                                  Call SalMessageBox('Нет доступных дат для выбора','Внимание',0)
									
						                                                  Call SalSetWindowText(  calVPTo,  strBankDate)
					                                                  On SAM_User
						                                                  Call SalGetWindowText( hWndItem, strDateTo, 12 )
						                                                  Set dTo =  SalDateConstruct ( SalDateYear( SalStrToDate(strDateTo )),
								                                SalDateMonth( SalStrToDate(strDateTo )),
								                                SalDateDay( SalStrToDate(strDateTo )), 0, 0, 0 )
			Background Text: по:
				Resource Id: 4453
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Window Location and Size
					Left:   9.083"
					Top:    0.762"
					Width:  0.3"
					Width Editable? Yes
					Height: 0.167"
					Height Editable? Yes
				Visible? Yes
				Justify: Left
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Check Box: chbBanks
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: список банків учасників
				Window Location and Size
					Left:   7.783"
					Top:    1.071"
					Width:  2.4"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
				Message Actions
			Check Box: chbVal
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: курси валют за:
				Window Location and Size
					Left:   7.783"
					Top:    1.488"
					Width:  1.7"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
				Message Actions
					On SAM_Click
						If chbVal
							Call SalEnableWindow(calVal)
						Else
							Call SalDisableWindow(calVal)
			Pushbutton: pbCancel
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cpbCancel
				Property Template:
				Class DLL Name:
				Title: Відмінити
				Window Location and Size
					Left:   10.183"
					Top:    5.31"
					Width:  1.317"
					Width Editable? Class Default
					Height: 0.512"
					Height Editable? Class Default
				Visible? Class Default
				Keyboard Accelerator: Class Default
				Font Name: Class Default
				Font Size: Class Default
				Font Enhancement: Class Default
				Picture File Name: \BARS98\RESOURCE\BMP\DISCARD.BMP
				Picture Transparent Color: Gray
				Image Style: Class Default
				Text Color: Class Default
				Background Color: Class Default
				Message Actions
					On SAM_Click
						Call SalEndDialog(hWndForm, 0)
			Check Box: chbInfoMess
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: повідомлення клієнту
				Window Location and Size
					Left:   7.783"
					Top:    1.988"
					Width:  2.2"
					Width Editable? Yes
					Height: 0.25"
					Height Editable? Yes
				Visible? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
				Message Actions
					On SAM_Click
						If chbInfoMess
							Call SalEnableWindow(pbMsgFromFile)
							Call SalEnableWindow(mlMsgText)
							Call SalEnableWindow(pbMsgFromSavedList)
						Else
							Call SalDisableWindow(pbMsgFromFile)
							Call SalDisableWindow(mlMsgText)
							Call SalDisableWindow(pbMsgFromSavedList)
							Set mlMsgText=''
			Pushbutton: pbMsgFromSavedList
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title:
				Window Location and Size
					Left:   10.25"
					Top:    2.012"
					Width:  0.5"
					Width Editable? Yes
					Height: 0.298"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: (none)
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Picture File Name: \BARS98\RESOURCE\BMP\BROWSE.BMP
				Picture Transparent Color: None
				Image Style: Single
				Text Color: Default
				Background Color: Default
				Message Actions
					! On SAM_Create
						                                                                Set strTip = 'Редактирование'
					On SAM_Click
						Call SalCreateWindow(tbl_MsgList, hWndItem)
					On SAM_TooltipSetText
						Return XSalTooltipSetText( lParam, 'Сообщение из сохраненного списка' )
			Pushbutton: pbMsgFromFile
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title:
				Window Location and Size
					Left:   10.783"
					Top:    2.012"
					Width:  0.5"
					Width Editable? Yes
					Height: 0.298"
					Height Editable? Yes
				Visible? Yes
				Keyboard Accelerator: (none)
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Picture File Name: \BARS98\RESOURCE\BMP\OPEN.BMP
				Picture Transparent Color: None
				Image Style: Single
				Text Color: Default
				Background Color: Default
				Message Actions
					! On SAM_Create
						                                                                Set strTip = 'Из файла'
					On SAM_Click
						Set nCheckedMsgId=0
						Call getMessTextFromFile()
					On SAM_TooltipSetText
						Return XSalTooltipSetText( lParam, 'Сообщение из файла' )
			Multiline Field: mlMsgText
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: Default
					String Type: String
					Editable? Yes
				Display Settings
					Border? Yes
					Word Wrap? No
					Vertical Scroll? Yes
					Window Location and Size
						Left:   7.783"
						Top:    2.405"
						Width:  4.2"
						Width Editable? Yes
						Height: 2.583"
						Height Editable? Yes
					Visible? Yes
					Font Name: Default
					Font Size: Default
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
				Message Actions
					!
						                                                               Call SalCreateWindow(tbl_MsgList, hWndItem)
					On SAM_FieldEdit
						! Если поле редактированли - то сообщение уже не такое, как выбрали из таблицы
						! В этом случае - сохраним его потом в таблицу
						Set nCheckedMsgId = 0
								
			Custom Control: calVPFrom
.data CLASSPROPSSIZE
0000: 4400
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 646172436F6D626F 426F78002B000100 0000010101010000
0020: 0200000001010101 0101000000000000 01000000000A6464 2F4D4D2F79797979
0040: 00000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cCalendarDropDown
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   9.683"
						Top:    0.405"
						Width:  1.5"
						Width Editable? Class Default
						Height: 0.25"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
					On SAM_Create
						Call calVPFrom.SetMonthText( strMonth )
						Call calVPFrom.SetWeekDayText( strWeekDays )
						! - - - - - - - - - - - - Инициализация дат календаря  cCalendarFrom - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  - -
						Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset,  COLOR_Black, COLOR_Gray, TRUE)
						Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVPFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVPFrom.SpecialDate(SPECIAL_OneTime, GetBankDate(), DAY_Unset, SEQ_Unset, COLOR_Blue,  COLOR_Cyan, TRUE)
					On SAM_User
						Call SalGetWindowText( hWndItem, strDateFrom, 12 )
						Set dFrom =  SalDateConstruct (SalStrToNumber(SalStrRightX(strDateFrom,4)),
								                               SalStrToNumber(SalStrMidX(strDateFrom,3,2)),
								                               SalStrToNumber(SalStrLeftX(strDateFrom,2)),
								                               0, 0, 0 )
			Custom Control: calVPTo
.data CLASSPROPSSIZE
0000: 4400
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 646172436F6D626F 426F78002B000100 0000010101010000
0020: 0200000001010101 0101000000000000 01000000000A6464 2F4D4D2F79797979
0040: 00000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cCalendarDropDown
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   9.683"
						Top:    0.738"
						Width:  1.5"
						Width Editable? Class Default
						Height: 0.25"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
					On SAM_Create
						Call calVPTo.SetMonthText( strMonth )
						Call calVPTo.SetWeekDayText( strWeekDays )
						! - - - - - - - - - - - - Инициализация дат календаря  cCalendarFrom - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  - -
						Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset,  COLOR_Black, COLOR_Gray, TRUE)
						Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVPTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVPTo.SpecialDate(SPECIAL_OneTime, GetBankDate(), DAY_Unset, SEQ_Unset, COLOR_Blue,  COLOR_Cyan, TRUE)
					On SAM_User
						Call SalGetWindowText( hWndItem, strDateTo, 12 )
						Set dTo =  SalDateConstruct (SalStrToNumber(SalStrRightX(strDateTo,4)),
								                               SalStrToNumber(SalStrMidX(strDateTo,3,2)),
								                               SalStrToNumber(SalStrLeftX(strDateTo,2)),
								                               0, 0, 0 )
			Custom Control: calVal
.data CLASSPROPSSIZE
0000: 4400
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 646172436F6D626F 426F78002B000100 0000010101010000
0020: 0200000001010101 0101000000000000 01000000000A6464 2F4D4D2F79797979
0040: 00000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cCalendarDropDown
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   9.683"
						Top:    1.488"
						Width:  1.5"
						Width Editable? Class Default
						Height: 0.25"
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
					On SAM_Create
						Call calVal.SetMonthText( strMonth )
						Call calVal.SetWeekDayText( strWeekDays )
						! ! - - - - - - - - - - - - Инициализация дат календаря  cCalendarFrom - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  - -
						Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset,  COLOR_Black, COLOR_Gray, TRUE)
						Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVal.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
						Call calVal.SpecialDate(SPECIAL_OneTime, GetBankDate(), DAY_Unset, SEQ_Unset, COLOR_Blue,  COLOR_Cyan, TRUE)
					On SAM_User
						!
						Call SalGetWindowText( hWndItem, strDateTo, 12 )
						Set dTo =  SalDateConstruct (SalStrToNumber(SalStrRightX(strDateTo,4)),
								                               SalStrToNumber(SalStrMidX(strDateTo,3,2)),
								                               SalStrToNumber(SalStrLeftX(strDateTo,2)),
								                               0, 0, 0 )
			Frame
				Resource Id: 4454
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Window Location and Size
					Left:   7.483"
					Top:    5.155"
					Width:  4.8"
					Width Editable? Yes
					Height: 0.917"
					Height Editable? Yes
				Visible? Yes
				Corners: Square
				Border Style: Etched
				Border Thickness: 1
				Border Color: 3D Shadow Color
				Background Color: Default
		Functions
			Function: postRequest	
				Description:
				Returns
					Boolean:
				Parameters
					String: sRequestName
					! Date: dat1
					Date/Time: dat1
					Date/Time: dat2
					String: sInfo
				Static Variables
				Local variables
					Number: iRow
					Number: nChooseCnt
				Actions
					Set iRow = TBL_MinRow
					Set nChooseCnt = 0
					While SalTblFindNextRow(tblCustomer, iRow, ROW_Selected, 0)
						Call SalTblSetContext( tblCustomer, iRow )
						Set nChooseCnt = nChooseCnt+1
						If not SqlPLSQLCommand(hSql(), "POST_MODULE_REQUEST(sRequestName, tblCustomer.colSab, dat1, dat2, sInfo)")
							Call Debug('Ошибка выполнения процедуры')
							Return FALSE
						Else
						Call SqlCommitEx(hSql(),'')
					If nChooseCnt = 0
						Call SalMessageBox('Не вибрано жодного клієнту', 'Увага!', MB_Ok|MB_IconExclamation)
						Return FALSE
					Return TRUE
			Function: getMessTextFromFile
				Description:
				Returns
					! String: sMsgText
				Parameters
				Static Variables
				Local variables
					String: sFileNameFilters[*]
					String: sSelectedFileName
					String: sSelectedFilePath
					String: sFileLine
					Number: nSelectedFiltr
					File Handle: hFile
				Actions
					Set sFileNameFilters[0]='All files'
					Set sFileNameFilters[1]='*.*'
					Call SalDlgOpenFile (hWndNULL, 'Файл сообщения', sFileNameFilters, 2, nSelectedFiltr, sSelectedFileName, sSelectedFilePath )
					If VisFileOpen (hFile, sSelectedFilePath, OF_Read) = VTERR_Ok
						While VisFileReadString (hFile, sFileLine) = VTERR_Ok
							Set mlMsgText = mlMsgText || sFileLine || SalNumberToChar( 13 ) || SalNumberToChar( 10 )
			Function: saveNewMessage
				Description:
				Returns
					Number:
				Parameters
					Long String: sMessText
				Static Variables
				Local variables
					Number: nMessId
				Actions
					If SqlPrepareAndExecute(hSql(), "SELECT nvl(max(id_mess),0)+1 INTO :nMessId FROM kl_info_messages") AND SqlFetchNext(hSql(), i)
						If SqlPrepareAndExecute(hSql(), "INSERT INTO kl_info_messages VALUES(:nMessId, :sMessText)")
							Call SqlCommit(hSql())
							Return nMessId
						Else
							Call SalMessageBox('Невозможно вставить новое сообщение','Внимание!', MB_OK)
							Return -1
					Else
						Call SalMessageBox('Невозможно получить последующий номер для сообщения','Внимание!', MB_OK)
						Return -1
		Window Parameters
		Window Variables
			String: sCheckedMsgText
			Number: nCheckedMsgId
			String: sSql
			String: strMonth[12]              !! Наименов. месяце для календаря
			String: strWeekDays[7]         !! Дни недели для календаря
			Number: nFetchRes
			Number: i
			Boolean: bRet
			Date/Time: dSelect
			Date/Time: dFrom
			Date/Time: dTo
		Message Actions
			On SAM_Create
				Call GetMonthArray( strMonth )
				Call GetWeekDayArray( strWeekDays )
				! Call SalDisableWindow(calVPFrom)
				! Call SalDisableWindow(calVPTo)
				Call SalDisableWindow(calVal)
				Call SalCenterWindow ( hWndForm)
				!
				Call SalDisableWindow(pbMsgFromFile)
				Call SalDisableWindow(mlMsgText)
				Call SalDisableWindow(pbMsgFromSavedList)
				!
				Set nCheckedMsgId = 0
				Set bRet = FALSE
	Table Window: frm_kl_blk
		Class: cGenericTable
		Property Template:
		Class DLL Name:
		Title: Блокировка направлений клиент-казначесва
		Icon File:
		Accesories Enabled? Yes
		Visible? Yes
		Display Settings
			Visible at Design time? Yes
			Automatically Created at Runtime? No
			Initial State: Normal
			Maximizable? Yes
			Minimizable? Yes
			System Menu? Yes
			Resizable? Yes
			Window Location and Size
				Left:   Default
				Top:    Default
				Width:  15.317"
				Width Editable? Yes
				Height: 7.238"
				Height Editable? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
			View: Table
			Allow Row Sizing? No
			Lines Per Row: Default
		Memory Settings
			Maximum Rows in Memory: Default
			Discardable? No
		Description:
		Named Menus
		Menu
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Top
				Visible? Yes
				Size: 0.417"
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
				Pushbutton: pbIns
					Class Child Ref Key: 33
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbDel
					Class Child Ref Key: 34
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbRefresh
					Class Child Ref Key: 35
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbUpdate
					Class Child Ref Key: 36
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 20415
					Class Child Ref Key: 37
					Class ChildKey: 0
					Class: cGenericTable
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? Class Default
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Pushbutton: pbSearch
					Class Child Ref Key: 38
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbFilter
					Class Child Ref Key: 44
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbDetails
					Class Child Ref Key: 39
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbPrint
					Class Child Ref Key: 40
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 20416
					Class Child Ref Key: 41
					Class ChildKey: 0
					Class: cGenericTable
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? Class Default
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Pushbutton: pbExit
					Class Child Ref Key: 42
					Class ChildKey: 0
					Class: cGenericTable
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 20417
					Class Child Ref Key: 43
					Class ChildKey: 0
					Class: cGenericTable
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? Class Default
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Line
					Resource Id: 12604
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class:
					Coordinates
						Begin X:  Default
						Begin Y:  Default
						End X:  Default
						End Y:  Default
					Visible? Yes
					Line Style: Solid
					Line Thickness: 1
					Line Color: Default
				Background Text: Для всех блокировка:
					Resource Id: 12605
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class:
					Window Location and Size
						Left:   4.7"
						Top:    0.14"
						Width:  1.983"
						Width Editable? Yes
						Height: 0.167"
						Height Editable? Yes
					Visible? Yes
					Justify: Left
					Font Name: Default
					Font Size: Default
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
				! Combo Box: cbBlkForAll 
.winattr
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class:
					Property Template:
					Class DLL Name:
					Window Location and Size
						Left:   6.7"
						Top:    0.083"
						Width:  1.983"
						Width Editable? Yes
						Height: 0.881"
						Height Editable? Yes
					Visible? Yes
					Editable? Yes
					String Type: String
					Maximum Data Length: Default
					Sorted? Yes
					Always Show List? No
					Vertical Scroll? Yes
					Font Name: Default
					Font Size: Default
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
					Input Mask: Unformatted
.end
					                                  List Initialization 
					                                  Message Actions 
						                                  On SAM_Click
							                                  Set iBlkForAll=cbBlkForAll.GetKey(SalListQuerySelection( cbBlkForAll) )
							                                  Set iRow = TBL_MinRow
							                                  While SalTblFindNextRow(hWndForm, iRow, 0, 0)
								                                  Call SalTblSetContext( hWndForm, iRow )
								                                  Call frm_kl_blk.cbBlkCode.SetSelectById(iBlkForAll)
								                                  Call SalSendMsg(frm_kl_blk.cbBlkCode, SAM_AnyEdit, 0, 0)
								                                  Call SalTblSetRowFlags (hWndForm, iRow, ROW_Edited, TRUE )
								                                  Call SalSendMsg(frm_kl_blk, UM_Update, 0, 0)
						                                  On SAM_Create
							                                  If cbBlkForAll.Init(hWndItem)
								                                  Call cbBlkForAll.Add(0,"Нету")
								                                  Call cbBlkForAll.Add(0,"Входящих")
								                                  Call cbBlkForAll.Add(0,"Исходящих")
								                                  Call cbBlkForAll.Add(0,"Вход+Исход")
				Combo Box: cbBlkForAll 
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class: cGenComboBox_NumId
					Property Template:
					Class DLL Name:
					Window Location and Size
						Left:   6.7"
						Top:    0.083"
						Width:  2.583"
						Width Editable? Class Default
						Height: 0.881"
						Height Editable? Class Default
					Visible? Class Default
					Editable? Class Default
					String Type: Class Default
					Maximum Data Length: Class Default
					Sorted? Class Default
					Always Show List? Class Default
					Vertical Scroll? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Input Mask: Class Default
					List Initialization
					Message Actions
						On SAM_Click
							Set iBlkForAll=cbBlkForAll.GetKey(SalListQuerySelection( cbBlkForAll) )
							Set iRow = TBL_MinRow
							While SalTblFindNextRow(hWndForm, iRow, 0, 0)
								Call SalTblSetContext( hWndForm, iRow )
								Call frm_kl_blk.cbBlkCode.SetSelectById(iBlkForAll)
								Call SalSendMsg(frm_kl_blk.cbBlkCode, SAM_AnyEdit, 0, 0)
								Call SalTblSetRowFlags (hWndForm, iRow, ROW_Edited, TRUE )
								Call SalSendMsg(frm_kl_blk, UM_Update, 0, 0)
						On SAM_Create
							If cbBlkForAll.Init(hWndItem)
								Call cbBlkForAll.Add(0,"Нету")
								Call cbBlkForAll.Add(1,"Входящих")
								Call cbBlkForAll.Add(2,"Исходящих")
								Call cbBlkForAll.Add(3,"Вход+Исход")
		Contents
			Column: colRnk
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: РНК
				Visible? Yes
				Editable? Yes
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  1.05"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
				! List Values 
				! Message Actions 
			Column: colSab
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Электр.
						идентиф.
				Visible? Yes
				Editable? Yes
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  1.033"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
				! List Values 
				! Message Actions 
			Column: colName
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Клиент
				Visible? Yes
				Editable? Yes
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  2.817"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
				! List Values 
				! Message Actions 
			! Column: cbBlkCode
.winattr
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Код
						блок.
				Visible? Yes
				Editable? Yes
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  0.683"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
.end
				                                  List Values 
				                                  Message Actions 
					                                  On SAM_Create
						                                  If cbBlkCode.Init( hWndItem )
							                                  Call cbBlkCode.Add( 0, 'Нету' )
							                                  Call cbBlkCode.Add( 1, 'Входящих' )
							                                  Call cbBlkCode.Add( 2, 'Исходящих' )
							                                  Call cbBlkCode.Add( 3, 'Вход+Исход' )
					                                  On SAM_AnyEdit
						                                  Set colBlkCode = cbBlkCode.GetKey( SalListQuerySelection( cbBlkCode) )
			Column: colBlkCode
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Код
						блок.
				Visible? No
				Editable? Yes
				Maximum Data Length: Default
				Data Type: Number
				Justify: Left
				Width:  0.95"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
					On SAM_AnyEdit
						Call frm_kl_blk.cbBlkCode.SetSelectById(iBlkForAll)
			Column: colchbMakeVP
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Выписка
				Visible? Yes
				Editable? Yes
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  0.933"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
				! List Values 
				! Message Actions 
			Column: colPostType
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Тип 
						обмена
				Visible? No
				Editable? Yes
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  1.017"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
				! List Values 
				! Message Actions 
			Column: cbBlkCode
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cGenColComboBox_NumId
				Property Template:
				Class DLL Name:
				Title: Код 
						блокир.
				Visible? Class Default
				Editable? Class Default
				Maximum Data Length: Class Default
				Data Type: Class Default
				Justify: Class Default
				Width:  1.317"
				Width Editable? Class Default
				Format: Class Default
				Country: Class Default
				Input Mask: Class Default
				Cell Options
					Cell Type? Class Default
					Multiline Cell? Class Default
					Cell DropDownList
						Sorted? Class Default
						Vertical Scroll? Class Default
						Auto Drop Down? Class Default
						Allow Text Editing? Class Default
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Class Default
				List Values
				Message Actions
					On SAM_Create
						If cbBlkCode.Init( hWndItem )
							Call cbBlkCode.Add( 0, 'Нету' )
							Call cbBlkCode.Add( 1, 'Входящих' )
							Call cbBlkCode.Add( 2, 'Исходящих' )
							Call cbBlkCode.Add( 3, 'Вход+Исход' )
					On SAM_AnyEdit
						Set colBlkCode = cbBlkCode.GetKey( SalListQuerySelection( cbBlkCode) )
			Column: cbPostType
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cGenColComboBox_StrId
				Property Template:
				Class DLL Name:
				Title: Тип обмена
				Visible? Class Default
				Editable? Class Default
				Maximum Data Length: Class Default
				Data Type: Class Default
				Justify: Class Default
				Width:  Class Default
				Width Editable? Class Default
				Format: Class Default
				Country: Class Default
				Input Mask: Class Default
				Cell Options
					Cell Type? Class Default
					Multiline Cell? Class Default
					Cell DropDownList
						Sorted? Class Default
						Vertical Scroll? Class Default
						Auto Drop Down? Class Default
						Allow Text Editing? Class Default
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Class Default
				List Values
				Message Actions
					On SAM_Create
						If cbPostType.Init( hWndItem )
							Call cbPostType.Add('O', 'Offline' )
							Call cbPostType.Add('M', 'Mail' )
					On SAM_AnyEdit
						Set colPostType=cbPostType.GetKey( SalListQuerySelection( cbPostType) )
			! Column: cbPostType
.winattr
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Тип 
						обмена
				Visible? Yes
				Editable? Yes
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  Default
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
.end
				                                  List Values 
				                                  Message Actions 
					                                  On SAM_Create
						! If cbPostType.Init( hWndItem )
							                                                  Call cbPostType.Add('O', 'Offline' )
							                                                  Call cbPostType.Add('M', 'Mail' )
					                                  On SAM_AnyEdit
						                                  Set colPostType=cbPostType.GetKey( SalListQuerySelection( cbPostType) )
				! List Values 
				! Message Actions 
			Column: colEMail
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Title: Эл. адресс
				Visible? Yes
				Editable? Yes
				Maximum Data Length: Default
				Data Type: String
				Justify: Left
				Width:  4.183"
				Width Editable? Yes
				Format: Unformatted
				Country: Default
				Input Mask: Unformatted
				Cell Options
					Cell Type? Standard
					Multiline Cell? No
					Cell DropDownList
						Sorted? Yes
						Vertical Scroll? Yes
						Auto Drop Down? No
						Allow Text Editing? Yes
					Cell CheckBox
						Check Value:
						Uncheck Value:
						Ignore Case? Yes
				List Values
				Message Actions
				! List Values 
				! Message Actions 
		Functions
		Window Parameters
		Window Variables
			Number: iBlkForAll
			Number: iRow
		Message Actions
			On UM_Populate
				Call SalSendClassMessage(UM_Populate, 0, 0)
			On SAM_Create
				Call SalDisableWindow(pbIns)
				Call SalDisableWindow(pbDel)
				Set frm_kl_blk.strSqlPopulate =
						   "SELECT cp.rnk, sab, nmk, blk, make_vp,email,post_type
						    INTO :frm_kl_blk.colRnk, :frm_kl_blk.colSab, :frm_kl_blk.colName,
						         :frm_kl_blk.colBlkCode, :colchbMakeVP, :colEMail, :colPostType
						    FROM kl_customer_params cp, customer c
						    WHERE cp.rnk=c.rnk"
				Set frm_kl_blk.strSqlUpdate =
						   "UPDATE kl_customer_params
						           SET  blk =      :frm_kl_blk.colBlkCode,
						                email=     :frm_kl_blk.colEMail,
						                make_VP =  :frm_kl_blk.colchbMakeVP,
						                post_type = :frm_kl_blk.colPostType
						    WHERE rnk=:frm_kl_blk.colRnk"
				Call SalSendClassMessage(SAM_Create, 0, 0)
				Call SalSendClassMessage(UM_Create, 0, 0)
			On SAM_FetchRowDone
				Call cbBlkCode.SetSelectById( colBlkCode )
				Call cbPostType.SetSelectById( colPostType )
	Form Window: spl_RepGroups
		Class: cGenericTableSpl3
		Property Template:
		Class DLL Name:
		Title: Конструктор звітних груп виписок
		Icon File:
		Accesories Enabled? Class Default
		Visible? Class Default
		Display Settings
			Display Style? Class Default
			Visible at Design time? Yes
			Automatically Created at Runtime? Class Default
			Initial State: Class Default
			Maximizable? Class Default
			Minimizable? Class Default
			System Menu? Class Default
			Resizable? Class Default
			Window Location and Size
				Left:   Default
				Top:    Default
				Width:  Class Default
				Width Editable? Class Default
				Height: Class Default
				Height Editable? Class Default
			Form Size
				Width:  Class Default
				Height: Class Default
				Number of Pages: Class Default
			Font Name: Class Default
			Font Size: Class Default
			Font Enhancement: Class Default
			Text Color: Class Default
			Background Color: Class Default
		Description:
		Named Menus
		Menu
		Tool Bar
			Display Settings
				Display Style? Class Default
				Location? Class Default
				Visible? Class Default
				Size: Class Default
				Size Editable? Class Default
				Font Name: Class Default
				Font Size: Class Default
				Font Enhancement: Class Default
				Text Color: Class Default
				Background Color: Class Default
			Contents
				Pushbutton: pbIns
					Class Child Ref Key: 15
					Class ChildKey: 0
					Class: cGenericTableSpl3
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							Call SalSendMsg( hWndLost, UM_Insert, 0, 0 )
				Pushbutton: pbDel
					Class Child Ref Key: 16
					Class ChildKey: 0
					Class: cGenericTableSpl3
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							Call SalSendMsg( hWndLost, UM_Delete, 0, 0 )
				Pushbutton: pbRefresh
					Class Child Ref Key: 17
					Class ChildKey: 0
					Class: cGenericTableSpl3
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbUpdate
					Class Child Ref Key: 18
					Class ChildKey: 0
					Class: cGenericTableSpl3
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							Call SalSendMsg( hWndLost, UM_Update, 0, 0 )
							Call SalSendMsg( tbl2,     UM_Update, 0, 0 )
							Call SalSendMsg( tbl,      UM_Update, 0, 0 )
				Line
					Resource Id: 4727
					Class Child Ref Key: 19
					Class ChildKey: 0
					Class: cGenericTableSpl3
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? Class Default
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Pushbutton: pbSearch
					Class Child Ref Key: 20
					Class ChildKey: 0
					Class: cGenericTableSpl3
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbFilter
					Class Child Ref Key: 21
					Class ChildKey: 0
					Class: cGenericTableSpl3
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Pushbutton: pbDetails
					Class Child Ref Key: 31
					Class ChildKey: 0
					Class: cGenericTableSpl3
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name: \BARS98\RESOURCE\BMP\BOOK.BMP
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
						On SAM_Click
							! Call FunNSIEditF("rep_otchgrp",7)
							Call FunNSIEditControlled( "rep_otchgrp", cmbGroups, SAM_Create )
							! Call Debug('XXX')
							! Call cmbGroups.Populate( hSql(), 'otchgrp', "otchgrp||'-'||name", 'rep_otchgrp', 'ORDER BY name' )
				Pushbutton: pbPrint
					Class Child Ref Key: 22
					Class ChildKey: 0
					Class: cGenericTableSpl3
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 4728
					Class Child Ref Key: 23
					Class ChildKey: 0
					Class: cGenericTableSpl3
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? Class Default
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Pushbutton: pbExit
					Class Child Ref Key: 25
					Class ChildKey: 0
					Class: cGenericTableSpl3
					Property Template:
					Class DLL Name:
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Keyboard Accelerator: Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Picture File Name:
					Picture Transparent Color: Class Default
					Image Style: Class Default
					Text Color: Class Default
					Background Color: Class Default
					Message Actions
				Line
					Resource Id: 4729
					Class Child Ref Key: 26
					Class ChildKey: 0
					Class: cGenericTableSpl3
					Coordinates
						Begin X:  Class Default
						Begin Y:  Class Default
						End X:  Class Default
						End Y:  Class Default
					Visible? Class Default
					Line Style: Class Default
					Line Thickness: Class Default
					Line Color: Class Default
				Background Text: Гр.:
					Resource Id: 4730
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class:
					Window Location and Size
						Left:   5.283"
						Top:    0.119"
						Width:  1.35"
						Width Editable? Yes
						Height: 0.25"
						Height Editable? Yes
					Visible? Yes
					Justify: Right
					Font Name: Default
					Font Size: 10
					Font Enhancement: Bold
					Text Color: Default
					Background Color: Default
				Combo Box: cmbGroups
					Class Child Ref Key: 0
					Class ChildKey: 0
					Class: cGenComboBox_NumId
					Property Template:
					Class DLL Name:
					Window Location and Size
						Left:   6.683"
						Top:    0.095"
						Width:  4.9"
						Width Editable? Class Default
						Height: 5.679"
						Height Editable? Class Default
					Visible? Class Default
					Editable? No
					String Type: Class Default
					Maximum Data Length: Class Default
					Sorted? Class Default
					Always Show List? Class Default
					Vertical Scroll? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Bold
					Text Color: Class Default
					Background Color: System Window Color
					Input Mask: Class Default
					List Initialization
					Message Actions
						On SAM_Create
							If cmbGroups.Init( hWndItem )
								Call cmbGroups.Populate( hSql(), 'otchgrp', "otchgrp||'-'||name", 'rep_otchgrp', 'ORDER BY name' )
								Call cmbGroups.SetSelectById( nGrp )
						On SAM_Click
							Call SalSendClassMessage( SAM_Click, 0, 0 )
							Set nGrp=cmbGroups.nCurrentId
							Set nI = 0
							Call SalSendMsg( tbl, UM_Populate, 0, 0 )
		Contents
			Child Table: tbl
				Class Child Ref Key: 28
				Class ChildKey: 0
				Class: cGenericTableSpl3
				Property Template:
				Class DLL Name:
				Display Settings
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					View: Class Default
					Allow Row Sizing? Class Default
					Lines Per Row: Class Default
				Memory Settings
					Maximum Rows in Memory: Class Default
					Discardable? Class Default
				Contents
					Column: accgrp
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: № гр.
								рах.
						Visible? Yes
						Editable? Yes
						Maximum Data Length: Default
						Data Type: Number
						Justify: Left
						Width:  0.967"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: accgrp_name
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Назва групи рахунків
						Visible? Yes
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  2.783"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
							! On SAM_DoubleClick
								                      If bInsertingMode AND (nChooseState=1)
									                      Set bTmp=FALSE
									                      Call SalModalDialog( dlg_RepReference, tbl_RepGroups, 
											2, cConn.hSql(), 
											nTmp, sTmp, sTmp2, bTmp)
									                      If bTmp
										                      Set tbl_RepGroups.accgrp=nTmp
										                      Set tbl_RepGroups.accgrp_name=sTmp
										                      Set tbl_RepGroups.accgrp_filemask=sTmp2
					Column: accgrp_filemask
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Префікс
								імені файлу
						Visible? Yes
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  1.633"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: accgrp_dir
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Каталог формування
								файлу 
						Visible? Yes
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  2.7"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
				Functions
				Window Variables
					Number: x
				Message Actions
					On UM_Populate
						Set spl_RepGroups.strSqlPopulate= 
								" SELECT  a.accgrp, a.name, a.filemask, a.grpdir 
								    INTO :spl_RepGroups.tbl.accgrp,
								         :spl_RepGroups.tbl.accgrp_name,
								         :spl_RepGroups.tbl.accgrp_filemask,
								         :spl_RepGroups.tbl.accgrp_dir
								    FROM  rep_otchgrp o, rep_accgrp a, rep_accg_otchg t
								   WHERE o.otchgrp=t.otchgrp AND a.accgrp=t.accgrp AND o.otchgrp=:nGrp
								   ORDER BY o.otchgrp, a.accgrp "
						Call SalTblDefineSplitWindow(hWndForm, 0, FALSE)
						Call SalSendClassMessage(UM_Populate, 0, 0)
						Call VisTblAutoSizeColumn(hWndForm, tbl.accgrp_name)
						! ! Установить на старое место
						Set nRow = VisTblFindNumber (tbl, 0, tbl.accgrp, nID)
						If nRow=-1
							Call SalTblSetContext( hWndForm, 0 )
						Else
							Call SalTblSetContext( hWndForm, nRow )
							Call SalTblSetRowFlags( hWndForm, nRow, ROW_Selected, TRUE )
							Call SalTblSetFocusRow( hWndForm, nRow )
						Call SalSendMsg(tbl, SAM_TblDoDetails, 0, 0)
					On SAM_TblDoDetails
						Call SalSendMsg(tbl2,UM_Populate,0,0)
					On SAM_KillFocus
						Set hWndLost=hWndForm
						Set nID=tbl.accgrp
					! On SAM_Create
						                   Set spl_RepGroups.strSqlDelete='DELETE FROM rep_accg_otchg
								                   WHERE accgrp=:spl_RepGroups.tbl.accgrp AND otchgrp=:nGrp'
						                   Set spl_RepGroups.strSqlInsert='
								BEGIN
								 INSERT INTO rep_accgrp (accgrp, name, filemask, grpdir)
								     VALUES( :spl_RepGroups.tbl.accgrp, 
								             :spl_RepGroups.tbl.accgrp_name,
								             :spl_RepGroups.tbl.accgrp_filemask,
								             :spl_RepGroups.tbl.accgrp_dir );
								END;'
						! If SqlPrepareAndExecute(cConn.hSql(), 
								   " INSERT INTO rep_accgrp (accgrp, name, filemask, grpdir)
								     VALUES( :nTmp, 
								             :tbl_RepGroups.accgrp_name,
								             :tbl_RepGroups.accgrp_filemask,
								             :tbl_RepGroups.accgrp_dir   ) ")
							                   If not SqlPrepareAndExecute(cConn.hSql(), 
									        " INSERT INTO rep_accg_otchg (accgrp, otchgrp)
									          VALUES (:nTmp, :tbl_RepGroups.otchgrp) ")
								                   Set sErrMsg='Ошибка вставки в таблицу rep_accg_otchg'
								                   Return -1
						! Set strSqlUpdate='
								 UPDATE specparam SET idg=:colIdg,ids=:colIds,sps=nvl(:colSps,1)  WHERE acc=:colAcc'
						                   Call SalSendClassMessage( SAM_Create, 0, 0 )
					On UM_Update
						Call SalWaitCursor(TRUE)
						! INSERT
						Set nRow = TBL_MinRow
						While SalTblFindNextRow ( hWndForm, nRow, ROW_New, 0 )
							Call SalTblSetContext( hWndForm, nRow )
							!
							Call SqlPrepareAndExecute( cMain.hSql(),
									"SELECT accgrp, name, filemask, grpdir 
									   INTO :spl_RepGroups.tbl.accgrp, 
									        :spl_RepGroups.tbl.accgrp_name,
									        :spl_RepGroups.tbl.accgrp_filemask,
									        :spl_RepGroups.tbl.accgrp_dir FROM rep_accgrp
									  WHERE accgrp=:spl_RepGroups.tbl.accgrp")
							If not SqlFetchNext( cMain.hSql(), nFetchRes )
								If not SqlPrepareAndExecute(cMain.hSql(), 
										   "INSERT INTO rep_accgrp (accgrp, name, filemask, grpdir)
										     VALUES( :spl_RepGroups.tbl.accgrp, 
										             :spl_RepGroups.tbl.accgrp_name,
										             :spl_RepGroups.tbl.accgrp_filemask,
										             :spl_RepGroups.tbl.accgrp_dir )")
									Break
							If not SqlPrepareAndExecute(cMain.hSql(), 
									        " INSERT INTO rep_accg_otchg (accgrp, otchgrp)
									          VALUES (:spl_RepGroups.tbl.accgrp, :nGrp) ")
								Break
							Call SqlCommit(cMain.hSql())
						Call SqlRollback(cMain.hSql())
						! DELETE
						Set nRow = TBL_MinRow
						While SalTblFindNextRow ( hWndForm, nRow, ROW_MarkDeleted, 0 )
							Call SalTblSetContext( hWndForm, nRow )
							!
							Call SqlPrepareAndExecute( cMain.hSql(),
									"SELECT count(*) INTO :x FROM rep_accg_otchg
									  WHERE accgrp=:spl_RepGroups.tbl.accgrp")
							Call SqlFetchNext( cMain.hSql(), nFetchRes )
							If not SqlPrepareAndExecute(cMain.hSql(), 
									  "DELETE FROM rep_accg_otchg
									    WHERE accgrp=:spl_RepGroups.tbl.accgrp AND otchgrp=:nGrp")
								Break
							!
							If x = 1
								If not SqlPrepareAndExecute(cMain.hSql(), 
										  "DELETE FROM rep_acc WHERE accgrp=:spl_RepGroups.tbl.accgrp")
									Break
								If not SqlPrepareAndExecute(cMain.hSql(), 
										  "DELETE FROM rep_accgrp WHERE accgrp=:spl_RepGroups.tbl.accgrp")             
									Break
							Call SqlCommit(cMain.hSql())
						Call SqlRollback(cMain.hSql())
						! UPDATE
						Set nRow = TBL_MinRow
						While SalTblFindNextRow ( hWndForm, nRow, ROW_Edited, 0 )
							Call SalTblSetContext( hWndForm, nRow )
							If not SqlPrepareAndExecute(cMain.hSql(), 
									  "UPDATE rep_accgrp 
									      SET name    =:spl_RepGroups.tbl.accgrp_name, 
									         filemask =:spl_RepGroups.tbl.accgrp_filemask,
									         grpdir   =:spl_RepGroups.tbl.accgrp_dir  
									    WHERE  accgrp =:spl_RepGroups.tbl.accgrp")
								Break
							Call SqlCommit(cMain.hSql())
						Call SqlRollback(cMain.hSql())
						Call SalSendMsg(tbl, UM_Populate, 0, 0)
						Call SalWaitCursor(FALSE)
			Custom Control: ccSplitter
				Class Child Ref Key: 36
				Class ChildKey: 0
				Class: cGenericTableSpl3
				Property Template:
				Class DLL Name:
				Display Settings
					DLL Name:
					MS Windows Class Name:
					Style:  Class Default
					ExStyle:  Class Default
					Title:
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Border? Class Default
					Etched Border? Class Default
					Hollow? Class Default
					Vertical Scroll? Class Default
					Horizontal Scroll? Class Default
					Tab Stop? Class Default
					Tile To Parent? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					DLL Settings
				Message Actions
			Child Table: tbl2
				Class Child Ref Key: 35
				Class ChildKey: 0
				Class: cGenericTableSpl3
				Property Template:
				Class DLL Name:
				Display Settings
					Window Location and Size
						Left:   Class Default
						Top:    Class Default
						Width:  Class Default
						Width Editable? Class Default
						Height: Class Default
						Height Editable? Class Default
					Visible? Class Default
					Font Name: Class Default
					Font Size: Class Default
					Font Enhancement: Class Default
					Text Color: Class Default
					Background Color: Class Default
					View: Class Default
					Allow Row Sizing? Class Default
					Lines Per Row: Class Default
				Memory Settings
					Maximum Rows in Memory: Class Default
					Discardable? Class Default
				Contents
					! Column: accgrp
.winattr
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: № группы 
								 счетов
						Visible? Yes
						Editable? No
						Maximum Data Length: Default
						Data Type: Number
						Justify: Left
						Width:  0.967"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
.end
						                    List Values 
						                    Message Actions 
					Column: nlsmask
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title: Маска чи номер
								рахунку
						Visible? Yes
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  2.4"
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
					Column: colRowId
						Class Child Ref Key: 0
						Class ChildKey: 0
						Class:
						Property Template:
						Class DLL Name:
						Title:
						Visible? No
						Editable? Yes
						Maximum Data Length: Default
						Data Type: String
						Justify: Left
						Width:  Default
						Width Editable? Yes
						Format: Unformatted
						Country: Default
						Input Mask: Unformatted
						Cell Options
							Cell Type? Standard
							Multiline Cell? No
							Cell DropDownList
								Sorted? Yes
								Vertical Scroll? Yes
								Auto Drop Down? No
								Allow Text Editing? Yes
							Cell CheckBox
								Check Value:
								Uncheck Value:
								Ignore Case? Yes
						List Values
						Message Actions
				Functions
				Window Variables
				Message Actions
					On UM_Populate
						Set strSqlPopulate=
								 " SELECT  a.nlsmask,a.ROWID
								     INTO :spl_RepGroups.tbl2.nlsmask, :spl_RepGroups.tbl2.colRowId                                         
								     FROM rep_acc a 
								    WHERE a.accgrp=:spl_RepGroups.tbl.accgrp 
								    ORDER BY a.accgrp, a.nlsmask"
						Call SalTblDefineSplitWindow(hWndForm, 0, FALSE)
						Call SalSendClassMessage(UM_Populate, 0, 0)
						!
						Call VisTblAutoSizeColumn(hWndForm, hWndNULL)
						! ! Установить на старое место
						Set nRow = VisTblFindString (tbl2, 0, tbl2.nlsmask, sID)
						If nRow=-1
							Call SalTblSetContext( hWndForm, 0 )
						Else
							Call SalTblSetContext( hWndForm, nRow )
							Call SalTblSetRowFlags( hWndForm, nRow, ROW_Selected, TRUE )
							Call SalTblSetFocusRow( hWndForm, nRow )
					On SAM_KillFocus
						Set hWndLost=hWndForm
						Set sID=tbl2.nlsmask
					On UM_Insert
						If not SalTblAnyRows(hWndForm, ROW_New, 0)
							Call SalTblDefineSplitWindow(hWndForm, 3, TBL_Split_Adjustable)
						Set nRow = SalTblInsertRow(hWndForm, TBL_MinRow)
						Call SalTblSetContext(hWndForm, nRow)
						Call SalTblSetFocusCell(hWndForm, nRow, tbl.GetFirstEditableColumn(hWndForm), 0, 1)
					On UM_Delete
						Set nRow = TBL_MinRow
						While SalTblFindNextRow(hWndForm, nRow, ROW_Selected, 0)
							If NOT SalTblQueryRowFlags(hWndForm, nRow, ROW_New)
								Call SalTblSetRowFlags(hWndForm, nRow, ROW_MarkDeleted,
										     not SalTblQueryRowFlags(hWndForm, nRow, ROW_MarkDeleted))
							Else
								Call SalTblDeleteRow(hWndForm, nRow, TBL_NoAdjust)
					On SAM_Create
						Set strSqlDelete='DELETE FROM rep_acc 
								                  WHERE accgrp=:spl_RepGroups.tbl.accgrp AND
								                       nlsmask=:spl_RepGroups.tbl2.nlsmask'
						Set strSqlInsert='INSERT INTO rep_acc(accgrp, nlsmask)
								                  VALUES (:spl_RepGroups.tbl.accgrp,:spl_RepGroups.tbl2.nlsmask )'
						Set strSqlUpdate='UPDATE rep_acc SET nlsmask=:spl_RepGroups.tbl2.nlsmask
								                   WHERE rowid=:spl_RepGroups.tbl2.colRowId'
						Call SalSendClassMessage( SAM_Create, 0, 0 )
					On UM_Update
						Call SalWaitCursor(TRUE)
						If strSqlDelete != ''
							Call SqlPrepare(tbl.cMain.hSql(), T(strSqlDelete))
							Call SalTblDoDeletes(hWndForm, tbl.cMain.hSql(), ROW_MarkDeleted)
						If strSqlInsert != ''
							Call SqlPrepare(tbl.cMain.hSql(), T(strSqlInsert))
							Call SalTblDoInserts(hWndForm, tbl.cMain.hSql(), TRUE)
						If strSqlUpdate != ''
							Call SqlPrepare(tbl.cMain.hSql(), T(strSqlUpdate))
							Call SalTblDoUpdates(hWndForm, tbl.cMain.hSql(), TRUE)
						Call SqlCommit(tbl.cMain.hSql())
						Call SalTblDefineSplitWindow(hWndForm, 0, FALSE)
						Call SalSendMsg(hWndForm, UM_Populate, 0, 0)
						Call SalWaitCursor(FALSE)
		Functions
		Window Parameters
			Number: nPar
		Window Variables
			Number: nI
			Number: nGrp
			Number: nRow
			Number: nID
			String: sID
			Window Handle: hWndLost
		Message Actions
			On SAM_Create
				Call SalWaitCursor(TRUE)
				Call PrepareWindowEx( hWndForm )
				Call SetWindowFullSize( hWndForm )
				! Call ShowApdVersion('06')
				Set spl_RepGroups.nFlags=GT_NoRet
				Set spl_RepGroups.nTabInstance1 = 1
				Set spl_RepGroups.nTabInstance2 = 1
				Set fFilterAtStart=FALSE
				! Set strFilterTblName = 'accounts'
				! Set strPrintFileName = 'VYP.txt'
				Call SalTblSetTableFlags(tbl, TBL_Flag_SingleSelection, TRUE)
				! Созданием списка операций для обработки
				Call SalSendClassMessage(SAM_Create, 0, 0)
				! Call ccSplitter.setBarPosition( 650 )
				! Call tbl.cF.Init(strFilterTblName, 'a')
