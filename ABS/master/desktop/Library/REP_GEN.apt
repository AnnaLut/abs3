Application Description: Centura  Builder starter application
	Outline Version - 4.0.26
	Design-time Settings
.data VIEWINFO
0000: 6F00000001000000 FFFF01000D004347 5458566965775374 6174650400010000
0020: 0000000000C80000 002C000000020000 0003000000FFFFFF FFFFFFFFFFFCFFFF
0040: FFE8FFFFFFFFFFFF FF000000007C0200 004D010000010000 0000000000010000
0060: 000F4170706C6963 6174696F6E497465 6D00000000
.enddata
.data DT_MAKERUNDLG
0000: 0000000000175C42 41525339385C4249 4E5C5245505F4745 4E2E455845175C42
0020: 41525339385C4249 4E5C5245505F4745 4E2E646C6C175C42 41525339385C4249
0040: 4E5C5245505F4745 4E2E617063000001 01011D443A5C4241 525339385C4C4942
0060: 524152595C524550 5F47454E2E72756E 1D443A5C42415253 39385C4C49425241
0080: 52595C5245505F47 454E2E646C6C1D44 3A5C424152533938 5C4C494252415259
00A0: 5C5245505F47454E 2E61706300000101 011D443A5C424152 5339385C4C494252
00C0: 4152595C5245505F 47454E2E6170641D 443A5C4241525339 385C4C4942524152
00E0: 595C5245505F4745 4E2E646C6C1D443A 5C4241525339385C 4C4942524152595C
0100: 5245505F47454E2E 6170630000010101 1D443A5C42415253 39385C4C49425241
0120: 52595C5245505F47 454E2E61706C1D44 3A5C424152533938 5C4C494252415259
0140: 5C5245505F47454E 2E646C6C1D443A5C 4241525339385C4C 4942524152595C52
0160: 45505F47454E2E61 70630000010101
.enddata
		Outline Window State: Normal
		Outline Window Location and Size
.data VIEWINFO
0000: 6600040003002D00 0000000000000000 0000B71E5D0E0500 1D00FFFF4D61696E
0020: 0000000000000000 0000000000000000 0000003B00010000 00000000000000E9
0040: 1E800A00008600FF FF496E7465726E61 6C2046756E637469 6F6E730000000000
0060: 0000000000000000 0000000000003200 0100000000000000 0000E91E800A0000
0080: DF00FFFF56617269 61626C6573000000 0000000000000000 0000000000000000
00A0: 3000010000000000 00000000F51E100D 0000F400FFFF436C 6173736573000000
00C0: 0000000000000000 0000000000000000
.enddata
.data VIEWSIZE
0000: D000
.enddata
			Left:   -0.013"
			Top:    0.0"
			Width:  8.013"
			Height: 4.969"
		Options Box Location
.data VIEWINFO
0000: 0038B80BB80B2500
.enddata
.data VIEWSIZE
0000: 0800
.enddata
			Visible? Yes
			Left:   4.15"
			Top:    1.885"
			Width:  3.8"
			Height: 2.073"
		Class Editor Location
			Visible? No
			Left:   0.575"
			Top:    0.094"
			Width:  5.063"
			Height: 2.719"
		Tool Palette Location
			Visible? No
			Left:   6.388"
			Top:    0.729"
		Fully Qualified External References? Yes
		Reject Multiple Window Instances? No
		Enable Runtime Checks Of External References? Yes
		Use Release 4.0 Scope Rules? No
	Libraries
		Dynalib: otcn.apd
		File Include: VTFILE.APL
		File Include: VTDOS.APL
		File Include: VT.APL
	Global Declarations
		Window Defaults
			Tool Bar
				Display Style? Etched
				Font Name: MS Sans Serif
				Font Size: 8
				Font Enhancement: System Default
				Text Color: System Default
				Background Color: System Default
			Form Window
				Display Style? Etched
				Font Name: MS Sans Serif
				Font Size: 8
				Font Enhancement: System Default
				Text Color: System Default
				Background Color: System Default
			Dialog Box
				Display Style? Etched
				Font Name: MS Sans Serif
				Font Size: 8
				Font Enhancement: System Default
				Text Color: System Default
				Background Color: System Default
			Top Level Table Window
				Font Name: MS Sans Serif
				Font Size: 8
				Font Enhancement: System Default
				Text Color: System Default
				Background Color: System Default
			Data Field
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Multiline Field
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Spin Field
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Background Text
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Pushbutton
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
			Radio Button
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Check Box
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Option Button
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
			Group Box
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Child Table Window
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			List Box
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Combo Box
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Line
				Line Color: Use Parent
			Frame
				Border Color: Use Parent
				Background Color: 3D Face Color
			Picture
				Border Color: Use Parent
				Background Color: Use Parent
		Formats
			Number: 0'%'
			Number: #0
			Number: ###000
			Number: ###000;'($'###000')'
			Date/Time: hh:mm:ss AMPM
			Date/Time: M/d/yy
			Date/Time: MM-dd-yy
			Date/Time: dd-MMM-yyyy
			Date/Time: MMM d, yyyy
			Date/Time: MMM d, yyyy hh:mm AMPM
			Date/Time: MMMM d, yyyy hh:mm AMPM
		External Functions
			Library name: kernel32
				Function: ExitProcess
					Description:
					Export Ordinal: 0
					Returns
					Parameters
						Number: UINT
		Constants
.data CCDATA
0000: 3000000000000000 0000000000000000 00000000
.enddata
.data CCSIZE
0000: 1400
.enddata
			System
			User
		Resources
		Variables
			! Ошибки выхода процесса
					1 - Неправильное количество аргументов
					2 - Ид. сессии задан неверно
					3 - Неверный формат экспорта файла ( поддерживается только 3 и 6 )
					4 - Ошибка при соединении с СУБД
					5 - Ошибка установки роли
					6 - Сесиия не найдена
					7 - Шаблон отчета не найден
					8 - Ошибка при компиляции SQL выражения для получения данных из промежуточной таблицы (RS_TMP_REPORT_DATA)
					9 - Ошибка выполнения SQL выражения для получения данных из промежуточной таблицы (RS_TMP_REPORT_DATA)
					100 + № ошибки - Ошибка, возвращаемая SalReportPrintToFile
			Number: nExitCode
			! **********Параметры*EXE************ !
			! Имя БД
			String: sDBName
			! Ид. сессии
			Number: nSessionId
			! Ид. формата (3-txt, 6-rtf)
			Number: nFormat
			! Имя файла для формирования отчета
			String: sReportFileName
			! Каталог шаблонов отчетов
			String: sTemplateDir
			! Параметр включения трассировки в файл
			Boolean: bTraceOn
			! Путь файла трассировки
			String: sTraceFileName
			! **********Финиш************ !
			Sql Handle: hSql
			Sql Handle: hSqlAux
			Sql Handle: hSqlEx
			! *************************** !
			Boolean: DebuggingOn
			String: sDumpParams
		Internal Functions
			Function: WrapExitProcess
				Description:
				Returns
				Parameters
					Number: nExitCode_
				Static Variables
				Local variables
					String: sMessage
				Actions
					If nExitCode_!=0
						If DebuggingOn
							Select Case nExitCode_
								Case 1
									Set sMessage='Неправильное количество аргументов: ' || SalNumberToStrX( nArgCount, 0 )
									Break
								Case 2
									Set sMessage='Ид. сессии задан неверно'
									Break
								Case 3
									Set sMessage='Неверный формат экспорта файла ( поддерживается только 3 и 6 )'
									Break
								Case 4
									Set sMessage='Ошибка при соединении с СУБД'
									Break
								Case 5
									Set sMessage='Ошибка установки роли'
									Break
								Case 6
									Set sMessage='Сесиия не найдена'
									Break
								Case 7
									Set sMessage='Шаблон отчета не найден'
									Break
								Case 8
									Set sMessage='Ошибка при компиляции SQL выражения для получения данных из промежуточной таблицы (RS_TMP_REPORT_DATA)'
									Break
								Case 9
									Set sMessage='Ошибка выполнения SQL выражения для получения данных из промежуточной таблицы (RS_TMP_REPORT_DATA)'
									Break
								Default
									If nExitCode_>100 AND nExitCode_<=111
										Set sMessage='Ошибка SalReportPrintToFile № ' || SalNumberToStrX( nExitCode_-100, 0 )
									Else
										Set sMessage='Неизвестная ошибка!'
									Break
							Call TraceMessage('#'||SalNumberToStrX( nExitCode_, 0 ) || ' ' || sMessage)
							Call SalMessageBox( '#'||SalNumberToStrX( nExitCode_, 0 ) || ' ' || sMessage, 'Error', MB_Ok | MB_IconStop )
						Call ExitProcess( nExitCode_ )
					Else
						If DebuggingOn
							Call SalMessageBox( 'Выполнение успешно завершено!', 'Отладка', MB_Ok | MB_IconInformation )
						Call SalQuit()
						! Call ExitProcess( nExitCode_ )
		Named Menus
		Class Definitions
.data RESOURCE 0 0 1 3056680119
0000: C903000099010000 0000000000000000 0200000500FFFF01 00160000436C6173
0020: 73566172004F7574 6C696E6552006567 496E666F8F003C00 000F63004465736B
0040: 746F704C00697374 426F782201C00000 0B00000083010D00 0000FFFFE40D0000
0060: 01FE00FF831A0000 0001FB00FF0F2700 0000EE0100FF3F34 00B800000100FFFF
0080: E04100000001FE00 FF834E00000001FB 00FF0F5B000000EE 0100FF3F6800B800
00A0: 000100FFFFE07500 000001FE00FF8382 00000001FB00FF0F 0180340011000100
00C0: 000B63E04469724C 69036C0000000400 3C0000010DFB00FF 6F0D00EE0100FFBF
00E0: 1AB9000100FFFFE6 270001FE00FF4301 80270000E0020000 000F81547265654C
0100: 690F52000000F003 000000EC010D00FF BF0DB9000100FFFF E61A0001FE00FF43
0120: 01805B0000060300 0C634669F86C654C 01BA000000070000 9E00010DFD00FF37
0140: 0D0001F700FFDF1A DC000100FF7F2773 000100FFFFCD3400 01FD00FF37410001
0160: F700FFDF4EDC0001 00FF7F01C8804100 000400000D635261 64696F7C4C698690
0180: 0000000500006701 0D00FFFFC90D0000 01FD00FF371A0001 F700FFDF27DC0001
01A0: 00FF7F3473000100 FFFF01
.enddata
		Default Classes
			MDI Window: cBaseMDI
			Form Window:
			Dialog Box:
			Table Window:
			Quest Window:
			Data Field:
			Spin Field:
			Multiline Field:
			Pushbutton:
			Radio Button:
			Option Button:
			Check Box:
			Child Table:
			Quest Child Window: cQuickDatabase
			List Box:
			Combo Box:
			Picture:
			Vertical Scroll Bar:
			Horizontal Scroll Bar:
			Column:
			Background Text:
			Group Box:
			Line:
			Frame:
			Custom Control:
		Application Actions
			On SAM_AppStartup
				When SqlError
					Return FALSE
				Set DebuggingOn  =  FALSE
				Set bTraceOn = TRUE
				! Рабор параметров трассировки
				! 6
				If strArgArray[6] != 'true'
					Set bTraceOn = FALSE
				! 7
				Set sTraceFileName = strArgArray[7]
				! устанавливаем трассировку
				Call SetTracing( bTraceOn ) ! трассировка в файл включена
				! устанавливаем имя файла трассировки
				Call MakeTraceFileName()
				! старт приложения
				Call TraceMessage('------------------------------------------------------')
				Call TraceMessage('Start rep_gen.exe')
				! Разбор параметров
				Call TraceMessage( 'command line argument count: '
						||SalNumberToStrX( nArgCount, 0 ) )
				If nArgCount != 8
					Set nExitCode = 1
					Call WrapExitProcess( nExitCode )
					Return FALSE
				! 1
				Set sDBName = strArgArray[1]
				Call TraceMessage('sDBName = '||sDBName)
				! 2
				Set nSessionId = SalStrToNumber( strArgArray[2] )
				Call TraceMessage( 'nSessionId = ' || SalNumberToStrX( nSessionId, 0 ) )
				If SalNumberToStrX( nSessionId, 0 ) != strArgArray[2]
					Set nExitCode = 2
					Call WrapExitProcess( nExitCode )
					Return FALSE
				! 3
				Set nFormat = SalStrToNumber( strArgArray[3] )
				If SalNumberToStrX( nFormat, 0 ) != strArgArray[3]
					Set nExitCode = 3
					Call WrapExitProcess( nExitCode )
					Return FALSE
				Call TraceMessage('nFormat = ' || SalNumberToStrX( nFormat, 0) )
				! 4
				Set sReportFileName = strArgArray[4]
				Call TraceMessage('4 - ok ')
				! 5
				Set sTemplateDir = strArgArray[5]
				Call TraceMessage('5 - ok ')
				If DebuggingOn
					Set sDumpParams = 'sDBName=' || sDBName || '
							' ||
							'nSessionId=' || SalNumberToStrX( nSessionId, 0 ) || '
							' ||
							'nFormat=' || SalNumberToStrX( nFormat, 0 ) || '
							' ||
							'sReportFileName=' || sReportFileName || '
							' ||
							'sTemplateDir=' || sTemplateDir
					Call SalMessageBox( sDumpParams, 'Params dump', MB_Ok )
				Call TraceMessage('Before connect to database')
				! Установка соединения с БД
				Set SqlDatabase = sDBName
				Set SqlUser = 'RS_DUMP'
				Set SqlPassword = 'RS_DUMP'
				If NOT SqlConnect( hSql )
					Set nExitCode = 4
					Call TraceMessage('After connect to database hSql')
					Call WrapExitProcess( nExitCode )
					Return FALSE
				If NOT SqlConnect( hSqlAux )
					Set nExitCode = 4
					Call TraceMessage('After connect to database hSqlAux')
					Call WrapExitProcess( nExitCode )
					Return FALSE
				If NOT SqlConnect( hSqlEx )
					Set nExitCode = 4
					Call TraceMessage('After connect to database hSqlEx')
					Call WrapExitProcess( nExitCode )
					Return FALSE
				If NOT SqlPrepareAndExecute( hSql, 'SET ROLE RS' )
					Set nExitCode = 5
					Call WrapExitProcess( nExitCode )
					Return FALSE
				! Экспорт
				Set nExitCode=ExportCatQueryDotNet( hSql, hSqlAux, hSqlEx, nSessionId, nFormat, sReportFileName, sTemplateDir )
				! Закрытие соединений
				Call SqlDisconnect( hSqlAux )
				Call SqlDisconnect( hSqlEx )
				Call SqlDisconnect( hSql )
				Call TraceMessage( 'Finish rep_gen.exe with exit code = '||SalNumberToStrX(nExitCode,0) )
				Call TraceMessage('------------------------------------------------------')
				Call WrapExitProcess( nExitCode )
