.head 0 +  Application Description: технологические операции по обработке
файлов системы КЛИЕНТ-БАНК (ИКТ)
.head 1 -  Outline Version - 4.0.26
.head 1 +  Design-time Settings
.data VIEWINFO
0000: 6F00000001000000 FFFF01000D004347 5458566965775374 6174650400010000
0020: 0000000000CB0000 002C000000020000 0003000000FFFFFF FFFFFFFFFFFCFFFF
0040: FFE9FFFFFF000000 0000000000DE0100 0041010000010000 0001000000010000
0060: 000F4170706C6963 6174696F6E497465 6D00000000
.enddata
.data DT_MAKERUNDLG
0000: 0000000020513A5C 4241525339385C52 45534F555243455C 49434F5C4D6F6E65
0020: 792E69636F1A513A 5C4241525339385C 42494E5C4E6F6B6B 5F456C6B2E457865
0040: 18513A5C42415253 39385C42494E5C6E 65776170702E646C 6C18513A5C424152
0060: 5339385C42494E5C 6E65776170702E61 7063000001010115 513A5C43454E5455
0080: 52415C6E65776170 702E72756E15513A 5C43454E54555241 5C6E65776170702E
00A0: 646C6C15513A5C43 454E545552415C6E 65776170702E6170 6300000101011A51
00C0: 3A5C424152533938 5C42494E5C6B6C6F 705F656C6C2E6578 6518513A5C424152
00E0: 5339385C42494E5C 6E65776170702E64 6C6C18513A5C4241 525339385C42494E
0100: 5C6E65776170702E 6170630000010101 15513A5C43454E54 5552415C6E657761
0120: 70702E61706C1551 3A5C43454E545552 415C6E6577617070 2E646C6C15513A5C
0140: 43454E545552415C 6E65776170702E61 70630000010101
.enddata
.head 2 -  Outline Window State: Normal
.head 2 +  Outline Window Location and Size
.data VIEWINFO
0000: 6600040003002D00 0000000000000000 0000B71E5D0E0500 1D00FFFF4D61696E
0020: 0000000000000000 0000000000000000 0000003B00010000 00000000000000E9
0040: 1E800A00008600FF FF496E7465726E61 6C2046756E637469 6F6E730000000000
0060: 0000000000000000 0000000000003200 0100000000000000 0000E91E800A0000
0080: DF00FFFF56617269 61626C6573000000 0000000000000000 0000000000000000
00A0: 3000010000000000 00000000F51E100D 0000F400FFFF436C 6173736573000000
00C0: 0000000000000000 0000000000000000
.enddata
.data VIEWSIZE
0000: D000
.enddata
.head 3 -  Left:   -0.013"
.head 3 -  Top:    0.0"
.head 3 -  Width:  8.013"
.head 3 -  Height: 4.969"
.head 2 +  Options Box Location
.data VIEWINFO
0000: 0418B80BB80B2500
.enddata
.data VIEWSIZE
0000: 0800
.enddata
.head 3 -  Visible? Yes
.head 3 -  Left:   4.15"
.head 3 -  Top:    1.885"
.head 3 -  Width:  3.8"
.head 3 -  Height: 2.073"
.head 2 +  Class Editor Location
.head 3 -  Visible? No
.head 3 -  Left:   0.575"
.head 3 -  Top:    0.094"
.head 3 -  Width:  5.063"
.head 3 -  Height: 2.719"
.head 2 +  Tool Palette Location
.head 3 -  Visible? No
.head 3 -  Left:   6.388"
.head 3 -  Top:    0.729"
.head 2 -  Fully Qualified External References? Yes
.head 2 -  Reject Multiple Window Instances? No
.head 2 -  Enable Runtime Checks Of External References? Yes
.head 2 -  Use Release 4.0 Scope Rules? No
.head 1 +  Libraries
.head 2 -  Dynalib: Global.apd
.head 2 -  Dynalib: Message.apd
.head 2 -  Dynalib: Absapi.apd
.head 2 -  Dynalib: Nsiapi.apd
.head 2 -  Dynalib: DOCVIEW.APD
.head 2 -  Dynalib: Watchdog.apd
.head 2 -  Dynalib: Ssplashn.apd
.head 2 -  Dynalib: Dblogin.apd
.head 2 -  Dynalib: License.apd
.head 2 -  Dynalib: Dfltrapi.apd
.head 2 -  File Include: Gentimer.apl
.head 2 -  File Include: GenButn.apl
.head 2 -  File Include: GenFcls.apl
.head 2 -  File Include: Gentbl.apl
.head 2 -  File Include: Constant.apl
.head 2 -  File Include: Winbars2.apl
.head 2 -  File Include: Vtmeter.apl
.head 2 -  File Include: Vtdos.apl
.head 2 -  File Include: Vtlbx.apl
.head 2 -  File Include: Vttblwin.apl
.head 2 -  File Include: Vtfile.apl
.head 2 -  File Include: Ttp32.apl
.head 2 -  File Include: Docfun6.apl
.head 2 -  File Include: Genfiltr.apl
.head 2 -  File Include: vtcomm.apl
.head 2 -  File Include: vtmisc.apl
.head 2 -  File Include: vtstr.apl
.head 2 -  File Include: Winapi.apl
.head 1 +  Global Declarations
.head 2 +  Window Defaults
.head 3 +  Tool Bar
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Form Window
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Dialog Box
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Top Level Table Window
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Data Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Multiline Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Spin Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Background Text
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Pushbutton
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Radio Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Check Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Option Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Group Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Child Table Window
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  List Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Combo Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Line
.head 4 -  Line Color: Use Parent
.head 3 +  Frame
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: 3D Face Color
.head 3 +  Picture
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 2 +  Formats
.head 3 -  Number: 0'%'
.head 3 -  Number: #0
.head 3 -  Number: ###000
.head 3 -  Number: ###000;'($'###000')'
.head 3 -  Date/Time: hh:mm:ss AMPM
.head 3 -  Date/Time: M/d/yy
.head 3 -  Date/Time: MM-dd-yy
.head 3 -  Date/Time: dd-MMM-yyyy
.head 3 -  Date/Time: MMM d, yyyy
.head 3 -  Date/Time: MMM d, yyyy hh:mm AMPM
.head 3 -  Date/Time: MMMM d, yyyy hh:mm AMPM
.head 2 +  External Functions
.head 3 +  Library name: IctBob.Dll
.head 4 +  Function: llopen
.head 5 -  Description: открытие файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: HANDLE
.head 5 +  Parameters
.head 6 -  ! первый параметр: имя файла, второй: тип открытия
.head 6 -  String: LPCSTR
.head 6 -  Number: INT
.head 4 +  Function: llcreat
.head 5 -  Description: создание файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: HANDLE
.head 5 +  Parameters
.head 6 -  ! первый параметр: имя файла, второй: тип открытия
.head 6 -  String: LPCSTR
.head 6 -  Number: INT
.head 4 +  Function: llclose
.head 5 -  Description: закрытие файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: HANDLE
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 4 +  Function: llread
.head 5 -  Description: чтение файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: UINT
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 6 -  String: LPVOID
.head 6 -  Number: UINT
.head 4 +  Function: llwrite
.head 5 -  Description:
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: UINT
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 6 -  String: LPCSTR
.head 6 -  Number: UINT
.head 4 +  Function: lllseek
.head 5 -  Description:
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: LONG
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 6 -  Number: LONG
.head 6 -  Number: INT
.head 4 +  Function: llstr2str
.head 5 -  Description: преобразование строки HEXtoBIN
.head 5 -  Export Ordinal: 0
.head 5 -  Returns
.head 5 +  Parameters
.head 6 -  String: LPSTR
.head 6 -  Receive String: LPVOID
.head 6 -  Number: ULONG
.head 2 +  Constants
.data CCDATA
0000: 3000000000000000 0000000000000000 00000000
.enddata
.data CCSIZE
0000: 1400
.enddata
.head 3 +  System
.head 3 +  User
.head 2 +  Resources
.head 2 +  Variables
.data RESOURCE 0 0 1 3435626323
0000: 380000001D000000 0000000000000000 0200000200000063 000000E0010D0000
0020: 00FF3F7000800000 0304000000FFFF
.enddata
.head 3 -  Number: nFetchRes
.head 3 -  Number: nUsers
.head 3 -  Date/Time: dtExpDate
.head 3 -  Date/Time: dtWBDate
.head 2 +  Internal Functions
.head 2 +  Named Menus
.head 2 +  Class Definitions
.data RESOURCE 0 0 1 1682229443
0000: 8102000041010000 0000000000000000 0200000400FFFF01 00160000436C6173
0020: 73566172004F7574 6C696E6552006567 496E666F0D003C00 00086300446F634E
0040: 4F4B4B1E80000000 0100000047010D00 00FFFF0101804100 0000010200000D63
0060: 52616400696F4C69 7374426F00788600 00000500009E0001 0DFD00FF270D0000
0080: 01F700FF1F1A0000 DC000100FF7F2770 0000000100FFFFC1 3400000001FD00FF
00A0: 0701802200000000 020000000A634700 656E46696C746572 2074000000040000
00C0: 8F020400E8000100 001F800100FC0000 1B0400010DFB00FF 0F11000000EE0200
00E0: FF3F1500B8000001 00FFFF0001805A00 0000030060000004 6344EE8000000009
0100: 000000770200FFFF C904000002FD00FF 070800000002F700 FF1F0C0000D80001
0120: 0D00FF7F19700000 000100FFFFC12600 000001FD00FF0733 00000001F700FF1F
0140: 400000DC000100FF 7F4D700000000100 FFFF01
.enddata
.head 3 +  Functional Class: cDocNOKK
.head 4 -  Description: Класс документа для электронных клиентов
.head 4 +  Derived From
.head 5 -  Class: cDoc
.head 4 -  Class Variables
.head 4 +  Instance Variables
.head 5 -  Boolean: bSignInited
.head 4 +  Functions
.head 5 +  Function: sIni
.head 6 -  Description: Инициализировать ЭЦП
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 -  Parameters
.head 6 +  Static Variables
.head 7 -  ! Boolean: bSignInited
.head 7 -  Number: nTim
.head 6 +  Local variables
.head 7 -  ! String: strUxDateTime
.head 7 -  String: strDay
.head 7 -  Number: nDay
.head 7 -  Number: nErrorSign
.head 7 -  String: strErrorSign
.head 7 -  String: strPinCode
.head 6 +  Actions
.head 7 -  ! Call Debug('bSignInited:'||Str(bSignInited))
.head 7 +  If bSignInited
.head 8 -  Return TRUE
.head 7 +  If GetSignType() = 'UKR' or GetSignType() = 'NBU'
.head 8 -  Set nErrorSign = NUMBER_Null
.head 8 -  Set strPinCode = ''
.head 8 +  While TRUE
.head 9 +  If SalModalDialog(dlgAskPinCode, hWndForm,strPinCode)
.head 10 +  If GetSignType() = 'NBU'
.head 11 +  If bSignInited
.head 12 -  Set nErrorSign = CLOSE_ZAH()
.head 11 -  ! Set strUxDateTime = '1998/01/18 08:08:08'
    !!! ТОЛЬКО ДЛЯ ОТЛАДКИ !!!
.head 11 -  ! Set strUxDateTime = SalFmtFormatDateTime(
    GetBankDate(), 'yyyy/MM/dd') ||
    ' 07:07:07'
.head 11 -  Set nErrorSign = INIT_ZAH(GetOpenKeyDir(),
    GetSecretKeyDrv(), GetIdOper(),
    GetKeyDate(), strPinCode)
.head 11 +  If nErrorSign = -70
.head 12 -  Call MessageErrorEx('>> RSA. Последний ' ||
     'день действия секретного ключа')
.head 11 +  Else If nErrorSign > -77 And nErrorSign < -70
.head 12 -  Set nDay = - nErrorSign - 70
.head 12 +  If nDay = 1
.head 13 -  Set strDay = 'день'
.head 12 +  Else If nDay = 2 Or nDay = 3 Or nDay = 4
.head 13 -  Set strDay = 'дня'
.head 12 +  Else If nDay = 5 Or nDay = 6
.head 13 -  Set strDay = 'дней'
.head 12 -  Call MessageErrorEx('>> RSA. Срок действия'
     || 'секретного ключа прекращается ' ||
     'через ' || NumberToStr(nDay) || ' '
     || strDay)
.head 11 +  Else If nErrorSign != 0
.head 12 -  Break
.head 10 +  Else
.head 11 +  If bSignInited
.head 12 -  Set nErrorSign = nsignExitOPSign()
.head 11 -  ! Cipher 98
.head 11 -  ! Set nErrorSign = nsignInitOPSign(
    GetOpenKeyDir(), GetSecretKeyDrv(),
    strPinCode, GetBankMfo())
.head 11 -  ! Cipher 99 с ОперИдом
.head 11 -  Set nErrorSign = nsignInitOPSign(
    GetOpenKeyDir(), GetSecretKeyDrv(),
    strPinCode, GetBankMfo(),GetIdOper())
.head 11 -  ! Отладка
.head 11 -  ! Set nErrorSign = nsignInitOPSign(
    GetOpenKeyDir(), GetSecretKeyDrv(),
    strPinCode, '351447', GetIdOper())
.head 11 +  If nErrorSign != 0
.head 12 -  Break
.head 10 -  Call SaveInfoToLog('>> RSA - инициализация - OK')
.head 10 -  Set bSignInited = TRUE
.head 10 -  Return TRUE
.head 9 +  Else
.head 10 -  Break
.head 8 +  If nErrorSign != NUMBER_Null ! обработка ошибок ЭЦП
.head 9 +  If GetSignType() = 'NBU'
.head 10 -  Set strErrorSign = '>> RSA. Ошибка инициализации ЭЦП: '||NumberToStr(nErrorSign)
.head 10 -  ! Call CLOSE_ZAH()
.head 10 -  Call MessageErrorEx(strErrorSign)
.head 9 +  Else
.head 10 -  Set strErrorSign = SalStrRepeatX(' ', 129)
.head 10 -  Call nsignMapError2Text(strErrorSign,
     nErrorSign)
.head 10 -  Call MessageErrorEx('>> CIP. ' ||
     StrDosToWinX(strErrorSign))
.head 10 -  Call nsignExitOPSign()
.head 8 -  Return FALSE
.head 7 +  Else
.head 8 -  Return MessageErrorEx('Неизвестная система ЭЦП: '|| GetSignType())
.head 7 +  ! Комментарий
.head 8 -  ! 'NBU' -- используется ЭЦП НБУ
.head 8 -  ! 'UKR' -- используется ЭЦП Банка 'Украина'
.head 2 +  Default Classes
.head 3 -  MDI Window: cBaseMDI
.head 3 -  Form Window:
.head 3 -  Dialog Box:
.head 3 -  Table Window:
.head 3 -  Quest Window:
.head 3 -  Data Field:
.head 3 -  Spin Field:
.head 3 -  Multiline Field:
.head 3 -  Pushbutton:
.head 3 -  Radio Button:
.head 3 -  Option Button:
.head 3 -  Check Box:
.head 3 -  Child Table:
.head 3 -  Quest Child Window: cQuickDatabase
.head 3 -  List Box:
.head 3 -  Combo Box:
.head 3 -  Picture:
.head 3 -  Vertical Scroll Bar:
.head 3 -  Horizontal Scroll Bar:
.head 3 -  Column:
.head 3 -  Background Text:
.head 3 -  Group Box:
.head 3 -  Line:
.head 3 -  Frame:
.head 3 -  Custom Control:
.head 2 +  Application Actions
.head 3 +  On SAM_AppStartup
.head 4 -  Call SplashOpenWindow()
.head 4 -  ! Инициализация начальных  параметров
.head 4 -  ! Call SplashSetStatusText("Инициализация параметров...")
.head 4 -  Call GetConfigSettings()
.head 4 -  !
.head 4 -  ! Call SplashSetStatusText("Инициализация аудита...")
.head 4 -  Call DBSpy_Init(GetDbs())
.head 4 -  !
.head 4 -  ! Call SplashSetStatusText("Инициализация интерфейса...")
.head 4 -  Call SplashCloseWindow()
.head 4 +  If DatabaseLogin( dtWBDate )
.head 5 -  Call SetWorkBankDate( dtWBDate )
.head 5 -  Set nUsers = GetGlobalOptionEx('USRLIMIT')
.head 5 -  Set dtExpDate = SalFmtFormatStrDateTime(
    GetGlobalOption('EXPDATE'), 'dd/MM/yyyy')
.head 5 +  If dtExpDate < SalDateCurrent()
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('Истек срок действия лицензии!',
     'Bars: Лицензирование!', MB_Ok)
.head 6 -  Call SalQuit()
.head 5 +  Else
.head 6 +  If IsLicenseValid(GetBankMfo(), GetBankName(), nUsers,
   dtExpDate)
.head 7 +  If dtExpDate - SalDateCurrent() < 31
.head 8 -  Call SalMessageBeep(MB_IconStop)
.head 8 -  Call SalMessageBox(
     'Срок действия лицензии истекает через ' ||
     SalNumberToStrX((dtExpDate -
     SalDateCurrent()), 0) || ' дней!',
     'Bars: Лицензирование!', MB_Ok)
.head 7 -  ! Основной вызов
.head 7 -  Call SalCreateWindow(frm_NOK, hWndNULL, 4)
.head 6 +  Else
.head 7 -  Call SalMessageBeep(MB_IconStop)
.head 7 -  Call SalMessageBox(
     'Лицензия неверна или истек срок ее действия!',
     'Bars: Лицензирование!', MB_Ok)
.head 7 -  Call SalQuit()
.head 4 +  ! If DatabaseLogin( )
.head 5 -  ! Call SetWorkBankDate( dtWBDate )
.head 5 -  Set nUsers = GetGlobalOptionEx('USRLIMIT')
.head 5 -  Set dtExpDate = SalFmtFormatStrDateTime(
    GetGlobalOption('EXPDATE'), 'dd/MM/yyyy')
.head 5 +  If dtExpDate < SalDateCurrent()
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('Истек срок действия лицензии!',
     'Bars: Лицензирование!', MB_Ok)
.head 6 -  Call SalQuit()
.head 5 +  Else 
.head 6 +  If IsLicenseValid(GetBankMfo(), GetBankName(), nUsers,
   dtExpDate)
.head 7 +  If dtExpDate - SalDateCurrent() < 31
.head 8 -  Call SalMessageBeep(MB_IconStop)
.head 8 -  Call SalMessageBox(
     'Срок действия лицензии истекает через ' ||
     SalNumberToStrX((dtExpDate -
     SalDateCurrent()), 0) || ' дней!',
     'Bars: Лицензирование!', MB_Ok)
.head 7 -  ! Основной вызов
.head 7 -  Call SalCreateWindow(frm_NOK, hWndNULL, 4)
.head 6 +  Else 
.head 7 -  Call SalMessageBeep(MB_IconStop)
.head 7 -  Call SalMessageBox(
     'Лицензия неверна или истек срок ее действия!',
     'Bars: Лицензирование!', MB_Ok)
.head 7 -  Call SalQuit()
.head 4 +  Else
.head 5 -  Call SalQuit()
.head 3 +  On SAM_SqlError
.head 4 -  Call ShowSqlError(wParam, lParam)
.head 4 -  Return FALSE
.head 3 +  On SAM_AppExit
.head 4 -  Call SaveInfoToLog(MSG_DisconnectDbs() || GetDbs())
.head 4 +  If hSqlAux3()
.head 5 -  Call SqlDisconnect(hSqlAux3())
.head 4 +  If hSqlAux2()
.head 5 -  Call SqlDisconnect(hSqlAux2())
.head 4 +  If hSqlAux()
.head 5 -  Call SqlDisconnect(hSqlAux())
.head 4 +  If hSql()
.head 5 -  Call SqlDisconnect(hSql())
.head 4 -  Call DBSpy_Disconnect()
.head 4 -  Call SalQuit()
.head 1 +  Form Window: frm_NOK
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Монитор Клиент-БАНК (прием пакетов документов / формирование выписок NOKK)
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? Yes
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.62"
.head 4 -  Top:    0.233"
.head 4 -  Width:  11.717"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 6.214"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? No
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Data Field: dTime
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cClock
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Date/Time
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.714"
.head 6 -  Top:    0.302"
.head 6 -  Width:  1.143"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Class Default
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbRef
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cTimer
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Выполнить
.head 4 -  Window Location and Size
.head 5 -  Left:   4.914"
.head 5 -  Top:    0.031"
.head 5 -  Width:  2.0"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 0.521"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Execute.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call pbRef.Init(nInterval, 0, TRUE)
.head 5 +  On UM_TimerFired
.head 6 -  Call SalSendMsg(hWndForm, SAM_User, 0, 0)
.head 3 +  ! cpbCancel: pbExit
.winattr class Pushbutton:
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cpbCancel
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Выйти
.head 4 -  Window Location and Size
.head 5 -  Left:   8.514"
.head 5 -  Top:    0.031"
.head 5 -  Width:  1.1"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.521"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Discard.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.end
.head 4 +  Message Actions 
.head 5 +  On SAM_Click
.head 6 -  Call pbRef.Kill()
.head 6 +  If SalMessageBox("Вы намерены выйти из программы ? ",
   "Внимание !", MB_YesNo) = IDYES
.head 7 -  Call SalQuit()
.head 6 +  Else 
.head 7 -  Return FALSE
.head 6 -  ! Call SalDestroyWindow(hWndForm)
.head 3 +  Child Table: tbKLI
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.083"
.head 6 -  Top:    0.573"
.head 6 -  Width:  11.3"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 5.0"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: 8
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 1000
.head 5 -  Discardable? Yes
.head 4 +  Contents
.head 5 +  Column: nRnk
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Рег
 №
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.571"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: sOKPO
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: OKPO
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.843"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: dKli
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наименование
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  4.217"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: dSab
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Эл.код
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.729"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: sXXX
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Сим
вып
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.486"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value: 1
.head 8 -  Uncheck Value: 0
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: nFile  ! количество пакетов
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Кол-во
пак.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.714"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: nFile1 ! в т.ч. ОШ
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: в т.ч.
ОШ
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.571"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: nFile2 ! в т.ч. УСП
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: в т.ч.
УСП
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.586"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: nDo    ! количество документов
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Кол-во
док
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.686"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: nDo1   ! в т.ч. ОШ
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: в т.ч.
ОШ
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.586"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: nDo2   ! в т.ч. УСП
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: в т.ч.
УСП
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.586"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: nVip
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Выписок
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.95"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 -  Message Actions
.head 3 +  Check Box: cb1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Платежи
.head 4 -  Window Location and Size
.head 5 -  Left:   0.286"
.head 5 -  Top:    0.146"
.head 5 -  Width:  1.4"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.135"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Check Box: cb2
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Выписки все
.head 4 -  Window Location and Size
.head 5 -  Left:   1.686"
.head 5 -  Top:    0.417"
.head 5 -  Width:  1.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.135"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Check Box: cb21
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Вып. по оборотам
.head 4 -  Window Location and Size
.head 5 -  Left:   1.686"
.head 5 -  Top:    0.146"
.head 5 -  Width:  2.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.135"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Check Box: cb3
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Сальдовки
.head 4 -  Window Location and Size
.head 5 -  Left:   0.286"
.head 5 -  Top:    0.417"
.head 5 -  Width:  1.4"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.135"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Radio Button: rbAll
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Все
.head 4 -  Window Location and Size
.head 5 -  Left:   6.971"
.head 5 -  Top:    0.146"
.head 5 -  Width:  0.814"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.135"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Radio Button: rbSelect
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Выбранные
.head 4 -  Window Location and Size
.head 5 -  Left:   6.971"
.head 5 -  Top:    0.417"
.head 5 -  Width:  1.4"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.14"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Data Field: dDAT
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Date/Time
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.714"
.head 6 -  Top:    0.031"
.head 6 -  Width:  1.143"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Date
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbFilter
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: ctb_pbFilter
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left:   8.643"
.head 5 -  Top:    0.031"
.head 5 -  Width:  Class Default
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set strTip = 'Установить фильтр'
.head 5 +  On SAM_Click
.head 6 +  If SetQueryFilter(cF)
.head 7 -  Call NASELENIE()
.head 3 +  Pushbutton: pb4
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: ctb_pbSearch
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left:   9.129"
.head 5 -  Top:    0.031"
.head 5 -  Width:  Class Default
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name: \Bars98\RESOURCE\BMP\Updown.bmp
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set strTip = 'Файлы за предыдущие 20 дней'
.head 5 +  On SAM_Click
.head 6 +  If not IsWindow(hNOKF)
.head 7 -  Set hNOKF = SalCreateWindow(NOKF, hWndMDI, nStmt)
.head 3 +  ! Check Box: cbF
.winattr
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Обраб. отлож. файлы
.head 4 -  Window Location and Size
.head 5 -  Left:   8.643"
.head 5 -  Top:    0.417"
.head 5 -  Width:  2.757"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.135"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.end
.head 4 -  Message Actions 
.head 3 +  Pushbutton: pbExit
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: ctb_pbCancel
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left:   10.957"
.head 5 -  Top:    0.031"
.head 5 -  Width:  Class Default
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set strTip = 'Выйти'
.head 5 +  On SAM_Click
.head 6 -  Call pbRef.Kill()
.head 6 +  If SalMessageBox("Вы намерены выйти из программы ? ",
   "Внимание !", MB_YesNo) = IDYES
.head 7 -  Call SalQuit()
.head 6 +  Else
.head 7 -  Return FALSE
.head 6 -  ! Call SalDestroyWindow(hWndForm)
.head 2 +  Functions
.head 3 +  Function: Klient1_PL  ! Цикл по пакетам 1-го клиента
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: dSab
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sMaska
.head 5 -  String: sMass[*]
.head 5 -  Number: nKol
.head 5 -  Number: nTek
.head 4 +  Actions
.head 5 +  If IsBankDayOpen()
.head 6 +  ! If cbF      ! обработка отложенных файлов (из strDopDir)
.head 7 -  Set sMaska = strDopDir || '\\^@' || dSab || DD || '.***'
.head 7 -  Call SalArraySetUpperBound(sMass, 1, -1)
.head 7 -  Set nKol = VisDosEnumFiles(sMaska, FA_Standard, sMass)
.head 7 +  If nKol > 0 ! обработка файлов
.head 8 -  Set tbKLI.nFile = nKol
.head 8 -  Set tbKLI.nFile1 = 0
.head 8 -  Set tbKLI.nFile2 = 0
.head 8 -  Set tbKLI.nDo = 0
.head 8 -  Set tbKLI.nDo1 = 0
.head 8 -  Set tbKLI.nDo2 = 0
.head 8 -  Set bcbF = 1
.head 8 -  Set nTek = 0
.head 8 -  ! Set tbKLI.nFile = tbKLI.nFile + nKol
.head 8 +  While nTek < nKol
.head 9 +  If not Kontrol1(sMass[nTek])
.head 10 -  Call SqlRollback(hSqlAux3())
.head 9 -  Set nTek = nTek + 1
.head 8 +  If tbKLI.nFile1 > 0
.head 9 -  Call SalTblSetCellTextColor( tbKLI.nFile1, COLOR_Red, FALSE )
.head 8 +  If tbKLI.nDo1 > 0
.head 9 -  Call SalTblSetCellTextColor( tbKLI.nDo1, COLOR_Red, FALSE )
.head 6 -  ! Set bcbF = 0
.head 6 -  ! обработка файлов из основной дир.
.head 6 -  Set sMaska = strPath1 || '\\^@' || dSab || DD || '.***'
.head 6 -  ! Set sMaska = strPath1 || '\\^@' || dSab || DD || '.' || tbKLI.sXXX
.head 6 -  Call SalArraySetUpperBound(sMass, 1, -1)
.head 6 -  Set nKol = VisDosEnumFiles(sMaska, FA_Standard, sMass)
.head 6 -  ! Call DebugN(nKol)
.head 6 +  ! If nKol > 0 ! обработка файлов
.head 7 +  If tbKLI.nFile = NUMBER_Null
.head 8 -  Set tbKLI.nFile = nKol
.head 7 +  Else 
.head 8 -  Set tbKLI.nFile = tbKLI.nFile + nKol
.head 7 +  If tbKLI.nFile1 = NUMBER_Null
.head 8 -  Set tbKLI.nFile1=0
.head 7 +  If tbKLI.nFile2 = NUMBER_Null
.head 8 -  Set tbKLI.nFile2 = 0
.head 7 +  If tbKLI.nDo = NUMBER_Null
.head 8 -  Set tbKLI.nDo = 0
.head 7 +  If tbKLI.nDo1 = NUMBER_Null
.head 8 -  Set tbKLI.nDo1 = 0
.head 7 +  If tbKLI.nDo2 = NUMBER_Null
.head 8 -  Set tbKLI.nDo2 = 0
.head 7 -  Set nTek = 0
.head 7 +  While nTek < nKol
.head 8 +  If not Kontrol1(sMass[nTek])
.head 9 -  Call SqlRollback(hSqlAux3())
.head 8 -  Set nTek = nTek + 1
.head 7 +  If tbKLI.nFile1 > 0
.head 8 -  Call SalTblSetCellTextColor( tbKLI.nFile1, COLOR_Red, FALSE )
.head 7 +  If tbKLI.nDo1 > 0
.head 8 -  Call SalTblSetCellTextColor( tbKLI.nDo1, COLOR_Red, FALSE )
.head 6 -  !
.head 6 +  If nKol > 0 ! обработка файлов
.head 7 -  Set tbKLI.nFile = nKol
.head 7 -  Set tbKLI.nFile1 = 0
.head 7 -  Set tbKLI.nFile2 = 0
.head 7 -  Set tbKLI.nDo = 0
.head 7 -  Set tbKLI.nDo1 = 0
.head 7 -  Set tbKLI.nDo2 = 0
.head 7 -  Set nTek = 0
.head 7 +  While nTek < nKol
.head 8 +  If not Kontrol1(sMass[nTek])
.head 9 -  Call SqlRollback(hSqlAux3())
.head 8 -  Set nTek = nTek + 1
.head 7 +  If tbKLI.nFile1 > 0
.head 8 -  Call SalTblSetCellTextColor(tbKLI.nFile1, COLOR_Red,
     FALSE)
.head 7 +  If tbKLI.nDo1 > 0
.head 8 -  Call SalTblSetCellTextColor(tbKLI.nDo1, COLOR_Red,
     FALSE)
.head 5 -  Return TRUE
.head 3 +  Function: Kontrol1    ! контроль 1-го пакета (Сухова)
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sFile
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: hF
.head 5 -  String: sTmp
.head 5 -  Number: bOk
.head 5 -  Number: i
.head 5 -  String: sStr
.head 5 -  Number: sum
.head 5 -  Number: nRP
.head 5 -  File Handle: hFile
.head 4 +  Actions
.head 5 -  Set sErrMes = '???'
.head 5 +  Loop
.head 6 -  ! Set i = 0
.head 6 +  ! While i < nErr
.head 7 -  Set sMErr[i,1] = '0'
.head 7 -  Set i = i + 1
.head 6 +  ! If not SqlPrepareAndExecute(hSqlAux3(), "
   SELECT fn
   FROM ZAG_NOK
   WHERE fn=:sFile")
.head 7 -  Set bOk = -1 ! ~ FALSE файл не убивать
.head 7 -  Break 
.head 6 -  ! Дубль файла
.head 6 +  ! If SqlFetchNext(hSqlAux3(), nFetchRes)
.head 7 -  Set tbKLI.nFile1 = tbKLI.nFile1 + 1
.head 7 -  Set sErrMes = 'Повторно'
.head 7 -  Set bOk = -2 ! ~ FALSE
.head 7 -  Break 
.head 6 -  ! Не открывается монопольно
.head 6 +  ! If bcbF = 1
.head 7 -  Set hF = llopen(strDopDir || '\\' || sFile, 2)
.head 6 +  ! Else
.head 7 -  Set hF = llopen(strPath1 || '\\' || sFile, 2)
.head 6 -  Set hF = llopen(strPath1 || '\\' || sFile, 2)
.head 6 +  If hF <= 0
.head 7 -  Set tbKLI.nFile1 = tbKLI.nFile1 + 1
.head 7 -  Set sErrMes = 'Невозможно открыть'
.head 7 -  Set bOk = -1 ! ~ FALSE файл не убивать
.head 7 -  Break
.head 6 -  Set bOk = 0 ! ~ FALSE
.head 6 -  ! Ош.Имени файла в заголовке
.head 6 -  Set sTmp = Spac(12)
.head 6 -  Call lllseek(hF, 102, FILE_SeekBegin)
.head 6 -  Call llread(hF, sTmp, 12)
.head 6 +  If sTmp != '$' || Subs(sFile, 2, 11)
.head 7 -  Set tbKLI.nFile1 = tbKLI.nFile1 + 1
.head 7 -  Set sErrMes = 'Ош.Имени /в заголовке ' || sTmp
.head 7 -  ! Call llclose(hF)
.head 7 -  Break
.head 6 -  ! Ош ЭЦП
.head 6 +  If not Kontrol2(hF, sFile)
.head 7 -  Set tbKLI.nFile1 = tbKLI.nFile1 + 1
.head 7 -  ! Call Debug('Файл ' || sFile || ' Ош.ЭЦП')
.head 7 -  ! Call llclose(hF)
.head 7 -  Break
.head 6 -  !
.head 6 -  ! Ош в платежах - откат всего пакета
.head 6 +  If not Paket1(hF, sFile)
.head 7 -  Set tbKLI.nFile1 = tbKLI.nFile1 + 1
.head 7 -  ! Call Debug('Файл ' || sFile || ' Ош.в платежах')
.head 7 -  ! Call llclose(hF)
.head 7 -  Break
.head 6 -  !
.head 6 -  Set tbKLI.nFile2 = tbKLI.nFile2 + 1
.head 6 -  Set bOk = 1 ! ~ TRUE
.head 6 +  ! If SqlPrepareAndExecute(hSqlAux3(), "
   INSERT
   INTO ZAG_NOK (fn,dat)
   VALUES(:sFile, sysdate)") and SqlCommitEx(hSqlAux3(),
   'Обработан пакет ' || sFile)
.head 7 -  ! Call llclose(hF)
.head 7 -  Set bOk = 1 ! ~ TRUE
.head 6 +  ! Else
.head 7 -  Set sErrMes = 'Ош.INSERT zag_nok'
.head 7 -  ! Call llclose(hF)
.head 6 -  Break
.head 5 -  ! Set i = 0
.head 5 -  ! Set sum = 0
.head 5 +  ! While i < nErr
.head 6 -  Set sum = sum + Val( sMErr[i,1] )
.head 6 -  Set i = i + 1
.head 5 +  ! If sum > 0
.head 6 -  Set sStr = ''
.head 6 -  Set i = 0
.head 6 +  While i < nErr
.head 7 +  If sMErr[i,1] = '1'
.head 8 -  Set sStr = sStr || sMErr[i,0] || '
'
.head 7 -  Set i = i+1
.head 6 +  If sum = 1 and sMErr[0,1] = '1'
.head 7 -  ! Call SalModalDialog( dlg_Err, hWndMDI, 0, sMErr[0,0], sFile, nRP )
.head 7 -  Call SalModalDialog( dlg_Err, hWndMDI, 0, sStr, sFile, nRP )
.head 6 +  Else 
.head 7 -  Call SalModalDialog( dlg_Err, hWndMDI, 1, sStr, sFile, nRP )
.head 6 +  ! If sum > 1 and sMErr[0,1] = '1'
.head 7 -  Call SalModalDialog( dlg_Err, hWndMDI, 1, sStr, sFile, nRP )
.head 6 +  ! If sum >=1 and sMErr[0,1]!= '1'
.head 7 -  Call SalModalDialog( dlg_Err, hWndMDI, 2, sStr, sFile, nRP )
.head 6 -  ! повторно
.head 6 +  If nRP = 1
.head 7 -  Set bOk = 2
.head 7 -  ! ош.ОКПО ?
.head 7 -  ! ош.ОКПО + др.
.head 7 -  ! If sum>1 and sMErr[0,1]='1'
.head 6 -  ! в доп. дир./квитанция(для ОКПО)
.head 6 -  ! (квитанции форм-ся в Oplata1 ???)
.head 6 +  Else If nRP = 2
.head 7 -  ! ош. только ОКПО
.head 7 +  ! If sum=1 and sMErr[0,1]='1'
.head 8 -  ! сформировать квитанцию для ОКПО, файл - в BackUp
.head 8 -  ! сейчас bOk=1, так и оставить
.head 7 -  ! ош.ОКПО + др.
.head 7 +  If sum > 1 and sMErr[0,1] = '1'
.head 8 -  ! файл - в доп. дир., для ош.ОКПО-квит.
.head 8 -  Set bOk = 3
.head 7 -  ! др. ош.(без ош. ОКПО)
.head 7 +  If sum >= 1 and sMErr[0,1] != '1'
.head 8 -  ! файл - в доп. дир.
.head 8 -  Set bOk = 3
.head 5 +  If bOk = 0 or bOk = -1 or bOk = -2
.head 6 -  Call SqlRollback(hSqlAux3())
.head 5 +  If bOk = 0 or bOk = 1 or bOk = 2 or bOk = 3
.head 6 -  Call llclose(hF)
.head 5 +  If bOk = 0 or bOk = -1 or bOk = -2
.head 6 -  Call MessageError('Файл ' || sFile || ': ' || sErrMes)
.head 5 +  If bOk = 0 or bOk = 1 or bOk = -2
.head 6 -  Call BackUpFile(bOk, strPath1, sFile)
.head 5 +  ! If (bOk = 0 or bOk = 1 or bOk = -2) and bcbF = 0
.head 6 -  Call BackUpFile(bOk, strPath1, sFile)
.head 5 +  ! If (bOk = 0 or bOk = 1) and bcbF = 1
.head 6 -  Call BackUpFile(bOk, strDopDir, sFile)
.head 5 +  ! If bOk = 3
.head 6 -  Call SalFileCopy( strPath1 || '\\' || sFile, strDopDir ||
     '\\' || sFile, TRUE )
.head 6 -  Call SalFileOpen( hFile, strPath1 || '\\' || sFile, OF_Delete )
.head 6 +  ! If SalFileOpen( hFile, strPath1 || '\\' || sFile, OF_Delete )
.head 7 -  Call Debug('ok')
.head 6 +  ! Else
.head 7 -  Call Debug('no')
.head 5 -  Return bOk
.head 3 +  Function: Kontrol2    ! контроль 1-го пакета (Миша)
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: hF
.head 5 -  String: sFile
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sTmp
.head 5 -  Long String: lsSign
.head 5 -  String: sRxxIkk
.head 5 -  Number: nN
.head 5 -  Number: nErrorSign
.head 4 +  Actions
.head 5 -  !
.head 5 -  Return TRUE ! Убрать после с согласования с НОК
.head 5 -  !
.head 5 -  Set sRxxIkk = Spac(6)
.head 5 -  Set lsSign = Spac(64)
.head 5 +  If GetSignOn() = 0 ! ЭЦП отключена - вернуть Пусто
.head 6 -  Return TRUE
.head 5 +  If not ccDoc.sIni()
.head 6 -  Return FALSE
.head 5 -  Call lllseek(hF, 102+60+64, FILE_SeekBegin)
.head 5 -  Call llread(hF, sRxxIkk, 6) ! имя ключа
.head 5 +  ! If sRxxIkk = Spac(6) ! мягкий режим (подпись не проверяем)
.head 6 -  Call Debug('Файл ' || sFile || ' Ош.ЭЦП')
.head 6 -  Return FALSE
.head 5 -  Call lllseek(hF, 102+130, FILE_SeekBegin)
.head 5 -  Call llread(hF, lsSign, 64)
.head 5 -  Call lllseek(hF, 0, FILE_SeekBegin)
.head 5 -  Set nErrorSign = RSA_ZAH0(82, hF, 1, 102, 130, 0, lsSign,
    sRxxIkk)
.head 5 +  If nErrorSign
.head 6 -  Call Debug('Файл ' || sFile || ' Ош.ЭЦП ' ||
     Str(nErrorSign))
.head 6 -  Return FALSE
.head 5 -  Set sTmp = Spac(6)
.head 5 -  Call lllseek(hF, 102+22, FILE_SeekBegin)
.head 5 -  Call llread(hF, sTmp, 6) ! К-во строк в файле
.head 5 -  Set nN = SalStrToNumber(sTmp)
.head 5 +  If nN ! Проверить подпись на файл, если есть строки
.head 6 -  Call lllseek(hF, 102+60, FILE_SeekBegin)
.head 6 -  Call llread(hF, lsSign, 64)
.head 6 -  Call lllseek(hF, 0, FILE_SeekBegin)
.head 6 -  Set nErrorSign = RSA_ZAH0(82, hF, nN, 298, 444, 594,
    lsSign, sRxxIkk)
.head 6 +  If nErrorSign
.head 7 -  Call Debug('Файл ' || sFile || ' Ош.ЭЦП ' ||
     Str(nErrorSign))
.head 7 -  Return FALSE
.head 5 -  Return TRUE
.head 3 -  ! для Авиатека
.head 3 +  Function: Paket1      ! Обработка 1-го пакета
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: hF
.head 5 -  String: sFile
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sTmp
.head 5 -  Number: nKol
.head 5 -  Number: nTek
.head 5 -  Number: nT
.head 5 -  String: sT
.head 5 -  Number: nRRR
.head 5 -  Boolean: bGood
.head 5 -  !
.head 5 -  ! String: sFN
.head 5 -  ! Number: nPN
.head 5 -  ! Number: nPNnew
.head 4 +  Actions
.head 5 -  Call lllseek(hF, 124, FILE_SeekBegin)
.head 5 -  Set sTmp = Spac(6)
.head 5 -  Call llread(hF, sTmp, 6)
.head 5 -  Set nKol = Val(sTmp)
.head 5 -  Set tbKLI.nDo = tbKLI.nDo + nKol
.head 5 -  Set nTek = 0
.head 5 +  While nTek < nKol
.head 6 -  Set sTmp = Spac(420)
.head 6 -  Call lllseek(hF, 297+594*nTek, FILE_SeekBegin)
.head 6 -  Call llread(hF, sTmp, 420)
.head 6 +  If Oplata1( sTmp, sFile)
.head 7 -  Set nT = nTek + 1
.head 7 -  Call SqlPrepareAndExecute(hSqlAux2(), "
     SELECT rec
     INTO :nRRR
     FROM ZAG_NOK
     WHERE fn=:sFile and rec=:nT")
.head 7 -  Set bGood = not SqlFetchNext(hSqlAux2(), nFetchRes)
.head 7 +  If bGood and SqlPrepareAndExecute(hSqlAux2(), "
   INSERT
   INTO ZAG_NOK (fn,rec,dat)
   VALUES(:sFile,:nT,sysdate)")
.head 8 -  Set tbKLI.nDo2 = tbKLI.nDo2 + 1 ! хорошо
.head 8 -  ! поставить COMMIT
.head 8 -  ! (документ оплачен + insert into zag_nokk)
.head 8 -  Call SqlCommit(hSqlAux2())
.head 8 -  Set sT = '+' || sFile || ': ' || Subs(sTmp, 5, 75)
.head 8 -  Call ToLog(sT)
.head 8 -  Call SalStatusSetText(hWndForm, sT)
.head 7 +  Else
.head 8 -  Set tbKLI.nDo1 = tbKLI.nDo1 + 1 ! плохо
.head 8 -  ! документ уже оплачен, повторно не оплачиваем
.head 8 -  ! (возникает при повторной обработке файла)
.head 8 -  Call SqlRollback(hSqlAux2())
.head 8 -  Set sT = '-' || sFile || ': ' || Subs(sTmp, 5, 75)
.head 8 -  Call ToLog(sT)
.head 8 -  Call SalStatusSetText(hWndForm, sT)
.head 6 +  Else
.head 7 -  Set tbKLI.nDo1 = tbKLI.nDo1 + 1 ! плохо
.head 7 -  ! поставить ROLLBACK и закомментировать Return FALSE
.head 7 -  Call SqlRollback(hSqlAux2())
.head 7 -  Set sT = '-' || sFile || ': ' || Subs(sTmp, 5, 75)
.head 7 -  Call ToLog(sT)
.head 7 -  Call ToLog(sErrMes)
.head 7 -  Call SalStatusSetText(hWndForm, sT)
.head 7 -  ! Return FALSE
.head 6 -  Set nTek = nTek + 1
.head 5 -  Call ToLog('')
.head 5 -  Call SalStatusSetText(hWndForm, '')
.head 5 -  Return TRUE
.head 3 -  ! для Авиатека
.head 3 +  Function: Oplata1     ! Оплата 1-го документа
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sTmp
.head 5 -  String: sFile
.head 5 -  !
.head 5 -  ! Number: nNumStr
.head 5 -  ! String: sFN
.head 5 -  ! Number: nPN
.head 5 -  ! Receive Number: nPNnew
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nOSTB         !! Плановый остаток
.head 5 -  Number: nOSTB8        !! Плановый неиспользованный лимит
.head 5 -  Number: nRef          !! референс (NUMBER_Null для новых)
.head 5 -  String: sTT           !! Код операции
.head 5 -  String: s8            !! Особій код НОК
.head 5 -  Number: nIsp
.head 5 -  String: sNMS          !  Наим. счета 
.head 5 -  Number: nVob          !! Вид обработки
.head 5 -  String: sNd           !! № док
.head 5 -  Date/Time: dDoc       !! Дата док
.head 5 -  Date/Time: dPos       !! Дата ввода(поступления в банк)
.head 5 -  ! Date/Time: dVal1    !! Дата валютиров. основной операции
.head 5 -  ! Date/Time: dVal2    !! Дата валютиров. связаной операции
.head 5 -  String: sNls1         !! Счет-А
.head 5 -  String: sNam1         !! Наим-А
.head 5 -  ! String: sBank1      !! МФО-А
.head 5 -  ! String: sNb1        !! Наим банка-А(м.б. '')
.head 5 -  Number: nKv1          !! Код вал-А
.head 5 -  Number: nS1           !! Сумма-А
.head 5 -  String: sOkpo1        !! ОКПО-А
.head 5 -  String: sNls2         !! Счет-Б
.head 5 -  String: sNam2         !! Наим-Б
.head 5 -  String: sBank2        !! МФО-Б
.head 5 -  ! String: sNb2        !! Наим банка-Б(м.б. '')
.head 5 -  ! Number: nKv2        !! Код вал-Б
.head 5 -  ! Number: nS2         !! Сумма-Б
.head 5 -  String: sOkpo2        !! ОКПО-Б (м.б. '')
.head 5 -  String: sNazn         !! Назначение пл
.head 5 -  String: sDrec         !! Доп реквизиты
.head 5 -  ! String: sOperId     !! Идентификатор ключа опрециониста
.head 5 -  ! Long String: lsSign !! ЭЦП опрециониста
.head 5 -  ! Number: nSk         !! СКП
.head 4 +  Actions
.head 5 +  If Subs(sTmp, 48, 1) = '2' ! (для НОКК DK)
.head 6 -  ! проверить свой ли счет
.head 6 -  Set sNls1 = SalStrTrimX(Subs(sTmp, 11, 14))
.head 6 -  ! Set nKv1 = Val(Subs(sTmp, 77, 3))
.head 6 +  ! If Subs(sTmp, 388, 3) = '   '
.head 7 -  Set nKv1 = GetBaseVal()
.head 6 +  ! Else
.head 7 -  Set nKv1 = GetKv(Subs(sTmp, 388, 3))
.head 6 -  Set nKv1 = IifN(Subs(sTmp, 388, 3)='   ', GetBaseVal(),
    GetKv(Subs(sTmp, 388, 3)))
.head 6 -  ! Call Debug(Subs(sTmp, 388, 3) || '(' || Str(nKv1) ||
     ')')
.head 6 +  If SqlPrepareAndExecute(hSqlAux2(), '
   SELECT a.acc,a.isp,a.ostb,a.nms 
   INTO :nRef,:nIsp,:nOSTB,:sNMS
   FROM accounts a, cust_acc cu, customer c
   WHERE a.nls=:sNls1 and a.kv=:nKv1 and a.pap=2 and
         a.acc=cu.acc and cu.rnk=c.rnk and
         c.sab=:tbKLI.dSab') and SqlFetchNext(hSqlAux2(), nFetchRes)
.head 7 -  Set nVob = Val(Subs(sTmp, 65, 2))
.head 7 -  ! Set nVob = 0
.head 7 -  Set sNd = SalStrTrimX(StrDosToWinX(Subs(sTmp, 67, 10)))
.head 7 -  Set dDoc = IifD(Subs(sTmp, 80, 6)=Spac(6),
    GetBankDate(), SalDateConstruct(2000+Val(
    Subs(sTmp, 80, 2)), Val(Subs(sTmp, 82, 2)),
    Val(Subs(sTmp, 84, 2)), 0, 0, 0))
.head 7 -  Set dPos = IifD(Subs(sTmp, 86, 6)=Spac(6),
    GetBankDate(), SalDateConstruct(2000+Val(
    Subs(sTmp, 86, 2)), Val(Subs(sTmp, 88, 2)),
    Val(Subs(sTmp, 90, 2)), 0, 0, 0))
.head 7 -  Set sNam1 = SalStrTrimX(StrDosToWinX(
    Subs(sTmp, 92, 38)))
.head 7 -  Set nS1 = Val(Subs(sTmp, 49, 16))
.head 7 -  Set sOkpo1 = SalStrTrimX(Subs(sTmp, 393, 14))
.head 7 +  If sOkpo1='0' or sOkpo1='' or V_Okpo(sOkpo1)!=sOkpo1 
.head 8 -  Set sErrMes = 'Док.'||sNd||' не оплачен (неверен ОКПО А)'
.head 8 -  ! Set sMErr[0,1] = '1'
.head 8 -  ! сформировать квитанцию
.head 8 -  ! Call Kvit( sFile, sErrMes, nNumStr, sFN, nPN,nPNnew )
.head 8 -  Return FALSE
.head 7 -  Set sOkpo2 = SalStrTrimX(Subs(sTmp, 407, 14))
.head 7 +  If sOkpo2='0' or sOkpo2='' or V_Okpo(sOkpo2)!=sOkpo2 
.head 8 -  Set sErrMes = 'Док.'||sNd||' не оплачен (неверен ОКПО Б)'
.head 8 -  ! Set sMErr[0,1] = '1'
.head 8 -  ! сформировать квитанцию
.head 8 -  ! Call Kvit( sFile, sErrMes, nNumStr, sFN, nPN,nPNnew )
.head 8 -  Return FALSE
.head 7 -  Set sNls2 = SalStrTrimX(Subs(sTmp, 34, 14))
.head 7 -  Set sNam2 = SalStrTrimX(StrDosToWinX(
    Subs(sTmp, 130, 38)))
.head 7 -  Set sBank2 = SalStrTrimX(Subs(sTmp, 25, 9))
.head 7 -  ! бюджетные платежи в случае, если сумма документа
  больше планового остатка, помещаются в К-2
.head 7 -  ! Call Debug('nOSTB=' || Str(nOSTB))
.head 7 -  ! Call Debug('nS1=' || Str(nS1))
.head 7 -  ! Call Debug('Left(sNls2, 2)=' || Left(sNls2, 2))
.head 7 -  ! Call Debug('nRef=' || Str(nRef))
.head 7 -  ! Нет денег
.head 7 +  If nOSTB < nS1
.head 8 -  ! Бюджет
.head 8 +  ! If Left(sNls2, 2) = '25' or Left(sNls2, 2) = '35'
.head 9 -  Set sTT = 'K2A'
.head 8 -  ! Else
.head 8 -  !
.head 8 -  ! Лимит
.head 8 -  Call SqlPrepareAndExecute( hSqlAux2(), T('
   SELECT a8.ostb
   INTO :nOSTB8
   FROM accounts a8, v862 v
   WHERE v.acc6=:nRef and v.acc8=a8.acc and
         a8.ostb>0'))
.head 8 +  If not SqlFetchNext( hSqlAux2(), nFetchRes )
.head 9 -  Set nOSTB8 = 0
.head 8 -  ! Call Debug('nOSTB8=' || Str(nOSTB8))
.head 8 -  ! Call Debug('nOSTB+nOSTB8=' || Str(nOSTB+nOSTB8))
.head 8 -  ! Call Debug('AMFO=' || AMFO || ', sBank2=' ||
     sBank2)
.head 8 -  ! Лимит есть
.head 8 +  If nOSTB+nOSTB8 >= nS1
.head 9 -  Set sTT = 'KL' || IifS(Val(AMFO)=Val(sBank2), '3', '4')
.head 8 -  ! Лимита нет, ждите поступлений
.head 8 +  Else
.head 9 -  Set sTT = 'KL' || IifS(Val(AMFO)=Val(sBank2), '1', '2')
.head 7 -  ! Деньги есть платим
.head 7 +  Else
.head 8 -  Set sTT = 'KL' ||IifS(Val(AMFO)=Val(sBank2), '1', '2')
.head 7 -  Set sNazn = SalStrTrimX(StrDosToWinX(
    Subs(sTmp, 168, 160)))
.head 7 -  Set sDrec = SalStrTrimX(StrDosToWinX(
    Subs(sTmp, 328, 60)))
.head 7 -  Set nRef = NUMBER_Null
.head 7 +  If sBank2 = GetBankMfo()
.head 8 -  Set sNam1 = Subs(sNMS, 1, 38)
.head 7 -  Call ccDoc.SetDoc(nRef, sTT, 1, nVob, sNd, dDoc, dPos,
     GetBankDate(), GetBankDate(), 
     sNls1, sNam1, GetBankMfo(), '', nKv1, nS1, sOkpo1, 
     sNls2, sNam2, sBank2,       '', nKv1, nS1, sOkpo2, 
     sNazn, sDrec, GetIdOper(), '', NUMBER_Null, 0)
.head 7 -  ! Call Debug('1='||Str(nS1))
.head 7 -  ! Call Debug('2='||Str(nOSTB))
.head 7 -  ! Call Debug('3='||Str(nS1 - Max(nOSTB, 0)))
.head 7 -  Set ccDoc.m_nNom = nS1 - Max(nOSTB, 0)
.head 7 +  If ccDoc.oDoc()
.head 8 -  ! вставить в OPERW
.head 8 -  ! Куда его поместить ? В доп реквизиты IDB
.head 8 -  Set s8 = Subs(sTmp, 407, 14)
.head 8 -  ! Call Debug(s8)
.head 8 +  If SqlPrepareAndExecute( hSqlAux2(), "
   INSERT
   INTO operw (REF,TAG,VALUE)
   VALUES (:ccDoc.m_nRef,'IDB',:s8)") and
   SqlPrepareAndExecute(hSqlAux2(), "
   INSERT
   INTO operw (REF,TAG,VALUE)
   VALUES (:ccDoc.m_nRef,'IDF',:sFile)" )
.head 9 +  ! If sTT = 'K2A'
.head 10 +  If SqlPrepareAndExecute(hSqlAux2(), "
   INSERT
   INTO operw (REF,TAG,VALUE)
   VALUES (:ccDoc.m_nRef,'VIDPL','1')")
.head 11 -  Return TRUE
.head 10 +  Else 
.head 11 -  Set sErrMes = 'Ош вставки VIDPL=1 (для К2)'
.head 11 -  Return FALSE
.head 9 -  ! Else
.head 9 -  Return TRUE
.head 8 +  Else
.head 9 -  Set sErrMes = 'Ош вставки IDB'
.head 9 -  ! Set sMErr[4,1] = '1'
.head 9 -  Return FALSE
.head 7 +  Else
.head 8 -  Set sErrMes = 'Док на сумму ' || Str(nS1) || ' не опл'
.head 8 -  ! Set sMErr[1,1 ]= '1'
.head 8 -  Return FALSE
.head 6 +  Else
.head 7 -  Set sErrMes = 'Сч ' || sNls1 || '/' || Str(nKv1) ||
    ' не доступен клиенту ' || tbKLI.nRnk
.head 7 -  ! Set sMErr[2,1] = '1'
.head 7 -  Return FALSE
.head 5 +  Else
.head 6 -  Set sErrMes = 'Ош DK # 2'
.head 6 -  ! Set sMErr[3,1] = '1'
.head 6 -  Return FALSE
.head 3 +  Function: Klient1_VIP ! Выписки 1-го счета
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: dSab
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nInd
.head 5 -  String: pFile
.head 5 -  String: fTmp
.head 5 -  ! String: sCurrentPath
.head 4 +  Actions
.head 5 -  ! Call SalFileGetCurrentDirectory(sCurrentPath)
.head 5 -  Set nInd = 0
.head 5 -  Set strDir = GetTemplateDir() || '\\LS' || Str(nStmt) ||
    '.QRP'
.head 5 -  Set fTmp = strPath || '\\Tmp.tmp'
.head 5 -  Set pFile = strPath || '\\^#' || dSab || DD || '.'|| xxx
.head 5 -  Call SalReportPrintToFile(hWndForm, strDir, fTmp,
     'nLim,REF,DK,S,ND,MFO,NLSK,NAMK,SK,NAZ_P,TT,OKPO,' ||
     'OKPOK,NB,NAZ_P2,NAZ_P3,NAMO,FDAT1',
     'ACC,REF,DK,S,ND,MFO,NLSK,NAMK,SK,NAZ_P,TT,OKPO,' ||
     'OKPOK,NB,NAZ_P2,NAZ_P3,NAMO,FDAT1', 1, RPT_PrintAll,
     1, 1, FALSE, nInd)
.head 5 +  If nInd > 0
.head 6 -  Call Debug('Файл ' || pFile || ' Ош' || Str(nInd))
.head 6 -  Return FALSE
.head 5 -  ! Call SalLoadAppAndWait(sCurrentPath || '\\wtoa.bat ' ||
     fTmp || ' ' || pFile, Window_NotVisible, nInd)
.head 5 -  Call BlankStringErase(fTmp)
.head 5 -  Call SalFileCopy(fTmp, pFile, TRUE)
.head 5 -  Call SalFileCopy(fTmp, strPath2 || '\\^#' || dSab || DD ||
     '.' || xxx, TRUE)
.head 5 -  Return TRUE
.head 3 +  Function: Klient1_SAL ! Сальдовка 1-го клиента
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: dSab
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nInd
.head 5 -  String: pFile
.head 5 -  String: fTmp
.head 4 +  Actions
.head 5 -  Set nInd = 0
.head 5 -  Set strDir = GetTemplateDir() || '\\Sa' || Str(nStmt) ||
    '.QRP'
.head 5 -  Set fTmp  = strPath || '\\Tmp.tmp'
.head 5 -  Set pFile = strPath || '\\^O' || dSab || DD || '.txt'
.head 5 -  Call SalReportPrintToFile(hWndForm, strDir, fTmp,
     'REF,ACC,DK,S,ND,MFO,NLSK,NAMK,SK,NAZ_P,TT,OKPO,' ||
     'OKPOK,NB',
     'REF,ACC,DK,S,ND,MFO,NLSK,NAMK,SK,NAZ_P,TT,OKPO,' ||
     'OKPOK,NB', 1, RPT_PrintAll, 1, 1, FALSE, nInd)
.head 5 +  If nInd > 0
.head 6 -  Call Debug('Файл ' || pFile || ' Ош' || Str(nInd))
.head 6 -  Return FALSE
.head 5 -  ! Call SalLoadAppAndWait('q:\\bars98\\bin\\wtoa.bat ' ||
     fTmp || ' ' || pFile, Window_NotVisible, nInd)
.head 5 -  ! Call zarez12(pFile)
.head 5 -  Call BlankStringErase(fTmp)
.head 5 -  Call SalFileCopy(fTmp, pFile, TRUE)
.head 5 -  Return TRUE
.head 3 +  Function: BackUpFile
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nMode
.head 5 -  String: strPath
.head 5 -  String: strFn
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sBackUpPath
.head 5 -  File Handle: hFile
.head 4 +  Actions
.head 5 +  If VisDosExist(strBKUPDir) ! do backup
.head 6 -  Set sBackUpPath = strBKUPDir || '\\' ||
    SalFmtFormatDateTime(dDAT, 'yyMMdd')
.head 6 +  ! If nMode = 1
.head 7 -  Set sBackUpPath = sBackUpPath || '\\OK'
.head 6 +  ! Else
.head 7 -  Set sBackUpPath = sBackUpPath || '\\NOT'
.head 6 -  Set sBackUpPath = sBackUpPath || IifS(nMode=1, '\\OK',
    '\\NOT')
.head 6 +  If not VisDosExist(sBackUpPath)
.head 7 +  If not SalFileCreateDirectory(sBackUpPath)
.head 8 -  Call SalMessageBox('Не могу создать каталог:' ||
     sBackUpPath, 'Внимание', MB_IconStop)
.head 8 -  Return FALSE
.head 6 -  Call SalFileCopy(strPath || '\\' || strFn, sBackUpPath ||
     '\\' || strFn, TRUE)
.head 6 -  ! Call Debug('Backed up as ' || sBackUpPath || '\\' ||
     strFn)
.head 5 -  Call SalFileOpen(hFile, strPath || '\\' || strFn, OF_Delete)
.head 5 -  Return TRUE
.head 3 +  Function: BlankStringErase
.head 4 -  Description: Выбрасывает пустые строки из файла (+ Win2Dos)
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sFile
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sBuffer
.head 5 -  String: sFileTemp
.head 5 -  File Handle: hFt
.head 5 -  File Handle: hF
.head 5 -  Number: nL
.head 4 +  Actions
.head 5 +  If VisFileOpen(hF, sFile, OF_Text) < 0
.head 6 -  Return FALSE
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  Set sFileTemp = VisFileCreateTemp('bse')
.head 5 +  If VisFileOpen(hFt, sFileTemp, OF_Create) < 0
.head 6 -  Call VisFileClose(hF)
.head 6 -  Call SalWaitCursor(FALSE)
.head 6 -  Return FALSE
.head 5 -  Set nL = 1
.head 5 +  While VisFileReadString(hF, sBuffer) = VTERR_Ok
.head 6 +  If SalStrLeftX(sBuffer, 1) = SalNumberToChar(12)
.head 7 -  Call SalStrLop(sBuffer)
.head 6 -  Set sBuffer = VisStrRightTrim(sBuffer)
.head 6 -  Set nL = SalStrLength(sBuffer)
.head 6 +  If nL > 0
.head 7 +  If VisFileWriteString(hFt, StrWinToDosX(sBuffer)) < 0
.head 8 -  Call VisFileClose(hFt)
.head 8 -  Call VisFileClose(hF)
.head 8 -  Call SalWaitCursor(FALSE)
.head 8 -  Return FALSE
.head 5 -  Call VisFileClose(hF)
.head 5 -  Call VisFileClose(hFt)
.head 5 -  Call VisFileDelete(sFile)
.head 5 -  Call VisFileRename(sFileTemp, sFile)
.head 5 -  Call SalWaitCursor(FALSE)
.head 5 -  Return TRUE
.head 3 +  Function: NASELENIE
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: ss1
.head 5 -  String: sf
.head 4 +  Actions
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  Set sf = cF.GetFilterWhereClause(FALSE)
.head 5 -  ! главный курсор в таблицу
.head 5 -  Call SalTblPopulate(tbKLI, hSql(), "
     SELECT c.rnk,c.nmk,c.sab,c.okpo,co.numb
     INTO :tbKLI.nRnk,:tbKLI.dKli,:tbKLI.dSab,:tbKLI.sOKPO,
          :tbKLI.sXXX
     FROM customer c, conts co
     WHERE " || IifS(sf !="",  sf || " and ",  "") ||
           "co.rnk=c.rnk and c.sab=co.nek and
           c.sab is not null and c.stmt=:nStmt
     ORDER BY c.sab,co.numb", TBL_FillAll)
.head 5 -  Call SalWaitCursor(FALSE)
.head 5 -  Return TRUE
.head 3 +  Function: ToLog
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sMes
.head 4 +  Static Variables
.head 5 -  Boolean: bOpen
.head 5 -  File Handle: hLogFile
.head 4 +  Local variables
.head 5 -  String: strFileName
.head 5 -  String: strTmpStr
.head 4 +  Actions
.head 5 +  If not bOpen
.head 6 -  Set strFileName = GetLogDir() || '\\' ||
    SalStrLeftX(GetUserLoginName(), 8) || '.LOG'
.head 6 +  If Not SalFileOpen(hLogFile, strFileName, OF_Exist)
.head 7 -  Call SalFileOpen(hLogFile, strFileName,
     OF_Create | OF_Text | OF_Write | OF_Append |
     OF_Share_Deny_None)
.head 6 +  Else
.head 7 -  Call SalFileOpen(hLogFile, strFileName,
     OF_Text | OF_Write | OF_Append |
     OF_Share_Deny_None)
.head 6 -  Set bOpen = TRUE
.head 5 -  Set strTmpStr = SalFmtFormatDateTime(SalDateCurrent(),
    ddMMyy() || ' hhh:mm:ss')
.head 5 -  Set strTmpStr = strTmpStr || ' ' || sMes
.head 5 -  Call SalFilePutStr(hLogFile, StrWinToDosX(strTmpStr))
.head 5 +  If not sMes
.head 6 -  Call SalFileClose( hLogFile )
.head 6 -  Set bOpen = FALSE
.head 2 +  Window Parameters
.head 3 -  Number: nStmt
.head 2 +  Window Variables
.head 3 -  : cF
.head 4 -  Class: cGenFilter
.head 3 -  String: sf
.head 3 -  Number: nInterval
.head 3 -  String: strPath
.head 3 -  String: strPath1
.head 3 -  String: strPath2
.head 3 -  String: strDir
.head 3 -  String: strDopDir
.head 3 -  ! Date/Time: dDAT
.head 3 -  String: AMFO
.head 3 -  String: AQH
.head 3 -  String: DD
.head 3 -  String: sSql2
.head 3 -  String: sSql2a
.head 3 -  Number: nOtc
.head 3 -  String: xxx
.head 3 -  Number: TEK
.head 3 -  Number: ACC
.head 3 -  Number: REF
.head 3 -  Number: DK
.head 3 -  Number: S
.head 3 -  Number: nLim
.head 3 -  String: ND
.head 3 -  String: MFO
.head 3 -  String: NLSK
.head 3 -  String: NAMK
.head 3 -  String: NAMO
.head 3 -  String: SK
.head 3 -  String: OKPO
.head 3 -  String: OKPOK
.head 3 -  String: NB
.head 3 -  String: NAZ_P
.head 3 -  String: NAZ_P2
.head 3 -  String: NAZ_P3
.head 3 -  String: TT
.head 3 -  String: NLS
.head 3 -  String: ISO
.head 3 -  Date/Time: DAPP
.head 3 -  Number: OST2
.head 3 -  Number: DOS
.head 3 -  Number: KOS
.head 3 -  : ccDoc
.head 4 -  Class: cDocNOKK
.head 3 -  Number: nInd
.head 3 -  Number: nFli
.head 3 -  String: sTmp
.head 3 -  Number: nTmp
.head 3 -  String: NAMA
.head 3 -  String: NAMB
.head 3 -  String: NLSA
.head 3 -  String: NLSB
.head 3 -  String: strBKUPDir
.head 3 -  String: sErrMes
.head 3 -  Window Handle: hNOKF
.head 3 -  Date/Time: dTEDAT
.head 3 -  !
.head 3 -  Number: nBaseVal
.head 3 -  Date/Time: FDAT1
.head 3 -  Number: nPEREK
.head 3 -  !
.head 3 -  String: sNLS
.head 3 -  Number: nKV
.head 3 -  Boolean: bOk
.head 3 -  ! Number: bcbF
.head 3 -  ! String: sMErr[*,2]
.head 3 -  ! Number: nErr
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SqlPrepareAndExecute(hSql(), 'SET ROLE start1,nokk')
.head 4 -  Call SalCenterWindow(hWndForm)
.head 4 -  Call SalUseRegistry(FALSE, '')
.head 4 -  Set nBaseVal = GetBaseVal()
.head 4 -  Set sf = " "
.head 4 -  Call cF.Init('Conts', 'co')
.head 4 -  Set cb1 = 0
.head 4 -  Set rbAll = TRUE
.head 4 -  Set cb2 = 0
.head 4 -  Set cb21 = 0
.head 4 -  Set cb3 = 0
.head 4 -  ! Set cbF = 0
.head 4 -  ! Set sMErr[0,0] = ' - неверно указан код ОКПО
    (для документа сформирована квитанция);'
.head 4 -  ! Set sMErr[1,0] = ' - документ не оплачен;'
.head 4 -  ! Set sMErr[2,0] = ' - счет не доступен клиенту;'
.head 4 -  ! Set sMErr[3,0] = ' - ош DK # 2;'
.head 4 -  ! Set sMErr[4,0] = ' - ош вставки IDB;'
.head 4 -  ! Set nErr = 5
.head 4 -  Set nInterval = SalGetProfileInt(INI_ElektroKlients,
    'Interval', 600, GetIniFileName())
.head 4 -  Call SalGetProfileString(INI_ElektroKlients, 'NOKK_OUT', '',
     strPath, GetIniFileName())
.head 4 -  Call SalGetProfileString(INI_ElektroKlients, 'NOKK_IN', '',
     strPath1, GetIniFileName())
.head 4 -  Call SalGetProfileString(INI_ElektroKlients, 'NOKK_PRINT', '',
     strPath2, GetIniFileName())
.head 4 -  Call SalGetProfileString(INI_ElektroKlients, 'BackUpDir', GetPrnDir(), 
     strBKUPDir, GetIniFileName())
.head 4 -  Call SalGetProfileString(INI_ElektroKlients, 'DopDir', GetPrnDir(), 
     strDopDir, GetIniFileName())
.head 4 -  Set dDAT = GetBankDate()
.head 4 -  ! Set dTEDAT = GetBankDate()
.head 4 -  Set AMFO = GetBankMfo()
.head 4 -  Set AQH = GetBankName()
.head 4 -  Call NASELENIE()
.head 3 +  On SAM_User
.head 4 +  If cb1 and IsBankDayOpen()
.head 5 +  If GetSignOn()
.head 6 +  If not ccDoc.sIni()
.head 7 -  Return FALSE
.head 4 -  Call SalWaitCursor(TRUE)
.head 4 -  ! Set DD = Str(SalDateDay(dDAT))
.head 4 -  Set DD = SalStrRightX('0' || Str(SalDateDay(dDAT)), 2)
.head 4 -  Set dTime = SalDateCurrent()
.head 4 -  Set TEK = TBL_MinRow
.head 4 +  Loop
.head 5 +  If SalTblFindNextRow(tbKLI, TEK, 0, 0)
.head 6 -  Call SalTblSetContext(tbKLI, TEK)
.head 6 +  If TEK >= 0
.head 7 -  ! платежи
.head 7 -  Set tbKLI.nFile = NUMBER_Null
.head 7 -  Set tbKLI.nFile1 = NUMBER_Null
.head 7 -  Set tbKLI.nFile2 = NUMBER_Null
.head 7 -  Set tbKLI.nDo = NUMBER_Null
.head 7 -  Set tbKLI.nDo1 = NUMBER_Null
.head 7 -  Set tbKLI.nDo2 = NUMBER_Null
.head 7 -  Set tbKLI.nVip = 0
.head 7 +  If rbAll or SalTblQueryRowFlags(tbKLI, TEK,
   ROW_Selected)
.head 8 +  If cb1
.head 9 -  Call Klient1_PL(tbKLI.dSab)
.head 8 -  ! выписки
.head 8 +  If cb2 or cb21
.head 9 -  Set nOtc = 1
.head 9 -  Set xxx = tbKLI.sXXX
.head 9 -  Set OKPO = tbKLI.sOKPO
.head 9 -  Set dTEDAT = IifD(dDAT>GetBankDate(), GetBankDate(),
    dDAT)
.head 9 -  Set sSql2a = T("
    SELECT a.acc, ac.ost8/100, a.nls, a.kv
    INTO :ACC, :nLim, :sNLS, :nKV
    FROM cust_acc cu, conts co, sal a, OUTER v862 ac
    WHERE co.NUMB=:tbKLI.sXXX and
          co.NEK=:tbKLI.dSab and
          cu.rnk=:tbKLI.nRnk and
          a.acc=ac.acc6 (+) and a.nls=co.nls and
          a.kv=co.kv and a.acc=cu.acc and
          a.fdat=:dTEDAT " || IifS(cb21=1, "and
          a.dos+a.kos>0", ""))
.head 9 +  If SqlPrepareAndExecute(hSqlAux2(), sSql2a) and
   SqlFetchNext(hSqlAux2(), nFetchRes)
.head 10 -  !
.head 10 +  If nKV=nBaseVal
.head 11 -  Set sSql2 = "
    SELECT o.dk,o.s/100,o.ref,o.tt,p.nazn,p.nd,
           p.sk || '',p.mfob,p.nlsa,p.nlsb,
           p.nam_a,p.nam_b,o.fdat,0
    INTO :DK,:S,:REF,:TT,:NAZ_P,:ND,:SK,:MFO,
         :NLSA,:NLSB,:NAMA,:NAMB,:FDAT1,:nPEREK
    FROM opldok o, oper p
    WHERE o.sos=5 and o.acc=:ACC and
          o.fdat=:dTEDAT and o.ref=p.ref and o.s>0
    UNION ALL
    SELECT r.dk,r.s/100,r.ref,'ЗПТ',r.nazn,r.nd,
           '',r.mfoa,r.nlsb,r.nlsa,r.nam_b,
           r.nam_a,r.dat_a,1
    FROM arc_rrp r, accounts a
    WHERE r.dk>1 and a.nls=r.nlsb and
          r.kv=:nBaseVal and a.kv=:nBaseVal and
          a.acc=:ACC and TRUNC(r.dat_a)=:dTEDAT
    UNION ALL
    SELECT 5,0,0,'','','','','','','','','',
           TO_DATE('" ||
           SalFmtFormatDateTime(dTEDAT,
           'ddMMyyyy') || "', 'DDMMYYYY'),0
    FROM dual
    ORDER BY 1,2"
.head 11 -  Set bOk=TRUE
.head 10 +  Else
.head 11 +  If SqlPLSQLCommand( hSqlAux3(), "p_lic1( GetUserId(), dTEDAT, dTEDAT, sNLS)")
.head 12 -  Call SqlCommit( hSqlAux3())
.head 12 -  Set sSql2 = "
    SELECT decode(substr(s,1,1),'-',0,1), 
           ABS(s/100), ref, tt, nazn, nd, sk, mfo,
           nls, nlsk, nb, namk, fdat, 0
    INTO :DK, :S, :REF, :TT, :NAZ_P, :ND, :SK, :MFO,
         :NLSA, :NLSB, :NAMA, :NAMB, :FDAT1, :nPEREK
    FROM tmp_lic
    WHERE fdat = :dTEDAT AND kv=:nKV AND 
          acc=:ACC  
    ORDER BY 1,2 "
.head 12 -  Set bOk=TRUE
.head 11 +  Else
.head 12 -  Call SqlRollback( hSqlAux3())
.head 12 -  Set bOk=FALSE
.head 10 -  ! Set sSql2 = "
    SELECT o.dk,o.s/100,o.ref,o.tt,p.nazn,p.nd,
           p.sk || '',p.mfob,p.nlsa,p.nlsb,
           p.nam_a,p.nam_b,o.fdat
    INTO :DK,:S,:REF,:TT,:NAZ_P,:ND,:SK,:MFO,
         :NLSA,:NLSB,:NAMA,:NAMB,:FDAT1
    FROM opldok o, oper p
    WHERE o.sos=5 and o.acc=:ACC and
          o.fdat=:dTEDAT and o.ref=p.ref and o.s>0
    ORDER BY 1,2"
.head 10 +  If bOk
.head 11 -  Call Klient1_VIP(tbKLI.dSab)
.head 11 -  Set tbKLI.nVip = tbKLI.nVip + 1
.head 8 -  ! сальдовка
.head 8 +  If cb3 and tbKLI.sXXX = 'TXT'
.head 9 -  Set nOtc = 2
.head 9 -  Set NAMK = tbKLI.dKli
.head 9 -  Set sSql2 = "
    SELECT t.lcv,a.nls,a.ostc/100,a.blkd,a.blkk,
           c.nmk
    INTO :TT,:NLSK,:S,:REF,:DK,:NAMK
    FROM accounts a, tabval t, cust_acc cu,
         customer c, conts co
    WHERE a.nls=co.nls and a.kv=co.kv and
          a.kv=t.kv and a.acc=cu.acc and
          cu.rnk=c.rnk and a.accc in (
    SELECT a1.acc
    FROM accounts a1,cust_acc cu1
    WHERE a1.acc=cu1.acc and cu1.rnk=:tbKLI.nRnk)
    ORDER BY 1,2"
.head 9 -  Call Klient1_SAL(tbKLI.dSab)
.head 5 +  Else
.head 6 -  Break
.head 4 -  Call SalWaitCursor(FALSE)
.head 3 +  On SAM_ReportStart
.head 4 -  Return SqlPrepare(hSql(), sSql2)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 +  If nOtc = 1 ! выписки
.head 6 +  If nPEREK = 1 ! перекодировать
.head 7 -  Set NAZ_P = StrDosToWinX(NAZ_P)
.head 7 -  Set ND = StrDosToWinX(ND)
.head 7 -  Set NAMA = StrDosToWinX(NAMA)
.head 7 -  Set NAMB = StrDosToWinX(NAMB)
.head 6 -  ! Call Debug(NAZ_P || NAZ_P2 || NAZ_P3)
.head 6 -  ! МФО, контрсчет, его наименование для ПРОВОДКИ
.head 6 -  Set OKPOK = ''
.head 6 -  Set NAMK = NAMB
.head 6 -  Set NAMO = NAMA
.head 6 +  If TT = 'R01' or TT = 'D01'
.head 7 +  If SqlPrepareAndExecute(hSqlAux3(), "
   SELECT nazn,convert(ND,'CL8MSWIN1251','RU8PC866'),
          id_a,mfoa,nlsa,
          convert(nam_a,'CL8MSWIN1251','RU8PC866'),
          convert(nam_b,'CL8MSWIN1251','RU8PC866')
   INTO :NAZ_P,:ND,:OKPOK,:MFO,:NLSK,:NAMK,:NAMO
   FROM arc_rrp
   WHERE ref=:REF")
.head 8 +  If SqlFetchNext(hSqlAux3(), nFetchRes)
.head 9 -  Set NAZ_P = StrDosToWinX(NAZ_P)
.head 6 +  Else
.head 7 +  If SqlPrepareAndExecute(hSqlAux3(), "
   SELECT fli,name
   INTO :nFli,:sTmp
   FROM tts
   WHERE tt=:TT") and SqlFetchNext(hSqlAux3(),
   nFetchRes)
.head 8 +  If nFli = 1 ! межбанк
.head 9 -  Set NLSK = NLSB
.head 9 -  Set NAMK = NAMB
.head 8 +  Else
.head 9 -  Set MFO = AMFO
.head 9 -  Set nTmp = -S * 100 * (2 * DK - 1)
.head 9 +  If SqlPrepareAndExecute(hSqlAux3(), "
   SELECT acc,NLS
   INTO :nFli,:NLSK
   FROM OPL
   WHERE REF=:REF and TT=:TT and
         s*(2*dk-1)=:nTmp") and
   SqlFetchNext(hSqlAux3(), nFetchRes)
.head 10 +  If NLSK = NLSA
.head 11 -  Set NAMK = NAMA
.head 10 +  Else If NLSK = NLSB
.head 11 -  Set NAMK = NAMB
.head 10 +  Else
.head 11 +  If SqlPrepareAndExecute(hSqlAux3(), "
   SELECT substr(nms,1,38)
   INTO :NAMK
   FROM accounts
   WHERE acc=:nFli")
.head 12 -  Call SqlFetchNext(hSqlAux3(), nFetchRes)
.head 11 -  Set NAZ_P = sTmp
.head 11 -  ! Set OKPOK = Str(GetBankOkpo())
.head 11 -  Set OKPOK = GetBankOkpoS()
.head 10 -  Set NAMO = NAMB
.head 6 -  ! Наименование банка-корреспондента
.head 6 -  If SqlPrepareAndExecute(hSqlAux3(), "
   SELECT nb
   INTO :NB
   FROM banks
   WHERE mfo=:MFO") and SqlFetchNext(hSqlAux3(),
   nFetchRes)
.head 6 -  ! Из доп. реквизит
.head 6 -  ! If (TT='KL1' or TT='KL2') and
   SqlPrepareAndExecute(hSqlAux3(), "
   SELECT rtrim(ltrim(value))
   INTO :OKPOK
   FROM operw WHERE ref=:REF and tag='IDB'") and
   SqlFetchNext(hSqlAux3(), nFetchRes)
.head 6 +  If Left(TT,2) = 'KL'
.head 7 +  If DK = 1 and TT = 'KL1'
.head 8 -  Set OKPOK = GetValueStr("
    SELECT c.okpo
    FROM customer c, accounts a, cust_acc cu
    WHERE a.nls='" || NLSA || "' and a.kv=980 and
          a.acc=cu.acc and cu.rnk=c.rnk")
.head 7 +  Else If SqlPrepareAndExecute(hSqlAux3(), "
   SELECT rtrim(ltrim(value))
   INTO :OKPOK
   FROM operw WHERE ref=:REF and tag='IDB'")
.head 8 +  If not SqlFetchNext(hSqlAux3(), nFetchRes)
.head 9 -  Set OKPOK = ''
.head 6 -  ! склейка, т.к. не смогла попасть в нужные позиции
.head 6 +  If OKPOK = ''
.head 7 -  ! Set OKPOK = Str(GetBankOkpo())
.head 7 -  Set OKPOK = GetBankOkpoS()
.head 6 -  Set ND = Left(ND || Spac(10), 10) || IifS(TT='KL1' or
    TT='KL2', ' ', '*')  || MFO || ' ' || Left(NLSK ||
    Spac(14), 15) || Left(OKPOK || Spac(8), 8)
.head 6 -  Set NAZ_P2 = Subs(NAZ_P, 55, 54)
.head 6 -  Set NAZ_P3 = Subs(NAZ_P, 109, 54)
.head 6 -  Set NAZ_P = Left(NAZ_P, 54)
.head 6 -  ! Call Debug(NAZ_P || NAZ_P2 || NAZ_P3)
.head 5 -  Return TRUE
.head 4 -  Return FALSE
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam = RPT_BeforeReportHeader
.head 5 +  If nOtc = 1
.head 6 -  Call SalReportSetStringVar(
     SalNumberToWindowHandle(wParam), 'AMFO', OKPO)
.head 6 -  ! Call SalReportSetStringVar(
     SalNumberToWindowHandle(wParam), 'AQH', OKPO)
.head 6 -  Call SalReportSetStringVar(
     SalNumberToWindowHandle(wParam), 'NMK', tbKLI.dKli)
.head 6 -  Call SqlPrepareAndExecute(hSqlAux3(), "
     SELECT s.nls,t.lcv,s.ost/100,s.dos/100,s.kos/100
     INTO :NLS,:ISO,:OST2,:DOS,:KOS
     FROM sal s, tabval t
     WHERE s.fdat=:dTEDAT AND s.acc=:ACC AND s.kv=t.kv")
.head 6 +  If SqlFetchNext(hSqlAux3(), nFetchRes)
.head 7 +  If SqlPrepareAndExecute(hSqlAux3(), "
   SELECT max(fdat)
   INTO :DAPP
   FROM saldoa
   WHERE fdat<:dTEDAT and acc=:ACC")
and SqlFetchNext(hSqlAux3(), nFetchRes)
.head 8 -  Call SalReportSetDateTimeVar(
     SalNumberToWindowHandle(wParam), 'DAPP', DAPP)
.head 7 -  Call SalReportSetStringVar(
     SalNumberToWindowHandle(wParam), 'NLS', NLS)
.head 7 -  Call SalReportSetStringVar(
     SalNumberToWindowHandle(wParam), 'ISO', ISO)
.head 7 -  Call SalReportSetDateTimeVar(
     SalNumberToWindowHandle(wParam), 'FDAT', dDAT)
.head 7 -  Call SalReportSetDateTimeVar(
     SalNumberToWindowHandle(wParam), 'TEDAT', dTEDAT)
.head 7 -  Call SalReportSetNumberVar(
     SalNumberToWindowHandle(wParam), 'OST1',
     OST2+DOS-KOS)
.head 4 -  ! для UPB
.head 4 +  If lParam = RPT_BeforeReportFooter
.head 5 +  If nOtc = 1
.head 6 -  Call SalReportSetNumberVar(
     SalNumberToWindowHandle(wParam), 'DOS', DOS)
.head 6 -  Call SalReportSetNumberVar(
     SalNumberToWindowHandle(wParam), 'KOS', KOS)
.head 6 -  Call SalReportSetNumberVar(
     SalNumberToWindowHandle(wParam), 'OST2', OST2)
.head 4 -  ! для Aviatek
.head 4 +  If lParam = RPT_BeforeBreakFooter1
.head 5 +  If nOtc = 1
.head 6 -  Call SalReportSetNumberVar(
     SalNumberToWindowHandle(wParam), 'DOS', DOS)
.head 6 -  Call SalReportSetNumberVar(
     SalNumberToWindowHandle(wParam), 'KOS', KOS)
.head 6 -  Call SalReportSetNumberVar(
     SalNumberToWindowHandle(wParam), 'OST2', OST2)
.head 3 +  On SAM_Close
.head 4 +  If SalMessageBox("Вы намерены прекратить работу? ",
   "Внимание!", MB_YesNo) = IDYES
.head 5 -  Call SalQuit()
.head 4 +  Else
.head 5 -  Return FALSE
.head 3 +  On SAM_Destroy
.head 4 +  If ccDoc.bSignInited
.head 5 -  Set nTmp = CLOSE_ZAH()
.head 4 +  If SqlPrepareAndExecute(hSqlAux2(), "
   DELETE
   FROM zag_nok
   WHERE DAT<=bankdate-20") and SqlCommitEx(hSqlAux2(),
   'Очистка zag_nok')
.head 5 -  Return TRUE
.head 4 +  Else
.head 5 -  Return FALSE
.head 1 +  Table Window: NOKF
.head 2 -  Class: cGenericTable
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Файлы за предыдущие 20 дней
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? Class Default
.head 2 -  Visible? Class Default
.head 2 -  Display Settings
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Class Default
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Class Default
.head 3 -  Minimizable? Class Default
.head 3 -  System Menu? Class Default
.head 3 -  Resizable? Class Default
.head 3 -  Window Location and Size
.head 4 -  Left:   0.825"
.head 4 -  Top:    0.688"
.head 4 -  Width:  Class Default
.head 4 -  Width Editable? Class Default
.head 4 -  Height: Class Default
.head 4 -  Height Editable? Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 3 -  View: Class Default
.head 3 -  Allow Row Sizing? Class Default
.head 3 -  Lines Per Row: Class Default
.head 2 -  Memory Settings
.head 3 -  Maximum Rows in Memory: Class Default
.head 3 -  Discardable? Class Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Class Default
.head 4 -  Location? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Size: Class Default
.head 4 -  Size Editable? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 3 +  Contents
.head 4 +  Pushbutton: pbIns
.head 5 -  Class Child Ref Key: 33
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDel
.head 5 -  Class Child Ref Key: 34
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 35
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbUpdate
.head 5 -  Class Child Ref Key: 36
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 58444
.head 5 -  Class Child Ref Key: 37
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbSearch
.head 5 -  Class Child Ref Key: 38
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbFilter
.head 5 -  Class Child Ref Key: 44
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDetails
.head 5 -  Class Child Ref Key: 39
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 +  If not IsWindow(hNOK)
.head 8 -  Set hNOK = SalCreateWindow(NOK, hWndMDI, nStmt,
    NOKF.FN, NOKF.YYYYMM)
.head 4 +  Pushbutton: pbPrint
.head 5 -  Class Child Ref Key: 40
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 58445
.head 5 -  Class Child Ref Key: 41
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 42
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 58446
.head 5 -  Class Child Ref Key: 43
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 2 +  Contents
.head 3 +  Column: FN
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Имя файла
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  2.014"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: YYYYMM
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: YYYYMM
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  1.714"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: DAT
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Дата + время
обработки
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Date/Time
.head 4 -  Justify: Center
.head 4 -  Width:  2.529"
.head 4 -  Width Editable? Yes
.head 4 -  Format: DateTime
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Number: nStmt
.head 2 +  Window Variables
.head 3 -  Window Handle: hNOK
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalCenterWindow(hWndForm)
.head 4 -  Set NOKF.strPrintFileName = 'NOKF'
.head 4 -  ! Set NOKF.strSqlPopulate = "
    SELECT fn,TRUNC(dat),to_char(dat,'YYYYMM')
    INTO :NOKF.FN,:NOKF.DAT,:NOKF.YYYYMM
    FROM zag_nok
    GROUP BY fn,TRUNC(dat),to_char(dat,'YYYYMM')
    ORDER BY 2 DESC"
.head 4 -  Set NOKF.strSqlPopulate = "
    SELECT z1.fn,z1.dat,to_char(z1.dat,'YYYYMM')
    INTO :NOKF.FN,:NOKF.DAT,:NOKF.YYYYMM
    FROM zag_nok z1
    WHERE z1.rec=(select max(z2.rec)
                  from zag_nok z2
                  where z2.fn=z1.fn)
    ORDER BY 2 DESC"
.head 4 -  Set NOKF.strSqlDelete = "
    DELETE
    FROM zag_nok
    WHERE FN=:NOKF.FN"
.head 4 -  Call SalSendClassMessage(SAM_Create, 0, 0)
.head 1 +  Table Window: NOK
.head 2 -  Class: cGenericTable
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Документы файла
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? Class Default
.head 2 -  Visible? Class Default
.head 2 -  Display Settings
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Class Default
.head 3 -  Initial State: Class Default
.head 3 -  Maximizable? Class Default
.head 3 -  Minimizable? Class Default
.head 3 -  System Menu? Class Default
.head 3 -  Resizable? Class Default
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  Class Default
.head 4 -  Width Editable? Class Default
.head 4 -  Height: Class Default
.head 4 -  Height Editable? Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 3 -  View: Class Default
.head 3 -  Allow Row Sizing? Class Default
.head 3 -  Lines Per Row: Class Default
.head 2 -  Memory Settings
.head 3 -  Maximum Rows in Memory: Class Default
.head 3 -  Discardable? Class Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Class Default
.head 4 -  Location? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Size: Class Default
.head 4 -  Size Editable? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 3 +  Contents
.head 4 +  Pushbutton: pbIns
.head 5 -  Class Child Ref Key: 33
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDel
.head 5 -  Class Child Ref Key: 34
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 35
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbUpdate
.head 5 -  Class Child Ref Key: 36
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 58447
.head 5 -  Class Child Ref Key: 37
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbSearch
.head 5 -  Class Child Ref Key: 38
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbFilter
.head 5 -  Class Child Ref Key: 44
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDetails
.head 5 -  Class Child Ref Key: 39
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbPrint
.head 5 -  Class Child Ref Key: 40
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 58448
.head 5 -  Class Child Ref Key: 41
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 42
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 58449
.head 5 -  Class Child Ref Key: 43
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 2 +  Contents
.head 3 +  Column: FILE
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Файл
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  2.043"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: REF
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Реф док
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Right
.head 4 -  Width:  0.871"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: ND
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Документ
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Left
.head 4 -  Width:  1.029"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: NLSA
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Счет-А
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Left
.head 4 -  Width:  1.586"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: MFOB
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: МФО-Б
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Left
.head 4 -  Width:  Default
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: NLSB
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Счет-Б
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Left
.head 4 -  Width:  1.443"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: S
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Сумма
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Right
.head 4 -  Width:  1.643"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Decimal
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: SOS
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: SOS
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Left
.head 4 -  Width:  0.557"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Number: nPar
.head 3 -  String: sFa
.head 3 -  String: YYYYMM
.head 2 +  Window Variables
.head 3 -  Number: nCol
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalCenterWindow(hWndForm)
.head 4 -  Call SalTblSetLockedColumns(hWndForm, 1)
.head 4 -  Set NOK.strPrintFileName = 'NOK'
.head 4 -  Set NOK.strFilterTblName = 'OPER'
.head 4 -  Set NOK.strSqlPopulate = "
    SELECT w.value,OPER.ref,OPER.nd,OPER.nlsa,OPER.mfob,
           OPER.nlsb,OPER.s/100,OPER.sos
    INTO :NOK.FILE,:NOK.REF,:NOK.ND,:NOK.NLSA,:NOK.MFOB,
         :NOK.NLSB,:NOK.S,:NOK.SOS
    FROM operw w, oper
    WHERE OPER.ref=w.ref and w.tag='IDF'" || IifS(sFa='*', "",
          "and w.value=:NOK.sFa and
          to_char(oper.PDAT,'YYYYMM')=:NOK.YYYYMM ")
.head 4 -  Call SalSendClassMessage(SAM_Create, 0, 0)
.head 3 +  On SAM_FetchRowDone
.head 4 +  If SOS = 1
.head 5 -  Set nCol = COLOR_Green
.head 4 +  Else If SOS = 5
.head 5 -  Set nCol = COLOR_Black
.head 4 +  Else If SOS = 3
.head 5 -  Set nCol = COLOR_Blue
.head 4 +  Else If SOS = -1
.head 5 -  Set nCol = COLOR_Red
.head 4 +  Else
.head 5 -  Set nCol = COLOR_Burgundy
.head 4 -  Call SalTblSetCellTextColor(REF, nCol, TRUE)
.head 4 -  Call SalTblSetCellTextColor(ND, nCol, TRUE)
.head 4 -  Call SalTblSetCellTextColor(NLSA, nCol, TRUE)
.head 4 -  Call SalTblSetCellTextColor(NLSB, nCol, TRUE)
.head 4 -  Call SalTblSetCellTextColor(MFOB, nCol, TRUE)
.head 4 -  Call SalTblSetCellTextColor(S, nCol, TRUE)
.head 4 -  Call SalTblSetCellTextColor(SOS, nCol, TRUE)
