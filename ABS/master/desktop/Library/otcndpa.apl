.head 0 +  Application Description: ! OTCN.APL - Выходные формы НБУ и ДПА
! ООО Унити-Барс (C) 1997-2004
! Разработчики: Сыропоршнев Д.Л., Овчарук А.В.
! ///////////////////////////////////////////
.head 1 -  Outline Version - 4.0.26
.head 1 +  Design-time Settings
.data VIEWINFO
0000: 6F00000001000000 FFFF01000D004347 5458566965775374 6174650400010000
0020: 0000000000F40000 002C000000030000 00030000000E0300 000B000000F8FFFF
0040: FFE1FFFFFF200000 0015000000EA0200 00D7010000010000 0001000000010000
0060: 000F4170706C6963 6174696F6E497465 6D00000000
.enddata
.data DT_MAKERUNDLG
0000: 0200000000001C51 3A5C424152533938 5C4C494252415259 5C4162736170692E
0020: 646C6C1C513A5C42 41525339385C4C49 42524152595C4162 736170692E617063
0040: 00000101011C513A 5C4241525339385C 4C4942524152595C 4162736170692E72
0060: 756E1C513A5C4241 525339385C4C4942 524152595C416273 6170692E646C6C1C
0080: 513A5C4241525339 385C4C4942524152 595C416273617069 2E61706300000101
00A0: 01175C6261727339 385C62696E5C6F74 636E6470612E6170 64165C6261727339
00C0: 385C62696E5C4162 736170692E646C6C 165C626172733938 5C62696E5C416273
00E0: 6170692E61706300 00010101001C513A 5C4241525339385C 4C4942524152595C
0100: 4162736170692E64 6C6C1C513A5C4241 525339385C4C4942 524152595C416273
0120: 6170692E61706300 00010101
.enddata
.head 2 -  Outline Window State: Normal
.head 2 +  Outline Window Location and Size
.data VIEWINFO
0000: 6600040003002D00 0000000000000000 0000B71E5D0E0500 1D00FFFF4D61696E
0020: 0000000000000000 0000000000000000 0000003B00010000 00000000000000E9
0040: 1E800A00008600FF FF496E7465726E61 6C2046756E637469 6F6E730000000000
0060: 0000000000000000 0000000000003200 0100000000000000 0000E91E800A0000
0080: DF00FFFF56617269 61626C6573000000 0000000000000000 0000000000000000
00A0: 3000010000000000 00000000F51E100D 0000F400FFFF436C 6173736573000000
00C0: 0000000000000000 0000000000000000
.enddata
.data VIEWSIZE
0000: D000
.enddata
.head 3 -  Left:   -0.013"
.head 3 -  Top:    0.0"
.head 3 -  Width:  8.013"
.head 3 -  Height: 4.969"
.head 2 +  Options Box Location
.data VIEWINFO
0000: 1018B80BB80B2500
.enddata
.data VIEWSIZE
0000: 0800
.enddata
.head 3 -  Visible? Yes
.head 3 -  Left:   4.15"
.head 3 -  Top:    1.885"
.head 3 -  Width:  3.8"
.head 3 -  Height: 2.073"
.head 2 +  Class Editor Location
.head 3 -  Visible? No
.head 3 -  Left:   0.575"
.head 3 -  Top:    0.094"
.head 3 -  Width:  5.063"
.head 3 -  Height: 2.719"
.head 2 +  Tool Palette Location
.head 3 -  Visible? No
.head 3 -  Left:   6.388"
.head 3 -  Top:    0.729"
.head 2 -  Fully Qualified External References? Yes
.head 2 -  Reject Multiple Window Instances? No
.head 2 -  Enable Runtime Checks Of External References? Yes
.head 2 -  Use Release 4.0 Scope Rules? No
.head 1 +  Libraries
.head 2 -  Dynalib: Global.apd
.head 2 -  Dynalib: Message.apd
.head 2 -  Dynalib: Absapi.apd
.head 2 -  Dynalib: Nsiapi.apd
.head 2 -  Dynalib: PRINTAPI.apd
.head 2 -  Dynalib: MSOFFICE.apd
.head 2 -  Dynalib: CC_DOC.APD
.head 2 -  !
.head 2 -  File Include: Constant.apl
.head 2 -  File Include: Genbutn.apl
.head 2 -  File Include: Genfcls.apl
.head 2 -  File Include: Gentbl.apl
.head 2 -  File Include: GentblD.apl
.head 2 -  File Include: Genlist.apl
.head 2 -  File Include: Signfile.apl
.head 2 -  File Include: Vttblwin.apl
.head 2 -  File Include: Vtsplit.apl
.head 2 -  File Include: Vtlbx.apl
.head 2 -  File Include: Vtdos.apl
.head 2 -  File Include: Xsalcpt.apl
.head 1 +  Global Declarations
.head 2 +  Window Defaults
.head 3 +  Tool Bar
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Form Window
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Dialog Box
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Top Level Table Window
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Window Color
.head 3 +  Data Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Multiline Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Spin Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Background Text
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Pushbutton
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Radio Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Check Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Option Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Group Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Child Table Window
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: System Window Color
.head 3 +  List Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Combo Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Line
.head 4 -  Line Color: Use Parent
.head 3 +  Frame
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: 3D Face Color
.head 3 +  Picture
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 2 +  Formats
.head 3 -  Number: 0'%'
.head 3 -  Number: #0
.head 3 -  Number: ###000
.head 3 -  Number: ###000;'($'###000')'
.head 3 -  Date/Time: hh:mm:ss AMPM
.head 3 -  Date/Time: M/d/yy
.head 3 -  Date/Time: MM-dd-yy
.head 3 -  Date/Time: dd-MMM-yyyy
.head 3 -  Date/Time: MMM d, yyyy
.head 3 -  Date/Time: MMM d, yyyy hh:mm AMPM
.head 3 -  Date/Time: MMMM d, yyyy hh:mm AMPM
.head 3 -  Input: 99/99/99
.head 3 -  Number: ###00000
.head 3 -  Date/Time: dd/MM/yyyy
.head 3 -  Date/Time: dd/MM/yy
.head 3 -  Date/Time: dd
.head 3 -  Date/Time: dd-MM-yyyy
.head 3 -  Date/Time: ddMMyy
.head 3 -  Date/Time: yy/MM/dd
.head 2 +  External Functions
.head 3 +  Library name: MsVcrt.Dll
.head 4 +  Function: _open_osfhandle
.head 5 -  Description: Преобразуем хэндл ОС в хэгл С ран-тайм
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: INT
.head 5 +  Parameters
.head 6 -  Number: LONG
.head 6 -  Number: INT
.head 3 +  Library name: IctBob.Dll
.head 4 +  Function: llopen
.head 5 -  Description: открытие файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: HANDLE
.head 5 +  Parameters
.head 6 -  ! первый параметр: имя файла,
  второй: тип открытия
.head 6 -  String: LPCSTR
.head 6 -  Number: INT
.head 4 +  Function: llcreat
.head 5 -  Description: создание файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: HANDLE
.head 5 +  Parameters
.head 6 -  ! первый параметр: имя файла,
  второй: тип открытия
.head 6 -  String: LPCSTR
.head 6 -  Number: INT
.head 4 +  Function: llclose
.head 5 -  Description: закрытие файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: HANDLE
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 4 +  Function: llread
.head 5 -  Description: чтение файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: UINT
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 6 -  String: LPVOID
.head 6 -  Number: UINT
.head 4 +  Function: llwrite
.head 5 -  Description:
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: UINT
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 6 -  String: LPVOID
.head 6 -  Number: UINT
.head 4 +  Function: lllseek
.head 5 -  Description:
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: LONG
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 6 -  Number: LONG
.head 6 -  Number: INT
.head 4 +  ! Function: llstr2str
.head 5 -             Description: преобразование строки HEXtoBIN
.head 5 -             Export Ordinal: 0
.head 5 -             Returns
.head 5 +             Parameters
.head 6 -             String: LPSTR
.head 6 -             Receive String: LPVOID
.head 6 -             Number: ULONG
.head 3 +  Library name: HARAKIRI.DLL
.head 4 +  Function: DeleteBadSymbols
.head 5 -  Description: Удаляет из файла отчета ненужные символы
и добавляет в него Esc-последовательности
Параметры:
	Имя файла,
	Строка Esc-последовательностей
	Флаг удаления символа с кодом 12
	Флаг удаления пустых строк (3 и более пустых строки заменяются одной)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Boolean: BOOL
.head 5 +  Parameters
.head 6 -  String: LPSTR
.head 6 -  String: LPSTR
.head 6 -  Boolean: BOOL
.head 6 -  Boolean: BOOL
.head 2 +  Constants
.data CCDATA
0000: 3000000000000000 0000000000000000 00000000
.enddata
.data CCSIZE
0000: 1400
.enddata
.head 3 +  System
.head 3 +  User
.head 4 -  Number: COLOR_STOP  =0 ! параметр для цвета окраски для счетов с несквитованным файлом
.head 4 -  Number: COLOR_BLOCK =1 ! параметр для цвета окраски блокированных счетов
.head 4 -  Number: COLOR_NO_R  =2  ! нет квитанции подтверждения @R
.head 4 -  Number: COLOR_NO_I  =3  ! нет квитанции подтверждения @I
.head 4 -  !
.head 4 -  !
.head 4 -  ! Форматы экспорта
.head 4 -  Number: EXP_DBF_DOS =11   
.head 4 -  Number: EXP_DBF_WIN =12
.head 4 -  Number: EXP_DBF_UKG =13
.head 4 -  !
.head 4 -  Number: EXP_XML_WIN =14   
.head 4 -  Number: EXP_XML_UTF =15
.head 4 -  !
.head 4 -  ! 17.02.2015
.head 4 -  String: AppVersion = '11. '
.head 4 -  String: DPA = 'DPA. '
.head 2 +  Resources
.head 2 +  Variables
.data RESOURCE 0 0 1 4094952534
0000: 380000001A000000 0000000000000000 020000020000008B 000000E0010D0000
0020: 00FF3F9800B80000 0100FFFF
.enddata
.head 3 -  Boolean: fInitLib
.head 3 -  Window Handle: hWin0
.head 3 -  Window Handle: hWin1
.head 3 -  Window Handle: hWin2
.head 3 -  Window Handle: hWin3
.head 3 -  !
.head 3 -  String: sBANKTYPE
.head 3 -  String: sORGTYPE
.head 3 -  !
.head 3 -  Number: nFetchRes
.head 3 -  !
.head 2 +  Internal Functions
.head 3 +  Function: getAttentionColor
.head 4 -  Description: Отдать цвет по заказу
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  Number: nWhat  
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If nWhat = COLOR_STOP
.head 6 -  Return SalColorFromRGB( 255,205,255 )
.head 5 +  If nWhat = COLOR_BLOCK
.head 6 -  Return SalColorFromRGB( 255,210,205 )
.head 5 +  If nWhat = COLOR_NO_R
.head 6 -  Return SalColorFromRGB( 255, 255, 150 )
.head 5 +  If nWhat = COLOR_NO_I
.head 6 -  Return SalColorFromRGB( 205,255,255 )
.head 3 +  Function: OtcnDpaIni
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: strPathToLangResources
.head 5 -  String: strLangId
.head 5 -  !
.head 5 -  String: strFileName
.head 4 +  Actions
.head 5 -  ! BANKTYPE - банк
.head 5 -  Set sBANKTYPE = GetGlobalOption('BANKTYPE')
.head 5 -  ! ORGTYPE - организация
.head 5 -  Set sORGTYPE  = GetGlobalOption('ORGTYPE')
.head 5 +  If NOT fInitLib
.head 6 -  Set strPathToLangResources = GetLangPath()
.head 6 -  Set strLangId = GetLang()
.head 6 -  Set strFileName = strPathToLangResources || "\\" || strLangId || "\\otcn.lng"
.head 6 -  !
.head 6 +  If (NOT strLangId) OR (NOT CurrentLangTable.InitFromFile( strFileName, strLangId ))
.head 7 -  Call CurrentLangTable.Init()
.head 7 -  !
.head 7 -  ! ====================================================
.head 6 -  !
.head 6 -  Set fInitLib = TRUE
.head 5 -  ! Call CurrentLangTable.SaveToFile('C:\\TEMP\\otcn_.lng','RUS')
.head 5 -  Return fInitLib
.head 3 +  Function: OtcnDpa			! __exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Window Handle: hWndParent
.head 5 -  Number: nMode
.head 5 -  Number: nPar
.head 5 -  String: sPar1
.head 5 -  String: sPar2
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call OtcnDpaIni()
.head 5 +  Select Case nMode
.head 6 +  Case 0		! Реестр счетов
.head 7 +  If not IsWindow(hWin0)
.head 8 -  Set hWin0 = SalCreateWindow(frm_FilesNI, hWndParent, sPar1, sPar2)
.head 7 +  Else
.head 8 -  Call SalBringWindowToTop(hWin0)
.head 7 -  Break
.head 6 +  Case 1		! Формирование файлов обмена с ДМСУ
.head 7 +  If not IsWindow(hWin1)
.head 8 -  Set hWin1 = SalCreateWindow(frm_FilesTM, hWndParent, '')
.head 7 +  Else
.head 8 -  Call SalBringWindowToTop(hWin1)
.head 7 -  Break
.head 6 +  Default
.head 7 -  Break
.head 5 -  Return TRUE
.head 3 +  ! Function: ShowDpaTickets		! __exported
.head 4 -  Description: функция просмотра/обработки квитанций на файлы отчетности НИ
.head 4 +  Returns 
.head 5 -  Boolean: 
.head 4 +  Parameters 
.head 5 -  Window Handle: hWndParent
.head 5 -  Boolean: bPar
.head 5 -  String: strTicDir
.head 5 -  String: strTicMask
.head 4 -  Static Variables 
.head 4 -  Local variables 
.head 4 +  Actions 
.head 5 +  If not IsWindow(hWin2)
.head 6 -  Set hWin2 = SalCreateWindow(frm_TicketsNI, hWndParent, bPar, strTicDir, strTicMask, '', '')
.head 5 +  Else 
.head 6 -  Call SalBringWindowToTop(hWin2)
.head 5 -  Return TRUE
.head 3 +  Function: ShowDpaTickets	     	! __exported
.head 4 -  Description: функция обработки квитанций на файлы отчетности НИ и НБУ
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Window Handle: hW
.head 5 -  Boolean: bPar
.head 5 -  String: strTicDir
.head 5 -  String: strTicMask
.head 5 -  String: strZagTable
.head 5 -  String: strLinesTable
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call OtcnDpaIni()
.head 5 -  Call SalCreateWindow( frm_TicketsNI, hW, bPar, strTicDir, strTicMask, strZagTable, strLinesTable )
.head 3 +  Function: FunBackUpFile
.head 4 -  Description: Забэкапить файл в подкаталог дня.
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strSrcFile
.head 5 -  String: strBkpDir
.head 5 -  Boolean: fIn
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: strFName
.head 5 -  String: strFExt
.head 5 -  String: strFDrv
.head 5 -  String: strFPath
.head 5 -  !
.head 5 -  String: strBckPath
.head 5 -  String: strDayDir
.head 5 -  String: strDDir
.head 4 +  Actions
.head 5 -  Set strDayDir = SalFmtFormatDateTime( SalDateCurrent( ), 'yyMMdd' )
.head 5 +  If fIn
.head 6 -  Set strDDir = 'In'
.head 5 +  Else
.head 6 -  Set strDDir = 'Out'
.head 5 -  Call VisDosSplitPath( strSrcFile, strFDrv, strFPath, strFName, strFExt )
.head 5 -  Set strBckPath = strBkpDir || '\\' || strDayDir || '\\' || strDDir || '\\' || strFName || strFExt 
.head 5 -  !
.head 5 +  If NOT VisDosExist( strBkpDir || '\\' || strDayDir || '\\' || strDDir )
.head 6 +  If VisDosMakeAllDir( strBkpDir || '\\' || strDayDir || '\\' || strDDir ) != VTERR_Ok
.head 7 -  Call SalMessageBox( 'Невозможно создать каталог копий - ' || 
strBkpDir || '\\' || strDayDir || '\\' || strDDir, 'Ошибка', MB_Ok )
.head 7 -  Call SaveErrorToLog( 'Невозможно создать каталог копий - ' || 
strBkpDir || '\\' || strDayDir || '\\' || strDDir )
.head 7 -  Return FALSE
.head 5 +  If SalFileCopy( strSrcFile, strBckPath, TRUE ) != FILE_CopyOK
.head 6 -  Call SalMessageBox('Невозможно скопировать файл из ' || strSrcFile || ' в ' || strBckPath, 'Ошибка', MB_Ok)
.head 6 -  Call SaveErrorToLog(DPA || 'Невозможно скопировать файл из ' || strSrcFile || ' в ' || strBckPath)
.head 6 -  Return FALSE
.head 5 -  Call SaveInfoToLog(DPA || 'Файл ' || strSrcFile || ' перемещен в архив дня ' || strBckPath)
.head 5 -  Return TRUE
.head 3 -  !
.head 2 +  Named Menus
.head 3 +  ! Menu: popupFImpExist
.head 4 -  Title: NoMoreTitle
.head 4 -  Description: Всплывающее меню для таблицы сущствующих файлов 
для консолидации
.head 4 -  Enabled when: 
.head 4 -  Status Text: 
.head 4 -  Menu Item Name: 
.head 4 +  Menu Item: Перечитать
.head 5 -  Keyboard Accelerator: (none)
.head 5 -  Status Text: 
.head 5 +  Menu Settings 
.head 6 -  Enabled when: 
.head 6 -  Checked when: 
.head 5 +  Menu Actions 
.head 6 -  Call SalWaitCursor( TRUE )
.head 6 -  Call SalSendMsg( dlg_FileImport.tblFileExists, SAM_Create, 0, 0 )
.head 6 -  Call SalWaitCursor( FALSE )
.head 5 -  Menu Item Name: 
.head 4 -  Menu Separator 
.head 4 +  Menu Item: Удалить
.head 5 -  Keyboard Accelerator: (none)
.head 5 -  Status Text: 
.head 5 +  Menu Settings 
.head 6 -  Enabled when: 
.head 6 -  Checked when: 
.head 5 +  Menu Actions 
.head 6 -  Call SalSendMsg( dlg_FileImport.pbDelete, SAM_Click, 0, 0 )
.head 5 -  Menu Item Name: 
.head 3 +  ! Menu: popupFImpToDo
.head 4 -  Title: NoMoreTitle
.head 4 -  Description: Всплывающее меню для таблицы возможных файлов 
для консолидации
.head 4 -  Enabled when: 
.head 4 -  Status Text: 
.head 4 -  Menu Item Name: 
.head 4 +  Menu Item: Перечитать
.head 5 -  Keyboard Accelerator: (none)
.head 5 -  Status Text: 
.head 5 +  Menu Settings 
.head 6 -  Enabled when: 
.head 6 -  Checked when: 
.head 5 +  Menu Actions 
.head 6 -  Call SalWaitCursor( TRUE )
.head 6 -  Call SalSendMsg( dlg_FileImport.tblFile4Import, SAM_Create, 0, 0 )
.head 6 -  Call SalWaitCursor( FALSE )
.head 5 -  Menu Item Name: 
.head 4 -  Menu Separator 
.head 4 +  Menu Item: Импортировать все
.head 5 -  Keyboard Accelerator: (none)
.head 5 -  Status Text: 
.head 5 +  Menu Settings 
.head 6 -  Enabled when: 
.head 6 -  Checked when: 
.head 5 +  Menu Actions 
.head 6 -  Call SalSendMsg( dlg_FileImport.pbAll, SAM_Click, 0, 0 )
.head 5 -  Menu Item Name: 
.head 4 +  Menu Item: Импортировать выделенные
.head 5 -  Keyboard Accelerator: (none)
.head 5 -  Status Text: 
.head 5 +  Menu Settings 
.head 6 -  Enabled when: 
.head 6 -  Checked when: 
.head 5 +  Menu Actions 
.head 6 -  Call SalSendMsg( dlg_FileImport.pbSelected, SAM_Click, 0, 0 )
.head 5 -  Menu Item Name: 
.head 2 +  Class Definitions
.data RESOURCE 0 0 1 3897023691
0000: 910200003A010000 0000000000000000 0200000400FFFF01 00160000436C6173
0020: 73566172004F7574 6C696E6552006567 496E666F4E003C00 000963005369676E
0040: 46696C6500A00000 00060000000F010D 0000FE00FF930D00 0001FB00FF0F1A00
0060: 0000EE0100FF3F27 00B800000100FFFF E03400000001FE00 FF834100000001FB
0080: 00FF0F0180410001 00010000000D6300 526164696F4C6973 0074426F78860000
00A0: 00F005000000EC01 0D00FF3F0D00B900 0100FFFFE61A0001 FE00FF9B270001FB
00C0: 00FF6F3400EE0100 FF3F018000220000 0002000000C00A63 47656E4600746572
00E0: 7400000004790000 0244040000010000 FFE08001000000DF 04D800010D00FF7F
0100: 11700000000200FF FFC11500000001FD 00FFC70180220000 030000000B6347E3
0120: 444669CF0004DE00 02D1000100003F80 01F9000037040001 F60D00FFDF11DC00
0140: 0200FF7F15730001 00FFFF01
.enddata
.head 3 -  !
.head 3 +  Functional Class: cQueryBind
.head 4 -  Description: Описывает структуру бинд-переменных
.head 4 -  Derived From
.head 4 -  Class Variables
.head 4 +  Instance Variables
.head 5 -  String: sName
.head 5 -  String: sSemantic
.head 5 -  String: sType
.head 5 -  String: sVal
.head 5 -  String: sDescSQL    ! SQL строка, которая описывает параметр
.head 4 -  Functions
.head 2 +  Default Classes
.head 3 -  MDI Window: cBaseMDI
.head 3 -  Form Window:
.head 3 -  Dialog Box:
.head 3 -  Table Window:
.head 3 -  Quest Window:
.head 3 -  Data Field:
.head 3 -  Spin Field:
.head 3 -  Multiline Field:
.head 3 -  Pushbutton: ctb_pbFilter
.head 3 -  Radio Button:
.head 3 -  Option Button:
.head 3 -  Check Box:
.head 3 -  Child Table:
.head 3 -  Quest Child Window: cQuickDatabase
.head 3 -  List Box:
.head 3 -  Combo Box: cGenComboBox_NumId
.head 3 -  Picture:
.head 3 -  Vertical Scroll Bar:
.head 3 -  Horizontal Scroll Bar:
.head 3 -  Column:
.head 3 -  Background Text:
.head 3 -  Group Box:
.head 3 -  Line:
.head 3 -  Frame:
.head 3 -  Custom Control:
.head 2 -  Application Actions
.head 1 +  Form Window: frm_FilesNI
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title:
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? Yes
.head 2 -  Visible? No
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Yes
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.44"
.head 4 -  Top:    0.367"
.head 4 -  Width:  15.867"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 7.25"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Формирование файлов отчетности для НИ и для НБУ
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: 0.667"
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Contents
.head 4 -  Group Box: Дата звіту
.head 5 -  Resource Id: 9420
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Window Location and Size
.head 6 -  Left:   0.133"
.head 6 -  Top:    0.107"
.head 6 -  Width:  1.7"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.521"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: 3D Shadow Color
.head 5 -  Background Color: Default
.head 4 +  Data Field: dfDat
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Data
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Editable? Yes
.head 5 -  Display Settings
.head 6 -  Window Location and Size
.head 7 -  Left:   0.233"
.head 7 -  Top:    0.31"
.head 7 -  Width:  1.483"
.head 7 -  Width Editable? Yes
.head 7 -  Height: 0.25"
.head 7 -  Height Editable? Yes
.head 6 -  Visible? Yes
.head 6 -  Border? Yes
.head 6 -  Justify: Center
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Font Name: Default
.head 6 -  Font Size: Default
.head 6 -  Font Enhancement: Default
.head 6 -  Text Color: Default
.head 6 -  Background Color: System Window Color
.head 6 -  Input Mask: Unformatted
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set dfDat=dBDat
.head 7 -  Call SalSendMsg( hWndItem, SAM_Validate, 0, 0 )
.head 6 +  On SAM_Validate
.head 7 +  If SalIsValidDateTime( dfDat)
.head 8 -  Set dDat1=dfDat
.head 8 -  Set sDat1=SalFmtFormatDateTime(dDat1, 'MM-dd-yyyy')
.head 8 -  Return VALIDATE_Ok
.head 7 -  Return VALIDATE_Cancel
.head 4 -  Group Box: Файл звіту
.head 5 -  Resource Id: 9421
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Window Location and Size
.head 6 -  Left:   1.917"
.head 6 -  Top:    0.107"
.head 6 -  Width:  2.6"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.524"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: 3D Shadow Color
.head 5 -  Background Color: Default
.head 4 +  Combo Box: cmbTip
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenComboBox_NumId
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Window Location and Size
.head 6 -  Left:   2.033"
.head 6 -  Top:    0.31"
.head 6 -  Width:  2.4"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 1.655"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Editable? No
.head 5 -  String Type: String
.head 5 -  Maximum Data Length: Default
.head 5 -  Sorted? No
.head 5 -  Always Show List? No
.head 5 -  Vertical Scroll? No
.head 5 -  Font Name: Courier
.head 5 -  Font Size: 10
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: System Window Color
.head 5 -  Input Mask: Unformatted
.head 5 -  List Initialization
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 +  If cmbTip.Init(hWndItem)
.head 8 -  Set i = 1
.head 8 +  While i <= nTipNum
.head 9 -  Call cmbTip.Add(nFileTip[i], 'Файл ' || sFileTip[nFileTip[i]] || IifS(nFileTip[i]<=4, ' - ДПА', ' - ЦВК'))
.head 9 -  Set i = i + 1
.head 8 -  Call cmbTip.SetSelectById(nTip)
.head 7 -  Call SalSendMsg(hWndItem, SAM_Click, 0, 0)
.head 6 +  On SAM_Click
.head 7 -  Call SalSendClassMessage(SAM_Click, 0, 0)
.head 7 -  Set nTip = cmbTip.nCurrentId
.head 7 -  Call SalTblReset(tblFTax)
.head 7 -  Call SalSendMsg(tblFTax, UM_ObjActivate, 0, 0)
.head 7 -  ! Кнопки
.head 7 -  Call SetButton()
.head 7 -  ! Колонки
.head 7 -  Call tblFTax.ShowColumns(nTip)
.head 7 -  Call VisTblAutoSizeColumn(tblFTax, hWndNULL)
.head 4 +  Pushbutton: pbExecute
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbExecute
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   4.583"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Наповнити таблицю даними для звіту'
.head 6 +  On SAM_Click
.head 7 -  Call SalSendMsg(tblFTax, UM_Populate, 0, 0)
.head 4 -  !
.head 4 -  Group Box: Сформований файл
.head 5 -  Resource Id: 9422
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Window Location and Size
.head 6 -  Left:   5.1"
.head 6 -  Top:    0.107"
.head 6 -  Width:  4.117"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.524"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: 3D Shadow Color
.head 5 -  Background Color: Default
.head 4 +  Check Box: cbUseFormed
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: .
.head 5 -  Window Location and Size
.head 6 -  Left:   5.183"
.head 6 -  Top:    0.31"
.head 6 -  Width:  0.35"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set MyValue = FALSE
.head 7 -  Call SalDisableWindow( pbChooseOne )
.head 7 -  Call SalDisableWindow( pbRefresh )
.head 7 -  Call SalDisableWindow( pbPrintDoc )
.head 6 +  On SAM_Click
.head 7 -  Call SalTblReset(tblFTax)
.head 7 +  If MyValue
.head 8 -  Call SalDisableWindow( pbExecute )
.head 8 -  Call SalDisableWindow( pbHardDelete )
.head 8 -  Call SalEnableWindow( pbChooseOne )
.head 8 -  Call SalEnableWindow( pbRefresh )
.head 8 -  Call SalEnableWindow( pbPrintDoc )
.head 8 -  Call SalShowWindow( tblFTax.ERR )
.head 8 +  If dfFileName != ''
.head 9 -  Call SalSendMsg( pbRefresh, SAM_Click, 0, 0 )
.head 8 -  !
.head 8 -  !
.head 8 +  If nTip = 1
.head 9 -  Set sFltrTableName = 'LINES_F'
.head 9 -  Call cFltr.Init(sFltrTableName,sFltrTableName)
.head 7 +  Else
.head 8 -  Call SalEnableWindow( pbExecute )
.head 8 -  Call SalDisableWindow( pbChooseOne )
.head 8 -  Call SalDisableWindow( pbRefresh )
.head 8 -  Call SalDisableWindow( pbPrintDoc )
.head 8 -  Call SalHideWindow( tblFTax.ERR )
.head 8 -  Set dfFileName = ''
.head 8 +  If nTip = 1
.head 9 -  Call SalEnableWindow( pbHardDelete )
.head 9 -  Set sFltrTableName = 'REE_TMP'
.head 9 -  Call cFltr.Init(sFltrTableName,sFltrTableName)
.head 8 -  Call SalSendMsg( tblFTax, UM_Populate, 0, 0 )
.head 4 +  Data Field: dfFileName
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Data
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Editable? No
.head 5 -  Display Settings
.head 6 -  Window Location and Size
.head 7 -  Left:   5.533"
.head 7 -  Top:    0.31"
.head 7 -  Width:  2.067"
.head 7 -  Width Editable? Yes
.head 7 -  Height: 0.25"
.head 7 -  Height Editable? Yes
.head 6 -  Visible? Yes
.head 6 -  Border? Yes
.head 6 -  Justify: Right
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Font Name: Default
.head 6 -  Font Size: Default
.head 6 -  Font Enhancement: Default
.head 6 -  Text Color: Default
.head 6 -  Background Color: 3D Highlight Color
.head 6 -  Input Mask: Unformatted
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbChooseOne
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbDetail
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   7.733"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Вибрати файл з вже сформованих'
.head 6 +  On SAM_Click
.head 7 +  If GetGlobalOption('ORGTYPE')= 'KAZNA'
.head 8 +  If SalModalDialog(dlg_ChooseNIKaz, hWndForm, strFileChoosen, dtChoosen)
.head 9 +  If strFileChoosen != STRING_Null
.head 10 -  Set dfFileName = strFileChoosen
.head 10 -  Call SalSendMsg(pbRefresh, SAM_Click, 0, 0)
.head 7 +  Else
.head 8 +  If SalModalDialog(dlg_ChooseNIFile, hWndForm, nTip, sFilterTip, strFileChoosen, dtChoosen)
.head 9 -  Set dfFileName = strFileChoosen
.head 9 -  Call SalSendMsg(pbRefresh, SAM_Click, 0, 0)
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbRefresh
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   8.167"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Перечитати файл'
.head 6 +  On SAM_Click
.head 7 -  ! populate table with data from storage table
.head 7 +  If cbUseFormed
.head 8 -  Call SalWaitCursor( TRUE )
.head 8 +  Select Case nTip
.head 9 +  Case 1
.head 10 -  Set strTabLines = 'LINES_F'
.head 10 -  Set strFormedVar  = 'mfo,okpo,rtype,otype,odate,nls,kv,resid,nmkk,adr,c_reg,ntax,err,n'
.head 10 -  Set strFormedInto = ':tblFTax.MFO,:tblFTax.OKPO,:tblFTax.TYP_REES,:tblFTax.TYP_OPER,:tblFTax.DAT_OPER,
:tblFTax.NLS,:tblFTax.KV,:tblFTax.REZ,:tblFTax.NMS,:tblFTax.ADR,:tblFTax.OBL,:tblFTax.RAY,:tblFTax.ERR,:tblFTax.NUMS'
.head 10 -  Break
.head 9 +  Case 2
.head 10 -  Set strTabLines = 'LINES_TB'
.head 10 -  Set strFormedVar  = 'MFOA,NLSA,MFOB,NLSB,DK,S,KV,VOB,ND,DATD,NAMA,NAMB,NAZN,DREC,NAZNK,NAZNS,OKPO,REF_A,DAT_A,DAT_B,ERR'
.head 10 -  Set strFormedInto = ':tblFTax.MFOA, :tblFTax.NLSA, :tblFTax.MFOB, :tblFTax.NLSB,
:tblFTax.DK, :tblFTax.S, :tblFTax.KV, :tblFTax.VOB, :tblFTax.ND, :tblFTax.DATD, :tblFTax.NAMA,
:tblFTax.NAMB, :tblFTax.NAZN, :tblFTax.DREC, :tblFTax.NAZNK, :tblFTax.NAZNS, :tblFTax.OKPO,
:tblFTax.REF_A, :tblFTax.DAT_A, :tblFTax.DAT_B, :tblFTax.ERR'
.head 10 -  Break
.head 9 +  Case 3
.head 10 -  Set strTabLines = 'LINES_K'
.head 10 -  Set strFormedVar  = 'mfo, okpo, otype, odate,
  nls, kv, resid, nmkk, country, c_reg, err, n'
.head 10 -  Set strFormedInto = ':tblFTax.BIC, :tblFTax.OKPO, :tblFTax.TYP_OPER, :tblFTax.DAT_OPER,
  :tblFTax.NLS, :tblFTax.KV, :tblFTax.REZ, :tblFTax.NMS, :tblFTax.COUNTRY,
  :tblFTax.OBL, :tblFTax.ERR, :tblFTax.NUMS'
.head 10 -  Break
.head 9 +  Case 4
.head 10 -  Set strTabLines = 'LINES_P'
.head 10 -  Set strFormedVar  = 'mfo, bank_okpo, nb,okpo,rtype,otype,odate,nls,resid,nmkk,adr,c_reg,ntax,err,n'
.head 10 -  Set strFormedInto = ':tblFTax.MFO,:tblFTax.BANK_OKPO,:tblFTax.NB,:tblFTax.OKPO,:tblFTax.TYP_REES,:tblFTax.TYP_OPER,:tblFTax.DAT_OPER,
:tblFTax.NLS,:tblFTax.REZ,:tblFTax.NMS,:tblFTax.ADR,:tblFTax.OBL,:tblFTax.RAY,:tblFTax.ERR,:tblFTax.NUMS'
.head 10 -  Break
.head 9 +  Case 5
.head 10 -  Set strTabLines = 'LINES_CV'
.head 10 -  Set strFormedVar  = 'MFOA,NLSA,MFOB,NLSB,DK,S,VOB,ND,KV,DATD,NAMA,NAMB,NAZN,DREC,NAZNK,NAZNS,OKPOA,OKPOB,REF_A,DAT_A,DAT_B'
.head 10 -  Set strFormedInto = ':tblFTax.MFOA, :tblFTax.NLSA, :tblFTax.MFOB, :tblFTax.NLSB,
:tblFTax.DK, :tblFTax.S, :tblFTax.VOB, :tblFTax.ND, :tblFTax.KV, :tblFTax.DATD, :tblFTax.NAMA,
:tblFTax.NAMB, :tblFTax.NAZN, :tblFTax.DREC, :tblFTax.NAZNK, :tblFTax.NAZNS, :tblFTax.OKPOA, :tblFTax.OKPOB,
:tblFTax.REF_A, :tblFTax.DAT_A, :tblFTax.DAT_B'
.head 10 -  Break
.head 9 +  Case 6
.head 10 -  Set strTabLines = 'LINES_CA'
.head 10 -  Set strFormedVar  = 'MFO, NB, NLS, VID, NUM_TVO, NAME_BLOK, DAOS, FIO_BLOK, FIO_ISP, INF_ISP'
.head 10 -  Set strFormedInto = ':tblFTax.MFO, :tblFTax.NB, :tblFTax.NLS, :tblFTax.VID,
:tblFTax.NUM_TVO, :tblFTax.NAME_BLOK, :tblFTax.DAOS, :tblFTax.FIO_BLOK,
:tblFTax.FIO_ISP, :tblFTax.INF_ISP'
.head 10 -  Break
.head 9 +  Default
.head 10 -  Return FALSE
.head 10 -  Break
.head 8 -  Set sSql = 'SELECT ' || strFormedVar || ' INTO ' || strFormedInto || ' FROM ' || strTabLines ||
' WHERE fn = :strFileChoosen AND dat = :dtChoosen '
.head 8 +  If sFltrWhereClause
.head 9 -  Set sSql = sSql ||" and "||sFltrWhereClause
.head 8 -  Set sSql = sSql ||' ORDER BY n '
.head 8 -  Call SalTblPopulate( tblFTax, hSql(), sSql, TBL_FillAll )
.head 8 -  Call VisTblAutoSizeColumn(tblFTax, hWndNULL)
.head 8 -  Set sFltrWhereClause = STRING_Null
.head 8 -  Call SalWaitCursor( FALSE )
.head 4 +  Pushbutton: pbPrintDoc
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbOk
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   8.617"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\DOC.BMP
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Друк повідомлень'
.head 6 +  On SAM_Click
.head 7 +  If dfFileName
.head 8 -  Call tblFTax.PrintTicketF(dfFileName)
.head 4 -  !
.head 4 +  Pushbutton: pbInsert
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbInsert
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   9.333"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\Insert.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Добавити запис'
.head 6 +  On SAM_Click
.head 7 -  Call SalSendMsg(tblFTax, UM_Insert, 0, 0)
.head 4 +  Pushbutton: pbDelete
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbBrowse
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   9.767"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\Delete.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Помітити запис на видалення'
.head 6 +  On SAM_Click
.head 7 -  Set nRow = TBL_MinRow
.head 7 +  While SalTblFindNextRow( hWndForm.frm_FilesNI.tblFTax, nRow, ROW_Selected, 0 )
.head 8 -  Call SalTblSetContext( hWndForm.frm_FilesNI.tblFTax, nRow )
.head 8 +  ! If cbUseFormed
.head 9 +   If NOT SqlPrepareAndExecute( hSql(), "
  UPDATE ree_tmp SET fn_o=null, dat_o=null, rec_o=null
  WHERE fn_o=:dfFileName and rec_o=:tblFTax.NUMS" )
.head 10 -   Return FALSE
.head 8 -  Call SalTblDeleteRow( hWndForm.frm_FilesNI.tblFTax, nRow, TBL_NoAdjust )
.head 8 -  Set nRow = nRow - 1
.head 4 +  Pushbutton: pbHardDelete
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbDelete
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   10.217"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Помітити запис на видалення з БД'
.head 6 +  On SAM_Click
.head 7 +  If SalMessageBox( 'Відмічені записи будуть видалені з БД.
Продовжити?', 'Увага!', MB_YesNo|MB_IconQuestion ) = IDNO
.head 8 -  Return TRUE
.head 7 -  Set nRow = TBL_MinRow
.head 7 +  While SalTblFindNextRow( hWndForm.frm_FilesNI.tblFTax, nRow, ROW_Selected, 0 )
.head 8 -  Call SalTblSetContext( hWndForm.frm_FilesNI.tblFTax, nRow )
.head 8 -  ! Call SalTblDeleteRow( hWndForm.frm_FilesNI.tblFTax, nRow, TBL_NoAdjust )
.head 8 +  If NOT SqlPrepareAndExecute( hSql(), "
  DELETE FROM ree_tmp
  WHERE rowid=:tblFTax.ROWID " )
.head 9 -  Return FALSE
.head 8 -  Call SalTblDeleteRow( hWndForm.frm_FilesNI.tblFTax, nRow, TBL_NoAdjust )
.head 7 -  Call SqlCommit( hSql() )
.head 4 +  Pushbutton: pbFilter
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbDelete
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   10.65"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\FILTER.BMP
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Фільтр'
.head 6 +  On SAM_Click
.head 7 +  If SetQueryFilter( cFltr )
.head 8 -  Set sFltrWhereClause = cFltr.GetFilterWhereClause(FALSE)
.head 8 +  If cbUseFormed
.head 9 -  Call SalSendMsg(pbRefresh, SAM_Click, 0, 0)
.head 8 +  Else
.head 9 -  Call SalPostMsg(tblFTax, UM_Populate, 0, 0)
.head 4 +  Pushbutton: pbSearchClient
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbSearch
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   11.1"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\USER.BMP
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Пошук клієнта'
.head 6 +  On SAM_Click
.head 7 -  Call SalSendMsg(tblFTax, SAM_User, 0, 0)
.head 4 -  !
.head 4 +  Pushbutton: pbHiden
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbSynchro
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? No
.head 5 -  Keyboard Accelerator: F8
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Сформувати файл @B'
.head 6 +  On SAM_Click
.head 7 +  If nTip=2
.head 8 -  ! Get the Number of Current File
.head 8 -  Set nFileNum = 0
.head 8 -  Set strAttrDate = 'TAXB_DATE'
.head 8 -  Set strAttrNum  = 'TAXB_SEQ'
.head 8 +  If SqlPrepareAndExecute(hSql(), 'SELECT ' || strAttrDate || ',' || strAttrNum ||
' INTO :dtLastTime, :nFileNum FROM DPA_FILE_COUNTERS' )
.head 9 -  Call SqlFetchNext( hSql(), nFetchRes )
.head 8 +  If nFileNum = NUMBER_Null OR dtLastTime != SalFmtFormatStrDateTime( SalFmtFormatDateTime( SalDateCurrent(), 'dd/MM/yyyy' ), 'dd/MM/yyyy')
.head 9 -  Set nFileNum = 0
.head 8 -  Set nFileNum = nFileNum + 1
.head 8 -  !
.head 8 -  ! Create file names
.head 8 -  Set strFileName = sFileTip[nTip] || GetGlobalOption('AREACODE') || Subs(GetBankSab(),2,3) ||
    GetCharForDigit(SalDateMonth(SalDateCurrent())) || GetCharForDigit(SalDateDay(SalDateCurrent())) || '.'
.head 8 -  Set strFileName = strFileName || Right( '000' || Str(nFileNum ), 3)
.head 8 -  Set Rep_PathDst = Rep_PathNI || '\\' || strFileName
.head 8 -  ! Set Rep_PathTmp = GetPrnDir() || '\\' || strFileName
.head 8 -  !
.head 8 -  ! Get confirmation from user
.head 8 +  If MessageQuestion('Сформувати файли @B в каталог ' || Rep_PathNI || ' ?') = IDNO
.head 9 -  Return FALSE
.head 8 -  !
.head 8 -  ! Create files
.head 8 -  Set fRet =  FunCreateTaxDocFile2( Rep_PathDst)
.head 8 -  !
.head 8 -  ! Update file number sequence
.head 8 +  If fRet
.head 9 +  If SqlPrepareAndExecute( hSql(),'UPDATE DPA_FILE_COUNTERS SET ' || strAttrDate || '=' ||
DateInQuery( SalFmtFormatDateTime( SalDateCurrent(), 'MM/dd/yyyy' ) ) || ',' ||
strAttrNum || '= :nFileNum')
.head 10 -  Call SqlCommitEx(hSql(), 'Обновление очередного номера файла ' || strAttrNum || ' на ' || SalNumberToStrX(nFileNum,0))
.head 4 +  Pushbutton: pbForm
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbUpdate
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   11.767"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \Bars98\RESOURCE\BMP\Tomail.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Сформувати файл'
.head 6 +  On SAM_Click
.head 7 -  Call SalWaitCursor(TRUE)
.head 7 -  Set nRec = 0
.head 7 -  Set nRow = TBL_MinRow
.head 7 +  While SalTblFindNextRow(tblFTax, nRow, 0, 0)
.head 8 -  Set nRec = nRec + 1
.head 7 +  If nRec = 0
.head 8 -  Call SalMessageBox('Відсутні дані для файлу', 'Увага!', MB_Ok)
.head 8 -  Call SalWaitCursor(FALSE)
.head 7 +  Else
.head 8 -  ! Имя файла для @B, CV, CA
.head 8 +  If nTip = 2 or nTip = 5 or nTip = 6
.head 9 -  ! Get the Number of Current File
.head 9 +  Select Case nTip
.head 10 +  Case 1
.head 11 -  Set strAttrDate = 'TAXF_DATE'
.head 11 -  Set strAttrNum  = 'TAXF_SEQ'
.head 11 -  Set strAttrNumDef  = 'TAXF_SEQ_DEFAULT'
.head 11 -  Break
.head 10 +  Case 2
.head 11 -  Set strAttrDate = 'TAXB_DATE'
.head 11 -  Set strAttrNum  = 'TAXB_SEQ'
.head 11 -  Set strAttrNumDef  = 'TAXB_SEQ_DEFAULT'
.head 11 -  Break
.head 10 +  Case 3
.head 11 -  Set strAttrDate = 'TAXK_DATE'
.head 11 -  Set strAttrNum  = 'TAXK_SEQ'
.head 11 -  Set strAttrNumDef  = 'TAXK_SEQ_DEFAULT'
.head 11 -  Break
.head 10 +  Case 4
.head 11 -  Set strAttrDate = 'TAXP_DATE'
.head 11 -  Set strAttrNum  = 'TAXP_SEQ'
.head 11 -  Set strAttrNumDef  = 'TAXP_SEQ_DEFAULT'
.head 11 -  Break
.head 10 +  Case 5
.head 11 -  Set strAttrDate = 'TAXCV_DATE'
.head 11 -  Set strAttrNum  = 'TAXCV_SEQ'
.head 11 -  Set strAttrNumDef  = 'TAXCV_SEQ_DEFAULT'
.head 11 -  Break
.head 10 +  Case 6
.head 11 -  Set strAttrDate = 'TAXCA_DATE'
.head 11 -  Set strAttrNum  = 'TAXCA_SEQ'
.head 11 -  Set strAttrNumDef  = 'TAXCA_SEQ_DEFAULT'
.head 11 -  Break
.head 10 +  Default
.head 11 -  Return FALSE
.head 11 -  Break
.head 9 -  Set nFileNum = 0
.head 9 +  If SqlPrepareAndExecute(hSql(),
'SELECT ' || strAttrDate || ',' || strAttrNum || ',nvl(' || strAttrNumDef ||
', 0)  INTO :dtLastTime, :nFileNum, :nFileNumDef ' ||
'  FROM DPA_FILE_COUNTERS' )
.head 10 -  Call SqlFetchNext( hSql(), nFetchRes )
.head 9 +  If nFileNum = NUMBER_Null OR dtLastTime != SalFmtFormatStrDateTime( SalFmtFormatDateTime( SalDateCurrent(), 'dd/MM/yyyy' ), 'dd/MM/yyyy')
.head 10 -  Set nFileNum = nFileNumDef
.head 9 -  Set nFileNum = nFileNum + 1
.head 9 -  !
.head 9 -  ! Create file names
.head 9 -  Set strFileName = sFileTip[nTip] ||
    IifS(nTip=5 OR nTip=6, 'O', GetGlobalOption('AREACODE')) ||
    IifS(sDPA_SAB='', Subs(GetBankSab(),2,3), sDPA_SAB) ||
    GetCharForDigit(SalDateMonth(SalDateCurrent())) || GetCharForDigit(SalDateDay(SalDateCurrent())) || '.'
.head 9 +  Select Case nTip
.head 10 +  Case 2          ! -> ДПА   @B
.head 11 -  Set strFileName = Left(strFileName,6) ||
 GetCharForDigit(SalDateMonth(dDat1)) || GetCharForDigit(SalDateDay(dDat1)) ||'.'||
    Right( '000' || Str(nFileNum ), 3)
.head 11 -  Set Rep_PathDst = Rep_PathNI || '\\' || strFileName
.head 11 -  Break
.head 10 -  Case 1
.head 10 -  Case 3
.head 10 +  Case 4		! -> ДПА
.head 11 -  Set strFileName = strFileName || Right( '000' || Str(nFileNum ), 3)
.head 11 -  Set fPreserveFileName = FALSE
.head 11 +  If cbUseFormed and dfFileName
.head 12 +  If SalMessageBox("Зберігати ім'я файлу?", 'Увага!', MB_YesNo | MB_IconQuestion | MB_DefButton2) = IDYES
.head 13 -  Set fPreserveFileName = TRUE
.head 13 -  Set strFileName = dfFileName
.head 13 -  Set nFileNum = Val(Right(strFileName, 3))
.head 12 +  Else
.head 13 -  ! Для @F применяем счетчик файлов с тек. банк.датой
.head 13 -  Call SqlPrepareAndExecute(hSql(),
"SELECT nvl(max(to_number(substr(fn,-3))),0)
   INTO :nFileNum
   FROM zag_f
  WHERE trunc(dat,'dd')=trunc(sysdate,'dd')
    AND fn like " || IifS(nTip=4,"'@P%'",IifS(nTip=3,"'@K%'","'@F%'")) )
.head 13 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 13 -  Set nFileNum = nFileNum + 1
.head 13 -  Set strFileName = Subs(strFileName,1,9) || Right( '000' || Str(nFileNum ), 3)
.head 11 -  Set Rep_PathDst = Rep_PathNI || '\\' || strFileName
.head 11 -  Break
.head 10 +  Case 5          ! -> ЦВК   CV
.head 11 -  ! Set nFileNum = 1
.head 11 -  Set strFileName = strFileName || Right('000' || Str(nFileNum ), 3)
.head 11 -  Set Rep_PathDst = Rep_PathNB || '\\' || strFileName
.head 11 -  ! Set Rep_PathDst = Rep_PathNI || '\\' || strFileName
.head 11 -  Break
.head 10 +  Case 6          ! -> ЦВК   CA
.head 11 -  Set strFileName = strFileName || Right('000' || Str(nFileNum ), 3)
.head 11 -  Set Rep_PathDst = Rep_PathNB || '\\' || strFileName
.head 11 -  ! Set Rep_PathDst = Rep_PathNI || '\\' || strFileName
.head 11 -  Break
.head 10 +  Default
.head 11 -  Return FALSE
.head 11 -  Break
.head 8 -  Call SalWaitCursor( FALSE )
.head 8 -  ! Get confirmation from user
.head 8 +  If nTip = 2
.head 9 +  If MessageQuestion('Сформувати файли @B в каталог ' || Rep_PathNI || ' ?') = IDNO
.head 10 -  Return FALSE
.head 8 +  Else
.head 9 +  If MessageQuestion('Сформувати файл ' || sFileTip[nTip] || ' ?') = IDNO
.head 10 -  Return FALSE
.head 8 -  !
.head 8 -  ! Create files
.head 8 +  Select Case nTip
.head 9 +  Case 1		! @F
.head 10 -  Set fRet = CreateFileXml('F')
.head 10 -  Break
.head 9 +  Case 2		! @B
.head 10 -  Set fRet = FunCreateTaxDocFile( Rep_PathDst)
.head 10 -  Break
.head 9 +  Case 3		! @K
.head 10 -  Set fRet = CreateFileXml('K')
.head 10 -  Break
.head 9 +  Case 4		! @P
.head 10 -  Set fRet = CreateFileXml('P')
.head 10 -  Break
.head 9 +  Case 5		! CV
.head 10 -  Set fRet = FunCreateTaxDocFileCV(Rep_PathDst, nFileNum)
.head 10 -  Break
.head 9 +  Case 6		! CA
.head 10 -  Set fRet = FunCreateTaxDocFileCA(Rep_PathDst)
.head 10 -  Break
.head 9 +  Default
.head 10 -  Return FALSE
.head 10 -  Break
.head 8 -  !
.head 8 -  ! Update file number sequence
.head 8 +  If fRet
.head 9 +  If NOT fPreserveFileName
.head 10 +  If nTip = 2 or nTip = 5 or nTip = 6
.head 11 +  If SqlPrepareAndExecute(hSql(),
'UPDATE DPA_FILE_COUNTERS SET ' || strAttrDate || '=' ||
DateInQuery( SalFmtFormatDateTime( SalDateCurrent(), 'MM/dd/yyyy' ) ) || ',' ||
strAttrNum || '= :nFileNum')
.head 12 -  Call SqlCommitEx(hSql(), 'Обновление очередного номера файла ' || strAttrNum || ' на ' || SalNumberToStrX(nFileNum,0))
.head 9 -  Set cbUseFormed = FALSE
.head 9 -  Set dfFileName = ''
.head 9 -  Call SetButton()
.head 9 -  Call SalTblReset( tblFTax )
.head 4 +  Pushbutton: pbGetTickets
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbUpdate
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   12.2"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\chkmail.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Обробити квитанції для файлів'
.head 6 +  On SAM_Click
.head 7 -  Set Rep_TMask = ''
.head 7 -  Set strTabZag = ''
.head 7 -  Set strTabLines = ''
.head 7 +  Select Case nTip
.head 8 +  Case 1		! @F
.head 9 -  Set Rep_TMask = '@IF*.*'
.head 9 -  Set strTabZag = 'ZAG_F'
.head 9 -  Set strTabLines = 'LINES_F'
.head 9 -  Break
.head 8 +  Case 2		! @B
.head 9 -  Set Rep_TMask = '@IB*.*'
.head 9 -  Set strTabZag = 'ZAG_TB'
.head 9 -  Set strTabLines = 'LINES_TB'
.head 9 -  Break
.head 8 +  Case 3		! @K
.head 9 -  Set Rep_TMask = '@IK*.*'
.head 9 -  Set strTabZag = 'ZAG_F'
.head 9 -  Set strTabLines = 'LINES_K'
.head 9 -  Break
.head 8 +  Case 4		! @P
.head 9 -  Set Rep_TMask = '@IP*.*'
.head 9 -  Set strTabZag = 'ZAG_F'
.head 9 -  Set strTabLines = 'LINES_P'
.head 9 -  Break
.head 8 +  ! Case 5		! CV
.head 9 -  Set Rep_TMask = 'CCV*.*'
.head 9 -  Set strTabZag = 'ZAG_TB'
.head 9 -  Set strTabLines = 'LINES_CV'
.head 9 -  Break 
.head 8 +  ! Case 6		! CA
.head 9 -  Set Rep_TMask = 'CCA*.*'
.head 9 -  Set strTabZag = 'ZAG_TB'
.head 9 -  Set strTabLines = 'LINES_CV'
.head 9 -  Break 
.head 8 +  Default
.head 9 -  Return FALSE
.head 9 -  Break
.head 7 +  If Rep_TMask
.head 8 -  Call ShowDpaTickets(hWndMDI, TRUE, Rep_Tickets, Rep_TMask, strTabZag, strTabLines)
.head 4 +  Pushbutton: pbInROutS
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbChilds
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   12.633"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\TUDASUDA.BMP
.head 5 -  Picture Transparent Color: White
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 -  Set Rep_TMask = ''
.head 7 +  Select Case nTip
.head 8 +  Case 1
.head 9 -  Set Rep_TMask = '@R*.*'
.head 9 -  Break
.head 8 +  Case 4
.head 9 -  Set Rep_TMask = '@D*.*'
.head 9 -  Break
.head 8 +  Default
.head 9 -  Break
.head 7 +  If Rep_TMask
.head 8 -  Call ShowDpaTickets(hWndMDI, TRUE, Rep_Tickets, Rep_TMask, strTabZag, strTabLines)
.head 4 +  Pushbutton: pbDetPrint
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbPrint
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   13.033"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\print.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Надрукувати файл з розшифровкою реквізитів'
.head 6 +  On SAM_Click
.head 7 -  Set strFileName = sFileTip[nTip] || GetGlobalOption('AREACODE') || Subs(GetBankSab(),2,3) ||
    GetCharForDigit(SalDateMonth(SalDateCurrent())) || GetCharForDigit(SalDateDay(SalDateCurrent()))
.head 7 +  If cbUseFormed and dfFileName
.head 8 -  Set strFileName = dfFileName
.head 7 -  Call TablePrint( tblFTax, 'Звіт для '||sNam||' файл ' || strFileName ||
 ' за ' || sDat1, GetPrnDir() || '\\' ||strFileName || '.TXT', '' )
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbCancel
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   13.733"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Завершити роботу функції'
.head 6 +  On SAM_Click
.head 7 -  Call SalDestroyWindow (hWndForm)
.head 2 +  Contents
.head 3 +  Child Table: tblFTax
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.0"
.head 6 -  Top:    0.0"
.head 6 -  Width:  12.283"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 5.619"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Black
.head 5 -  Background Color: System Window Color
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 30000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 -  ! Для @F
.head 5 +  Column: MFO		! МФО
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Right
.head 6 -  Width:  1.233"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: BIC		! Код банку
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код банку
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 40
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: BANK_OKPO	! ЗКПО банку
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: ЗКПО банку
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 40
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NB		! Назва банку
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Назва
банку
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 70
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: OKPO		! ЗКПО
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: ЗКПО
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 14
.head 6 -  Data Type: String
.head 6 -  Justify: Right
.head 6 -  Width:  2.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: TYP_REES	! Реєстр
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Реє
стр
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 1
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: TYP_OPER	! Опр.
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Опр.
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 1
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.417"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: DAT_OPER	! Дата операції
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата
операції
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Left
.head 6 -  Width:  1.183"
.head 6 -  Width Editable? Yes
.head 6 -  Format: dd/MM/yyyy
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NLS		! Рахунок клієнта
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Рахунок
клієнта
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 14
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: KV		! Валюта
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вал
юта
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 3
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.543"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: OST		! Залишок
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Залишок
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  ! Column: PR_NLS		! Осн.
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Осн.

.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 1
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.467"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -  List Values 
.head 6 -  Message Actions 
.head 5 +  ! Column: NLS_VID		! Вид рахунку
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вид
рахунку
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -  List Values 
.head 6 -  Message Actions 
.head 5 +  Column: REZ		! Рез.
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Рез.
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 1
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.467"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: COUNTRY		! Код країни
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
країни
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 3
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.8"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NMS		! Назва
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Назва
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 38
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.043"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: ADR		! Адреса
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Адреса
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 80
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.043"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: OBL		! Код ДПА
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
ДПА
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 2
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 +  On SAM_Validate
.head 8 +  If OBL != ''
.head 9 +  If NOT SqlPrepareAndExecute(hSql(),
"SELECT kod_reg INTO :tblFTax.SIMVOL
   FROM spr_obl WHERE c_reg=to_number(:tblFTax.OBL)")
or NOT SqlFetchNext( hSql(), nFetchRes)
.head 10 -  Call SalMessageBox('Невірно введено код області!', 'Увага!', MB_Ok|MB_IconExclamation)
.head 10 -  Return VALIDATE_Cancel
.head 8 -  Return VALIDATE_Ok
.head 5 +  Column: RAY		! Код органу реєстрації
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код органу
реєстрації
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 2
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: SIMVOL		! Символ області
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Символ
області
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 1
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.45"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 -  ! Для @B
.head 5 +  Column: MFOA		! МФО А
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО
А
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.167"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NLSA		! Рахунок А
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Рахунок
А
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 14
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.833"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: MFOB		! МФО Б
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО
Б
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.15"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NLSB		! Рахунок Б
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Рахунок
Б
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 14
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.8"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: DK		! Д/К
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Д/К
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 1
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.483"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: S		! Сума
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Сума
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 15
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  1.733"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: VOB		! Вид док
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вид
док
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 2
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.467"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: ND		! Номер док
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Номер
док
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 10
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.367"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: KV_CV		! Валюта
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вал
юта
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 3
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: DATD		! Дата док
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата
док
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Center
.head 6 -  Width:  1.15"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: DATP		! Дата А
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата
А
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Center
.head 6 -  Width:  1.233"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NAMA		! Назва клієнта А
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Назва клієнта
А

.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 38
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NAMB		! Назва клієнта Б
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Назва клієнта
Б
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 38
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NAZN		! Призначення платежу
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Призначення платежу
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 166
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: DREC		! Дод реквізити
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дод реквізити
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 60
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NAZNK		! Код призн
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
призн
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 3
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NAZNS		! Спосіб заповнення
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Спосіб
заповнення
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 2
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: OKPOA		! Ідент.код клієнта А
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Ідент.код
клієнта А
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 14
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: OKPOB		! Ідент.код клієнта Б
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Ідент.код
клієнта Б
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 14
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: REF_A		! Реф А
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Реф
А
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: DAT_A		! Дата А
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата
А
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Center
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: DAT_B		! Дата Б
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата
Б
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Center
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: KTK		! Код тер
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
тер
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 4
.head 6 -  Data Type: String
.head 6 -  Justify: Right
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 -  ! CA
.head 5 +  Column: VID		! Вид рахунку
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вид
рахунку
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 1
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NUM_TVO		! № ТВО
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: № ТВО
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 3
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NAME_BLOK	! Назва партії
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Назва
партії
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 250
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: CA_CUST_OKPO	! Код ЗКПО
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код ЗКПО
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 10
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: DAOS		! Дата відкр. рахунку
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата
відкр. рахунку
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Center
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: FIO_BLOK	! ПІБ розпорядника
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: ПІБ
розпорядника
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 76
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: FIO_ISP		! ПІБ відп.виконавця
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: ПІБ
відп.виконавця
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 38
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: INF_ISP		! Дод. інформація про відп.вик.
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дод. інформація
про відп.вик.
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 38
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: CA_BANK_ADDRESS	! Адреса банку
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Адреса банку
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 250
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 -  !
.head 5 +  Column: ERR		! Код Квитовки
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
Квитовки
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 4
.head 6 -  Data Type: String
.head 6 -  Justify: Right
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: ROWID
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NUMS
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: ShowColumns
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  Number: nFileTip
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Window Handle: hWndObject
.head 6 +  Actions
.head 7 -  Set hWndObject = SalGetFirstChild(hWndForm, TYPE_TableColumn)
.head 7 +  While hWndObject != hWndNULL
.head 8 -  Call SalHideWindow(hWndObject)
.head 8 -  Set hWndObject = SalGetNextChild(hWndObject, TYPE_TableColumn)
.head 7 +  Select Case nFileTip
.head 8 +  Case 1
.head 9 -  Call SalShowWindow(MFO)
.head 9 -  Call SalShowWindow(OKPO)
.head 9 -  Call SalShowWindow(TYP_REES)
.head 9 -  Call SalShowWindow(TYP_OPER)
.head 9 -  Call SalShowWindow(DAT_OPER)
.head 9 -  Call SalShowWindow(NLS)
.head 9 -  Call SalSetMaxDataLength(NLS, 14)
.head 9 -  Call SalShowWindow(KV)
.head 9 -  ! Call SalShowWindow(PR_NLS)
.head 9 -  ! Call SalShowWindow(NLS_VID)
.head 9 -  Call SalShowWindow(REZ)
.head 9 -  Call SalShowWindow(NMS)
.head 9 -  Call SalShowWindow(ADR)
.head 9 -  Call SalShowWindow(OBL)
.head 9 -  Call SalShowWindow(RAY)
.head 9 -  Call SalShowWindow(hWndItem)
.head 9 -  Break
.head 8 +  Case 2
.head 9 -  Call SalShowWindow(OKPO)
.head 9 -  Call SalShowWindow(MFOA)
.head 9 -  Call SalShowWindow(NLSA)
.head 9 -  Call SalShowWindow(MFOB)
.head 9 -  Call SalShowWindow(NLSB)
.head 9 -  Call SalShowWindow(DK)
.head 9 -  Call SalShowWindow(S)
.head 9 -  Call SalShowWindow(VOB)
.head 9 -  Call SalShowWindow(ND)
.head 9 -  Call SalShowWindow(KV)
.head 9 -  Call SalShowWindow(DATD)
.head 9 -  Call SalShowWindow(DATP)
.head 9 -  Call SalShowWindow(NAMA)
.head 9 -  Call SalShowWindow(NAMB)
.head 9 -  Call SalShowWindow(NAZN)
.head 9 -  Call SalShowWindow(DREC)
.head 9 -  Call SalShowWindow(NAZNK)
.head 9 -  Call SalShowWindow(NAZNS)
.head 9 -  Call SalShowWindow(REF_A)
.head 9 -  Call SalShowWindow(DAT_A)
.head 9 -  Call SalShowWindow(DAT_B)
.head 9 -  Call SalShowWindow(KTK)
.head 9 -  Break
.head 8 +  Case 3
.head 9 -  Call SalShowWindow(BIC)
.head 9 -  Call SalShowWindow(OKPO)
.head 9 -  Call SalShowWindow(TYP_OPER)
.head 9 -  Call SalShowWindow(DAT_OPER)
.head 9 -  Call SalShowWindow(NLS)
.head 9 -  Call SalSetMaxDataLength(NLS, 40)
.head 9 -  Call SalShowWindow(KV)
.head 9 -  Call SalShowWindow(REZ)
.head 9 -  Call SalShowWindow(COUNTRY)
.head 9 -  Call SalShowWindow(NMS)
.head 9 -  Call SalShowWindow(OBL)
.head 9 -  Call SalShowWindow(hWndItem)
.head 9 -  Call SalShowWindow(hWndItem)
.head 9 -  Break
.head 8 +  Case 4
.head 9 -  Call SalShowWindow(MFO)
.head 9 -  Call SalShowWindow(BANK_OKPO)
.head 9 -  Call SalShowWindow(NB)
.head 9 -  Call SalShowWindow(OKPO)
.head 9 -  Call SalShowWindow(TYP_REES)
.head 9 -  Call SalShowWindow(TYP_OPER)
.head 9 -  Call SalShowWindow(DAT_OPER)
.head 9 -  Call SalShowWindow(NLS)
.head 9 -  Call SalSetMaxDataLength(NLS, 40)
.head 9 -  Call SalShowWindow(REZ)
.head 9 -  Call SalShowWindow(NMS)
.head 9 -  Call SalShowWindow(ADR)
.head 9 -  Call SalShowWindow(OBL)
.head 9 -  Call SalShowWindow(RAY)
.head 9 -  Break
.head 8 +  Case 5
.head 9 -  Call SalShowWindow(NLS)
.head 9 -  Call SalSetMaxDataLength(NLS, 14)
.head 9 -  ! Call SalShowWindow(OST)
.head 9 -  Call SalShowWindow(MFOA)
.head 9 -  Call SalShowWindow(NLSA)
.head 9 -  Call SalShowWindow(MFOB)
.head 9 -  Call SalShowWindow(NLSB)
.head 9 -  Call SalShowWindow(DK)
.head 9 -  Call SalShowWindow(S)
.head 9 -  Call SalShowWindow(VOB)
.head 9 -  Call SalShowWindow(ND)
.head 9 -  Call SalShowWindow(KV_CV)
.head 9 -  Call SalShowWindow(DATD)
.head 9 -  Call SalShowWindow(DATP)
.head 9 -  Call SalShowWindow(NAMA)
.head 9 -  Call SalShowWindow(NAMB)
.head 9 -  Call SalShowWindow(NAZN)
.head 9 -  Call SalShowWindow(DREC)
.head 9 -  Call SalShowWindow(NAZNK)
.head 9 -  Call SalShowWindow(NAZNS)
.head 9 -  Call SalShowWindow(OKPOA)
.head 9 -  Call SalShowWindow(OKPOB)
.head 9 -  Call SalShowWindow(REF_A)
.head 9 -  Call SalShowWindow(DAT_A)
.head 9 -  Call SalShowWindow(DAT_B)
.head 9 -  Call SalShowWindow(hWndItem)
.head 9 -  Call SalShowWindow(hWndItem)
.head 9 -  Break
.head 8 +  Case 6
.head 9 -  Call SalShowWindow(MFO)
.head 9 -  Call SalShowWindow(NB)
.head 9 -  Call SalShowWindow(NLS)
.head 9 -  Call SalSetMaxDataLength(NLS, 14)
.head 9 -  Call SalShowWindow(VID)
.head 9 -  Call SalShowWindow(NUM_TVO)
.head 9 -  Call SalShowWindow(NAME_BLOK)
.head 9 -  Call SalShowWindow(CA_CUST_OKPO)
.head 9 -  Call SalShowWindow(DAOS)
.head 9 -  Call SalShowWindow(FIO_BLOK)
.head 9 -  Call SalShowWindow(FIO_ISP)
.head 9 -  Call SalShowWindow(INF_ISP)
.head 9 -  Call SalShowWindow(CA_BANK_ADDRESS)
.head 9 -  Break
.head 8 +  Default
.head 9 -  Break
.head 7 -  Return TRUE
.head 5 +  Function: PrintTicketF
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  String: sFileName
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: sDpaDocOpen
.head 7 -  String: sDpaDocClose
.head 7 -  String: sTicketsPath
.head 7 -  Number: nAcc
.head 7 -  String: sTemplateId
.head 7 -  Long String: sDoc
.head 7 -  : cCnc
.head 8 -  Class: cABSConnect
.head 7 -  : cCnc2
.head 8 -  Class: cABSConnect
.head 7 -  String: sDocName
.head 7 -  File Handle: hFile
.head 7 -  Number: nCount
.head 6 +  Actions
.head 7 -  Set sDpaDocOpen  = GetGlobalOption('DPA_DOCO')
.head 7 -  Set sDpaDocClose = GetGlobalOption('DPA_DOCC')
.head 7 +  If sDpaDocOpen = '' or sDpaDocClose = ''
.head 8 -  Call SalMessageBox('Не описані шаблони для друку повідомлень!', 'Увага!', MB_Ok | MB_IconExclamation)
.head 8 -  Return FALSE
.head 7 +  If not SalTblAnyRows(hWndForm, 0, 0)
.head 8 -  Return FALSE
.head 7 -  ! Путь к квитанциям
.head 7 -  Set sTicketsPath = GetPrnDir() || '\\DPA_' || sFileName
.head 7 -  Call SalFileCreateDirectory(sTicketsPath)
.head 7 -  Set nCount = 0
.head 7 -  Set nRow = TBL_MinRow
.head 7 +  While SalTblFindNextRow(hWndForm, nRow, 0, 0)
.head 8 -  Call SalTblSetContext(hWndForm, nRow)
.head 8 -  Call SqlPrepareAndExecute(hSql(), 
"select acc into :nAcc from accounts where nls = :NLS and kv = :KV")
.head 8 +  If SqlFetchNext(hSql(), nFetchRes)
.head 9 -  Set sTemplateId = IifS(TYP_OPER='1' or TYP_OPER='6', sDpaDocOpen, sDpaDocClose)
.head 9 -  Call XConnectGetParams(cCnc)
.head 9 +  If cCnc.Connect() and cCnc2.Clone(cCnc, TRUE)
.head 10 -  Set sDoc = cdoc_CreateDocFromTemplate(cCnc.hSql(), cCnc2.hSql(), sTemplateId, nAcc, 0)
.head 10 +  If sDoc
.head 11 -  Set sDocName = GetTempFileName()
.head 11 +  If SalFileOpen(hFile, sDocName, OF_Write | OF_Create | OF_Text)
.head 12 -  Call SalFileWrite(hFile, sDoc, SalStrLength(sDoc))
.head 12 -  Call SalFileClose(hFile)
.head 12 -  Call SalFileCopy(sDocName, sTicketsPath || '\\' || NLS || '_' || KV || '.rtf', TRUE)
.head 12 -  Set nCount = nCount + 1
.head 10 -  Call cCnc.Disconnect()
.head 10 -  Call cCnc2.Disconnect()
.head 7 +  If nCount
.head 8 -  Call SalMessageBox('Надруковано ' || Str(nCount) || ' повідомлень в ' || sTicketsPath, 'Повідомлення', MB_Ok | MB_IconAsterisk)
.head 7 -  Return TRUE
.head 4 +  Window Variables
.head 5 -  String: sNbsList1
.head 5 -  String: sNbsList2
.head 5 -  String: sNbsList3
.head 5 -  String: sNbsList4
.head 5 -  String: sNbsList5
.head 5 -  String: sNbsList6
.head 5 -  Boolean: bSortOrd
.head 5 -  String: sOkpo
.head 5 -  Number: nTgr
.head 5 -  String: sNmk
.head 5 -  String: sAdr
.head 5 -  String: sCreg
.head 5 -  String: sCdst
.head 5 -  Number: nRez
.head 5 -  Number: nRezid
.head 5 -  String: sPassp
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalTblSetTableFlags(hWndForm, TBL_Flag_SelectableCols, TRUE)
.head 5 +  On UM_Populate
.head 6 -  Call SalSendMsg(tblFTax, UM_ObjActivate, 0, 0)
.head 6 -  Call SalWaitCursor(TRUE)
.head 6 -  Call SalTblReset(hWndForm)
.head 6 -  Call SalTblDefineSplitWindow(hWndForm, 0, FALSE)
.head 6 -  Set ss = ''
.head 6 +  Select Case nTip
.head 7 +  Case 1	! @F
.head 8 -  Set ss =
"select ROW_ID, ID_A, RT, OT, ODAT, NLS, KV, C_AG, NMK, ADR, C_REG, C_DST, KOD_REG, REC_O
   into :tblFTax.ROWID, :tblFTax.OKPO, :tblFTax.TYP_REES, :tblFTax.TYP_OPER,
        :tblFTax.DAT_OPER, :tblFTax.NLS, 
        :tblFTax.KV, :tblFTax.REZ, :tblFTax.NMS, :tblFTax.ADR,
        :tblFTax.OBL, :tblFTax.RAY, :tblFTax.SIMVOL, :tblFTax.NUMS
   from ( select " || IifS(sBANKTYPE='AVAL', "", "/*+ index(a) */ ") || "
                 ree_tmp.rowid as ROW_ID, ree_tmp.id_a, ree_tmp.rt,
                 ree_tmp.ot, ree_tmp.odat, ree_tmp.nls, 
                 ree_tmp.kv, ree_tmp.c_ag, ree_tmp.nmk, " ||
                 IifS(sBANKTYPE='AVAL' or sBANKTYPE='KAZNA', "ree_tmp.adr", "c.adr") || ",
                 ree_tmp.c_reg, ree_tmp.c_dst, s.kod_reg, ree_tmp.rec_o
            from ree_tmp, dpa_nbs d, accounts a, spr_obl s " ||
                 IifS(sBANKTYPE='AVAL' or sBANKTYPE='KAZNA', "", ", customer c") || "
           where ree_tmp.odat <= :sDat1
             and a.nls = ree_tmp.nls and a.kv = ree_tmp.kv
             and substr(ree_tmp.nls,1,4) = d.nbs
             and ree_tmp.fn_o is null
             and ree_tmp.c_reg = s.c_reg
             and ree_tmp.ot = d.taxotype and d.type='DPA' " ||
             IifS(sFltrWhereClause='', "", " and " || sFltrWhereClause) ||
             IifS(sBANKTYPE='AVAL' or sBANKTYPE='KAZNA', "", " and a.rnk=c.rnk") ||
             IifS(sFilterTip[nTip]!='', " and ("||sFilterTip[nTip]||")", "") || "
           union all
          select /*+ index(a) */ ree_tmp.rowid as ROW_ID, ree_tmp.id_a, ree_tmp.rt,
                 ree_tmp.ot, ree_tmp.odat, ree_tmp.nls, 
                 ree_tmp.kv, ree_tmp.c_ag, ree_tmp.nmk, " ||
                 IifS(sBANKTYPE='AVAL' or sBANKTYPE='KAZNA', "ree_tmp.adr", "c.adr") || ",
                 ree_tmp.c_reg, ree_tmp.c_dst, s.kod_reg, ree_tmp.rec_o
            from ree_tmp, dpa_nbs d, accounts a, spr_obl s " ||
                 IifS(sBANKTYPE='AVAL' or sBANKTYPE='KAZNA', "", ", customer c") || "
           where ree_tmp.odat <= :sDat1
             and a.NLSALT = ree_tmp.nls and a.DAT_ALT is not null
             and a.kv = ree_tmp.kv
             and substr(ree_tmp.nls,1,4) = d.nbs
             and ree_tmp.fn_o is null
             and ree_tmp.c_reg = s.c_reg
             and ree_tmp.ot = d.taxotype and d.type='DPA' " ||
             IifS(sFltrWhereClause='', "", " and " || sFltrWhereClause) ||
             IifS(sBANKTYPE='AVAL' or sBANKTYPE='KAZNA', "", " and a.rnk=c.rnk") ||
             IifS(sFilterTip[nTip]!='', " and ("||sFilterTip[nTip]||")", "") || "
        ) order by KOD_REG"
.head 8 -  Break
.head 7 +  Case 2	! @B
.head 8 -  Break
.head 8 -  Set ss =
"SELECT t.KOD_DPI,
        r.mfoa,r.nlsa,r.mfob,r.nlsb,r.dk,r.s,r.vob,r.nd,r.kv,r.datd,
        NVL(ARC.datp, r.datp),r.nam_a,r.nam_b,r.nazn,
        ARC.d_rec,ARC.naznk,ARC.nazns,NVL(r.id_a, ARC.id_a),ARC.ref,
        NVL(ARC.dat_a, r.vdat), ARC.dat_b
    /*   r.vdat, s.kekd kekd1, s2.kekd kekd2  */
 FROM OPER r,accounts a,specparam s,terrdpi t, ARC_RRP ARC,
      accounts a2, specparam s2, terrdpi t2
 WHERE trunc(vdat)=:sDat1  and t.ktk=s.ktk
   and DECODE(r.mfob,"||AMFO||",r.nlsb,r.nlsa)=a.nls and r.kv=a.kv
   and a.acc=s.acc and a.tip='DKZ'
   and t2.ktk (+) = s2.ktk
   and DECODE(r.mfob,"||AMFO||",r.nlsa,r.nlsb)=a2.nls (+) and r.kv=a2.kv (+)
   and a2.acc=s2.acc (+)
   and (r.tt = 'K2C' or r.tt = 'K2D' or r.tt not like 'K2%')
   AND R.REF = ARC.REF (+)" ||
       IifS(sFilterTip[nTip]!='', " AND ("||sFilterTip[nTip]||")", "") || "
 ORDER BY s.ktk
 INTO :tblFTax.KTK,
      :tblFTax.MFOA,:tblFTax.NLSA,:tblFTax.MFOB,:tblFTax.NLSB,
      :tblFTax.DK,:tblFTax.S,:tblFTax.VOB,:tblFTax.ND,:tblFTax.KV,
      :tblFTax.DATD,:tblFTax.DATP,:tblFTax.NAMA,:tblFTax.NAMB,
      :tblFTax.NAZN,:tblFTax.DREC,:tblFTax.NAZNK,:tblFTax.NAZNS,
      :tblFTax.OKPO,:tblFTax.REF_A,:tblFTax.DAT_A,:tblFTax.DAT_B "
.head 7 +  Case 3	! @K
.head 8 +  If sBANKTYPE = 'AVAL'
.head 9 -  Set ss =
"select c.bankcode, c.bankname, c.ot, c.odat, c.nls, c.kv,
        c.c_ag, c.country, c.dpa_code, c.edrpou
   into :tblFTax.BIC, :tblFTax.NMS, :tblFTax.TYP_OPER,
        :tblFTax.DAT_OPER, :tblFTax.NLS, :tblFTax.KV,
        :tblFTax.REZ, :tblFTax.COUNTRY, :tblFTax.OBL, :tblFTax.OKPO
   from ree_dpa_k c
  order by c.dpa_code, c.nls"
.head 8 +  Else
.head 9 -  Set ss =
"select a.id, substr(a.mfo,1,40), a.nmk, a.ot,
	a.odat, nvl(f.nls,a.nls), a.kv, a.c_ag,
        a.country, a.c_reg, a.okpo
   into :tblFTax.ROWID, :tblFTax.BIC, :tblFTax.NMS, :tblFTax.TYP_OPER,
        :tblFTax.DAT_OPER, :tblFTax.NLS, :tblFTax.KV, :tblFTax.REZ,
        :tblFTax.COUNTRY, :tblFTax.OBL, :tblFTax.OKPO
   from ( select c.rowid id, b.bic mfo, c.nmk, c.ot,
                 c.odat, c.nls, c.kv, c.c_ag,
                 decode(c.c_ag,1,'',cu.country) country, c1.c_reg, c1.okpo, s.kod_reg
            from ree_tmp c, dpa_nbs d, accounts a, spr_obl s, custbank b, customer cu, customer c1
           where c.odat <= :sDat1
             and c.fn_o is null 
             and substr(c.nls,1,4) = d.nbs and d.type = 'DPK' and c.ot = d.taxotype
             and a.nls = c.nls and a.kv = c.kv
             and c.c_reg = s.c_reg
             and a.rnk = cu.rnk
             and cu.rnk = b.rnk
             and c1.rnk = (select trim(val) from params where par='OUR_RNK') ) a, forex_alien f
  where f.bic(+)=a.mfo and f.kv(+)=a.kv
  order by a.kod_reg"
.head 8 -  Break
.head 7 +  Case 4	! @P
.head 8 -  Set ss = 
"select /*+ index(a) */ ree_tmp.rowid, ree_tmp.id_a, ree_tmp.rt,
        ree_tmp.ot, ree_tmp.odat, ree_tmp.nls, 
        ree_tmp.c_ag, ree_tmp.nmk, " ||
        IifS(sBANKTYPE='AVAL' or sBANKTYPE='KAZNA', "ree_tmp.adr", "c.adr") || ",
        ree_tmp.c_reg, ree_tmp.c_dst
   into :tblFTax.ROWID, :tblFTax.OKPO, :tblFTax.TYP_REES,
        :tblFTax.TYP_OPER, :tblFTax.DAT_OPER, :tblFTax.NLS,
        :tblFTax.REZ, :tblFTax.NMS, :tblFTax.ADR,
        :tblFTax.OBL, :tblFTax.RAY
   from ree_tmp, dpa_nbs d, accounts a " ||
        IifS(sBANKTYPE='AVAL' or sBANKTYPE='KAZNA', "", ", customer c") || "
  where ree_tmp.odat <= :sDat1
    and a.nls = ree_tmp.nls and a.kv = 980
    and substr(ree_tmp.nls,1,4) = d.nbs
    and ree_tmp.fn_o is null
    and ree_tmp.ot = d.taxotype and d.type='DPP' " ||
        IifS(sBANKTYPE='AVAL' or sBANKTYPE='KAZNA', "", " and a.rnk=c.rnk")
.head 8 -  Break
.head 7 +  Case 5	! CV
.head 8 -  Set ss =
"select s.nls,
        decode(r.dk,1,r.mfoa,r.mfob) mfo_d,
        decode(r.dk,1,r.nlsa,r.nlsb) nls_d,
        decode(r.dk,1,r.mfob,r.mfoa) mfo_k,
        decode(r.dk,1,r.nlsb,r.nlsa) nls_k,
        p.dk, r.s, r.vob, r.nd,
        r.kv, r.datd, nvl(arc.datp,r.datp), 
        decode(r.dk,1,r.nam_a,r.nam_b),
        decode(r.dk,1,r.nam_b,r.nam_a), r.nazn,
        arc.d_rec, arc.naznk, arc.nazns, 
        decode(r.dk,1,nvl(r.id_a,arc.id_a),nvl(r.id_b,arc.id_b)) id_d,
        decode(r.dk,1,nvl(r.id_b,arc.id_b),nvl(r.id_a,arc.id_a)) id_k,
        nvl(arc.ref_a,r.ref), nvl(ARC.dat_a, r.vdat), arc.dat_b
   from opldok p, accounts s, oper r, arc_rrp arc
  where p.fdat = :sDat1 and p.sos = 5
    and p.acc = s.acc and substr(s.nbs,1,3) = '264'
    and p.ref = r.ref and r.dk < 2
    and r.ref = arc.ref (+)
    and arc.dat_b(+) >= bankdate-10 and arc.dat_b(+) <= bankdate+1
  order by s.nls
   into :tblFTax.NLS,:tblFTax.MFOA,:tblFTax.NLSA,:tblFTax.MFOB,:tblFTax.NLSB,
        :tblFTax.DK,:tblFTax.S,:tblFTax.VOB,:tblFTax.ND,:tblFTax.KV_CV,
        :tblFTax.DATD,:tblFTax.DATP,:tblFTax.NAMA,:tblFTax.NAMB,
        :tblFTax.NAZN,:tblFTax.DREC,:tblFTax.NAZNK,:tblFTax.NAZNS,
        :tblFTax.OKPOA,:tblFTax.OKPOB,:tblFTax.REF_A,
        :tblFTax.DAT_A,:tblFTax.DAT_B "
.head 8 -  Break
.head 7 +  Case 6	! CA
.head 8 -  Set ss =
"select mfo, nb, nls, daos, vid, tvo, name_blok,
        fio_blok, fio_isp, inf_isp, addr, okpo
   from v_cvk_ca
  where daos = :sDat1
   into :tblFTax.MFO, :tblFTax.NB, :tblFTax.NLS, :tblFTax.DAOS, :tblFTax.VID,
        :tblFTax.NUM_TVO, :tblFTax.NAME_BLOK, :tblFTax.FIO_BLOK, :tblFTax.FIO_ISP,
        :tblFTax.INF_ISP, :tblFTax.CA_BANK_ADDRESS, :tblFTax.CA_CUST_OKPO "
.head 8 -  Break
.head 7 +  Default
.head 8 -  Break
.head 6 +  If ss
.head 7 -  Call SalTblPopulate(tblFTax, hSql(), T(ss) , TBL_FillAll)
.head 6 -  Call VisTblAutoSizeColumn(hWndForm, hWndNULL)
.head 6 -  Set sFltrWhereClause = STRING_Null
.head 6 -  Call SalWaitCursor(FALSE)
.head 5 +  On SAM_FetchRowDone
.head 6 +  If nTip = 1
.head 7 -  Set tblFTax.MFO = AMFO
.head 7 +  If tblFTax.TYP_REES = 1 and ( tblFTax.OKPO = '' OR SalIsNull( tblFTax.OKPO ))
.head 8 -  Set tblFTax.OKPO = '99999999'
.head 7 +  Else If tblFTax.TYP_REES = 2 and ( tblFTax.OKPO = '' OR SalIsNull( tblFTax.OKPO ))
.head 8 -  Set tblFTax.OKPO = '9999999999'
.head 7 +  Else If tblFTax.TYP_REES = 3 and ( tblFTax.OKPO = '' OR SalIsNull( tblFTax.OKPO ))
.head 8 -  Set tblFTax.OKPO = '999999999'
.head 7 +  Else If tblFTax.TYP_REES = 0 and ( tblFTax.OKPO = '' OR SalIsNull( tblFTax.OKPO ))
.head 8 -  Set tblFTax.OKPO = '0'
.head 7 +  ! If tblFTax.NLS_VID = 5
.head 8 -  Set tblFTax.OKPO = '0'
.head 6 +  If nTip = 2
.head 7 -  Set tblFTax.KTK = Right('000'||SalStrTrimX( tblFTax.KTK ),3)
.head 6 +  If nTip = 4
.head 7 -  Set MFO = AMFO
.head 7 -  Set BANK_OKPO = sBankOkpo
.head 7 -  Set NB = sBankName
.head 6 -  ! раскрасска счетов для @F  nTip=2 (для тех, которые сформированы уже)
.head 6 +  If nTip = 1 and cbUseFormed
.head 7 -  ! Счета не приняты по IF
.head 7 +  If SalStrToNumber(tblFTax.ERR)!=0 and tblFTax.ERR!= STRING_Null
.head 8 -  Call XSalTblSetRowBackColor(hWndForm, lParam, getAttentionColor(COLOR_STOP))
.head 5 +  On UM_Insert
.head 6 -  Set nRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 6 -  Call SalTblSetContext(hWndForm, nRow)
.head 6 -  Call SalTblSetFocusCell(hWndForm, nRow,
     GetFirstEditableColumn(hWndForm), 0, 1)
.head 6 -  ! @P
.head 6 +  If nTip = 4
.head 7 -  Set MFO = AMFO
.head 7 -  Set BANK_OKPO = sBankOkpo
.head 7 -  Set NB = sBankName
.head 7 -  Set DAT_OPER = dfDat
.head 7 -  Call VisTblAutoSizeColumn(hWndForm, hWndNULL)
.head 7 +  If nRow = 0
.head 8 -  Call SalTblSetColumnWidth(OKPO, 1.6)
.head 8 -  Call SalTblSetColumnWidth(NLS, 1.8)
.head 8 -  Call SalTblSetColumnWidth(NMS, 3)
.head 8 -  Call SalTblSetColumnWidth(ADR, 3)
.head 5 +  On SAM_User
.head 6 +  If SalTblAnyRows(hWndForm, ROW_Selected, 0)
.head 7 +  If FunNSIGetFiltered('customer', 'nmk', 'date_off is null', sPK, sSem)
.head 8 -  Call SqlPrepareAndExecute(hSql(),
"select okpo, tgr, nvl(nmkk,substr(nmk,1,38)), adr, c_reg, c_dst, codcagent
   into :sOkpo, :nTgr, :sNmk, :sAdr, :sCreg, :sCdst, :nRez
   from customer
  where rnk = :sPK")
.head 8 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 8 +  Call SqlPrepareAndExecute(hSql(), "select rezid into :nRezid from codcagent where codcagent=:nRez")
.head 9 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 8 +  If sOkpo = '99999' or sOkpo = '000000000'
.head 9 -  Call SqlPrepareAndExecute(hSql(),
"select substr(trim(ser) || trim(numdoc), 1, 14) into :sPassp
   from person
  where rnk = :sPK and passp = 1")
.head 9 +  If SqlFetchNext(hSql(), nFetchRes)
.head 10 -  Set sOkpo = sPassp
.head 10 -  Set nTgr  = 4
.head 8 -  Set OKPO = sOkpo
.head 8 -  Set TYP_REES = nTgr
.head 8 -  Set REZ = nRezid
.head 8 -  Set NMS = sNmk
.head 8 -  Set ADR = sAdr
.head 8 -  Set OBL = sCreg
.head 8 -  Set RAY = sCdst
.head 7 -  Call VisTblAutoSizeColumn(hWndForm, hWndNULL)
.head 7 -  Call SalTblSetColumnWidth(NLS, 1.8)
.head 5 +  On UM_ObjActivate
.head 6 -  Call SalSendMsgToChildren(hWndForm, UM_ObjActivate, wParam, lParam)
.head 5 +  On SAM_ColumnSelectClick
.head 6 -  Call SalTblSetColumnFlags(SalNumberToWindowHandle(wParam), COL_Selected, FALSE)
.head 6 -  Set bSortOrd = not bSortOrd
.head 6 -  Call SalTblSortRows(hWndForm, SalTblQueryColumnID(SalNumberToWindowHandle(wParam)), bSortOrd)
.head 2 +  Functions
.head 3 +  Function: SetButton
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call SalDisableWindow(pbInsert)
.head 5 -  Call SalDisableWindow(pbDelete)
.head 5 -  Call SalDisableWindow(pbHardDelete)
.head 5 -  Call SalDisableWindow(pbFilter)
.head 5 -  Call SalDisableWindow(pbSearchClient)
.head 5 -  Call SalDisableWindow(pbInROutS)
.head 5 +  Select Case nTip
.head 6 +  Case 1	! @F - открываем кнопки "Добавить", "Удалить", "Удалить из БД", "Принять R, сформировать S"
.head 7 -  Call SalEnableWindow(pbInsert)
.head 7 -  Call SalEnableWindow(pbDelete)
.head 7 -  Call SalEnableWindow(pbHardDelete)
.head 7 -  Call SalEnableWindow(pbFilter)
.head 7 -  Call SalEnableWindow(pbInROutS)
.head 7 -  Call SalSetMaxDataLength(tblFTax.NMS, 38)
.head 7 -  Set pbInROutS.strTip = 'Прийняти @R, сформувати @S'
.head 7 -  Break
.head 6 +  Case 2	! @B
.head 7 -  Break
.head 6 +  Case 3	! @K - открываем кнопки "Добавить", "Удалить"
.head 7 -  Call SalEnableWindow(pbInsert)
.head 7 -  Call SalEnableWindow(pbDelete)
.head 7 -  Call SalSetMaxDataLength(tblFTax.NMS, 70)
.head 7 -  Break
.head 6 +  Case 4	! @P - открываем кнопки "Добавить", "Удалить", "Принять R, сформировать S"
.head 7 -  Call SalEnableWindow(pbInsert)
.head 7 -  Call SalEnableWindow(pbDelete)
.head 7 -  Call SalEnableWindow(pbSearchClient)
.head 7 -  Call SalEnableWindow(pbInROutS)
.head 7 -  Call SalSetMaxDataLength(tblFTax.NMS, 38)
.head 7 -  Set pbInROutS.strTip = 'Прийняти @D, сформувати @T'
.head 7 -  Break
.head 6 +  Case 5	! CV - открываем кнопки "Удалить"
.head 7 -  Call SalEnableWindow(pbDelete)
.head 7 -  Break
.head 6 +  Case 6	! CA - открываем кнопки "Удалить"
.head 7 -  Call SalEnableWindow(pbDelete)
.head 7 -  Break
.head 6 +  Default
.head 7 -  Break
.head 5 -  Return TRUE
.head 3 -  !
.head 3 +  Function: CreateFileXml
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sFileType
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sPathExport
.head 5 -  String: sFileName
.head 5 -  String: sFullName
.head 4 +  Actions
.head 5 -  Call SaveInfoToLog(DPA || "Формирование файла " || sFileType)
.head 5 -  ! каталог файлов @F
.head 5 -  Set sPathExport = Rep_PathNI
.head 5 +  If sPathExport = ''
.head 6 -  Call SalMessageBox("Не описано каталог файлів @F", "Увага!", MB_IconStop | MB_Ok)
.head 6 -  Call SaveInfoToLog(DPA || "Не описано каталог файлів @F")
.head 6 -  Return FALSE
.head 5 +  If not VisDosExist(sPathExport)
.head 6 -  Call SalMessageBox("Вказано неіснуючий каталог файлів @F: " || sPathExport, "Увага!", MB_IconStop | MB_Ok)
.head 6 -  Call SaveInfoToLog(DPA || "Вказано неіснуючий каталог файлів @F: " || sPathExport)
.head 6 -  Return FALSE
.head 5 -  !
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  Call SaveInfoToLog(DPA || "Вставка счетов во временную таблицу")
.head 5 -  ! Вставка во временную таблицу
.head 5 -  Set nRow = TBL_MinRow
.head 5 +  While SalTblFindNextRow(tblFTax, nRow, 0, 0)
.head 6 -  Call SalTblSetContext(tblFTax, nRow)
.head 6 +  If not SqlPrepareAndExecute(hSql(), 
"insert into dpa_acc (mfo, okpo, rt, ot, odat, nls, kv, c_ag, nmk, adr, c_reg, c_dst, bic, country)
 values (:tblFTax.MFO, :tblFTax.OKPO, :tblFTax.TYP_REES, :tblFTax.TYP_OPER,
         :tblFTax.DAT_OPER, :tblFTax.NLS, :tblFTax.KV, :tblFTax.REZ, :tblFTax.NMS,
         :tblFTax.ADR, :tblFTax.OBL, :tblFTax.RAY, :tblFTax.BIC, :tblFTax.COUNTRY)")
.head 7 -  Call SalWaitCursor(FALSE)
.head 7 -  Return FALSE
.head 5 -  Call SaveInfoToLog(DPA || "Счета добавлены во временную таблицу")
.head 5 -  ! формируем данные для файла
.head 5 +  If not SqlPLSQLCommand(hSql(), "bars_dpa.form_file(sFileType,  sFileName)")
.head 6 -  Call SqlRollback(hSql())
.head 6 -  Call SalWaitCursor(FALSE)
.head 6 -  Return FALSE
.head 5 -  Call SqlCommit(hSql())
.head 5 -  Call SaveInfoToLog(DPA || "Имя файла=>" || sFileName)
.head 5 +  If sFileName
.head 6 -  Set sFullName = sPathExport || '\\' || sFileName
.head 6 +  If not PutClobToFile(hSql(), sFullName, 'DPA_LOB', 'ID', 'FILE_DATA', 1, STRING_Null, STRING_Null)
.head 7 -  Call SalMessageBox('Помилка формування файлу', 'Помилка', MB_IconStop | MB_Ok)
.head 7 -  Return FALSE 
.head 6 -  Call SalMessageBox('Сформовано файл ' || sFullName, 'Інформація', MB_IconAsterisk | MB_Ok)
.head 6 -  Call SaveInfoToLog(DPA || 'Сформовано файл ' || sFullName)
.head 6 -  ! Копирование файла в архив
.head 6 -  Call FunBackUpFile(sFullName, Rep_Backup, FALSE)
.head 5 -  Call SalWaitCursor(FALSE)
.head 5 -  Return TRUE
.head 3 +  ! Function: FunCreateRegistryFileF
.head 4 -  Description: Создать файл реестра счетов
(для НИ или для НБУ)
.head 4 +  Returns 
.head 5 -  Boolean: 
.head 4 +  Parameters 
.head 5 -  String: strFileName
.head 5 -  Boolean: fUseOldFileName
.head 4 -  Static Variables 
.head 4 +  Local variables 
.head 5 -  File Handle: hCreateFile
.head 5 -  Number: nLengthHead
.head 5 -  Number: nLengthInf
.head 5 -  String: strLine
.head 5 -  !
.head 5 -  Date/Time: dtCDat
.head 5 -  String: szPureFileName
.head 5 -  Number: nNline
.head 5 -  !
.head 5 -  String: sSimvolObl
.head 5 -  Number: nNumF
.head 4 +  Actions 
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  Set nLengthInf = 180
.head 5 -  Set nNline = 0
.head 5 -  Set sSimvolObl = ''
.head 5 -  Set nNumF = nFileNum - 1
.head 5 -  Set nRow = TBL_MinRow ! Сохранение информационных строк
.head 5 -  Call SalTblSortRows(hWndForm, SalTblQueryColumnID(tblFTax.SIMVOL), TBL_SortIncreasing)
.head 5 +  Loop 
.head 6 +  If SalTblFindNextRow(tblFTax, nRow, 0, 0)
.head 7 -  Call SalTblSetContext(tblFTax, nRow)
.head 7 +  If fUseOldFileName OR not nFNAL
.head 8 -  Set tblFTax.SIMVOL = GetGlobalOption('AREACODE')
.head 7 +  If tblFTax.SIMVOL != ''
.head 8 +  If sSimvolObl != tblFTax.SIMVOL
.head 9 +  If sSimvolObl != ''
.head 10 -  Call SalFileSeek( hCreateFile, 102+22, FILE_SeekBegin )
.head 10 -  Call SalFileWrite( hCreateFile, PadL(Str(nNline),6), 6 )
.head 10 -  Call SalFileClose( hCreateFile )
.head 10 -  !
.head 10 -  Call FunBackUpFile( strFileName, Rep_Backup, FALSE )
.head 10 -  Set Rep_PathDst = Rep_PathNI || '\\' || szPureFileName
.head 10 -  !
.head 10 +  If NOT SqlPrepareAndExecute( hSql(), "UPDATE ZAG_F SET n=:nNline, otm=null, datk=null,err=null WHERE fn=:szPureFileName" )
.head 11 -  Call SqlRollback(hSql())
.head 11 -  Return FALSE
.head 10 -  !
.head 10 -  Set nNline = 0
.head 9 -  Set nNumF = nNumF + 1
.head 9 -  Set strFileName = SalStrLeftX(strFileName, SalStrLength(strFileName)- 10) ||
    tblFTax.SIMVOL ||
    SalStrMidX(strFileName, SalStrLength(strFileName)- 9, 6) || Right('000' || Str(nNumF), 3)
.head 9 +  If NOT SalFileOpen(hCreateFile, strFileName, OF_Create | OF_Write | OF_Text)
.head 10 -  Call SalMessageBox( 'Неможливо створити файл '||strFileName, 'Увага!', MB_IconAsterisk )
.head 10 -  Break 
.head 9 -  Set szPureFileName = Right(strFileName, 12)
.head 9 +  If NOT fUseOldFileName
.head 10 -  Set dtCDat = f_truncate_date_2minute(SalDateCurrent())
.head 10 +  If NOT SqlPrepareAndExecute(hSql(), "INSERT INTO ZAG_F (fn, dat) VALUES (:szPureFileName, :dtCDat)" )
.head 11 -  Call SqlRollback(hSql())
.head 11 -  Return FALSE
.head 9 +  Else 
.head 10 -  Set dtCDat = f_truncate_date_2minute(dtChoosen)
.head 10 +  If NOT SqlPrepareAndExecute(hSql(), "DELETE FROM LINES_F WHERE fn=:szPureFileName and dat=:dtCDat")
.head 11 -  Call SqlRollback(hSql())
.head 11 -  Return FALSE
.head 9 -  Set sSimvolObl = tblFTax.SIMVOL
.head 9 -  ! Служебная строка
.head 9 -  Call SalFileWrite(hCreateFile, SalStrRepeatX(' ', 100) || PutCrLf(), 102)
.head 9 -  ! Заголовок
.head 9 -  Set nLengthHead = 196
.head 9 -  Set strLine = Right(strFileName,12) ||
    SalFmtFormatDateTime(dtCDat, 'yyMMdd') ||
    SalStrRightX('0' || SalFmtFormatDateTime(dtCDat, 'hhhhmm'),4) ||
    PadL(Str(nNline),6)
.head 9 -  Set strLine = strLine || SalStrRepeatX(' ', 166) || PutCrLf()
.head 9 -  Call SalFileWrite(hCreateFile, strLine, nLengthHead)
.head 9 -  !
.head 8 -  Set strLine = ''
.head 8 -  Set nNline = nNline + 1
.head 8 -  Set strLine = PadL(tblFTax.MFO,9) || PadL(tblFTax.OKPO,14) ||
    PadL(SalNumberToStrX(tblFTax.TYP_REES,0),1) || PadL(tblFTax.TYP_OPER,1) ||
    PadL(SalFmtFormatDateTime(tblFTax.DAT_OPER,'yyMMdd'),6) || PadL(tblFTax.NLS,14) ||
    PadL(tblFTax.PR_NLS,1) || Right('0000' || tblFTax.KV,3) ||
    PadL(SalNumberToStrX(tblFTax.REZ,0),1) || PadR(tblFTax.NMS,38) ||
    PadR(tblFTax.ADR,80) ||
    PadL(tblFTax.OBL,2) || PadL(tblFTax.RAY,2) || PadL(Str(nNline ),6)
.head 8 -  Set strLine = strLine || PutCrLf()
.head 8 -  Call SalFileWrite( hCreateFile, strLine, nLengthInf )
.head 8 -  ! регистрируем детальные строки файла
.head 8 -  Call SqlSetLongBindDatatype( 17, 23 )
.head 8 +  If NOT SqlPrepareAndExecute( hSql(), "
  INSERT INTO LINES_F(fn, dat, n, mfo, okpo, rtype, otype, odate, nls, nlsm, kv, resid, nmkk, adr, c_reg, ntax)
  VALUES (:szPureFileName, :dtCDat, :nNline, :tblFTax.MFO, :tblFTax.OKPO, :tblFTax.TYP_REES, :tblFTax.TYP_OPER,
          :tblFTax.DAT_OPER, :tblFTax.NLS, :tblFTax.PR_NLS, :tblFTax.KV, :tblFTax.REZ, :tblFTax.NMS, :tblFTax.ADR,
          :tblFTax.OBL, :tblFTax.RAY)" )
.head 9 -  Call SqlRollback(hSql())
.head 9 -  Return FALSE
.head 8 -  ! Делаем отметку в хранилище об отборе...
.head 8 +  If NOT fUseOldFileName
.head 9 +  If NOT SqlPrepareAndExecute( hSql(),
"UPDATE REE_TMP SET fn_o=:szPureFileName, dat_o=:dtCDat, rec_o=:nNline WHERE rowid=:tblFTax.ROWID" )
.head 10 -  Call SqlRollback(hSql())
.head 10 -  Return FALSE
.head 8 -  !
.head 7 +  Else 
.head 8 -  Call SalMessageBox( 'Невідомий код області!
Рахунок ' || tblFTax.NLS || '/' || tblFTax.KV, 'Увага!', MB_IconAsterisk )
.head 6 +  Else 
.head 7 -  Break 
.head 5 +  If sSimvolObl != '' AND SalFileOpen(hCreateFile, strFileName, OF_Exist)
.head 6 -  Call SalFileSeek(hCreateFile, 102+22, FILE_SeekBegin)
.head 6 -  Call SalFileWrite(hCreateFile, PadL(Str(nNline),6), 6)
.head 6 -  Call SalFileClose(hCreateFile)
.head 6 -  !
.head 6 -  Call FunBackUpFile(strFileName, Rep_Backup, FALSE)
.head 6 -  Set Rep_PathDst = Rep_PathNI || '\\' || szPureFileName
.head 6 -  !
.head 6 +  If NOT SqlPrepareAndExecute(hSql(),"UPDATE ZAG_F SET n=:nNline, otm=null, datk=null,err=null WHERE fn=:szPureFileName")
.head 7 -  Call SqlRollback(hSql())
.head 7 -  Return FALSE
.head 6 -  !
.head 6 -  Call MessageInfoEx('Файл ' || Rep_PathDst || ' сформовано.')
.head 6 -  Call SqlCommitEx( hSql(), 'Файл ' || Rep_PathDst || ' зарегистрирован.' )
.head 5 -  !
.head 5 -  Set nFileNum = nNumF
.head 5 -  Call SalWaitCursor(FALSE)
.head 5 -  Return TRUE
.head 3 +  ! Function: FunCreateRegistryFileK
.head 4 -  Description: Создать файл реестра счетов
(@K для НИ)
.head 4 +  Returns 
.head 5 -  Boolean: 
.head 4 +  Parameters 
.head 5 -  String: strFileName
.head 5 -  Boolean: bUseOldFileName
.head 4 -  Static Variables 
.head 4 +  Local variables 
.head 5 -  File Handle: hFile
.head 5 -  String: sFileKName
.head 5 -  Date/Time: dFileKDat
.head 5 -  ! nNline - Количество строк
.head 5 -  Number: nNline
.head 5 -  ! nLength - длина инф. строки
.head 5 -  Number: nLength
.head 5 -  String: strLine
.head 4 +  Actions 
.head 5 +  Loop 
.head 6 +  If not SalTblAnyRows(tblFTax, 0, 0)
.head 7 -  Break 
.head 6 -  Call SalWaitCursor(TRUE)
.head 6 -  ! -- Создание файла
.head 6 +  If not SalFileOpen(hFile, strFileName, OF_Create | OF_Write | OF_Text)
.head 7 -  Call SalMessageBox('Неможливо створити файл ' || strFileName, 'Увага!', MB_IconAsterisk)
.head 7 -  Break 
.head 6 -  Set sFileKName = Right(strFileName, 12)
.head 6 +  If not bUseOldFileName
.head 7 -  Set dFileKDat = f_truncate_date_2minute(SalDateCurrent())
.head 7 +  If not SqlPrepareAndExecute(hSql(), "insert into zag_f(fn, dat) values(:sFileKName, :dFileKDat)")
.head 8 -  Call SqlRollback(hSql())
.head 8 -  Return FALSE
.head 6 +  Else 
.head 7 -  Set dFileKDat = f_truncate_date_2minute(dtChoosen)
.head 7 +  If NOT SqlPrepareAndExecute(hSql(), "delete from lines_k where fn=:sFileKName")
.head 8 -  Call SqlRollback(hSql())
.head 8 -  Return FALSE
.head 6 -  ! -- Служебная строка
.head 6 -  Call SalFileWrite(hFile, SalStrRepeatX( ' ', 100 ) || PutCrLf(), 102)
.head 6 -  ! -- Заголовок
.head 6 -  Set nLength = 196
.head 6 -  Set strLine = Right(strFileName,12) ||
    SalFmtFormatDateTime(dFileKDat, 'yyMMdd')   ||
    SalStrRightX('0'||SalFmtFormatDateTime(dFileKDat, 'hhhhmm'),4) ||
    PadL(Str(nNline),6)
.head 6 -  Set strLine = strLine || SalStrRepeatX(' ', 166) || PutCrLf()
.head 6 -  Call SalFileWrite(hFile, strLine, nLength)
.head 6 -  ! -- Информационные строки
.head 6 -  Set nNline  = 0
.head 6 -  Set nLength = 182
.head 6 -  Set nRow = TBL_MinRow
.head 6 +  While SalTblFindNextRow(tblFTax, nRow, 0, 0)
.head 7 -  Call SalTblSetContext(tblFTax, nRow)
.head 7 -  Set nNline  = nNline + 1
.head 7 -  Set strLine = PadR(tblFTax.BIC,40) ||
    PadR(tblFTax.NMS,70) ||
    PadL(tblFTax.TYP_OPER,1) ||
    PadL(SalFmtFormatDateTime(tblFTax.DAT_OPER,'yyMMdd'),6) ||
    PadL(tblFTax.NLS,40) ||
    Right('000' || tblFTax.KV, 3) ||
    PadL(SalNumberToStrX(tblFTax.REZ,0),1) ||
    PadR(tblFTax.COUNTRY,3) ||
    PadL(tblFTax.OBL,2) ||
    PadL(tblFTax.OKPO,8) ||
    PadL(Str(nNline),6)
.head 7 -  Set strLine = strLine || PutCrLf()
.head 7 -  Call SalFileWrite(hFile, strLine, nLength)
.head 7 -  ! регистрируем детальные строки файла
.head 7 +  If not SqlPrepareAndExecute(hSql(),
"insert into lines_k(fn, dat, n, mfo, okpo, otype, odate,
    nls, kv, resid, nmkk, country, c_reg, c_dst, id_o)
 values (:sFileKName, :dFileKDat, :nNline,
    :tblFTax.BIC, :tblFTax.OKPO, :tblFTax.TYP_OPER, :tblFTax.DAT_OPER,
    :tblFTax.NLS, :tblFTax.KV, :tblFTax.REZ, :tblFTax.NMS, :tblFTax.COUNTRY,
    :tblFTax.OBL, null, :strOperId)")
.head 8 -  Call SqlRollback(hSql())
.head 8 -  Return FALSE
.head 7 -  ! Делаем отметку в хранилище об отборе...
.head 7 +  If not bUseOldFileName
.head 8 +  If sBANKTYPE = 'AVAL'
.head 9 +  If not SqlPrepareAndExecute( hSql(),
"update ree_dpa_k set fn_o=:sFileKName, dat_o=:dFileKDat, rec_o=:nNline
  where nls=:tblFTax.NLS and kv=:tblFTax.KV and ot=:tblFTax.TYP_OPER")
.head 10 -  Call SqlRollback(hSql())
.head 10 -  Return FALSE
.head 8 +  Else 
.head 9 +  If not SqlPrepareAndExecute( hSql(),
"update ree_tmp set fn_o=:sFileKName, dat_o=:dFileKDat, rec_o=:nNline
  where rowid=:tblFTax.ROWID" )
.head 10 -  Call SqlRollback(hSql())
.head 10 -  Return FALSE
.head 6 -  ! -- Закрываем файл
.head 6 -  Call SalFileSeek(hFile, 102+22, FILE_SeekBegin)
.head 6 -  Call SalFileWrite(hFile, PadL(Str(nNline),6), 6)
.head 6 -  Call SalFileClose(hFile)
.head 6 -  ! -- Копирование файла в архив
.head 6 -  Call FunBackUpFile(strFileName, Rep_Backup, FALSE)
.head 6 -  ! -- Сохранение информации о файле
.head 6 +  If NOT SqlPrepareAndExecute(hSql(),
"update zag_f set n=:nNline, otm=null, datk=null, err=null
   where fn=:sFileKName" )
.head 7 -  Call SqlRollback(hSql())
.head 7 -  Return FALSE
.head 6 -  !
.head 6 -  Call MessageInfoEx('Файл ' || Rep_PathNI || '\\' || sFileKName || ' сформовано.')
.head 6 -  Call SqlCommitEx( hSql(), 'Файл ' || Rep_PathNI || '\\' || sFileKName || ' зарегистрирован.' )
.head 6 -  Break 
.head 5 -  Call SalWaitCursor(FALSE)
.head 5 -  Return TRUE
.head 3 +  ! Function: FunCreateRegistryFileP
.head 4 -  Description: Создать файл реестра счетов
(для НИ или для НБУ)
.head 4 +  Returns 
.head 5 -  Boolean: 
.head 4 +  Parameters 
.head 5 -  String: strFileName
.head 5 -  Boolean: fNBUMode
.head 5 -  Boolean: fUseOldFileName
.head 4 -  Static Variables 
.head 4 +  Local variables 
.head 5 -  File Handle: hCreateFile
.head 5 -  Number: nLengthHead
.head 5 -  Number: nLengthInf
.head 5 -  String: strLine
.head 5 -  !
.head 5 -  Date/Time: dtCDat
.head 5 -  String: szPureFileName
.head 5 -  Number: nNline
.head 4 +  Actions 
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  Set nLengthHead = 196
.head 5 -  Set nLengthInf  = 294
.head 5 -  Set nNline = 0
.head 5 -  ! Создание файла
.head 5 -  Set strFileName = SalStrLeftX(strFileName, SalStrLength(strFileName)- 10) ||
    sAREACODE ||
    SalStrMidX(strFileName, SalStrLength(strFileName)- 9, 6) || Right('000' || Str(nFileNum), 3)
.head 5 +  If NOT SalFileOpen(hCreateFile, strFileName, OF_Create | OF_Write | OF_Text)
.head 6 -  Call SalMessageBox( 'Неможливо створити файл '||strFileName, 'Увага!', MB_IconAsterisk )
.head 6 -  Return FALSE 
.head 5 -  Set szPureFileName = Right(strFileName, 12)
.head 5 +  If NOT fUseOldFileName
.head 6 -  Set dtCDat = f_truncate_date_2minute(SalDateCurrent())
.head 6 +  If NOT SqlPrepareAndExecute(hSql(), "INSERT INTO ZAG_F (fn, dat) VALUES (:szPureFileName, :dtCDat)" )
.head 7 -  Call SqlRollback(hSql())
.head 7 -  Return FALSE
.head 5 +  Else 
.head 6 -  Set dtCDat = f_truncate_date_2minute(dtChoosen)
.head 6 +  If NOT SqlPrepareAndExecute(hSql(), "DELETE FROM LINES_P WHERE fn=:szPureFileName and dat=:dtCDat")
.head 7 -  Call SqlRollback(hSql())
.head 7 -  Return FALSE
.head 5 -  ! Служебная строка
.head 5 -  Call SalFileWrite(hCreateFile, SalStrRepeatX(' ', 100) || PutCrLf(), 102)
.head 5 -  ! Заголовок
.head 5 -  Set strLine = Right(strFileName,12) ||
    SalFmtFormatDateTime(dtCDat, 'yyMMdd') ||
    SalStrRightX('0' || SalFmtFormatDateTime(dtCDat, 'hhhhmm'),4) ||
    PadL(Str(nNline),6)
.head 5 -  Set strLine = strLine || SalStrRepeatX(' ', 166) || PutCrLf()
.head 5 -  Call SalFileWrite(hCreateFile, strLine, nLengthHead)
.head 5 -  ! Информационные строки
.head 5 -  Set nRow = TBL_MinRow
.head 5 +  While SalTblFindNextRow(tblFTax, nRow, 0, 0)
.head 6 -  Call SalTblSetContext(tblFTax, nRow)
.head 6 -  Set nNline  = nNline + 1
.head 6 -  Set strLine = PadL(tblFTax.MFO,9) || PadL(tblFTax.BANK_OKPO,8) ||
    PadR(tblFTax.NB, 70) || PadR(tblFTax.OKPO, 14) ||
    PadL(SalNumberToStrX(tblFTax.TYP_REES,0),1) || PadL(tblFTax.TYP_OPER,1) ||
    PadL(SalFmtFormatDateTime(tblFTax.DAT_OPER,'yyMMdd'),6) || PadL(tblFTax.NLS,40) ||
    PadL(SalNumberToStrX(tblFTax.REZ,0),1) || PadR(tblFTax.NMS,38) ||
    PadR(tblFTax.ADR,80) ||
    PadL(tblFTax.OBL,2) || PadL(tblFTax.RAY,2) || SalStrRepeatX(' ',14) || PadL(Str(nNline ),6)
.head 6 -  Set strLine = strLine || PutCrLf()
.head 6 -  Call SalFileWrite(hCreateFile, strLine, nLengthInf)
.head 6 -  ! регистрируем детальные строки файла
.head 6 +  If NOT SqlPrepareAndExecute(hSql(),
"INSERT INTO LINES_P(fn, dat, n, mfo, bank_okpo, nb, okpo, rtype, otype, odate, nls, resid, nmkk, adr, c_reg, ntax)
 VALUES (:szPureFileName, :dtCDat, :nNline, :tblFTax.MFO, :tblFTax.BANK_OKPO, :tblFTax.NB,
         :tblFTax.OKPO, :tblFTax.TYP_REES, :tblFTax.TYP_OPER, :tblFTax.DAT_OPER,
         :tblFTax.NLS, :tblFTax.REZ, :tblFTax.NMS, :tblFTax.ADR, :tblFTax.OBL, :tblFTax.RAY)" )
.head 7 -  Call SqlRollback(hSql())
.head 7 -  Return FALSE
.head 6 -  ! Делаем отметку в хранилище об отборе...
.head 6 +  If NOT fUseOldFileName
.head 7 +  If NOT SqlPrepareAndExecute( hSql(),
"UPDATE REE_TMP SET fn_o=:szPureFileName, dat_o=:dtCDat, rec_o=:nNline WHERE rowid=:tblFTax.ROWID" )
.head 8 -  Call SqlRollback(hSql())
.head 8 -  Return FALSE
.head 5 -  ! Пишем в файл кол-во строк
.head 5 -  Call SalFileSeek(hCreateFile, 102+22, FILE_SeekBegin)
.head 5 -  Call SalFileWrite(hCreateFile, PadL(Str(nNline),6), 6)
.head 5 -  Call SalFileClose(hCreateFile)
.head 5 -  ! BackUp
.head 5 -  Call FunBackUpFile(strFileName, Rep_Backup, FALSE)
.head 5 -  Set Rep_PathDst = Rep_PathNI || '\\' || szPureFileName
.head 5 -  !
.head 5 +  If NOT SqlPrepareAndExecute(hSql(),"UPDATE ZAG_F SET n=:nNline, otm=null, datk=null,err=null WHERE fn=:szPureFileName")
.head 6 -  Call SqlRollback(hSql())
.head 6 -  Return FALSE
.head 5 -  !
.head 5 -  Call MessageInfoEx('Файл ' || Rep_PathDst || ' сформовано.')
.head 5 -  Call SqlCommitEx( hSql(), 'Файл ' || Rep_PathDst || ' зарегистрирован.' )
.head 5 -  !
.head 5 -  Call SalWaitCursor(FALSE)
.head 5 -  Return TRUE
.head 3 +  Function: FunCreateTaxDocFile
.head 4 -  Description: Создать файл реестра документов для НИ
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strFileName
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hDelFile
.head 5 -  String: sKtk
.head 5 -  !
.head 5 -  String: szPureFileName
.head 5 -  Date/Time: dtCDat
.head 4 +  Actions
.head 5 -  Call SalWaitCursor( TRUE )
.head 5 -  Set hFile = 0
.head 5 -  Set nRec  = 0
.head 5 -  Set sKtk  = '???'
.head 5 -  Set nRow  = TBL_MinRow ! Сохранение информационных строк
.head 5 +  Loop
.head 6 +  If SalTblFindNextRow(tblFTax, nRow, 0, 0)
.head 7 -  Call SalTblFetchRow(tblFTax, nRow)
.head 7 +  If sKtk != tblFTax.KTK
.head 8 +  If hFile>0 	! Closing of current open file
.head 9 -  Call lllseek( hFile, 102+22, FILE_SeekBegin )
.head 9 -  Call llwrite( hFile, PadL(Str(nRec),6), 6 )
.head 9 -  Call llclose(hFile)
.head 9 -  Call FunBackUpFile( strFileName, Rep_Backup, FALSE )
.head 9 -  Call SqlPrepareAndExecute(hSql(),'UPDATE ZAG_TB SET n = :nRec WHERE fn = :szPureFileName AND dat = :dtCDat')
.head 9 -  Call SqlCommitEx( hSql(), 'Файл ' || strFileName || ' зарегистрирован.' )
.head 8 -  Set sKtk=tblFTax.KTK
.head 8 -  Set strFileName=Left(strFileName,Len(strFileName)-12)||
    Left(Right(strFileName,12),3)||'R'||Right('00'||sKtk,2)||Right(strFileName,6)
.head 8 -  ! Call Debug(strFileName||'-'||sKtk)
.head 8 -  Set hFile = llcreat(strFileName, 0)
.head 8 -  Set nRec = 0
.head 8 +  If hFile<=0
.head 9 -  Call MessageInfoEx( 'Помилка створення файлу ' || strFileName )
.head 9 -  Return FALSE
.head 8 -  ! Регистрируем файл в заголовках
.head 8 -  Set dtCDat = f_truncate_date_2minute( SalDateCurrent())
.head 8 -  Set szPureFileName = Right( strFileName, 12 )
.head 8 -  Call SqlPrepareAndExecute(hSql(),'INSERT INTO ZAG_TB (fn, dat) VALUES (:szPureFileName, :dtCDat)')
.head 8 -  ! Служебная строка
.head 8 -  Call llwrite( hFile,SalStrRepeatX( ' ', 100 )||PutCrLf(), 102)
.head 8 -  ! Заголовок
.head 8 -  Call llwrite(hFile, Right(strFileName,12) ||
     SalFmtFormatDateTime(dDat1, 'yyMMdd')   ||
     Right('0'||SalFmtFormatDateTime(SalDateCurrent(),'hhhhmm'),4)||
     PadL(Str(nRec),6) || SalStrRepeatX(' ', 166) || PutCrLf(), 196)
.head 7 -  Call llwrite(hFile,PadL(tblFTax.MFOA, 9)||PadL(tblFTax.NLSA,14)||
PadL(tblFTax.MFOB, 9)||PadL(tblFTax.NLSB,14)||
PadL(SalNumberToStrX(tblFTax.DK,0),1) ||
PadL(SalNumberToStrX(tblFTax.S,0),16) ||
PadL(SalNumberToStrX(tblFTax.VOB,0),2)||
PadR(StrWinToDosX(tblFTax.ND),10)||PadL(tblFTax.KV,3 )||
PadL(SalFmtFormatDateTime( tblFTax.DATD, 'yyMMdd' ),6) ||
PadL(SalFmtFormatDateTime( tblFTax.DATD, 'yyMMdd' ),6) ||
PadR(StrWinToDosX(tblFTax.NAMA),38) ||
PadR(StrWinToDosX(tblFTax.NAMB),38) ||
PadR(StrWinToDosX(tblFTax.NAZN),160)||
PadR(StrWinToDosX(tblFTax.DREC),60) ||
PadR(tblFTax.NAZNK,3) || PadR(tblFTax.NAZNS,2) ||
PadL(tblFTax.OKPO,14) || PadL(' ',14)||
PadL(tblFTax.REF_A,9) ||
PadL(SalFmtFormatDateTime( tblFTax.DAT_A, 'yyMMdd' ),6) ||
PadL(SalFmtFormatDateTime( tblFTax.DAT_B, 'yyMMdd' ),6) ||  PutCrLf() ,442 )
.head 7 -  Set nRec=nRec+1
.head 7 -  Call SqlPrepareAndExecute(hSql(),'INSERT INTO LINES_TB
 (FN,DAT,N,MFOA,NLSA,MFOB,NLSB,DK,S,KV,VOB,ND,KV,DATD,NAMA,
  NAMB,NAZN,DREC,NAZNK,NAZNS,OKPO,REF_A,DAT_A,DAT_B)
 VALUES
 (:szPureFileName, :dtCDat, :nRec, :tblFTax.MFOA, :tblFTax.NLSA, :tblFTax.MFOB, :tblFTax.NLSB,
  :tblFTax.DK, :tblFTax.S, :tblFTax.KV, :tblFTax.VOB, :tblFTax.ND, :tblFTax.DATD, :tblFTax.NAMA,
  :tblFTax.NAMB, :tblFTax.NAZN, :tblFTax.DREC, :tblFTax.NAZNK, :tblFTax.NAZNS, :tblFTax.OKPO,
  :tblFTax.REF_A, :tblFTax.DAT_A, :tblFTax.DAT_B)')
.head 6 +  Else
.head 7 -  Break
.head 5 +  If hFile>0
.head 6 -  Call lllseek( hFile, 102+22, FILE_SeekBegin )
.head 6 -  Call llwrite( hFile, PadL(Str(nRec),6), 6 )
.head 6 -  Call llclose(hFile)
.head 6 -  Call FunBackUpFile( strFileName, Rep_Backup, FALSE )
.head 6 -  Call SqlPrepareAndExecute(hSql(),'UPDATE ZAG_TB SET n = :nRec WHERE fn = :szPureFileName AND dat = :dtCDat')
.head 6 -  Call SqlCommitEx( hSql(), 'Файл ' || strFileName || ' зарегистрирован.' )
.head 6 -  Call MessageInfoEx('Готово.')
.head 5 -  Call SalWaitCursor( FALSE )
.head 5 -  Return TRUE
.head 3 +  Function: FunCreateTaxDocFile2
.head 4 -  Description: Создать файл реестра документов для НИ без таблицы
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strFileName
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hDelFile
.head 5 -  String: sKtk
.head 5 -  String: sss
.head 5 -  String: szPureFileName
.head 5 -  Date/Time: dtCDat
.head 4 +  Actions
.head 5 -  Call SalWaitCursor( TRUE )
.head 5 -  Set hFile = 0
.head 5 -  Set nRec  = 0
.head 5 -  Set sKtk  = '???'
.head 5 -  Call SalTblSetContext( tblFTax, SalTblInsertRow( tblFTax, TBL_MaxRow ) )
.head 5 -  Set sss=T("
 SELECT t.KOD_DPI,r.mfoa,r.nlsa,r.mfob,r.nlsb,r.dk,r.s,r.vob,r.nd,r.kv,
          r.datd,r.datp,r.nam_a,r.nam_b,r.nazn,r.d_rec,r.naznk,r.nazns,
          r.id_a,r.ref_a,r.dat_a,r.dat_b
 FROM arc_rrp r,accounts a,specparam s,terrdpi t
 WHERE DATE(dat_b)=:sDat1 and t.ktk=s.ktk and
 DECODE(r.mfob,:AMFO,r.nlsb,r.nlsa)=a.nls and r.kv=a.kv and
 a.acc=s.acc and a.tip='DKZ' ORDER BY s.ktk
 INTO :tblFTax.KTK,
      :tblFTax.MFOA,:tblFTax.NLSA,:tblFTax.MFOB,:tblFTax.NLSB,
      :tblFTax.DK,:tblFTax.S,:tblFTax.VOB,:tblFTax.ND,:tblFTax.KV,
      :tblFTax.DATD,:tblFTax.DATP,:tblFTax.NAMA,:tblFTax.NAMB,
      :tblFTax.NAZN,:tblFTax.DREC,:tblFTax.NAZNK,:tblFTax.NAZNS,
:tblFTax.OKPO,:tblFTax.REF_A,:tblFTax.DAT_A,:tblFTax.DAT_B ")
.head 5 -  ! Call Debug(sss)
.head 5 -  Call SqlPrepareAndExecute(hSql(),sss)
.head 5 +  While SqlFetchNext(hSql(),nFetchRes)
.head 6 -  Set tblFTax.KTK = Right('000'||SalStrTrimX( tblFTax.KTK ),3)
.head 6 +  If sKtk != tblFTax.KTK
.head 7 +  If hFile>0
.head 8 -  Call lllseek( hFile, 102+22, FILE_SeekBegin )
.head 8 -  Call llwrite( hFile, PadL(Str(nRec),6), 6 )
.head 8 -  Call llclose(hFile)
.head 8 -  Call FunBackUpFile( strFileName, Rep_Backup, FALSE )
.head 8 -  Call SqlPrepareAndExecute(hSql(),'UPDATE ZAG_TB SET n = :nRec WHERE fn = :szPureFileName AND dat = :dtCDat')
.head 8 -  Call SqlCommitEx( hSql(), 'Файл ' || strFileName || ' зарегистрирован.' )
.head 7 -  Set sKtk=tblFTax.KTK
.head 7 -  Set strFileName=SalStrLeftX(strFileName,SalStrLength(strFileName)-3)||sKtk
.head 7 -  ! Call Debug(strFileName||'-'||sKtk)
.head 7 -  Set hFile = llcreat(strFileName, 0)
.head 7 -  Set nRec = 0
.head 7 +  If hFile<=0
.head 8 -  Call MessageInfoEx( 'Помилка створення файлу ' || strFileName )
.head 8 -  Return FALSE
.head 7 -  ! Регистрируем файл в заголовках
.head 7 -  Set dtCDat = f_truncate_date_2minute( SalDateCurrent() )
.head 7 -  Set szPureFileName = Right( strFileName, 12 )
.head 7 -  Call SqlPrepareAndExecute(hSql(),'INSERT INTO ZAG_TB (fn, dat) VALUES (:szPureFileName, :dtCDat)')
.head 7 -  ! Служебная строка
.head 7 -  Call llwrite( hFile,SalStrRepeatX( ' ', 100 )||PutCrLf(), 102)
.head 7 -  ! Заголовок
.head 7 -  Call llwrite(hFile, Right(strFileName,12) ||
     SalFmtFormatDateTime(GetBankDate(), 'yyMMdd')   ||
     Right('0'||SalFmtFormatDateTime(SalDateCurrent(),'hhhhmm'),4)||
     PadL(Str(nRec),6) || SalStrRepeatX(' ', 166) || PutCrLf(), 196)
.head 7 -  Call SalStatusSetText( tblFTax, strFileName)
.head 6 -  Call llwrite(hFile,PadL(tblFTax.MFOA, 9)||PadL(tblFTax.NLSA,14)||
PadL(tblFTax.MFOB, 9)||PadL(tblFTax.NLSB,14)||
PadL(SalNumberToStrX(tblFTax.DK,0),1)||
PadL(SalNumberToStrX(tblFTax.S,0),16)||
PadL(SalNumberToStrX(tblFTax.VOB,0),2)||
PadR(tblFTax.ND,10)||PadL(tblFTax.KV,3 )||
SalFmtFormatDateTime( tblFTax.DATD, 'yyMMdd' )||
SalFmtFormatDateTime( tblFTax.DATD, 'yyMMdd' )||
PadR(tblFTax.NAMA,38) || PadR(tblFTax.NAMB,38 ) ||
PadR(tblFTax.NAZN,160)||PadR(tblFTax.DREC,60) ||
PadR(tblFTax.NAZNK,3) ||PadR(tblFTax.NAZNS,2) ||
PadL(tblFTax.OKPO,14)||PadL(' ',14)||
PadL(tblFTax.REF_A,9) ||
SalFmtFormatDateTime( tblFTax.DAT_A, 'yyMMdd' )||
SalFmtFormatDateTime( tblFTax.DAT_B, 'yyMMdd' ) ||  PutCrLf() ,442 )
.head 6 -  Set nRec=nRec+1
.head 6 -  Call SqlPrepareAndExecute(hSql(),'INSERT INTO LINES_TB
 (FN,DAT,N,MFOA,NLSA,MFOB,NLSB,DK,S,KV,VOB,ND,DATD,NAMA,
  NAMB,NAZN,DREC,NAZNK,NAZNS,OKPO,REF_A,DAT_A,DAT_B)
 VALUES
 (:szPureFileName, :dtCDat, :nRec, :tblFTax.MFOA, :tblFTax.NLSA, :tblFTax.MFOB, :tblFTax.NLSB,
  :tblFTax.DK, :tblFTax.S, :tblFTax.KV, :tblFTax.VOB, :tblFTax.ND, :tblFTax.DATD, :tblFTax.NAMA,
  :tblFTax.NAMB, :tblFTax.NAZN, :tblFTax.DREC, :tblFTax.NAZNK, :tblFTax.NAZNS, :tblFTax.OKPO,
  :tblFTax.REF_A, :tblFTax.DAT_A, :tblFTax.DAT_B)')
.head 5 +  If hFile>0
.head 6 -  Call lllseek( hFile, 102+22, FILE_SeekBegin )
.head 6 -  Call llwrite( hFile, PadL(Str(nRec),6), 6 )
.head 6 -  Call llclose(hFile)
.head 6 -  Call FunBackUpFile( strFileName, Rep_Backup, FALSE )
.head 6 -  Call SqlPrepareAndExecute(hSql(),'UPDATE ZAG_TB SET n = :nRec WHERE fn = :szPureFileName AND dat = :dtCDat')
.head 6 -  Call SqlCommitEx( hSql(), 'Файл ' || strFileName || ' зарегистрирован.' )
.head 6 -  Call SalStatusSetText( tblFTax, 'Готово.')
.head 6 -  Call MessageInfoEx('Готово.')
.head 5 -  Call SalWaitCursor( FALSE )
.head 5 -  Return TRUE
.head 3 +  Function: FunCreateTaxDocFileCV
.head 4 -  Description: Создать файл реестра документов для ЦВК
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strFileName
.head 5 -  Receive Number: nRetNum
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hCreateFile
.head 5 -  Number: nNline
.head 5 -  Number: nLength
.head 5 -  String: strLine
.head 5 -  String: sNls
.head 5 -  String: sFName
.head 5 -  Number: nNumFile
.head 5 -  String: sVid
.head 5 -  !
.head 5 -  String: szPureFileName
.head 5 -  Date/Time: dtCDat
.head 5 -  Number: nStrLen
.head 5 -  String: strPFileName ! имя файла протокола
.head 5 -  Number: nAccCount ! количество счетов на основе которых сделан файл
.head 5 -  Number: nDAll ! Д оборот суммарный
.head 5 -  Number: nKAll ! К оборот суммарный
.head 5 -  String: strNls ! Счет
.head 5 -  Number: nDCount ! количество Д оборотов по счету
.head 5 -  Number: nKCount ! количество К  оборотов по счету
.head 5 -  Number: nD ! Д оборот по счету
.head 5 -  Number: nK  ! К  оборот по счету
.head 5 -  Number: nRez
.head 5 -  String: strCVProtocol
.head 5 -  !
.head 5 -  String: sFilePath
.head 5 -  String: sFileName
.head 5 -  String: sDrive
.head 5 -  String: sDir
.head 5 -  String: sFile
.head 5 -  String: sExt
.head 5 -  String: sHvost
.head 4 +  Actions
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  Call VisDosSplitPath(strFileName, sDrive, sDir, sFile, sExt)
.head 5 -  Set sFilePath = sDrive || sDir
.head 5 -  Set sFileName = sFile || sExt
.head 5 -  !
.head 5 -  Set sNls   = ''
.head 5 -  Set nNline = 0
.head 5 -  Set sHvost = IifS(sDPA_SAB='', Subs(GetBankSab(),2,3), sDPA_SAB) ||
    GetCharForDigit(SalDateMonth(SalDateCurrent())) ||
    GetCharForDigit(SalDateDay(SalDateCurrent()))
.head 5 -  Set sFName = strFileName
.head 5 -  Set nNumFile = Val(SalStrRightX(strFileName, 3))
.head 5 -  Set szPureFileName = Right(sFName,12)
.head 5 -  Set dtCDat = f_truncate_date_2minute(SalDateCurrent())
.head 5 -  Set nRow   = TBL_MinRow ! Сохранение информационных строк
.head 5 +  While SalTblFindNextRow(tblFTax, nRow, 0, 0)
.head 6 -  Call SalTblSetContext(tblFTax, nRow)
.head 6 +  If tblFTax.NLS != sNls
.head 7 +  If sNls != ''
.head 8 -  Call SalFileSeek(hCreateFile, 102+22, FILE_SeekBegin)
.head 8 -  Call SalFileWrite(hCreateFile, PadL(Str(nNline),6), 6)
.head 8 -  Call SalFileClose(hCreateFile)
.head 8 -  !
.head 8 -  Call FunBackUpFile(sFName, Rep_Backup, FALSE)
.head 8 +  If SqlPrepareAndExecute(hSql(),"UPDATE ZAG_TB SET n=:nNline WHERE fn=:szPureFileName AND dat=:dtCDat")
.head 9 -  Call SqlCommitEx(hSql(), 'Файл ' || strFileName || ' зарегистрирован.')
.head 8 -  !
.head 8 -  Set nNline = 0
.head 8 -  Set nNumFile = nNumFile + 1
.head 8 -  ! Set sFName = SalStrLeftX(sFName, Len(sFName)-3) || SalStrRightX('000'||Str(nNumFile),3)
.head 8 -  ! Set szPureFileName = Right(sFName,12)
.head 8 -  Set dtCDat = f_truncate_date_2minute( SalDateCurrent() )
.head 7 -  ! вид счета (для имени файла)
.head 7 -  Call SqlPrepareAndExecute(hSql(), "select decode(vid,13,'1',14,'2','3') into :sVid from accounts where nls = :tblFTax.NLS and kv = 980")
.head 7 +  If not SqlFetchNext(hSql(), nFetchRes)
.head 8 -  Return FALSE
.head 7 -  Set sFile = 'CV' || sVid || sHvost
.head 7 -  Set sFName = VisDosMakePath(sDrive, sDir, sFile, '.' || SalStrRightX('000'||Str(nNumFile),3))
.head 7 -  Set szPureFileName = Right(sFName,12)
.head 7 -  !
.head 7 +  If NOT SalFileOpen(hCreateFile, sFName, OF_Create | OF_Write | OF_Text)
.head 8 -  Call SalMessageBox( 'Неможливо створити файл ' || sFName, 'Увага!', MB_IconAsterisk )
.head 8 -  Break
.head 7 -  Set sNls = tblFTax.NLS
.head 7 -  ! Служебная строка
.head 7 -  Call SalFileWrite(hCreateFile, SalStrRepeatX(' ', 100) || PutCrLf(), 102)
.head 7 -  ! Заголовок
.head 7 -  Set nLength = 196
.head 7 -  Set strLine = szPureFileName ||
  SalFmtFormatDateTime(SalDateCurrent(), 'yyMMdd') ||
  SalStrRightX('0'||SalFmtFormatDateTime(SalDateCurrent(), 'hhhhmm'),4) ||
  PadL(Str(nNline),6) ||
  SalStrRepeatX(' ', 166) || PutCrLf()
.head 7 -  Call SalFileWrite(hCreateFile, strLine, nLength)
.head 7 -  Call SqlPrepareAndExecute(hSql(), 'INSERT INTO ZAG_TB(fn, dat) VALUES (:szPureFileName, :dtCDat)')
.head 6 -  ! новая версия: WIN-кодировка
.head 6 -  Call SalFileWrite(hCreateFile,
  PadL(tblFTax.MFOA, 9) || PadL(tblFTax.NLSA,14) ||
  PadL(tblFTax.MFOB, 9) || PadL(tblFTax.NLSB,14) ||
  PadL(SalNumberToStrX(tblFTax.DK,0),1) ||
  PadL(SalNumberToStrX(tblFTax.S,0),16) ||
  PadL(SalNumberToStrX(tblFTax.VOB,0),2)||
  PadR(tblFTax.ND,10) || PadL(Str(tblFTax.KV_CV), 3) ||
  PadL(SalFmtFormatDateTime(tblFTax.DATD, 'yyMMdd'), 6) ||
  PadL(SalFmtFormatDateTime(tblFTax.DATP, 'yyMMdd'), 6) ||
  PadR(tblFTax.NAMA,38) ||
  PadR(tblFTax.NAMB,38) ||
  PadR(tblFTax.NAZN,160)||
  PadR(tblFTax.DREC,60) ||
  PadR(tblFTax.NAZNK,3) || PadR(tblFTax.NAZNS,2) ||
  PadR(tblFTax.OKPOA,14)|| PadR(tblFTax.OKPOB,14)||
  PadL(tblFTax.REF_A,9) ||
  PadL(SalFmtFormatDateTime(tblFTax.DAT_A, 'yyMMdd'),6) ||
  PadL(SalFmtFormatDateTime(tblFTax.DAT_B, 'yyMMdd'),6) || PutCrLf(), 442)
.head 6 -  Set nNline = nNline + 1
.head 6 -  ! регистрируем детальные строки файла
.head 6 -  If NOT SqlPrepareAndExecute( hSql(),
"INSERT INTO LINES_CV(fn, dat, n,
   MFOA, NLSA, MFOB, NLSB, DK, S, VOB, ND, KV, DATD, NAMA, NAMB,
   NAZN, DREC, NAZNK, NAZNS, OKPOA, OKPOB, REF_A, DAT_A, DAT_B)
 VALUES (:szPureFileName, :dtCDat, :nNline,
   :tblFTax.MFOA, :tblFTax.NLSA, :tblFTax.MFOB, :tblFTax.NLSB,
   :tblFTax.DK, :tblFTax.S, :tblFTax.VOB, :tblFTax.ND, :tblFTax.KV, :tblFTax.DATD, :tblFTax.NAMA,
   :tblFTax.NAMB, :tblFTax.NAZN, :tblFTax.DREC, :tblFTax.NAZNK, :tblFTax.NAZNS, :tblFTax.OKPOA, :tblFTax.OKPOB,
   :tblFTax.REF_A, :tblFTax.DAT_A, :tblFTax.DAT_B)" )
.head 5 +  If sNls != '' AND SalFileOpen(hCreateFile, sFName, OF_Exist)
.head 6 -  Call SalFileSeek(hCreateFile, 102+22, FILE_SeekBegin)
.head 6 -  Call SalFileWrite(hCreateFile, PadL(Str(nNline),6), 6)
.head 6 -  Call SalFileClose(hCreateFile)
.head 6 -  !
.head 6 -  Call FunBackUpFile(sFName, Rep_Backup, FALSE)
.head 6 +  If SqlPrepareAndExecute(hSql(),"UPDATE ZAG_TB SET n=:nNline WHERE fn=:szPureFileName AND dat=:dtCDat")
.head 7 -  Call SqlCommitEx(hSql(), 'Файл ' || strFileName || ' зарегистрирован.')
.head 6 -  !
.head 6 -  Call MessageInfoEx('Файл ' || Rep_PathDst || ' сформовано.')
.head 5 -  Set nRetNum = nNumFile
.head 5 -  ! ! файл протокол для Сбербанка
.head 5 -  ! Call Debug(AMFO)
.head 5 +  If AMFO = '300465'
.head 6 -  !
.head 6 -  Set hFile = 0
.head 6 -  Set nStrLen = SalStrLength (strFileName)
.head 6 -  Set strPFileName = SalStrLeftX ( strFileName, nStrLen-3 )||"txt"
.head 6 -  ! Call Debug(strPFileName)
.head 6 -  Set hFile = llcreat(strPFileName, 0)
.head 6 +  If hFile<=0
.head 7 -  Call MessageInfoEx( 'Помилка створення файлу ' || strPFileName )
.head 7 -  Return FALSE
.head 6 +  Else
.head 7 -  !
.head 7 -  ! Служебная строка
.head 7 +  If SqlPrepareAndExecute ( hSql(),
"SELECT
    decode(p.dk,0,r.nlsa,r.nlsb),
    sum(decode(p.dk,0,r.s,0)),
    sum(decode(p.dk,1,r.s,0)),
    sum(decode(p.dk,0,1,0)),
    sum(decode(p.dk,1,1,0))
  FROM OPLDOK p, ACCOUNTS s, OPER r, ARC_RRP ARC
 WHERE trunc(p.fdat)=:dDat1 and p.sos=5 and
       p.acc=s.acc and substr(s.nbs,1,3)='264' and
       p.ref=r.ref and r.dk < 2 and
       R.REF = ARC.REF (+) and
       ARC.dat_b(+)>=bankdate-1 and ARC.dat_b(+)<=bankdate+1
  GROUP BY decode(p.dk,0,r.nlsa,r.nlsb)
 INTO  :strNls, :nD, :nK, :nDCount, :nKCount " )
.head 8 -  Call SqlFetchNext ( hSql(), nRez )
.head 7 +  If SqlPrepareAndExecute ( hSql(),
"SELECT count( distinct decode(p.dk,0,r.nlsa,r.nlsb) )
  FROM OPLDOK p, ACCOUNTS s, OPER r, ARC_RRP ARC
 WHERE trunc(p.fdat)=:dDat1 and p.sos=5 and
       p.acc=s.acc and substr(s.nbs,1,3)='264' and
       p.ref=r.ref and r.dk < 2 and
       R.REF = ARC.REF (+) and
       ARC.dat_b(+)>=bankdate-1 and ARC.dat_b(+)<=bankdate+1
 INTO  :nAccCount " )
.head 8 -  Call SqlFetchNext ( hSql(), nRez )
.head 7 -  ! Call llwrite( hFile,SalStrRepeatX( ' ', 100 )||PutCrLf(), 102)
.head 7 -  Call llwrite( hFile,
SalStrMidX(strFileName,
   nStrLen-12,12)
 ||SalFmtFormatDateTime(dDat1, 'yyyyMMdd')
 ||SalFmtFormatDateTime(SalDateCurrent(), 'yyyyMMdd')
 ||Right('0'||SalFmtFormatDateTime(SalDateCurrent(),'hhhhmm'),4)
 ||PadL(Str(nAccCount),3)
 ||PadL(Str(nDAll),16)
 ||PadL(Str(nKAll),16)
 ||PutCrLf(), 69)
.head 7 -  ! информационные строки
.head 7 -  !
.head 7 +  If SqlPrepareAndExecute ( hSql(),
"SELECT
  decode(p.dk,0,r.nlsa,r.nlsb),
  sum(decode(p.dk,0,1,0)),
  sum(decode(p.dk,0,r.s,0)),
  sum(decode(p.dk,1,1,0)),
  sum(decode(p.dk,1,r.s,0))
  FROM OPLDOK p, ACCOUNTS s, OPER r, ARC_RRP ARC
 WHERE trunc(p.fdat)=:dDat1 and p.sos=5 and
       p.acc=s.acc and substr(s.nbs,1,3)='264' and
       p.ref=r.ref and r.dk < 2 and
       R.REF = ARC.REF (+) and
       ARC.dat_b(+)>=bankdate-1 and ARC.dat_b(+)<=bankdate+1
 GROUP BY decode(p.dk,0,r.nlsa,r.nlsb)
 INTO  :strNls,:nDCount ,:nD,:nKCount, :nK   " )
.head 8 -  Call SqlFetchNext ( hSql(),nRez)
.head 8 +  While nRez != FETCH_EOF
.head 9 -  !
.head 9 -  ! Call Debug(strNls)
.head 9 -  Call llwrite( hFile,
   PadR(strNls,14)
 ||PadL(Str(nDCount),10)
 ||PadL(Str(nD),16)
 ||PadL(Str(nKCount),10)
 ||PadL(Str(nK),16)
 ||PutCrLf() , 68)
.head 9 -  Call SqlFetchNext ( hSql(),nRez)
.head 6 -  ! закрываем файл
.head 6 +  If hFile > 0
.head 7 -  Call llclose(hFile)
.head 5 -  Call SalWaitCursor( FALSE )
.head 5 -  Return TRUE
.head 3 +  Function: FunCreateTaxDocFileCA
.head 4 -  Description: Создать файл реестра открытых счетов для ЦВК
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strFileName
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: szPureFileName
.head 5 -  Date/Time: dtCDat
.head 4 +  Actions
.head 5 -  Call SalWaitCursor( TRUE )
.head 5 -  Set hFile = llcreat(strFileName, 0)
.head 5 +  If hFile <= 0
.head 6 -  Call MessageInfoEx( 'Помилка створення файлу ' || strFileName )
.head 6 -  Return FALSE
.head 5 -  Set nRec = 0
.head 5 -  ! Регистрируем файл в заголовках
.head 5 -  Set dtCDat = f_truncate_date_2minute(SalDateCurrent())
.head 5 -  Set szPureFileName = Right(strFileName, 12)
.head 5 -  Call SqlPrepareAndExecute(hSql(), 'INSERT INTO ZAG_TB (fn, dat) VALUES (:szPureFileName, :dtCDat)')
.head 5 -  ! Служебная строка
.head 5 -  Call llwrite(hFile, SalStrRepeatX(' ', 100) || PutCrLf(), 102)
.head 5 -  ! Заголовок
.head 5 -  Call llwrite(hFile,
  Right(strFileName,12) ||
  SalFmtFormatDateTime(dDat1, 'yyMMdd') ||
  Right('0' || SalFmtFormatDateTime(SalDateCurrent(),'hhhhmm'), 4) ||
  PadL(Str(nRec),6) || SalStrRepeatX(' ', 166) || PutCrLf(), 196)
.head 5 -  ! Информационные строки
.head 5 -  Set nRow = TBL_MinRow
.head 5 +  While SalTblFindNextRow(tblFTax, nRow, 0, 0)
.head 6 -  Call SalTblSetContext(tblFTax, nRow)
.head 6 -  ! старая версия: DOS-кодировка + NAME_BLOK 250 симв.
.head 6 -  ! Call llwrite(hFile,
  PadR(StrWinToDosX(tblFTax.NB),38) ||
  PadL(tblFTax.MFO, 9) ||
  PadR(StrWinToDosX(tblFTax.CA_BANK_ADDRESS),250) ||
  tblFTax.VID ||
  PadL(tblFTax.NLS,14) ||
  PadL(SalNumberToStrX(tblFTax.NUM_TVO,0),3)||
  PadL(SalFmtFormatDateTime( tblFTax.DAOS, 'yyMMdd' ),6) ||
  PadR(StrWinToDosX(tblFTax.NAME_BLOK),250) ||
  PadL(SalNumberToStrX(tblFTax.CA_CUST_OKPO,0),10)||
  PadR(StrWinToDosX(tblFTax.FIO_BLOK),76)||
  PadR(StrWinToDosX(tblFTax.FIO_ISP),38) ||
  PadR(StrWinToDosX(tblFTax.INF_ISP),38) || PutCrLf(), 735)
.head 6 -  ! новая версия: WIN-кодировка + NAME_BLOK 38 симв.
.head 6 -  Call llwrite(hFile,
  PadR(tblFTax.NB, 38) ||
  PadL(tblFTax.MFO, 9) ||
  PadR(tblFTax.CA_BANK_ADDRESS, 250) ||
  tblFTax.VID ||
  PadL(tblFTax.NLS, 14) ||
  PadL(SalNumberToStrX(tblFTax.NUM_TVO,0), 3) ||
  PadL(SalFmtFormatDateTime( tblFTax.DAOS, 'yyMMdd' ), 6) ||
  PadR(tblFTax.NAME_BLOK, 38) ||
  PadL(SalNumberToStrX(tblFTax.CA_CUST_OKPO,0), 10) ||
  PadR(tblFTax.FIO_BLOK, 76)||
  PadR(tblFTax.FIO_ISP, 38) ||
  PadR(tblFTax.INF_ISP, 38) || PutCrLf(), 523)
.head 6 -  Set nRec = nRec + 1
.head 6 -  ! регистрируем детальные строки файла
.head 6 -  If NOT SqlPrepareAndExecute( hSql(),
"INSERT INTO LINES_CA(fn, dat, n,
   MFO, NB, NLS, VID, NUM_TVO, NAME_BLOK, DAOS, FIO_BLOK, FIO_ISP, INF_ISP)
 VALUES (:szPureFileName, :dtCDat, :nRec,
   :tblFTax.MFO, :tblFTax.NB, :tblFTax.NLS, :tblFTax.VID,
   :tblFTax.NUM_TVO, :tblFTax.NAME_BLOK, :tblFTax.DAOS, :tblFTax.FIO_BLOK,
   :tblFTax.FIO_ISP, :tblFTax.INF_ISP)" )
.head 5 -  Call lllseek(hFile, 102+22, FILE_SeekBegin)
.head 5 -  Call llwrite(hFile, PadL(Str(nRec),6), 6)
.head 5 -  Call llclose(hFile)
.head 5 -  Call FunBackUpFile(strFileName, Rep_Backup, FALSE)
.head 5 -  Call MessageInfoEx('Файл ' || strFileName || ' сформовано.')
.head 5 +  If SqlPrepareAndExecute(hSql(),"UPDATE ZAG_TB SET n=:nRec WHERE fn=:szPureFileName AND dat=:dtCDat")
.head 6 -  Call SqlCommitEx(hSql(), 'Файл ' || strFileName || ' зарегистрирован.')
.head 5 -  Call SalWaitCursor(FALSE)
.head 5 -  Return TRUE
.head 3 -  !
.head 3 +  Function: GetFirstEditableColumn
.head 4 -  Description: Получить первую редактируюмую колонку
.head 4 +  Returns
.head 5 -  Window Handle:
.head 4 +  Parameters
.head 5 -  Window Handle: hWndTbl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nCol
.head 5 -  Window Handle: hWndCol
.head 4 +  Actions
.head 5 -  Set nCol=1
.head 5 +  Loop
.head 6 -  Set hWndCol = SalTblGetColumnWindow(hWndTbl, nCol,    COL_GetPos)
.head 6 +  If hWndCol = hWndNULL
.head 7 -  Break
.head 6 +  If SalTblQueryColumnFlags(hWndCol, COL_Editable) and   SalIsWindowVisible(hWndCol)
.head 7 -  Break
.head 6 -  Set nCol = nCol + 1
.head 5 -  Return hWndCol
.head 3 +  Function: f_truncate_date_2minute
.head 4 -  Description: Обрезать дату до минут
.head 4 +  Returns
.head 5 -  Date/Time:
.head 4 +  Parameters
.head 5 -  Date/Time: dtSrc
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nYear
.head 5 -  Number: nMonth
.head 5 -  Number: nDay
.head 5 -  Number: nHour
.head 5 -  Number: nMinute
.head 5 -  !
.head 4 +  Actions
.head 5 +  If dtSrc = DATETIME_Null
.head 6 -  Set dtSrc = SalDateCurrent()
.head 5 -  !
.head 5 -  Set nYear   = SalDateYear( dtSrc )
.head 5 -  Set nMonth  = SalDateMonth( dtSrc )
.head 5 -  Set nDay    = SalDateDay( dtSrc )
.head 5 -  Set nHour   = SalDateHour( dtSrc )
.head 5 -  Set nMinute = SalDateMinute( dtSrc )
.head 5 -  !
.head 5 -  Return SalDateConstruct( nYear, nMonth, nDay, nHour, nMinute, 0 )
.head 2 +  Window Parameters
.head 3 -  String: strTypeList	! @F,@K ...
.head 3 -  String: sFilter	! #@F=<Filter> #^Q=<Filter> ...
.head 2 +  Window Variables
.head 3 -  Date/Time: dBDat
.head 3 -  String: AMFO
.head 3 -  String: sBankName
.head 3 -  String: sBankOkpo
.head 3 -  !
.head 3 -  String: sAREACODE
.head 3 -  String: sDPA_SAB
.head 3 -  String: sBANKTYPE
.head 3 -  Number: nFNAL
.head 3 -  !
.head 3 -  Number: nTipNum
.head 3 -  Number: nFileTip[*]
.head 3 -  String: sFileTip[*]
.head 3 -  ! String: sTipName[*]
.head 3 -  String: smTypeList[*]
.head 3 -  String: sFilterTip[*]
.head 3 -  Number: nScan
.head 3 -  String: sTmp
.head 3 -  Number: nTmp
.head 3 -  !
.head 3 -  String: Rep_PathNI
.head 3 -  String: Rep_PathNB
.head 3 -  String: Rep_PathDst
.head 3 -  String: Rep_Backup
.head 3 -  String: Rep_Tickets
.head 3 -  String: Rep_TMask
.head 3 -  !
.head 3 -  String: ss
.head 3 -  String: sDat1
.head 3 -  Date/Time: dDat1
.head 3 -  Date/Time: dtChoosen
.head 3 -  String: strFileName
.head 3 -  String: strFileChoosen
.head 3 -  Number: nRec
.head 3 -  Number: hFile
.head 3 -  Number: nRow
.head 3 -  String: strOperId
.head 3 -  Number: nTip
.head 3 -  String: sNam
.head 3 -  Number: i
.head 3 -  Number: j
.head 3 -  String: sPK
.head 3 -  String: sSem
.head 3 -  !
.head 3 -  Number: nFileNum
.head 3 -  Number: nFileNumDef
.head 3 -  Date/Time: dtLastTime
.head 3 -  String: strAttrDate
.head 3 -  String: strAttrNum
.head 3 -  String: strAttrNumDef
.head 3 -  String: strTabZag
.head 3 -  String: strTabLines
.head 3 -  String: strFormedVar
.head 3 -  String: strFormedInto
.head 3 -  !
.head 3 -  Boolean: fRet
.head 3 -  Boolean: fPreserveFileName
.head 3 -  !
.head 3 -  Number: nClnX1
.head 3 -  Number: nClnY1
.head 3 -  Number: nClnX2
.head 3 -  Number: nClnY2
.head 3 -  !
.head 3 -  : cFltr
.head 4 -  Class: cGenFilter
.head 3 -  String: sFltrTableName
.head 3 -  String: sFltrWhereClause
.head 3 -  String: sSql
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call WaitCursorOn()
.head 4 -  Call XSalTooltipSetUserDefault()
.head 4 -  Call SetWindowFullSize(hWndForm)
.head 4 -  Call SalSetWindowText(hWndForm, AppVersion || 'Формування файлів-звітів для ДПА')
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 4 -  !
.head 4 -  Set dBDat = GetBankDate()
.head 4 -  Set AMFO  = GetBankMfo()
.head 4 -  Set sBankName = GetBankName()
.head 4 -  Set sBankOkpo = GetBankOkpoS()
.head 4 -  !
.head 4 -  Set nTip = 1
.head 4 -  Set nTipNum = 6
.head 4 -  Set nFileTip[1] = 1
.head 4 -  Set nFileTip[2] = 2
.head 4 -  Set nFileTip[3] = 3
.head 4 -  Set nFileTip[4] = 4
.head 4 -  Set nFileTip[5] = 5
.head 4 -  Set nFileTip[6] = 6
.head 4 -  Set sFileTip[1] = '@F'
.head 4 -  Set sFileTip[2] = '@B'
.head 4 -  Set sFileTip[3] = '@K'
.head 4 -  Set sFileTip[4] = '@P'
.head 4 -  Set sFileTip[5] = 'CV'
.head 4 -  Set sFileTip[6] = 'CA'
.head 4 -  !
.head 4 -  ! strTypeList
.head 4 +  If strTypeList
.head 5 -  Set nTmp = SalStrTokenize(strTypeList, '', ',', smTypeList)
.head 5 -  Set i = 0
.head 5 +  While i < nTmp
.head 6 -  Set j = 1
.head 6 +  While j <= nTipNum
.head 7 +  If smTypeList[i] = sFileTip[j]
.head 8 -  Set nFileTip[i+1] = j
.head 8 -  Break
.head 7 -  Set j = j + 1
.head 6 -  Set i = i + 1
.head 5 -  Set nTip = nFileTip[1]
.head 5 -  Set nTipNum = nTmp
.head 4 +  Else
.head 5 -  Set j = 1
.head 5 +  While j <= nTipNum
.head 6 -  Set nFileTip[i] = j
.head 6 -  Set j = j + 1
.head 4 -  !
.head 4 -  ! Filter
.head 4 +  If sFilter
.head 5 -  Set i = 1
.head 5 +  While i <= 9
.head 6 -  Set nScan = SalStrScan(sFilter, '#'||sFileTip[i]||'=')
.head 6 +  If nScan != -1
.head 7 -  Set sTmp = Subs(sFilter, nScan+5, Len(sFilter)-nScan-4)
.head 7 -  Set nScan = SalStrScan(sTmp, '#')
.head 7 -  Set sFilterTip[i] = SalStrLeftX(sTmp, IifN(nScan=-1, Len(sTmp), nScan))
.head 6 -  Set i = i + 1
.head 4 -  ! AREACODE - Код области банка (в имя файлов @)
.head 4 -  Set sAREACODE = GetGlobalOption('AREACODE')
.head 4 -  ! DPA_SAB - Код SAB банку в назві файлу @FISABmd.nnn
.head 4 -  Set sDPA_SAB  = GetGlobalOption('DPA_SAB')
.head 4 -  ! BANKTYPE - банк
.head 4 -  Set sBANKTYPE = GetGlobalOption('BANKTYPE')
.head 4 -  ! @F_NAL - Формировать @F по налоговым
.head 4 -  Set nFNAL     = GetGlobalOptionEx('@F_NAL')
.head 4 -  !
.head 4 -  Set strOperId = SalStrRightX(SalStrUpperX(SalStrTrimX(GetBankSab())),3) || 'R00'
.head 4 -  !
.head 4 -  Call SalUseRegistry(FALSE, '')
.head 4 -  Call SalGetProfileString(INI_Directory, 'NBURegistry', GetPrnDir(), Rep_PathNB, GetIniFileName())
.head 4 -  Call SalGetProfileString(INI_Directory, 'TaxRegistry', GetPrnDir(), Rep_PathNI, GetIniFileName())
.head 4 -  Call SalGetProfileString(INI_Directory, 'BackupDir',   GetPrnDir(), Rep_Backup, GetIniFileName())
.head 4 -  Call SalGetProfileString(INI_Directory, 'TicketsDir',  GetPrnDir(), Rep_Tickets, GetIniFileName())
.head 3 +  On SAM_CreateComplete
.head 4 -  Call WaitCursorOff()
.head 4 -  ! @F
.head 4 +  If nTip = 1
.head 5 -  Call SalEnableWindow(pbFilter)
.head 5 -  Set sFltrTableName = 'REE_TMP'
.head 5 -  Call cFltr.Init(sFltrTableName,sFltrTableName)
.head 3 +  On WM_Size
.head 4 -  Call GetClientRect( hWndForm, nClnX1, nClnY1, nClnX2, nClnY2 )
.head 4 -  Call SalSetWindowSize( hWndForm.frm_FilesNI.tblFTax,
	SalPixelsToFormUnits( hWndForm.frm_FilesNI.tblFTax, nClnX2-nClnX1, FALSE),
	SalPixelsToFormUnits( hWndForm.frm_FilesNI.tblFTax, nClnY2-nClnY1, TRUE))
.head 3 +  On SAM_Destroy
.head 4 -  ! ! ! Disactivation of  function's role, which activated for calling window
.head 4 +  If SalStrTrimX(SalStrUpperX(GetDBMS())) = 'ORACLE'
.head 5 -  Call XRoleUnset(hSql(),'ShowFilesNI(hWndMDI)')
.head 1 +  Form Window: frm_FilesTM
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Файловый обмен с ДСМУ
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? Yes
.head 2 -  Visible? No
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Yes
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.44"
.head 4 -  Top:    0.367"
.head 4 -  Width:  13.533"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 7.25"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Формирование файлов обмена с ДМСУ
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: 0.69"
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Contents
.head 4 -  Group Box: Дата отчета
.head 5 -  Resource Id: 9423
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Window Location and Size
.head 6 -  Left:   0.133"
.head 6 -  Top:    0.107"
.head 6 -  Width:  1.7"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.521"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: 3D Shadow Color
.head 5 -  Background Color: Default
.head 4 +  Data Field: dfDat
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Data
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Editable? Yes
.head 5 -  Display Settings
.head 6 -  Window Location and Size
.head 7 -  Left:   0.233"
.head 7 -  Top:    0.31"
.head 7 -  Width:  1.483"
.head 7 -  Width Editable? Yes
.head 7 -  Height: 0.25"
.head 7 -  Height Editable? Yes
.head 6 -  Visible? Yes
.head 6 -  Border? Yes
.head 6 -  Justify: Center
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Font Name: Default
.head 6 -  Font Size: Default
.head 6 -  Font Enhancement: Default
.head 6 -  Text Color: Default
.head 6 -  Background Color: System Window Color
.head 6 -  Input Mask: Unformatted
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set dfDat=dBDat
.head 7 -  Call SalSendMsg( hWndItem, SAM_Validate, 0, 0 )
.head 6 +  On SAM_Validate
.head 7 +  If SalIsValidDateTime( dfDat)
.head 8 -  Set dDat1=dfDat
.head 8 -  Set sDat1=SalFmtFormatDateTime(dDat1, 'MM-dd-yyyy')
.head 8 -  Return VALIDATE_Ok
.head 7 -  Return VALIDATE_Cancel
.head 4 +  Pushbutton: pbExecute
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbExecute
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   1.883"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Наполнить таблицу данными для отчета'
.head 6 +  On SAM_Click
.head 7 -  Call SalSendMsg( tblFTax, UM_Populate, 0, 0 )
.head 4 -  Group Box: Сформированный файл
.head 5 -  Resource Id: 9424
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Window Location and Size
.head 6 -  Left:   2.5"
.head 6 -  Top:    0.107"
.head 6 -  Width:  4.783"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.524"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: 3D Shadow Color
.head 5 -  Background Color: Default
.head 4 +  Check Box: cbUseFormed
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: .
.head 5 -  Window Location and Size
.head 6 -  Left:   2.583"
.head 6 -  Top:    0.31"
.head 6 -  Width:  0.35"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set MyValue = FALSE
.head 7 -  Call SalDisableWindow( pbChooseOne )
.head 7 -  ! Call SalDisableWindow( pbRefresh )
.head 6 +  On SAM_Click
.head 7 +  If MyValue
.head 8 -  Call SalDisableWindow( pbExecute )
.head 8 -  Call SalDisableWindow( pbHardDelete )
.head 8 -  Call SalEnableWindow( pbChooseOne )
.head 8 -  Call SalEnableWindow( pbRefresh )
.head 8 -  Call SalShowWindow( tblFTax.ERR )
.head 8 +  If dfFileName != ''
.head 9 -  Call SalSendMsg( pbRefresh, SAM_Click, 0, 0 )
.head 7 +  Else
.head 8 -  Call SalEnableWindow( pbExecute )
.head 8 -  Call SalEnableWindow( pbHardDelete )
.head 8 -  Call SalDisableWindow( pbChooseOne )
.head 8 -  Call SalDisableWindow( pbRefresh )
.head 8 -  Call SalHideWindow( tblFTax.ERR )
.head 8 -  Set dfFileName = ''
.head 8 -  Call SalSendMsg( tblFTax, UM_Populate, 0, 0 )
.head 4 +  Check Box: cbTypeForm
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title: 1 строка - 1 файл
.head 5 -  Window Location and Size
.head 6 -  Left:   8.083"
.head 6 -  Top:    0.226"
.head 6 -  Width:  2.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.345"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set MyValue = FALSE
.head 6 -  On SAM_Click
.head 4 +  Data Field: dfFileName
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Data
.head 6 -  Maximum Data Length: 12
.head 6 -  Data Type: String
.head 6 -  Editable? No
.head 5 -  Display Settings
.head 6 -  Window Location and Size
.head 7 -  Left:   2.933"
.head 7 -  Top:    0.31"
.head 7 -  Width:  2.067"
.head 7 -  Width Editable? Yes
.head 7 -  Height: 0.25"
.head 7 -  Height Editable? Yes
.head 6 -  Visible? Yes
.head 6 -  Border? Yes
.head 6 -  Justify: Right
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Font Name: Default
.head 6 -  Font Size: Default
.head 6 -  Font Enhancement: Default
.head 6 -  Text Color: Default
.head 6 -  Background Color: 3D Highlight Color
.head 6 -  Input Mask: Unformatted
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbChooseOne
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbDetail
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   5.133"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Выбрать файл из уже сформированных'
.head 6 +  On SAM_Click
.head 7 +  If SalModalDialog( dlg_ChooseNIFile, hWndForm, 10, smTmpStr, strFileChoosen, dtChoosen )
.head 8 -  Set dfFileName = strFileChoosen
.head 8 -  Call SalSendMsg( pbRefresh, SAM_Click, 0, 0 )
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbRefresh
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   5.567"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Перечитать файл'
.head 6 +  On SAM_Click
.head 7 -  ! populate table with data from storage table
.head 7 -  Call SalWaitCursor( TRUE )
.head 7 +  If strFileChoosen
.head 8 -  Call SalWaitCursor( TRUE )
.head 8 -  Set strTabLines = 'LINES_M'
.head 8 -  Set strFormedVar  = 'VDAT, RNK, NMK, OKPO, NLS, KV, NUM_V, DAT_V, REF, S, FDAT,ERR'
.head 8 -  Set strFormedInto = ':tblFTax.VDAT, :tblFTax.RNK, :tblFTax.NMK, :tblFTax.OKPO,
  :tblFTax.NLS, :tblFTax.KV, :tblFTax.NUM_V, :tblFTax.DAT_V, :tblFTax.REF, :tblFTax.S, :tblFTax.FDAT, :tblFTax.ERR'
.head 8 -  Call SalTblPopulate( tblFTax, hSql(),
T('SELECT ' || strFormedVar || ' INTO ' || strFormedInto || ' FROM ' || strTabLines ||
' WHERE fn = :strFileChoosen AND dat = :dtChoosen ORDER BY nn'), TBL_FillAll )
.head 8 -  Call SalWaitCursor( FALSE )
.head 7 +  Else
.head 8 -  Call SalSendMsg( tblFTax, UM_Populate, 0, 0 )
.head 7 -  Call SalWaitCursor( FALSE )
.head 4 +  Pushbutton: pbInsert
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbInsert
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   6.267"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\Insert.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Добавить запись'
.head 6 +  On SAM_Click
.head 7 -  Set nRow = SalTblInsertRow(hWndForm.frm_FilesTM.tblFTax, TBL_MaxRow)
.head 7 -  Call SalTblSetContext(hWndForm.frm_FilesTM.tblFTax, nRow)
.head 7 -  Call SalTblSetFocusCell(hWndForm.frm_FilesTM.tblFTax, nRow,
     GetFirstEditableColumn(hWndForm.frm_FilesTM.tblFTax), 0, 1)
.head 4 +  Pushbutton: pbDelete
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbBrowse
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   6.7"
.head 6 -  Top:    0.24"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\Delete.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Пометить запись на удаление'
.head 6 +  On SAM_Click
.head 7 -  Set nRow = TBL_MinRow
.head 7 +  While SalTblFindNextRow( hWndForm.frm_FilesTM.tblFTax, nRow, ROW_Selected, 0 )
.head 8 -  Call SalTblSetContext( hWndForm.frm_FilesTM.tblFTax, nRow )
.head 8 -  Call SalTblDeleteRow( hWndForm.frm_FilesTM.tblFTax, nRow, TBL_NoAdjust )
.head 8 -  Set nRow = nRow - 1
.head 4 +  Pushbutton: pbHardDelete
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbDelete
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   7.25"
.head 6 -  Top:    0.24"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? No
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Пометить запись на удаление из БД'
.head 6 +  On SAM_Click
.head 7 +  If SalMessageBox( 'Отмеченные записи будут удалены из БД.
Продолжить?', 'Внимание!', MB_YesNo|MB_IconQuestion ) = IDNO
.head 8 -  Return TRUE
.head 7 -  Set nRow = TBL_MinRow
.head 7 +  While SalTblFindNextRow( hWndForm.frm_FilesTM.tblFTax, nRow, ROW_Selected, 0 )
.head 8 -  Call SalTblSetContext( hWndForm.frm_FilesTM.tblFTax, nRow )
.head 8 -  ! Call SalTblDeleteRow( hWndForm.frm_FilesTM.tblFTax, nRow, TBL_NoAdjust )
.head 8 -  Call SalTblDeleteRow( hWndForm.frm_FilesTM.tblFTax, nRow, TBL_NoAdjust )
.head 7 -  Call SqlCommit( hSql() )
.head 4 +  Pushbutton: pbForm
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbUpdate
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   10.4"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \Bars98\RESOURCE\BMP\Tomail.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Сформировать файл '
.head 6 +  On SAM_Click
.head 7 -  Call SalWaitCursor( TRUE )
.head 7 -  ! Sort table
.head 7 -  ! Get the number of row
.head 7 -  Set nRec = 0
.head 7 -  Set nRow = TBL_MinRow
.head 7 +  While SalTblFindNextRow( tblFTax, nRow, 0, ROW_MarkDeleted )
.head 8 -  Set nRec = nRec + 1
.head 7 -  ! Get the Number of Current File
.head 7 -  Set nFileNum = 0
.head 7 -  Set strAttrDate = 'FTM_DATE'
.head 7 -  Set strAttrNum  = 'FTM_SEQ'
.head 7 +  If SqlPrepareAndExecute(hSql(),
'SELECT ' || strAttrDate || ',' || strAttrNum ||
'  INTO :dtLastTime, :nFileNum ' ||
'  FROM DPA_FILE_COUNTERS' )
.head 8 -  Call SqlFetchNext( hSql(), nFetchRes )
.head 7 +  If nFileNum = NUMBER_Null OR dtLastTime != SalFmtFormatStrDateTime( SalFmtFormatDateTime( SalDateCurrent(), 'dd/MM/yyyy' ), 'dd/MM/yyyy')
.head 8 -  Set nFileNum = 0
.head 7 -  Set nFileNum = nFileNum + 1
.head 7 -  !
.head 7 -  ! Create file names
.head 7 -  Set strFileName = 'MK0'|| Subs(GetBankSab(),2,3) ||
    GetCharForDigit(SalDateMonth(SalDateCurrent())) || GetCharForDigit(SalDateDay(SalDateCurrent())) || '.'
.head 7 -  Set strFileName = strFileName || Right(Str(SalDateYear(SalDateCurrent())),1)
.head 7 -  Set strFileName = strFileName || Right( '00' || Str(nFileNum ), 2)
.head 7 -  Set Rep_PathDst = Rep_TMExp || '\\' || strFileName
.head 7 -  ! Set Rep_PathTmp = GetPrnDir() || '\\' || strFileName
.head 7 -  !
.head 7 -  Call SalWaitCursor( FALSE )
.head 7 -  ! Get confirmation from user
.head 7 +  If MessageQuestion('Сформировать файл ' || Rep_PathDst || ' ?') = IDNO
.head 8 -  Return FALSE
.head 7 -  !
.head 7 -  ! Create files
.head 7 -  Set fRet = FunCreateFile( Rep_PathDst )
.head 7 -  !
.head 7 -  ! Update file number sequence
.head 7 +  If fRet
.head 8 +  If NOT fPreserveFileName
.head 9 +  If SqlPrepareAndExecute( hSql(),
'UPDATE DPA_FILE_COUNTERS SET ' || strAttrDate || '=' ||
DateInQuery( SalFmtFormatDateTime( SalDateCurrent(), 'MM/dd/yyyy' ) ) || ',' ||
strAttrNum || '= :nFileNum')
.head 10 -  Call SqlCommitEx(hSql(), 'Обновление очередного номера файла ' || strAttrNum || ' на ' || SalNumberToStrX(nFileNum,0))
.head 8 -  Set dfFileName = ''
.head 8 -  Call SalEnableWindow( pbExecute )
.head 8 -  Call SalEnableWindow( pbHardDelete )
.head 8 -  Call SalDisableWindow( pbChooseOne )
.head 8 -  Call SalDisableWindow( pbRefresh )
.head 8 -  Set cbUseFormed = FALSE
.head 8 -  Call SalTblReset( tblFTax )
.head 4 +  Pushbutton: pbDetPrint
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbPrint
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   10.843"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\print.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Напечатать файл с расшифровкой реквизитов'
.head 6 +  On SAM_Click
.head 7 -  Set strFileName = sFileTip[nTip] || GetGlobalOption('AREACODE') || Subs(GetBankSab(),2,3) ||
    GetCharForDigit(SalDateMonth(SalDateCurrent())) || GetCharForDigit(SalDateDay(SalDateCurrent()))
.head 7 +  If cbUseFormed and dfFileName
.head 8 -  Set strFileName = dfFileName
.head 7 -  Call TablePrint( tblFTax, 'Отчет для '||sNam||' файл ' || strFileName ||
 ' за ' || sDat1, GetPrnDir() || '\\' ||strFileName || '.TXT', '' )
.head 4 +  Pushbutton: pbGetTickets
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbUpdate
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   11.271"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\chkmail.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Обработать квитанции для файлов'
.head 6 +  On SAM_Click
.head 7 -  Set Rep_TMask = 'ML*.*'
.head 7 -  Set strTabZag = 'ZAG_M'
.head 7 -  Set strTabLines = 'LINES_M'
.head 7 -  Call ShowDpaTickets(hWndMDI, TRUE, Rep_Tickets, Rep_TMask, strTabZag, strTabLines )
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbCancel
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   11.857"
.head 6 -  Top:    0.238"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Завершить работу функции'
.head 6 +  On SAM_Click
.head 7 -  Call SalDestroyWindow (hWndForm)
.head 4 +  Pushbutton: pbHiden
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbSynchro
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? No
.head 5 -  Keyboard Accelerator: F8
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Сформировать файл @B'
.head 6 +  On SAM_Click
.head 7 +  If nTip=3
.head 8 -  ! Get the Number of Current File
.head 8 -  Set nFileNum = 0
.head 8 -  Set strAttrDate = 'TAXB_DATE'
.head 8 -  Set strAttrNum  = 'TAXB_SEQ'
.head 8 +  If SqlPrepareAndExecute(hSql(), 'SELECT ' || strAttrDate || ',' || strAttrNum ||
' INTO :dtLastTime, :nFileNum FROM DPA_FILE_COUNTERS' )
.head 9 -  Call SqlFetchNext( hSql(), nFetchRes )
.head 8 +  If nFileNum = NUMBER_Null OR dtLastTime != SalFmtFormatStrDateTime( SalFmtFormatDateTime( SalDateCurrent(), 'dd/MM/yyyy' ), 'dd/MM/yyyy')
.head 9 -  Set nFileNum = 0
.head 8 -  Set nFileNum = nFileNum + 1
.head 8 -  !
.head 8 -  ! Create file names
.head 8 -  Set strFileName = sFileTip[nTip] || GetGlobalOption('AREACODE') || Subs(GetBankSab(),2,3) ||
    GetCharForDigit(SalDateMonth(SalDateCurrent())) || GetCharForDigit(SalDateDay(SalDateCurrent())) || '.'
.head 8 -  Set strFileName = strFileName || Right( '000' || Str(nFileNum ), 3)
.head 8 -  Set Rep_PathDst = Rep_PathNI || '\\' || strFileName
.head 8 -  Set Rep_PathTmp = GetPrnDir() || '\\' || strFileName
.head 8 -  !
.head 8 -  ! Get confirmation from user
.head 8 +  If MessageQuestion('Сформировать файлы @B в каталог ' || Rep_PathNI || ' ?') = IDNO
.head 9 -  Return FALSE
.head 8 -  !
.head 8 -  ! Create files
.head 8 -  ! MY -- Set fRet =  FunCreateTaxDocFile2( Rep_PathDst)
.head 8 -  !
.head 8 -  ! Update file number sequence
.head 8 +  If fRet
.head 9 +  If SqlPrepareAndExecute( hSql(),'UPDATE DPA_FILE_COUNTERS SET ' || strAttrDate || '=' ||
DateInQuery( SalFmtFormatDateTime( SalDateCurrent(), 'MM/dd/yyyy' ) ) || ',' ||
strAttrNum || '= :nFileNum')
.head 10 -  Call SqlCommitEx(hSql(), 'Обновление очередного номера файла ' || strAttrNum || ' на ' || SalNumberToStrX(nFileNum,0))
.head 2 +  Contents
.head 3 +  Child Table: tblFTax
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.0"
.head 6 -  Top:    0.0"
.head 6 -  Width:  12.483"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 5.619"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Black
.head 5 -  Background Color: System Window Color
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 30000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 -  ! Для ^F и @F
.head 5 +  Column: VDAT
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата
операции
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Left
.head 6 -  Width:  1.333"
.head 6 -  Width Editable? Yes
.head 6 -  Format: dd/MM/yyyy
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: RNK
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: РНК
клиента
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  1.217"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NMK
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наименование
клиента
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? Yes
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: OKPO
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Идент.
номер
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NLS
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Счет
клиента
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 14
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: KV
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вал
юта
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 3
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.543"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 -  ! Для @B
.head 5 +  Column: NUM_V
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Номер
векселя
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 10
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.367"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: S
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Сумма
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 15
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  1.733"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: REF
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Реф
А
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 -  !
.head 5 -  ! ЦВК
.head 5 +  ! Column: MFOA
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  1.15"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 +   Case 8
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: NLSA
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  1.15"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 +   Case 8
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: MFOB
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  1.15"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 +   Case 8
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: NLSB
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  1.15"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 +   Case 8
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: DK
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  1.15"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 +   Case 8
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: S
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  1.15"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 +   Case 8
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: VOB
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  1.15"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 +   Case 8
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: ND
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  1.15"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 +   Case 8
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: KV
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  1.15"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 +   Case 8
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: KV
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Способ
назн
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 2
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 -   Case 1
.head 9 -   Case 2
.head 9 -   Case 4
.head 9 -   Case 5
.head 9 +   Case 8
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: DATD
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  1.15"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 +   Case 8
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: DATP
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  1.15"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 +   Case 8
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: NAMA
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наименование клиента
А

.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 38
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 -   Case 1
.head 9 -   Case 2
.head 9 -   Case 4
.head 9 -   Case 5
.head 9 +   Case 8
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: NAMB
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наименование клиента
Б

.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 38
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 -   Case 1
.head 9 -   Case 2
.head 9 -   Case 4
.head 9 -   Case 5
.head 9 +   Case 8
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: NAZN
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Назначение платежа
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 166
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 -   Case 1
.head 9 -   Case 2
.head 9 -   Case 4
.head 9 -   Case 5
.head 9 +   Case 8
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: DREC
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Доп реквизиты
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 60
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 -   Case 1
.head 9 -   Case 2
.head 9 -   Case 4
.head 9 -   Case 5
.head 9 +   Case 8
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: NAZNK
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
назн
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 3
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 -   Case 1
.head 9 -   Case 2
.head 9 -   Case 4
.head 9 -   Case 5
.head 9 +   Case 8
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: NAZNS
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Способ
назн
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 2
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 -   Case 1
.head 9 -   Case 2
.head 9 -   Case 4
.head 9 -   Case 5
.head 9 +   Case 8
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: OKPOA
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Способ
назн
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 2
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 -   Case 1
.head 9 -   Case 2
.head 9 -   Case 4
.head 9 -   Case 5
.head 9 +   Case 8
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: OKPOB
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Способ
назн
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 2
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 -   Case 1
.head 9 -   Case 2
.head 9 -   Case 4
.head 9 -   Case 5
.head 9 +   Case 8
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: REF_A
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Реф
А
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 9
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 -   Case 1
.head 9 -   Case 2
.head 9 -   Case 4
.head 9 -   Case 5
.head 9 +   Case 8
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: DAT_A
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата
А
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Center
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 -   Case 1
.head 9 -   Case 2
.head 9 -   Case 4
.head 9 -   Case 5
.head 9 +   Case 8
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 5 +  ! Column: DAT_B
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата
Б
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Center
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -   List Values
.head 6 +   Message Actions
.head 7 +   On UM_ObjActivate
.head 8 +   Select Case nTip
.head 9 -   Case 1
.head 9 -   Case 2
.head 9 -   Case 4
.head 9 -   Case 5
.head 9 +   Case 8
.head 10 -   Call SalHideWindow( hWndItem )
.head 10 -   Break
.head 9 +   Default
.head 10 -   Call SalShowWindow( hWndItem )
.head 10 -   Break
.head 5 +  Column: DAT_V
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата
выдачи векселя
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Left
.head 6 -  Width:  1.783"
.head 6 -  Width Editable? Yes
.head 6 -  Format: dd/MM/yyyy
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: FDAT
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата
операции
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Left
.head 6 -  Width:  1.086"
.head 6 -  Width Editable? Yes
.head 6 -  Format: dd/MM/yyyy
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: ERR
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
Квитовки
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 4
.head 6 -  Data Type: String
.head 6 -  Justify: Right
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 +  Window Variables
.head 5 -  String: sNbsList1
.head 5 -  String: sNbsList2
.head 5 -  String: sNbsList3
.head 5 -  String: sNbsList4
.head 5 -  String: sNbsList5
.head 5 -  String: sNbsList6
.head 4 +  Message Actions
.head 5 +  On UM_Populate
.head 6 -  Call SalSendMsg( tblFTax, UM_ObjActivate, 0, 0 )
.head 6 -  Call SalWaitCursor(TRUE)
.head 6 -  Call SalTblDefineSplitWindow(hWndForm, 0, FALSE)
.head 6 +  If SalStrTrimX(SalStrUpperX(GetDBMS()))='ORACLE'
.head 7 +  If SqlPrepareAndExecute( hSql(), "BEGIN bars.P_Obrab_Queue; END;" )
.head 8 -  Call SqlCommitEx( hSql(), 'Выборка данных из очереди Q_VKS ')
.head 8 -  Set ss =
"SELECT v.REF, v.NLS, v.KV, v.VDAT, v.VKS_N, v.VKS_D, v.VKS_S, v.FDAT, v.rnk, c.nmk, c.okpo
   INTO :tblFTax.REF, :tblFTax.NLS, :tblFTax.KV, :tblFTax.VDAT,
        :tblFTax.NUM_V, :tblFTax.DAT_V,
        :tblFTax.S, :tblFTax.FDAT, :tblFTax.RNK, :tblFTax.NMK, :tblFTax.OKPO
  FROM VKS_TEMP v,
        CUSTOMER c
WHERE v.rnk=c.rnk AND
      trunc(v.vdat)=:dfDat and
      not exists (select 1
              from zag_m z, lines_m m
              where m.ref=v.ref and
                    m.fn=z.fn and
                    nvl(z.otm, 0)=5)"
.head 8 -  Call SalTblPopulate(tblFTax, hSql(), T(ss) , TBL_FillAll)
.head 6 -  Call SalWaitCursor(FALSE)
.head 5 +  On UM_ObjActivate
.head 6 -  Call SalSendMsgToChildren( hWndForm, UM_ObjActivate, wParam, lParam )
.head 2 +  Functions
.head 3 +  Function: f_truncate_date_2minute
.head 4 -  Description: Обрезать дату до минут
.head 4 +  Returns
.head 5 -  Date/Time:
.head 4 +  Parameters
.head 5 -  Date/Time: dtSrc
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nYear
.head 5 -  Number: nMonth
.head 5 -  Number: nDay
.head 5 -  Number: nHour
.head 5 -  Number: nMinute
.head 5 -  !
.head 4 +  Actions
.head 5 +  If dtSrc = DATETIME_Null
.head 6 -  Set dtSrc = SalDateCurrent()
.head 5 -  !
.head 5 -  Set nYear   = SalDateYear( dtSrc )
.head 5 -  Set nMonth  = SalDateMonth( dtSrc )
.head 5 -  Set nDay    = SalDateDay( dtSrc )
.head 5 -  Set nHour   = SalDateHour( dtSrc )
.head 5 -  Set nMinute = SalDateMinute( dtSrc )
.head 5 -  !
.head 5 -  Return SalDateConstruct( nYear, nMonth, nDay, nHour, nMinute, 0 )
.head 3 -  !
.head 3 -  !
.head 3 +  Function: sIni	        ! Инициализировать подпись
.head 4 -  Description: Инициализировать ЭЦП
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 +  Static Variables
.head 5 -  Boolean: bSignInited
.head 5 -  Number: nTim
.head 4 +  Local variables
.head 5 -  String: strDay
.head 5 -  Number: nDay
.head 5 -  Number: nErrorSign
.head 5 -  String: IdKey
.head 5 -  String: strErrorSign
.head 5 -  String: strPinCode
.head 5 -  Number: lTim
.head 4 +  Actions
.head 5 -  Set lTim=nTim
.head 5 -  Set nTim=SalDateHour( SalDateCurrent(  ) )*60+SalDateMinute( SalDateCurrent(  ) )
.head 5 +  If bSignInited and nTim-lTim<3
.head 6 -  Return TRUE
.head 5 -  ! If GetSignType()='NBU'
.head 5 -  Set nErrorSign=NUMBER_Null
.head 5 -  Set strPinCode=STRING_Null
.head 5 +  While TRUE
.head 6 +  If SalModalDialog( dlgAskPinCode, hWndForm, strPinCode )
.head 7 +  If bSignInited
.head 8 -  Set nErrorSign=CLOSE_ZAH()
.head 7 -  !
.head 7 -  ! Call MessageErrorEx( 'Параметр OpenKeyDir '||GetOpenKeyDir() )
.head 7 -  ! Call MessageErrorEx( 'Параметр SecretKeyDrv '||GetSecretKeyDrv())
.head 7 -  ! Call MessageErrorEx( 'Параметр strOperId '||strOperId)
.head 7 -  ! Call MessageErrorEx( 'Параметр KeyDate '||GetKeyDate())
.head 7 -  ! Call MessageErrorEx( 'Параметр PinCode '||strPinCode)
.head 7 -  !
.head 7 -  Set nErrorSign=INIT_ZAH( strOpenKeyDir, GetSecretKeyDrv(), strOperId, GetKeyDate(), strPinCode )
.head 7 -  !
.head 7 +  If nErrorSign= -70
.head 8 -  Call MessageErrorEx( '>> RSA. Последний день действия секретного ключа' )
.head 7 +  Else If nErrorSign> -77 And nErrorSign< -70
.head 8 -  Set nDay= - nErrorSign - 70
.head 8 +  If nDay=1
.head 9 -  Set strDay='день'
.head 8 +  Else If nDay=2 Or nDay=3 Or nDay=4
.head 9 -  Set strDay='дня'
.head 8 +  Else If nDay=5 Or nDay=6
.head 9 -  Set strDay='дней'
.head 8 -  Call MessageErrorEx( '>> RSA. Срок действия секретного ключа прекращается через ' || NumberToStr( nDay ) || ' ' || strDay )
.head 7 +  Else If nErrorSign!=0
.head 8 -  Break
.head 7 -  Call SaveInfoToLog( '>> RSA- инициализация - OK' )
.head 7 -  Set bSignInited=TRUE
.head 7 -  Return TRUE
.head 6 +  Else
.head 7 -  Break
.head 5 -  !
.head 5 +  If nErrorSign!=NUMBER_Null		     ! обработка ошибок ЭЦП
.head 6 -  Set strErrorSign='>> RSA. Ошибка инициализации ЭЦП ' || NumberToStr( nErrorSign )
.head 6 -  Call MessageErrorEx( strErrorSign )
.head 5 -  Return FALSE
.head 5 -  !
.head 5 -  ! //////////////////////////////////////////////////////////////////////////////////////////////////////////////
.head 3 +  Function: sFile         ! Подписать файл
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Number: nFile
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Long String: lsSignF
.head 5 -  Long String: lsSignZ
.head 5 -  !
.head 5 -  Number: nErrorSign
.head 5 -  String: strErrorSign
.head 5 -  Number: nN
.head 5 -  String: sN
.head 4 +  Actions
.head 5 -  Set lsSignF=SalStrRepeatX( ' ', 64 )
.head 5 -  Set lsSignZ=SalStrRepeatX( ' ', 64 )
.head 5 +  If NOT GetSignOn()	!  ЭЦП отключена - вернуть Пусто
.head 6 -  Return TRUE
.head 5 +  If sIni()
.head 6 -  Set sN='      '
.head 6 -  Call lllseek( nFile, 124, FILE_SeekBegin )
.head 6 -  Call llread( nFile, sN, 6 )
.head 6 -  Set nN = SalStrToNumber(sN)
.head 6 +  If nN > 0		! Подписываем файл со строками
.head 7 -  Set nErrorSign = RSA_ZAH0( 87, nFile, 1, 330, nN*129, 0, lsSignF, strOperId )
.head 7 +  If nErrorSign=0
.head 8 -  Call lllseek( nFile, 102+60, FILE_SeekBegin )
.head 8 -  Call llwrite( nFile, lsSignF, 64 )
.head 6 +  If nErrorSign=0
.head 7 -  Call lllseek( nFile, 102+60+64, FILE_SeekBegin )
.head 7 -  Call llwrite( nFile, strOperId, 6 )
.head 7 -  Set nErrorSign=RSA_ZAH0( 87, nFile, 1, 102, 162, 0, lsSignZ, strOperId )
.head 7 +  If nErrorSign=0
.head 8 -  Call lllseek( nFile, 102+162, FILE_SeekBegin )
.head 8 -  Call llwrite( nFile, lsSignZ, 64 )
.head 6 +  If nErrorSign=0
.head 7 -  Return TRUE
.head 6 +  Else
.head 7 -  Set strErrorSign='>> RSA. NBU - Ошибка наложения ЭЦП: ' || NumberToStr( nErrorSign )
.head 7 -  Call MessageAttention( strErrorSign )
.head 5 -  Return FALSE
.head 3 +  Function: sLine		! Подписать строку
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sLine
.head 5 -  Receive Long String: lsSign
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nErrorSign
.head 5 -  String: strErrorSign
.head 5 -  Long String: lsLSign
.head 4 +  Actions
.head 5 -  Set lsLSign=SalStrRepeatX( ' ', 64 )
.head 5 +  If NOT GetSignOn()
.head 6 -  Return TRUE
.head 5 +  If sIni()
.head 6 -  Set nErrorSign = RSA_ZAH(87, -1, 1, sLine, SalStrLength(sLine), 0, lsLSign, strOperId)
.head 6 +  If nErrorSign=0
.head 7 -  Set lsSign = lsLSign
.head 7 -  Return TRUE
.head 6 +  Else
.head 7 -  Set strErrorSign='>> RSA. NBU - Ошибка наложения ЭЦП: ' || NumberToStr( nErrorSign )
.head 7 -  Call MessageAttention( strErrorSign )
.head 7 -  Set lsSign = ''
.head 5 -  Return FALSE
.head 3 -  !
.head 3 +  Function: FunCreateFile
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strFileName
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hDelFile
.head 5 -  String: strLine
.head 5 -  Number: nLength
.head 5 -  !
.head 5 -  String: szPureFileName
.head 5 -  Date/Time: dtCDat
.head 4 +  Actions
.head 5 -  Call SalWaitCursor( TRUE )
.head 5 -  Set nRec = 0
.head 5 -  Set hFile = llcreat(strFileName, 0)
.head 5 +  If hFile
.head 6 -  ! Регистрируем файл в заголовках
.head 6 -  Set dtCDat = f_truncate_date_2minute( SalDateCurrent())
.head 6 -  Set szPureFileName = Right( strFileName, 12 )
.head 6 -  Call SqlPrepareAndExecute(hSql(),'INSERT INTO ZAG_M (fn, dat) VALUES (:szPureFileName, :dtCDat)')
.head 6 -  ! Служебная строка
.head 6 -  Call llwrite( hFile, SalStrRepeatX( ' ', 100 ) || PutCrLf(), 102 )
.head 6 -  ! Заголовок
.head 6 -  Set nLength = 228
.head 6 -  Set strLine = Right(strFileName,12) ||
     SalFmtFormatDateTime(SalDateCurrent(), 'yyMMdd')   ||
     SalStrRightX('0'||SalFmtFormatDateTime(SalDateCurrent(), 'hhhhmm'),4) ||
     PadL(Str(nRec),6) ||
     PadL('0',16) || PadL('0',16) ||
     SalStrRepeatX(' ', 166) || PutCrLf()
.head 6 -  Call llwrite(hFile, strLine, nLength)
.head 6 -  !
.head 6 -  Set nRow = TBL_MinRow ! Сохранение информационных строк
.head 6 +  Loop
.head 7 +  If SalTblFindNextRow(tblFTax, nRow, 0, 0)
.head 8 -  Call SalTblFetchRow(tblFTax, nRow)
.head 8 -  Set nLength = 129
.head 8 -  Set nRec=nRec+1
.head 8 -  Set strLine = PadL(SalNumberToStrX(nRec,0), 6)||
	PadL(AMFO, 6)||
	PadL(tblFTax.OKPO,10) ||
	PadR(tblFTax.NUM_V,70) ||
	PadL(SalFmtFormatDateTime(tblFTax.DAT_V, 'yyyyMMdd' ),8) ||
	PadL(SalFmtFormatDateTime(tblFTax.VDAT, 'yyyyMMdd' ),8) ||
	PadL(SalNumberToStrX(tblFTax.S,0),19) ||
	PutCrLf()
.head 8 -  Call llwrite(hFile, strLine, nLength)
.head 8 -  Call SqlPrepareAndExecute(hSql(),'INSERT INTO LINES_M
 (FN, DAT, NN, VDAT, RNK, NMK, OKPO, NLS, KV, NUM_V, DAT_V, REF, S, FDAT)
 VALUES
 (:szPureFileName, :dtCDat, :nRec, :tblFTax.VDAT, :tblFTax.RNK, :tblFTax.NMK, :tblFTax.OKPO,
  :tblFTax.NLS, :tblFTax.KV, :tblFTax.NUM_V, :tblFTax.DAT_V, :tblFTax.REF, :tblFTax.S, :tblFTax.FDAT)')
.head 7 +  Else
.head 8 -  Break
.head 6 -  Call lllseek( hFile, 124, FILE_SeekBegin )
.head 6 -  Call llwrite( hFile, PadL(Str(nRec),6), 6 )
.head 6 -  !
.head 6 -  Call SalWaitCursor( FALSE )
.head 6 -  !
.head 6 +  If GetSignOn( )
.head 7 +  If NOT sFile( hFile )
.head 8 -  Call SalMessageBox( 'Не удалось подписать файл', 'Ошибка', MB_IconStop )
.head 8 -  Call llclose(hFile)
.head 8 -  Call SalFileOpen( hDelFile, strFileName, OF_Delete )
.head 8 -  Call SqlPrepareAndExecute(hSql(),'DELETE FROM ZAG_M WHERE fn = :szPureFileName AND dat = :dtCDat')
.head 8 -  Return FALSE
.head 6 -  !
.head 6 -  Call llclose(hFile)
.head 6 -  ! Call FunBackUpFile( strFileName, Rep_Backup, FALSE )
.head 6 -  Call SqlPrepareAndExecute(hSql(),'UPDATE ZAG_M SET n = :nRec WHERE fn = :szPureFileName AND dat = :dtCDat')
.head 6 +  ! If SalFileCopy( Rep_PathTmp, Rep_PathDst, TRUE ) = FILE_CopyOK
.head 7 +   If Rep_PathTmp != Rep_PathDst
.head 8 -   Call SalFileOpen( hDelFile, strFileName, OF_Delete )
.head 6 +  ! Else
.head 7 -   Call SalMessageBox( 'Не удалось скопировать временный файл в ' || Rep_PathDst, 'Ошибка', MB_IconStop )
.head 7 -   Call SalFileOpen( hDelFile, strFileName, OF_Delete )
.head 7 -   Return FALSE
.head 6 -  Call MessageInfoEx('Файл ' || Rep_PathDst || ' сформирован.')
.head 6 -  Return TRUE
.head 5 +  Else If hFile<=0
.head 6 -  Call MessageInfoEx( 'Ошибка создания файла ' || strFileName )
.head 6 -  Return FALSE






.head 3 +  Function: GetFirstEditableColumn
.head 4 -  Description: Получить первую редактируюмую колонку
.head 4 +  Returns
.head 5 -  Window Handle:
.head 4 +  Parameters
.head 5 -  Window Handle: hWndTbl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nCol
.head 5 -  Window Handle: hWndCol
.head 4 +  Actions
.head 5 -  Set nCol=1
.head 5 +  Loop
.head 6 -  Set hWndCol = SalTblGetColumnWindow(hWndTbl, nCol,    COL_GetPos)
.head 6 +  If hWndCol = hWndNULL
.head 7 -  Break
.head 6 +  If SalTblQueryColumnFlags(hWndCol, COL_Editable) and   SalIsWindowVisible(hWndCol)
.head 7 -  Break
.head 6 -  Set nCol = nCol + 1
.head 5 -  Return hWndCol
.head 2 +  Window Parameters
.head 3 -  String: strTypeList
.head 2 +  Window Variables
.head 3 -  String: AMFO
.head 3 -  Date/Time: dBDat
.head 3 -  String: ss
.head 3 -  !
.head 3 -  String: sFileTip[1:9]
.head 3 -  String: sTypes[*]
.head 3 -  String: smTmpStr[1:9]
.head 3 -  Number: nTypes
.head 3 -  Number: nIndex
.head 3 -  Number: nT
.head 3 -  String: sListEntry
.head 3 -  String: sParF
.head 3 -  !
.head 3 -  String: sStart
.head 3 -  String: sFinish
.head 3 -  String: sDat1
.head 3 -  Date/Time: dDat1
.head 3 -  Date/Time: dtChoosen
.head 3 -  String: strFileName
.head 3 -  String: strFileChoosen
.head 3 -  Number: nRec
.head 3 -  String: Rep_PathNI
.head 3 -  String: Rep_PathNB
.head 3 -  String: Rep_PathTmp
.head 3 -  String: Rep_PathDst
.head 3 -  String: Rep_Backup
.head 3 -  String: Rep_Tickets
.head 3 -  String: Rep_TMask
.head 3 -  !
.head 3 -  String: Rep_TMExp
.head 3 -  String: Rep_TMImp
.head 3 -  !
.head 3 -  Number: hFile
.head 3 -  Number: nRow
.head 3 -  String: strOperId
.head 3 -  String: strOperId1
.head 3 -  String: strOpenKeyDir
.head 3 -  Number: nTip
.head 3 -  String: sNam
.head 3 -  !
.head 3 -  Number: nFileNum
.head 3 -  Date/Time: dtLastTime
.head 3 -  String: strAttrDate
.head 3 -  String: strAttrNum
.head 3 -  String: strTabZag
.head 3 -  String: strTabLines
.head 3 -  String: strFormedVar
.head 3 -  String: strFormedInto
.head 3 -  !
.head 3 -  Boolean: fRet
.head 3 -  Boolean: fPreserveFileName
.head 3 -  !
.head 3 -  Number: nClnX1
.head 3 -  Number: nClnY1
.head 3 -  Number: nClnX2
.head 3 -  Number: nClnY2
.head 3 -  String: strSignType
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call WaitCursorOn()
.head 4 -  Call XSalTooltipSetUserDefault(  )
.head 4 -  Call SetWindowFullSize( hWndForm )
.head 4 -  Call SetWindowFont( hWndForm )
.head 4 -  !
.head 4 -  Set dBDat=GetBankDate()
.head 4 -  Set AMFO=GetBankMfo()
.head 4 -  Set nTip=9
.head 4 -  !
.head 4 -  Set strOperId1 = SalStrRightX(SalStrUpperX(SalStrTrimX(GetBankSab())),3) || 'RVV'
.head 4 -  ! ***** Debug *****
.head 4 -  ! Set strOperId = '1QKBB1'
.head 4 -  ! ***** Debug *****
.head 4 -  ! Rep_TMExp
.head 4 -  Call SalUseRegistry(FALSE, '')
.head 4 -  Call SalGetProfileString( INI_Directory, 'NBURegistry', GetPrnDir(), Rep_PathNB, GetIniFileName() )
.head 4 -  Call SalGetProfileString( INI_Directory, 'TaxRegistry', GetPrnDir(), Rep_PathNI, GetIniFileName() )
.head 4 -  Call SalGetProfileString( INI_Directory, 'BackupDir',   GetPrnDir(), Rep_Backup, GetIniFileName() )
.head 4 -  Call SalGetProfileString( INI_Directory, 'TicketsDir',  GetPrnDir(), Rep_Tickets, GetIniFileName() )
.head 4 -  !
.head 4 -  Call SalGetProfileString( INI_Directory, 'PathImpTM',  GetPrnDir(),  Rep_TMImp, GetIniFileName() )
.head 4 -  Call SalGetProfileString( INI_Directory, 'PathExpTM',  GetPrnDir(),  Rep_TMExp, GetIniFileName() )
.head 4 -  Call SalGetProfileString( INI_DigitalSignature, 'TMSecretKey',  strOperId1,  strOperId, GetIniFileName() )
.head 4 -  Call SalGetProfileString( INI_DigitalSignature, 'SignType', '', strSignType, GetIniFileName() )
.head 4 -  !
.head 4 +  If strSignType = 'UNI'
.head 5 -  Call SalGetProfileString( INI_DigitalSignature, 'OpenKeyNBU', '', strOpenKeyDir, GetIniFileName())
.head 4 +  Else
.head 5 -  Call SalGetProfileString( INI_DigitalSignature, 'OpenKey', '', strOpenKeyDir, GetIniFileName())
.head 3 +  On SAM_CreateComplete
.head 4 -  Call WaitCursorOff()
.head 3 +  On WM_Size
.head 4 -  Call GetClientRect( hWndForm, nClnX1, nClnY1, nClnX2, nClnY2 )
.head 4 -  Call SalSetWindowSize( hWndForm.frm_FilesTM.tblFTax,
	SalPixelsToFormUnits( hWndForm.frm_FilesTM.tblFTax, nClnX2-nClnX1, FALSE),
	SalPixelsToFormUnits( hWndForm.frm_FilesTM.tblFTax, nClnY2-nClnY1, TRUE))
.head 3 +  On SAM_Destroy
.head 4 -  ! ! ! Disactivation of  function's role, which activated for calling window
.head 4 +  If SalStrTrimX(SalStrUpperX(GetDBMS())) = 'ORACLE'
.head 5 -  Call XRoleUnset(hSql(),'ShowFilesNI(hWndMDI)')
.head 1 +  Form Window: frm_TicketsNI
.head 2 -  Class: cSplitterWindow
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Обробка файлів-квитанцій
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? Yes
.head 2 -  Visible? No
.head 2 -  Display Settings
.head 3 -  Display Style? Class Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Class Default
.head 3 -  Initial State: Class Default
.head 3 -  Maximizable? Class Default
.head 3 -  Minimizable? Class Default
.head 3 -  System Menu? Class Default
.head 3 -  Resizable? Class Default
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  12.35"
.head 4 -  Width Editable? Class Default
.head 4 -  Height: 5.702"
.head 4 -  Height Editable? Class Default
.head 3 -  Form Size
.head 4 -  Width:  Class Default
.head 4 -  Height: Class Default
.head 4 -  Number of Pages: Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 2 -  Description: Обработка квитанций на файлы отчетов для НБУ и ДПА
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Class Default
.head 4 -  Location? Class Default
.head 4 -  Visible? Yes
.head 4 -  Size: 0.4"
.head 4 -  Size Editable? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 3 +  Contents
.head 4 +  Pushbutton: pbArc
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbFilter
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   0.1"
.head 6 -  Top:    0.05"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\ADDRESS.BMP
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 -  Set bArc = not bArc
.head 7 -  Call SetFields()
.head 7 -  Call SalTblReset(hWndForm)
.head 7 -  Call SalTblReset(tblTicRows)
.head 7 +  If bArc
.head 8 -  Call SalSendMsg(pbFilter, SAM_Click, 0, 0)
.head 7 +  Else
.head 8 -  Call SalSendMsg(pbRefresh, SAM_Click, 0, 0)
.head 6 +  On SAM_TooltipSetText
.head 7 +  If bArc
.head 8 -  Return XSalTooltipSetText(lParam, 'Прийом квитанцій')
.head 7 +  Else
.head 8 -  Return XSalTooltipSetText(lParam, 'Архів квитанцій')
.head 4 +  Pushbutton: pbFilter
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbFilter
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   0.567"
.head 6 -  Top:    0.048"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Фільтр'
.head 6 +  On SAM_Click
.head 7 +  If SetQueryFilter(tblTickets.cF)
.head 8 -  Call SalPostMsg(tblTickets, UM_Populate, 0, 0)
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbRefresh
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   1.017"
.head 6 -  Top:    0.048"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: F3
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Перечитати вміст каталога'
.head 6 +  On SAM_Click
.head 7 -  Call SalSendMsg(tblTickets, UM_Populate, 0, 0)
.head 4 +  Pushbutton: pbDeleteFile
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbDelete
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   1.567"
.head 6 -  Top:    0.048"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: F8
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Видалити файл'
.head 6 +  On SAM_Click
.head 7 +  If fReadWrite
.head 8 +  If SalTblAnyRows(tblTickets, ROW_Selected, 0)
.head 9 -  Set strCurrFile = strTicketsPath || '\\' || tblTickets.colTickName
.head 9 +  If SalMessageBox( 'Ви дійсно бажаєте видалити файл ' || strCurrFile || '?',
   'Увага!', MB_YesNo | MB_IconQuestion | MB_DefButton2 ) = IDYES
.head 10 -  Call FunBackUpFile( strCurrFile, strBackupDir, TRUE )
.head 10 +  If NOT SalFileOpen( hT, strCurrFile, OF_Delete )
.head 11 -  Call SalMessageBeep( MB_IconStop )
.head 11 -  Call SalMessageBox( 'Неможливо видалити файл ' || strCurrFile, 'Помилка!', MB_IconStop | MB_Ok )
.head 11 -  Call SaveErrorToLog( 'Невозможно удалить файл ' || strCurrFile )
.head 10 +  Else
.head 11 -  Call SalFileClose( hT )
.head 11 -  Call SalMessageBeep( MB_IconAsterisk )
.head 11 -  Call SalMessageBox( 'Файл ' || strCurrFile || ' видалено!', 'Квитовка', MB_IconStop | MB_Ok )
.head 11 -  Call SaveInfoToLog( 'Файл ' || strCurrFile || ' удален!' )
.head 11 -  Call SalTblReset( hWndForm.frm_TicketsNI.tblTicRows )
.head 11 -  Call SalSendMsg(tblTickets, SAM_Create, 0, 0)
.head 4 +  Pushbutton: pbProcessFile
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbExecute
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   2.0"
.head 6 -  Top:    0.048"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: F10
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 +  If strTicketsMask = '@R*.*'
.head 8 -  Set strTip = 'Обробити файл @R, створити квитанцію @S'
.head 7 +  Else If strTicketsMask = '@D*.*'
.head 8 -  Set strTip = 'Обробити файл @D, створити квитанцію @T'
.head 7 +  Else
.head 8 -  Set strTip = 'Обробити файл (заквітовать початковий)'
.head 6 +  On SAM_Click
.head 7 +  If fReadWrite
.head 8 +  If tblTickets.colTickName
.head 9 -  Set strCurrFile = tblTickets.colTickName
.head 9 -  !
.head 9 -  ! -- обработка файла
.head 9 +  If Len(strCurrFile) = 12
.head 10 +  If not FunProcessTicket(strTECode, nHNLines, strTFName, dtTFDate)
.head 11 -  Return FALSE
.head 9 +  Else
.head 10 +  If not FunProcessTicketXml(strCurrFile, sFileCodeError)
.head 11 -  Return FALSE
.head 10 -  ! для Аваль
.head 10 +  If nDPATTYPE = 1 or nDPATTYPE = 2
.head 11 +  If SalStrMidX(strCurrFile,2,1) = "2"
or SalStrMidX(strCurrFile,0,2) = "@R"
.head 12 +  If MessageQuestion("Сформувати файли квитанцій відділень ?") = IDYES
.head 13 -  Call CreateBranchTicketsOnXml(strCurrFile, tblTickets.colTickDate)
.head 9 -  !
.head 9 -  ! -- специальная обработка для Аваль
.head 9 +  If GetGlobalOption("DPATTYPE") = "1" AND strTicketsMask = '@IF*.*'
.head 10 +  If Len(strCurrFile) = 12
.head 11 -  Call FunProcessIF(strCurrFile)
.head 10 +  Else
.head 11 -  Call FunProcessIFOnXml(strCurrFile, sFileCodeError)
.head 9 -  !
.head 9 -  ! -- печать повідомлень
.head 9 +  If sDPAPRNTR and Subs(strCurrFile,2,1) = 'R'
or sDPAPRNTD and Subs(strCurrFile,2,1) = 'D'
.head 10 +  If SalMessageBox('Сформувати повідомлення по рахунках ?', 'Увага!', MB_IconQuestion | MB_YesNo) = IDYES
.head 11 +  If Len(strCurrFile) = 12
.head 12 -  Call CreateMessageFromDpa()
.head 11 +  Else
.head 12 -  Call CreateMessageFromDpaOnXml()
.head 9 -  !
.head 9 -  ! -- удаляем файл в архив
.head 9 +  If FunBackUpFile(strTicketsPath || '\\' || strCurrFile, strBackupDir, TRUE)
.head 10 -  Call SalFileOpen(hT, strTicketsPath || '\\' || strCurrFile, OF_Delete)
.head 10 -  Call SaveInfoToLog(DPA || 'Файл ' || strCurrFile || ' удален!')
.head 9 -  !
.head 9 -  Call SalTblReset(tblTicRows)
.head 9 -  Call SalSendMsg(tblTickets, UM_Populate, 0, 0)
.head 4 +  Pushbutton: pbBackupFile
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbUpdate
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   2.433"
.head 6 -  Top:    0.048"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: F5
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Зберегти файл в архіві дня'
.head 6 +  On SAM_Click
.head 7 +  If fReadWrite
.head 8 +  If tblTickets.colTickName
.head 9 -  Set strCurrFile = tblTickets.colTickName
.head 9 -  Call FunPrintTicket( strCurrFile )
.head 4 +  Pushbutton: pbPrintTicket
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbPrint
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   3.267"
.head 6 -  Top:    0.048"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Надрукувати квитанцію'
.head 6 +  On SAM_Click
.head 7 +  If tblTickets.colTickName
.head 8 -  Set strCurrFile = tblTickets.colTickName
.head 8 +  If SalMessageBox( 'Ви дійсно бажаєте роздрукувати файл ' || strCurrFile || '?',
   'Увага!', MB_YesNo | MB_IconQuestion | MB_DefButton2 ) = IDYES
.head 9 -  Call FunPrintTicket( strCurrFile )
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbCancel
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   3.933"
.head 6 -  Top:    0.048"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Esc
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Вийти'
.head 6 +  On SAM_Click
.head 7 -  Call SalDestroyWindow( hWndForm )
.head 4 +  Pushbutton: pbBranchTicketsDir
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbRelation
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   2.867"
.head 6 -  Top:    0.048"
.head 6 -  Width:  0.4"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Yes
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Файли квитанції відділень'
.head 6 +  On SAM_Click
.head 7 -  ! Реализованные типы квитанций
.head 7 -  ! 1 - АВАЛЬ
.head 7 +  If nDPATTYPE = 1 or nDPATTYPE = 2
.head 8 +  If Len(strCurrFile) = 12 or bArc
.head 9 +  If tblTickets.colTickName
.head 10 -  Set strCurrFile = tblTickets.colTickName
.head 9 +  Else
.head 10 -  Call SalMessageBox("Необхідно вибрати файл квитанції.", "Увага !", MB_IconExclamation | MB_Ok)
.head 10 -  Return FALSE
.head 9 +  If MessageQuestion("Сформувати файли квитанцій відділень ?") = IDNO
.head 10 -  Return FALSE
.head 9 +  If Len(strCurrFile) = 12
.head 10 -  Call CreateBranchTickets()
.head 9 +  Else
.head 10 -  Call CreateBranchTicketsOnXml(strCurrFile, tblTickets.colTickDate)
.head 7 +  Else
.head 8 -  Call SalMessageBox("У таблиці параметрів ОДБ відсутня інформація про тип квитанцій відділень (DPATTYPE).", "Увага !", MB_IconExclamation | MB_Ok)
.head 2 +  Contents
.head 3 +  Child Table: tblTickets
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    0.0"
.head 6 -  Width:  2.733"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 1.548"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 30000
.head 5 -  Discardable? Yes
.head 4 +  Contents
.head 5 +  Column: colTickName
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  3.2"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colTickDate
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Center
.head 6 -  Width:  2.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: DateTime
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: insRow
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  String: sTickName
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: nRow
.head 6 +  Actions
.head 7 -  Set nRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 7 -  Call SalTblSetRowFlags(hWndForm, nRow, ROW_New, FALSE)
.head 7 -  Call SalTblSetContext(hWndForm, nRow)
.head 7 -  Set colTickName = sTickName
.head 7 -  Return TRUE
.head 4 +  Window Variables
.head 5 -  : cQ
.head 6 -  Class: cGenQuery
.head 5 -  : cF
.head 6 -  Class: cGenFilter
.head 5 -  String: strSqlPopulate
.head 5 -  String: strFile[*]
.head 5 -  Number: nFiles
.head 5 -  Number: nFilesO
.head 5 -  Number: nIterator
.head 5 -  String: sBankMask
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalTblSetTableFlags(hWndForm, TBL_Flag_SingleSelection, TRUE)
.head 6 -  Call SalTblSetTableFlags(hWndForm, TBL_Flag_SuppressRowLines, TRUE)
.head 6 -  Call SalTblSetTableFlags(hWndForm, TBL_Flag_GrayedHeaders, FALSE)
.head 6 -  !
.head 6 +  If strTicketsMask='@R*.*' or strTicketsMask='@D*.*'
.head 7 -  Set strSqlPopulate = 
"select fn, dat
   into :hWndForm.tblTickets.colTickName, :hWndForm.tblTickets.colTickDate
   from zag_f
  where " || IifS(strTicketsMask='@R*.*', "fn like '@R%'    and ",
             IifS(strTicketsMask='@D*.*', "fn like '@D%'    and ", "")) || 
" dat > sysdate-364" ||
" order by dat desc"
.head 6 +  Else
.head 7 -  Set strSqlPopulate = 
"select fnk, dat
   into :hWndForm.tblTickets.colTickName, :hWndForm.tblTickets.colTickDate
   from zag_f
  where " || IifS(strTicketsMask='@IF*.*', "fnk like '@F2%'    and ",
             IifS(strTicketsMask='@IP*.*', "fnk like '@P2%'    and ", "")) || 
" dat > sysdate-364" ||
" order by dat desc"
.head 6 -  Call cF.Init("zag_f", "zag_f")
.head 6 -  Call cQ.Init(strSqlPopulate)
.head 5 +  On UM_Populate
.head 6 -  Call SalTblReset(hWndForm)
.head 6 -  Call SalTblReset(tblTicRows)
.head 6 -  Call SalWaitCursor(TRUE)
.head 6 -  Set sBankMask = '??'|| GetBankMfo()
.head 6 -  ! Архив квитанций @R/@D
.head 6 +  If bArc
.head 7 -  Call SalShowWindow(tblTickets.colTickDate)
.head 7 -  Call SalHideWindow(tblTicRows.colTag)
.head 7 -  Call SalTblPopulate(hWndForm, hSql(), cQ.GetFullSQLString(cF), TBL_FillAll)
.head 7 -  Call SalTblSetContext(hWndForm, 0)
.head 7 -  Call SalPostMsg(hWndForm, SAM_TblDoDetails, 0, 0)
.head 6 -  ! Обработка квитанций
.head 6 +  Else
.head 7 -  Call SalHideWindow(tblTickets.colTickDate)
.head 7 -  Call SalShowWindow(tblTicRows.colTag)
.head 7 -  ! Квитанции @I/@R/@D
.head 7 -  Set nFiles = VisDosEnumFiles(strTicketsPath || '\\' || strTicketsMask, FA_Standard, strFile)
.head 7 -  Set nIterator = 0
.head 7 +  While nIterator < nFiles
.head 8 +  If Len(strFile[nIterator]) = 12
.head 9 -  Call insRow(SalStrUpperX(strFile[nIterator]))
.head 8 -  Set nIterator = nIterator + 1
.head 7 -  !
.head 7 +  If strTicketsMask = '@IF*.*'
.head 8 -  ! Квитанция @OF на @F
.head 8 -  Set nFilesO = VisDosEnumFiles(strTicketsPath || '\\@OF*.*', FA_Standard, strFile)
.head 8 -  Set nIterator = 0
.head 8 +  While nIterator < nFilesO
.head 9 +  If Len(strFile[nIterator]) = 12
.head 10 -  Call insRow(SalStrUpperX(strFile[nIterator]))
.head 9 -  Set nIterator = nIterator + 1
.head 7 +  Else If strTicketsMask = '@R*.*'
.head 8 -  ! Квитанция @OR на @RF
.head 8 -  Set nFilesO = VisDosEnumFiles(strTicketsPath || '\\@OR*.*', FA_Standard, strFile)
.head 8 -  Set nIterator = 0
.head 8 +  While nIterator < nFilesO
.head 9 +  If Len(strFile[nIterator]) = 12
.head 10 -  Call insRow(SalStrUpperX(strFile[nIterator]))
.head 9 -  Set nIterator = nIterator + 1
.head 7 -  !
.head 7 -  ! xml
.head 7 +  If strTicketsMask = '@IF*.*'
.head 8 -  Set nFiles = VisDosEnumFiles(strTicketsPath || '\\' || '@F1'|| sBankMask ||'*', FA_Standard, strFile)
.head 8 -  Set nIterator = 0
.head 8 +  While nIterator < nFiles
.head 9 -  Call insRow(SalStrUpperX(strFile[nIterator]))
.head 9 -  Set nIterator = nIterator + 1
.head 8 -  Set nFiles = VisDosEnumFiles(strTicketsPath || '\\' || '@F2'|| sBankMask ||'*', FA_Standard, strFile)
.head 8 -  Set nIterator = 0
.head 8 +  While nIterator < nFiles
.head 9 -  Call insRow(SalStrUpperX(strFile[nIterator]))
.head 9 -  Set nIterator = nIterator + 1
.head 7 +  If strTicketsMask = '@IP*.*'
.head 8 -  Set nFiles = VisDosEnumFiles(strTicketsPath || '\\' || '@P1'|| sBankMask ||'*', FA_Standard, strFile)
.head 8 -  Set nIterator = 0
.head 8 +  While nIterator < nFiles
.head 9 -  Call insRow(SalStrUpperX(strFile[nIterator]))
.head 9 -  Set nIterator = nIterator + 1
.head 8 -  Set nFiles = VisDosEnumFiles(strTicketsPath || '\\' || '@P2'|| sBankMask ||'*', FA_Standard, strFile)
.head 8 -  Set nIterator = 0
.head 8 +  While nIterator < nFiles
.head 9 -  Call insRow(SalStrUpperX(strFile[nIterator]))
.head 9 -  Set nIterator = nIterator + 1
.head 7 +  If strTicketsMask = '@IK*.*'
.head 8 -  Set nFiles = VisDosEnumFiles(strTicketsPath || '\\' || '@K1'|| sBankMask ||'*', FA_Standard, strFile)
.head 8 -  Set nIterator = 0
.head 8 +  While nIterator < nFiles
.head 9 -  Call insRow(SalStrUpperX(strFile[nIterator]))
.head 9 -  Set nIterator = nIterator + 1
.head 8 -  Set nFiles = VisDosEnumFiles(strTicketsPath || '\\' || '@K2'|| sBankMask ||'*', FA_Standard, strFile)
.head 8 -  Set nIterator = 0
.head 8 +  While nIterator < nFiles
.head 9 -  Call insRow(SalStrUpperX(strFile[nIterator]))
.head 9 -  Set nIterator = nIterator + 1
.head 7 +  If strTicketsMask = '@R*.*'
.head 8 -  Set nFiles = VisDosEnumFiles(strTicketsPath || '\\' || '@R0'|| sBankMask ||'*.XML', FA_Standard, strFile)
.head 8 -  Set nIterator = 0
.head 8 +  While nIterator < nFiles
.head 9 -  Call insRow(SalStrUpperX(strFile[nIterator]))
.head 9 -  Set nIterator = nIterator + 1
.head 7 +  If strTicketsMask = '@D*.*'
.head 8 -  Set nFiles = VisDosEnumFiles(strTicketsPath || '\\' || '@D0'|| sBankMask ||'*.XML', FA_Standard, strFile)
.head 8 -  Set nIterator = 0
.head 8 +  While nIterator < nFiles
.head 9 -  Call insRow(SalStrUpperX(strFile[nIterator]))
.head 9 -  Set nIterator = nIterator + 1
.head 7 -  Call SalTblSetContext(hWndForm, 0)
.head 7 -  Call SalSendMsg(hWndForm, SAM_TblDoDetails, 0, 0)
.head 6 -  Call SalWaitCursor(FALSE)
.head 5 +  On SAM_TblDoDetails
.head 6 -  Call SalTblReset(tblTicRows)
.head 6 +  If colTickName
.head 7 -  Set strCurrFile = colTickName
.head 7 +  If nDPATTYPE = 0
.head 8 -  Call SalDisableWindow(pbBranchTicketsDir)
.head 8 +  If strTicketsMask = '@IK*.*'
.head 9 -  Call SalDisableWindow(pbArc)
.head 7 +  Else
.head 8 +  If Len(strCurrFile) = 12 or bArc
.head 9 -  Call SalEnableWindow(pbBranchTicketsDir)
.head 8 +  Else
.head 9 -  Call SalDisableWindow(pbBranchTicketsDir)
.head 7 +  If strTicketsMask = '@IF*.*'
.head 8 +  If Subs(colTickName,3,1) = '2'
.head 9 -  Call SalShowWindow(tblTicRows.colN)
.head 9 -  Call SalShowWindow(tblTicRows.colMfo)
.head 9 -  Call SalShowWindow(tblTicRows.colOkpo)
.head 9 -  Call SalShowWindow(tblTicRows.colTgr)
.head 9 -  Call SalShowWindow(tblTicRows.colNmkk)
.head 9 -  Call SalShowWindow(tblTicRows.colOType)
.head 9 -  Call SalShowWindow(tblTicRows.colODat)
.head 9 -  Call SalShowWindow(tblTicRows.colNls)
.head 9 -  Call SalShowWindow(tblTicRows.colKv)
.head 8 +  Else
.head 9 -  Call SalHideWindow(tblTicRows.colN)
.head 9 -  Call SalHideWindow(tblTicRows.colMfo)
.head 9 -  Call SalHideWindow(tblTicRows.colOkpo)
.head 9 -  Call SalHideWindow(tblTicRows.colTgr)
.head 9 -  Call SalHideWindow(tblTicRows.colNmkk)
.head 9 -  Call SalHideWindow(tblTicRows.colOType)
.head 9 -  Call SalHideWindow(tblTicRows.colODat)
.head 9 -  Call SalHideWindow(tblTicRows.colNls)
.head 9 -  Call SalHideWindow(tblTicRows.colKv)
.head 7 +  If bArc
.head 8 -  Call tblTicRows.PopulateFromArc(strCurrFile, colTickDate)
.head 7 +  Else
.head 8 +  If Len(strCurrFile) = 12
.head 9 -  Call FunReadTicket(strCurrFile)
.head 6 +  Else
.head 7 -  Set strCurrFile = ''
.head 5 +  On SAM_DoubleClick
.head 6 +  If fReadWrite
.head 7 -  Call SalSendMsg(pbProcessFile, SAM_Click, 0, 0)
.head 3 +  Custom Control: ccSplitter
.head 4 -  Class Child Ref Key: 1
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cSplitterWindow
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   3.833"
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  DLL Settings
.head 4 -  Message Actions
.head 3 +  Child Table: tblTicRows
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   4.85"
.head 6 -  Top:    1.643"
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.833"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 30000
.head 5 -  Discardable? Yes
.head 4 +  Contents
.head 5 +  Column: colTag		! Категорія
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Категорія
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Right
.head 6 -  Width:  2.15"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colErrCode	! Код помилки
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
помилки
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Right
.head 6 -  Width:  1.067"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDetails	! Пояснення
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Пояснення
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 254
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  7.2"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colN
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Рядок
файлу
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colMfo
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colOkpo
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: ОКПО
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colTgr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Тип гос.
реестра
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNmkk
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наименование
клиента
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colOType
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Тип
оп.
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.8"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colODat
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата
операции
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Center
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNls
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Счет
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colKv
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вал.
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colRezid
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Резидентность
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDatInDpa
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата получения
сообщения в ДПА
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Center
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDatAccDpa
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата взятия
счета на учет
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colPr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Причина
отказа
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colKodDpa
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код ДПА
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colKodDps
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код ДПС
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colId
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Идентификатор
записи
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNameF
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Имя @F
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colLineF
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Строка @F
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colLineR
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Строка @R
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: PopulateFromArc
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  String: sTickName
.head 7 -  Date/Time: dFileDate
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: nRow
.head 7 -  Number: nN
.head 7 -  String: sMfo
.head 7 -  String: sOkpo
.head 7 -  Number: nRType
.head 7 -  String: sNmkk
.head 7 -  Number: nOType
.head 7 -  Date/Time: dODate
.head 7 -  String: sNls
.head 7 -  Number: nKv
.head 7 -  Number: nResid
.head 7 -  Date/Time: dDatInDpa
.head 7 -  Date/Time: dDatAccDpa
.head 7 -  Number: nIdPr
.head 7 -  Number: nIdDpa
.head 7 -  Number: nIdDps
.head 7 -  String: sIdRec
.head 7 -  String: sFname
.head 7 -  Number: nFn
.head 7 -  String: sErr
.head 6 +  Actions
.head 7 -  Call SalWaitCursor(TRUE)
.head 7 -  ! Квитанция @I
.head 7 +  If Subs(sTickName,3,1) = '1' or Subs(sTickName,3,1) = '2'
.head 8 -  Call SqlPrepareAndExecute(hSql(), 
"select n, err, mfo, okpo, rtype, nmkk, otype, odate, nls, kv, resid
   into :nFn, :sErr, :sMfo, :sOkpo, :nRType, :sNmkk, :nOType, :dODate, :sNls, :nKv, :nResid
   from lines_f
  where fn_r = :sTickName
    and trunc(dat) = " || IifS(dFileDate=DATETIME_Null, 
        "(select max(trunc(dat)) from lines_f where fn_r = :sTickName)", 
        "trunc(:dFileDate)") )
.head 8 +  While SqlFetchNext(hSql(), nFetchRes)
.head 9 -  Set nRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 9 -  Call SalTblSetRowFlags(hWndForm, nRow, ROW_New, FALSE)
.head 9 -  Call SalTblSetContext(hWndForm, nRow)
.head 9 -  Set colN     = nFn
.head 9 -  Set colErrCode = sErr
.head 9 -  Set colMfo   = Val(sMfo)
.head 9 -  Set colOkpo  = sOkpo
.head 9 -  Set colTgr   = nRType
.head 9 -  Set colNmkk  = sNmkk
.head 9 -  Set colOType = nOType
.head 9 -  Set colODat  = dODate
.head 9 -  Set colNls   = sNls
.head 9 -  Set colKv    = nKv
.head 9 -  Set colRezid = nResid
.head 9 -  ! Наименование кода ошибки
.head 9 +  If SqlPrepareAndExecute(hSqlAux(), "SELECT substr(err_msg,1,100) INTO :colDetails FROM dpa_err_codes WHERE err_code = :sErr")
.head 10 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 7 -  ! Квитанция @R
.head 7 +  Else If Subs(sTickName,1,2) = '@R' or Subs(sTickName,1,2) = '@D'
.head 8 -  Call SqlPrepareAndExecute(hSql(), 
"select n, mfo, okpo, rtype, nmkk, odate, nls, kv, resid, 
        dat_in_dpa, dat_acc_dpa, id_pr, id_dpa, id_dps, id_rec, fn_f, n_f, err
   into :nN, :sMfo, :sOkpo, :nRType, :sNmkk, :dODate, :sNls, :nKv, :nResid,
        :dDatInDpa, :dDatAccDpa, :nIdPr, :nIdDpa, :nIdDps, :sIdRec, :sFname, :nFn, :sErr
   from lines_r
  where fn = :sTickName
    and trunc(dat) = " || IifS(dFileDate=DATETIME_Null, 
        "(select max(trunc(dat)) from zag_f where fn = :sTickName)", 
        "trunc(:dFileDate)"))
.head 8 +  While SqlFetchNext(hSql(), nFetchRes)
.head 9 -  Set nRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 9 -  Call SalTblSetRowFlags(hWndForm, nRow, ROW_New, FALSE)
.head 9 -  Call SalTblSetContext(hWndForm, nRow)
.head 9 -  Set colMfo   = Val(sMfo)
.head 9 -  Set colOkpo  = sOkpo
.head 9 -  Set colTgr   = nRType
.head 9 -  Set colNmkk  = sNmkk
.head 9 -  Set colODat  = dODate
.head 9 -  Set colNls   = sNls
.head 9 -  Set colKv    = nKv
.head 9 -  Set colRezid = nResid
.head 9 -  Set colDatInDpa  = dDatInDpa
.head 9 -  Set colDatAccDpa = dDatAccDpa
.head 9 -  Set colPr     = nIdPr
.head 9 -  Set colKodDpa = nIdDpa
.head 9 -  Set colKodDps = nIdDps
.head 9 -  Set colId     = sIdRec
.head 9 -  Set colNameF  = sFname
.head 9 -  Set colLineF  = nFn
.head 9 -  Set colLineR  = nN
.head 9 -  Set colErrCode = sErr
.head 9 -  ! Наименование кода ошибки
.head 9 +  If SqlPrepareAndExecute(hSqlAux(), "SELECT substr(err_msg,1,100) INTO :colDetails FROM dpa_err_codes WHERE err_code = :sErr")
.head 10 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 7 -  Call VisTblAutoSizeColumn(hWndForm, hWndNULL)
.head 7 -  Call SalWaitCursor(FALSE)
.head 7 -  Return TRUE
.head 4 -  Window Variables
.head 4 -  Message Actions
.head 2 +  Functions
.head 3 +  Function: SetFields
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If bArc
.head 6 -  Call SalEnableWindow(pbFilter)
.head 6 -  Call SalDisableWindow(pbDeleteFile)
.head 6 -  Call SalDisableWindow(pbProcessFile)
.head 6 -  Call SalDisableWindow(pbBackupFile)
.head 6 -  Call SalTblSetColumnTitle(tblTickets.colTickName, 'Архів')
.head 5 +  Else
.head 6 -  Call SalDisableWindow(pbFilter)
.head 6 -  Call SalEnableWindow(pbDeleteFile)
.head 6 -  Call SalEnableWindow(pbProcessFile)
.head 6 -  Call SalEnableWindow(pbBackupFile)
.head 6 -  Call SalTblSetColumnTitle(tblTickets.colTickName, strTicketsPath)
.head 5 -  Return TRUE
.head 3 +  Function: FunReadTicket
.head 4 -  Description: прочитать содержимое квитанции
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strFileName	! Имя файла-квитанции @IF/@RF
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hTick
.head 5 -  String: strHeader
.head 5 -  String: strLine
.head 5 -  Number: nBufSize
.head 5 -  Number: nLineSize
.head 5 -  !
.head 5 -  Number: nRow
.head 5 -  Number: nIterator
.head 5 -  !
.head 5 -  Number: nChar
.head 5 -  Number: i
.head 5 -  Boolean: bRet
.head 5 -  ! !!!!!!!!!!
.head 5 -  Number: nId
.head 5 -  String: sErr
.head 4 +  Actions
.head 5 +  If strTicketsMask = '@R*.*' and Subs(SalStrUpperX(strFileName), 1, 2) = '@R'
.head 6 -  Return FunReadTicketR(strFileName)
.head 5 +  If strTicketsMask = '@D*.*' and Subs(SalStrUpperX(strFileName), 1, 2) = '@D'
.head 6 -  Return FunReadTicketD(strFileName)
.head 5 -  Set strTFName = ''
.head 5 +  If NOT SalFileOpen(hTick, strTicketsPath || '\\' || strFileName, OF_Read | OF_Text)
.head 6 -  Call SalMessageBeep( MB_IconStop )
.head 6 -  Call SalMessageBox( 'Неможливо відкрити файл ' || strFileName, 'Помилка!', MB_IconStop | MB_Ok )
.head 6 -  Return FALSE
.head 5 -  !
.head 5 -  ! Проверить структуру файла
.head 5 -  ! Читаем первую строку файла
.head 5 +  If NOT SalFileGetStr(hTick, strLine, 10240)
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('(SLine) Помилка читання з файлу ' || strFileName, 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SalFileClose(hTick)
.head 6 -  Return FALSE
.head 5 -  ! Длина первой строки д.б. 100
.head 5 +  If strLine != SalStrRepeatX(' ', 100)
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('Порушення структури файлу! (Service Line)', 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SalFileClose(hTick)
.head 6 -  Return FALSE
.head 5 -  !
.head 5 -  ! Читаем строку заголовка
.head 5 -  ! Call SalFileSeek(hTick, 102, FILE_SeekBegin)
.head 5 +  If NOT SalFileGetStr(hTick, strHeader, 10240)
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('(Header) Помилка читання з файлу ' || strFileName, 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SalFileClose(hTick)
.head 6 -  Return FALSE
.head 5 -  ! Длина строки заголовка д.б. 328
.head 5 -  ! Call SalMessageBox( strHeader, 'Ошибка!', MB_IconStop | MB_Ok )
.head 5 +  If SalStrLength(strHeader) != 328
.head 6 -  Call SalMessageBeep( MB_IconStop )
.head 6 -  Call SalMessageBox( 'Порушення структури файлу! (Header Line) '||SalNumberToStrX(SalStrLength(strHeader), 0), 'Помилка!', MB_IconStop | MB_Ok )
.head 6 -  Call SalFileClose( hTick )
.head 6 -  Return FALSE
.head 5 -  ! Анализ строки заголовка:
.head 5 -  ! strHFName   - Найменування файла I (C 	12 	1 - 12 )
.head 5 -  Set strHFName = SalStrUpperX(SalStrLeftX(strHeader, 12))
.head 5 -  ! Проверка на совпадение имени файла и имени файла в заголовке
.head 5 +  If strHFName != strFileName
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('Неспівпадання імені файлу з іменем в заголовку! (Header Line)', 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SalFileClose(hTick)
.head 6 -  Return FALSE
.head 5 -  ! Длина информационнной строки квитанции @R=165, для остальных=10
.head 5 -  Set nLineSize = IifN(Subs(strHFName,2,1)='R', 165, 10)
.head 5 -  ! dtHFDate    - Дата та час створення файла I (D 	10 	13 - 22 )
.head 5 -  Set dtHFDate  = SalFmtFormatStrDateTime(SalStrMidX(strHeader, 12, 10), 'yyMMddhhmm')
.head 5 -  ! nHNLines    - Кількість інформаційних рядків у файлі I (N 	6 	23 - 28 )
.head 5 -  Set nHNLines  = SalStrToNumber(SalStrMidX(strHeader, 22, 6))
.head 5 -  ! strTFName   - Найменування файла, що квитується (C 	12 	131 - 142 )
.head 5 -  Set strTFName = SalStrUpperX(SalStrMidX(strHeader, 130, 12))
.head 5 -  ! dtTFDate    - Дата та час створення файла, що квитується (D 	10 	143 - 152 )
.head 5 +  If SalStrMidX(strHeader, 142, 10) = SalStrRepeatX(' ', 10)
.head 6 -  Set dtTFDate = DATETIME_Null
.head 5 +  Else
.head 6 -  Set dtTFDate = SalFmtFormatStrDateTime(SalStrMidX(strHeader, 142, 10), 'yyMMddhhmm')
.head 5 -  ! nTNLines    - Кількість інформаційних рядків у файлі, що квитується (N 	6 	153 - 158 )
.head 5 -  Set nTNLines  = SalStrToNumber(SalStrMidX(strHeader, 152, 6))
.head 5 -  !
.head 5 -  ! добавить строку с информацией о квитуемом файле
.head 5 -  Call SalTblReset(hWndForm.frm_TicketsNI.tblTicRows)
.head 5 -  !
.head 5 -  Set nRow = SalTblInsertRow(hWndForm.frm_TicketsNI.tblTicRows, TBL_MaxRow)
.head 5 -  Call SalTblSetRowFlags(hWndForm.frm_TicketsNI.tblTicRows, nRow, ROW_New, FALSE)
.head 5 -  Call SalTblSetContext(hWndForm.frm_TicketsNI.tblTicRows, nRow)
.head 5 -  Set hWndForm.frm_TicketsNI.tblTicRows.colTag = 'Квитуємий файл'
.head 5 -  Set hWndForm.frm_TicketsNI.tblTicRows.colDetails =
    strTFName || ' (Рядків: ' || SalNumberToStrX(nTNLines, 0) || ') за ' || SalFmtFormatDateTime(dtTFDate, 'dd/MM/yyyy hhhh:mm')
.head 5 -  Call VisTblSetRowColor( hWndForm.frm_TicketsNI.tblTicRows, nRow, COLOR_Blue)
.head 5 -  !
.head 5 -  ! вычитать код ошибки главный
.head 5 -  Set strTECode = SalStrTrimX(SalStrMidX(strHeader, 260, 4))
.head 5 -  ! добавить строку о коде обработки всего файла
.head 5 -  Set nRow = SalTblInsertRow(hWndForm.frm_TicketsNI.tblTicRows, TBL_MaxRow)
.head 5 -  Call SalTblSetRowFlags(hWndForm.frm_TicketsNI.tblTicRows, nRow, ROW_New, FALSE)
.head 5 -  Call SalTblSetContext(hWndForm.frm_TicketsNI.tblTicRows, nRow)
.head 5 -  Set hWndForm.frm_TicketsNI.tblTicRows.colTag = 'Код квитовки файлу'
.head 5 -  Set hWndForm.frm_TicketsNI.tblTicRows.colErrCode = strTECode
.head 5 -  ! Наименование кода ошибки
.head 5 +  If SqlPrepareAndExecute(hSql(), 'SELECT n_er INTO :hWndForm.frm_TicketsNI.tblTicRows.colDetails FROM s_er WHERE k_er = :strTECode')
.head 6 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Call VisTblSetRowColor(hWndForm.frm_TicketsNI.tblTicRows, nRow, COLOR_DarkRed)
.head 5 -  !
.head 5 -  ! Если есть строки, вычитать строки и отобразить в таблице
.head 5 +  If nHNLines
.head 6 -  Set nIterator = 0
.head 6 +  While nIterator < nHNLines
.head 7 +  If NOT SalFileGetStr(hTick, strLine, 10240)
.head 8 -  Call SalMessageBeep(MB_IconStop)
.head 8 -  Call SalMessageBox('(Detail) Помилка читання з файлу ' || strFileName, 'Помилка!', MB_IconStop | MB_Ok)
.head 8 -  Call SalFileClose(hTick)
.head 8 -  Return FALSE
.head 7 +  If SalStrLength(strLine) != nLineSize
.head 8 -  Call SalMessageBeep(MB_IconStop)
.head 8 -  Call SalMessageBox('Порушення структури файлу! (Detail Line)', 'Помилка!', MB_IconStop | MB_Ok)
.head 8 -  Call SalFileClose(hTick)
.head 8 -  Return FALSE
.head 7 -  !
.head 7 -  Set nRow = SalTblInsertRow(hWndForm.frm_TicketsNI.tblTicRows, TBL_MaxRow)
.head 7 -  Call SalTblSetRowFlags(hWndForm.frm_TicketsNI.tblTicRows, nRow, ROW_New, FALSE)
.head 7 -  Call SalTblSetContext(hWndForm.frm_TicketsNI.tblTicRows, nRow)
.head 7 +  If nLineSize = 10
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colTag = SalStrTrimX(SalStrLeftX(strLine, 6))
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colErrCode = SalStrTrimX(SalStrRightX(strLine, 4))
.head 8 +  If SqlPrepareAndExecute(hSql(),
'SELECT n_er INTO :hWndForm.frm_TicketsNI.tblTicRows.colDetails FROM s_er
 WHERE k_er = :hWndForm.frm_TicketsNI.tblTicRows.colErrCode' )
.head 9 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 7 -  Else
.head 7 -  !
.head 7 -  Set nIterator = nIterator + 1
.head 5 -  ! все нормально, закрываем файл и валим отсюда
.head 5 -  Call SalFileClose(hTick)
.head 5 -  Call SalMessageBeep(MB_IconAsterisk)
.head 5 -  Return TRUE
.head 3 +  Function: FunProcessTicketXml
.head 4 -  Description: прочитать содержимое квитанции
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sTickName	! Имя файла-квитанции @IF/@RF
.head 5 -  Receive String: sErrCode
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sFFileName
.head 5 -  Number: nRow
.head 5 -  !
.head 5 -  Number: nN
.head 5 -  String: sMfo
.head 5 -  String: sOkpo
.head 5 -  Number: nRType
.head 5 -  String: sNmkk
.head 5 -  Date/Time: dODate
.head 5 -  String: sNls
.head 5 -  Number: nKv
.head 5 -  Number: nResid
.head 5 -  Date/Time: dDatInDpa
.head 5 -  Date/Time: dDatAccDpa
.head 5 -  Number: nIdPr
.head 5 -  Number: nIdDpa
.head 5 -  Number: nIdDps
.head 5 -  Number: nIdRec
.head 5 -  String: sFname
.head 5 -  Number: nFn
.head 5 -  String: sErr
.head 4 +  Actions
.head 5 -  Call SaveInfoToLog(DPA || sTickName || ': Обработка квитанции')
.head 5 -  ! Проверка имени квитанции
.head 5 -  Call SqlPrepareAndExecute(hSql(), "select fn into :sFFileName from zag_f where substr(fn,4) = substr(:sTickName,4) and dat > sysdate-364")
.head 5 +  If not SqlFetchNext(hSql(), nFetchRes)
.head 6 -  Call SalMessageBox('Квитанція на неіснуючий файл!', 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SaveInfoToLog(DPA || sTickName || ': Квитанція на неіснуючий файл!')
.head 6 -  Return FALSE
.head 5 -  ! Чистим таблицу
.head 5 +  If not SqlPrepareAndExecute(hSql(), "delete from dpa_lob")
.head 6 -  Call SqlRollback(hSql())
.head 6 -  Return FALSE
.head 5 +  If not SqlCommit(hSql())
.head 6 -  Return FALSE
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  ! Импорт файла во временную таблицу
.head 5 +  If not PutFileToClob(hSql(), strTicketsPath || '\\' || sTickName, 'dpa_lob', 'id', 'file_data', 1, STRING_Null, STRING_Null, 1)
.head 6 -  Call SaveInfoToLog(DPA || sTickName || ': Ошибка на PutFileToClob')
.head 6 -  Call SalWaitCursor(FALSE)
.head 6 -  Return FALSE
.head 5 -  Call SaveInfoToLog(DPA || sTickName || ': Файл добавлен в промежуточную таблицу')
.head 5 -  ! Обработка файла
.head 5 +  If not SqlPLSQLCommand(hSql(), "bars_dpa.import_ticket(sTickName, sErrCode)")
.head 6 -  Call SqlRollback(hSql())
.head 6 -  Call SaveInfoToLog(DPA || sTickName || ': Ошибка на bars_dpa.import_ticket')
.head 6 -  Call SalWaitCursor(FALSE)
.head 6 -  Return FALSE
.head 5 -  ! sErrCode = -1 - нарушена структура файла
.head 5 +  If sErrCode = '-1'
.head 6 -  Call SqlRollback(hSql())
.head 6 -  Call SalMessageBox('Порушенно структуру файлу!', 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SaveInfoToLog(DPA || sTickName || ': Порушенно структуру файлу')
.head 6 -  ! Квитанция на @R/@D
.head 6 +  If Subs(sTickName,1,2) = '@R' or Subs(sTickName,1,2) = '@D'
.head 7 -  ! 2103 - Порушено загальну структуру Файла
.head 7 -  Call CreateTicketXml(sTickName, '2103')
.head 6 -  Call SalWaitCursor(FALSE)
.head 6 -  Return FALSE
.head 5 -  Call SqlCommitEx(hSql(), DPA || sTickName || ': Файл сквитовано з кодом ' || sErrCode)
.head 5 -  !
.head 5 -  ! информацию о квитанции пишем в таблицу
.head 5 -  Call SalTblReset(hWndForm.frm_TicketsNI.tblTicRows)
.head 5 -  !
.head 5 -  ! добавить строку с информацией о квитуемом файле
.head 5 -  Set nRow = SalTblInsertRow(hWndForm.frm_TicketsNI.tblTicRows, TBL_MaxRow)
.head 5 -  Call SalTblSetRowFlags(hWndForm.frm_TicketsNI.tblTicRows, nRow, ROW_New, FALSE)
.head 5 -  Call SalTblSetContext(hWndForm.frm_TicketsNI.tblTicRows, nRow)
.head 5 -  Set hWndForm.frm_TicketsNI.tblTicRows.colTag = 'Квитуємий файл'
.head 5 -  Set hWndForm.frm_TicketsNI.tblTicRows.colDetails = sTickName
.head 5 -  Call VisTblSetRowColor(hWndForm.frm_TicketsNI.tblTicRows, nRow, COLOR_Blue)
.head 5 -  !
.head 5 -  ! добавить строку о коде обработки всего файла
.head 5 -  Set nRow = SalTblInsertRow(hWndForm.frm_TicketsNI.tblTicRows, TBL_MaxRow)
.head 5 -  Call SalTblSetRowFlags(hWndForm.frm_TicketsNI.tblTicRows, nRow, ROW_New, FALSE)
.head 5 -  Call SalTblSetContext(hWndForm.frm_TicketsNI.tblTicRows, nRow)
.head 5 -  Set hWndForm.frm_TicketsNI.tblTicRows.colTag = 'Код квитовки файлу'
.head 5 -  Set hWndForm.frm_TicketsNI.tblTicRows.colErrCode = sErrCode
.head 5 -  ! Наименование кода ошибки
.head 5 +  If SqlPrepareAndExecute(hSql(), "SELECT substr(err_msg,1,100) INTO :hWndForm.frm_TicketsNI.tblTicRows.colDetails FROM dpa_err_codes WHERE err_code = :sErrCode")
.head 6 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Call VisTblSetRowColor(hWndForm.frm_TicketsNI.tblTicRows, nRow, COLOR_DarkRed)
.head 5 -  !
.head 5 -  ! Населяем строки квитанции
.head 5 -  ! If Subs(sTickName,1,2) = '@R' or Subs(sTickName,1,2) = '@D'
.head 5 +  If strTicketsMask != '@IK*.*' and Subs(sTickName,3,1) != '1' 
.head 6 -  Call tblTicRows.PopulateFromArc(sTickName, DATETIME_Null)
.head 5 -  Call VisTblAutoSizeColumn(hWndForm.frm_TicketsNI.tblTicRows, hWndNULL)
.head 5 -  !
.head 5 -  Call SalMessageBeep(MB_IconAsterisk)
.head 5 +  If Subs(sTickName,1,2) = '@R' or Subs(sTickName,1,2) = '@D'
.head 6 -  Call SalMessageBox('Файл ' || sTickName || ' сквитовано з кодом ' || sErrCode, 'Квитовка', MB_Ok | MB_IconAsterisk)
.head 5 +  Else
.head 6 -  Call SalMessageBox('Файл ' || sFFileName || ' сквитовано з кодом ' || sErrCode, 'Квитовка', MB_Ok | MB_IconAsterisk)
.head 5 -  ! Квитанция на @R/@D
.head 5 +  If Subs(sTickName,1,2) = '@R' or Subs(sTickName,1,2) = '@D'
.head 6 -  Call CreateTicketXml(sTickName, '0000')
.head 5 -  Call SalWaitCursor(FALSE)
.head 5 -  Return TRUE
.head 3 +  Function: FunReadTicketR
.head 4 -  Description: прочитать содержимое квитанции
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strFileName	! Имя файла-квитанции @RF
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hTick
.head 5 -  String: strHeader
.head 5 -  String: strLine
.head 5 -  Number: nBufSize
.head 5 -  Number: nLineSize
.head 5 -  !
.head 5 -  Number: nIterator
.head 5 -  Number: nRow
.head 4 +  Actions
.head 5 -  Set sErrCodeR = '0000'
.head 5 -  Set strTFName = ''
.head 5 -  Set dtTFDate  = SalDateCurrent()
.head 5 -  Set nRowR = 0
.head 5 -  Call SalTblReset(hWndForm.frm_TicketsNI.tblTicRows)
.head 5 +  If NOT SalFileOpen(hTick, strTicketsPath || '\\' || strFileName, OF_Read | OF_Text)
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('Неможливо відкрити файл ' || strFileName, 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call FunSetErrToTbl()
.head 6 -  Return FALSE
.head 5 -  ! Проверить структуру файла
.head 5 -  ! Читаем первую строку файла
.head 5 +  If NOT SalFileGetStr(hTick, strLine, 10240)
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('(SLine) Помилка читання з файлу ' || strFileName, 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SalFileClose(hTick)
.head 6 -  Call FunSetErrToTbl()
.head 6 -  Return FALSE
.head 5 -  ! Длина первой строки д.б. 100
.head 5 +  If strLine != SalStrRepeatX(' ', 100)
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('Порушення структури файлу! (Service Line)', 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SalFileClose(hTick)
.head 6 -  Call FunSetErrToTbl()
.head 6 -  Return FALSE
.head 5 -  ! Читаем строку заголовка
.head 5 +  If NOT SalFileGetStr(hTick, strHeader, 10240)
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('(Header) Помилка читання з файлу ' || strFileName, 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SalFileClose(hTick)
.head 6 -  Call FunSetErrToTbl()
.head 6 -  Return FALSE
.head 5 -  ! Длина строки заголовка д.б. 194
.head 5 +  If SalStrLength(strHeader) != 194
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('Порушення структури файлу! (Header Line)', 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SalFileClose(hTick)
.head 6 -  Call FunSetErrToTbl()
.head 6 -  Return FALSE
.head 5 -  !
.head 5 -  ! Анализ строки заголовка:
.head 5 -  ! strHFName   - Найменування файла R (C 	12 	1 - 12 )
.head 5 -  Set strHFName = SalStrUpperX(SalStrLeftX(strHeader, 12))
.head 5 -  ! dtHFDate    - Дата та час створення файла R (D 	10 	13 - 22 )
.head 5 -  Set dtHFDate  = SalDateConstruct(2000+Val(SalStrMidX(strHeader, 12, 2)),
    Val(SalStrMidX(strHeader, 14, 2)), Val(SalStrMidX(strHeader, 16, 2)),
    Val(SalStrMidX(strHeader, 18, 2)), Val(SalStrMidX(strHeader, 20, 2)), 0)
.head 5 -  ! nHNLines    - Кількість інформаційних рядків у файлі R (N 	6 	23 - 28 )
.head 5 -  Set nHNLines  = SalStrToNumber(SalStrMidX(strHeader, 22, 6))
.head 5 -  !
.head 5 -  ! strTFName   - Найменування файла, що квитується
.head 5 -  Set strTFName = strFileName
.head 5 -  ! dtTFDate    - Дата та час створення файла, що квитується
.head 5 -  Set dtTFDate  = dtHFDate
.head 5 -  ! nTNLines    - Кількість інформаційних рядків у файлі, що квитується
.head 5 -  Set nTNLines  = nHNLines
.head 5 -  !
.head 5 -  ! Проверка на совпадение имени файла и имени файла в заголовке
.head 5 +  If strHFName != strTFName
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('Неспівпадання імені файлу з іменем в заголовку! (Header Line)', 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SalFileClose(hTick)
.head 6 -  Call FunSetErrToTbl()
.head 6 -  Return FALSE
.head 5 -  !
.head 5 -  ! добавить строку с информацией о квитуемом файле
.head 5 +  While TRUE
.head 6 +  If NOT SalFileGetStr(hTick, strLine, 10240)
.head 7 -  Break
.head 6 -  Set nRowR = nRowR + 1
.head 6 -  !
.head 6 -  Set nRow = SalTblInsertRow(hWndForm.frm_TicketsNI.tblTicRows, TBL_MaxRow)
.head 6 -  Call SalTblSetRowFlags(hWndForm.frm_TicketsNI.tblTicRows, nRow, ROW_New, FALSE)
.head 6 -  Call SalTblSetContext(hWndForm.frm_TicketsNI.tblTicRows, nRow)
.head 6 +  If SalStrLength(strLine) != 165
.head 7 -  ! Call SalMessageBox('Нарушение структуры файла! (Detail Line)', 'Ошибка!', MB_IconStop | MB_Ok)
.head 7 -  Set sErrCodeR = '2103'
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colErrCode = '2103'
.head 6 +  Else
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colMfo   = Val(SalStrTrimX(SalStrMidX(strLine, 0, 9)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colOkpo  = SalStrTrimX(SalStrMidX(strLine, 9, 14))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colTgr   = Val(SalStrTrimX(SalStrMidX(strLine, 23, 1)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colNmkk  = SalStrTrimX(SalStrMidX(strLine, 24, 38))
.head 7 +  If SalStrTrimX(SalStrMidX(strLine, 62, 6)) != ''
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colODat  = SalDateConstruct(2000+Val(SalStrMidX(strLine, 62, 2)), Val(SalStrMidX(strLine, 64, 2)), Val(SalStrMidX(strLine, 66, 2)), 0, 0, 0)
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colNls   = SalStrTrimX(SalStrTrimX(SalStrMidX(strLine, 68, 14)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colKv    = Val(SalStrTrimX(SalStrMidX(strLine, 82, 3)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colRezid = Val(SalStrTrimX(SalStrMidX(strLine, 85, 1)))
.head 7 +  If SalStrTrimX(SalStrMidX(strLine, 86, 6)) != ''
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colDatInDpa  = SalDateConstruct(2000+Val(SalStrMidX(strLine, 86, 2)), Val(SalStrMidX(strLine, 88, 2)), Val(SalStrMidX(strLine, 90, 2)), 0, 0, 0)
.head 7 +  If SalStrTrimX(SalStrMidX(strLine, 92, 6)) != ''
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colDatAccDpa = SalDateConstruct(2000+Val(SalStrMidX(strLine, 92, 2)), Val(SalStrMidX(strLine, 94, 2)), Val(SalStrMidX(strLine, 96, 2)), 0, 0, 0)
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colPr    = Val(SalStrTrimX(SalStrMidX(strLine, 98, 1)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colKodDpa= Val(SalStrTrimX(SalStrMidX(strLine, 99, 2)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colKodDps= Val(SalStrTrimX(SalStrMidX(strLine, 101, 2)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colId    = SalStrTrimX(SalStrMidX(strLine, 103, 24))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colNameF = SalStrUpperX(SalStrTrimX(SalStrMidX(strLine, 127, 12)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colLineF = Val(SalStrTrimX(SalStrMidX(strLine, 139, 6)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colLineR = Val(SalStrTrimX(SalStrMidX(strLine, 159, 6)))
.head 7 -  ! Анализ реквизитов
.head 7 -  ! 2120 - "помилка при обробці реквізиту "Дата отримання ДПА Повідомлення";
.head 7 -  ! 2121 - "помилка при обробці реквізиту "Дата взяття рахунку на облік в ДПА";
.head 7 -  ! 2122 - "помилка реквізиту "Код причин відмови у взятті на облік рахунку";
.head 7 +  If SqlPrepareAndExecute(hSql(), "select err_code from dpa_reject_codes where err_code=:hWndForm.frm_TicketsNI.tblTicRows.colPr")
and not SqlFetchNext(hSql(), nFetchRes)
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colErrCode = '2122'
.head 7 -  ! 2123 - "помилка реквізиту "Ідентифікатор запису";
.head 7 -  ! 2124 - "помилка реквізиту "Найменування файла F, у якому була надана інформація про рахунок";
.head 7 +  If SqlPrepareAndExecute(hSql(),
"select fn
   from lines_f
  where upper(fn)  = :hWndForm.frm_TicketsNI.tblTicRows.colNameF
    and trim(mfo)  = :hWndForm.frm_TicketsNI.tblTicRows.colMfo
    and trim(okpo) = :hWndForm.frm_TicketsNI.tblTicRows.colOkpo
    and trim(nls)  = :hWndForm.frm_TicketsNI.tblTicRows.colNls
    and kv = :hWndForm.frm_TicketsNI.tblTicRows.colKv
    and otype in (1,6)")
and not SqlFetchNext(hSql(), nFetchRes)
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colErrCode = '2124'
.head 7 -  ! 2125 - "помилка реквізиту "Порядковий номер інформаційного рядка файла F"
.head 7 +  If SqlPrepareAndExecute(hSql(),
"select fn
   from lines_f
  where upper(fn) = :hWndForm.frm_TicketsNI.tblTicRows.colNameF
    and n = :hWndForm.frm_TicketsNI.tblTicRows.colLineF")
and not SqlFetchNext(hSql(), nFetchRes)
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colErrCode = '2125'
.head 7 -  ! 2126 - "дана фінансова установа не відправляла файл F, на який надіслано відповідь".
.head 7 +  If SqlPrepareAndExecute(hSql(), "select fn from zag_f where upper(fn) = :hWndForm.frm_TicketsNI.tblTicRows.colNameF and dat > sysdate-364")
and not SqlFetchNext(hSql(), nFetchRes)
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colErrCode = '2126'
.head 7 -  ! Вот здесь нужно уточнить, с каким кодом квитуется файл, если ошибка в строках
.head 7 +  If sErrCodeR != '2103' and hWndForm.frm_TicketsNI.tblTicRows.colErrCode != ''
.head 8 -  Set sErrCodeR = hWndForm.frm_TicketsNI.tblTicRows.colErrCode
.head 6 +  If hWndForm.frm_TicketsNI.tblTicRows.colErrCode
.head 7 +  If SqlPrepareAndExecute(hSql(),
"SELECT substr(err_msg,1,254) INTO :hWndForm.frm_TicketsNI.tblTicRows.colDetails
   FROM dpa_err_codes
  WHERE err_code = :hWndForm.frm_TicketsNI.tblTicRows.colErrCode")
.head 8 +  If not SqlFetchNext(hSql(), nFetchRes)
.head 9 +  If SqlPrepareAndExecute(hSql(),
'SELECT n_er INTO :hWndForm.frm_TicketsNI.tblTicRows.colDetails
   FROM s_er
  WHERE k_er=:hWndForm.frm_TicketsNI.tblTicRows.colErrCode' )
.head 10 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Call VisTblAutoSizeColumn(hWndForm.frm_TicketsNI.tblTicRows, hWndNULL)
.head 5 -  ! все нормально, закрываем файл и валим отсюда
.head 5 -  Call SalFileClose(hTick)
.head 5 -  Return TRUE
.head 3 +  Function: FunReadTicketD
.head 4 -  Description: прочитать содержимое квитанции
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strFileName	! Имя файла-квитанции @RF
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hTick
.head 5 -  String: strHeader
.head 5 -  String: strLine
.head 5 -  Number: nBufSize
.head 5 -  Number: nLineSize
.head 5 -  !
.head 5 -  Number: nIterator
.head 5 -  Number: nRow
.head 4 +  Actions
.head 5 -  Set sErrCodeR = '0000'
.head 5 -  Set strTFName = ''
.head 5 -  Set dtTFDate  = SalDateCurrent()
.head 5 -  Set nRowR = 0
.head 5 -  Call SalTblReset(hWndForm.frm_TicketsNI.tblTicRows)
.head 5 +  If NOT SalFileOpen(hTick, strTicketsPath || '\\' || strFileName, OF_Read | OF_Text)
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('Неможливо відкрити файл ' || strFileName, 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call FunSetErrToTbl()
.head 6 -  Return FALSE
.head 5 -  ! Проверить структуру файла
.head 5 -  ! Читаем первую строку файла
.head 5 +  If NOT SalFileGetStr(hTick, strLine, 10240)
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('(SLine) Помилка читання з файлу ' || strFileName, 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SalFileClose(hTick)
.head 6 -  Call FunSetErrToTbl()
.head 6 -  Return FALSE
.head 5 -  ! Длина первой строки д.б. 100
.head 5 +  If strLine != SalStrRepeatX(' ', 100)
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('Порушення структури файлу! (Service Line)', 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SalFileClose(hTick)
.head 6 -  Call FunSetErrToTbl()
.head 6 -  Return FALSE
.head 5 -  ! Читаем строку заголовка
.head 5 +  If NOT SalFileGetStr(hTick, strHeader, 10240)
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('(Header) Помилка читання з файлу ' || strFileName, 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SalFileClose(hTick)
.head 6 -  Call FunSetErrToTbl()
.head 6 -  Return FALSE
.head 5 -  ! Длина строки заголовка д.б. 194
.head 5 +  If SalStrLength(strHeader) != 194
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('Порушення структури файлу! (Header Line)', 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SalFileClose(hTick)
.head 6 -  Call FunSetErrToTbl()
.head 6 -  Return FALSE
.head 5 -  !
.head 5 -  ! Анализ строки заголовка:
.head 5 -  ! strHFName   - Найменування файла D (C 	12 	1 - 12 )
.head 5 -  Set strHFName = SalStrUpperX(SalStrLeftX(strHeader, 12))
.head 5 -  ! dtHFDate    - Дата та час створення файла D (D 	10 	13 - 22 )
.head 5 -  Set dtHFDate  = SalDateConstruct(2000+Val(SalStrMidX(strHeader, 12, 2)),
    Val(SalStrMidX(strHeader, 14, 2)), Val(SalStrMidX(strHeader, 16, 2)),
    Val(SalStrMidX(strHeader, 18, 2)), Val(SalStrMidX(strHeader, 20, 2)), 0)
.head 5 -  ! nHNLines    - Кількість інформаційних рядків у файлі D (N 	6 	23 - 28 )
.head 5 -  Set nHNLines  = SalStrToNumber(SalStrMidX(strHeader, 22, 6))
.head 5 -  !
.head 5 -  ! strTFName   - Найменування файла, що квитується
.head 5 -  Set strTFName = strFileName
.head 5 -  ! dtTFDate    - Дата та час створення файла, що квитується
.head 5 -  Set dtTFDate  = dtHFDate
.head 5 -  ! nTNLines    - Кількість інформаційних рядків у файлі, що квитується
.head 5 -  Set nTNLines  = nHNLines
.head 5 -  !
.head 5 -  ! Проверка на совпадение имени файла и имени файла в заголовке
.head 5 +  If strHFName != strTFName
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('Неспівпадання імені файлу з іменем в заголовку! (Header Line)', 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SalFileClose(hTick)
.head 6 -  Call FunSetErrToTbl()
.head 6 -  Return FALSE
.head 5 -  !
.head 5 -  ! добавить строку с информацией о квитуемом файле
.head 5 +  While TRUE
.head 6 +  If NOT SalFileGetStr(hTick, strLine, 10240)
.head 7 -  Break
.head 6 -  Set nRowR = nRowR + 1
.head 6 -  !
.head 6 -  Set nRow = SalTblInsertRow(hWndForm.frm_TicketsNI.tblTicRows, TBL_MaxRow)
.head 6 -  Call SalTblSetRowFlags(hWndForm.frm_TicketsNI.tblTicRows, nRow, ROW_New, FALSE)
.head 6 -  Call SalTblSetContext(hWndForm.frm_TicketsNI.tblTicRows, nRow)
.head 6 +  If SalStrLength(strLine) != 188
.head 7 -  ! Call SalMessageBox('Нарушение структуры файла! (Detail Line)', 'Ошибка!', MB_IconStop | MB_Ok)
.head 7 -  Set sErrCodeR = '2103'
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colErrCode = '2103'
.head 6 +  Else
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colMfo   = Val(SalStrTrimX(SalStrMidX(strLine, 0, 9)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colOkpo  = SalStrTrimX(SalStrMidX(strLine, 9, 14))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colTgr   = Val(SalStrTrimX(SalStrMidX(strLine, 23, 1)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colNmkk  = SalStrTrimX(SalStrMidX(strLine, 24, 38))
.head 7 +  If SalStrTrimX(SalStrMidX(strLine, 62, 6)) != ''
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colODat  = SalDateConstruct(2000+Val(SalStrMidX(strLine, 62, 2)), Val(SalStrMidX(strLine, 64, 2)), Val(SalStrMidX(strLine, 66, 2)), 0, 0, 0)
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colNls   = SalStrTrimX(SalStrTrimX(SalStrMidX(strLine, 68, 40)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colRezid = Val(SalStrTrimX(SalStrMidX(strLine, 108, 1)))
.head 7 +  If SalStrTrimX(SalStrMidX(strLine, 109, 6)) != ''
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colDatInDpa  = SalDateConstruct(2000+Val(SalStrMidX(strLine, 109, 2)), Val(SalStrMidX(strLine, 111, 2)), Val(SalStrMidX(strLine, 113, 2)), 0, 0, 0)
.head 7 +  If SalStrTrimX(SalStrMidX(strLine, 115, 6)) != ''
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colDatAccDpa = SalDateConstruct(2000+Val(SalStrMidX(strLine, 115, 2)), Val(SalStrMidX(strLine, 117, 2)), Val(SalStrMidX(strLine, 119, 2)), 0, 0, 0)
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colPr    = Val(SalStrTrimX(SalStrMidX(strLine, 121, 1)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colKodDpa= Val(SalStrTrimX(SalStrMidX(strLine, 122, 2)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colKodDps= Val(SalStrTrimX(SalStrMidX(strLine, 124, 2)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colId    = SalStrTrimX(SalStrMidX(strLine, 126, 24))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colNameF = SalStrUpperX(SalStrTrimX(SalStrMidX(strLine, 150, 12)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colLineF = Val(SalStrTrimX(SalStrMidX(strLine, 162, 6)))
.head 7 -  Set hWndForm.frm_TicketsNI.tblTicRows.colLineR = Val(SalStrTrimX(SalStrMidX(strLine, 182, 6)))
.head 7 -  ! Анализ реквизитов
.head 7 -  ! 2120 - "помилка при обробці реквізиту "Дата отримання ДПА Повідомлення";
.head 7 -  ! 2121 - "помилка при обробці реквізиту "Дата взяття рахунку на облік в ДПА";
.head 7 -  ! 2122 - "помилка реквізиту "Код причин відмови у взятті на облік рахунку";
.head 7 +  If SqlPrepareAndExecute(hSql(), "select err_code from dpa_reject_codes where err_code=:hWndForm.frm_TicketsNI.tblTicRows.colPr")
and not SqlFetchNext(hSql(), nFetchRes)
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colErrCode = '2122'
.head 7 -  ! 2123 - "помилка реквізиту "Ідентифікатор запису";
.head 7 -  ! 2124 - "помилка реквізиту "Найменування файла F, у якому була надана інформація про рахунок";
.head 7 +  If SqlPrepareAndExecute(hSql(),
"select fn
   from lines_p
  where upper(fn)=:hWndForm.frm_TicketsNI.tblTicRows.colNameF
    and mfo=:hWndForm.frm_TicketsNI.tblTicRows.colMfo
    and okpo=:hWndForm.frm_TicketsNI.tblTicRows.colOkpo
    and nls=:hWndForm.frm_TicketsNI.tblTicRows.colNls
    and otype in (1,6) and rownum = 1")
and not SqlFetchNext(hSql(), nFetchRes)
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colErrCode = '2124'
.head 7 -  ! 2125 - "помилка реквізиту "Порядковий номер інформаційного рядка файла F"
.head 7 +  If SqlPrepareAndExecute(hSql(),
"select fn
   from lines_p
  where upper(fn)=:hWndForm.frm_TicketsNI.tblTicRows.colNameF
    and n=:hWndForm.frm_TicketsNI.tblTicRows.colLineF")
and not SqlFetchNext(hSql(), nFetchRes)
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colErrCode = '2125'
.head 7 -  ! 2126 - "дана фінансова установа не відправляла файл F, на який надіслано відповідь".
.head 7 +  If SqlPrepareAndExecute(hSql(), "select fn from zag_f where upper(fn)=:hWndForm.frm_TicketsNI.tblTicRows.colNameF and dat > sysdate-364")
and not SqlFetchNext(hSql(), nFetchRes)
.head 8 -  Set hWndForm.frm_TicketsNI.tblTicRows.colErrCode = '2126'
.head 7 -  ! Вот здесь нужно уточнить, с каким кодом квитуется файл, если ошибка в строках
.head 7 +  If sErrCodeR != '2103' and hWndForm.frm_TicketsNI.tblTicRows.colErrCode != ''
.head 8 -  Set sErrCodeR = hWndForm.frm_TicketsNI.tblTicRows.colErrCode
.head 6 +  If hWndForm.frm_TicketsNI.tblTicRows.colErrCode
.head 7 +  If SqlPrepareAndExecute(hSql(),
'SELECT substr(err_msg,1,254) INTO :hWndForm.frm_TicketsNI.tblTicRows.colDetails
   FROM dpa_err_codes
  WHERE err_code=:hWndForm.frm_TicketsNI.tblTicRows.colErrCode' )
.head 8 +  If not SqlFetchNext(hSql(), nFetchRes)
.head 9 +  If SqlPrepareAndExecute(hSql(),
'SELECT n_er INTO :hWndForm.frm_TicketsNI.tblTicRows.colDetails
   FROM s_er
  WHERE k_er=:hWndForm.frm_TicketsNI.tblTicRows.colErrCode' )
.head 10 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Call VisTblAutoSizeColumn(hWndForm.frm_TicketsNI.tblTicRows, hWndNULL)
.head 5 -  ! все нормально, закрываем файл и валим отсюда
.head 5 -  Call SalFileClose(hTick)
.head 5 -  Return TRUE
.head 3 +  Function: FunProcessTicket
.head 4 -  Description: Обработать квитанцию.
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strErrCode	! Код квитовки
.head 5 -  Number: nLines		! Количество детальных строк в квитанции
.head 5 -  String: strFName	! Имя квитуемого файла @F/@RF
.head 5 -  Date/Time: dtFDate	! Дата/время квитуемого файла
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nOtm
.head 5 -  Number: nItr
.head 5 -  String: strLineErr
.head 5 -  Number: nLineErr
.head 5 -  String: strChkFName
.head 4 +  Actions
.head 5 +  If NOT strFName
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox("Пустий параметр - І'мя Файлу!", 'Квитовка', MB_IconStop | MB_Ok)
.head 6 -  Return FALSE
.head 5 +  If strTicketsMask = '@R*.*'
.head 6 -  Return FunProcessTicketR(strFName, dtFDate)
.head 5 +  If strTicketsMask = '@D*.*'
.head 6 -  Return FunProcessTicketD(strFName, dtFDate)
.head 5 -  ! игнорируем Дату/время квитуемого файла
.head 5 +  If SqlPrepareAndExecute(hSql(),
"select fn, otm INTO :strChkFName, :nOtm
   from " || strHeaderStorage || "
  where fn  = :strFName
    and dat = :dtFDate")
.head 6 +  If not SqlFetchNext(hSql(), nFetchRes) OR strChkFName != strFName
.head 7 -  Call SalMessageBeep(MB_IconStop)
.head 7 -  Call SalMessageBox('Квитовка неіснуючого файлу! ' || strFName || ' за ' || SalFmtFormatDateTime(dtFDate, 'dd.MM.yyyy hhhh:mm:ss'),
     'Квитовка', MB_IconStop | MB_Ok)
.head 7 -  Return FALSE
.head 5 +  If nOtm = 5
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 +  If IDNO = SalMessageBox('Файл ' || strFName || ' вже сквитовано!' || PutCrLf() ||
   'Сквитувати повторно?', 'Квитовка', MB_IconExclamation | MB_YesNo)
.head 7 +  If IDNO = SalMessageBox('Видалити квитанцію?', 'Питання', MB_IconQuestion | MB_YesNo)
.head 8 -  Return FALSE
.head 7 -  Return TRUE
.head 5 -  ! strCurrFile - имя принимаемого файла-квитанции @I / @R
.head 5 +  If SalStrLeftX(SalStrRightX(SalStrUpperX(strCurrFile),12), 3) = '@OF'
.head 6 -  ! Данные о файле сохраняем в zag_f и lines_f, обнуляем в ree_tmp
.head 6 +  If NOT SqlPrepareAndExecute(hSql(), 'UPDATE ree_tmp SET fn_o=null, dat_o=null, rec_o=null WHERE fn_o=:strFName and dat_o=:dtFDate')
.head 7 -  Call SalMessageBeep(MB_IconStop)
.head 7 -  Call SalMessageBox('Помилка зміни коду квитовки файлу! (ree_tmp)', 'Квитовка', MB_IconStop | MB_Ok)
.head 7 -  Return FALSE
.head 5 +  If NOT SqlPrepareAndExecute(hSql(), 'UPDATE ' || strHeaderStorage || ' SET otm=5, err=:strErrCode, datk=SYSDATE WHERE fn=:strFName and dat=:dtFDate')
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('Помилка зміни коду квитовки файлу!', 'Квитовка', MB_IconStop | MB_Ok)
.head 6 -  Return FALSE
.head 5 +  If NOT SqlPrepareAndExecute(hSql(), 'UPDATE ' || strLinesStorage  || ' SET err=:strErrCode, fn_r=:strCurrFile, date_r=:dtHFDate WHERE fn=:strFName and dat=:dtFDate')
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('Помилка зміни коду квитовки рядка файлу!', 'Квитовка', MB_IconStop | MB_Ok)
.head 6 -  Return FALSE
.head 5 +  If nLines
.head 6 -  Set nItr = 0
.head 6 +  While nItr < nLines
.head 7 -  Call SalTblSetContext(hWndForm.frm_TicketsNI.tblTicRows, nItr + 2)
.head 7 -  Set nLineErr   = Val(hWndForm.frm_TicketsNI.tblTicRows.colTag)
.head 7 -  Set strLineErr = hWndForm.frm_TicketsNI.tblTicRows.colErrCode
.head 7 +  If NOT SqlPrepareAndExecute(hSql(), 'UPDATE ' || strLinesStorage || ' SET err=:strLineErr WHERE fn=:strFName AND dat=:dtFDate AND n=:nLineErr')
.head 8 -  Call SalMessageBeep(MB_IconStop)
.head 8 -  Call SalMessageBox('Помилка зміни коду квитовки рядка файлу!', 'Квитовка', MB_IconStop | MB_Ok)
.head 8 -  Return FALSE
.head 7 -  Set nItr = nItr + 1
.head 5 -  !
.head 5 -  Call SqlCommitEx(hSql(), 'Файл ' || strFName || ' сквитовано з кодом ' || strErrCode)
.head 5 -  Call SalMessageBeep(MB_IconAsterisk)
.head 5 -  Call SalMessageBox('Файл ' || strFName || ' сквитовано з кодом ' || strErrCode, 'Квитовка', MB_Ok | MB_IconAsterisk)
.head 5 -  Return TRUE
.head 3 +  Function: FunProcessTicketR
.head 4 -  Description: Обработать квитанцию.
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strFName	! Имя файла-квитанции @RF
.head 5 -  Date/Time: dtFDate	! Дата/время квитуемого файла R
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nCount
.head 5 -  Number: nOtm
.head 5 -  Number: nItr
.head 5 -  Number: nRow
.head 5 -  String: strLineErr
.head 5 -  String: strChkFName
.head 5 -  String: strFNameS
.head 5 -  File Handle: hTick
.head 5 -  Number: nRowS
.head 5 -  Date/Time: dTmp
.head 4 +  Actions
.head 5 -  ! Проверка имени файла
.head 5 +  If NOT strFName
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox("Пустий параметр - І'мя Файлу!", 'Квитовка', MB_IconStop | MB_Ok)
.head 6 -  Return FALSE
.head 5 -  ! Не принимаем @R без @IF
.head 5 -  Call SqlPrepareAndExecute(hSql(),
"SELECT count(*) INTO :nCount
   FROM lines_f
  WHERE fn  = :hWndForm.frm_TicketsNI.tblTicRows.colNameF
    and dat = (select max(dat) from lines_f where fn = :hWndForm.frm_TicketsNI.tblTicRows.colNameF)
    AND fn_r is null")
.head 5 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 5 +  If nCount > 0
.head 6 -  Call SalMessageBox('Неможливо прийняти файл @R - файл @IF ще не приймався!', 'Квитовка', MB_IconStop | MB_Ok)
.head 6 -  Return FALSE
.head 5 -  ! Проверка для @R (для @OR не проверяем)
.head 5 +  If Subs(SalStrUpperX(strCurrFile), 1, 2) = '@R'
.head 6 -  ! Файл уже квитовался? Да
.head 6 +  If SqlPrepareAndExecute(hSql(), "select dat into :dTmp from zag_f where fn=:strFName and dat=:dtFDate") and
   SqlFetchNext(hSql(), nFetchRes)
.head 7 -  ! Сквитовать повторно? Нет - выходим
.head 7 +  If SalMessageBox('Файл ' || strFName || ' вже сквитовано!' || PutCrLf() || 'Сквитувати повторно?', 'Увага!', MB_YesNo | MB_IconAsterisk) = IDNO
.head 8 -  Return TRUE
.head 7 -  ! Да - меняем кол-во строк файла, дату квитовки и код ошибки
.head 7 +  Else
.head 8 +  If NOT SqlPrepareAndExecute(hSql(),
"update zag_f set n=:nRowR, otm=5, datk=sysdate, err=:sErrCodeR
  where fn=:strFName and dat=:dtFDate")
.head 9 -  Call SqlRollback(hSql())
.head 9 -  Return FALSE
.head 6 -  ! Нет - сохраняем информацию о файле @R
.head 6 +  Else If NOT SqlPrepareAndExecute(hSql(),
"INSERT INTO ZAG_F(fn, dat, n, otm, datk, err)
 VALUES (:strFName, :dtFDate, :nRowR, 5, sysdate, :sErrCodeR)")
.head 7 -  Call SqlRollback(hSql())
.head 7 -  Return FALSE
.head 5 -  ! Создаем файл S
.head 5 -  Set strFNameS = SalStrReplaceX(strFName, 1, 1, 'S')
.head 5 +  If NOT SalFileOpen(hTick, Rep_PathNI || '\\' || strFNameS, OF_Create | OF_Text | OF_Write)
.head 6 -  Call SalMessageBox('Неможливо створити файл ' || strFNameS, 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Return FALSE
.head 5 -  ! Служебная строка
.head 5 -  Call SalFileWrite(hTick, SalStrRepeatX(' ', 100) || PutCrLf(), 102)
.head 5 -  ! Строка заголовка:
    12+10+6+64+6+32+	- информация о создаваемом файле S
    12+10+6+64+6+32+	- информация о квитуемом файле R
    4+64+2 = 330
.head 5 -  ! sErrCodeR - код ош. из @R
  strTECode - код ош. из @OR
.head 5 -  Call SalFileWrite(hTick, strFNameS ||
     SalFmtFormatDateTime(SalDateCurrent(), 'yyMMdd') || SalStrRightX('0000'||SalFmtFormatDateTime(SalDateCurrent(), 'hhhhmm'), 4) ||
     SalStrRepeatX(' ', 6) || SalStrRepeatX(' ', 64) || SalStrRepeatX(' ', 6) || SalStrRepeatX(' ', 32) ||
     strFName ||
     IifS(dtFDate=DATETIME_Null, SalStrRepeatX(' ', 10), SalFmtFormatDateTime(dtFDate, 'yyMMdd') || SalStrRightX('0000'||SalFmtFormatDateTime(dtFDate, 'hhhhmm'), 4)) ||
     SalStrRightX('      '||Str(nRowR), 6) || SalStrRepeatX(' ', 64) || SalStrRepeatX(' ', 6) || SalStrRepeatX(' ', 32) ||
     IifS(Subs(SalStrUpperX(strCurrFile), 1, 2)='@R', sErrCodeR, strTECode) || SalStrRepeatX(' ', 64) || PutCrLf(), 330)
.head 5 -  ! из @R более подробно
.head 5 +  If Subs(SalStrUpperX(strCurrFile), 1, 2) = '@R'
.head 6 -  Set nRowS = 0
.head 6 +  If nRowR and sErrCodeR != '2103'
.head 7 -  Set nRow = TBL_MinRow
.head 7 +  While SalTblFindNextRow(hWndForm.frm_TicketsNI.tblTicRows, nRow, 0, 0)
.head 8 -  Call SalTblSetContext(hWndForm.frm_TicketsNI.tblTicRows, nRow)
.head 8 -  ! Если ошибка - пишем в файл @S
.head 8 +  If hWndForm.frm_TicketsNI.tblTicRows.colErrCode != ''
.head 9 -  Call SalFileWrite(hTick,
     SalStrRightX('      ' || Str(hWndForm.frm_TicketsNI.tblTicRows.colLineR),   6) ||
     SalStrRightX('    '   || hWndForm.frm_TicketsNI.tblTicRows.colErrCode, 4) || PutCrLf(), 12)
.head 9 -  Set nRowS = nRowS + 1
.head 8 -  ! Сохраняем информацию
.head 8 +  If NOT SqlPrepareAndExecute(hSql(),
"UPDATE lines_f
    SET dat_in_dpa  = :hWndForm.frm_TicketsNI.tblTicRows.colDatInDpa,
        dat_acc_dpa = :hWndForm.frm_TicketsNI.tblTicRows.colDatAccDpa,
        id_pr       = :hWndForm.frm_TicketsNI.tblTicRows.colPr,
        id_dpa      = :hWndForm.frm_TicketsNI.tblTicRows.colKodDpa,
        id_dps      = :hWndForm.frm_TicketsNI.tblTicRows.colKodDps,
        id_rec      = :hWndForm.frm_TicketsNI.tblTicRows.colId,
        fn_r        = :strFName,
        date_r      = :dtHFDate,
        n_r         = :hWndForm.frm_TicketsNI.tblTicRows.colLineR
  WHERE fn    = :hWndForm.frm_TicketsNI.tblTicRows.colNameF
    and n     = :hWndForm.frm_TicketsNI.tblTicRows.colLineF
    and nls   = :hWndForm.frm_TicketsNI.tblTicRows.colNls
    and kv    = :hWndForm.frm_TicketsNI.tblTicRows.colKv
    and otype in (1,6)")
.head 9 -  Call SqlRollback(hSql())
.head 9 -  Call SalFileClose(hTick)
.head 9 -  Call SalFileOpen(hTick, Rep_PathNI || '\\' || strFNameS, OF_Delete)
.head 9 -  Return FALSE
.head 6 -  Call SalFileSeek(hTick, 102+22, FILE_SeekBegin)
.head 6 -  Call SalFileWrite(hTick, SalStrRightX('      ' || Str(nRowS), 6), 6)
.head 5 -  Call SalFileClose(hTick)
.head 5 -  If FunBackUpFile(Rep_PathNI || '\\' || strFNameS, strBackupDir, FALSE)
.head 5 -  !
.head 5 +  If Subs(SalStrUpperX(strCurrFile), 1, 2) = '@R'
.head 6 -  Call SqlCommitEx(hSql(), 'Файл ' || strFName || ' принят и сквитован с кодом ' || sErrCodeR || ' (' || Rep_PathNI || '\\' || strFNameS || ')')
.head 6 -  Call SalMessageBox('Файл ' || strFName || ' прийнято і сквитовано з кодом ' || sErrCodeR || '.' || PutCrLf() ||
     'Сформовано файл-квитанцію ' || Rep_PathNI || '\\' || strFNameS || '.', 'Квитовка', MB_Ok | MB_IconAsterisk)
.head 5 +  Else
.head 6 -  Call SqlCommitEx(hSql(), 'Файл ' || strCurrFile || ' с кодом ' || strTECode || ' обработан (' || Rep_PathNI || '\\' || strFNameS || ')')
.head 6 -  Call SalMessageBox('Файл ' || strCurrFile || ' з кодом ' || strTECode || ' оброблено.'  || PutCrLf() ||
     '(' || Rep_PathNI || '\\' || strFNameS || ')', 'Квитовка', MB_Ok | MB_IconAsterisk)
.head 5 -  Return TRUE
.head 3 +  Function: FunProcessTicketD
.head 4 -  Description: Обработать квитанцию.
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strFName	! Имя файла-квитанции @DP
.head 5 -  Date/Time: dtFDate	! Дата/время квитуемого файла D
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nCount
.head 5 -  Number: nOtm
.head 5 -  Number: nItr
.head 5 -  Number: nRow
.head 5 -  String: strLineErr
.head 5 -  String: strChkFName
.head 5 -  String: strFNameS
.head 5 -  File Handle: hTick
.head 5 -  Number: nRowS
.head 5 -  Date/Time: dTmp
.head 4 +  Actions
.head 5 -  ! Проверка имени файла
.head 5 +  If NOT strFName
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox("Пустий параметр - І'мя Файлу!", 'Квитовка', MB_IconStop | MB_Ok)
.head 6 -  Return FALSE
.head 5 -  ! Не принимаем @D без @IP
.head 5 -  Call SqlPrepareAndExecute(hSql(),
"SELECT count(*) INTO :nCount
   FROM lines_p
  WHERE fn  = :hWndForm.frm_TicketsNI.tblTicRows.colNameF
    and dat = (select max(dat) from lines_f where fn = :hWndForm.frm_TicketsNI.tblTicRows.colNameF)
    AND fn_r is null")
.head 5 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 5 +  If nCount > 0
.head 6 -  Call SalMessageBox('Неможливо прийняти файл @D - файл @IP ще не приймався!', 'Квитовка', MB_IconStop | MB_Ok)
.head 6 -  Return FALSE
.head 5 -  ! Проверка для @D
.head 5 +  If Subs(SalStrUpperX(strCurrFile), 1, 2) = '@D'
.head 6 -  ! Файл уже квитовался? Да
.head 6 +  If SqlPrepareAndExecute(hSql(), "select dat into :dTmp from zag_f where fn=:strFName and dat=:dtFDate") and
   SqlFetchNext(hSql(), nFetchRes)
.head 7 -  ! Сквитовать повторно? Нет - выходим
.head 7 +  If SalMessageBox('Файл ' || strFName || ' вже сквитовано!' || PutCrLf() || 'Сквитувати повторно?', 'Увага!', MB_YesNo | MB_IconAsterisk) = IDNO
.head 8 -  Return TRUE
.head 7 -  ! Да - меняем кол-во строк файла, дату квитовки и код ошибки
.head 7 +  Else
.head 8 +  If NOT SqlPrepareAndExecute(hSql(),
"update zag_f set n=:nRowR, otm=5, datk=sysdate, err=:sErrCodeR
  where fn=:strFName and dat=:dtFDate")
.head 9 -  Call SqlRollback(hSql())
.head 9 -  Return FALSE
.head 6 -  ! Нет - сохраняем информацию о файле @D
.head 6 +  Else If NOT SqlPrepareAndExecute(hSql(),
"INSERT INTO ZAG_F(fn, dat, n, otm, datk, err)
 VALUES (:strFName, :dtFDate, :nRowR, 5, sysdate, :sErrCodeR)")
.head 7 -  Call SqlRollback(hSql())
.head 7 -  Return FALSE
.head 5 -  ! Создаем файл T
.head 5 -  Set strFNameS = SalStrReplaceX(strFName, 1, 1, 'T')
.head 5 +  If NOT SalFileOpen(hTick, Rep_PathNI || '\\' || strFNameS, OF_Create | OF_Text | OF_Write)
.head 6 -  Call SalMessageBox('Неможливо створити файл ' || strFNameS, 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Return FALSE
.head 5 -  ! Служебная строка
.head 5 -  Call SalFileWrite(hTick, SalStrRepeatX(' ', 100) || PutCrLf(), 102)
.head 5 -  ! Строка заголовка:
    12+10+6+64+6+32+	- информация о создаваемом файле S
    12+10+6+64+6+32+	- информация о квитуемом файле R
    4+64+2 = 330
.head 5 -  ! sErrCodeR - код ош. из @D
.head 5 -  Call SalFileWrite(hTick, strFNameS ||
     SalFmtFormatDateTime(SalDateCurrent(), 'yyMMdd') || SalStrRightX('0000'||SalFmtFormatDateTime(SalDateCurrent(), 'hhhhmm'), 4) ||
     SalStrRepeatX(' ', 6) || SalStrRepeatX(' ', 64) || SalStrRepeatX(' ', 6) || SalStrRepeatX(' ', 32) ||
     strFName ||
     IifS(dtFDate=DATETIME_Null, SalStrRepeatX(' ', 10), SalFmtFormatDateTime(dtFDate, 'yyMMdd') || SalStrRightX('0000'||SalFmtFormatDateTime(dtFDate, 'hhhhmm'), 4)) ||
     SalStrRightX('      '||Str(nRowR), 6) || SalStrRepeatX(' ', 64) || SalStrRepeatX(' ', 6) || SalStrRepeatX(' ', 32) ||
     sErrCodeR || SalStrRepeatX(' ', 64) || PutCrLf(), 330)
.head 5 -  ! из @D более подробно
.head 5 +  If Subs(SalStrUpperX(strCurrFile), 1, 2) = '@D'
.head 6 -  Set nRowS = 0
.head 6 +  If nRowR and sErrCodeR != '2103'
.head 7 -  Set nRow = TBL_MinRow
.head 7 +  While SalTblFindNextRow(hWndForm.frm_TicketsNI.tblTicRows, nRow, 0, 0)
.head 8 -  Call SalTblSetContext(hWndForm.frm_TicketsNI.tblTicRows, nRow)
.head 8 -  ! Если ошибка - пишем в файл @T
.head 8 +  If hWndForm.frm_TicketsNI.tblTicRows.colErrCode != ''
.head 9 -  Call SalFileWrite(hTick,
     SalStrRightX('      ' || Str(hWndForm.frm_TicketsNI.tblTicRows.colLineR),   6) ||
     SalStrRightX('    '   || hWndForm.frm_TicketsNI.tblTicRows.colErrCode, 4) || PutCrLf(), 12)
.head 9 -  Set nRowS = nRowS + 1
.head 8 -  ! Сохраняем информацию
.head 8 +  If NOT SqlPrepareAndExecute(hSql(),
"UPDATE lines_p
    SET dat_in_dpa  = :hWndForm.frm_TicketsNI.tblTicRows.colDatInDpa,
        dat_acc_dpa = :hWndForm.frm_TicketsNI.tblTicRows.colDatAccDpa,
        id_pr       = :hWndForm.frm_TicketsNI.tblTicRows.colPr,
        id_dpa      = :hWndForm.frm_TicketsNI.tblTicRows.colKodDpa,
        id_dps      = :hWndForm.frm_TicketsNI.tblTicRows.colKodDps,
        id_rec      = :hWndForm.frm_TicketsNI.tblTicRows.colId,
        fn_r        = :strFName,
        date_r      = :dtHFDate,
        n_r         = :hWndForm.frm_TicketsNI.tblTicRows.colLineR
  WHERE fn    = :hWndForm.frm_TicketsNI.tblTicRows.colNameF
    and n     = :hWndForm.frm_TicketsNI.tblTicRows.colLineF
    and nls   = :hWndForm.frm_TicketsNI.tblTicRows.colNls
    and otype in (1,6)")
.head 9 -  Call SqlRollback(hSql())
.head 9 -  Call SalFileClose(hTick)
.head 9 -  Call SalFileOpen(hTick, Rep_PathNI || '\\' || strFNameS, OF_Delete)
.head 9 -  Return FALSE
.head 6 -  Call SalFileSeek(hTick, 102+22, FILE_SeekBegin)
.head 6 -  Call SalFileWrite(hTick, SalStrRightX('      ' || Str(nRowS), 6), 6)
.head 5 -  Call SalFileClose(hTick)
.head 5 -  If FunBackUpFile(Rep_PathNI || '\\' || strFNameS, strBackupDir, FALSE)
.head 5 -  !
.head 5 +  If Subs(SalStrUpperX(strCurrFile), 1, 2) = '@D'
.head 6 -  Call SqlCommitEx(hSql(), 'Файл ' || strFName || ' принят и сквитован с кодом ' || sErrCodeR || ' (' || Rep_PathNI || '\\' || strFNameS || ')')
.head 6 -  Call SalMessageBox('Файл ' || strFName || ' прийнято і сквитовано з кодом ' || sErrCodeR || '.' || PutCrLf() ||
     'Сформовано файл-квитанцію ' || Rep_PathNI || '\\' || strFNameS || '.', 'Квитовка', MB_Ok | MB_IconAsterisk)
.head 5 +  Else
.head 6 -  Call SqlCommitEx(hSql(), 'Файл ' || strCurrFile || ' с кодом ' || strTECode || ' обработан (' || Rep_PathNI || '\\' || strFNameS || ')')
.head 6 -  Call SalMessageBox('Файл ' || strCurrFile || ' з кодом ' || strTECode || ' оброблено.'  || PutCrLf() ||
     '(' || Rep_PathNI || '\\' || strFNameS || ')', 'Квитовка', MB_Ok | MB_IconAsterisk)
.head 5 -  Return TRUE
.head 3 +  Function: FunPrintTicket
.head 4 -  Description: Печатает тикет в человеческой форме
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strFileName
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hTick
.head 5 -  Number: nRow
.head 5 -  String: strLine
.head 4 +  Actions
.head 5 -  Set strLine = 'Квитанция: ' || strFileName
.head 5 -  Set strFileName = GetPrnDir()  || '\\' || strFileName
.head 5 -  ! Call SalMessageBeep(MB_IconAsterisk)
.head 5 -  ! Call SalMessageBox('Копію буде збережено в файлі ' || strFileName, 'Увага!', MB_IconAsterisk | MB_Ok)
.head 5 +  ! If strTicketsMask = '@R*.*'
.head 6 -  Call TablePrint(hWndForm.frm_TicketsNI.tblTicRows, strLine, strFileName, '')
.head 5 +  ! Else
.head 6 +  If NOT SalFileOpen(hTick, strFileName, OF_Write | OF_Text)
.head 7 -  Call SalWaitCursor( FALSE )
.head 7 -  Call SalMessageBeep( MB_IconStop )
.head 7 -  Call SalMessageBox( 'Неможливо відкрити файл ' || strFileName, 'Помилка!', MB_IconStop | MB_Ok )
.head 7 -  Return FALSE
.head 6 -  !
.head 6 +  If NOT SalFilePutStr(hTick, strLine)
.head 7 -  Call SalWaitCursor( FALSE )
.head 7 -  Call SalMessageBeep( MB_IconStop )
.head 7 -  Call SalMessageBox( 'Неможливо записати в файл ' || strFileName, 'Помилка!', MB_IconStop | MB_Ok )
.head 7 -  Call SalFileClose ( hTick )
.head 7 -  Return FALSE
.head 6 -  Call SalFilePutStr(hTick, '')
.head 6 -  !
.head 6 -  Set nRow = TBL_MinRow
.head 6 +  While SalTblFindNextRow(tblTicRows, nRow, 0, 0)
.head 7 -  Call SalTblSetContext( tblTicRows, nRow )
.head 7 -  Set strLine = tblTicRows.colTag || ' ' || tblTicRows.colErrCode || ' ' || tblTicRows.colDetails
.head 7 +  If NOT SalFilePutStr( hTick, strLine )
.head 8 -  Call SalWaitCursor( FALSE )
.head 8 -  Call SalMessageBeep( MB_IconStop )
.head 8 -  Call SalMessageBox( 'Неможливо записати в файл ' || strFileName, 'Помилка!', MB_IconStop | MB_Ok )
.head 8 -  Call SalFileClose ( hTick )
.head 8 -  Return FALSE
.head 6 -  Call SalFileClose(hTick)
.head 5 -  Call TablePrint(hWndForm.frm_TicketsNI.tblTicRows, strLine, strFileName, '')
.head 5 -  !
.head 5 -  Call DosDirectPrint(strFileName)
.head 5 -  Return TRUE
.head 3 +  Function: FunSetErrToTbl
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nRow
.head 4 +  Actions
.head 5 -  Set nRow = SalTblInsertRow(hWndForm.frm_TicketsNI.tblTicRows, TBL_MaxRow)
.head 5 -  Call SalTblSetRowFlags(hWndForm.frm_TicketsNI.tblTicRows, nRow, ROW_New, FALSE)
.head 5 -  Call SalTblSetContext(hWndForm.frm_TicketsNI.tblTicRows, nRow)
.head 5 -  Set hWndForm.frm_TicketsNI.tblTicRows.colErrCode = '2103'
.head 5 +  If SqlPrepareAndExecute(hSql(),
'SELECT n_er INTO :hWndForm.frm_TicketsNI.tblTicRows.colDetails FROM s_er
 WHERE k_er = :hWndForm.frm_TicketsNI.tblTicRows.colErrCode' )
.head 6 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Set sErrCodeR = '2103'
.head 3 +  Function: FunProcessIF
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sCFName
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sStrErrorLines
.head 5 -  Number: i
.head 4 +  Actions
.head 5 -  ! strTFName - Найменування файла, що квитується
.head 5 -  ! dtTFDate  - Дата та час створення файла, що квитується
.head 5 -  ! strTECode - код ошибки главный
.head 5 -  ! nHNLines  - Кількість інформаційних рядків у файлі I
.head 5 +  If strTECode != "0000" and nHNLines
.head 6 +  If SalMessageBox("Файл прийнято з помилкою " || strTECode || ". " ||
   "Підготувати інформаційні рядки без помилок до повторної відправки ?",
   "Уваага!", MB_IconStop | MB_YesNo ) = IDYES
.head 7 -  ! обнуляем имя файла в информационных строках
.head 7 -  Set sStrErrorLines = ""
.head 7 -  Set i = 0
.head 7 +  While i < nHNLines
.head 8 -  Call SalTblSetContext(hWndForm.frm_TicketsNI.tblTicRows, i + 2)
.head 8 -  Set sStrErrorLines = sStrErrorLines || IifS(sStrErrorLines="", "", ",") || hWndForm.frm_TicketsNI.tblTicRows.colTag
.head 8 -  Set i = i + 1
.head 7 +  If sStrErrorLines
.head 8 +  If SqlPrepareAndExecute(hSql(),
"update ree_tmp
    set fn_o = null, dat_o = null, rec_o = null
  where fn_o = :strTFName and dat_o = :dtTFDate
    and rec_o not in (" || sStrErrorLines || ")")
.head 9 -  Call SqlCommit(hSql())
.head 8 +  Else
.head 9 -  Call SqlRollback(hSql())
.head 5 -  Return TRUE
.head 3 +  Function: FunProcessIFOnXml
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sTickName	! имя файла-квитанции
.head 5 -  String: sErrCode	! код ошибки квитуемого файла
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sFileName	! наименование квитуемого файла
.head 4 +  Actions
.head 5 -  ! @F2 -> @F0
.head 5 -  Set sFileName = SalStrReplaceX(sTickName, 2, 1, '0')
.head 5 +  If sErrCode != "0000"
.head 6 +  If SalMessageBox("Файл прийнято з помилкою " || sErrCode || ". " ||
   "Підготувати інформаційні рядки без помилок до повторної відправки ?",
   "Уваага!", MB_IconStop | MB_YesNo ) = IDYES
.head 7 -  ! обнуляем имя файла в информационных строках
.head 7 +  If SqlPrepareAndExecute(hSql(),
"update ree_tmp
    set fn_o = null, dat_o = null, rec_o = null
  where fn_o = :sFileName and err <> '0000'")
.head 8 -  Call SqlCommit(hSql())
.head 7 +  Else
.head 8 -  Call SqlRollback(hSql())
.head 5 -  Return TRUE
.head 3 +  Function: CreateBranchTickets
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nFileCount
.head 5 -  String: strBranchOld
.head 5 -  Boolean: bCloseFile
.head 5 -  Number: i
.head 5 -  String: strFName
.head 5 -  String: strErrCod
.head 5 -  !
.head 5 -  Number: nErrorCount
.head 5 -  Number: nmErrorLine[*]
.head 5 -  String: smErrorCode[*]
.head 5 -  String: smErrorTxt[*]
.head 5 -  String: sStrErrorLines
.head 5 -  !
.head 5 -  File Handle: hBranchTick
.head 5 -  Number: nFmode
.head 5 -  !
.head 5 -  Number: nKv
.head 5 -  Number: nOType
.head 5 -  String: sNameF
.head 5 -  String: strCurrDatLit
.head 5 -  String: strBranch
.head 5 -  String: strRecno
.head 5 -  String: strRecTxt
.head 5 -  String: strFileTic
.head 5 -  String: strDatIn
.head 5 -  String: strDatReg
.head 5 -  String: strDazs
.head 5 -  String: strNls
.head 5 -  String: strKv
.head 5 -  String: strClientnum
.head 5 -  String: strNmk
.head 5 -  String: strDst
.head 5 -  String: strReg
.head 5 -  String: strRez
.head 5 -  String: strMfo
.head 5 -  String: strOkpo
.head 5 -  String: strFileVidpDat
.head 5 -  String: strFileVidpId
.head 5 -  Number: nFileN
.head 5 -  Number: nRow
.head 4 +  Actions
.head 5 -  Set nFileCount = 0
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  ! закрытые
.head 5 +  If SalStrMidX(strCurrFile,0,2) = "@I"
.head 6 -  Set nErrorCount    = 0
.head 6 -  Set sStrErrorLines = ""
.head 6 -  Set strBranchOld = ""
.head 6 -  Set bCloseFile = FALSE
.head 6 -  ! strFName - оригинальное имя @F
.head 6 -  Set strFName = strTFName
.head 6 -  ! nHNLines - Кількість інформаційних рядків у файлі I
.head 6 +  If nHNLines
.head 7 -  Set i = 0
.head 7 +  While i < nHNLines
.head 8 -  Call SalTblSetContext(hWndForm.frm_TicketsNI.tblTicRows, i + 2)
.head 8 -  Set nmErrorLine[i] = Val(hWndForm.frm_TicketsNI.tblTicRows.colTag)
.head 8 -  Set smErrorCode[i] = hWndForm.frm_TicketsNI.tblTicRows.colErrCode
.head 8 -  Set smErrorTxt[i]  = hWndForm.frm_TicketsNI.tblTicRows.colDetails
.head 8 -  Set sStrErrorLines = sStrErrorLines || IifS(sStrErrorLines="", "", ",") || hWndForm.frm_TicketsNI.tblTicRows.colTag
.head 8 -  Set i = i + 1
.head 7 -  Set nErrorCount = i
.head 6 -  ! обработка информационных строк
.head 6 +  If SqlPrepareAndExecute(hSql(),
"select a.BRANCHCODE, to_char(f.n),
        'KIF' || decode(:nDPATTYPE,1,a.branchcode,lpad(nvl(a.branchcode,'0'),5,'0')||decode(f.otype,3,'2','5')) || substr(f.FN,7),
        to_char(f.ODATE,'yyyymmdd'), trim(a.accountide), a.r030,
        a.clientnum, f.NMKK, to_char(f.C_REG), to_char(f.NTAX), f.okpo
   into :strBranch, :strRecno, :strFileTic, :strDazs, :strNls, :strKv,
        :strClientnum, :strNmk, :strReg, :strDst, :strOkpo
   from zag_f z, lines_f f, account a
  where z.fn  = :strFName
    and z.dat = (select max(dat) from zag_f where fn = :strFName)
    and z.FN  = f.FN
    and z.dat = f.DAT
    and f.nls = trim(a.accountide)
    and to_char(f.kv) = a.r030
    and f.otype in (3, 5) " ||
        IifS(sStrErrorLines="", "", " and f.n not in (" || sStrErrorLines || ")") || "
  order by a.BRANCHCODE, f.n ")
.head 7 +  While SqlFetchNext(hSql(), nFetchRes)
.head 8 -  ! создаем файл (по смене отделения)
.head 8 +  If strBranchOld != strBranch
.head 9 +  If bCloseFile
.head 10 -  Call SalFileClose(hBranchTick)
.head 9 +  If NOT SalFileOpen(hBranchTick, strBranchTicketsDir  || '\\' || strFileTic, OF_Write)
.head 10 -  Call SalMessageBeep(MB_IconStop)
.head 10 -  Call SalMessageBox('Неможливо створити файл ' || strBranchTicketsDir  || '\\' || strFileTic||".", 'Помилка!', MB_IconStop | MB_Ok)
.head 10 -  Call SalWaitCursor(FALSE)
.head 10 -  Return FALSE
.head 9 -  Set strBranchOld = strBranch
.head 9 -  Set nFileCount   = nFileCount + 1
.head 9 -  Set bCloseFile   = TRUE
.head 8 -  Call SalFilePutStr ( hBranchTick, "-----------------------------------------------------------------------------" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Вiд ДПС отримано файл-квитанцiю "|| strCurrFile || " вiд " || SalFmtFormatDateTime( dtHFDate, 'dd/MM/yyyy hhhh:mm' ) )
.head 8 -  Call SalFilePutStr ( hBranchTick, " про пiдтвердження закриття рахунку:")
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Iдентифiкацiйний код клiєнта: "||strOkpo)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Реєстраційний код Bank-Master: "||strClientnum)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Назва клiєнта: "||strNmk)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Рахунок:                      "||strNls)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Код валюти:                   "||strKv)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Дата закриття:                "||strDazs)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Код областi:                  "||strReg)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Номер ДПС:                    "||strDst)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "  Повiдомлення про закриття рахунку вiдправлено в файлi:")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   " || strFName || " " || SalFmtFormatDateTime( dtTFDate, 'dd/MM/yyyy hhhh:mm' ) || " рядок " || strRecno)
.head 8 -  Call SalFilePutStr ( hBranchTick, "-----------------------------------------------------------------------------" )
.head 7 -  ! закрываем файл
.head 7 +  If bCloseFile
.head 8 -  Call SalFileClose(hBranchTick)
.head 6 -  ! Если есть строки с ошибками, формируем ERR
.head 6 +  If nErrorCount
.head 7 -  Set strBranchOld = ""
.head 7 -  Set bCloseFile   = FALSE
.head 7 +  If SqlPrepareAndExecute(hSql(),
"select f.n, a.branchcode, '0' ,
        'ERR' || decode(:nDPATTYPE,1,a.branchcode,lpad(nvl(a.branchcode,'0'),5,'0')||decode(f.otype,3,'2','5')) || substr(f.fn,7,6),
        to_char(f.dat,'yyyymmdd'), trim(a.accountide), a.r030,
        a.clientnum, f.nmkk, to_char(f.c_reg), to_char(f.ntax), f.okpo
   into :nFileN, :strBranch, :strRecno, :strFileTic, :strDazs, :strNls, :strKv,
        :strClientnum, :strNmk, :strReg, :strDst, :strOkpo
   from lines_f f, account a
  where f.fn = :strFName
    and f.n in (" || sStrErrorLines || ")
    and f.nls = trim(a.accountide)
    and to_char(f.kv) = a.r030
  order by a.BRANCHCODE, f.n")
.head 8 +  While SqlFetchNext(hSql(), nFetchRes)
.head 9 -  ! создаем файл (по смене отделения)
.head 9 +  If strBranchOld != strBranch
.head 10 +  If bCloseFile
.head 11 -  Call SalFileClose(hBranchTick)
.head 10 +  If NOT SalFileOpen( hBranchTick, strBranchTicketsDir  || '\\' || strFileTic, OF_Write )
.head 11 -  Call SalMessageBeep(MB_IconStop)
.head 11 -  Call SalMessageBox('Неможливо створити файл ' || strBranchTicketsDir  || '\\' || strFileTic||"."||"001", 'Помилка!', MB_IconStop | MB_Ok)
.head 11 -  Call SalWaitCursor(FALSE)
.head 11 -  Return FALSE
.head 10 -  Set strBranchOld = strBranch
.head 10 -  Set nFileCount   = nFileCount + 1
.head 10 -  Set bCloseFile   = TRUE
.head 9 -  ! надо найти в массиве индекс с номером строки nFileN
.head 9 -  Set strErrCod = STRING_Null
.head 9 -  Set strRecTxt = STRING_Null
.head 9 -  Set i = 0
.head 9 +  While i < nErrorCount
.head 10 +  If nmErrorLine[i] = nFileN
.head 11 -  Set strErrCod = smErrorCode[i]
.head 11 -  Set strRecTxt = smErrorTxt[i]
.head 11 -  Break
.head 10 -  Set i = i + 1
.head 9 -  Call SalFilePutStr ( hBranchTick, "-----------------------------------------------------------------------------" )
.head 9 -  Call SalFilePutStr ( hBranchTick, "      КВІТАНЦІЯ ПРО ПОМИЛКИ " )
.head 9 -  Call SalFilePutStr ( hBranchTick, "" )
.head 9 -  Call SalFilePutStr ( hBranchTick, "" )
.head 9 -  Call SalFilePutStr ( hBranchTick, "   Вiд ДПС отримано файл-квитанцiю з кодом помилки errcode = "|| strErrCod  )
.head 9 -  Call SalFilePutStr ( hBranchTick, "   (" || strRecTxt || ")")
.head 9 -  Call SalFilePutStr ( hBranchTick, "")
.head 9 -  Call SalFilePutStr ( hBranchTick, "")
.head 9 -  Call SalFilePutStr ( hBranchTick, "   Реєстрацiйний код клiєнта: "||strClientnum)
.head 9 -  Call SalFilePutStr ( hBranchTick, "")
.head 9 -  Call SalFilePutStr ( hBranchTick, "   Iдентифiкацiйний код клiєнта: "||strOkpo)
.head 9 -  Call SalFilePutStr ( hBranchTick, "")
.head 9 -  Call SalFilePutStr ( hBranchTick, "   Назва клiєнта: "||strNmk)
.head 9 -  Call SalFilePutStr ( hBranchTick, "")
.head 9 -  Call SalFilePutStr ( hBranchTick, "   Рахунок:                      "||strNls)
.head 9 -  Call SalFilePutStr ( hBranchTick, "")
.head 9 -  Call SalFilePutStr ( hBranchTick, "   Код валюти:                   "||strKv)
.head 9 -  Call SalFilePutStr ( hBranchTick, "")
.head 9 -  Call SalFilePutStr ( hBranchTick, "   Дата операції:                "||strDazs)
.head 9 -  Call SalFilePutStr ( hBranchTick, "")
.head 9 -  Call SalFilePutStr ( hBranchTick, "   Код областi:                  "||strReg)
.head 9 -  Call SalFilePutStr ( hBranchTick, "")
.head 9 -  Call SalFilePutStr ( hBranchTick, "   Номер ДПС:                    "||strDst)
.head 9 -  Call SalFilePutStr ( hBranchTick, "")
.head 9 -  Call SalFilePutStr ( hBranchTick, "")
.head 9 -  Call SalFilePutStr ( hBranchTick, "-----------------------------------------------------------------------------" )
.head 8 -  ! закрываем файл
.head 8 +  If bCloseFile
.head 9 -  Call SalFileClose(hBranchTick)
.head 5 -  ! открытые
.head 5 +  Else If SalStrMidX(strCurrFile,0,2) = "@R"
.head 6 -  ! dtHFDate - Дата та час створення файла I (D 	10 	13 - 22 )
.head 6 -  Set strFileVidpDat = SalFmtFormatDateTime(dtTFDate, 'yyMMdd')
.head 6 -  Call SqlPrepareAndExecute(hSql(), "SELECT substr(f_dat_lit(sysdate),1,100) INTO :strCurrDatLit FROM dual")
.head 6 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 6 -  Set nRow = TBL_MinRow
.head 6 +  While SalTblFindNextRow(hWndForm.frm_TicketsNI.tblTicRows, nRow, 0, 0)
.head 7 -  Call SalTblSetContext(hWndForm.frm_TicketsNI.tblTicRows, nRow)
.head 7 -  Set strNls = hWndForm.frm_TicketsNI.tblTicRows.colNls
.head 7 -  Set nKv    = hWndForm.frm_TicketsNI.tblTicRows.colKv
.head 7 -  Set sNameF = hWndForm.frm_TicketsNI.tblTicRows.colNameF
.head 7 -  Call SqlPrepareAndExecute(hSql(),"select BRANCHCODE into :strBranch from account where accountide = rpad(trim(:strNls),20,' ') ")
.head 7 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 7 +  If nDPATTYPE = 1
.head 8 -  Set strFileTic = 'KRF' || strBranch || SalStrMidX(strCurrFile,6,6)
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute(hSql(),
"select otype into :nOType
   from lines_f
  where nls = trim(:strNls) and kv = :nKv
    and fn = :sNameF and dat = (select max(dat) from lines_f where fn = :sNameF)")
.head 8 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 8 -  Set strFileTic = 'KRF' || SalStrRightX(SalStrRepeatX('0',5) || strBranch, 5) ||
    SalStrRightX('0' || IifS(nOType=1, '1', '6'), 1) || SalStrMidX(strCurrFile,6,6)
.head 7 +  If SalFileOpen(hBranchTick, strBranchTicketsDir || '\\' || strFileTic, OF_Exist)
.head 8 -  Set nFmode = OF_Append
.head 7 +  Else
.head 8 -  Set nFmode = OF_Write
.head 8 -  Set nFileCount = nFileCount + 1
.head 7 +  If not SalFileOpen(hBranchTick, strBranchTicketsDir  || '\\' || strFileTic, nFmode)
.head 8 -  Call SalMessageBeep(MB_IconStop)
.head 8 -  Call SalMessageBox('Неможливо створити файл ' || strBranchTicketsDir  || '\\' || strFileTic, 'Помилка!', MB_IconStop | MB_Ok)
.head 8 -  Call SalWaitCursor(FALSE)
.head 8 -  ! Return FALSE
.head 7 +  Else
.head 8 -  ! собственно квитанция
.head 8 -  Set strDatIn  = SalFmtFormatDateTime(hWndForm.frm_TicketsNI.tblTicRows.colDatInDpa, 'yyMMdd')
.head 8 -  Set strDatReg = SalFmtFormatDateTime(hWndForm.frm_TicketsNI.tblTicRows.colDatAccDpa, 'yyMMdd')
.head 8 -  Set strDazs   = SalFmtFormatDateTime(hWndForm.frm_TicketsNI.tblTicRows.colODat, 'yyMMdd')
.head 8 -  Set strErrCod = Str(hWndForm.frm_TicketsNI.tblTicRows.colPr)
.head 8 -  Set strNmk    = hWndForm.frm_TicketsNI.tblTicRows.colNmkk
.head 8 -  Set strClientnum = hWndForm.frm_TicketsNI.tblTicRows.colOkpo
.head 8 -  Set strRez    = Str(hWndForm.frm_TicketsNI.tblTicRows.colRezid)
.head 8 -  Set strMfo    = Str(hWndForm.frm_TicketsNI.tblTicRows.colMfo)
.head 8 -  Set strNls    = hWndForm.frm_TicketsNI.tblTicRows.colNls
.head 8 -  Set strKv     = Str(hWndForm.frm_TicketsNI.tblTicRows.colKv)
.head 8 -  Set strRecno  = Str(hWndForm.frm_TicketsNI.tblTicRows.colLineF)
.head 8 -  Set strDst    = Str(hWndForm.frm_TicketsNI.tblTicRows.colKodDpa)
.head 8 -  Set strReg    = Str(hWndForm.frm_TicketsNI.tblTicRows.colKodDps)
.head 8 -  Set strFileVidpId = hWndForm.frm_TicketsNI.tblTicRows.colId
.head 8 -  !
.head 8 -  Call SalFilePutStr ( hBranchTick, "--------------------------------------------------------------------------------------------------------" )
.head 8 -  Call SalFilePutStr ( hBranchTick, strCurrDatLit )
.head 8 +  If strErrCod = "0" or strErrCod = ""
.head 9 -  Call SalFilePutStr ( hBranchTick, "                                                                                               " )
.head 8 +  Else
.head 9 -  Call SalFilePutStr ( hBranchTick, "УВАГА !!! Відмовлено в реєстрації з кодом помилки "||strErrCod )
.head 8 -  Call SalFilePutStr ( hBranchTick, "                                                                                            Додаток 7   " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "                                Копія електронного файла-відповіді  " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "    щодо взяття на облік/закриття рахунку Платника податків в органі державної податкової служби " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "1.  Податковий номер або серiя та номер паспорта клiєнта: "||strClientnum )
.head 8 -  Call SalFilePutStr ( hBranchTick, "2.  Скорочене найменування Платника податків згідно з Повідомленням: "||strNmk )
.head 8 -  Call SalFilePutStr ( hBranchTick, "3.  Резидентність Платника податків: "||strRez )
.head 8 -  Call SalFilePutStr ( hBranchTick, "4.  Код фінансової установи, у якій відкрито рахунок: "||strMfo )
.head 8 -  Call SalFilePutStr ( hBranchTick, "5.  Дата операції: "||strDazs )
.head 8 -  Call SalFilePutStr ( hBranchTick, "6.  Номер рахунку: "||strNls )
.head 8 -  Call SalFilePutStr ( hBranchTick, "7.  Валюта рахунку: "||strKv )
.head 8 -  Call SalFilePutStr ( hBranchTick, "8.  Тип операції:    в і д к р и т т я" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "9.  Ідентифікатор запису в Повідомленні: "||strRecno )
.head 8 -  Call SalFilePutStr ( hBranchTick, "10. Дата отримання органом ДПС Повідомлення: "||strDatIn )
.head 8 -  Call SalFilePutStr ( hBranchTick, "11. Орган ДПС регiонального рiвня, який зазначено в Повідомленні " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "          як місце обліку Платника податків: "||strDst )
.head 8 -  Call SalFilePutStr ( hBranchTick, "12. Орган ДПС районного рiвня, який зазначено в Повідомленні як місце обліку " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "          Платника податків:"||strReg )
.head 8 -  Call SalFilePutStr ( hBranchTick, "13. Дата взяття на облік рахунку в органі ДПС: " ||strDatReg )
.head 8 -  Call SalFilePutStr ( hBranchTick, "14. Причина відмови в узятті на облік рахунку: " )
.head 8 +  If strErrCod != "0" and strErrCod != ""
.head 9 +  If strErrCod = "1"
.head 10 -  Call SalFilePutStr ( hBranchTick, "    Відсутність Платника податків на обліку в органі державної податкової"  )
.head 10 -  Call SalFilePutStr ( hBranchTick, "    служби"  )
.head 9 +  Else If strErrCod = "2"
.head 10 -  Call SalFilePutStr ( hBranchTick, "    Наявність в Єдиному державному реєстрі запису про державну реєстрацію"  )
.head 10 -  Call SalFilePutStr ( hBranchTick, "    припинення юридичної особи або припинення підприємницької діяльності "  )
.head 10 -  Call SalFilePutStr ( hBranchTick, "    фізичної особи-підприємця"  )
.head 9 +  Else If strErrCod = "3"
.head 10 -  Call SalFilePutStr ( hBranchTick, "    Наявність в Єдиному державному реєстрі запису про відсутність "  )
.head 10 -  Call SalFilePutStr ( hBranchTick, "    юридичної особи за її місцезнаходженням або запису про відсутність "  )
.head 10 -  Call SalFilePutStr ( hBranchTick, "    підтвердження відомостей про юридичну особу "  )
.head 8 -  Call SalFilePutStr ( hBranchTick, "15. Дата формування файла-відповіді: " || strFileVidpDat )
.head 8 -  Call SalFilePutStr ( hBranchTick, "16. Найменування файла-відповіді: " ||strCurrFile)
.head 8 -  Call SalFilePutStr ( hBranchTick, "17. Ідентифікатор запису у файлі-відповіді " || strFileVidpId  )
.head 8 -  Call SalFilePutStr ( hBranchTick, "18. Дозволяю розпочати операції на рахунку" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "Відповідальна особа фінансової установи     ________    ____________________ " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "                                            (підпис)    (прізвище, ініціали) " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "--------------------------------------------------------------------------------------------------------" )
.head 8 +  If NOT SalFileClose(hBranchTick)
.head 9 -  Call SalMessageBeep(MB_IconStop)
.head 9 -  Call SalMessageBox('Неможливо закрити файл ' || strBranchTicketsDir  || '\\' || strFileTic, 'Помилка!', MB_IconStop | MB_Ok)
.head 5 -  Call SalWaitCursor(FALSE)
.head 5 +  If nFileCount
.head 6 -  Call SalMessageBox("Сформовано " || SalNumberToStrX(nFileCount,0) || " квитанцій  (" || strBranchTicketsDir || ").", "Увага !", MB_IconAsterisk | MB_Ok)
.head 5 -  Return TRUE
.head 3 +  Function: CreateBranchTicketsOnXml
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sTickName
.head 5 -  Date/Time: sTickDate
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nFileCount
.head 5 -  String: strBranchOld
.head 5 -  Boolean: bCloseFile
.head 5 -  Number: i
.head 5 -  String: strFName
.head 5 -  !
.head 5 -  File Handle: hBranchTick
.head 5 -  Number: nFmode
.head 5 -  !
.head 5 -  Number: nKv
.head 5 -  Number: nOType
.head 5 -  String: sNameF
.head 5 -  String: strCurrDatLit
.head 5 -  String: strBranch
.head 5 -  String: strRecno
.head 5 -  String: strErrCod
.head 5 -  String: strRecTxt
.head 5 -  String: strFileTic
.head 5 -  String: strDatIn
.head 5 -  String: strDatReg
.head 5 -  String: strDazs
.head 5 -  String: strNls
.head 5 -  String: strKv
.head 5 -  String: strClientnum
.head 5 -  String: strNmk
.head 5 -  String: strDst
.head 5 -  String: strReg
.head 5 -  String: strRez
.head 5 -  String: strMfo
.head 5 -  String: strOkpo
.head 5 -  String: strFileVidpDat
.head 5 -  String: strFileVidpId
.head 5 -  Number: nRejectCode
.head 5 -  String: sRejectText
.head 5 -  Number: nFileN
.head 5 -  Number: nRow
.head 4 +  Actions
.head 5 -  Set nFileCount = 0
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  ! закрытые (вторая квитанция @F2/@P2)
.head 5 +  If SalStrMidX(sTickName,0,2) = "@F" or SalStrMidX(sTickName,0,2) = "@P"
.head 6 -  ! strFName - оригинальное имя @F
.head 6 -  Set strFName = SalStrReplaceX(sTickName, 2, 1, '0')
.head 6 -  ! обработка информационных строк
.head 6 -  Set strBranchOld = ""
.head 6 -  Set bCloseFile = FALSE
.head 6 -  Set strFileVidpDat  = SalFmtFormatDateTime(sTickDate, 'yyyyMMdd')
.head 6 +  If SqlPrepareAndExecute(hSql(),
"select a.BRANCHCODE, to_char(f.n),
        'KIF' || decode(:nDPATTYPE,1,a.branchcode,lpad(nvl(a.branchcode,'0'),5,'0')||decode(f.otype,3,'2','5')) || substr(f.fn,20,2) || '.' || substr(f.fn,22,3),
        to_char(f.ODATE,'yyyymmdd'), trim(a.accountide), a.r030,
        a.clientnum, f.NMKK, to_char(f.C_REG), to_char(f.NTAX), f.okpo, f.resid, f.mfo,
        to_char(f0.dat_in_dpa,'yyyymmdd'), to_char(f1.dat_acc_dpa,'yyyymmdd'), f.n
   into :strBranch, :strRecno, :strFileTic, :strDazs, :strNls, :strKv,
        :strClientnum, :strNmk, :strReg, :strDst, :strOkpo, :strRez, :strMfo,
        :strDatIn, :strDatReg, :strFileVidpId
   from lines_f f, account a,
        ( select nls, max(dat_in_dpa) dat_in_dpa
            from lines_f
           where otype = 1
             and trim(dat_in_dpa) is not null
           group by nls
        ) f0,
        ( select nls, max(dat_acc_dpa) dat_acc_dpa
            from lines_f
           where otype = 1
             and trim(dat_acc_dpa) is not null
           group by nls
        ) f1
  where f.fn  = :strFName and (:sTickDate is null and f.dat > sysdate-365 or f.dat = :sTickDate)
    and f.otype in (3, 5) 
    and f.err = '0000'
    and f.nls = trim(a.accountide)
    and to_char(f.kv) = a.r030
    and f.nls = f0.nls (+) and f.nls = f1.nls (+)
  order by a.BRANCHCODE, f.n ")
.head 7 +  While SqlFetchNext(hSql(), nFetchRes)
.head 8 -  ! создаем файл (по смене отделения)
.head 8 +  If strBranchOld != strBranch
.head 9 +  If bCloseFile
.head 10 -  Call SalFileClose(hBranchTick)
.head 9 +  If NOT SalFileOpen(hBranchTick, strBranchTicketsDir  || '\\' || strFileTic, OF_Write)
.head 10 -  Call SalMessageBeep(MB_IconStop)
.head 10 -  Call SalMessageBox('Неможливо створити файл ' || strBranchTicketsDir  || '\\' || strFileTic||".", 'Помилка!', MB_IconStop | MB_Ok)
.head 10 -  Call SalWaitCursor(FALSE)
.head 10 -  Return FALSE
.head 9 -  Set strBranchOld = strBranch
.head 9 -  Set nFileCount   = nFileCount + 1
.head 9 -  Set bCloseFile   = TRUE
.head 8 -  !
.head 8 -  Call SalFilePutStr ( hBranchTick, "-----------------------------------------------------------------------------------------------" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "                                                                                   Додаток 7   " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "                          Копiя електронного повiдомлення-вiдповiдi  " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "    щодо взяття на облiк/закриття рахунку платника податкiв у контролюючому органi " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "" )
.head 8 -  Call SalFilePutStr ( hBranchTick, " 1. Податковий номер або серiя та номер паспорта (для фiзичноi особи, яка через своi релiгiйнi " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "         переконання вiдмовилась вiд прийняття реестрацiйного номера облiковоi картки платника " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "         податкiв та повiдомила про це вiдповiдний контролюючий орган " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "         i мае вiдмiтку в паспортi) клiента: "||strOkpo )
.head 8 -  Call SalFilePutStr ( hBranchTick, " 2. Скорочене найменування (прiзвище,iм'я, по батьковi) платника податкiв згiдно ")
.head 8 -  Call SalFilePutStr ( hBranchTick, "     з повiдомленням: "||strNmk )
.head 8 -  Call SalFilePutStr ( hBranchTick, " 3. Резидентнiсть платника податкiв: "||strRez )
.head 8 -  Call SalFilePutStr ( hBranchTick, " 4. Код фiнансової установи, у якiй вiдкрито рахунок: "||strMfo )
.head 8 -  Call SalFilePutStr ( hBranchTick, " 5. Дата операцiї: "||strDazs )
.head 8 -  Call SalFilePutStr ( hBranchTick, " 6. Номер рахунку: "||strNls )
.head 8 -  Call SalFilePutStr ( hBranchTick, " 7. Валюта рахунку: "||strKv )
.head 8 -  Call SalFilePutStr ( hBranchTick, " 8. Тип операцiї:    з а к р и т т я" )
.head 8 -  Call SalFilePutStr ( hBranchTick, " 9. Дата надання повiдомлення до Мiндоходiв: "||strDatIn )
.head 8 -  Call SalFilePutStr ( hBranchTick, "10. Код регiону контролюючого органу, який зазначено в повiдомленнi " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "          як мiсце облiку платника податкiв: "||strReg )
.head 8 -  Call SalFilePutStr ( hBranchTick, "11. Код району контролюючого органу, який зазначено в повiдомленнi " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "          як мiсце облiку платника податкiв: "||strDst )
.head 8 -  Call SalFilePutStr ( hBranchTick, "12. Дата взяття на облiк рахунку в контролюючому органi: " ||strDatReg )
.head 8 -  Call SalFilePutStr ( hBranchTick, "13. Причина вiдмови в узяттi на облiк рахунку: " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "14. Дата формування файла-вiдповiдi: " ||strFileVidpDat )
.head 8 -  Call SalFilePutStr ( hBranchTick, "15. Найменування файла-вiдповiдi: " ||sTickName )
.head 8 -  Call SalFilePutStr ( hBranchTick, "16. Iдентифiкатор запису в повiдомленнi-вiдповiдi: "||strFileVidpId )
.head 8 -  Call SalFilePutStr ( hBranchTick, "17. Дозволяю розпочати операцii на рахунку " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "Вiдповiдальна особа фiнансової установи     ________    ____________________ " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "                                            (пiдпис)    (прiзвище, iнiцiали) " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "-----------------------------------------------------------------------------------------------" )
.head 7 -  ! закрываем файл
.head 7 +  If bCloseFile
.head 8 -  Call SalFileClose(hBranchTick)
.head 6 -  Set strFileVidpDat  = SalFmtFormatDateTime(sTickDate, 'yyyyMMdd')
.head 6 -  ! Если есть строки с ошибками, формируем ERR
.head 6 -  Set strBranchOld = ""
.head 6 -  Set bCloseFile   = FALSE
.head 6 +  If SqlPrepareAndExecute(hSql(),
"select f.n, a.branchcode, '0' ,
        'ERR' || decode(:nDPATTYPE,1,a.branchcode,lpad(nvl(a.branchcode,'0'),5,'0')||decode(f.otype,3,'2','5')) || substr(f.fn,20,2) || '.' || substr(f.fn,22,3),
        to_char(f.dat,'yyyymmdd'), trim(a.accountide), a.r030,
        a.clientnum, f.nmkk, to_char(f.c_reg), to_char(f.ntax), f.okpo, f.err
   into :nFileN, :strBranch, :strRecno, :strFileTic, :strDazs, :strNls, :strKv,
        :strClientnum, :strNmk, :strReg, :strDst, :strOkpo, :strErrCod
   from lines_f f, account a
  where f.fn = :strFName and (:sTickDate is null and dat > sysdate-365 or f.dat = :sTickDate)
    and f.err <> '0000'
    and f.nls = trim(a.accountide)
    and to_char(f.kv) = a.r030
  order by a.BRANCHCODE, f.n")
.head 7 +  While SqlFetchNext(hSql(), nFetchRes)
.head 8 -  ! создаем файл (по смене отделения)
.head 8 +  If strBranchOld != strBranch
.head 9 +  If bCloseFile
.head 10 -  Call SalFileClose(hBranchTick)
.head 9 +  If NOT SalFileOpen( hBranchTick, strBranchTicketsDir  || '\\' || strFileTic, OF_Write )
.head 10 -  Call SalMessageBeep(MB_IconStop)
.head 10 -  Call SalMessageBox('Неможливо створити файл ' || strBranchTicketsDir  || '\\' || strFileTic||"."||"001", 'Помилка!', MB_IconStop | MB_Ok)
.head 10 -  Call SalWaitCursor(FALSE)
.head 10 -  Return FALSE
.head 9 -  Set strBranchOld = strBranch
.head 9 -  Set nFileCount   = nFileCount + 1
.head 9 -  Set bCloseFile   = TRUE
.head 8 -  Call SqlPrepareAndExecute(hSqlAux(), "SELECT substr(err_msg,1,100) INTO :strRecTxt FROM dpa_err_codes WHERE err_code = :strErrCod")
.head 8 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 8 -  Call SalFilePutStr ( hBranchTick, "------------------------------------------------------------------------" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "           КВИТАНЦІЯ ПРО ПОМИЛКИ " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Вiд контролюючого органу отримано файл-квитанцiю з кодом помилки " )
.head 8 -  Call SalFilePutStr ( hBranchTick, " ErrCode="||strErrCod||"(" || strRecTxt || ")")
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Реєстрацiйний код клiєнта: "||strClientnum)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Iдентифiкацiйний код клiєнта: "||strOkpo)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Назва клiєнта: "||strNmk)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Рахунок:                      "||strNls)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Код валюти:                   "||strKv)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Дата операції:                "||strDazs)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Код регiону контролюючого органу: "||strReg)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "   Код району контролюючого органу:  "||strDst)
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "")
.head 8 -  Call SalFilePutStr ( hBranchTick, "------------------------------------------------------------------------" )
.head 7 -  ! закрываем файл
.head 7 +  If bCloseFile
.head 8 -  Call SalFileClose(hBranchTick)
.head 5 -  ! открытые
.head 5 +  Else If SalStrMidX(sTickName,0,2) = "@R"
.head 6 -  ! Дата та час створення файла R
.head 6 -  Call SqlPrepareAndExecute(hSql(), "select to_char(dat,'yyyyMMdd') into :strFileVidpDat from zag_f where fn = :sTickName and dat > sysdate-364")
.head 6 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 6 -  Call SqlPrepareAndExecute(hSql(), "SELECT substr(f_dat_lit(sysdate),1,100) INTO :strCurrDatLit FROM dual")
.head 6 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 6 -  !
.head 6 -  Call SqlPrepareAndExecute(hSql(), 
"select n, nls, kv, fn_f, to_char(dat_in_dpa,'yyyyMMdd'), to_char(dat_acc_dpa,'yyyyMMdd'),
        to_char(odate,'yyyyMMdd'), id_pr, nmkk, okpo, resid, mfo, n_f, id_dpa, id_dps
   into :strFileVidpId, :strNls, :nKv, :sNameF, :strDatIn, :strDatReg, :strDazs, :nRejectCode, 
        :strNmk, :strClientnum, :strRez, :strMfo, :strRecno, :strReg, :strDst
   from lines_r
  where fn = :sTickName and (:sTickDate is null and dat > sysdate-365 or dat = :sTickDate)")
.head 6 +  While SqlFetchNext(hSql(), nFetchRes)
.head 7 -  Call SqlPrepareAndExecute(hSqlAux(),"select BRANCHCODE into :strBranch from account where accountide = rpad(trim(:strNls),20,' ') ")
.head 7 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 7 +  If nDPATTYPE = 1
.head 8 -  Set strFileTic = 'KRF' || strBranch || Subs(sTickName, 20,2) || '.' || Subs(sTickName, 22,3)
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute(hSqlAux(),
"select otype into :nOType
   from lines_f
  where nls = trim(:strNls) and kv = :nKv and fn = :sNameF and otype in (1,6)")
.head 8 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 8 -  Set strFileTic = 'KRF' || SalStrRightX(SalStrRepeatX('0',5) || strBranch, 5) ||
    SalStrRightX('0' || IifS(nOType=1, '1', '6'), 1) || Subs(sTickName, 20,2) || '.' || Subs(sTickName, 22,3)
.head 7 +  If SalFileOpen(hBranchTick, strBranchTicketsDir || '\\' || strFileTic, OF_Exist)
.head 8 -  Set nFmode = OF_Append
.head 7 +  Else
.head 8 -  Set nFmode = OF_Write
.head 8 -  Set nFileCount = nFileCount + 1
.head 7 +  If not SalFileOpen(hBranchTick, strBranchTicketsDir  || '\\' || strFileTic, nFmode)
.head 8 -  Call SalMessageBeep(MB_IconStop)
.head 8 -  Call SalMessageBox('Неможливо створити файл ' || strBranchTicketsDir  || '\\' || strFileTic, 'Помилка!', MB_IconStop | MB_Ok)
.head 8 -  Call SalWaitCursor(FALSE)
.head 8 -  ! Return FALSE
.head 7 +  Else
.head 8 -  ! собственно квитанция
.head 8 -  Call SalFilePutStr ( hBranchTick, "-----------------------------------------------------------------------------------------------" )
.head 8 -  Call SalFilePutStr ( hBranchTick, strCurrDatLit )
.head 8 +  If nRejectCode = 0 or nRejectCode = NUMBER_Null
.head 9 -  Call SalFilePutStr ( hBranchTick, "                                                                                               " )
.head 8 +  Else
.head 9 -  Call SalFilePutStr ( hBranchTick, "УВАГА !!! Відмовлено в реєстрації з кодом помилки "||Str(nRejectCode) )
.head 8 -  Call SalFilePutStr ( hBranchTick, "                                                                                   Додаток 7   " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "                                Копія електронного повiдомлення-відповіді  " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "    щодо взяття на облік/закриття рахунку платника податків у контролюючому органі " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "1.  Податковий номер або серiя та номер паспорта (для фiзичноi особи, яка через своi релiгiйнi " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "         переконання вiдмовилась вiд прийняття реестрацiйного номера облiковоi картки платника " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "         податкiв та повiдомила про це вiдповiдний контролюючий орган " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "         i мае вiдмiтку в паспортi) клiента: "||strClientnum )
.head 8 -  Call SalFilePutStr ( hBranchTick, "2.  Скорочене найменування (прiзвище,iм'я,по батьковi) платника податків згідно " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "      з повідомленням: "||strNmk )
.head 8 -  Call SalFilePutStr ( hBranchTick, "3.  Резидентність Платника податків: "||strRez )
.head 8 -  Call SalFilePutStr ( hBranchTick, "4.  Код фінансової установи, у якій відкрито рахунок: "||strMfo )
.head 8 -  Call SalFilePutStr ( hBranchTick, "5.  Дата операції: "||strDazs )
.head 8 -  Call SalFilePutStr ( hBranchTick, "6.  Номер рахунку: "||strNls )
.head 8 -  Call SalFilePutStr ( hBranchTick, "7.  Валюта рахунку: "||Str(nKv) )
.head 8 -  Call SalFilePutStr ( hBranchTick, "8.  Тип операції:    в і д к р и т т я" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "9.  Дата надання повідомлення до Мiндоходiв: "||strDatIn )
.head 8 -  Call SalFilePutStr ( hBranchTick, "10. Код регiону контролюючого органу, який зазначено в повідомленні " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "          як місце обліку платника податків: "||strReg )
.head 8 -  Call SalFilePutStr ( hBranchTick, "11. Код району контролюючого органу, який зазначено в повідомленні " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "          як місце обліку платника податків: "||strDst )
.head 8 -  Call SalFilePutStr ( hBranchTick, "12. Дата взяття на облік рахунку в контролюючому органі: " ||strDatReg )
.head 8 -  Call SalFilePutStr ( hBranchTick, "13. Причина відмови в узятті на облік рахунку: " )
.head 8 +  If nRejectCode > 0
.head 9 -  Call SqlPrepareAndExecute(hSqlAux(),"select substr(err_msg,1,100) into :sRejectText from dpa_reject_codes where err_code = :nRejectCode")
.head 9 +  If SqlFetchNext(hSqlAux(), nFetchRes)
.head 10 -  Call SalFilePutStr ( hBranchTick, "    " || sRejectText )
.head 8 -  Call SalFilePutStr ( hBranchTick, "14. Дата формування файла-відповіді: "|| strFileVidpDat )
.head 8 -  Call SalFilePutStr ( hBranchTick, "15. Найменування файла-відповіді: "||sTickName)
.head 8 -  Call SalFilePutStr ( hBranchTick, "16. Ідентифікатор запису у Повідомленні-відповіді: "|| strFileVidpId  )
.head 8 -  Call SalFilePutStr ( hBranchTick, "17. Дозволяю розпочати операції на рахунку" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "" )
.head 8 -  Call SalFilePutStr ( hBranchTick, "Відповідальна особа фінансової установи     ________    ____________________ " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "                                            (підпис)    (прізвище, ініціали) " )
.head 8 -  Call SalFilePutStr ( hBranchTick, "-----------------------------------------------------------------------------------------------" )
.head 8 +  If NOT SalFileClose(hBranchTick)
.head 9 -  Call SalMessageBeep(MB_IconStop)
.head 9 -  Call SalMessageBox('Неможливо закрити файл ' || strBranchTicketsDir  || '\\' || strFileTic, 'Помилка!', MB_IconStop | MB_Ok)
.head 5 -  Call SalWaitCursor(FALSE)
.head 5 +  If nFileCount
.head 6 -  Call SalMessageBox("Сформовано " || SalNumberToStrX(nFileCount,0) || " квитанцій  (" || strBranchTicketsDir || ").", "Увага !", MB_IconAsterisk | MB_Ok)
.head 5 -  Return TRUE
.head 3 +  Function: CreateMessageFromDpa
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nFileCount
.head 5 -  String: sTicketsPath
.head 5 -  String: sFileNameF
.head 5 -  String: sTemplateId
.head 5 -  !
.head 5 -  String: sNls
.head 5 -  Number: nKv
.head 5 -  String: sOkpo
.head 5 -  String: sNmk
.head 5 -  Number: nResid
.head 5 -  Number: nOType
.head 5 -  Date/Time: dODate
.head 5 -  Number: nN
.head 5 -  Date/Time: dDatInDpa
.head 5 -  Number: nIdDpa
.head 5 -  Number: nIdDps
.head 5 -  Date/Time: dDatAccDpa
.head 5 -  Date/Time: dDateR
.head 5 -  Number: nNr
.head 5 -  String: sErr
.head 5 -  Number: nRow
.head 4 +  Actions
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  Set nFileCount = 0
.head 5 -  ! Путь к квитанциям
.head 5 -  Set sTicketsPath = GetPrnDir() || '\\DPA_' || Subs(strCurrFile,1,8)
.head 5 -  Call SalFileCreateDirectory(sTicketsPath)
.head 5 -  ! sFileNameF - strTFName - оригинальное имя @F
.head 5 -  Set sFileNameF = strTFName
.head 5 -  ! закрытые
.head 5 +  If SalStrMidX(strCurrFile,0,2) = "@I"
.head 6 -  Set sTemplateId = IifS(Subs(strCurrFile,3,1)='F', sDPAPRNTR, sDPAPRNTD) || '_CLOSE'
.head 6 -  ! обработка информационных строк
.head 6 +  If SqlPrepareAndExecute(hSql(),
"select nls, " || IifS(Subs(strCurrFile,3,1)='F', "kv", "null") || ", okpo, nmkk, resid, otype, odate, n, dat_in_dpa, id_dpa, id_dps, dat_acc_dpa, date_r, n_r, err
   into :sNls, :nKv, :sOkpo, :sNmk, :nResid, :nOType, :dODate, :nN, :dDatInDpa, :nIdDpa, :nIdDps, :dDatAccDpa, :dDateR, :nNr, :sErr
   from lines_" || Subs(strCurrFile,3,1) || "
  where fn  = :sFileNameF
    and dat = (select max(dat) from lines_" || Subs(strCurrFile,3,1) || " where fn=:sFileNameF)
    and otype in (3,5)")
.head 7 +  While SqlFetchNext(hSql(), nFetchRes)
.head 8 -  Set nFileCount = nFileCount + 1
.head 8 -  ! нормальная квитовка
.head 8 +  If sErr = '0000'
.head 9 -  Call PrintTicketDpa(sTicketsPath, sTemplateId, sNls, nKv)
.head 8 -  ! ошибки
.head 8 +  Else
.head 9 -  Call PrintTicketErr(sTicketsPath, sNls, nKv, sOkpo, sNmk, nResid, nOType, dODate, nIdDpa, nIdDps, sErr)
.head 5 -  ! открытые
.head 5 +  If SalStrMidX(strCurrFile,0,2) = "@R" or SalStrMidX(strCurrFile,0,2) = "@D"
.head 6 -  Set sTemplateId = IifS(Subs(strCurrFile,2,1)='R', sDPAPRNTR, sDPAPRNTD) || '_OPEN'
.head 6 -  ! обработка информационных строк
.head 6 -  Set nRow = TBL_MinRow
.head 6 +  While SalTblFindNextRow(tblTicRows, nRow, 0, 0)
.head 7 -  Call SalTblSetContext(tblTicRows, nRow)
.head 7 -  Set nFileCount = nFileCount + 1
.head 7 -  Set sNls = tblTicRows.colNls
.head 7 -  Set sErr = tblTicRows.colErrCode
.head 7 -  ! нормальная квитовка
.head 7 +  If sErr = '' or sErr = '0000'
.head 8 -  Call PrintTicketDpa(sTicketsPath, sTemplateId, sNls, nKv)
.head 7 -  ! ошибки
.head 7 +  Else
.head 8 -  Call PrintTicketErr(sTicketsPath, sNls, nKv, sOkpo, sNmk, nResid, nOType, dODate, nIdDpa, nIdDps, sErr)
.head 5 -  ! Сообщение
.head 5 +  If nFileCount
.head 6 -  Call SalMessageBox("Сформовано " || Str(nFileCount) || " повідомлень " || sTicketsPath, "Увага !", MB_IconAsterisk | MB_Ok)
.head 5 -  Call SalWaitCursor(FALSE)
.head 5 -  Return TRUE
.head 3 +  Function: CreateMessageFromDpaOnXml
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nFileCount
.head 5 -  String: sTicketsPath
.head 5 -  String: sFileNameF
.head 5 -  String: sTemplateId
.head 5 -  !
.head 5 -  String: sNls
.head 5 -  Number: nKv
.head 5 -  String: sOkpo
.head 5 -  String: sNmk
.head 5 -  Number: nResid
.head 5 -  Number: nOType
.head 5 -  Date/Time: dODate
.head 5 -  Number: nN
.head 5 -  Date/Time: dDatInDpa
.head 5 -  Number: nIdDpa
.head 5 -  Number: nIdDps
.head 5 -  Date/Time: dDatAccDpa
.head 5 -  Date/Time: dDateR
.head 5 -  Number: nNr
.head 5 -  String: sErr
.head 5 -  Number: nRow
.head 4 +  Actions
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  Set nFileCount = 0
.head 5 -  ! Путь к квитанциям
.head 5 -  Set sTicketsPath = GetPrnDir() || '\\DPA_' || strCurrFile
.head 5 -  Call SalFileCreateDirectory(sTicketsPath)
.head 5 -  ! sFileNameF - strTFName - оригинальное имя @F
.head 5 -  Set sFileNameF = SalStrReplaceX(strCurrFile, 2, 1, '0')
.head 5 -  ! закрытые (вторая квитанция @F2/@P2)
.head 5 +  If SalStrMidX(strCurrFile,3,1) = "2"
.head 6 -  Set sTemplateId = IifS(Subs(strCurrFile,1,2)='@F', sDPAPRNTR, sDPAPRNTD) || '_CLOSE'
.head 6 -  ! обработка информационных строк
.head 6 +  If SqlPrepareAndExecute(hSql(),
"select nls, " || IifS(Subs(strCurrFile,2,1)='F', "kv", "null") || ", okpo, nmkk, resid, otype, odate, n, dat_in_dpa, id_dpa, id_dps, dat_acc_dpa, date_r, n_r, err
   into :sNls, :nKv, :sOkpo, :sNmk, :nResid, :nOType, :dODate, :nN, :dDatInDpa, :nIdDpa, :nIdDps, :dDatAccDpa, :dDateR, :nNr, :sErr
   from lines_" || Subs(strCurrFile,2,1) || "
  where fn = :sFileNameF
    and otype in (3,5)")
.head 7 +  While SqlFetchNext(hSql(), nFetchRes)
.head 8 -  Set nFileCount = nFileCount + 1
.head 8 -  ! нормальная квитовка
.head 8 +  If sErr = '0000'
.head 9 -  Call PrintTicketDpa(sTicketsPath, sTemplateId, sNls, nKv)
.head 8 -  ! ошибки
.head 8 +  Else
.head 9 -  Call PrintTicketErr(sTicketsPath, sNls, nKv, sOkpo, sNmk, nResid, nOType, dODate, nIdDpa, nIdDps, sErr)
.head 5 -  ! открытые
.head 5 +  If SalStrMidX(strCurrFile,0,2) = "@R" or SalStrMidX(strCurrFile,0,2) = "@D"
.head 6 -  Set sTemplateId = IifS(Subs(strCurrFile,2,1)='R', sDPAPRNTR, sDPAPRNTD) || '_OPEN'
.head 6 -  ! обработка информационных строк
.head 6 +  If SqlPrepareAndExecute(hSqlAux(),
"select nls, " || IifS(Subs(strCurrFile,2,1)='R', "kv", "null") || ", okpo, nmkk, resid, odate, dat_in_dpa, id_dpa, id_dps, dat_acc_dpa, err
   into :sNls, :nKv, :sOkpo, :sNmk, :nResid, :dODate, :dDatInDpa, :nIdDpa, :nIdDps, :dDatAccDpa, :sErr
   from lines_r
  where fn = :strCurrFile")
.head 7 +  While SqlFetchNext(hSqlAux(), nFetchRes)
.head 8 -  Set nFileCount = nFileCount + 1
.head 8 -  ! нормальная квитовка
.head 8 +  If sErr = '' or sErr = '0000'
.head 9 -  Call PrintTicketDpa(sTicketsPath, sTemplateId, sNls, nKv)
.head 8 -  ! ошибки
.head 8 +  Else
.head 9 -  Call PrintTicketErr(sTicketsPath, sNls, nKv, sOkpo, sNmk, nResid, 1, dODate, nIdDpa, nIdDps, sErr)
.head 5 -  ! Сообщение
.head 5 +  If nFileCount
.head 6 -  Call SalMessageBox("Сформовано " || Str(nFileCount) || " повідомлень " || sTicketsPath, "Увага !", MB_IconAsterisk | MB_Ok)
.head 5 -  Call SalWaitCursor(FALSE)
.head 5 -  Return TRUE
.head 3 +  Function: PrintTicketDpa
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sTicketsPath
.head 5 -  String: sTemplateId
.head 5 -  String: sNls
.head 5 -  Number: nKv
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nId
.head 5 -  Long String: sDoc
.head 5 -  : cCnc
.head 6 -  Class: cABSConnect
.head 5 -  : cCnc2
.head 6 -  Class: cABSConnect
.head 5 -  String: sDocName
.head 5 -  File Handle: hFile
.head 4 +  Actions
.head 5 +  If SqlPrepareAndExecute(hSql(), "select acc into :nId from accounts where nls=:sNls and kv=:nKv")
and SqlFetchNext(hSql(), nFetchRes)
.head 6 -  Call XConnectGetParams( cCnc )
.head 6 +  If cCnc.Connect() and cCnc2.Clone( cCnc, TRUE )
.head 7 -  Set sDoc = cdoc_CreateDocFromTemplate( cCnc.hSql(), cCnc2.hSql(), sTemplateId,  nId, 0)
.head 7 +  If sDoc
.head 8 -  Set sDocName = GetTempFileName()
.head 8 +  If SalFileOpen(hFile, sDocName, OF_Write | OF_Create | OF_Text)
.head 9 -  Call SalFileWrite(hFile, sDoc, SalStrLength(sDoc))
.head 9 -  Call SalFileClose(hFile)
.head 9 -  Call SalFileCopy(sDocName, sTicketsPath || '\\' || sNls || '.rtf', TRUE)
.head 7 -  Call cCnc.Disconnect()
.head 7 -  Call cCnc2.Disconnect()
.head 5 -  Return TRUE
.head 3 +  Function: PrintTicketErr
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sTicketsPath
.head 5 -  String: sNls
.head 5 -  Number: nKv
.head 5 -  String: sOkpo
.head 5 -  String: sNmk
.head 5 -  Number: nResid
.head 5 -  Number: nOType
.head 5 -  Date/Time: dODate
.head 5 -  Number: nIdDpa
.head 5 -  Number: nIdDps
.head 5 -  String: sErr
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hFile
.head 5 -  String: sBankDateLit
.head 4 +  Actions
.head 5 +  If not SalFileOpen(hFile, sTicketsPath  || '\\' || sNls || '.err', OF_Write)
.head 6 -  Call SalMessageBeep(MB_IconStop)
.head 6 -  Call SalMessageBox('Неможливо створити файл ' || sTicketsPath  || '\\' || sNls || '.dpa', 'Помилка!', MB_IconStop | MB_Ok)
.head 6 -  Call SalWaitCursor(FALSE)
.head 6 -  Return FALSE
.head 5 -  Call SqlPrepareAndExecute(hSql(), "select substr(f_dat_lit(bankdate),1,50) into :sBankDateLit from dual")
.head 5 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Call SalFilePutStr(hFile, '')
.head 5 -  Call SalFilePutStr(hFile, sBankDateLit)
.head 5 -  Call SalFilePutStr(hFile, '')
.head 5 -  Call SalFilePutStr(hFile, '          КВИТАНЦІЯ ПРО ПОМИЛКИ')
.head 5 -  Call SalFilePutStr(hFile, '')
.head 5 -  Call SalFilePutStr(hFile, 'Код помилки: ' || sErr)
.head 5 -  Call SalFilePutStr(hFile, '')
.head 5 -  Call SalFilePutStr(hFile, 'Iдентифiкацiйний код клiєнта: ' || sOkpo)
.head 5 -  Call SalFilePutStr(hFile, 'Скорочена назва клiєнта: ' || sNmk)
.head 5 -  Call SalFilePutStr(hFile, 'Резидентність Платника податків: ' || Str(nResid))
.head 5 -  Call SalFilePutStr(hFile, 'Дата операції: ' || SalFmtFormatDateTime(dODate, 'dd.MM.yyyy'))
.head 5 -  Call SalFilePutStr(hFile, 'Номер рахунку: ' || sNls)
.head 5 -  Call SalFilePutStr(hFile, 'Валюта рахунку: ' || Str(nKv))
.head 5 -  Call SalFilePutStr(hFile, 'Тип операції: ' || IifS(nOType=1 or nOType=6, 'Відкриття', 'Закриття'))
.head 5 -  Call SalFilePutStr(hFile, 'Орган ДПС регіонального рівня: ' || Str(nIdDpa))
.head 5 -  Call SalFilePutStr(hFile, 'Орган ДПС районного рівня: ' || Str(nIdDps))
.head 5 -  !
.head 5 -  Call SalFileClose(hFile)
.head 3 +  Function: CreateTicketXml
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sTickName	! Имя файла-квитанции @R/@D
.head 5 -  String: sErrCode
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sFileName
.head 5 -  String: sFullName
.head 4 +  Actions
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  ! формируем данные для файла
.head 5 +  If not SqlPLSQLCommand(hSql(), "bars_dpa.form_ticket(sTickName, sErrCode, sFileName)")
.head 6 -  Call SqlRollback(hSql())
.head 6 -  Call SaveInfoToLog(DPA || sTickName || ': Помилка формування квитанції')
.head 6 -  Call SalWaitCursor(FALSE)
.head 6 -  Return FALSE
.head 5 -  Call SqlCommit(hSql())
.head 5 +  If sFileName
.head 6 -  Set sFullName = Rep_PathNI || '\\' || sFileName
.head 6 +  If not PutClobToFile(hSql(), sFullName, 'DPA_LOB', 'ID', 'FILE_DATA', 1, STRING_Null, STRING_Null)
.head 7 -  Call SalMessageBox('Помилка формування файлу', 'Помилка', MB_IconStop | MB_Ok)
.head 7 -  Call SaveInfoToLog(DPA || sTickName || ': Помилка формування квитанції')
.head 7 -  Call SalWaitCursor(FALSE)
.head 7 -  Return FALSE 
.head 6 -  Call SalMessageBox('Сформовано файл ' || sFullName, 'Інформація', MB_IconAsterisk | MB_Ok)
.head 6 -  Call SaveInfoToLog(DPA || sTickName || ': Сформовано квитанцію ' || sFullName)
.head 6 -  ! Копирование файла в архив
.head 6 -  Call FunBackUpFile(sFullName, strBackupDir, FALSE)
.head 5 -  Call SalWaitCursor(FALSE)
.head 5 -  Return TRUE
.head 2 +  Window Parameters
.head 3 -  Boolean: fReadWrite
.head 3 -  String: strTicketsPath
.head 3 -  String: strTicketsMask
.head 3 -  String: strHeaderStorage
.head 3 -  String: strLinesStorage
.head 2 +  Window Variables
.head 3 -  String: strWinTitle
.head 3 -  Boolean: bArc
.head 3 -  String: strBranchTicketsDir	! Путь для формирования квитанций отделений (АВАЛЬ)
.head 3 -  String: Rep_PathNI		! Путь для формирования @F
.head 3 -  String: strBackupDir		! Путь для backup
.head 3 -  Number: nDPATTYPE		! Параметр DPATYPE
.head 3 -  String: sDPAPRNTR		! Параметр DPAPRNTR - ДПА: Шаблон для друку повідомлень після обробки квитанцій @R
.head 3 -  String: sDPAPRNTD		! Параметр DPAPRNTD - ДПА: Шаблон для друку повідомлень після обробки квитанцій @D
.head 3 -  !
.head 3 -  File Handle: hT
.head 3 -  String: strCurrFile	! Имя текущего обрабатываемого файла-квитанции
.head 3 -  String: sFileCodeError	! Код ошибки квитуемого файла
.head 3 -  !
.head 3 -  String: strHFName	! Имя файла-квитанции из заголовка квитанции
.head 3 -  Date/Time: dtHFDate	! Дата/время файла-квитанции
.head 3 -  Number: nHNLines	! Число информационных строк файла-квитанции
.head 3 -  String: strTFName	! Имя квитуемого файла
.head 3 -  Date/Time: dtTFDate	! Дата/время квитуемого файла
.head 3 -  Number: nTNLines	! Число информационных строк квитуемого файла
.head 3 -  String: strTECode	! Код ошибки квитуемого файла
.head 3 -  !
.head 3 -  String: sErrCodeR	! код ошибки @R
.head 3 -  Number: nRowR		! кол-во строк @R
.head 3 -  !
.head 3 -  Number: nX
.head 3 -  Number: nY
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SetWindowFullSize(hWndForm)
.head 4 -  Call SalGetWindowText(hWndForm, strWinTitle, 254)
.head 4 -  Call SalSetWindowText(hWndForm, AppVersion || strWinTitle || ' [' || strTicketsMask || ']')
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 4 -  Set bArc = FALSE
.head 4 -  Call SalDisableWindow(pbFilter)
.head 4 -  Call SalHideWindow(tblTickets.colTickDate)
.head 4 -  !
.head 4 +  If NOT fReadWrite
.head 5 -  Call SalDisableWindow(pbDeleteFile)
.head 5 -  Call SalDisableWindow(pbProcessFile)
.head 5 -  Call SalDisableWindow(pbBackupFile)
.head 4 -  Set sDPAPRNTR = GetGlobalOption('DPAPRNTR')
.head 4 -  Set sDPAPRNTD = GetGlobalOption('DPAPRNTD')
.head 4 -  Set nDPATTYPE = GetGlobalOptionEx('DPATTYPE')
.head 4 +  If nDPATTYPE = 0
.head 5 -  Call SalDisableWindow(pbBranchTicketsDir)
.head 5 -  ! Call SalDisableWindow(pbArc)
.head 4 -  !
.head 4 +  If strTicketsMask = '@R*.*'
.head 5 -  Call SalShowWindow(tblTicRows.colMfo)
.head 5 -  Call SalShowWindow(tblTicRows.colOkpo)
.head 5 -  Call SalShowWindow(tblTicRows.colTgr)
.head 5 -  Call SalShowWindow(tblTicRows.colNmkk)
.head 5 -  Call SalShowWindow(tblTicRows.colODat)
.head 5 -  Call SalShowWindow(tblTicRows.colNls)
.head 5 -  Call SalShowWindow(tblTicRows.colKv)
.head 5 -  Call SalShowWindow(tblTicRows.colRezid)
.head 5 -  Call SalShowWindow(tblTicRows.colDatInDpa)
.head 5 -  Call SalShowWindow(tblTicRows.colDatAccDpa)
.head 5 -  Call SalShowWindow(tblTicRows.colPr)
.head 5 -  Call SalShowWindow(tblTicRows.colKodDpa)
.head 5 -  Call SalShowWindow(tblTicRows.colKodDps)
.head 5 -  Call SalShowWindow(tblTicRows.colId)
.head 5 -  Call SalShowWindow(tblTicRows.colNameF)
.head 5 -  Call SalShowWindow(tblTicRows.colLineF)
.head 5 -  Call SalShowWindow(tblTicRows.colLineR)
.head 5 -  Call SalTblSetColumnTitle(tblTicRows.colNameF, 'Имя @F')
.head 5 -  Call SalTblSetColumnTitle(tblTicRows.colLineF, 'Строка @F')
.head 5 -  Call SalTblSetColumnTitle(tblTicRows.colLineR, 'Строка @R')
.head 4 +  If strTicketsMask = '@D*.*'
.head 5 -  Call SalShowWindow(tblTicRows.colMfo)
.head 5 -  Call SalShowWindow(tblTicRows.colOkpo)
.head 5 -  Call SalShowWindow(tblTicRows.colTgr)
.head 5 -  Call SalShowWindow(tblTicRows.colNmkk)
.head 5 -  Call SalShowWindow(tblTicRows.colODat)
.head 5 -  Call SalShowWindow(tblTicRows.colNls)
.head 5 -  ! Call SalShowWindow(tblTicRows.colKv)
.head 5 -  Call SalShowWindow(tblTicRows.colRezid)
.head 5 -  Call SalShowWindow(tblTicRows.colDatInDpa)
.head 5 -  Call SalShowWindow(tblTicRows.colDatAccDpa)
.head 5 -  Call SalShowWindow(tblTicRows.colPr)
.head 5 -  Call SalShowWindow(tblTicRows.colKodDpa)
.head 5 -  Call SalShowWindow(tblTicRows.colKodDps)
.head 5 -  Call SalShowWindow(tblTicRows.colId)
.head 5 -  Call SalShowWindow(tblTicRows.colNameF)
.head 5 -  Call SalShowWindow(tblTicRows.colLineF)
.head 5 -  Call SalShowWindow(tblTicRows.colLineR)
.head 5 -  Call SalTblSetColumnTitle(tblTicRows.colNameF, 'Имя @P')
.head 5 -  Call SalTblSetColumnTitle(tblTicRows.colLineF, 'Строка @P')
.head 5 -  Call SalTblSetColumnTitle(tblTicRows.colLineR, 'Строка @D')
.head 4 -  !
.head 4 -  Call SalUseRegistry(FALSE, '')
.head 4 -  Call SalGetProfileString(INI_Directory, 'BackupDir', GetPrnDir(), strBackupDir, GetIniFileName())
.head 4 -  Call SalGetProfileString(INI_Directory, 'BranchTicketsDir', GetPrnDir(), strBranchTicketsDir, GetIniFileName())
.head 4 -  Call SalGetProfileString(INI_Directory, 'TaxRegistry', GetPrnDir(), Rep_PathNI, GetIniFileName())
.head 4 -  Call SalTblSetColumnTitle(tblTickets.colTickName, strTicketsPath)
.head 4 -  !
.head 3 +  On SAM_CreateComplete
.head 4 -  Call SalSendClassMessage(SAM_CreateComplete, wParam, lParam)
.head 4 -  Call SalSendMsg(tblTickets, UM_Populate, 0, 0)
.head 3 +  On VTM_Size
.head 4 -  Call SalGetWindowSize(hWndForm, nX, nY)
.head 4 -  Call SalSetWindowLoc(ccSplitter, nX*1/4, 0)
.head 4 -  Call SalSendClassMessage(VTM_Size, wParam, lParam)
.head 1 +  Dialog Box: dlg_ChooseNIFile
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Вобор файлу...
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  8.0"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 4.869"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Выбрать сформированный файл из хранилища
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Child Table: tblFileList
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.0"
.head 6 -  Top:    0.0"
.head 6 -  Width:  7.9"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 3.548"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: 9
.head 5 -  Font Enhancement: None
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 5000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: colFName
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Назва
файлу
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Right
.head 6 -  Width:  3.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFDate
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата файлу
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Center
.head 6 -  Width:  2.2"
.head 6 -  Width Editable? Yes
.head 6 -  Format: DateTime
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFCode
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
квитовки
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 4
.head 6 -  Data Type: String
.head 6 -  Justify: Right
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  ! strStorage
.head 6 +  Select Case nTip
.head 7 +  Case 1
.head 8 -  Set strStorage = 'ZAG_F'
.head 8 -  Break
.head 7 +  Case 3
.head 8 -  Set strStorage = 'ZAG_F'
.head 8 -  Break
.head 7 +  Case 4
.head 8 -  Set strStorage = 'ZAG_F'
.head 8 -  Break
.head 7 +  Case 5
.head 8 -  Set strStorage = 'ZAG_TB'
.head 8 -  Break
.head 7 +  Case 6
.head 8 -  Set strStorage = 'ZAG_TB'
.head 8 -  Break
.head 7 +  Default
.head 8 -  Return FALSE
.head 8 -  Break
.head 6 -  ! sWhere
.head 6 +  Select Case nTip
.head 7 +  Case 1
.head 8 -  Set sWhere  = "WHERE fn like '@F%'" ||
  IifS(sFilterTip[nTip]!='', " and (fn,dat) in (select l.fn, l.dat from lines_f l, accounts a
  where l.nls=a.nls and l.kv=a.kv and "||sFilterTip[nTip]||")", "")
.head 8 -  Break
.head 7 +  Case 3
.head 8 -  Set sWhere  = "WHERE fn like '@K%'"
.head 8 -  Break
.head 7 +  Case 4
.head 8 -  Set sWhere  = "WHERE fn like '@P%'"
.head 8 -  Break
.head 7 +  Case 5
.head 8 -  Set sWhere  = "WHERE fn like 'CV%'"
.head 8 -  Break
.head 7 +  Case 6
.head 8 -  Set sWhere  = "WHERE fn like 'CA%'"
.head 8 -  Break
.head 7 +  Default
.head 8 -  Set sWhere  = ""
.head 8 -  Break
.head 6 -  Call SalTblSetTableFlags(hWndItem, TBL_Flag_SingleSelection, TRUE)
.head 6 -  Call SalTblPopulate(hWndItem, hSql(),
"SELECT fn, dat, err INTO :colFName, :colFDate, :colFCode
 FROM " || strStorage || " " || sWhere || "
 ORDER BY dat DESC, fn", TBL_FillAll)
.head 6 -  Call SalTblSetContext( hWndItem, 0 )
.head 6 -  Call SalTblSetFocusRow( hWndItem, 0 )
.head 6 -  Call SalTblSetRowFlags( hWndItem, 0, ROW_Selected, TRUE )
.head 5 +  On UM_NoFontChange
.head 6 -  Return TRUE
.head 3 +  Pushbutton: pbFind
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cpbSearch
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Пошук
.head 4 -  Window Location and Size
.head 5 -  Left:   1.5"
.head 5 -  Top:    3.85"
.head 5 -  Width:  1.5"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: F7
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call TblFindString( tblFileList, DFIND_First )
.head 3 +  Pushbutton: pbOk
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cpbOk
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Вибрати
.head 4 -  Window Location and Size
.head 5 -  Left:   3.1"
.head 5 -  Top:    3.85"
.head 5 -  Width:  1.5"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Enter
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If SalTblAnyRows( tblFileList, ROW_Selected, 0 )
.head 7 -  Set strFName = tblFileList.colFName
.head 7 -  Set dtFDate = tblFileList.colFDate
.head 7 -  Call SaveInfoToLog( 'Выбран файл ' || strFName || ' за ' || SalFmtFormatDateTime( dtFDate, 'dd/MM/yyyy hhhh:mm' ) )
.head 7 -  Call SalEndDialog( hWndForm, 1 )
.head 3 +  Pushbutton: pbCancel
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cpbCancel
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Відмінити
.head 4 -  Window Location and Size
.head 5 -  Left:   4.7"
.head 5 -  Top:    3.85"
.head 5 -  Width:  1.5"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Esc
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SaveInfoToLog( 'Файл не выбран.' )
.head 6 -  Call SalEndDialog( hWndForm, 0 )
.head 3 -  Group Box:
.head 4 -  Resource Id: 9425
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.1"
.head 5 -  Top:    3.55"
.head 5 -  Width:  7.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 1.0"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Number: nTip
.head 3 -  String: sFilterTip[*]
.head 3 -  Receive String: strFName
.head 3 -  Receive Date/Time: dtFDate
.head 2 +  Window Variables
.head 3 -  String: strStorage
.head 3 -  String: sWhere
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalWaitCursor(TRUE)
.head 4 -  Call PrepareWindow(hWndForm)
.head 4 -  Call SalCenterWindow(hWndForm)
.head 3 +  On SAM_CreateComplete
.head 4 -  Call SalWaitCursor(FALSE)
.head 1 +  Dialog Box: dlg_ChooseNIKaz
.head 2 -  Class: cGenericTableDlg
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Статистика по файлам ДПА
.head 2 -  Accesories Enabled? Class Default
.head 2 -  Visible? Class Default
.head 2 -  Display Settings
.head 3 -  Display Style? Class Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Class Default
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  9.817"
.head 4 -  Width Editable? Class Default
.head 4 -  Height: 5.321"
.head 4 -  Height Editable? Class Default
.head 3 -  Absolute Screen Location? Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Class Default
.head 4 -  Location? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Size: Class Default
.head 4 -  Size Editable? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 3 +  Contents
.head 4 +  Pushbutton: pbIns
.head 5 -  Class Child Ref Key: 11
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDel
.head 5 -  Class Child Ref Key: 12
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 20
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbUpdate
.head 5 -  Class Child Ref Key: 15
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 9426
.head 5 -  Class Child Ref Key: 19
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbSearch
.head 5 -  Class Child Ref Key: 13
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbFilter
.head 5 -  Class Child Ref Key: 23
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbPrint
.head 5 -  Class Child Ref Key: 14
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDetails
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   3.355"
.head 6 -  Top:    0.05"
.head 6 -  Width:  0.43"
.head 6 -  Width Editable? No
.head 6 -  Height: 0.317"
.head 6 -  Height Editable? No
.head 5 -  Visible? Yes
.head 5 -  Keyboard Accelerator: F5
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: None
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\OPEN.BMP
.head 5 -  Picture Transparent Color: Gray
.head 5 -  Image Style: Single
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 -  If SalModalDialog(dlg_ChooseNIKazAcc, hWndMDI, tblFiles.colFileName, tblFiles.colFileDate)
.head 6 +  On SAM_TooltipSetText
.head 7 -  Return XSalTooltipSetText( lParam, 'Открыть содержимое файла' )
.head 4 -  Line
.head 5 -  Resource Id: 9427
.head 5 -  Class Child Ref Key: 21
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Coordinates
.head 6 -  Begin X:  3.95"
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  3.95"
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbOk
.head 5 -  Class Child Ref Key: 16
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   4.083"
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 +  If SalTblAnyRows( tblFiles, ROW_Selected, 0 )
.head 8 -  Set sFileName  = tblFiles.colFileName
.head 8 -  Set dtFileDate = tblFiles.colFileDate
.head 8 -  Call SalEndDialog( hWndForm, 1 )
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 17
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   4.517"
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 9428
.head 5 -  Class Child Ref Key: 22
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Coordinates
.head 6 -  Begin X:  5.067"
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  5.067"
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Data Field: dfDateFrom
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Data
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Editable? Yes
.head 5 -  Display Settings
.head 6 -  Window Location and Size
.head 7 -  Left:   6.483"
.head 7 -  Top:    0.071"
.head 7 -  Width:  1.5"
.head 7 -  Width Editable? Yes
.head 7 -  Height: 0.25"
.head 7 -  Height Editable? Yes
.head 6 -  Visible? Yes
.head 6 -  Border? Yes
.head 6 -  Justify: Left
.head 6 -  Format: dd-MM-yyyy
.head 6 -  Country: Default
.head 6 -  Font Name: Default
.head 6 -  Font Size: Default
.head 6 -  Font Enhancement: Default
.head 6 -  Text Color: Default
.head 6 -  Background Color: Default
.head 6 -  Input Mask: Unformatted
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set dfDateFrom = GetBankDate() - 10
.head 6 +  On SAM_AnyEdit
.head 7 -  Call SalSendMsg(pbRefresh, SAM_Click,0,0)
.head 4 -  Background Text: от даты:
.head 5 -  Resource Id: 9429
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Window Location and Size
.head 6 -  Left:   5.283"
.head 6 -  Top:    0.095"
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.167"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Justify: Right
.head 5 -  Font Name: Default
.head 5 -  Font Size: 10
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 2 +  Contents
.head 3 +  Child Table: tblFiles
.head 4 -  Class Child Ref Key: 8
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cGenericTableDlg
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  9.6"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 4.357"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: Class Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Class Default
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: colFileName
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Файл
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  2.067"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFileDate
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата файла
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Class Default
.head 6 -  Width:  2.333"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: DateTime
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFileCode
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
квитовки
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Center
.head 6 -  Width:  0.95"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colCntAcc
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Кол-во
счетов
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  0.9"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colCntAccept
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Кол-во
принят.
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  0.933"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colCntReject
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Кол-во
неприн.
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  0.867"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colCntBlkd
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Кол-во
блок.
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  0.8"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_FetchRowDone
.head 6 +  If tblFiles.colFileCode = STRING_Null
.head 7 -  Call XSalTblSetRowBackColor( hWndForm, lParam, getAttentionColor(COLOR_NO_I))
.head 6 +  Else
.head 7 +  If tblFiles.colFileCode!='0000'
.head 8 -  Call XSalTblSetRowBackColor( hWndForm, lParam, getAttentionColor(COLOR_STOP))
.head 5 +  On SAM_RowHeaderClick
.head 6 -  Call XSalTooltipSetColors(COLOR_Blue, COLOR_LightGray)
.head 6 -  ! Нету еще @IF
.head 6 +  If tblFiles.colFileCode = STRING_Null
.head 7 -  Call XSalTooltipShow(hWndForm, 'Нет квитанции @IF')
.head 6 +  Else
.head 7 +  If tblFiles.colFileCode!='0000'
.head 8 -  Call XSalTooltipShow(hWndForm, 'Файл отбит квитанцией @IF')
.head 5 +  On SAM_DoubleClick
.head 6 -  ! Set sFileName = colFileName
.head 6 -  ! Set dtFileDate = colFileDate
.head 6 -  Call SalSendMsg(pbOk,SAM_Click,0,0)
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Receive String: sFileName
.head 3 -  Receive Date/Time: dtFileDate
.head 2 -  Window Variables
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalWaitCursor( TRUE )
.head 4 -  Call SalCenterWindow( hWndForm )
.head 4 -  Set dlg_ChooseNIKaz.nFlags = GT_ReadOnly
.head 4 -  Set dlg_ChooseNIKaz.strSqlPopulate =
"select fn, dat, errcode, cntacc, cntblk, cntrej, cntaccpt
 into  :tblFiles.colFileName, :tblFiles.colFileDate, :tblFiles.colFileCode,
       :tblFiles.colCntAcc,   :tblFiles.colCntBlkd,  :tblFiles.colCntReject,   :tblFiles.colCntAccept
 from v_dpa_files
 where dat >= :dfDateFrom
 order by dat desc
"
.head 4 -  Call SalSendClassMessage( SAM_Create, wParam, lParam )
.head 1 +  Dialog Box: dlg_ChooseNIKazAcc
.head 2 -  Class: cGenericTableDlg
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Счета из файла !!!!
.head 2 -  Accesories Enabled? Class Default
.head 2 -  Visible? Class Default
.head 2 -  Display Settings
.head 3 -  Display Style? Class Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Class Default
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  18.767"
.head 4 -  Width Editable? Class Default
.head 4 -  Height: 7.167"
.head 4 -  Height Editable? Class Default
.head 3 -  Absolute Screen Location? Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Class Default
.head 4 -  Location? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Size: Class Default
.head 4 -  Size Editable? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 3 +  Contents
.head 4 +  Pushbutton: pbIns
.head 5 -  Class Child Ref Key: 11
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDel
.head 5 -  Class Child Ref Key: 12
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 20
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbUpdate
.head 5 -  Class Child Ref Key: 15
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 9430
.head 5 -  Class Child Ref Key: 19
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbSearch
.head 5 -  Class Child Ref Key: 13
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbFilter
.head 5 -  Class Child Ref Key: 23
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbPrint
.head 5 -  Class Child Ref Key: 14
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbSelectForFile
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   3.35"
.head 6 -  Top:    0.05"
.head 6 -  Width:  0.43"
.head 6 -  Width Editable? No
.head 6 -  Height: 0.317"
.head 6 -  Height Editable? No
.head 5 -  Visible? Yes
.head 5 -  Keyboard Accelerator: F5
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: None
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\DOC_OUT.BMP
.head 5 -  Picture Transparent Color: Gray
.head 5 -  Image Style: Single
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 -  Set nRow = TBL_MinRow
.head 7 -  Set nRow2 = TBL_MaxRow
.head 7 +  While SalTblFindNextRow(tblAcc, nRow, ROW_Selected, 0)
.head 8 -  Call SalTblSetContext(tblAcc, nRow)
.head 8 -  Call SalTblInsertRow ( frm_FilesNI.tblFTax, nRow2 )
.head 8 -  Set frm_FilesNI.tblFTax.MFO      = GetBankMfo()
.head 8 -  Set frm_FilesNI.tblFTax.OKPO     = tblAcc.colOkpo
.head 8 -  Set frm_FilesNI.tblFTax.TYP_REES = tblAcc.colReestrType
.head 8 -  Set frm_FilesNI.tblFTax.TYP_OPER = SalNumberToStrX(tblAcc.colOpType,0)
.head 8 -  Set frm_FilesNI.tblFTax.DAT_OPER = tblAcc.colOpDate
.head 8 -  ! Set frm_FilesNI.tblFTax.PR_NLS   = tblAcc.colNlsType
.head 8 -  Set frm_FilesNI.tblFTax.KV       = SalNumberToStrX(tblAcc.colKv,0)
.head 8 -  Set frm_FilesNI.tblFTax.NLS      = tblAcc.colNls
.head 8 -  !
.head 8 -  Set frm_FilesNI.tblFTax.REZ      = 1
.head 8 -  Set frm_FilesNI.tblFTax.NMS      = tblAcc.colNam
.head 8 -  Set frm_FilesNI.tblFTax.OBL      = SalNumberToStrX(tblAcc.colREGcode,0)
.head 8 -  Set frm_FilesNI.tblFTax.RAY      = SalNumberToStrX(tblAcc.colDPAcode,0)
.head 8 -  Set frm_FilesNI.tblFTax.ERR      = tblAcc.colRErrCode
.head 8 -  ! Set frm_FilesNI.tblFTax.NUMS     =
.head 8 -  Set frm_FilesNI.tblFTax.VID      = tblAcc.colVid
.head 8 -  !
.head 8 -  Set nRow2 = TBL_MinRow
.head 8 +  While SalTblFindNextRow(frm_FilesNI.tblFTax, nRow2, 0, 0)
.head 9 -  Call SalTblSetContext(frm_FilesNI.tblFTax, nRow2)
.head 9 -  Call SalTblSetRowFlags( frm_FilesNI.tblFTax, nRow2, 0,0 )
.head 6 +  On SAM_TooltipSetText
.head 7 -  Return XSalTooltipSetText( lParam, 'Добавить счета для формирования нового файла' )
.head 4 -  Line
.head 5 -  Resource Id: 9431
.head 5 -  Class Child Ref Key: 21
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Coordinates
.head 6 -  Begin X:  4.15"
.head 6 -  Begin Y:  0.333"
.head 6 -  End X:  4.15"
.head 6 -  End Y:  -0.083"
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbOk
.head 5 -  Class Child Ref Key: 16
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   4.283"
.head 6 -  Top:    0.548"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 17
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   4.217"
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 9432
.head 5 -  Class Child Ref Key: 22
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Coordinates
.head 6 -  Begin X:  4.767"
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  4.767"
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 2 +  Contents
.head 3 +  Child Table: tblAcc
.head 4 -  Class Child Ref Key: 8
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cGenericTableDlg
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  16.7"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 6.357"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: Class Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Class Default
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: colNls
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Счет
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  1.733"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colKv
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата файла
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  1.567"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Unformatted
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colBlkd
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Блк.
дб.
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.5"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNam
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наименование
клиента
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  2.25"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colOkpo
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: ОКПО
клиента
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  1.15"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colReestrType
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Тип
р-ра
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  0.533"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colREGcode
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
рег.
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  0.617"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDPAcode
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
ДПА
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  0.55"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colErrADesc
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Описание
ошибки
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  1.417"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFileR
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Файл
квитовки
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  1.733"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFileRDate
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата файла
квитовки
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Class Default
.head 6 -  Width:  1.983"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: DateTime
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFileRProcDate
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата обработки
файла квитовки
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Class Default
.head 6 -  Width:  1.983"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: DateTime
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colRErrCode
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Ош.
кв-ки
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  0.833"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colAErrCode
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Ош.
обр-ки
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  0.733"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colOpType
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Тип
опер.
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  0.65"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colOpDate
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: dd-MMM-yyyy
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNlsType
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: String
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVid
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colErrRDesc
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Описание ошибки
обработки
.head 6 -  Visible? No
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_FetchRowDone
.head 6 -  ! Не получена @IF
.head 6 +  If tblAcc.colRErrCode = STRING_Null
.head 7 -  Call XSalTblSetRowBackColor( hWndForm, lParam, getAttentionColor(COLOR_NO_I))
.head 6 +  Else
.head 7 +  If tblAcc.colRErrCode!='0000'
.head 8 -  Call XSalTblSetRowBackColor( hWndForm, lParam, getAttentionColor(COLOR_STOP))
.head 7 +  Else
.head 8 -  ! не получена квитанция @R
.head 8 +  If tblAcc.colAErrCode = NUMBER_Null  and colOpType
.head 9 -  ! операция -  открытия счтета (для закрытых счетов @R не получаем
.head 9 +  If tblAcc.colOpType != 3
.head 10 -  Call XSalTblSetRowBackColor( hWndForm, lParam, getAttentionColor(COLOR_NO_R))
.head 8 +  Else
.head 9 +  If tblAcc.colAErrCode!=0  or tblAcc.colBlkd!=0
.head 10 -  Call XSalTblSetRowBackColor( hWndForm, lParam, getAttentionColor(COLOR_BLOCK))
.head 5 +  On SAM_RowHeaderClick
.head 6 -  Call XSalTooltipSetColors(COLOR_Blue, COLOR_LightGray)
.head 6 -  ! Не получена @IF
.head 6 +  If tblAcc.colRErrCode = STRING_Null
.head 7 -  Call XSalTooltipShow(hWndForm, 'Нет квитанции @IF')
.head 6 +  Else
.head 7 +  If tblAcc.colRErrCode!='0000'
.head 8 -  Call XSalTooltipShow(hWndForm, 'Файл отбит квитанцией @IF с ошибкой: '||tblAcc.colErrADesc)
.head 7 +  Else
.head 8 -  ! не получена квитанция @R
.head 8 +  If tblAcc.colAErrCode = NUMBER_Null
.head 9 +  If tblAcc.colOpType != 3
.head 10 -  Call XSalTooltipShow(hWndForm, 'Не получена квитанция @R')
.head 8 +  Else
.head 9 +  If tblAcc.colAErrCode!=0  or tblAcc.colBlkd!=0
.head 10 -  Call XSalTooltipShow(hWndForm, 'Счет блокирован или обработан с ошибкой: '||tblAcc.colErrRDesc)
.head 5 +  ! On SAM_Create
.head 6 -  Call SalGetWindowSize ( SalParentWindow ( hWndForm ), nWid, nHei )
.head 6 -  Call SalSetWindowSize ( hWndForm , nWid, nHei )
.head 6 -  Call SalCenterWindow( hWndForm )
.head 5 +  ! On UM_ParentSize
.head 6 -  Call SalSetWindowSize ( hWndItem , wParam-0.7, 0.5*lParam )
.head 5 +  ! On WM_Size
.head 6 -  Call GetClientRect(hWndForm, nWinX, nWinY, nWinW, nWinH)
.head 6 -  Call SalSetWindowSize(hWndForm.Dlg_OpVobs.tbl, nWinW,
     SalPixelsToFormUnits(hWndForm.Dlg_OpVobs.tbl, nWinH, TRUE) - 0.4)
.head 6 -  Call SalSetWindowLoc(hWndForm.Dlg_OpVobs.dfDelIns, 0.1,
     SalPixelsToFormUnits(hWndForm.Dlg_OpVobs.dfDelIns, nWinH, TRUE)-0.3 )
.head 6 -  Call SalInvalidateWindow(hWndForm)
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: sFileName
.head 3 -  Date/Time: dtFileDate
.head 2 +  Window Variables
.head 3 -  Number: nRow
.head 3 -  Number: nRow2
.head 3 -  Number: nWinX
.head 3 -  Number: nWinY
.head 3 -  Number: nWinW
.head 3 -  Number: nWinH
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalWaitCursor( TRUE )
.head 4 -  Call SalSetWindowText ( hWndForm, 'Информация по счетам из файла '||sFileName)
.head 4 -  !
.head 4 -  !
.head 4 -  !
.head 4 -  Call SalGetWindowSize ( SalParentWindow ( hWndForm ), nWinW, nWinH )
.head 4 -  Call SalSetWindowSize ( hWndForm , nWinW, nWinH )
.head 4 -  Call SalCenterWindow( hWndForm )
.head 4 -  !
.head 4 -  Set nFlags = GT_ReadOnly
.head 4 -  Set strFilterTblName = 'V_DPA_ACCOUNTS'
.head 4 -  Set strPrintFileName = 'DPA_ACCOUNTS'
.head 4 -  Call SalEnableWindow(pbFilter)
.head 4 -  Set dlg_ChooseNIKazAcc.nTabInstance = 1
.head 4 -  !
.head 4 -  Set dlg_ChooseNIKazAcc.strSqlPopulate =
"select nls, nls_type, kv, blk, namk, okpo, odate, c_reg, c_dst, rtype,
        otype, fn_r, fnr_dat, fnr_procdat, errcode_r, errcode_a,
        substr(errmsg_a,1,200), substr(errmsg_r,1,200)
 into  :tblAcc.colNls, :tblAcc.colNlsType, :tblAcc.colKv, :tblAcc.colBlkd,
       :tblAcc.colNam,:tblAcc.colOkpo,  :tblAcc.colOpDate,
       :tblAcc.colREGcode, :tblAcc.colDPAcode, :tblAcc.colReestrType, :tblAcc.colOpType,
       :tblAcc.colFileR,:tblAcc.colFileRDate,:tblAcc.colFileRProcDate,
       :tblAcc.colRErrCode,:tblAcc.colAErrCode,
       :tblAcc.colErrRDesc, :tblAcc.colErrADesc
 from v_dpa_accounts
 where fn = '"||sFileName||
        "' and dat=to_date('"||
        SalFmtFormatDateTime( dtFileDate, 'ddMMyyyy hhhh:mm:ss' ) ||
           "', 'ddmmyyyy hh24:mi:ss') order by nls "
.head 4 -  Call SalSendClassMessage( SAM_Create, wParam, lParam )
.head 3 +  On WM_Size
.head 4 -  Call GetClientRect(hWndForm, nWinX, nWinY, nWinW, nWinH)
.head 4 -  Call SalSetWindowSize(tblAcc,
     SalPixelsToFormUnits(tblAcc, nWinW, FALSE) - 0.3,
     SalPixelsToFormUnits(tblAcc, nWinH, TRUE) - 0.2)
.head 4 -  Call SalInvalidateWindow(hWndForm)
