.head 0 +  Application Description: Работа с шаблонами документов
.head 1 -  Outline Version - 4.0.26
.head 1 +  Design-time Settings
.data VIEWINFO
0000: 6F00000001000000 FFFF01000D004347 5458566965775374 6174650400010000
0020: 0000000000CB0000 002C000000020000 0003000000FFFFFF FFFFFFFFFFF8FFFF
0040: FFE2FFFFFFFFFFFF FF000000007C0200 004D010000010000 0001000000010000
0060: 000F4170706C6963 6174696F6E497465 6D01000000075769 6E646F7773
.enddata
.data DT_MAKERUNDLG
0000: 02000000001C513A 5C4241525339385C 4C4942524152595C 43435F444F432E65
0020: 78651C513A5C4241 525339385C4C4942 524152595C43435F 444F432E646C6C1C
0040: 513A5C4241525339 385C4C4942524152 595C43435F444F43 2E61706300000101
0060: 011C513A5C424152 5339385C4C494252 4152595C43435F44 4F432E72756E1C51
0080: 3A5C424152533938 5C4C494252415259 5C43435F444F432E 646C6C1C513A5C42
00A0: 41525339385C4C49 42524152595C4343 5F444F432E617063 0000010101165C42
00C0: 41525339385C4269 6E5C43435F444F43 2E415044165C4241 525339385C42696E
00E0: 5C43435F444F432E 646C6C165C424152 5339385C42696E5C 43435F444F432E61
0100: 706300000101011C 513A5C4241525339 385C4C4942524152 595C43435F444F43
0120: 2E61706C1C513A5C 4241525339385C4C 4942524152595C43 435F444F432E646C
0140: 6C1C513A5C424152 5339385C4C494252 4152595C43435F44 4F432E6170630000
0160: 010101
.enddata
.head 2 -  Outline Window State: Normal
.head 2 +  Outline Window Location and Size
.data VIEWINFO
0000: 6600040003002D00 0000000000000000 0000B71E5D0E0500 1D00FFFF4D61696E
0020: 0000000000000000 0000000000000000 0000003B00010000 00000000000000E9
0040: 1E800A00008600FF FF496E7465726E61 6C2046756E637469 6F6E730000000000
0060: 0000000000000000 0000000000003200 0100000000000000 0000E91E800A0000
0080: DF00FFFF56617269 61626C6573000000 0000000000000000 0000000000000000
00A0: 3000010000000000 00000000F51E100D 0000F400FFFF436C 6173736573000000
00C0: 0000000000000000 0000000000000000
.enddata
.data VIEWSIZE
0000: D000
.enddata
.head 3 -  Left:   -0.013"
.head 3 -  Top:    0.0"
.head 3 -  Width:  8.013"
.head 3 -  Height: 4.969"
.head 2 +  Options Box Location
.data VIEWINFO
0000: 0418B80BB80B2500
.enddata
.data VIEWSIZE
0000: 0800
.enddata
.head 3 -  Visible? Yes
.head 3 -  Left:   4.15"
.head 3 -  Top:    1.885"
.head 3 -  Width:  3.8"
.head 3 -  Height: 2.073"
.head 2 +  Class Editor Location
.head 3 -  Visible? No
.head 3 -  Left:   0.575"
.head 3 -  Top:    0.094"
.head 3 -  Width:  5.063"
.head 3 -  Height: 2.719"
.head 2 +  Tool Palette Location
.head 3 -  Visible? No
.head 3 -  Left:   6.388"
.head 3 -  Top:    0.729"
.head 2 -  Fully Qualified External References? Yes
.head 2 -  Reject Multiple Window Instances? No
.head 2 -  Enable Runtime Checks Of External References? Yes
.head 2 -  Use Release 4.0 Scope Rules? No
.head 1 +  Libraries
.head 2 -  File Include: Winbars2.apl
.head 2 -  Dynalib: Global.apd
.head 2 -  Dynalib: Absapi.apd
.head 2 -  File Include: XSALIMG.APL
.head 2 -  File Include: GENTBL.APL
.head 2 -  File Include: MSOFFICE.APL
.head 2 -  File Include: Constant.apl
.head 2 -  File Include: vtdos.apl
.head 2 -  File Include: VTFILE.APL
.head 2 -  File Include: GENTBLD.APL
.head 1 +  Global Declarations
.head 2 +  Window Defaults
.head 3 +  Tool Bar
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Form Window
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Dialog Box
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Top Level Table Window
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Data Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Multiline Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Spin Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Background Text
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Pushbutton
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Radio Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Check Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Option Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Group Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Child Table Window
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  List Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Combo Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Line
.head 4 -  Line Color: Use Parent
.head 3 +  Frame
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: 3D Face Color
.head 3 +  Picture
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 2 +  Formats
.head 3 -  Number: 0'%'
.head 3 -  Number: #0
.head 3 -  Number: ###000
.head 3 -  Number: ###000;'($'###000')'
.head 3 -  Date/Time: hh:mm:ss AMPM
.head 3 -  Date/Time: M/d/yy
.head 3 -  Date/Time: MM-dd-yy
.head 3 -  Date/Time: dd-MMM-yyyy
.head 3 -  Date/Time: MMM d, yyyy
.head 3 -  Date/Time: MMM d, yyyy hh:mm AMPM
.head 3 -  Date/Time: MMMM d, yyyy hh:mm AMPM
.head 3 -  Date/Time: MM/dd/yyyy
.head 3 -  Date/Time: dd/MM/yyyy
.head 3 -  Date/Time: dd/MM/yyyy hh:mm AMPM
.head 3 -  Date/Time: dd/MM/yyyy hh:mm:ss
.head 3 -  Date/Time: dd/MM/yyyy hhhh:mm:ss
.head 2 +  External Functions
.head 3 +  Library name: qolei11.dll
.data CLASSPROPSSIZE
0000: 3300
.enddata
.data CLASSPROPS
0000: 5459504547554944 0027007B44393236 343141302D444637 392D313143462D38
0020: 4537342D30304130 4339304632364638 7D0000
.enddata
.head 4 +  Function: XGetRightMargin
.head 5 -  Description:
.head 5 -  Export Ordinal: 9
.head 5 +  Returns
.head 6 -  Number: FLOAT
.head 5 +  Parameters
.head 6 -  Number: DWORD
.head 6 -  Number: DWORD
.head 6 -  Number: LONG
.head 6 -  String: LPSTR
.head 4 +  Function: XSetRightMargin
.head 5 -  Description:
.head 5 -  Export Ordinal: 2
.head 5 -  Returns
.head 5 +  Parameters
.head 6 -  Number: DWORD
.head 6 -  Number: DWORD
.head 6 -  Number: LONG
.head 6 -  String: LPSTR
.head 6 +  structPointer
.head 7 -  Number: FLOAT
.head 4 +  Function: XGetSelRTF
.head 5 -  Description:
.head 5 -  Export Ordinal: 3
.head 5 +  Returns
.head 6 -  String: HSTRING
.head 5 +  Parameters
.head 6 -  Number: DWORD
.head 6 -  Number: DWORD
.head 6 -  Number: LONG
.head 6 -  String: LPSTR
.head 4 +  Function: XSetSelRTF
.head 5 -  Description:
.head 5 -  Export Ordinal: 2
.head 5 -  Returns
.head 5 +  Parameters
.head 6 -  Number: DWORD
.head 6 -  Number: DWORD
.head 6 -  Number: LONG
.head 6 -  String: LPSTR
.head 6 +  structPointer
.head 7 -  String: HSTRING
.head 4 +  Function: XGetSelText
.head 5 -  Description:
.head 5 -  Export Ordinal: 3
.head 5 +  Returns
.head 6 -  String: HSTRING
.head 5 +  Parameters
.head 6 -  Number: DWORD
.head 6 -  Number: DWORD
.head 6 -  Number: LONG
.head 6 -  String: LPSTR
.head 4 +  Function: XSetSelText
.head 5 -  Description:
.head 5 -  Export Ordinal: 2
.head 5 -  Returns
.head 5 +  Parameters
.head 6 -  Number: DWORD
.head 6 -  Number: DWORD
.head 6 -  Number: LONG
.head 6 -  String: LPSTR
.head 6 +  structPointer
.head 7 -  String: HSTRING
.head 4 +  Function: XGetText
.head 5 -  Description:
.head 5 -  Export Ordinal: 3
.head 5 +  Returns
.head 6 -  String: HSTRING
.head 5 +  Parameters
.head 6 -  Number: DWORD
.head 6 -  Number: DWORD
.head 6 -  Number: LONG
.head 6 -  String: LPSTR
.head 4 +  Function: XSetText
.head 5 -  Description:
.head 5 -  Export Ordinal: 2
.head 5 -  Returns
.head 5 +  Parameters
.head 6 -  Number: DWORD
.head 6 -  Number: DWORD
.head 6 -  Number: LONG
.head 6 -  String: LPSTR
.head 6 +  structPointer
.head 7 -  String: HSTRING
.head 4 +  Function: XGetTextRTF
.head 5 -  Description:
.head 5 -  Export Ordinal: 3
.head 5 +  Returns
.head 6 -  String: HSTRING
.head 5 +  Parameters
.head 6 -  Number: DWORD
.head 6 -  Number: DWORD
.head 6 -  Number: LONG
.head 6 -  String: LPSTR
.head 4 +  Function: XSetTextRTF
.head 5 -  Description:
.head 5 -  Export Ordinal: 2
.head 5 -  Returns
.head 5 +  Parameters
.head 6 -  Number: DWORD
.head 6 -  Number: DWORD
.head 6 -  Number: LONG
.head 6 -  String: LPSTR
.head 6 +  structPointer
.head 7 -  String: HSTRING
.head 2 +  Constants
.data CCDATA
0000: 3000000000000000 0000000000000000 00000000
.enddata
.data CCSIZE
0000: 1400
.enddata
.head 3 +  System
.head 3 +  User
.head 4 -  Number: CDOC_ATTR_NAME = 0
.head 4 -  Number: CDOC_ATTR_VALUE = 1
.head 4 -  Number: CDOC_ATTR_TYPE = 2
.head 4 -  Number: CDOC_ATTR_LENGTH = 3
.head 4 -  ! Максимальная длина RTF документа 16Мб
.head 4 -  Number: CDOC_MAX_RTF_LENGTH = 16777216
.head 4 -  Number: CDOC_DT_Text = 22
.head 4 -  Number: CDOC_DT_Binary = 23
.head 4 -  Number: CDOC_STATE_START = 0
.head 4 -  Number: CDOC_STATE_ID0 = 1
.head 4 -  Number: CDOC_STATE_ID_START = 2
.head 4 -  Number: CDOC_MSG_FetchRow = SAM_User
.head 4 -  Number: CDOC_FREQ_Never = 0
.head 4 -  Number: CDOC_FREQ_Day = 1
.head 4 -  Number: CDOC_FREQ_Free = 2
.head 4 -  Number: CDOC_FREQ_Week = 3
.head 4 -  Number: CDOC_FREQ_Month = 5
.head 4 -  Number: CDOC_FREQ_Quarter = 7
.head 4 -  Number: CDOC_FREQ_HalfYear = 180
.head 4 -  Number: CDOC_FREQ_Year = 360
.head 2 +  Resources
.head 2 +  Variables
.head 3 -  Boolean: bApdInited
.head 3 -  Boolean: isCLOB
.head 3 -  Window Handle: cdoc_hWndParent
.head 3 -  Sql Handle: cdoc_hSql
.head 3 -  Sql Handle: cdoc_hSqlAux
.head 3 -  Number: cdoc_nFetchRes
.head 3 -  String: CDOC_TempFileName
.head 3 -  String: CDOC_RTFEditorProgram 
.head 3 -  String: CDOC_RTFPrintProgram
.head 3 -  String: CDOC_CRLF
.head 3 -  Window Handle: hWndAllDocs
.head 3 -  Window Handle: hWinCC
.head 3 -  Boolean: CompressDocs
.head 2 +  Internal Functions
.head 3 +  Function: IniCcDoc
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: strPathToLangResources
.head 5 -  String: strLangId
.head 5 -  String: strFileName
.head 4 +  Actions
.head 5 +  If not bApdInited
.head 6 -  Set isCLOB = GetGlobalOption('CDOCCLOB') = '1'
.head 6 -  Set bStaticsAsWindows = TRUE
.head 6 -  Set strPathToLangResources = GetLangPath()
.head 6 -  Set strLangId = GetLang()
.head 6 -  Set strFileName = strPathToLangResources || "\\" || strLangId || "\\cc_doc.lng"
.head 6 +  If (NOT strLangId) OR (NOT CurrentLangTable.InitFromFile(strFileName, strLangId))
.head 7 -  Call CurrentLangTable.Init()
.head 7 -  ! ====================================================
.head 7 -  Call CurrentLangTable.AddAtom('cTErr','Ошибка!')
.head 7 -  Call CurrentLangTable.AddAtom('cTAt','Внимание!')
.head 7 -  ! ====================================================
.head 7 -  ! cdoc_List
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_List.cTWndTitle','Список шаблонов договоров')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_List.ID','Идентификатор')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_List.NAME','Название документа')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_List.TEMPLATE','Текст шаблона')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_List.DCLOSE','Дата~закрытия')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_List.colPrintOnBlank','Печать~на бланках')
.head 7 -  ! Button strTip
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_List.cBTipDetails','Редактировать')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_List.cBTipAttrs','Реквизиты шаблонов')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_List.cBTipDocs','Привязка')
.head 7 -  ! message text
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_List.cTMessFormatError','Неверный формат файла!')
.head 7 -  ! constant
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_List.cTFiles','Файлы')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_List.cTFileSelect','Выберите файл')
.head 7 -  ! ====================================================
.head 7 -  ! cdoc_AttributesList
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_AttributesList.cTWndTitle','Редактирование атрибутов документа')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_AttributesList.ID','Идентификатор')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_AttributesList.NAME','Наименование атрибута')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_AttributesList.SQL','SQL выражение')
.head 7 -  ! ====================================================
.head 7 -  ! cdoc_dlgBindDocsToDeal
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgBindDocsToDeal.cTWndTitle','Документы, связанные с договором')
.head 7 -  !
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgBindDocsToDeal.pbAppend','Добавить')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgBindDocsToDeal.pbDelete','Удалить')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgBindDocsToDeal.pbCommit','Сохранить')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgBindDocsToDeal.pbQuit','Выход')
.head 7 -  ! tblTemplatesList
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgBindDocsToDeal.tblTemplatesList.colID','Идентификатор')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgBindDocsToDeal.tblTemplatesList.colName','Наименование документа')
.head 7 -  ! bg
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgBindDocsToDeal.bgVidName','Вид договора:')
.head 7 -  ! message text
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgBindDocsToDeal.cTMessSave','Сохранять измененный список документов в базе?')
.head 7 -  ! constants
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgBindDocsToDeal.cTSave','Сохранение изменений')
.head 7 -  ! ====================================================
.head 7 -  ! cdoc_dlgGetChoice
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgGetChoice.cTWndTitle','Выбор варианта')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgGetChoice.pbOk','Выбрать')
.head 7 -  ! ====================================================
.head 7 -  ! cdoc_dlgGetString
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgGetString.pbOk','Ввод')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgGetString.pbCancel','Отмена')
.head 7 -  ! ====================================================
.head 7 -  ! cdoc_dlgTemplatesList
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.cTWndTitle','Список шаблонов документов')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.pbAppend','Новый')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.pbCopy','Копировать')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.pbDelete','Удалить')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.pbDocs','Привязка')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.pbEdit','Редакт.')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.pbCommit','Сохранить')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.pbQuit','Выход')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.pbAttrs','Реквизиты')
.head 7 -  !
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.tblTemplatesList.colID','Идентификатор')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.tblTemplatesList.colName','Название документа')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.tblTemplatesList.colTamplate','Текст шаблона')
.head 7 -  ! message text
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.cTMessId','Неуникальный идентификатор шаблона документа')
.head 7 -  ! error text
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.cTErrId','Ошибка: недопустимый идентификатор')
.head 7 -  ! constants
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.cTNew','Новый шаблон документа')
.head 7 -  Call CurrentLangTable.AddAtom('cdoc_dlgTemplatesList.cTUniqueId','Введите уникальный идентификатор шаблона:')
.head 7 -  ! ====================================================
.head 7 -  ! dlg_DocumentList
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.cTWndTitle','Список документов по договору №')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.tbl.colID','Код шаблона')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.tbl.colNAME','Наименование шаблона')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.tbl.colADDS','№ доп. согл.')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.tbl.colVERSION','Дата сохранения')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.tbl.colSTATE','Подписан')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.tbl.colUserName','Исполнитель')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.tbl.colComm','Комментарий')
.head 7 -  ! Button strTip
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.cBTipOk','Посмотреть/Редактировать выбранный документ')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.cBTipSign','Подписать договор')
.head 7 -  ! message text
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.cTMessDocIsSign','Документ уже подписан!')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.cTMessOpenDoc','Открыть документ для просмотра?')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.cTMessSignDoc','Вы уверены, что хотите подписать документ?')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.cTMessSignDoc_','После подписания документа его редактирование и удаление станет невозможным!')
.head 7 -  ! constants
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.cTTextDogUpdate','Перезаписан в БД текст договора №')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.cTTextDogAdd','Добавлен текст договора №')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_DocumentList.cTConfirm','Подтверждение')
.head 7 -  ! ====================================================
.head 7 -  ! dlg_SelectTemplate
.head 7 -  Call CurrentLangTable.AddAtom('dlg_SelectTemplate.cTWndTitle','Список шаблонов документов')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_SelectTemplate.tbl.colID','Код шаблона')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_SelectTemplate.tbl.colNAME','Наименование шаблона')
.head 7 -  ! ====================================================
.head 6 -  Set bApdInited = TRUE
.head 5 -  ! Call CurrentLangTable.SaveToFile('C:\\TEMP\\cc_doc.lng','RUS')
.head 5 -  Return bApdInited
.head 3 +  Function: cdoc_Initialize               ! __exported
.head 4 -  Description: Инициализация модуля работы с шаблонами договоров
.head 4 +  Returns
.head 5 -  Boolean: fOk
.head 4 +  Parameters
.head 5 -  Window Handle: in_hWndParent
.head 5 -  Sql Handle: in_hSql
.head 5 -  Sql Handle: in_hSqlAux
.head 5 -  String: in_TempFileName
.head 5 -  String: in_RTFEditorProgram
.head 5 -  String: in_RTFPrintProgram
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: strPAR
.head 5 -  String: strVAL
.head 5 -  Number: nFetchRes
.head 4 +  Actions
.head 5 -  Call IniCcDoc()
.head 5 -  Set cdoc_hWndParent = in_hWndParent
.head 5 -  Set cdoc_hSql = in_hSql
.head 5 -  Set cdoc_hSql = in_hSqlAux
.head 5 -  Set CDOC_TempFileName = in_TempFileName
.head 5 -  Set CDOC_RTFEditorProgram = in_RTFEditorProgram
.head 5 -  Set CDOC_RTFPrintProgram = in_RTFPrintProgram
.head 5 -  Set CDOC_CRLF = SalNumberToChar(13) || SalNumberToChar(10)
.head 5 -  ! Определение формата сохранения файлов договоров
.head 5 -  Set strPAR='C_FORMAT'
.head 5 +  If SqlPrepareAndExecute( in_hSqlAux, 'SELECT VAL INTO :strVAL FROM PARAMS WHERE PAR=:strPAR' )
.head 6 -  Call SqlFetchNext( in_hSqlAux, nFetchRes )
.head 5 +  If NOT strVAL
.head 6 -  Set strVAL='RTF'
.head 5 -  ! Установка формата сохранения файлов договоров   
.head 5 +  If strVAL='RTF'
.head 6 -  Call wrdSetSaveFormat( fmtRtf ) 
.head 5 +  Else If strVAL='HTML'
.head 6 -  Call wrdSetSaveFormat( fmtHtml )
.head 5 +  Else If strVAL='MHT'
.head 6 -  Call wrdSetSaveFormat( fmtMht )
.head 5 -  Return TRUE
.head 3 +  Function: cdoc_EditDocTemplates         ! __exported
.head 4 -  Description: Редактирование шаблонов договоров (в RTF)
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  ! Материнское окно
.head 5 -  Window Handle: hWndParent
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call IniCcDoc()
.head 5 -  Call cdoc_Initialize(hWndParent, hSql(), hSqlAux(), GetTempFileName(), GetEditorPath(),
     GetPrintProgramPath())
.head 5 -  Call SalModalDialog(cdoc_dlgTemplatesList, cdoc_hWndParent)
.head 3 +  Function: cdoc_EditDocTemplatesFilt     ! __exported
.head 4 -  Description: Редактирование шаблонов договоров (в RTF)с условием фильтра
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  ! Материнское окно
.head 5 -  Window Handle: hWndParent
.head 5 -  String: sFilter
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call IniCcDoc()
.head 5 -  Call cdoc_Initialize(hWndParent, hSql(), hSqlAux(), 
                     GetTempFileName(), GetEditorPath(), GetPrintProgramPath())
.head 5 +  If not IsWindow(hWinCC)
.head 6 -  Set hWinCC = SalCreateWindow( cdoc_List, cdoc_hWndParent, sFilter)
.head 5 +  Else
.head 6 -  Call SalBringWindowToTop ( cdoc_List )
.head 3 +  Function: cdoc_ShowDoc       		! __exported
.head 4 -  Description: Показывает документ
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  ! Текст договора (сюда же он возвращается после редактирования)
.head 5 -  Receive Long String: sText
.head 5 -  ! Редактируемость
.head 5 -  Boolean: fEditable
.head 5 -  ! Показывать диалог о сохранении изменений в тексте
(если FALSE, то изменения в sText всегда сохраняются без подтверждения)
.head 5 -  Boolean: fShowDialog
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: strTemp
.head 5 -  File Handle: hFile
.head 5 -  String: sFileName
.head 5 -  Number: nRet
.head 5 -  Number: chRes
.head 5 -  Date/Time: dFileDateBefore
.head 5 -  Date/Time: dFileDateAfter
.head 5 -  Date/Time: dLockStart
.head 5 -  Boolean: bLockResult
.head 4 +  Actions
.head 5 -  Call IniCcDoc()
.head 5 +  If sText
.head 6 -  Set sFileName = GetTempFileName()
.head 6 -  Set strTemp = GetEditorPath() || " " || sFileName
.head 6 -  Set dLockStart = SalDateCurrent()
.head 6 -  Set bLockResult = FALSE
.head 6 +  Loop
.head 7 -  ! Ждем 60 секунд для разблокирования файла
.head 7 +  If (SalDateCurrent()-dLockStart)/24/3600>60
.head 8 -  Break
.head 7 +  If SalFileOpen(hFile, 	sFileName,
     OF_Write | OF_Create | OF_Text)
.head 8 -  Set bLockResult=TRUE
.head 8 -  Call SalFileWrite(hFile, sText,
     SalStrLength(sText))
.head 8 -  Call SalFileClose(hFile)
.head 8 +  If cdoc_IsCompressedFile( sFileName )
.head 9 -  Call cdoc_DecompressFile( sFileName )
.head 8 -  Call SalFileGetDateTime( sFileName, dFileDateBefore )
.head 8 -  Call SalLoadAppAndWait(strTemp, Window_NotVisible,
     nRet)
.head 8 -  Call SalFileGetDateTime( sFileName, dFileDateAfter )
.head 8 +  If fEditable
.head 9 -  ! Документ не поменялся
.head 9 +  If dFileDateBefore=dFileDateAfter
.head 10 -  Return 0
.head 9 +  If fShowDialog
.head 10 -  Set chRes=SalMessageBox( 
'Для сохранения изменений в текущей версии документа нажмите Да,
Для сохраниения новой версии документа нажмите Нет,
Отмена - не сохранять изменения.', 'Подтверждение', MB_YesNoCancel | MB_IconQuestion  )
.head 9 +  Else
.head 10 -  Set chRes=IDNO
.head 9 -  ! Компрессия файла, если он еще не сжат
.head 9 +  If not cdoc_IsCompressedFile(sFileName)
.head 10 -  Call cdoc_CompressFile(sFileName)
.head 9 +  If SalFileOpen(hFile, sFileName,
     OF_Read | OF_Text)
.head 10 -  Call SalFileRead(hFile, sText,
     CDOC_MAX_RTF_LENGTH)
.head 10 -  Call SalFileClose(hFile)
.head 10 +  If chRes=IDYES
.head 11 -  Return 1
.head 10 +  Else If chRes=IDNO
.head 11 -  Return 2
.head 7 +  If bLockResult
.head 8 -  Break
.head 6 +  If NOT bLockResult
.head 7 -  Call SalMessageBox( 'Не могу создать файл: ' || sFileName, 'Ошибка', MB_IconStop | MB_Ok )
.head 5 -  Return 3
.head 3 +  Function: cdoc_PrintDoc       		! __exported
.head 4 -  Description: Показывает документ
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Receive Long String: sText
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hFile
.head 4 +  Actions
.head 5 -  Call IniCcDoc()
.head 5 +  If sText
.head 6 +  If SalFileOpen(hFile, GetTempFileName(),
     OF_Write | OF_Create | OF_Text)
.head 7 -  Call SalFileWrite(hFile, sText,
     SalStrLength(sText))
.head 7 -  Call SalFileClose(hFile)
.head 7 +  If cdoc_IsCompressedFile( GetTempFileName() )
.head 8 -  Call cdoc_DecompressFile( GetTempFileName() )
.head 7 -  Call ShellExecuteA( hWndNULL, 'print', GetTempFileName(), '', '', 0 )
.head 6 +  Else
.head 7 -  Call SalMessageBox( 'Не могу создать файл: ' || GetTempFileName(), 'Ошибка', MB_IconStop | MB_Ok )
.head 3 +  Function: cdoc_CreateDocFromTemplate	! __exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Long String:
.head 4 +  Parameters
.head 5 -  ! Хендлы для работы (не передавать hSql() и hSqlAux() не будет работать)
.head 5 -  Sql Handle: hSql
.head 5 -  Sql Handle: hSqlAux
.head 5 -  ! Код шаблона документа
.head 5 -  String: sTemplateId
.head 5 -  ! Номер договора (глобальный, генерится по S_CC_DEAL)
.head 5 -  Number: ND
.head 5 -  ! Номер доп. соглашения, если нет 0
.head 5 -  Number: ADDS
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Long String: sTEXT
.head 5 -  Number: nFetchRes
.head 5 -  String: iAttrs[*]
.head 5 -  Number: i
.head 5 -  String: sAttrId
.head 4 +  Actions
.head 5 -  Call IniCcDoc()
.head 5 -  ! Получаем текст шаблона
.head 5 -  Set sTEXT = GetStringFromClob(hSql, 'doc_scheme', 'id', 'template', NUMBER_Null, sTemplateId, '')
.head 5 +  If sTEXT
.head 6 -  Call SqlClose(hSql)
.head 6 -  ! Вычитываем параметры договора в словарь
.head 6 +  If SqlPrepareAndExecute(hSql, "SELECT id INTO :sAttrId FROM doc_attr ORDER BY id")
.head 7 -  Set i = 0
.head 7 +  While SqlFetchNext(hSql, nFetchRes)
.head 8 -  ! Значение переменных получаем только по необходимости
.head 8 -  Call SalArraySetUpperBound(iAttrs, 1, i)
.head 8 -  Set iAttrs[i] = sAttrId
.head 8 -  Set i = i + 1
.head 7 -  Call SqlClose(hSql)
.head 7 -  ! Заменяем атрибуты их значениями
.head 7 -  Call cdoc_ExpandDocumentEx(iAttrs, hSqlAux, ND, ADDS, sTEXT)
.head 7 -  Return sTEXT
.head 5 -  Return ''
.head 3 +  Function: cdoc_ShowAllDocs		! __exported
.head 4 -  Description: Показ существующих депозитных договоров
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  ! Номер договора (глобальный, генерится по S_CC_DEAL)
.head 5 -  Number: nND
.head 5 -  ! Окно, обрабатывающее сообщение о добавлении  документа
При нажатии на кнопку добавить этому окну посылается UM_CreateDoc
В этом сообщении нужно реализовать добавление нового документа
.head 5 -  Window Handle: hMessageWnd
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call IniCcDoc()
.head 5 +  If nND
.head 6 -  Call SalModalDialog( dlg_DocumentList, hWndMDI, nND, hMessageWnd, 1 )
.head 6 -  ! Call SalCreateWindow( frm_DocumentList, hWndMDI, nND,hMessageWnd )
.head 3 +  Function: cdoc_ShowAllDocsReadOnly	! __exported
.head 4 -  Description: Показ существующих депозитных договоров на ПРОСМОТР
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  ! Номер договора (глобальный, генерится по S_CC_DEAL)
.head 5 -  Number: nND
.head 5 -  ! Окно, обрабатывающее сообщение о добавлении  документа
При нажатии на кнопку добавить этому окну посылается UM_CreateDoc
В этом сообщении нужно реализовать добавление нового документа
.head 5 -  Window Handle: hMessageWnd
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call IniCcDoc()
.head 5 +  If nND
.head 6 -  Call SalModalDialog( dlg_DocumentList, hWndMDI, nND, hMessageWnd, 0 )
.head 3 +  Function: cdoc_ShowAllDocsSign		! __exported
.head 4 -  Description: Показ существующих депозитных договоров на ПРОСМОТР с правом подписи
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  ! Номер договора (глобальный, генерится по S_CC_DEAL)
.head 5 -  Number: nND
.head 5 -  ! Окно, обрабатывающее сообщение о добавлении  документа
При нажатии на кнопку добавить этому окну посылается UM_CreateDoc
В этом сообщении нужно реализовать добавление нового документа
.head 5 -  Window Handle: hMessageWnd
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call IniCcDoc()
.head 5 +  If nND
.head 6 -  Call SalModalDialog( dlg_DocumentList, hWndMDI, nND, hMessageWnd, 2 )
.head 3 +  Function: cdoc_SelectDocTemplate	! __exported
.head 4 -  Description: Выбор шаблона договора
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  ! Таблица из которой выбирать шаблоны (как правило DOC_SCHEME)
.head 5 -  String: sTabName
.head 5 -  ! Поле кода шаблона (как правило ID)
.head 5 -  String: sTemplateIdField
.head 5 -  ! Поле наименования шаблона (как правило NAME)
.head 5 -  String: sTemplateNameField
.head 5 -  ! Доп. условие на таблице sTabName
.head 5 -  String: sAuxCondition
.head 5 -  ! Сюда возвращается код выбранного шаблона
.head 5 -  Receive String: sTemplateId
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sTmp
.head 4 +  Actions
.head 5 -  Call IniCcDoc()
.head 5 +  If SalModalDialog( dlg_SelectTemplate, hWndMDI, 
sTabName, sTemplateIdField, sTemplateNameField, sAuxCondition, sTmp )=99
.head 6 -  Set sTemplateId=sTmp
.head 6 -  Return TRUE
.head 5 +  Else
.head 6 -  Return FALSE
.head 3 +  Function: cdoc_ExpandDocument
.head 4 -  Description: Подстановка значений реквизитов в один
документ из списка значений
.head 4 +  Returns
.head 5 -  Boolean: fOk
.head 4 +  Parameters
.head 5 -  : iAttrs
.head 6 -  Class: cDictionary
.head 5 -  Receive Long String: strRTF
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Long String: strRTF_Text
.head 5 -  Number: i
.head 5 -  Number: nTokens
.head 5 -  Long String: strTokens[*]
.head 5 -  Number: nAttrLen
.head 5 -  String: strAttrName
.head 5 -  String: strAttrValue
.head 4 +  Actions
.head 5 -  Set nTokens = SalStrTokenize(strRTF, "#", "#",
    strTokens)
.head 5 -  Set strRTF_Text = strTokens[0]
.head 5 -  Set i = 1
.head 5 +  While i < nTokens
.head 6 +  If SalStrLeftX(strTokens[i], 1) != "("
.head 7 -  Set nAttrLen = -1
.head 7 -  Set strAttrValue = "#"
.head 6 +  Else
.head 7 -  Set nAttrLen = SalStrScan(strTokens[i], ")")
.head 7 +  If nAttrLen < 0
.head 8 -  Set strAttrValue = "???-NOT_CLOSED"
.head 8 -  Set nAttrLen = -1
.head 7 +  Else If nAttrLen = 0
.head 8 -  Set strAttrValue = "???-EMPTY_ATTR"
.head 8 -  Set nAttrLen = 0
.head 7 +  Else
.head 8 -  Call SalStrMid(strTokens[i], 1, nAttrLen-1,
     strAttrName)
.head 8 -  Call SalStrUpper(strAttrName, strAttrName)
.head 8 -  Set strAttrValue = iAttrs.GetValue(strAttrName)
.head 8 +  If strAttrValue = STRING_Null
.head 9 -  Set strAttrValue = "???-" || strAttrName
.head 6 -  Call cdoc_StrChompLeft(strTokens[i], nAttrLen+1)
.head 6 -  Set strRTF_Text = strRTF_Text || strAttrValue ||
    strTokens[i]
.head 6 -  Set i = i + 1
.head 5 -  Set strRTF = strRTF_Text
.head 5 -  Return TRUE
.head 3 +  Function: cdoc_ExpandDocumentEx
.head 4 -  Description: Подстановка значений реквизитов в один
документ из списка значений
.head 4 +  Returns
.head 5 -  Boolean: fOk
.head 4 +  Parameters
.head 5 -  String: iAttrs[*]
.head 5 -  Sql Handle: hValSql
.head 5 -  Number: nND
.head 5 -  Number: nADDS
.head 5 -  Receive Long String: strRTF
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: i
.head 5 -  Number: iMax
.head 5 -  Long String: sValue
.head 5 -  File Handle: hFile
.head 5 -  Number: nLen
.head 4 +  Actions
.head 5 +  If strRTF
.head 6 -  ! Текст в файл
.head 6 +  If SalFileOpen(hFile, GetTempFileName(),
     OF_Write | OF_Create | OF_Text)
.head 7 -  Call SalFileWrite(hFile, strRTF,
     SalStrLength(strRTF))
.head 7 -  Call SalFileClose(hFile)
.head 7 +  If cdoc_IsCompressedFile( GetTempFileName() )
.head 8 -  Call cdoc_DecompressFile( GetTempFileName() )
.head 7 -  ! Поднимаем Word
.head 7 -  Call wrdRun( FALSE )
.head 7 -  ! Грузим документ
.head 7 -  Call wrdLoadRTFDoc( GetTempFileName() )
.head 7 -  ! Заменяем все
.head 7 -  Call SalArrayGetLowerBound( iAttrs, 1, i )
.head 7 -  Call SalArrayGetUpperBound( iAttrs, 1, iMax )
.head 7 +  While i<=iMax
.head 8 +  If wrdFindText( '#(' || iAttrs[i] || ')' )
.head 9 -  Set sValue = cdoc_GetAttrValue( hValSql, iAttrs[i], nND, nADDS )
.head 9 +  If sValue
.head 10 -  ! Извращения для длинных строк, т.к. Word не заменяет строки >254 симв.
.head 10 -  Set nLen = Len(sValue)
.head 10 +  While nLen > 254
.head 11 -  ! Дописываем впереди тэга '#(TAG)' часть sValue,
чтобы получилось что-то типа 'тра-ля-ля #(TAG)',
чтобы потом еще раз заменить '#(TAG)' на вторую часть sValue
.head 11 -  Call wrdReplaceText( '#(' || iAttrs[i] || ')', 
     Subs(sValue, 1, 254-Len('#(' || iAttrs[i] || ')')) || '#(' || iAttrs[i] || ')')
.head 11 -  Set sValue = Subs(sValue, 
    254-Len('#(' || iAttrs[i] || ')')+1, 
    Len(sValue)-254+Len('#(' || iAttrs[i] || ')'))
.head 11 -  Set nLen = Len(sValue)
.head 10 -  Call wrdReplaceText( '#(' || iAttrs[i] || ')', sValue )
.head 8 -  Set i=i+1
.head 7 -  ! Сохраняем док
.head 7 -  Call wrdSaveRTFDoc( GetTempFileName() )
.head 7 -  ! Закрываем Word
.head 7 -  Call wrdClose()
.head 7 -  ! Компрессия файла, если он еще не сжат
.head 7 +  If not cdoc_IsCompressedFile(GetTempFileName())
.head 8 -  Call cdoc_CompressFile(GetTempFileName())
.head 7 -  ! Док. в файл
.head 7 +  If SalFileOpen(hFile, GetTempFileName(),
     OF_Read | OF_Text)
.head 8 -  Call SalFileRead(hFile, strRTF,
     CDOC_MAX_RTF_LENGTH)
.head 8 -  Call SalFileClose(hFile)
.head 5 -  Return TRUE
.head 3 +  ! Function: cdoc_GetAttrValue
.head 4 -   Description: Получение значения атрибута для указанного документа
.head 4 +   Returns 
.head 5 -   String: 
.head 4 +   Parameters 
.head 5 -  ! Конект
.head 5 -   Sql Handle: hSql
.head 5 -  ! Имя атрибута
.head 5 -   String: sAttrId
.head 5 -  ! Значение, используемое для идентификации договора
.head 5 -   Number: nND
.head 5 -  ! Значение, используемое для идентификации доп. соглашения
.head 5 -   Number: nADDS
.head 4 -   Static Variables 
.head 4 +   Local variables 
.head 5 -   Long String: sValue
.head 5 -   Number: nFetchRes
.head 5 -   Number: nValue
.head 5 -   Number: nKv
.head 5 -   String: sCurrencyName
.head 5 -   String: sCentsName
.head 4 +   Actions 
.head 5 +   If TRUE
.head 6 +   When SqlError
.head 7 -   Call SalMessageBox( 'Ошибка при получении значения параметра ' || sAttrId || ' для контракта ' || SalNumberToStrX( nND, 0 ) || '!',
'Ошибка', MB_Ok | MB_IconStop ) 
.head 6 -   Call SqlSetLongBindDatatype(4, 22)
.head 6 +   If SqlPrepareAndExecute( hSql,"SELECT SUBSTR(CC_DOC_GET_VAR_VALUE(:sAttrId,:nND,:nADDS),1,2000) INTO :sValue FROM DUAL" )
.head 7 +   If SqlFetchNext( hSql, nFetchRes )
.head 8 -   Call SqlClose( hSql )
.head 8 -  ! Сумма прописью
.head 8 +   If SalStrRightX( SalStrUpperX( sAttrId ), 2 )='_W'
.head 9 -   Set nValue=SalStrToNumber( sValue )
.head 9 +   If nValue
.head 10 +   If SqlPrepareAndExecute( hSql, 
"SELECT B.KV, B.LCV, B.UNIT 
INTO :nKv,:sCurrencyName,:sCentsName 
FROM DPT_DEPOSIT A, TABVAL B
WHERE A.DEPOSIT_ID=:nND AND
A.KV=B.KV" )
.head 11 +   If SqlFetchNext( hSql, nFetchRes )
.head 12 -   Call SqlClose( hSql )
.head 12 +   If nKv=GetBaseVal()
.head 13 -   Set sValue=SumPr( nValue, 'F', 'грн', 'коп')
.head 12 +   Else 
.head 13 -   Set sValue=SumPr( nValue, 'F', sCurrencyName, sCentsName)
.head 8 +   Else If SalStrRightX( SalStrUpperX( sAttrId ), 2 )='_X'
.head 9 -   Set nValue=SalStrToNumber( sValue )
.head 9 +   If nValue
.head 10 -   Set sValue=NumberPr( nValue, 'M' )
.head 8 -   Return SalStrTrimX( sValue )
.head 5 -   Return ''
.head 3 +  Function: cdoc_GetAttrValue
.head 4 -  Description: Получение значения атрибута для указанного документа
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  ! Конект
.head 5 -  Sql Handle: hSql
.head 5 -  ! Имя атрибута
.head 5 -  String: sAttrId
.head 5 -  ! Значение, используемое для идентификации договора
.head 5 -  Number: nND
.head 5 -  ! Значение, используемое для идентификации доп. соглашения
.head 5 -  Number: nADDS
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Long String: sValue
.head 5 -  Long String: sValue1
.head 5 -  Long String: sValue2
.head 5 -  Long String: sValue3
.head 5 -  Number: nFetchRes
.head 5 -  Number: nValue
.head 5 -  Number: nKv
.head 5 -  String: sCurrencyName
.head 5 -  String: sCentsName
.head 4 +  Actions
.head 5 +  If TRUE
.head 6 +  When SqlError
.head 7 -  Call SalMessageBox( 'Ошибка при получении значения параметра ' || sAttrId || ' для контракта ' || SalNumberToStrX( nND, 0 ) || '!',
'Ошибка', MB_Ok | MB_IconStop )
.head 6 -  Call SqlSetLongBindDatatype(4, 22)
.head 6 -  Call SqlSetLongBindDatatype(5, 22)
.head 6 -  Call SqlSetLongBindDatatype(6, 22)
.head 6 +  If SqlPLSQLCommand(hSql,"CC_DOC_GET_VAR_VALUE2(sAttrId, nND, nADDS, sValue1, sValue2, sValue3)" )
.head 7 -  Call SqlClose( hSql )
.head 7 -  Set sValue = sValue1 || sValue2 || sValue3
.head 7 -  ! Сумма прописью
.head 7 +  If SalStrRightX( SalStrUpperX( sAttrId ), 2 )='_W'
.head 8 -  Set nValue=SalStrToNumber( sValue )
.head 8 +  If nValue
.head 9 +  If SqlPrepareAndExecute( hSql,
"SELECT B.KV, B.LCV, B.UNIT
INTO :nKv,:sCurrencyName,:sCentsName
FROM DPT_DEPOSIT A, TABVAL B
WHERE A.DEPOSIT_ID=:nND AND
A.KV=B.KV" )
.head 10 +  If SqlFetchNext( hSql, nFetchRes )
.head 11 -  Call SqlClose( hSql )
.head 11 +  If nKv=GetBaseVal()
.head 12 -  Set sValue=SumPr( nValue, 'F', 'грн', 'коп')
.head 11 +  Else
.head 12 -  Set sValue=SumPr( nValue, 'F', sCurrencyName, sCentsName)
.head 7 +  Else If SalStrRightX( SalStrUpperX( sAttrId ), 2 )='_X'
.head 8 -  Set nValue=SalStrToNumber( sValue )
.head 8 +  If nValue
.head 9 -  Set sValue=NumberPr( nValue, 'M' )
.head 7 -  Return SalStrTrimX( sValue )
.head 5 -  Return ''
.head 3 +  Function: cdoc_StrDOSToWin
.head 4 -  Description: Перекодирование строки из DOS в Win
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Receive Long String: str
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Set str = StrDosToWinX(str)
.head 3 -  ! Функции без компрессии
.head 3 +  ! Function: cdoc_IsCompressedFile
.head 4 -                 Description: Определение сжатости файла
.head 4 +                 Returns 
.head 5 -                 Boolean: 
.head 4 +                 Parameters 
.head 5 -                 String: strFileName
.head 4 -                 Static Variables 
.head 4 -                 Local variables 
.head 4 +                 Actions 
.head 5 -                 Return FALSE
.head 3 +  ! Function: cdoc_CompressFile
.head 4 -                 Description: Архивация файла
.head 4 -                 Returns 
.head 4 +                 Parameters 
.head 5 -                 String: strFileName
.head 4 -                 Static Variables 
.head 4 -                 Local variables 
.head 4 -                 Actions 
.head 3 +  ! Function: cdoc_DecompressFile
.head 4 -                 Description: Разархивация файла
.head 4 -                 Returns 
.head 4 +                 Parameters 
.head 5 -                 String: strFileName
.head 4 -                 Static Variables 
.head 4 -                 Local variables 
.head 4 -                 Actions 
.head 3 -  ! Функции с компрессией
.head 3 +  Function: Check_UseCompresstion
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nCompressDocs
.head 5 -  Number: nFetchRes
.head 4 +  Actions
.head 5 +  If SqlPrepareAndExecute( hSql(), "SELECT TO_NUMBER(NVL(val,0)) INTO :nCompressDocs FROM PARAMS WHERE par='CMPRDOCS'" )
.head 6 +  If SqlFetchNext( hSql(), nFetchRes )
.head 7 +  If nCompressDocs
.head 8 -  Set CompressDocs=TRUE
.head 3 +  Function: cdoc_IsCompressedFile
.head 4 -  Description: Определение сжатости файла
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strFileName
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  ! Нужный заголовок файла
.head 5 -  String: strHeader
.head 5 -  ! Прочитанный заголовок
.head 5 -  String: strReadHeader
.head 5 -  ! Файл
.head 5 -  File Handle: hFile
.head 4 +  Actions
.head 5 -  Call Check_UseCompresstion()
.head 5 +  If NOT CompressDocs
.head 6 -  Return FALSE
.head 5 -  ! Call Debug( 'cdoc_IsCompressedFile' )
.head 5 -  ! Читаем нужный залоговок из реестра
.head 5 -  Call SalUseRegistry( TRUE, GetCompanyName() )
.head 5 -  ! По уполчанию ZIP
.head 5 -  ! Call SalGetProfileString( GetCompanyName() || GetProductName() || '\\Credit&Loans',
	'ArchHeader', 'PK', strHeader, GetCompanyName() )
.head 5 -  Call SalGetProfileString( 'Credit&Loans', 'ArchHeader', '', strHeader, GetProductName() )
.head 5 +  If NOT strHeader
.head 6 -  Set strHeader='504B'
.head 5 -  ! Call Debug( 'cdoc_IsCompressedFile.strHeader="' || strHeader || '"' )
.head 5 +  If strHeader
.head 6 +  If SalFileOpen( hFile, strFileName, OF_Read )
.head 7 -  Call SalFileRead( hFile, strReadHeader, SalStrLength( strHeader ) )
.head 7 -  Call SalFileClose( hFile )
.head 7 -  ! Call Debug( 'cdoc_IsCompressedFile.strReadHeader="' || strReadHeader || '"' )
.head 7 +  If strReadHeader=strHeader
.head 8 -  Return TRUE
.head 5 -  Return FALSE
.head 3 +  Function: cdoc_CompressFile
.head 4 -  Description: Архивация файла
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: strFileName
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: strCommand
.head 5 -  String: strTempFile
.head 5 -  ! For path split
.head 5 -  String: tDrive
.head 5 -  String: tDir
.head 5 -  String: tBase
.head 5 -  String: tExt
.head 5 -  Number: nRet
.head 5 -  File Handle: hFake
.head 4 +  Actions
.head 5 +  If NOT CompressDocs
.head 6 -  Return FALSE
.head 5 -  ! Call Debug( 'cdoc_CompressFile' )
.head 5 -  ! Читаем команду архивации из реестра
.head 5 -  Call SalUseRegistry( TRUE, GetCompanyName() )
.head 5 -  ! По уполчанию ZIP
.head 5 -  Call SalGetProfileString( 'Credit&Loans',
	'ArchCommand', '',strCommand, GetProductName() )
.head 5 +  If NOT strCommand
.head 6 -  Set strCommand='PKZIP25.EXE -ADD -Over=all -Silent -NoZipExtension &ArcFile &OriFile'
.head 5 -  ! Call Debug( 'cdoc_CompressFile.strCommand="' || strCommand || '"' )
.head 5 +  If strCommand
.head 6 -  ! Вычисляем имя врем. файла 
.head 6 -  Call VisDosSplitPath( strFileName, tDrive, tDir, tBase, tExt )
.head 6 -  Set strTempFile = VisDosMakePath(tDrive, tDir, tBase, '.TMP' )
.head 6 -  ! Call Debug( 'cdoc_CompressFile.strTempFile="' || strTempFile || '"' )
.head 6 -  ! Заменяем макро в команде
.head 6 -  Set strCommand = VisStrSubstitute( strCommand, '&ArcFile', 
	strTempFile )
.head 6 -  Set strCommand = VisStrSubstitute( strCommand, '&OriFile', 
	strFileName )
.head 6 -  ! Call Debug( 'cdoc_CompressFile.strCommand="' || strCommand || '"' )
.head 6 -  ! Архивируем
.head 6 -  Call VisFileDelete( strTempFile )
.head 6 -  Call SalFileSetCurrentDirectory( tDrive || tDir )
.head 6 -  ! Call Debug( 'Dir is set to ' || tDrive || tDir )
.head 6 -  Call SalLoadAppAndWait( strCommand, Window_NotVisible, nRet )
.head 6 -  ! Call SalLoadAppAndWait( strCommand, Window_NotVisible, nRet )
.head 6 -  ! Call Debug( 'cdoc_CompressFile: File compressed!' )
.head 6 -  ! Переименовываю оригинальный файл
.head 6 -  Call VisFileDelete( strFileName )
.head 6 -  Call VisFileRename( strTempFile, strFileName )
.head 6 -  ! Call Debug( 'cdoc_CompressFile: File renamed to ori' )
.head 6 -  Call SalLoadAppAndWait( 'ToHex.exe '||strFileName, Window_NotVisible, nRet )
.head 6 -  ! Call Debug( 'cdoc_CompressFile: File converted to HEX' )
.head 3 +  Function: cdoc_DecompressFile
.head 4 -  Description: Разархивация файла
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: strFileName
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: strCommand
.head 5 -  String: strTempFile
.head 5 -  ! For path split
.head 5 -  String: tDrive
.head 5 -  String: tDir
.head 5 -  String: tBase
.head 5 -  String: tExt
.head 5 -  Number: nRet
.head 5 -  File Handle: hFake
.head 4 +  Actions
.head 5 +  If NOT CompressDocs
.head 6 -  Return FALSE
.head 5 -  ! Call Debug( 'cdoc_DecompressFile' )
.head 5 -  ! Читаем команду извлечения из реестра
.head 5 -  Call SalUseRegistry( TRUE, GetCompanyName() )
.head 5 -  ! По уполчанию ZIP
.head 5 -  Call SalGetProfileString( 'Credit&Loans','ArchCommand', '',strCommand, GetProductName() )
.head 5 +  If NOT strCommand
.head 6 -  Set strCommand='PKZIP25.EXE -extract -over=all -Silent -NoZipExtension &ArcFile'
.head 5 -  ! Call Debug( 'cdoc_DecompressFile.strCommand="' || strCommand || '"' )
.head 5 +  If strCommand
.head 6 -  ! Вычисляем имя врем. файла 
.head 6 -  Call VisDosSplitPath( strFileName, tDrive, tDir, tBase, tExt )
.head 6 -  Set strTempFile = VisDosMakePath(tDrive, tDir, tBase, '.TMP' )
.head 6 -  Call SalLoadAppAndWait( 'ToBin.exe '||strFileName, Window_NotVisible, nRet )
.head 6 -  ! Call Debug( 'cdoc_DecompressFile: File converted to Binary' )
.head 6 -  ! Переименовываю оригинальный файл
.head 6 -  Call VisFileDelete( strTempFile )
.head 6 -  Call VisFileRename( strFileName, strTempFile )
.head 6 -  ! Call Debug( 'cdoc_DecompressFile: File renamed' )
.head 6 -  ! Заменяем макро в команде
.head 6 -  Set strCommand = VisStrSubstitute( strCommand, '&ArcFile', 
	strTempFile )
.head 6 -  ! Call Debug( 'cdoc_DecompressFile.strCommand="' || strCommand || '"' )
.head 6 -  ! Извлекаем
.head 6 -  Call SalFileSetCurrentDirectory( tDrive || tDir )
.head 6 -  ! Call Debug( 'Dir is set to ' || tDrive || tDir )
.head 6 -  Call SalLoadAppAndWait( strCommand, Window_NotVisible, nRet )
.head 6 -  ! Call Debug( 'cdoc_DecompressFile: File decompressed' )
.head 6 -  ! Удаляем врем. файл
.head 6 -  Call VisFileDelete( strTempFile )
.head 6 -  ! Call Debug( 'cdoc_DecompressFile: Tmp file deleted' )
.head 3 -  ! Устарело
.head 3 +  Function: cdoc_SetProgressMsg           ! __exported
.head 4 -  Description: от функции оставляем название, используем для выбора шаблона и печати договора
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Number: nND
.head 5 -  String: sFilter
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sTemplateId
.head 5 -  Long String: sDoc
.head 5 -  : cCnc
.head 6 -  Class: cABSConnect
.head 5 -  : cCnc2
.head 6 -  Class: cABSConnect
.head 4 +  Actions
.head 5 +  If not cdoc_SelectDocTemplate("DOC_SCHEME", "ID", "NAME", sFilter, sTemplateId)
.head 6 -  Return TRUE
.head 5 +  If sTemplateId
.head 6 -  Call XConnectGetParams(cCnc)
.head 6 +  If cCnc.Connect() and cCnc2.Clone(cCnc, TRUE)
.head 7 -  Set sDoc = cdoc_CreateDocFromTemplate(cCnc.hSql(), cCnc2.hSql(), sTemplateId, nND, 0)
.head 7 +  If sDoc
.head 8 -  Call cdoc_ShowDoc(sDoc, TRUE, FALSE)
.head 7 -  Call cCnc.Disconnect()
.head 7 -  Call cCnc2.Disconnect()
.head 5 -  Return TRUE
.head 5 -  ! Return SalPostMsg(cdoc_dlgProgressIndicatorEx,
       CDOC_MSG_FetchRow, nRow,
       SalHStringToNumber(strMsgText))
.head 3 +  Function: cdoc_CreateProgressBox        ! __exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Window Handle: hWnd
.head 4 +  Parameters
.head 5 -  Window Handle: hWndParent
.head 5 -  String: strTitle
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Return SalNumberToWindowHandle( 0 )
.head 5 -  ! Return SalCreateWindow(cdoc_dlgProgressIndicatorEx,
       hWndParent, strTitle)
.head 3 +  Function: cdoc_CloseProgressBox         ! __exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean: fOk
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Return TRUE
.head 5 -  ! Return SalDestroyWindow(cdoc_dlgProgressIndicatorEx)
.head 3 -  ! Использется, но только внутри
.head 3 +  Function: cdoc_GetString                ! __exported
.head 4 -  Description: Ввод строки
.head 4 +  Returns
.head 5 -  Number: nOk
.head 4 +  Parameters
.head 5 -  String: strTitle
.head 5 -  String: strPrompt
.head 5 -  Receive String: strValue
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nOk
.head 5 -  String: strTempValue
.head 4 +  Actions
.head 5 -  Call IniCcDoc()
.head 5 -  Set strTempValue = strValue
.head 5 -  Set nOk = SalModalDialog(cdoc_dlgGetString, hWndNULL,
    strTitle, strPrompt, strTempValue)
.head 5 -  Set strValue = strTempValue
.head 5 -  Return nOk
.head 3 +  Function: cdoc_GetChoice                ! __exported
.head 4 -  Description: Выбор варианта из списка
.head 4 +  Returns
.head 5 -  Number: nChoice
.head 4 +  Parameters
.head 5 -  String: strValues[*]
.head 5 -  Number: nItems
.head 5 -  String: strTitle
.head 5 -  String: strPrompt
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call IniCcDoc()
.head 5 -  Return SalModalDialog(cdoc_dlgGetChoice, hWndNULL,
       strValues, nItems, strTitle, strPrompt)
.head 3 +  Function: cdoc_StrChompLeft             ! __exported
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Receive Long String: strText
.head 5 -  Number: nChars
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  While nChars > 0
.head 6 -  Call SalStrLop(strText)
.head 6 -  Set nChars = nChars - 1
.head 3 +  Function: cdoc_ChompTimeFromDate        ! __exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Date/Time: dtRes
.head 4 +  Parameters
.head 5 -  Receive Date/Time: dtDate
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nYear
.head 5 -  Number: nMonth
.head 5 -  Number: nDay
.head 4 +  Actions
.head 5 -  Set nYear = SalDateYear(dtDate)
.head 5 -  Set nMonth = SalDateMonth(dtDate)
.head 5 -  Set nDay = SalDateDay(dtDate)
.head 5 -  Set dtDate = SalDateConstruct(nYear, nMonth, nDay, 0, 0,
    0)
.head 5 -  Return dtDate
.head 3 +  Function: cdoc_SetDocText		! __exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  ! SQL соединение
.head 5 -  Sql Handle: hSql
.head 5 -  ! Признак вставки новой строки в таблицу
.head 5 -  Boolean: bIns
.head 5 -  ! Идентификатор шаблона
.head 5 -  String: sId
.head 5 -  ! Номер договора
.head 5 -  Number: nND
.head 5 -  ! Номер доп.соглашения
.head 5 -  Number: nAdds
.head 5 -  ! Дата сохранения
.head 5 -  Date/Time: dVersion
.head 5 -  ! Текст
.head 5 -  Long String: lsText
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call IniCcDoc()
.head 5 +  If sId = '' 
OR nND = NUMBER_Null 
OR nAdds = NUMBER_Null
.head 6 -  Return FALSE
.head 5 +  If dVersion = DATETIME_Null
.head 6 -  Set dVersion = SalDateCurrent()
.head 5 +  If isCLOB
.head 6 +  If bIns
.head 7 +  If NOT SqlPrepareAndExecute(hSql, 
"INSERT INTO cc_docs(id, nd, adds, version) 
 VALUES(:sId, :nND, :nAdds, :dVersion)")
.head 8 -  Call SqlRollback(hSql)
.head 8 -  Return FALSE
.head 7 -  Call SqlCommit(hSql)
.head 6 +  If NOT PutStringToClob(hSql, lsText, 'cc_docs', 'nd', 'text', nND, '', 
  "id='" || sId || "' AND nd=" || Str(nND) || " AND adds=" || Str(nAdds) || 
  " AND to_char(version, 'dd/MM/yyyy hh24:mi:ss')='" || 
  SalFmtFormatDateTime(dVersion, 'dd/MM/yyyy ') || 
  PadL('0' || SalFmtFormatDateTime(dVersion, 'hhhh:mm:ss'), 8) || "'", 0)
.head 7 -  Return FALSE
.head 5 +  Else
.head 6 -  ! insert
.head 6 +  If bIns
.head 7 +  If NOT SqlPrepare(hSql, 
"INSERT INTO CC_DOCS(id, nd, text, adds)
 VALUES(:sId, :nND, :lsText, :nAdds)")
.head 8 -  Return FALSE
.head 7 +  If NOT SqlSetLongBindDatatype(3, 23)
.head 8 -  Return FALSE
.head 7 +  If NOT SqlExecute(hSql)
.head 8 -  Call SqlRollback(hSql)
.head 8 -  Return FALSE
.head 6 -  ! update
.head 6 +  Else
.head 7 +  If NOT SqlPrepare(hSql, 
"UPDATE CC_DOCS SET TEXT=:lsText 
 WHERE id=:sId AND nd=:nND AND adds=:nAdds AND version=:dVersion")
.head 8 -  Return FALSE
.head 7 +  If NOT SqlSetLongBindDatatype(1, 23)
.head 8 -  Return FALSE
.head 7 +  If NOT SqlExecute(hSql)
.head 8 -  Call SqlRollback(hSql)
.head 8 -  Return FALSE
.head 5 -  Call SqlCommit(hSql)
.head 5 -  Return TRUE
.head 3 +  Function: cdoc_GetDocText		! __exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Long String:
.head 4 +  Parameters
.head 5 -  ! SQL соединение
.head 5 -  Sql Handle: hSql
.head 5 -  ! Идентификатор шаблона
.head 5 -  String: sId
.head 5 -  ! Номер договора
.head 5 -  Number: nND
.head 5 -  ! Номер доп.соглашения
.head 5 -  Number: nAdds
.head 5 -  ! Дата сохранения
.head 5 -  Date/Time: dVersion
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nFetchRes
.head 5 -  Long String: lsText
.head 4 +  Actions
.head 5 -  Call IniCcDoc()
.head 5 +  If sId = '' 
OR nND = NUMBER_Null 
OR nAdds = NUMBER_Null 
OR dVersion = DATETIME_Null
.head 6 -  Return ''
.head 5 +  If isCLOB
.head 6 -  Return GetStringFromClob(hSql, 'cc_docs', 'nd', 'text', nND, '', 
  "id='" || sId || "' AND nd=" || Str(nND) || " AND adds=" || Str(nAdds) || 
  " AND to_char(version, 'dd/MM/yyyy hh24:mi:ss')='" || 
  SalFmtFormatDateTime(dVersion, 'dd/MM/yyyy ') || 
  PadL('0' || SalFmtFormatDateTime(dVersion, 'hhhh:mm:ss'), 8) || "'")
.head 5 +  Else
.head 6 +  If not SqlPrepareAndExecute(hSql, 
"SELECT text INTO :lsText FROM cc_docs 
 WHERE id=:sId AND nd=:nND AND adds=:nAdds AND version=:dVersion") 
or not SqlFetchNext(hSql, nFetchRes)
.head 7 -  Return ''
.head 6 -  Return lsText
.head 2 +  Named Menus
.head 2 +  Class Definitions
.data RESOURCE 0 0 1 25218691
0000: 37010000A2000000 0000000000000000 0200000200FFFF01 00160000436C6173
0020: 73566172004F7574 6C696E6552006567 496E666F22003C00 000A630047656E46
0040: 696C746500727400 00000400001E0002 0400C10001000000 3F8001F800000037
0060: 040001F00D000000 FF1F110000DC0002 00FF7F1570000000 0100FFFF21018022
0080: 000001C200000B63 47F8444669B30004 00770200F601004F 800100FE008D0400
00A0: 010DFD00FF371100 02F700FFDF15DC00 0100FF7F
.enddata
.head 3 +  Functional Class: cDictionary
.head 4 -  Description:
.head 4 -  Derived From
.head 4 -  Class Variables
.head 4 +  Instance Variables
.head 5 -  Number: nArrSize
.head 5 -  Long String: arHash[*,2]
.head 5 -  Number: nIndex
.head 4 +  Functions
.head 5 +  Function: Initialize
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean: fOk
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Call Clear()
.head 7 -  Return TRUE
.head 5 +  Function: SetValue
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  String: strPrevValue
.head 6 +  Parameters
.head 7 -  String: strNewKey
.head 7 -  Long String: strValue
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: i
.head 7 -  Long String: strPrevValue
.head 7 -  String: strKey
.head 6 +  Actions
.head 7 -  Set i = 0
.head 7 -  Set strKey = SalStrUpperX(SalStrTrimX(strNewKey))
.head 7 +  While i < nArrSize
.head 8 +  If strKey = arHash[i,CDOC_ATTR_NAME]
.head 9 -  Set strPrevValue = arHash[i,CDOC_ATTR_VALUE]
.head 9 -  Set arHash[i,CDOC_ATTR_VALUE] = strValue
.head 9 -  Return strPrevValue
.head 8 -  Set i = i + 1
.head 7 -  Set nArrSize = nArrSize + 1
.head 7 -  Set arHash[i,CDOC_ATTR_NAME] = strKey
.head 7 -  Set arHash[i,CDOC_ATTR_VALUE] = strValue
.head 7 -  Return STRING_Null
.head 5 +  Function: GetValue
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  String: strValue
.head 6 +  Parameters
.head 7 -  String: strKey
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: i
.head 6 +  Actions
.head 7 -  Set i = 0
.head 7 -  Set strKey = SalStrUpperX(SalStrTrimX(strKey))
.head 7 +  While i < nArrSize
.head 8 +  If strKey = arHash[i,CDOC_ATTR_NAME]
.head 9 -  Return arHash[i,CDOC_ATTR_VALUE]
.head 8 -  Set i = i + 1
.head 7 -  Return STRING_Null
.head 5 +  Function: Clear
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Set nArrSize = 0
.head 7 -  Set nIndex = -1
.head 5 +  Function: GetSize
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Number: nSize
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Return nArrSize
.head 5 +  Function: StartIterator
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Set nIndex = -1
.head 5 +  Function: Next
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean: fOk
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Set nIndex = nIndex + 1
.head 7 -  Return nIndex < nArrSize
.head 5 +  Function: GetCurrentValue
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Long String: strValue
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 +  If nIndex < nArrSize
.head 8 -  Return arHash[nIndex,CDOC_ATTR_VALUE]
.head 7 -  Return STRING_Null
.head 5 +  Function: GetCurrentKey
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  String: strKey
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 +  If nIndex < nArrSize
.head 8 -  Return arHash[nIndex,CDOC_ATTR_NAME]
.head 7 -  Return STRING_Null
.head 5 +  Function: IsEmpty
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean: fEmpty
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Return nArrSize <= 0
.head 3 -  ! Устарело
.head 3 +  ! Functional Class: cRTF_Control
.data CLASSPROPSSIZE
0000: 7A00
.enddata
.data CLASSPROPS
0000: 5459504547554944 0027007B44393236 343141302D444637 392D313143462D38
0020: 4537342D30304130 4339304632364638 7D00004155544F43 4C41535300020059
0040: 00004C4942475549 440027007B334237 43383836332D4437 38462D313031422D
0060: 423942352D303430 3231433030393430 327D000000000000 0000
.enddata
.head 4 -                     Description: 
.head 4 -                     Derived From 
.head 4 +                     Class Variables 
.head 5 -                     String: strDispatchPath
.head 5 -                     Number: numLocaleID
.head 5 -                     String: strClassID
.head 4 +                     Instance Variables 
.head 5 -                     Number: numObject
.head 4 +                     Functions 
.head 5 +                     Function: Initialize
.head 6 -                     Description: 
.head 6 -                     Returns 
.head 6 +                     Parameters 
.head 7 -                     Number: numInitObject
.head 6 -                     Static Variables 
.head 6 -                     Local variables 
.head 6 +                     Actions 
.head 7 -                     Set strClassID = "{D92641A0-DF79-11CF-8E74-00A0C90F26F8}"
.head 7 -                     Set numLocaleID = 0
.head 7 -                     Set numObject = SWinInitObject(numInitObject, numLocaleID, strClassID, strDispatchPath)
.head 5 +                     Function: GetRightMargin
.data CLASSPROPSSIZE
0000: 1B00
.enddata
.data CLASSPROPS
0000: 4449535049440003 0033320000545950 4500020046000000 000000
.enddata
.head 6 -                     Description: Sets the right margin used for textwrap,
centering, etc.
.head 6 +                     Returns 
.head 7 -                     Number: 
.head 6 -                     Parameters 
.head 6 -                     Static Variables 
.head 6 -                     Local variables 
.head 6 +                     Actions 
.head 7 -                     Return XGetRightMargin(numObject, 0x20, numLocaleID, "G")
.head 5 +                     Function: SetRightMargin
.data CLASSPROPSSIZE
0000: 1B00
.enddata
.data CLASSPROPS
0000: 4449535049440003 0033320000545950 4500020046000000 000000
.enddata
.head 6 -                     Description: Sets the right margin used for textwrap,
centering, etc.
.head 6 -                     Returns 
.head 6 +                     Parameters 
.head 7 -                     Number: Num0
.head 6 -                     Static Variables 
.head 6 -                     Local variables 
.head 6 +                     Actions 
.head 7 -                     Call XSetRightMargin(numObject, 0x20, numLocaleID, "P", Num0)
.head 5 +                     Function: GetSelRTF
.data CLASSPROPSSIZE
0000: 1B00
.enddata
.data CLASSPROPS
0000: 4449535049440003 0031310000545950 4500020046000000 000000
.enddata
.head 6 -                     Description: Returns/sets the text (in .RTF format) in
the current selection of a RichTextBox
control.
.head 6 +                     Returns 
.head 7 -                     String: 
.head 6 -                     Parameters 
.head 6 -                     Static Variables 
.head 6 -                     Local variables 
.head 6 +                     Actions 
.head 7 -                     Return XGetSelRTF(numObject, 0xB, numLocaleID, "G")
.head 5 +                     Function: SetSelRTF
.data CLASSPROPSSIZE
0000: 1B00
.enddata
.data CLASSPROPS
0000: 4449535049440003 0031310000545950 4500020046000000 000000
.enddata
.head 6 -                     Description: Returns/sets the text (in .RTF format) in
the current selection of a RichTextBox
control.
.head 6 -                     Returns 
.head 6 +                     Parameters 
.head 7 -                     String: Str0
.head 6 -                     Static Variables 
.head 6 -                     Local variables 
.head 6 +                     Actions 
.head 7 -                     Call XSetSelRTF(numObject, 0xB, numLocaleID, "P",
     Str0)
.head 5 +                     Function: GetSelText
.data CLASSPROPSSIZE
0000: 1A00
.enddata
.data CLASSPROPS
0000: 4449535049440002 0039000054595045 0002004600000000 0000
.enddata
.head 6 -                     Description: Returns/sets the string containing the
currently selected text; consists of a
zero-length string if no characters are
selected.
.head 6 +                     Returns 
.head 7 -                     String: 
.head 6 -                     Parameters 
.head 6 -                     Static Variables 
.head 6 -                     Local variables 
.head 6 +                     Actions 
.head 7 -                     Return XGetSelText(numObject, 0x9, numLocaleID,
       "G")
.head 5 +                     Function: SetSelText
.data CLASSPROPSSIZE
0000: 1A00
.enddata
.data CLASSPROPS
0000: 4449535049440002 0039000054595045 0002004600000000 0000
.enddata
.head 6 -                     Description: Returns/sets the string containing the
currently selected text; consists of a
zero-length string if no characters are
selected.
.head 6 -                     Returns 
.head 6 +                     Parameters 
.head 7 -                     String: Str0
.head 6 -                     Static Variables 
.head 6 -                     Local variables 
.head 6 +                     Actions 
.head 7 -                     Call XSetSelText(numObject, 0x9, numLocaleID, "P",
     Str0)
.head 5 +                     Function: GetText
.data CLASSPROPSSIZE
0000: 1D00
.enddata
.data CLASSPROPS
0000: 4449535049440005 002D353137000054 5950450002004600 0000000000
.enddata
.head 6 -                     Description: Returns/sets the text contained in an
object.
.head 6 +                     Returns 
.head 7 -                     String: 
.head 6 -                     Parameters 
.head 6 -                     Static Variables 
.head 6 -                     Local variables 
.head 6 +                     Actions 
.head 7 -                     Return XGetText(numObject, 0xFFFFFDFB, numLocaleID,
       "G")
.head 5 +                     Function: SetText
.data CLASSPROPSSIZE
0000: 1D00
.enddata
.data CLASSPROPS
0000: 4449535049440005 002D353137000054 5950450002004600 0000000000
.enddata
.head 6 -                     Description: Returns/sets the text contained in an
object.
.head 6 -                     Returns 
.head 6 +                     Parameters 
.head 7 -                     String: Str0
.head 6 -                     Static Variables 
.head 6 -                     Local variables 
.head 6 +                     Actions 
.head 7 -                     Call XSetText(numObject, 0xFFFFFDFB, numLocaleID,
     "P", Str0)
.head 5 +                     Function: GetTextRTF
.data CLASSPROPSSIZE
0000: 1B00
.enddata
.data CLASSPROPS
0000: 4449535049440003 0031300000545950 4500020046000000 000000
.enddata
.head 6 -                     Description: Returns/sets the text of a RichTextBox
control, including all .RTF code.
.head 6 +                     Returns 
.head 7 -                     String: 
.head 6 -                     Parameters 
.head 6 -                     Static Variables 
.head 6 -                     Local variables 
.head 6 +                     Actions 
.head 7 -                     Return XGetTextRTF(numObject, 0xA, numLocaleID,
       "G")
.head 5 +                     Function: SetTextRTF
.data CLASSPROPSSIZE
0000: 1B00
.enddata
.data CLASSPROPS
0000: 4449535049440003 0031300000545950 4500020046000000 000000
.enddata
.head 6 -                     Description: Returns/sets the text of a RichTextBox
control, including all .RTF code.
.head 6 -                     Returns 
.head 6 +                     Parameters 
.head 7 -                     String: Str0
.head 6 -                     Static Variables 
.head 6 -                     Local variables 
.head 6 +                     Actions 
.head 7 -                     Call XSetTextRTF(numObject, 0xA, numLocaleID, "P",
     Str0)
.head 5 +                     Function: ReleaseObject
.head 6 -                     Description: 
.head 6 -                     Returns 
.head 6 -                     Parameters 
.head 6 -                     Static Variables 
.head 6 -                     Local variables 
.head 6 +                     Actions 
.head 7 -                     Call SWinReleaseObject(numObject)
.head 2 +  Default Classes
.head 3 -  MDI Window: cBaseMDI
.head 3 -  Form Window:
.head 3 -  Dialog Box:
.head 3 -  Table Window:
.head 3 -  Quest Window:
.head 3 -  Data Field:
.head 3 -  Spin Field:
.head 3 -  Multiline Field:
.head 3 -  Pushbutton: ctb_pbSynchro
.head 3 -  Radio Button:
.head 3 -  Option Button:
.head 3 -  Check Box:
.head 3 -  Child Table:
.head 3 -  Quest Child Window: cQuickDatabase
.head 3 -  List Box:
.head 3 -  Combo Box:
.head 3 -  Picture:
.head 3 -  Vertical Scroll Bar:
.head 3 -  Horizontal Scroll Bar:
.head 3 -  Column:
.head 3 -  Background Text:
.head 3 -  Group Box:
.head 3 -  Line:
.head 3 -  Frame:
.head 3 -  Custom Control: cQuickOle20
.head 2 -  Application Actions
.head 1 +  Dialog Box: cdoc_dlgTemplatesList
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Список шаблонов документов
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  9.7"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 5.369"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Child Table: tblTemplatesList
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.086"
.head 6 -  Top:    0.073"
.head 6 -  Width:  8.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 4.917"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 2000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: colID
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Идентификатор
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.3"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Uppercase
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colName
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Название документа
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  5.1"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colTemplate
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Текст шаблона
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 16777216
.head 6 -  Data Type: Long String
.head 6 -  Justify: Left
.head 6 -  Width:  7.614"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? Yes
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 +  Window Variables
.head 5 -  Number: nRow
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 5 +  On UM_Populate
.head 6 -  Call SalTblPopulate(hWndForm, cdoc_hSql, T(
"SELECT id, name
 INTO :colID, :colName
 FROM doc_scheme
 ORDER BY id"), TBL_FillAll)
.head 5 +  On SAM_DoubleClick
.head 6 -  Call SalSendMsg(pbEdit, SAM_Click, 0, 0)
.head 5 +  On UM_Update
.head 6 -  Set nRow = TBL_MinRow
.head 6 +  While SalTblFindNextRow(hWndForm, nRow, ROW_New | ROW_Edited, 0)
.head 7 -  Call SalTblSetContext(hWndForm, nRow)
.head 7 +  If SalTblQueryRowFlags(hWndForm, nRow, ROW_New)
.head 8 -  Call SqlPrepareAndExecute(cdoc_hSql, T(
"INSERT INTO doc_scheme(id, name, template) 
 VALUES(:colID, :colName, empty_clob())"))
.head 8 -  Call SalTblSetRowFlags(hWndForm, nRow, ROW_New, FALSE)
.head 7 +  Else If SalTblQueryRowFlags(hWndForm, nRow, ROW_Edited)
.head 8 -  Call SqlPrepare(cdoc_hSql, T(
"UPDATE doc_scheme SET name=:colName WHERE id=:colID"))
.head 8 -  Call SalTblSetRowFlags(hWndForm, nRow, ROW_Edited, FALSE)
.head 7 +  If colTemplate
.head 8 -  Call PutStringToClob(cdoc_hSql, colTemplate, 'doc_scheme', 'id', 'template', NUMBER_Null, colID, '', 0)
.head 6 -  !
.head 6 -  Call SqlPrepare(cdoc_hSql, T("DELETE FROM doc_scheme WHERE id=:colID"))
.head 6 -  Call SalTblDoDeletes(hWndForm, cdoc_hSql, ROW_MarkDeleted)
.head 6 -  Call SqlCommit(cdoc_hSql)
.head 6 -  Call SalSendMsg(hWndForm, UM_Populate, 0, 0)
.head 3 +  Pushbutton: pbAppend
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Новый
.head 4 -  Window Location and Size
.head 5 -  Left:   8.286"
.head 5 -  Top:    0.073"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Insert.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set fNotFound = FALSE
.head 6 +  While not fNotFound
.head 7 -  ! If cdoc_GetString("Новый шаблон документа", "Введите уникальный идентификатор шаблона:",strNewID) != 0
.head 7 +  If cdoc_GetString(CurrentLangTable.GetAtomTitle('cdoc_dlgTemplatesList.cTNew'),
   CurrentLangTable.GetAtomTitle('cdoc_dlgTemplatesList.cTUniqueId'),
   strNewID) != 0
.head 8 -  Break
.head 7 -  Set strNewID = SalStrTrimX(SalStrUpperX(strNewID))
.head 7 +  If strNewID = ""
.head 8 -  Break
.head 7 -  Set i = TBL_MinRow
.head 7 -  Set fNotFound = TRUE
.head 7 +  While SalTblFindNextRow(tblTemplatesList, i, 0, 0) and fNotFound
.head 8 -  Call SalTblFetchRow(tblTemplatesList, i)
.head 8 +  If tblTemplatesList.colID = strNewID
.head 9 -  Set fNotFound = FALSE
.head 9 -  ! Call SalMessageBox("Неуникальный идентификатор " || "шаблона документа",
  "Ошибка: недопустимый идентификатор", MB_IconStop | MB_Ok)
.head 9 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('cdoc_dlgTemplatesList.cTMessId'),
  CurrentLangTable.GetAtomTitle('cdoc_dlgTemplatesList.cTErrId'), MB_IconStop | MB_Ok)
.head 7 +  If fNotFound
.head 8 -  Call SalTblFetchRow(tblTemplatesList, SalTblInsertRow(tblTemplatesList, TBL_MaxRow))
.head 8 -  Set tblTemplatesList.colID = strNewID
.head 3 +  Pushbutton: pbCopy
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Копировать
.head 4 -  Window Location and Size
.head 5 -  Left:   8.286"
.head 5 -  Top:    0.573"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Relation.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If not SalIsNull(tblTemplatesList.colID)
.head 7 -  Set fNotFound = FALSE
.head 7 -  Set strNewID = tblTemplatesList.colID
.head 7 -  Set strNewName = tblTemplatesList.colName
.head 7 -  Set strRTF_Text = IifS(tblTemplatesList.colTemplate != '', 
  tblTemplatesList.colTemplate,
  GetStringFromClob(cdoc_hSql, 'doc_scheme', 'id', 'template', NUMBER_Null, tblTemplatesList.colID, ''))
.head 7 +  While not fNotFound
.head 8 -  ! If cdoc_GetString("Новый шаблон документа", "Введите уникальный идентификатор шаблона:",strNewID) != 0
.head 8 +  If cdoc_GetString(CurrentLangTable.GetAtomTitle('cdoc_dlgTemplatesList.cTNew'),
   CurrentLangTable.GetAtomTitle('cdoc_dlgTemplatesList.cTUniqueId'),
   strNewID) != 0
.head 9 -  Break
.head 8 -  Set strNewID = SalStrTrimX(strNewID)
.head 8 +  If strNewID = ""
.head 9 -  Break
.head 8 -  Set i = TBL_MinRow
.head 8 -  Set fNotFound = TRUE
.head 8 +  While SalTblFindNextRow(tblTemplatesList, i, 0, 0) and fNotFound
.head 9 -  Call SalTblFetchRow(tblTemplatesList, i)
.head 9 +  If tblTemplatesList.colID = strNewID
.head 10 -  Set fNotFound = FALSE
.head 10 -  ! Call SalMessageBox("Неуникальный " || "идентификатор шаблона документа",
  "Ошибка: недопустимый идентификатор", MB_IconStop | MB_Ok)
.head 10 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('cdoc_dlgTemplatesList.cTMessId'),
  CurrentLangTable.GetAtomTitle('cdoc_dlgTemplatesList.cTErrId'), MB_IconStop | MB_Ok)
.head 8 +  If fNotFound
.head 9 -  Call SalTblFetchRow(tblTemplatesList, SalTblInsertRow(tblTemplatesList, TBL_MaxRow))
.head 9 -  Set tblTemplatesList.colID = strNewID
.head 9 -  Set tblTemplatesList.colName = strNewName
.head 9 -  Set tblTemplatesList.colTemplate = strRTF_Text
.head 3 +  Pushbutton: pbDelete
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Удалить
.head 4 -  Window Location and Size
.head 5 -  Left:   8.286"
.head 5 -  Top:    1.073"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Delete.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set i = TBL_MinRow
.head 6 +  While SalTblFindNextRow(tblTemplatesList, i, ROW_Selected, 0)
.head 7 -  Call SalTblSetRowFlags(tblTemplatesList, i, ROW_MarkDeleted,
  not SalTblQueryRowFlags(tblTemplatesList, i, ROW_MarkDeleted))
.head 3 +  Pushbutton: pbDocs
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Привязка
.head 4 -  Window Location and Size
.head 5 -  Left:   8.286"
.head 5 -  Top:    2.406"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Chekin.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalModalDialog(cdoc_dlgBindDocsToDeal, hWndForm)
.head 3 +  Pushbutton: pbEdit
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Редакт.
.head 4 -  Window Location and Size
.head 5 -  Left:   8.286"
.head 5 -  Top:    1.74"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Enter
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Edit.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If not SalIsNull(tblTemplatesList.colID)
.head 7 -  ! Сохраняем шаблон в файл
.head 7 -  Set strRTF_Text = IifS(tblTemplatesList.colTemplate != '', 
  tblTemplatesList.colTemplate,
  GetStringFromClob(cdoc_hSql, 'doc_scheme', 'id', 'template', NUMBER_Null, tblTemplatesList.colID, ''))
.head 7 +  If SalFileOpen(hFile, GetTempFileName(), OF_Write | OF_Create | OF_Text)
.head 8 -  Call SalFileWrite(hFile, strRTF_Text, SalStrLength(strRTF_Text))
.head 8 -  Call SalFileClose(hFile)
.head 8 +  If cdoc_IsCompressedFile(GetTempFileName())
.head 9 -  Call cdoc_DecompressFile(GetTempFileName())
.head 7 -  ! Запускаем приложение
.head 7 -  Call artfRunExp()
.head 7 -  Call artfClearListExp()
.head 7 -  ! Добавляем теги в панель инструментов
.head 7 +  If SqlPrepareAndExecute(cdoc_hSql, T(
"SELECT id, name
 INTO :strAttrID, :strAttrName
 FROM doc_attr ORDER BY name"))
.head 8 +  While SqlFetchNext(cdoc_hSql, cdoc_nFetchRes)
.head 9 -  Call artfAddTagExp(strAttrID, strAttrName)
.head 7 -  ! Редактируем шаблон
.head 7 -  Set sFileName = GetTempFileName()
.head 7 +  If artfEditRTFFileExp(sFileName)
.head 8 -  ! Компрессия файла, если он еще не сжат
.head 8 +  If not cdoc_IsCompressedFile(GetTempFileName())
.head 9 -  Call cdoc_CompressFile(GetTempFileName())
.head 8 -  ! Загружаем шаблон из файла
.head 8 +  If SalFileOpen(hFile, GetTempFileName(), OF_Read | OF_Text)
.head 9 -  Call SalFileRead(hFile, strRTF_Text, CDOC_MAX_RTF_LENGTH)
.head 9 -  Call SalFileClose(hFile)
.head 9 -  Set tblTemplatesList.colTemplate = strRTF_Text
.head 9 -  Call SalTblSetRowFlags(tblTemplatesList,
  SalTblQueryContext(tblTemplatesList), ROW_Edited, TRUE)
.head 3 +  Pushbutton: pbCommit
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Сохранить
.head 4 -  Window Location and Size
.head 5 -  Left:   8.286"
.head 5 -  Top:    3.99"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: F10
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Save.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalSendMsg(tblTemplatesList, UM_Update, 0, 0)
.head 3 +  Pushbutton: pbQuit
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Выход
.head 4 -  Window Location and Size
.head 5 -  Left:   8.286"
.head 5 -  Top:    4.49"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Esc
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\discard.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalEndDialog(hWndForm, 1)
.head 3 +  Pushbutton: pbAttrs
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Реквизиты
.head 4 -  Window Location and Size
.head 5 -  Left:   8.286"
.head 5 -  Top:    2.906"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Childs.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalModalDialog(cdoc_AttributesList, hWndForm)
.head 2 -  Functions
.head 2 -  Window Parameters
.head 2 +  Window Variables
.head 3 -  Number: i
.head 3 -  Long String: strRTF_Text
.head 3 -  Boolean: fNotFound
.head 3 -  String: strNewID
.head 3 -  String: strNewName
.head 3 -  String: strAttrID
.head 3 -  String: strAttrName
.head 3 -  File Handle: hFile
.head 3 -  String: sFileName
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  Call SalSetWindowText(hWndForm, CurrentLangTable.GetAtomTitle('cdoc_dlgTemplatesList.cTWndTitle'))
.head 4 -  Call PrepareWindow(hWndForm)
.head 4 -  Call SalSendMsg(hWndForm.cdoc_dlgTemplatesList.tblTemplatesList, UM_Populate, 0, 0)
.head 3 +  On SAM_Destroy
.head 4 -  ! Disactivation of  function's role, which activated for calling window
.head 4 +  If SalStrTrimX(SalStrUpperX(GetDBMS())) = 'ORACLE'
.head 5 -  Call XRoleUnset(cdoc_hSql,' cdoc_EditDocTemplates(hWndMDI) ')
.head 4 -  Call artfKillExp()
.head 1 +  Dialog Box: cdoc_dlgGetString
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Ввод строки
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  7.071"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 1.979"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? No
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Data Field: dfString
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.086"
.head 6 -  Top:    0.74"
.head 6 -  Width:  6.8"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbOk
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Ввод
.head 4 -  Window Location and Size
.head 5 -  Left:   4.486"
.head 5 -  Top:    1.073"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Enter
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Apply.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set strValue = dfString
.head 6 -  Call SalEndDialog(hWndForm, 0)
.head 3 +  Pushbutton: pbCancel
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Отмена
.head 4 -  Window Location and Size
.head 5 -  Left:   5.686"
.head 5 -  Top:    1.073"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Esc
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Discard.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalEndDialog(hWndForm, 1)
.head 3 +  Multiline Field: dfPrompt
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  String Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Border? No
.head 5 -  Word Wrap? Yes
.head 5 -  Vertical Scroll? No
.head 5 -  Window Location and Size
.head 6 -  Left:   0.086"
.head 6 -  Top:    0.073"
.head 6 -  Width:  6.8"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.583"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 4 -  Message Actions
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: strTitle
.head 3 -  String: strPrompt
.head 3 -  Receive String: strValue
.head 2 -  Window Variables
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  Call SalSetWindowText(hWndForm, strTitle)
.head 4 -  Call PrepareWindow(hWndForm)
.head 4 -  Set dfPrompt = strPrompt
.head 4 -  Set dfString = strValue
.head 4 -  Call SalCenterWindow(hWndForm)
.head 1 +  Dialog Box: cdoc_dlgGetChoice
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Выбор варианта
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  6.114"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 2.875"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? No
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Pushbutton: pbOk
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Выбрать
.head 4 -  Window Location and Size
.head 5 -  Left:   4.686"
.head 5 -  Top:    0.406"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Enter
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Apply.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalEndDialog(hWndForm,
     SalListQuerySelection(dfList))
.head 3 +  Pushbutton: pbCancel
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Отмена
.head 4 -  Window Location and Size
.head 5 -  Left:   4.686"
.head 5 -  Top:    0.906"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Esc
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Discard.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalEndDialog(hWndForm, -1)
.head 3 +  List Box: dfList
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.086"
.head 5 -  Top:    0.406"
.head 5 -  Width:  4.5"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 2.063"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Multiple selection? No
.head 4 -  Sorted? No
.head 4 -  Vertical Scroll? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Horizontal Scroll? No
.head 4 -  List Initialization
.head 4 +  Message Actions
.head 5 +  On SAM_DoubleClick
.head 6 -  Call SalSendMsg(pbOk, SAM_Click, 0, 0)
.head 3 +  Multiline Field: dfPrompt
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  String Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Border? No
.head 5 -  Word Wrap? Yes
.head 5 -  Vertical Scroll? No
.head 5 -  Window Location and Size
.head 6 -  Left:   0.086"
.head 6 -  Top:    0.073"
.head 6 -  Width:  4.5"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.333"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 4 -  Message Actions
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: strValues[*]
.head 3 -  Number: nItems
.head 3 -  String: strTitle
.head 3 -  String: strPrompt
.head 2 +  Window Variables
.head 3 -  Number: i
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  Call SalSetWindowText(hWndForm, CurrentLangTable.GetAtomTitle('cdoc_dlgGetChoice.cTWndTitle'))
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 4 -  Call SalSetWindowText(hWndForm, strTitle)
.head 4 -  Set dfPrompt = strPrompt
.head 4 -  Set i = 0
.head 4 +  While i < nItems
.head 5 -  Call SalListAdd(dfList, strValues[i])
.head 5 -  Set i = i + 1
.head 1 +  Dialog Box: cdoc_AttributesList
.head 2 -  Class: cGenericTableDlg
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Редактирование атрибутов документа
.head 2 -  Accesories Enabled? Class Default
.head 2 -  Visible? Class Default
.head 2 -  Display Settings
.head 3 -  Display Style? Class Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Class Default
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  Class Default
.head 4 -  Width Editable? Class Default
.head 4 -  Height: Class Default
.head 4 -  Height Editable? Class Default
.head 3 -  Absolute Screen Location? Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 2 -  Description: Список атрибутов документов 
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Class Default
.head 4 -  Location? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Size: Class Default
.head 4 -  Size Editable? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 3 +  Contents
.head 4 +  Pushbutton: pbIns
.head 5 -  Class Child Ref Key: 11
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 -  Call SalEnableWindow( cdoc_AttributesList.tblAttrs.ID )
.head 7 -  Call SalEnableWindow( cdoc_AttributesList.tblAttrs.SQL )
.head 7 -  Call SalSetFocus( cdoc_AttributesList.tblAttrs.ID )
.head 7 -  Call SalSendClassMessage( SAM_Click, 0, 0 )
.head 4 +  Pushbutton: pbDel
.head 5 -  Class Child Ref Key: 12
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 20
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbUpdate
.head 5 -  Class Child Ref Key: 15
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   1.371"
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 28777
.head 5 -  Class Child Ref Key: 19
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbSearch
.head 5 -  Class Child Ref Key: 13
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbFilter
.head 5 -  Class Child Ref Key: 23
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbPrint
.head 5 -  Class Child Ref Key: 14
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 28778
.head 5 -  Class Child Ref Key: 21
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbOk
.head 5 -  Class Child Ref Key: 16
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? No
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Option Button: pbSQL
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   3.55"
.head 6 -  Top:    0.048"
.head 6 -  Width:  0.467"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.321"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\Sql.bmp
.head 5 -  Picture Transparent Color: Gray
.head 5 -  Button Style: Check
.head 5 -  Image Style: Single
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 +  If pbSQL
.head 8 -  Call SalShowWindow( cdoc_AttributesList.tblAttrs.SQL )
.head 8 -  Call SalEnableWindow( cdoc_AttributesList.tblAttrs.SQL )
.head 7 +  Else
.head 8 -  Call SalDisableWindow( cdoc_AttributesList.tblAttrs.SQL )
.head 8 -  Call SalHideWindow( cdoc_AttributesList.tblAttrs.SQL )
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 17
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\Discard.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 28779
.head 5 -  Class Child Ref Key: 22
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 2 +  Contents
.head 3 +  Child Table: tblAttrs
.head 4 -  Class Child Ref Key: 8
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cGenericTableDlg
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: Class Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 2000
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: ID
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Идентификатор
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.1"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NAME
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наименование атрибута
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  4.967"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: SQL
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: SQL выражение
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: 512
.head 6 -  Data Type: Long String
.head 6 -  Justify: Left
.head 6 -  Width:  6.829"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On UM_Populate
.head 6 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 6 -  Call SalDisableWindow( cdoc_AttributesList.tblAttrs.ID )
.head 6 -  ! Call SalDisableWindow( cdoc_AttributesList.tblAttrs.SQL )
.head 6 -  Call SalSendClassMessage( UM_Populate, 0, 0 )
.head 2 -  Functions
.head 2 -  Window Parameters
.head 2 +  Window Variables
.head 3 -  Boolean: fNotFound
.head 3 -  Number: i
.head 3 -  String: strNewID
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  Call SalSetWindowText(hWndForm, CurrentLangTable.GetAtomTitle('cdoc_AttributesList.cTWndTitle'))
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 4 -  Set cdoc_AttributesList.strPrintFileName = 'DOC_ATTR'
.head 4 -  Set cdoc_AttributesList.strFilterTblName = 'DOC_ATTR'
.head 4 -  Set strSqlPopulate=
    "SELECT id, name, ssql
     INTO :cdoc_AttributesList.tblAttrs.ID,:cdoc_AttributesList.tblAttrs.NAME,:cdoc_AttributesList.tblAttrs.SQL
     FROM doc_attr
     order by id"
.head 4 -  !
.head 4 -  Set strSqlDelete=
    "DELETE FROM doc_attr
     WHERE id=:cdoc_AttributesList.tblAttrs.ID"
.head 4 -  !
.head 4 -  Set strSqlInsert=
    "INSERT INTO doc_attr (id,name,ssql)
     VALUES (:cdoc_AttributesList.tblAttrs.ID,:cdoc_AttributesList.tblAttrs.NAME,:cdoc_AttributesList.tblAttrs.SQL)"
.head 4 -  !
.head 4 -  Set strSqlUpdate=
    "UPDATE doc_attr
     SET name=:cdoc_AttributesList.tblAttrs.NAME, ssql=:cdoc_AttributesList.tblAttrs.SQL
     WHERE id=:cdoc_AttributesList.tblAttrs.ID"
.head 4 -  Call SalSendClassMessage( SAM_Create, 0, 0 )
.head 3 +  On UM_DoubleClick
.head 4 -  Return FALSE
.head 1 +  Dialog Box: cdoc_dlgBindDocsToDeal
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Документы, связанные с договором
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   2.08"
.head 4 -  Top:    1.258"
.head 4 -  Width:  10.271"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 4.792"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Установка связи видов договоров с шаблонами
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 -  Background Text: Вид договора:
.head 4 -  Resource Id: 1276
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.086"
.head 5 -  Top:    0.094"
.head 5 -  Width:  1.9"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: bgVidName
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cLabelControl
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Class Default
.head 5 -  Data Type: Class Default
.head 5 -  Editable? Class Default
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Justify: Class Default
.head 5 -  Format: Class Default
.head 5 -  Country: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Input Mask: Class Default
.head 4 -  Message Actions
.head 3 +  Combo Box: dfViddName
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.086"
.head 5 -  Top:    0.323"
.head 5 -  Width:  4.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 2.427"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  String Type: String
.head 4 -  Maximum Data Length: Default
.head 4 -  Sorted? No
.head 4 -  Always Show List? No
.head 4 -  Vertical Scroll? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  List Initialization
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SqlPrepareAndExecute(cdoc_hSql, T("
     SELECT vidd,name
     INTO :nViddCode,:strViddName
     FROM cc_vidd"))
.head 6 -  Set i = 0
.head 6 +  While SqlFetchNext(cdoc_hSql, cdoc_nFetchRes)
.head 7 -  Set arViddCode[i] = nViddCode
.head 7 -  Call SalListAdd(dfViddName, strViddName)
.head 7 -  Set i = i + 1
.head 6 -  Call SalListSetSelect(dfViddName, 0)
.head 6 -  Call SalSendMsg(hWndItem, SAM_Click, 0, 0)
.head 5 +  On SAM_Click
.head 6 +  If fUpdated
.head 7 -  ! If SalMessageBox("Сохранять измененный список документов в базе?","Сохранение изменений", MB_YesNo | MB_IconQuestion) = IDYES
.head 7 +  If SalMessageBox(
   CurrentLangTable.GetAtomTitle('cdoc_dlgBindDocsToDeal.cTMessSave'),
   CurrentLangTable.GetAtomTitle('cdoc_dlgBindDocsToDeal.cTSave'),
   MB_YesNo | MB_IconQuestion) = IDYES
.head 8 -  Call SalSendMsg(pbCommit, SAM_Click, 0, 0)
.head 6 -  Set nViddCode = arViddCode[SalListQuerySelection(dfViddName)]
.head 6 -  Call SalListPopulate(dfSelected, cdoc_hSql, T(
  "SELECT id FROM doc_root WHERE vidd=:nViddCode"))
.head 6 -  Set fUpdated = FALSE
.head 6 -  Call SalSendMsg(tblTemplatesList, UM_Populate, 0, 0)
.head 3 +  List Box: dfSelected
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.086"
.head 5 -  Top:    0.656"
.head 5 -  Width:  2.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 3.729"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Multiple selection? No
.head 4 -  Sorted? No
.head 4 -  Vertical Scroll? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Horizontal Scroll? No
.head 4 -  List Initialization
.head 4 +  Message Actions
.head 5 +  On SAM_DoubleClick
.head 6 -  Call SalSendMsg(pbDelete, SAM_Click, 0, 0)
.head 3 +  Child Table: tblTemplatesList
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   4.186"
.head 6 -  Top:    0.073"
.head 6 -  Width:  5.9"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 4.333"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 5000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: colID
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Идентификатор
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.843"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colName
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наименование документа
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  3.429"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 5 +  On UM_Populate
.head 6 -  Call SalTblPopulate(tblTemplatesList, cdoc_hSql, T(
"SELECT id,name
 INTO :colID,:colName
 FROM doc_scheme 
 WHERE id NOT IN (SELECT id  FROM doc_root WHERE vidd=:nViddCode)
 ORDER BY id ASC"), TBL_FillAll)
.head 5 +  On SAM_DoubleClick
.head 6 -  Call SalSendMsg(pbAppend, SAM_Click, 0, 0)
.head 3 +  Pushbutton: pbAppend
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Добавить
.head 4 -  Window Location and Size
.head 5 -  Left:   2.886"
.head 5 -  Top:    0.74"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Prevrec.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If not SalIsNull(tblTemplatesList.colID)
.head 7 +  If SalListSelectString(dfSelected, -1, tblTemplatesList.colID||' ') = LB_Err
.head 8 -  Call SalListAdd(dfSelected, tblTemplatesList.colID)
.head 8 -  Set fUpdated = TRUE
.head 3 +  Pushbutton: pbDelete
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Удалить
.head 4 -  Window Location and Size
.head 5 -  Left:   2.886"
.head 5 -  Top:    1.24"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Nextrec.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalListDelete(dfSelected,
     SalListQuerySelection(dfSelected))
.head 6 -  Set fUpdated = TRUE
.head 3 +  Pushbutton: pbCommit
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Сохранить
.head 4 -  Window Location and Size
.head 5 -  Left:   2.886"
.head 5 -  Top:    1.823"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: F10
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Save.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SqlPrepareAndExecute(cdoc_hSql, T(
"DELETE FROM doc_root WHERE vidd=:nViddCode"))
.head 6 -  Set i = 0
.head 6 +  While SalListQueryText(dfSelected, i, strID) != LB_Err
.head 7 -  Call SqlPrepareAndExecute(cdoc_hSql, T("
     INSERT
     INTO doc_root (vidd,id)
     VALUES (:nViddCode,:strID)"))
.head 7 -  Set i = i + 1
.head 6 -  Call SqlCommit(cdoc_hSql)
.head 6 -  Call SalSendMsg( tblTemplatesList, UM_Populate, 0, 0 )
.head 6 -  Set fUpdated = FALSE
.head 3 +  Pushbutton: pbQuit
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Выход
.head 4 -  Window Location and Size
.head 5 -  Left:   2.886"
.head 5 -  Top:    3.823"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Esc
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\Discard.bmp
.head 4 -  Picture Transparent Color: Gray
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalEndDialog(hWndForm, 0)
.head 2 -  Functions
.head 2 -  Window Parameters
.head 2 +  Window Variables
.head 3 -  Number: arViddCode[*]
.head 3 -  Number: nViddCode
.head 3 -  Number: i
.head 3 -  String: strViddName
.head 3 -  Boolean: fUpdated
.head 3 -  String: strID
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  Call SalSetWindowText(hWndForm, CurrentLangTable.GetAtomTitle('cdoc_dlgBindDocsToDeal.cTWndTitle'))
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 3 +  On SAM_Close
.head 4 +  If fUpdated
.head 5 -  ! If SalMessageBox("Сохранять измененный список документов в базе?","Сохранение изменений", MB_YesNo | MB_IconQuestion) =IDYES
.head 5 +  If SalMessageBox(
   CurrentLangTable.GetAtomTitle('cdoc_dlgBindDocsToDeal.cTMessSave'),
   CurrentLangTable.GetAtomTitle('cdoc_dlgBindDocsToDeal.cTSave'), MB_YesNo | MB_IconQuestion) =
   IDYES
.head 6 -  Call SalSendMsg(pbCommit, SAM_Click, 0, 0)
.head 1 +  Dialog Box: dlg_DocumentList
.head 2 -  Class: cGenericTableDlg
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Список документов по договору №
.head 2 -  Accesories Enabled? Class Default
.head 2 -  Visible? No
.head 2 -  Display Settings
.head 3 -  Display Style? Class Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Class Default
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  12.3"
.head 4 -  Width Editable? Class Default
.head 4 -  Height: 5.81"
.head 4 -  Height Editable? Class Default
.head 3 -  Absolute Screen Location? Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 2 -  Description: Список документов по депозитному договору
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Class Default
.head 4 -  Location? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Size: Class Default
.head 4 -  Size Editable? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 3 +  Contents
.head 4 +  Pushbutton: pbIns
.head 5 -  Class Child Ref Key: 11
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDel
.head 5 -  Class Child Ref Key: 12
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 20
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbUpdate
.head 5 -  Class Child Ref Key: 15
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   1.383"
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 59001
.head 5 -  Class Child Ref Key: 19
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbSearch
.head 5 -  Class Child Ref Key: 13
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   2.033"
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbFilter
.head 5 -  Class Child Ref Key: 23
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbPrint
.head 5 -  Class Child Ref Key: 14
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 59002
.head 5 -  Class Child Ref Key: 21
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Coordinates
.head 6 -  Begin X:  3.933"
.head 6 -  Begin Y:  0.429"
.head 6 -  End X:  3.933"
.head 6 -  End Y:  0.012"
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbOk
.head 5 -  Class Child Ref Key: 16
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   3.383"
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Yes
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\Open.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 +  If tbl.colID
.head 8 +  If tbl.colSTATE = 1
.head 9 +  If tbl.colTEXT
.head 10 -  Set sDoc = tbl.colTEXT
.head 9 +  Else
.head 10 -  Set sDoc = cdoc_GetDocText(hSql(), tbl.colID, tbl.colND, tbl.colADDS, tbl.colVERSION)
.head 9 +  Select Case cdoc_ShowDoc(sDoc, IifN(nRW=1,1,0), TRUE)
.head 10 +  Case 1
.head 11 -  Set dlg_DocumentList.tbl.colTEXT = sDoc
.head 11 -  Call cdoc_SetDocText(hSql(), FALSE, dlg_DocumentList.tbl.colID, dlg_DocumentList.tbl.colND, 
     dlg_DocumentList.tbl.colADDS, dlg_DocumentList.tbl.colVERSION, sDoc)
.head 11 -  Call SqlPrepareAndExecute(hSql(), 
"UPDATE CC_DOCS SET VERSION=SYSDATE 
 WHERE id=:dlg_DocumentList.tbl.colID 
   AND nd=:dlg_DocumentList.tbl.colND
   AND adds=:dlg_DocumentList.tbl.colADDS
   AND version=:dlg_DocumentList.tbl.colVERSION")
.head 11 -  ! Call SaveInfoToLog('CC_DOCS. Текст договора № ' || SalNumberToStrX(dlg_DocumentList.tbl.colND,0) || 
  '[' || SalNumberToStrX(dlg_DocumentList.tbl.colADDS,0) || ']' || ' перезаписан в БД!')
.head 11 -  Call SqlCommitEx(hSql(), 'CC_DOCS. ' || 
     CurrentLangTable.GetAtomTitle('dlg_DocumentList.cTTextDogUpdate') || SalNumberToStrX(dlg_DocumentList.tbl.colND,0) || 
     '[' || SalNumberToStrX(dlg_DocumentList.tbl.colADDS,0) || ']')
.head 11 -  Break
.head 10 +  Case 2
.head 11 -  Set dlg_DocumentList.tbl.colTEXT = sDoc
.head 11 -  Call cdoc_SetDocText(hSql(), TRUE, dlg_DocumentList.tbl.colID, dlg_DocumentList.tbl.colND, 
     0, DATETIME_Null, sDoc)
.head 11 -  ! Call SaveInfoToLog('CC_DOCS. Добавлен текст договора № ' || SalNumberToStrX(dlg_DocumentList.tbl.colND,0) || 
  '[' || SalNumberToStrX(dlg_DocumentList.tbl.colADDS,0) || ']' )
.head 11 -  Call SaveInfoToLog('CC_DOCS. ' || 
     CurrentLangTable.GetAtomTitle('dlg_DocumentList.cTTextDogAdd') || SalNumberToStrX(dlg_DocumentList.tbl.colND,0) || 
     '[' || SalNumberToStrX(dlg_DocumentList.tbl.colADDS,0) || ']' )
.head 11 -  Call SalSendMsg(pbRefresh, SAM_Click, 0, 0)
.head 11 -  Break
.head 8 +  Else
.head 9 -  ! If SalMessageBox( 'Документ уже подписан!
Открыть документ для просмотра?', 'Подтверждение'
.head 9 +  If SalMessageBox(CurrentLangTable.GetAtomTitle('dlg_DocumentList.cTMessDocIsSign') || PutCrLf() || 
   CurrentLangTable.GetAtomTitle('dlg_DocumentList.cTMessOpenDoc'), 
   CurrentLangTable.GetAtomTitle('dlg_DocumentList.cTConfirm'), MB_IconQuestion | MB_YesNo )=IDYES
.head 10 +  If tbl.colTEXT
.head 11 -  Set sDoc = tbl.colTEXT
.head 10 +  Else
.head 11 -  Set sDoc = cdoc_GetDocText(hSql(), tbl.colID, tbl.colND, tbl.colADDS, tbl.colVERSION)
.head 10 -  Call cdoc_ShowDoc(sDoc, FALSE, FALSE)
.head 8 -  Call SalSendMsg(tbl, UM_Populate, 0, 0)
.head 6 +  On SAM_Create
.head 7 -  ! 'Посмотреть/Редактировать выбранный документ'
.head 7 -  Set strTip = CurrentLangTable.GetAtomTitle('dlg_DocumentList.cBTipOk')
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 17
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   4.083"
.head 6 -  Top:    0.048"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 59003
.head 5 -  Class Child Ref Key: 22
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Coordinates
.head 6 -  Begin X:  4.633"
.head 6 -  Begin Y:  0.44"
.head 6 -  End X:  4.633"
.head 6 -  End Y:  0.024"
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 -  Line
.head 5 -  Resource Id: 59004
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Coordinates
.head 6 -  Begin X:  5.267"
.head 6 -  Begin Y:  0.44"
.head 6 -  End X:  5.267"
.head 6 -  End Y:  0.024"
.head 5 -  Visible? Yes
.head 5 -  Line Style: Etched
.head 5 -  Line Thickness: 1
.head 5 -  Line Color: 3D Shadow Color
.head 4 +  Pushbutton: pbSign
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbEdit
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   4.75"
.head 6 -  Top:    0.048"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  ! 'Подписать договор'
.head 7 -  Set strTip = CurrentLangTable.GetAtomTitle('dlg_DocumentList.cBTipSign')
.head 6 +  On SAM_Click
.head 7 +  If tbl.colID
.head 8 +  If tbl.colSTATE = 1
.head 9 -  ! If SalMessageBox('Вы уверены, что хотите подписать документ?
После подписания документа его редактирование и удаление станет невозможным!', 
'Подтверждение', MB_IconQuestion | MB_YesNo | MB_DefButton2 ) = IDYES
.head 9 +  If SalMessageBox(CurrentLangTable.GetAtomTitle('dlg_DocumentList.cTMessSignDoc') || PutCrLf() ||
   CurrentLangTable.GetAtomTitle('dlg_DocumentList.cTMessSignDoc_'), 
   CurrentLangTable.GetAtomTitle('dlg_DocumentList.cTConfirm'), MB_IconQuestion | MB_YesNo | MB_DefButton2 ) = IDYES
.head 10 +  If SqlPrepareAndExecute(hSqlAux(), 
"UPDATE CC_DOCS SET STATE=2, VERSION=SYSDATE 
 WHERE id=:dlg_DocumentList.tbl.colID 
   AND nd=:dlg_DocumentList.tbl.colND
   AND adds=:dlg_DocumentList.tbl.colADDS
   AND version=:dlg_DocumentList.tbl.colVERSION")
.head 11 -  Call SqlCommitEx( hSqlAux(), 'Договор подписан ' || 
     dlg_DocumentList.tbl.colID || ' ' ||
     SalNumberToStrX( dlg_DocumentList.tbl.colND, 0 ) || ' ' ||
     SalNumberToStrX( dlg_DocumentList.tbl.colADDS, 0 ) )
.head 8 +  Else
.head 9 -  ! Call SalMessageBox( 'Документ уже подписан!', 'Ошибка', MB_IconStop | MB_Ok  )
.head 9 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('dlg_DocumentList.cTMessDocIsSign'), 
     CurrentLangTable.GetAtomTitle('cTErr'), MB_IconStop | MB_Ok)
.head 8 -  Call SalSendMsg(tbl, UM_Populate, 0, 0)
.head 2 +  Contents
.head 3 +  Child Table: tbl
.head 4 -  Class Child Ref Key: 8
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cGenericTableDlg
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   -0.033"
.head 6 -  Top:    0.012"
.head 6 -  Width:  12.2"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 5.095"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: Class Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 256
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: colID
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код шаблона
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.733"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNAME
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наименование шаблона
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  3.8"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colND
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colADDS
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: № доп. согл.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  1.571"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVERSION
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата сохранения
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Left
.head 6 -  Width:  1.967"
.head 6 -  Width Editable? Yes
.head 6 -  Format: dd/MM/yyyy hhhh:mm:ss
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colSTATE
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Подписан
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  1.143"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Check Box
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value: 2
.head 8 -  Uncheck Value: 1
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colTEXT
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 16777216
.head 6 -  Data Type: Long String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDoneby
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colUserName
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Исполнитель
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colComm
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Комментарий
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  3.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 +  Window Variables
.head 5 -  Number: nRow
.head 5 -  Number: nCurRow
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 5 +  On SAM_DoubleClick
.head 6 -  Call SalSendMsg(pbOk, SAM_Click, 0, 0)
.head 5 +  On UM_Insert
.head 6 -  Call SalSendMsg(hMessageWnd, UM_CreateDoc, 0, 0)
.head 6 -  Call SalSendClassMessage(UM_Populate, 0, 0)
.head 5 +  On UM_Delete
.head 6 -  Set nCurRow = SalTblQueryContext(hWndForm)
.head 6 -  Set nRow = 0
.head 6 +  While SalTblSetContext(hWndForm, nRow)
.head 7 +  If colSTATE = 1 AND SalTblQueryRowFlags(hWndForm, nRow, ROW_Selected)
.head 8 -  Call SalTblSetRowFlags(hWndForm, nRow, ROW_MarkDeleted,
  not SalTblQueryRowFlags(hWndForm, nRow, ROW_MarkDeleted))
.head 7 -  Call SalTblSetRowFlags(hWndForm, nRow, ROW_Selected, FALSE)
.head 7 -  Set nRow = nRow + 1
.head 6 -  Call SalTblSetContext(hWndForm, nCurRow)
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  ! Номер договора
.head 3 -  Number: nND
.head 3 -  ! Окно, обрабатывающее сообщение о добавлении  документа
.head 3 -  Window Handle: hMessageWnd
.head 3 -  ! создание новых (1) / просмотр существующих (0) / просмотр с правом подписи (2) договоров
.head 3 -  Number: nRW
.head 2 +  Window Variables
.head 3 -  Long String: sDoc
.head 3 -  Number: nChg
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  ! Call SalSetWindowText(hWndForm, 'Список документов по договору №' || SalNumberToStrX(nND, 0))
.head 4 -  Call SalSetWindowText(hWndForm, CurrentLangTable.GetAtomTitle('dlg_DocumentList.cTWndTitle') || SalNumberToStrX(nND, 0))
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 4 -  ! Только просмотр
.head 4 +  If nRW = 0
.head 5 -  Call SalDisableWindow(pbIns)
.head 5 -  Call SalDisableWindow(pbDel)
.head 5 -  Call SalDisableWindow(pbUpdate)
.head 5 -  Call SalDisableWindow(pbSign)
.head 5 -  Call SalDisableWindow(tbl.colComm)
.head 4 -  ! Просмотр с правом подписи
.head 4 +  If nRW = 2
.head 5 -  Call SalDisableWindow(pbIns)
.head 5 -  Call SalDisableWindow(pbDel)
.head 5 -  Call SalDisableWindow(pbUpdate)
.head 5 -  Call SalDisableWindow(tbl.colComm)
.head 4 -  Set strPrintFileName = 'Docs'
.head 4 -  Set strFilterTblName = 'CC_DOCS'
.head 4 -  Set strSqlPopulate = 
"SELECT D.ID, S.NAME, D.ND, D.ADDS, D.VERSION, D.STATE, D.doneby, u.fio, D.COMM
 INTO :dlg_DocumentList.tbl.colID, :dlg_DocumentList.tbl.colNAME,
      :dlg_DocumentList.tbl.colND, :dlg_DocumentList.tbl.colADDS,
      :dlg_DocumentList.tbl.colVERSION, :dlg_DocumentList.tbl.colSTATE,
      :dlg_DocumentList.tbl.colDoneby, :dlg_DocumentList.tbl.colUserName, 
      :dlg_DocumentList.tbl.colComm  
 FROM CC_DOCS D, DOC_SCHEME S, staff u  
 WHERE D.ID=S.ID AND D.ND=:dlg_DocumentList.nND  
   AND d.doneby=u.logname(+) 
 ORDER BY D.VERSION, S.NAME"
.head 4 -  !
.head 4 -  Set strSqlDelete = 
"DELETE FROM CC_DOCS 
 WHERE id=:dlg_DocumentList.tbl.colID 
   AND nd=:dlg_DocumentList.tbl.colND
   AND adds=:dlg_DocumentList.tbl.colADDS
   AND version=:dlg_DocumentList.tbl.colVERSION"
.head 4 -  Set strSqlUpdate = 
"UPDATE CC_DOCS SET COMM=:dlg_DocumentList.tbl.colComm 
 WHERE id=:dlg_DocumentList.tbl.colID 
   AND nd=:dlg_DocumentList.tbl.colND
   AND adds=:dlg_DocumentList.tbl.colADDS
   AND version=:dlg_DocumentList.tbl.colVERSION"
.head 4 -  !
.head 4 -  Call SalSendClassMessage(SAM_Create, 0, 0)
.head 1 +  Dialog Box: dlg_SelectTemplate
.head 2 -  Class: cGenericTableDlg
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Выберите шаблон
.head 2 -  Accesories Enabled? Class Default
.head 2 -  Visible? No
.head 2 -  Display Settings
.head 3 -  Display Style? Class Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Class Default
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  7.85"
.head 4 -  Width Editable? Class Default
.head 4 -  Height: 5.2"
.head 4 -  Height Editable? Class Default
.head 3 -  Absolute Screen Location? Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 2 -  Description: Выбор шаблона договора
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Class Default
.head 4 -  Location? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Size: Class Default
.head 4 -  Size Editable? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 3 +  Contents
.head 4 +  Pushbutton: pbIns
.head 5 -  Class Child Ref Key: 11
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDel
.head 5 -  Class Child Ref Key: 12
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 20
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbUpdate
.head 5 -  Class Child Ref Key: 15
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 1132
.head 5 -  Class Child Ref Key: 19
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbSearch
.head 5 -  Class Child Ref Key: 13
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbFilter
.head 5 -  Class Child Ref Key: 23
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbPrint
.head 5 -  Class Child Ref Key: 14
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 1133
.head 5 -  Class Child Ref Key: 21
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbOk
.head 5 -  Class Child Ref Key: 16
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 17
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 1134
.head 5 -  Class Child Ref Key: 22
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTableDlg
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 2 +  Contents
.head 3 +  Child Table: tbl
.head 4 -  Class Child Ref Key: 8
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cGenericTableDlg
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  7.8"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 4.512"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: Class Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 2000
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: colID
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код шаблона
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNAME
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наименование шаблона
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  5.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 -  Message Actions
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: sTabName
.head 3 -  String: sTemplateIdField
.head 3 -  String: sTemplateNameField
.head 3 -  String: sAuxCondition
.head 3 -  Receive String: sTemplateId
.head 2 -  Window Variables
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  ! Список шаблонов документов
.head 4 -  Call SalSetWindowText(hWndForm, CurrentLangTable.GetAtomTitle('dlg_SelectTemplate.cTWndTitle'))
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 4 -  Set sTabName = SalStrUpperX(SalStrTrimX(sTabName))
.head 4 -  Set sTemplateId = ''
.head 4 -  Set dlg_SelectTemplate.nFlags = GT_ReadOnly
.head 4 -  Set strSqlPopulate = 
"SELECT " || sTemplateIdField ||", " || sTemplateNameField || "
   INTO :dlg_SelectTemplate.tbl.colID, :dlg_SelectTemplate.tbl.colNAME " || "
   FROM " || sTabName || 
IifS(sTabName='DOC_SCHEME', " WHERE (d_close is null or d_close>bankdate) ", "") || 
IifS(sAuxCondition='', "", IifS(sTabName='DOC_SCHEME', " and ", " where ") || " (" || sAuxCondition || ") ") || 
" ORDER BY 2 "
.head 4 +  ! If sAuxCondition
.head 5 -         Set strSqlPopulate = strSqlPopulate || " and (" || sAuxCondition || ") "
.head 4 -  ! Set strSqlPopulate = strSqlPopulate || " ORDER BY 2 "
.head 4 -  !
.head 4 -  Call SalSendClassMessage(SAM_Create, 0, 0)
.head 3 +  On UM_DoubleClick
.head 4 +  If tbl.colID
.head 5 -  Set sTemplateId = tbl.colID
.head 5 -  Call SalEndDialog(hWndForm, 99)
.head 1 +  Table Window: cdoc_List
.head 2 -  Class: cGenericTable
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Список шаблонов договоров
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? Class Default
.head 2 -  Visible? Class Default
.head 2 -  Display Settings
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Class Default
.head 3 -  Initial State: Class Default
.head 3 -  Maximizable? Class Default
.head 3 -  Minimizable? Class Default
.head 3 -  System Menu? Class Default
.head 3 -  Resizable? Class Default
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  11.5"
.head 4 -  Width Editable? Class Default
.head 4 -  Height: Class Default
.head 4 -  Height Editable? Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 3 -  View: Class Default
.head 3 -  Allow Row Sizing? Class Default
.head 3 -  Lines Per Row: Class Default
.head 2 -  Memory Settings
.head 3 -  Maximum Rows in Memory: 2000
.head 3 -  Discardable? Class Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Class Default
.head 4 -  Location? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Size: 0.464"
.head 4 -  Size Editable? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 3 +  Contents
.head 4 +  Pushbutton: pbIns
.head 5 -  Class Child Ref Key: 33
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 -  Call SalEnableWindow( cdoc_List.ID )
.head 7 -  Call SalSetFocus( cdoc_List.ID )
.head 7 -  Call SalSendClassMessage( SAM_Click, 0, 0 )
.head 4 +  Pushbutton: pbDel
.head 5 -  Class Child Ref Key: 34
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 35
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbUpdate
.head 5 -  Class Child Ref Key: 36
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 13523
.head 5 -  Class Child Ref Key: 37
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  6.467"
.head 6 -  Begin Y:  0.0"
.head 6 -  End X:  6.467"
.head 6 -  End Y:  0.464"
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbSearch
.head 5 -  Class Child Ref Key: 38
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   2.033"
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbFilter
.head 5 -  Class Child Ref Key: 44
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   2.467"
.head 6 -  Top:    0.071"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDetails
.head 5 -  Class Child Ref Key: 39
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\Edit.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 +  If GetGlobalOption('MSOWORD-') = '1'
.head 8 -  ! Выберите файл
.head 8 +  If SalDlgOpenFile(hWndForm, CurrentLangTable.GetAtomTitle('cdoc_List.cTFileSelect'), 
   strFilters, 6, nIndex, strFile, sFullName)
.head 9 -  ! Загружаем шаблон из файла
.head 9 +  If SalFileOpen(hFile, sFullName, OF_Read | OF_Text)
.head 10 -  Call SalFileRead(hFile, strRTF_Text, CDOC_MAX_RTF_LENGTH)
.head 10 -  Call SalFileClose(hFile)
.head 10 +  If SalStrScan(SalStrLowerX(Subs(strRTF_Text,1,2000)),'<head>') = -1
.head 11 -  ! Неверный формат файла!
.head 11 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('cdoc_List.cTMessFormatError'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation | MB_Ok)
.head 10 +  Else
.head 11 -  Set cdoc_List.TEMPLATE = strRTF_Text
.head 11 -  Call SalTblSetRowFlags(cdoc_List, SalTblQueryContext(cdoc_List), ROW_Edited,TRUE)
.head 7 +  Else
.head 8 +  If not SalIsNull(cdoc_List.ID)
.head 9 -  Call SaveInfoToLog(ID || ' - Користувач обрав "Редагувати шаблон"')
.head 9 -  Set strRTF_Text = IifS(cdoc_List.TEMPLATE != '', cdoc_List.TEMPLATE, 
  GetStringFromClob(hSql(), 'doc_scheme', 'id', 'template', NUMBER_Null, ID, ''))
.head 9 +  If SalFileOpen(hFile, GetTempFileName(), OF_Write | OF_Create | OF_Text)
.head 10 -  Call SalFileWrite(hFile, strRTF_Text, SalStrLength(strRTF_Text))
.head 10 -  Call SalFileClose(hFile)
.head 10 +  If cdoc_IsCompressedFile( GetTempFileName() )
.head 11 -  Call cdoc_DecompressFile( GetTempFileName() )
.head 9 -  ! Запускаем приложение
.head 9 -  Call artfRunExp()
.head 9 -  Call artfClearListExp()
.head 9 -  ! Добавляем теги в панель инструментов
.head 9 +  If SqlPrepareAndExecute(cdoc_hSql, T(
"SELECT id, name
 INTO :strAttrID, :strAttrName
 FROM doc_attr ORDER BY name"))
.head 10 +  While SqlFetchNext(cdoc_hSql, cdoc_nFetchRes)
.head 11 -  Call artfAddTagExp( strAttrID, strAttrName )
.head 9 -  ! Редактируем шаблон
.head 9 -  Set sFileName=GetTempFileName()
.head 9 +  If artfEditRTFFileExp( sFileName )
.head 10 -  ! Компрессия файла, если он еще не сжат
.head 10 +  If not cdoc_IsCompressedFile(GetTempFileName())
.head 11 -  Call cdoc_CompressFile(GetTempFileName())
.head 10 -  ! Загружаем шаблон из файла
.head 10 +  If SalFileOpen(hFile, GetTempFileName(), OF_Read | OF_Text)
.head 11 -  Call SalFileRead(hFile, strRTF_Text, CDOC_MAX_RTF_LENGTH)
.head 11 -  Call SalFileClose(hFile)
.head 11 -  Set cdoc_List.TEMPLATE = strRTF_Text
.head 11 -  Call SalTblSetRowFlags(cdoc_List, SalTblQueryContext(cdoc_List), ROW_Edited,TRUE)
.head 6 +  On SAM_Create
.head 7 -  ! Редактировать
.head 7 -  Set strTip = CurrentLangTable.GetAtomTitle('cdoc_List.cBTipDetails')
.head 4 +  Pushbutton: pbPrint
.head 5 -  Class Child Ref Key: 40
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   4.183"
.head 6 -  Top:    0.071"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 13524
.head 5 -  Class Child Ref Key: 41
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  4.767"
.head 6 -  Begin Y:  -0.048"
.head 6 -  End X:  4.767"
.head 6 -  End Y:  0.417"
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 42
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   5.917"
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 13525
.head 5 -  Class Child Ref Key: 43
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbAttrs
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbChilds
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   3.783"
.head 6 -  Top:    0.071"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 -  Call SalModalDialog(cdoc_AttributesList, hWndForm)
.head 6 +  On SAM_Create
.head 7 -  ! 'Реквизиты шаблонов'
.head 7 -  Set strTip = CurrentLangTable.GetAtomTitle('cdoc_List.cBTipAttrs')
.head 4 +  Pushbutton: pbDocs
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbSynchro
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   3.35"
.head 6 -  Top:    0.071"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\Chekin.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 -  Call SalModalDialog(cdoc_dlgBindDocsToDeal, hWndForm)
.head 6 +  On SAM_Create
.head 7 -  ! 'Привязка'
.head 7 -  Set strTip = CurrentLangTable.GetAtomTitle('cdoc_List.cBTipDocs')
.head 4 -  Line
.head 5 -  Resource Id: 24158
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class:
.head 5 -  Coordinates
.head 6 -  Begin X:  5.833"
.head 6 -  Begin Y:  0.024"
.head 6 -  End X:  5.833"
.head 6 -  End Y:  0.488"
.head 5 -  Visible? Yes
.head 5 -  Line Style: Etched
.head 5 -  Line Thickness: 1
.head 5 -  Line Color: 3D Shadow Color
.head 4 +  Pushbutton: pbImport
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbChilds
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   4.883"
.head 6 -  Top:    0.071"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\fromdisk.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = CurrentLangTable.GetAtomTitle('cdoc_List.cBTipImport')
.head 6 +  On SAM_Click
.head 7 -  Set bOne = TRUE
.head 7 -  ! каталог импорта пакета файлов
.head 7 -  Set sPath = GetGlobalOption('CDOCIMP')
.head 7 +  If sPath
.head 8 -  Set bOne = FALSE
.head 8 +  If not VisDosExist(sPath)
.head 9 +  If SalMessageBox("Вказано неіснуючий каталог для імпорту договорів: " || sPath || PutCrLf() ||
   "Продовжити?", "Увага!", MB_IconExclamation | MB_YesNo) = IDYES
.head 10 -  Set bOne = TRUE
.head 8 +  Else
.head 9 -  ! Смотрим в каталог импорта
.head 9 -  Set nFiles = VisDosEnumFiles(sPath || '\\' || '*.*', FA_Standard, smFile)
.head 9 -  ! Если файлов для импорта нет - выходим
.head 9 +  If nFiles <= 0
.head 10 -  Call SalMessageBox("Відсутні файли в " || sPath, "Увага!", MB_IconStop | MB_Ok)
.head 10 -  Return FALSE
.head 9 +  Else
.head 10 +  If SalMessageBox("Виконати імпорт договорів з каталогу " || sPath || " ?", "Повідомлення", MB_IconQuestion | MB_YesNo) = IDNO
.head 11 -  Return FALSE
.head 9 -  Call SalWaitCursor(TRUE)
.head 9 -  Set i = 0
.head 9 +  While i < nFiles
.head 10 -  Set sDocId = SalStrUpperX(SalStrLeftX(smFile[i], SalStrScan(smFile[i], '.' )))
.head 10 -  Call Import(sPath || '\\' || smFile[i], sDocId, nAddFlag) 
.head 10 -  Set i = i + 1
.head 9 -  Call SalWaitCursor(FALSE)
.head 9 -  Call SalMessageBox("Виконано імпорт договорів." || PutCrLf() || "Для нових договорів відредагуйте назву шаблона.",
     "Повідомлення", MB_IconAsterisk | MB_Ok)
.head 9 -  Call SalSendMsg(hWndForm, UM_Populate, 0, 0)
.head 7 +  If bOne 
.head 8 -  Set nIndex = 1
.head 8 +  If SalDlgOpenFile(hWndForm, CurrentLangTable.GetAtomTitle('cdoc_List.cTFileSelect'), 
   strFilters_htm, 6, nIndex, strFile, sFullName)
.head 9 -  Set sDocId = SalStrUpperX(SalStrLeftX(strFile, SalStrScan(strFile, '.' )))
.head 9 +  If Import(sFullName, sDocId, nAddFlag)
.head 10 -  Call SalMessageBox(IifS(nAddFlag=0,
     "Шаблон з ідентифікатором '" || sDocId || "' успішно імпортовано." || PutCrLf() || "Відредагуйте назву шаблона.",
     "Шаблон з ідентифікатором '" || sDocId || "' успішно оновлено."),
     "Повідомлення", MB_IconAsterisk|MB_Ok)
.head 10 -  Call SalSendMsg(hWndForm, UM_Populate, 0, 0)
.head 4 +  Pushbutton: pbExport
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbChilds
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   5.333"
.head 6 -  Top:    0.071"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\todisk.bmp
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip = CurrentLangTable.GetAtomTitle('cdoc_List.cBTipExport')
.head 6 +  On SAM_Click
.head 7 -  Call SalWaitCursor(TRUE)
.head 7 -  Set hasSelectedRows = FALSE
.head 7 -  Set nNextRow = TBL_MinRow
.head 7 +  While SalTblFindNextRow(cdoc_List, nNextRow, ROW_Selected, 0)
.head 8 -  Call SalTblSetContext(cdoc_List, nNextRow)
.head 8 -  Set sFullName = GetPrnDir() || '\\' || cdoc_List.ID || '.htm'
.head 8 -  Set hasSelectedRows = TRUE
.head 8 +  If not PutClobToFile( hSql(), sFullName, 'DOC_SCHEME', 'ID', 'TEMPLATE', 
NUMBER_Null, cdoc_List.ID, STRING_Null )
.head 9 -  Call SalMessageBox( 'Шаблон '||cdoc_List.ID||' експортовано з помилками', 
                    'Помилка', MB_Ok | MB_IconStop )
.head 7 -  Call SalWaitCursor(FALSE)
.head 7 +  If hasSelectedRows
.head 8 -  Call SalMessageBox( 'Відмічені шаблони екпортовано в каталог друку '||GetPrnDir(), 
                    'Повідомлення', MB_Ok | MB_IconAsterisk )
.head 8 -  Call SalSendMsg(hWndForm, UM_Populate, 0, 0)
.head 7 +  Else
.head 8 -  Call SalMessageBox( 'Не відмічено жодного шаблону', 
                    'Повідомлення', MB_Ok | MB_IconAsterisk )
.head 2 +  Contents
.head 3 +  Column: ID
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cColumnLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Идентификатор
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: 35
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  3.6"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Uppercase
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 +  Message Actions
.head 5 +  On SAM_DoubleClick
.head 6 -  Call SalSendMsg(pbDetails, SAM_Click, 0, 0)
.head 3 +  Column: NAME
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cColumnLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Название документа
.head 4 -  Visible? Yes
.head 4 -  Editable? Yes
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  5.9"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: TEMPLATE
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cColumnLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Текст шаблона
.head 4 -  Visible? No
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: 16777216
.head 4 -  Data Type: Long String
.head 4 -  Justify: Left
.head 4 -  Width:  7.614"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? Yes
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: colPrintOnBlank
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cColumnLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Печать
на бланках
.head 4 -  Visible? No
.head 4 -  Editable? Yes
.head 4 -  Maximum Data Length: Class Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Class Default
.head 4 -  Width:  1.2"
.head 4 -  Width Editable? Class Default
.head 4 -  Format: Class Default
.head 4 -  Country: Class Default
.head 4 -  Input Mask: Class Default
.head 4 -  Cell Options
.head 5 -  Cell Type? Check Box
.head 5 -  Multiline Cell? Class Default
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Class Default
.head 6 -  Vertical Scroll? Class Default
.head 6 -  Auto Drop Down? Class Default
.head 6 -  Allow Text Editing? Class Default
.head 5 -  Cell CheckBox
.head 6 -  Check Value: 1
.head 6 -  Uncheck Value: 0
.head 6 -  Ignore Case? Class Default
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: DCLOSE
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cColumnLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Дата
закрытия
.head 4 -  Visible? Class Default
.head 4 -  Editable? Class Default
.head 4 -  Maximum Data Length: Class Default
.head 4 -  Data Type: Date/Time
.head 4 -  Justify: Center
.head 4 -  Width:  1.2"
.head 4 -  Width Editable? Class Default
.head 4 -  Format: Date
.head 4 -  Country: Class Default
.head 4 -  Input Mask: Class Default
.head 4 -  Cell Options
.head 5 -  Cell Type? Class Default
.head 5 -  Multiline Cell? Class Default
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Class Default
.head 6 -  Vertical Scroll? Class Default
.head 6 -  Auto Drop Down? Class Default
.head 6 -  Allow Text Editing? Class Default
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Class Default
.head 4 -  List Values
.head 4 -  Message Actions
.head 2 +  Functions
.head 3 +  Function: Import
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sInFullName
.head 5 -  String: sInDocId
.head 5 -  Receive Number: nInFlag
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nDummy
.head 4 +  Actions
.head 5 -  ! Выясним наличие такого шаблона
.head 5 +  If not SqlPrepareAndExecute(hSql(), "SELECT 1 INTO :nDummy FROM doc_scheme WHERE id = :sInDocId")
.head 6 -  Return FALSE
.head 5 +  If SqlFetchNext(hSql(), nFetchRes)
.head 6 -  Call SqlClose(hSql())
.head 6 -  Set nInFlag = 0
.head 5 +  Else
.head 6 -  Call SqlClose(hSql())
.head 6 -  Set nInFlag = 1
.head 5 +  If not PutFileToClob(hSql(), sInFullName, 'DOC_SCHEME', 'ID', 'TEMPLATE',
   NUMBER_Null, sInDocId, STRING_Null, nInFlag)
.head 6 -  Return FALSE
.head 5 -  Return TRUE
.head 2 +  Window Parameters
.head 3 -  String: sFilter
.head 2 +  Window Variables
.head 3 -  Number: i
.head 3 -  Long String: strRTF_Text
.head 3 -  String: strAttrID
.head 3 -  String: strAttrName
.head 3 -  File Handle: hFile
.head 3 -  String: sFileName
.head 3 -  String: sInsert
.head 3 -  String: sUpdate
.head 3 -  !
.head 3 -  String: strFilters[6]
.head 3 -  String: strFilters_htm[6]
.head 3 -  Number: nIndex
.head 3 -  Number: nNextRow
.head 3 -  String: strFile
.head 3 -  String: sFullName
.head 3 -  !
.head 3 -  Boolean: bDptBlnk
.head 3 -  Boolean: hasSelectedRows
.head 3 -  Number: nFetchRes
.head 3 -  !
.head 3 -  String: sDocId
.head 3 -  Boolean: bOne
.head 3 -  String: sPath
.head 3 -  Number: nFiles
.head 3 -  String: smFile[*]
.head 3 -  Number: nAddFlag
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  Call SalSetWindowText(hWndForm, CurrentLangTable.GetAtomTitle('cdoc_List.cTWndTitle'))
.head 4 -  !
.head 4 -  Set bDptBlnk = GetGlobalOptionEx('DPT_BLNK') = 1
.head 4 +  If bDptBlnk
.head 5 -  Call SalShowWindow(colPrintOnBlank)
.head 5 -  Call SalEnableWindow(colPrintOnBlank)
.head 5 -  Call SalSetWindowSize(hWndForm, 12.7, 6.4)
.head 4 +  Else
.head 5 -  Call SalSetWindowSize(hWndForm, 11.5, 6)
.head 4 -  Call PrepareWindow(hWndForm)
.head 4 -  !
.head 4 -  Set cdoc_List.strPrintFileName = 'CC_DOC'
.head 4 -  Set cdoc_List.strFilterTblName = 'DOC_SCHEME'
.head 4 -  Set cdoc_List.strSqlPopulate =
"SELECT id, name, d_close " || IifS(bDptBlnk=TRUE, ", print_on_blank", "") || "
   INTO :cdoc_List.ID, :cdoc_List.NAME, :cdoc_List.DCLOSE " || IifS(bDptBlnk=TRUE, ", :cdoc_List.colPrintOnBlank", "") || "
   FROM doc_scheme " || IifS(sFilter!=STRING_Null, "WHERE " || sFilter, "" ) || "
  ORDER BY id "
.head 4 -  !
.head 4 -  Set cdoc_List.strSqlDelete = "DELETE FROM doc_scheme WHERE id=:cdoc_List.ID"
.head 4 -  !
.head 4 -  Call SalSendClassMessage(SAM_Create, 0, 0)
.head 4 -  !
.head 4 -  Set sInsert = 
"INSERT INTO doc_scheme (id, name, template, d_close" || IifS(bDptBlnk=TRUE, ", print_on_blank", "") || ") 
 VALUES (:cdoc_List.ID, :cdoc_List.NAME,empty_clob(), :cdoc_List.DCLOSE" || 
        IifS(bDptBlnk=TRUE, ", nvl(:cdoc_List.colPrintOnBlank,0)", "") || ")"
.head 4 -  Set sUpdate = 
"UPDATE doc_scheme 
    SET name = :cdoc_List.NAME, 
        d_close = :cdoc_List.DCLOSE " || 
        IifS(bDptBlnk=TRUE, ", print_on_blank = nvl(:cdoc_List.colPrintOnBlank,0)", "") || "
  WHERE id=:cdoc_List.ID"
.head 4 -  ! Файлы
.head 4 -  Set strFilters[0] = CurrentLangTable.GetAtomTitle('cdoc_List.cTFiles') || ' *.html'
.head 4 -  Set strFilters[1] = '*.html'
.head 4 -  Set strFilters[2] = CurrentLangTable.GetAtomTitle('cdoc_List.cTFiles') || ' *.htm'
.head 4 -  Set strFilters[3] = '*.htm'
.head 4 -  Set strFilters[4] = CurrentLangTable.GetAtomTitle('cdoc_List.cTFiles') || ' *.mht'
.head 4 -  Set strFilters[5] = '*.mht'
.head 4 -  Set sFullName     = ''
.head 4 -  Set strFilters_htm[0] = CurrentLangTable.GetAtomTitle('cdoc_List.cTFiles') || ' *.htm'
.head 4 -  Set strFilters_htm[1] = '*.htm'
.head 4 -  Set strFilters_htm[2] = CurrentLangTable.GetAtomTitle('cdoc_List.cTFiles') || ' *.html'
.head 4 -  Set strFilters_htm[3] = '*.html'
.head 4 -  Set strFilters_htm[4] = CurrentLangTable.GetAtomTitle('cdoc_List.cTFiles') || ' *.mht'
.head 4 -  Set strFilters_htm[5] = '*.mht'
.head 3 +  On UM_Populate
.head 4 -  Call SalDisableWindow( cdoc_List.ID )
.head 4 -  Call SalSendClassMessage( UM_Populate, 0, 0 )
.head 3 +  On UM_Update
.head 4 -  Set nRow = TBL_MinRow
.head 4 +  While SalTblFindNextRow(hWndForm, nRow, ROW_New | ROW_Edited, 0)
.head 5 -  Call SalTblSetContext(hWndForm, nRow)
.head 5 +  If SalTblQueryRowFlags(hWndForm, nRow, ROW_New)
.head 6 -  Call SqlPrepareAndExecute(hSql(), sInsert)
.head 5 +  Else If SalTblQueryRowFlags(hWndForm, nRow, ROW_Edited)
.head 6 -  Call SqlPrepareAndExecute(hSql(), sUpdate)
.head 5 +  If TEMPLATE
.head 6 -  Call PutStringToClob(hSql(), TEMPLATE, 'doc_scheme', 'id', 'template', NUMBER_Null, ID, '', 0)
.head 4 -  Call SalSendClassMessage(UM_Update, 0, 0)
