/*
    AUTOGENERATED! Do not modify this code.
*/

using System;
using System.Collections;
using System.Collections.Generic;
using System.Text;
using System.Collections.Specialized;
using System.Data;
using System.Web.Configuration;
using Oracle.DataAccess.Client;
using Oracle.DataAccess.Types;
using ibank.core;
using Bars.Classes;
using System.Web.UI.WebControls;

namespace Bars.Ins
{
    public class FilterParam
    {
        # region Приватные свойства
        private String _ID;
        private String _UrlID;
        private DbType _Type;
        # endregion

        # region Публичные свойства
        public String ID
        {
            get { return _ID; }
        }
        public String UrlID
        {
            get { return _UrlID; }
        }
        public DbType Type
        {
            get { return _Type; }
        }
        # endregion

        # region Конструктор
        public FilterParam(String ParamStmt)
        {
            _ID = ParamStmt.Split(':')[0].ToUpper();
            _UrlID = ParamStmt.Split(':')[1].ToUpper();

            switch (ParamStmt.Split(':')[2].ToUpper())
            {
                case "S":
                    _Type = DbType.String;
                    break;
                case "N":
                    _Type = DbType.Decimal;
                    break;
                case "D":
                    _Type = DbType.DateTime;
                    break;
            }
        }
        # endregion
    }

    public class Filter
    {
        # region Приватные свойства
        private String _ID;
        private String _Name;
        private String _Stmt;
        private List<FilterParam> _Params;
        private List<String> _Cols2Hide;
        # endregion

        # region Публичные свойства
        public String ID
        {
            get { return _ID; }
        }
        public String Name
        {
            get { return _Name; }
        }
        public String Stmt
        {
            get { return _Stmt; }
        }
        public List<FilterParam> Params
        {
            get { return _Params; }
        }
        public List<String> Cols2Hide
        {
            get { return _Cols2Hide; }
        }
        # endregion

        # region Конструктор
        public Filter(String ID)
        {
            InsFiltersRecord rec = (new InsFilters()).SelectFilter(ID);
            _ID = ID;
            _Name = rec.NAME;
            _Stmt = rec.STMT;

            _Params = new List<FilterParam>();
            if (!String.IsNullOrEmpty(rec.PARAMS))
            {
                foreach (String ParamStmt in rec.PARAMS.Split(';'))
                    _Params.Add(new FilterParam(ParamStmt));
            }

            _Cols2Hide = new List<String>();
            if (!String.IsNullOrEmpty(rec.COLS2HIDE))
            {
                foreach (String Col2Hide in rec.COLS2HIDE.Split(';'))
                    _Cols2Hide.Add(Col2Hide);
            }
        }
        # endregion

        # region Публичные свойства
        public void HideCol(GridView gv, String ColName)
        {
            foreach (DataControlField dcf in gv.Columns)
            {
                if (!String.IsNullOrEmpty(dcf.SortExpression) && dcf.SortExpression.ToUpper() == ColName.ToUpper())
                {
                    dcf.Visible = false;
                    break;
                }
            }
        }
        # endregion
    }

    public partial class InsFilters
    {
        public InsFiltersRecord SelectFilter(String ID)
        {
            this.Filter.ID.Equal(ID);

            List<InsFiltersRecord> tmp = this.Select();

            if (tmp.Count == 0)
                throw new Bars.Exception.BarsException(String.Format("Не знайдено фільтр ({0})", ID));

            return tmp[0];
        }
    }
}