.head 0 +  Application Description: Разнообразные печатные отчеты комплекса.
(С) УНИТИ-БАРС, 1997-2001
.head 1 -  Outline Version - 4.0.26
.head 1 +  Design-time Settings
.data VIEWINFO
0000: 6F00000001000000 FFFF01000D004347 5458566965775374 6174650400010000
0020: 0000000000A50000 002C000000030000 0003000000730000 000C010000FCFFFF
0040: FFE9FFFFFFD7FFFF FFF8FFFFFFBE0200 00BA010000010000 0000000000010000
0060: 000F4170706C6963 6174696F6E497465 6D02000000075769 6E646F77730A6672
0080: 6D5F4C6963416363
.enddata
.data DT_MAKERUNDLG
0000: 0200000000001C51 3A5C424152533938 5C4C494252415259 5C4162736170692E
0020: 646C6C1C513A5C42 41525339385C4C49 42524152595C4162 736170692E617063
0040: 00000101011C513A 5C4241525339385C 4C4942524152595C 4162736170692E72
0060: 756E1C513A5C4241 525339385C4C4942 524152595C416273 6170692E646C6C1C
0080: 513A5C4241525339 385C4C4942524152 595C416273617069 2E61706300000101
00A0: 011D513A5C424152 5339385C42494E2E 47454F5C72657062 616E6B2E6170641C
00C0: 513A5C4241525339 385C42494E2E4745 4F5C416273617069 2E646C6C1C513A5C
00E0: 4241525339385C42 494E2E47454F5C41 62736170692E6170 630000010101001C
0100: 513A5C4241525339 385C4C4942524152 595C416273617069 2E646C6C1C513A5C
0120: 4241525339385C4C 4942524152595C41 62736170692E6170 630000010101
.enddata
.head 2 -  Outline Window State: Normal
.head 2 +  Outline Window Location and Size
.data VIEWINFO
0000: 6600040003002D00 0000000000000000 0000B71E5D0E0500 1D00FFFF4D61696E
0020: 0000000000000000 0000000000000000 0000003B00010000 00000000000000E9
0040: 1E800A00008600FF FF496E7465726E61 6C2046756E637469 6F6E730000000000
0060: 0000000000000000 0000000000003200 0100000000000000 0000E91E800A0000
0080: DF00FFFF56617269 61626C6573000000 0000000000000000 0000000000000000
00A0: 3000010000000000 00000000F51E100D 0000F400FFFF436C 6173736573000000
00C0: 0000000000000000 0000000000000000
.enddata
.data VIEWSIZE
0000: D000
.enddata
.head 3 -  Left:   -0.013"
.head 3 -  Top:    0.0"
.head 3 -  Width:  8.013"
.head 3 -  Height: 4.969"
.head 2 +  Options Box Location
.data VIEWINFO
0000: 0518B80BB80B2500
.enddata
.data VIEWSIZE
0000: 0800
.enddata
.head 3 -  Visible? Yes
.head 3 -  Left:   4.15"
.head 3 -  Top:    1.885"
.head 3 -  Width:  3.8"
.head 3 -  Height: 2.073"
.head 2 +  Class Editor Location
.head 3 -  Visible? No
.head 3 -  Left:   0.575"
.head 3 -  Top:    0.094"
.head 3 -  Width:  5.063"
.head 3 -  Height: 2.719"
.head 2 +  Tool Palette Location
.head 3 -  Visible? No
.head 3 -  Left:   6.388"
.head 3 -  Top:    0.729"
.head 2 -  Fully Qualified External References? Yes
.head 2 -  Reject Multiple Window Instances? No
.head 2 -  Enable Runtime Checks Of External References? Yes
.head 2 -  Use Release 4.0 Scope Rules? No
.head 1 +  Libraries
.head 2 -  Dynalib: Global.apd
.head 2 -  Dynalib: Message.apd
.head 2 -  Dynalib: Absapi.apd
.head 2 -  Dynalib: Dfltrapi.apd
.head 2 -  Dynalib: OTCN.APD
.head 2 -  File Include: Constant.apl
.head 2 -  File Include: Genbutn.apl
.head 2 -  File Include: Genlabel.apl
.head 2 -  File Include: Winbars2.apl
.head 2 -  File Include: Gentbl.apl
.head 2 -  File Include: vtcal.apl
.head 2 -  File Include: VTDOS.APL
.head 2 -  File Include: VTCOMDLG.APL
.head 2 -  ! File Include: XSALSPL.APL
.head 2 -  File Include: XSALSPL.APL
.head 1 +  Global Declarations
.head 2 +  Window Defaults
.head 3 +  Tool Bar
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Form Window
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Dialog Box
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Top Level Table Window
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Data Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Multiline Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Spin Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Background Text
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Pushbutton
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Radio Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Check Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Option Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Group Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Child Table Window
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  List Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Combo Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Line
.head 4 -  Line Color: Use Parent
.head 3 +  Frame
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: 3D Face Color
.head 3 +  Picture
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 2 +  Formats
.head 3 -  Number: 0'%'
.head 3 -  Number: #0
.head 3 -  Number: ###000
.head 3 -  Number: ###000;'($'###000')'
.head 3 -  Date/Time: hh:mm:ss AMPM
.head 3 -  Date/Time: hh:mm  dd-MM-yyyy
.head 3 -  Date/Time: dd-MM-yyyy hh:mm
.head 3 -  Date/Time: M/d/yy
.head 3 -  Date/Time: MM-dd-yy
.head 3 -  Date/Time: dd-MMM-yyyy
.head 3 -  Date/Time: MMM d, yyyy
.head 3 -  Date/Time: MMM d, yyyy hh:mm AMPM
.head 3 -  Date/Time: MMMM d, yyyy hh:mm AMPM
.head 3 -  Input: 99/99/99
.head 3 -  Number: ###00000
.head 3 -  Date/Time: dd/MM/yyyy
.head 3 -  Date/Time: dd/MM/yy
.head 3 -  Number: #00
.head 3 -  Number: #000
.head 3 -  Date/Time: dd-MM-yyyy hh:mm
.head 3 -  Date/Time: hh:mm dd-MM-yyyy 
.head 3 -  Date/Time: hh:mm  dd-MM-yyyy
.head 3 -  Date/Time: hh:mm  dd-MM-yyyy AMPM
.head 3 -  Date/Time: hhhh:mm  dd-MM-yyyy 
.head 3 -  Date/Time: hh:mm  dd-MM-yyyy 
.head 2 +  External Functions
.head 2 +  Constants
.data CCDATA
0000: 3000000000000000 0000000000000000 00000000
.enddata
.data CCSIZE
0000: 1400
.enddata
.head 3 +  System
.head 3 +  User
.head 2 +  Resources
.head 2 +  Variables
.data RESOURCE 0 0 1 2867449566
0000: 1E00000010000000 0000000000000000 0200800100000036 0100E00204000000
0020: FF3F
.enddata
.head 3 -  Boolean: fLibInit		! Флаг инициализации библиотеки
.head 3 -  ! ===========================================================
.head 3 -  ! ===========================================================
.head 3 -  ! - - - - - - - Переменные которые стоит сдесь оставить- - - - - - - - - 
.head 3 -  ! ===========================================================
.head 3 -  Number: ID                       !! Код пользователя из staff
.head 3 -  String: IDNAME                   !! Имя пользователя из staff     
.head 3 -  String: app                      !! Код текущего приложения
.head 3 -  String: strRepDate               !! Дата отчета
.head 3 -  String: strBankDate
.head 3 -  String: SHAP                     !! шапка отчета
.head 3 -  String: AMFO                     !! Наше МФО
.head 3 -  String: AQH                      !!  Наименование нашего банка
.head 3 -  String: DRUK                     !! Строка для отчета типа  'Printed : ..... '
.head 3 -  Number: FL_FORMAT                !!  если true - печать в rtf формате 
.head 3 -  Number: bFLS                     !! = TRUE без перекодировки, FALSE - с перекодировкой
.head 3 -  String: strBind                  !! Для Print ReportToFile
.head 3 -  String: strInput                 !! Для Print ReportToFile

.head 3 -  ! - - - - - - - - - -рабочие переменные - счетчики - - - - - - - - - - - - - - -  
.head 3 -  String: rab
.head 3 -  Number: nInd
.head 3 -  Number: nRet
.head 3 -  Number: nRowType
.head 3 -  Number: nFetchRes
.head 3 -  String: strDir   !!!! это имя файла-шаблона - его переименовали в strTmplPath
.head 3 -  !
.head 3 -  Window Handle: hWndLicParent
.head 3 -  ! - - - - - - - - - - - - Поскольку в таблице report в поле param остались переменные - -
! - - - - - - - - - - - - sFdat и sFdat2  -  оставим эти переменные - - - - - - - - - - - - - - - - - -
.head 3 -  String: sFdat          !! Дата отчета с (MM-DD-YYYY)
.head 3 -  String: sFdat2        !! Дата отчета по (MM-DD-YYYY)


.head 3 -  ! ===========================================================
.head 3 -  ! ===========================================================
.head 3 -  ! - - - - - - - Новые переменные - - - - - - - - - - - - 
.head 3 -  ! ===========================================================
.head 3 -  Number: nDay
.head 3 -  Number: nMonth
.head 3 -  Number: nYear
.head 3 -  String: strDateFrom              !! Дата отчета с (DD-MM-YYYY)
.head 3 -  String: strDateTo                  !! Дата отчета по (DD-MM-YYYY)
.head 3 -  String: strMonth[12]              !! Наименов. месяце для календаря
.head 3 -  String: strWeekDays[7]         !! Дни недели для календаря

.head 3 -  String: strFileNameTxt          !! Имя файла отчета для TXT
.head 3 -  String: strFileNameRtf          !! Имя файла отчета для RTF

.head 3 -  String: strTmplPath               !! Путь + имя файла отчета-шаблона (*.qrp) 
.head 3 -  String: strExecForm              !! строка создания формы отчета (для SalCompileAndEvaluate(...) )
.head 3 -  String: strPrintPath               !!  директория куда печатать отчет (=GetPrintDir, а если значение в поле path таблицы report не пустое, тогда это значение)

.head 3 -  String: sDeviceDef                !! Параметры для печати отчета (*.rtf)
.head 3 -  String: sDriverDef                 !!  - -//- -
.head 3 -  String: sPortDef                    !!  - -//- -
.head 3 -  String: sDriverDefo               !!  - -//- -


.head 3 -  String: lstFiles[*]                 !! список выбранных файлов
.head 3 -  Number: nFiles                   !! кол-во выбранных файлов   
.head 3 -  !
.head 3 -  Window Handle: hFrm_Out
.head 3 -  ! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
.head 2 +  Internal Functions
.head 3 +  Function: Reports_Init
.head 4 -  Description: инициализация библиотеки
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: strPathToLangResources
.head 5 -  String: strLangId
.head 5 -  ! !
.head 5 -  String: strFileName
.head 4 +  Actions
.head 5 +  If NOT fLibInit
.head 6 -  ! for construction uncomment below
.head 6 -  ! Set CurrentLangTable.fConstructMode = TRUE
.head 6 -  !
.head 6 -  Set strPathToLangResources = GetLangPath()
.head 6 -  Set strLangId = GetLang()
.head 6 -  Set strFileName = strPathToLangResources || "\\" || strLangId || "\\reports.lng"
.head 6 -  !
.head 6 +  If (NOT strLangId) OR (NOT CurrentLangTable.InitFromFile( strFileName, strLangId ))
.head 7 -  Call CurrentLangTable.Init()
.head 7 -  !
.head 7 -  Call CurrentLangTable.AddAtom('frm_Labels.dfTo',  'По дату')
.head 7 -  Call CurrentLangTable.AddAtom('frm_Labels.dfFrom','C даты')
.head 7 -  Call CurrentLangTable.AddAtom('frm_Labels.aOn','За дату')
.head 6 -  !
.head 6 -  Set fLibInit = TRUE
.head 5 -  Return fLibInit
.head 3 +  Function: ShowOutForms				! __exported
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Window Handle: hW
.head 5 -  Number: nMode
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call Reports_Init()
.head 5 -  !
.head 5 -  ! Call SalModalDialog(dlg_OutForms, hWndForm, nMode)
.head 5 +  If hFrm_Out
.head 6 -  Call SalBringWindowToTop( hFrm_Out )
.head 5 +  Else
.head 6 -  Set hFrm_Out=SalCreateWindow(frm_Out, hW, 0)
.head 3 +  Function: Maska_NLS
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  String: slovo
.head 4 +  Static Variables
.head 5 -  String: mas
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Set mas = '*'
.head 5 -  Call SalModalDialog(dlg_mas, hWndForm, mas, slovo)
.head 5 -  Return mas
.head 3 +  Function: Tmp_Kurs
.head 4 -  Description: построение временной таблицы лнкыщв на заданную
дату
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Receive String: sid
.head 5 -  String: sdat
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: fl
.head 5 -  String: sTmp
.head 5 -  String: sSql
.head 5 -  Number: nTmp
.head 4 +  Actions
.head 5 -  Set sTmp = SalStrTrimX(SalStrUpperX(GetDBMS()))
.head 5 -  Set sid = 't2_' || Str(GetUserId())
.head 5 +  If sTmp = 'ORACLE'
.head 6 -  Set sSql = "
    SELECT table_name
    INTO :sTmp
    FROM user_tables
    WHERE table_name=:sid"
.head 5 +  Else
.head 6 -  Set sSql = "
    SELECT tabname
    INTO :sTmp
    FROM systables
    WHERE tabname=:sid"
.head 5 -  ! Вычитали из системной таблицы имя временной таблицы
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), sSql)
.head 5 -  ! Удалить если есть
.head 5 +  If SqlFetchNext(hSqlAux(), nTmp)
.head 6 -  Call SqlPrepareAndExecute(hSqlAux(), "
     DROP table " || sid)
.head 5 -  ! Создать временную
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), "
     CREATE table " || sid || " (kv int PRIMARY KEY,
                                 kurs decimal(20,10))")
.head 5 -  ! Населить временную
.head 5 +  If sTmp = 'ORACLE'
.head 6 -  Call SqlPrepareAndExecute(hSqlAux(), T("
     INSERT
     INTO " || sid || "(kv,kurs)
     SELECT c.kv,c.rate_o/c.bsum
     FROM cur_rates c
     WHERE (c.kv,c.vdate)=(
     SELECT u.kv,max(u.vdate)
     FROM cur_rates u
     WHERE u.kv=c.kv and u.vdate<= :sdat
     GROUP BY u.kv)"))
.head 5 +  Else
.head 6 -  Call SqlPrepareAndExecute(hSqlAux(), T("
     INSERT
     INTO " || sid || "(kv,kurs)
     SELECT c.kv,c.rate_o/c.bsum
     FROM cur_rates c
     WHERE c.vdate=(
     SELECT max(u.vdate)
     FROM cur_rates u
     WHERE u.kv=c.kv and u.vdate<= :sdat) "))
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), "commit")
.head 5 -  Return fl
.head 3 +  Function: Selector				! __exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Window Handle: hW
.head 5 -  Number: nP
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sOdir
.head 5 -  String: sPath
.head 5 -  String: sFile
.head 5 -  String: sFile1
.head 5 -  File Handle: hFile
.head 5 -  File Handle: hSqlA
.head 5 -  Boolean: bFL
.head 5 -  Boolean: bU
.head 5 -  String: sMFO
.head 5 -  String: sSAB
.head 5 -  String: sNB
.head 5 -  String: sMFOU
.head 5 -  Number: nTmp
.head 5 -  Number: nMFO
.head 5 -  Number: nMFOU
.head 5 -  Number: nNull
.head 4 +  Actions
.head 5 +  If nP = 0
.head 6 -  ! Определение ESC-последовательностей для печатных отчетов
.head 6 -  Call SalCreateWindow(tbl_idprn, hW)
.head 5 +  Else If nP = 1
.head 6 -  Call SalWaitCursor(TRUE)
.head 6 -  ! запомнить текущий каталог в sOdir
.head 6 -  Call SalFileGetCurrentDirectory(sOdir)
.head 6 -  ! Вычитать из .ini имя каталога для формирования файла
  Syymmdd.dbf в sPath
.head 6 -  Call SalUseRegistry(FALSE, '')
.head 6 -  Call SalGetProfileString('ElektroKlients',
     'S_UchPath', GetPrnDir(), sPath,
     GetIniFileName())
.head 6 -  ! Создать (если нет) и сделать текущим каталог sPath
.head 6 -  Call SalFileCreateDirectory(sPath)
.head 6 -  Call SalFileSetCurrentDirectory(sPath)
.head 6 -  ! Краткое имя файла sFile и полное sFile1
.head 6 -  Set sFile = 'S_Uch'
.head 6 -  Set sFile1 = sPath || IifS(Right(sPath,1)!='\\', '\\',
    '') || sFile || '.dbf'
.head 6 -  ! Удаление sFile1 (если есть)
.head 6 +  If File(sFile1)
.head 7 -  Call SalFileOpen(hFile, sFile1, OF_Delete)
.head 6 -  ! Работа с БД через ODBC
.head 6 -  Set SqlDatabase = 'dBase_Files'
.head 6 +  If SqlConnect(hSqlA)
.head 7 -  Set bFL = SqlPrepareAndExecute(hSqlA, "
    CREATE
    TABLE " || sFile || " (MFO   NUMBER(6,0),
                           NCKS  CHAR(4),
                           NCKSO CHAR(4),
                           NB    CHAR(38),
                           KORSH NUMBER(14,0),
                           N_MO  CHAR(1),
                           U_MO  CHAR(1),
                           MFO_G NUMBER(6),
                           M_UR  NUMBER(6),
                           F_BL  CHAR(1),
                           F_VA  CHAR(1),
                           F_SL  CHAR(1),
                           S_SS  CHAR(10))")
and SqlPrepareAndExecute(hSql(), "
    SELECT mfo,sab,nb,mfou
    INTO :sMFO,:sSAB,:sNB,:sMFOU
    FROM banks
    WHERE blk<>4")
.head 7 +  If bFL
.head 8 -  Set bU = TRUE
.head 8 -  Set nNull = NUMBER_Null
.head 8 +  While SqlFetchNext(hSql(), nTmp)
.head 9 -  Set nMFO = Val(sMFO)
.head 9 -  Set sNB = StrWinToDosX(sNB)
.head 9 -  Set nMFOU = Val(sMFOU)
.head 9 -  Set bFL = SqlPrepareAndExecute(hSqlA, "
    INSERT
    INTO " || sFile || "
    VALUES (:nMFO,:sSAB,'',:sNB,:nNull,'','',
            :nNull,:nMFOU,'','','','')")
.head 9 +  If bU
.head 10 -  Set bU = bFL
.head 8 +  If bU
.head 9 -  Call SqlCommit(hSqlA)
.head 9 -  Call MessageNoWait('Создание ' || sFile1 ||
     ' успешно завершено !', 'Сообщение', 17, 0)
.head 8 +  Else
.head 9 -  Call SqlRollback(hSqlA)
.head 7 -  Call SqlDisconnect(hSqlA)
.head 6 -  ! Восстановление первичного текущего каталога
.head 6 -  Call SalFileSetCurrentDirectory(sOdir)
.head 6 -  Call SalWaitCursor(FALSE)
.head 6 -  Return bU
.head 3 +  Function: CurBalanceReval
.head 4 -  Description: Переоценка остатков в инвалюте 02-08-2001 (MIK)
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: aKv[*]
.head 5 -  String: sKv[*]
.head 5 -  String: sLcv
.head 5 -  String: sErrTxt
.head 5 -  Number: i
.head 5 -  Number: nCount
.head 5 -  Number: nKv
.head 5 -  Number: nKvBas
.head 5 -  Date/Time: dDat
.head 4 +  Actions
.head 5 -  Set nKvBas=GetBaseVal()
.head 5 -  Set dDat = GetBankDate()
.head 5 -  ! Set sErrTxt='Переоцінка залишків в інвалюті'
.head 5 +  If SqlPrepareAndExecute(hSql(), T("
   SELECT kv,lcv FROM tabval INTO :nKv,:sLcv WHERE kv<>:nKvBas ORDER BY kv"))
.head 6 -  Set i=0
.head 6 +  While SqlFetchNext(hSql(), nFetchRes)
.head 7 -  Set aKv[i] = nKv
.head 7 -  Set sKv[i] = sLcv
.head 7 -  Set i = i + 1
.head 6 +  If i > 0
.head 7 -  Set nCount = 0
.head 7 -  ! Call SalCreateWindow(win_meter, hWndForm, sErrTxt, i)
.head 7 +  While nCount < i
.head 8 -  Set nKv = aKv[nCount]
.head 8 -  ! Call SalStatusSetText( hWndForm, 'Валюта '||sKv[nCount] )
.head 8 +  If SalStrTrimX(SalStrUpperX(GetDBMS())) = 'ORACLE'
.head 9 -  Call SalWaitCursor( TRUE )
.head 9 +  If SqlPLSQLCommand(hSql(), "p_rev(nKv,dDat)")
.head 10 -  Call SqlCommitEx(hSql(), sErrTxt||' по '|| SalNumberToStrX( nKv, 0 ) )
.head 10 -  Call SaveInfoToLog(sErrTxt||' по '|| SalNumberToStrX( nKv, 0 ) || ' - успешно.')
.head 9 +  Else
.head 10 -  Call SqlRollback(hSql())
.head 10 -  Call SaveInfoToLog(sErrTxt||' по '|| SalNumberToStrX( nKv, 0 ) || ' - ошибка.')
.head 9 -  Call SalWaitCursor( FALSE )
.head 8 +  Else
.head 9 -  Call MessageWarning('Для INFORMIX пока не реализовано')
.head 9 -  Return TRUE
.head 8 -  Set nCount = nCount + 1
.head 8 -  ! Call SalSendMsg(win_meter, AM_MtrMove, 0, nCount)
.head 7 -  ! Call SalStatusSetText( hWndForm, 'Готово' )
.head 7 -  ! Call SalDestroyWindow(win_meter)
.head 7 -  Return TRUE
.head 5 -  Call MessageError('Не описаны инвалюты')
.head 5 -  Return FALSE
.head 3 +  Function: NumberToStrFormat    
.head 4 -  Description: !! Превращает число в строку заданной длины (nLen) - дополняя впереди нулями
.head 4 +  Returns
.head 5 -  String: strVal
.head 4 +  Parameters
.head 5 -  Number: nVal
.head 5 -  Number: nLen
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: i
.head 5 -  String: strVal
.head 4 +  Actions
.head 5 -  Set i=10
.head 5 -  Set strVal = SalNumberToStrX(nVal,0)
.head 5 +  Loop
.head 6 +  If i  > SalNumberPower (10 , nLen - 1) 
.head 7 -  Return strVal
.head 7 -  Break
.head 6 +  If nVal < i 
.head 7 -  Set strVal =  '0' || strVal
.head 6 -  Set i = i * 10
.head 3 +  Function: DoReportToFile
.head 4 -  Description: !! Поскольку практически в каждой форме для печати отчета повторяется одно 
           и то же, и все параметры являются глобальными -> эта процедура вынесена, как глобальная
.head 4 +  Returns
.head 5 -  Number: nVal
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  ! ! ! ==================================================
.head 5 -  ! ! ! Начинаем печать в отчет
.head 5 -  ! ! ! ==================================================
.head 5 -  Set strInput = strBind
.head 5 -  Call SalReportPrintToFile(hWndForm,
                                                    strTmplPath,
                                                    strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                                    strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 5 +  If (nInd > 4 )
.head 6 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 5 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 5 -  Set frm_Out.dfPath = strPrintPath
.head 5 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 5 -  Return nInd

.head 3 +  Function: GetDigitForChar   		                          ! __exported
.head 4 -  Description: Возвращает строку  соответствующее букве СЭП  от 0 до Z в string формате
.head 4 +  Returns
.head 5 -  String: strRes
.head 4 +  Parameters
.head 5 -  String: strValIn
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nCharacter
.head 5 -  String: strValOut
.head 4 +  Actions
.head 5 -  ! /////////////////////////////////////////////////////////////////////////////////////////////////////////////
.head 5 -  !
.head 5 -  Set nCharacter = SalStrLop ( strValIn )
.head 5 +  If (nCharacter > 48 AND nCharacter <58) OR ( nCharacter > 64 AND nCharacter <91 )
.head 6 +  If (nCharacter > 48 AND nCharacter <58)
.head 7 -  Set strValOut= NumberToStrFormat  ( nCharacter - 48 ,2) 
.head 6 +  Else
.head 7 -  Set strValOut = NumberToStrFormat  (nCharacter - 55,2) 
.head 5 +  Else
.head 6 -  Set strValOut = '?'
.head 5 -  Return strValOut
.head 5 -  !
.head 5 -  ! /////////////////////////////////////////////////////////////////////////////////////////////////////////////
.head 3 +  Function: DirectViewGEO			
.head 4 -  Description: Функция просмотра документов (вынесена из absapi.apd для GEO)
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: strFName
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: fRet
.head 4 +  Actions
.head 5 -  !
.head 5 -  Set fRet = SalLoadApp('DVIEW.EXE', SalStrUpperX(strFName))
.head 5 -  !
.head 5 -  Return fRet
.head 2 +  Named Menus
.head 2 +  Class Definitions
.data RESOURCE 0 0 1 3936443814
0000: 56040000E0010000 0000000000000000 0200000600FFFF01 00160000436C6173
0020: 73566172004F7574 6C696E6552006567 496E666F8F003C00 000F63004465736B
0040: 746F704C00697374 426F782201C00000 0B00000083010D00 0000FFFFE40D0000
0060: 01FE00FF831A0000 0001FB00FF0F2700 0000EE0100FF3F34 00B800000100FFFF
0080: E04100000001FE00 FF834E00000001FB 00FF0F5B000000EE 0100FF3F6800B800
00A0: 000100FFFFE07500 000001FE00FF8382 00000001FB00FF0F 0180340011000100
00C0: 000B63E04469724C 69036C0000000400 3C0000010DFB00FF 6F0D00EE0100FFBF
00E0: 1AB9000100FFFFE6 270001FE00FF4301 80270000E0020000 000F81547265654C
0100: 690F52000000F003 000000EC010D00FF BF0DB9000100FFFF E61A0001FE00FF43
0120: 01805B0000060300 0C634669F86C654C 01BA000000070000 9E00010DFD00FF37
0140: 0D0001F700FFDF1A DC000100FF7F2773 000100FFFFCD3400 01FD00FF37410001
0160: F700FFDF4EDC0001 00FF7F01C0802200 00000400000A6347 656E466901746572
0180: 74000000F6040088 020400000100FE00 C18001000000BF04 B100010D00FFFFE0
01A0: 1100000002FE00FF 831500000001FB00 FF0F018041000100 050000000D638052
01C0: 6164696F4C690F86 000000F60500EC01 0D00FF3F0D00B900 0100FFFFE61A0001
01E0: FE00FF9B270001FB 00FF6F3400EE0100 FF3F
.enddata
.head 2 +  Default Classes
.head 3 -  MDI Window: cBaseMDI
.head 3 -  Form Window:
.head 3 -  Dialog Box:
.head 3 -  Table Window:
.head 3 -  Quest Window:
.head 3 -  Data Field:
.head 3 -  Spin Field:
.head 3 -  Multiline Field:
.head 3 -  Pushbutton: ctb_pbOk
.head 3 -  Radio Button:
.head 3 -  Option Button:
.head 3 -  Check Box:
.head 3 -  Child Table:
.head 3 -  Quest Child Window: cQuickDatabase
.head 3 -  List Box:
.head 3 -  Combo Box:
.head 3 -  Picture:
.head 3 -  Vertical Scroll Bar:
.head 3 -  Horizontal Scroll Bar:
.head 3 -  Column:
.head 3 -  Background Text:
.head 3 -  Group Box:
.head 3 -  Line:
.head 3 -  Frame:
.head 3 -  Custom Control: cXSalVSplitterInvisible
.head 2 +  Application Actions
.head 3 +  On SAM_AppStartup
.head 4 -  ! Set AMFO=GetBankMfo()
.head 4 -  ! Set AQH=GetBankName()
.head 4 -  ! Set AQH=StrWinToDosX(AQH)
.head 1 +  Form Window: frm_Out
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Печатные отчеты
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? Yes
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  13.533"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 6.365"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: None
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: 0.458"
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Contents
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbOk
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   2.5"
.head 6 -  Top:    0.083"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: \BARS98\RESOURCE\BMP\DISCARD.BMP
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 -  Call SalDestroyWindow(hWndForm)
.head 6 +  On SAM_Create
.head 7 -  Set strTip = 'Выход'
.head 4 +  Pushbutton: pbView
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbOk
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   0.1"
.head 6 -  Top:    0.083"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: Q:\BARS98\RESOURCE\BMP\DOCVIEW.BMP
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 -  Set strPrintPath=dfPath
.head 7 -  Set i = 0
.head 7 +  ! Loop
.head 8 +          If i > SalListQueryCount ( lbFileList )
.head 9 -          Break 
.head 8 +          If SalListQueryState ( lbFileList,   i )
.head 9 +          If (SalStrScan( SalListQueryTextX ( lbFileList ,  i ) ,  '.rtf' )!= -1)         !!== RTF format
.head 10 +          If (   SalLoadApp(GetEditorPath(), strPrintPath||'\\'||SalListQueryTextX (lbFileList,  i )  )   = FALSE     )
.head 11 -          Call SalMessageBox('Не удалось загрузить приложение SalLoadApp : GetEditorPath()','Внимание',0)
.head 11 -          Break 
.head 9 +          Else !!== TXT format
.head 10 -          Call DirectView(strPrintPath|| '\\' || SalListQueryTextX (lbFileList, i)  )
.head 9 -          Break 
.head 8 -          Set i = i + 1


.head 7 +  If (SalStrScan( tblLstFiles.colFileName ,  '.rtf' )!= -1)         !!== RTF format
.head 8 +  If (   SalLoadApp(GetEditorPath(), strPrintPath||'\\'||tblLstFiles.colFileName  )   = FALSE     )
.head 9 -  Call SalMessageBox('Не удалось загрузить приложение SalLoadApp : GetEditorPath()','Внимание',0)
.head 7 +  Else !!== TXT format
.head 8 -  Call DirectViewGEO(strPrintPath|| '\\' || tblLstFiles.colFileName  )
.head 6 +  On SAM_Create
.head 7 -  Set strTip='Просмотреть выбранный файл'
.head 4 +  Pushbutton: pbPrint
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbPrint
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   1.8"
.head 6 -  Top:    0.083"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Create
.head 7 -  Set strTip =  'Напечатать выбранный файл'
.head 6 +  On SAM_Click
.head 7 -  Set strPrintPath=dfPath
.head 7 -  ! ! - - - -  Заново установим нормальный принтер
.head 7 -  Call SalPrtSetDefault(sDeviceDef, sDriverDef, sPortDef)
.head 7 -  Set i  = TBL_MinRow
.head 7 +  While SalTblFindNextRow( tblLstFiles, i, ROW_Selected, 0)
.head 8 -  Call SalTblSetContext( tblLstFiles, i )
.head 8 +  If (SalStrScan( tblLstFiles.colFileName ,  '.rtf' )!= -1)         !!== RTF format
.head 9 +  If (   SalLoadApp(GetEditorPath(), strPrintPath||'\\'||tblLstFiles.colFileName  )   = FALSE     )
.head 10 -  Call SalMessageBox('Не удалось загрузить приложение SalLoadApp : GetEditorPath()','Внимание',0)
.head 8 +  Else !!== TXT format
.head 9 -  Call DosDirectPrint(strPrintPath || '\\' || tblLstFiles.colFileName )
.head 8 -  Call SalTblSetRowFlags( tblLstFiles, i ,ROW_Selected, FALSE)
.head 8 -  Set i = i + 1
.head 4 +  Pushbutton: pbWord
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbOk
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   0.8"
.head 6 -  Top:    0.083"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: Q:\BARS98\RESOURCE\BMP\WORD.BMP
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 -  Set FL_FORMAT = TRUE
.head 7 -  ! -- wPram=5 для того чтоб знать что сообщение пришло от кнопки
.head 7 -  Call SalSendMsg(tblReps, SAM_DoubleClick, 5, 0)
.head 6 +  On SAM_Create
.head 7 -  Set strTip= 'Сделать отчет в формате RTF'
.head 4 +  Pushbutton: pbTxt
.head 5 -  Class Child Ref Key: 0
.head 5 -  Class ChildKey: 0
.head 5 -  Class: ctb_pbOk
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   1.3"
.head 6 -  Top:    0.083"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name: Q:\BARS98\RESOURCE\BMP\DETAILS.BMP
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 +  Message Actions
.head 6 +  On SAM_Click
.head 7 -  Set FL_FORMAT = FALSE
.head 7 -  ! -- wPram=5 для того чтоб знать что сообщение пришло от кнопки
.head 7 -  Call SalSendMsg(tblReps, SAM_DoubleClick, 5, 0)
.head 6 +  On SAM_Create
.head 7 -  Set strTip= 'Сделать текстовый отчет'
.head 2 +  Contents
.head 3 +  Child Table: tblReps
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.086"
.head 6 -  Top:    0.156"
.head 6 -  Width:  4.3"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 3.583"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 5000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: Kod
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.586"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NAME
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наименование отчета
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  10.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: FORM
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: rep
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: param
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NDAT
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: maska
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: repw
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наименование отчета
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  10.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  ! Function: NumberToStrFormat    
.head 6 -            Description: !! Превращает число в строку заданной длины (nLen) - дополняя впереди нулями
.head 6 -            Returns 
.head 6 +            Parameters 
.head 7 -            Number: nVal
.head 7 -            Number: nLen
.head 6 -            Static Variables 
.head 6 +            Local variables 
.head 7 -            Number: i
.head 7 -            String: strVal
.head 6 +            Actions 
.head 7 -            Set i=10
.head 7 -            Set strVal = SalNumberToStrX(nVal,0)
.head 7 +            Loop 
.head 8 +            If i > nLen *  10
.head 9 -            Break 
.head 8 +            If nVal < i 
.head 9 -            Set strVal =  '0' || strVal
.head 8 -            Set i = i * 10
.head 4 +  Window Variables
.head 5 -  Number: i
.head 5 -  Number: nError                    !! Для возврата ошибок при вызове SalCompileAndEvaluate
.head 5 -  Number: nErrorPos              !!  - -//- -  
.head 5 -  Number: nRet                      !!  - -//- -  
.head 5 -  String: strRet                       !!  - -//- - 
.head 5 -  Date/Time: dtRet                 !!  - -//- -
.head 5 -  Window Handle: hWndRet   !!  - -//- -
.head 5 -  String: ShortFileName            !!  если есть маска для файла  типа  dd*сс*ДД?ww - превратим ее в ddссДДww
.head 5 -  Sql Handle: hS
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 6 -  Call SalPrtGetDefault(sDeviceDef, sDriverDef, sPortDef)
.head 6 -  Call SalTblSetTableFlags(hWndForm, TBL_Flag_SelectableCols|TBL_Flag_SingleSelection, TRUE)
.head 6 -  Call SalSendMsg(tblReps, SAM_User, 0,0)
.head 6 -  Call SalSetFocus(tblReps)
.head 5 +  On SAM_User
.head 6 -  Set strRet =''
.head 6 +  If EnhancedSecurity()
.head 7 -  Set strRet =' AND NVL(a.approve,0)=1 AND  date_is_valid(a.adate1,a.adate2,a.rdate1,a.rdate2)=1  '
.head 6 -  Call SalTblPopulate(tblReps, hSql(), T("
                         SELECT r.id,r.description,r.form,r.name,r.param, 
                                           r.ndat, r.mask,  r.namew
                          INTO  :tblReps.Kod, :tblReps.NAME, :tblReps.FORM, :tblReps.rep, :tblReps.param, 
                                       :tblReps.NDAT, :tblReps.maska, :tblReps.repw 
                          FROM reports r, app_rep a
                          WHERE a.codeapp=:app and r.id=a.coderep and   form<>'frm_DKU'" || strRet ||                                
                          " ORDER BY 1,2"), TBL_FillAll)  
.head 6 -  Set nOrderBy=ASC
.head 6 -  Call SalTblSetContext( hWndItem, 0 )
.head 6 -  Call SalTblSetRowFlags( hWndItem, 0, ROW_Selected, TRUE )
.head 6 +  If tblReps.NDAT = 0
.head 7 -  Call SalHideWindow(cCalendarFrom)
.head 7 -  Call SalHideWindow(cCalendarTo)
.head 7 -  Call SalHideWindow(frm_Lables.dfTo)
.head 7 -  Call SalHideWindow(frm_Lables.dfFrom)
.head 6 +  If tblReps.NDAT = 1
.head 7 -  Call SalHideWindow(cCalendarTo)
.head 7 -  Call SalShowWindow(cCalendarFrom)
.head 7 -  Set frm_Lables.dfFrom = CurrentLangTable.GetAtomTitle('frm_Lables.aOn')
.head 7 -  Call SalShowWindow(frm_Lables.dfFrom)
.head 7 -  Call SalHideWindow(frm_Lables.dfTo)
.head 7 -  Call SalSetFocus(frm_Lables.dfFrom)
.head 6 +  If tblReps.NDAT = 2
.head 7 -  Call SalShowWindow(cCalendarFrom)
.head 7 -  Call SalShowWindow(cCalendarTo)
.head 7 -  Set frm_Lables.dfFrom = CurrentLangTable.GetAtomTitle( 'frm_Lables.dfFrom' )
.head 7 -  Call SalShowWindow( frm_Lables.dfTo)
.head 7 -  Call SalSetFocus( frm_Lables.dfFrom)
.head 5 +  On SAM_TblDoDetails
.head 6 +  If (tblReps.rep  = STRING_Null )
.head 7 -  Call SalDisableWindow(pbTxt)
.head 6 +  Else
.head 7 -  Call SalEnableWindow(pbTxt)
.head 6 +  If (tblReps.repw  = STRING_Null )
.head 7 -  Call SalDisableWindow(pbWord)
.head 6 +  Else
.head 7 -  Call SalEnableWindow(pbWord)
.head 6 -  ! ! =========================================================================
.head 6 -  ! ! == По параметру NDAT - будем определять показывать ли календари
.head 6 -  ! ! =========================================================================
.head 6 +  If tblReps.NDAT = 0
.head 7 -  Call SalHideWindow(cCalendarFrom)
.head 7 -  Call SalHideWindow(cCalendarTo)
.head 7 -  Call SalHideWindow(frm_Lables.dfTo)
.head 7 -  Call SalHideWindow(frm_Lables.dfFrom)
.head 6 +  If tblReps.NDAT = 1
.head 7 -  Call SalHideWindow(cCalendarTo)
.head 7 -  Call SalShowWindow(cCalendarFrom)
.head 7 -  Set frm_Lables.dfFrom = CurrentLangTable.GetAtomTitle('frm_Lables.aOn')
.head 7 -  Call SalShowWindow(frm_Lables.dfFrom)
.head 7 -  Call SalHideWindow(frm_Lables.dfTo)
.head 7 -  Call SalSetFocus(frm_Lables.dfFrom)
.head 6 +  If tblReps.NDAT = 2
.head 7 -  Call SalShowWindow(cCalendarFrom)
.head 7 -  Call SalShowWindow(cCalendarTo)
.head 7 -  Set frm_Lables.dfFrom = CurrentLangTable.GetAtomTitle( 'frm_Lables.dfFrom' )
.head 7 -  Call SalShowWindow( frm_Lables.dfTo)
.head 7 -  Call SalSetFocus( frm_Lables.dfFrom)
.head 6 -  ! ! =========================================================================
.head 6 -  ! ! == Населим список уже существующих файлов по данной маске отчета
.head 6 -  ! ! =========================================================================
.head 6 -  Call SalTblReset( tblLstFiles )
.head 6 -  Call SalEnableWindow(cCalendarFrom)
.head 6 -  Call SalEnableWindow(cCalendarTo)
.head 6 -  Call SalEnableWindow(pbTxt)
.head 6 -  ! =====================================================
.head 6 -  ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 6 -  Set dfPath = strPrintPath
.head 6 -  Call SalSendMsg(dfPath, SAM_User, 0, 0)
.head 5 +  On SAM_ColumnSelectClick
.head 6 -  ! Сортировка по номеру отчета
.head 6 -  ! Call SalWaitCursor( TRUE )
.head 6 -  ! Set hColumn = SalNumberToWindowHandle( wParam )
.head 6 -  ! Set nOrderBy = Not nOrderBy
.head 6 -  ! Call SalTblSortRows( hWndForm, SalTblQueryColumnID( hColumn ), nOrderBy )
.head 6 -  ! Call SalTblSetColumnFlags( hColumn, COL_Selected, FALSE )
.head 6 -  ! Call SalWaitCursor( FALSE )
.head 6 -  Call SalWaitCursor( TRUE )
.head 6 -  Set hColumn = SalNumberToWindowHandle( wParam )
.head 6 -  Set nOrderBy = Not nOrderBy
.head 6 -  Call SalTblSortRows( hWndForm, SalTblQueryColumnID( hColumn ), nOrderBy )
.head 6 -  Call SalTblSetColumnFlags( hColumn, COL_Selected, FALSE )
.head 6 -  Call SalWaitCursor( FALSE )
.head 5 +  On SAM_DoubleClick
.head 6 -  ! Call SalDisableWindow(pbWord)
.head 6 -  Call SalTblQueryFocus(tblReps, tek, hColumn)
.head 6 -  Set tek = lParam
.head 6 -  ! ! =====================================================
.head 6 -  ! ! ==========Дадим сообщение календарям
.head 6 -  ! ! ========== SAM_User чтоб прочитать выбранную дату
.head 6 -  ! ! ==========Дата в формате == 23-10-2001
.head 6 -  ! ! =====================================================
.head 6 -  Call SalSendMsg(cCalendarFrom, SAM_User, 0, 0)
.head 6 -  Call SalSendMsg(cCalendarTo, SAM_User, 0, 0)
.head 6 -  ! ! =====================================================
.head 6 -  ! ! - Генерируем имя файла отчета - дата в имени файла отчета  -
.head 6 -  ! ! - это дата "c"  (strDateFrom)
.head 6 -  ! ! =====================================================
.head 6 -  ! Call Debug('----1-------')
.head 6 +  If FL_FORMAT
.head 7 -  Set strFileNameRtf  =(   IifS(tblReps.maska=STRING_Null,
                                                       NumberToStrFormat (tblReps.Kod, 3) ||
                                                       GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 0, 2) ) ) ||
                                                       GetCharForDigit( SalStrToNumber(SalStrMidX(strDateFrom, 3, 2) ) )||
                                                        NumberToStrFormat (ID,3),
                                               tblReps.maska )    )    ||   '.rtf'
.head 7 -  Set strTmplPath = GetTemplateDir() || "\\" || tblReps.repw
.head 7 -  ! Call Debug('----2-------')
.head 7 -  Call SalPrtSetDefault(sDeviceDef, sDriverDef, sPortDef)
.head 6 +  Else
.head 7 -  ! Call Debug('----3-------')
.head 7 -  Set strFileNameTxt   =(   IifS( tblReps.maska=STRING_Null,
                                                     NumberToStrFormat (tblReps.Kod, 3)  ||
                                                     GetCharForDigit( SalStrToNumber( SalStrMidX(strDateFrom, 0, 2) ) )||
                                                     GetCharForDigit( SalStrToNumber( SalStrMidX(strDateFrom, 3, 2) ) )||
                                                     NumberToStrFormat (ID,3),
                                         tblReps.maska  )  )    ||  '.txt'
.head 7 -  Set strTmplPath = GetTemplateDir() || "\\" || tblReps.rep
.head 7 -  ! - - - -  Установка єтого принтера как default  нужна лишь для того чтоб
! - - - -  при формировании текстового отчета  -  были нормальные параметры вывода
.head 7 -  Call SalPrtSetDefault('Generic / Text Only', 'WINSPOOL', 'FILE:')

.head 6 +  ! If SalIsWindowEnabled(pbView)
.head 7 -  ! Call SalDisableWindow(pbView)
.head 6 +  ! If SalIsWindowEnabled(pbPrint)
.head 7 -  ! Call SalDisableWindow(pbPrint)
.head 6 -  Set SHAP = SalNumberToStrX(tblReps.Kod, 0) || ' ' ||  tblReps.NAME
.head 6 -  Set DRUK = 'Printed: ' || SalFmtFormatDateTime(SalDateCurrent(), "dd/MM/yyyy hh:mm:ss")

.head 6 -  Set strRepDate  = strDateFrom

.head 6 +  ! ! ========================================
.head 7 -                 Call SalDisableWindow(pbPrint)
.head 6 +  ! ! - Генерируем строку вызова формы -
.head 7 -                 Call SalDisableWindow(pbPrint)
.head 6 +  ! ! ========================================
.head 7 -                 Call SalDisableWindow(pbPrint)
.head 6 -  ! Call Debug('----4-------')
.head 6 -  Set strExecForm =IifS( SalStrLowerX(SalStrLeftX(tblReps.FORM, 3))='dlg',
                                      "SalModalDialog",
                                      IifS(    (  SalStrLowerX(SalStrLeftX(tblReps.FORM, 3))='frm'  or   SalStrLowerX(SalStrLeftX(tblReps.FORM, 3))='tbl' ) ,
                                                "SalCreateWindow",  '' )
                                     )
.head 6 +  ! ! =========================================
.head 7 -                 Call SalDisableWindow(pbPrint)
.head 6 +  ! ! - Получилась строка вызова типа
.head 7 -                 Call SalDisableWindow(pbPrint)
.head 6 +  ! ! -  " SalCreateWindow(frm_Out1, hWndForm, 3,5)
.head 7 -                 Call SalDisableWindow(pbPrint)
.head 6 -  ! ! =========================================

.head 6 +  ! ! - - - - - - - -    Поскольку в таблице report в поле param
!- - - - - - - - -   остались переменные sFdat и sFdat2  -  присвоим их
.head 7 -                 Call SalDisableWindow(pbPrint)
.head 6 -  Set sFdat   = SalStrMidX (strDateFrom, 3, 2 ) || '-' || SalStrMidX (strDateFrom, 0, 2 ) || '-' ||SalStrMidX (strDateFrom, 6, 4 )
.head 6 -  Set sFdat2 = SalStrMidX (strDateTo, 3, 2 )     || '-' || SalStrMidX (strDateTo, 0, 2 )     || '-' ||SalStrMidX (strDateTo, 6, 4 )

.head 6 -  Set strExecForm = strExecForm || "(" || tblReps.FORM || ",hWndForm," || tblReps.param || ")"


.head 6 -  ! ! ! ========================================================
.head 6 -  ! ! ! Выполним отчет, и заново перенаселим лист бокс
.head 6 -  ! ! ! ========================================================
.head 6 -  ! Call Debug('----5-------')
.head 6 -  Call SalCompileAndEvaluate(strExecForm, nError, nErrorPos,  nRet,
                                                           strRet, dtRet, hWndRet, FALSE, SalContextCurrent())
.head 6 -  ! Call Debug('----5.5-------')
.head 6 +  If (nError)
.head 7 -  Call SalMessageBox('SalCompileAndEvaluate возвратила ошибку :'||SalNumberToStrX(nError,0) ||
                                              '  на выполнении  ** ' ||  strExecForm || ' ** .   При вызове процедуры   '||  strExecForm || ' возникла ошибка '|| strRet ||
                                              ' и числовая ошибка - '|| SalNumberToStrX(nRet,0) ,  'Внимание', 0)
.head 6 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 6 -  Set dfPath = strPrintPath
.head 6 -  Call SalSendMsg(dfPath, SAM_User, 0, 0)

.head 6 -  ! ! ==== Выставим  тип отчета по default
! ==== (тоесть коггда отчет делают двойным clickom  (wParam <> 5) )
.head 6 +  If (wParam != 5)
.head 7 +  If (tblReps.rep  = STRING_Null )
.head 8 -  Set FL_FORMAT = TRUE
.head 8 +  If (tblReps.repw  = STRING_Null )
.head 9 -  Call SalMessageBox('В таблице reports не заполнено ни одно из полей : namew, name ', 'Внимание',0)
.head 7 +  Else
.head 8 -  Set FL_FORMAT = FALSE
.head 5 +  On SAM_Destroy
.head 6 -  ! ====== Поставим настройки принтера назад 
.head 6 -  Call SalPrtSetDefault(sDeviceDef, sDriverDef, sPortDef)
.head 6 -  Call SaveInfoToLog( 'Умолчательный принтер - SET: Device=' || sDeviceDef ||
', Drv=' || sDriverDef || ', Port=' || sPortDef)
.head 5 +  On UM_ReportFinish
.head 6 -  Call SalPrtSetDefault(sDeviceDef, sDriverDef, sPortDef)

.head 6 +  If not FL_FORMAT
.head 7 -  ! Set dfFileName = GetPrnDir() || '\\' || strFileName
.head 7 -  Call zarez12(  strPrintPath ||'/'|| strFileNameTxt, tblReps.Kod, sDeviceDef)
.head 7 -  ! и т.д. ???
.head 6 +  If not SalIsWindowEnabled(pbView)
.head 7 -  Call SalEnableWindow(pbView)
.head 6 +  If not SalIsWindowEnabled(pbPrint)
.head 7 -  Call SalEnableWindow(pbPrint)
.head 3 +  Data Field: dfPath
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   7.0"
.head 6 -  Top:    2.464"
.head 6 -  Width:  2.386"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.3"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 10
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On WM_LbuttonDblClick
.head 6 -  Call SalModalDialog(dlg_DirSelect, hWndForm)
.head 5 -  ! ======  Это сообщение будет посылатся каждый раз когда в dfPath ===============================
!======  (путь к отчету) будет меняться  - т.е. будем перечитывать содержимое каталога==========
.head 5 +  On SAM_User
.head 6 -  Set strFileMask= IifS(tblReps.maska=STRING_Null,   NumberToStrFormat (tblReps.Kod, 3) ||'*.*' 
                                   ,tblReps.maska )
.head 6 -  Set nFiles=VisDosEnumFiles( strPrintPath || '\\' || strFileMask, FA_Standard, strFileList)
.head 6 -  Call SalTblReset( tblLstFiles )

.head 6 -  ! ===  сфокусируем на только что созданном файле
.head 6 -  Set i = 0
.head 6 -  Set nNewRow=0
.head 6 -  Set strFileNewAdded =  IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt)  
.head 6 +  While i < nFiles
.head 7 -  Call SalTblInsertRow ( tblLstFiles, nNewRow )					
.head 7 -  Call SalTblSetContext ( tblLstFiles, nNewRow )					
.head 7 -  Call SalTblSetRowFlags( tblLstFiles, nNewRow ,ROW_New, FALSE)
.head 7 -  Set tblLstFiles.colFileName = strFileList[ i ]
.head 7 -  !
.head 7 -  Call SalFileGetDateTime( strPrintPath || '\\' || strFileList[ i ],  dFileDT )
.head 7 -  ! Set tblLstFiles.colFileDT =SalFmtFormatDateTime ( dFileDT, 'hhhh:mm  dd-MM-yy' )
.head 7 -  Set tblLstFiles.colFileDT =SalFmtFormatDateTime ( dFileDT, 'dd-MM-yy  hhhh:mm'  )
.head 7 -  Set tblLstFiles.colSort = SalFmtFormatDateTime ( dFileDT, 'yyyyMMddhhhhmm'  )
.head 7 -  !
.head 7 -  Set tblLstFiles.colFileSize = VisFileGetSize( strPrintPath || '\\' || strFileList[ i ] )
.head 7 -  Set tblLstFiles.colRepDT = GetDigitForChar (  SalStrMidX ( strFileList[ i ], 3, 1 ) ) || '-' || GetDigitForChar ( SalStrMidX ( strFileList[ i ], 4, 1 ) )

.head 7 +  If lstFiles[i] = strFileNewAdded
.head 8 -  Set nNewAdded = i 
.head 7 -  Set i = i + 1
.head 6 +  If (  nNewAdded  != -1)
.head 7 -  Call SalTblSetContext ( tblLstFiles, nNewAdded )	
				
.head 6 -  ! Call SalWaitCursor( TRUE )
.head 6 -  ! Set hColumn = SalNumberToWindowHandle( tblLstFiles.colFileDT)
.head 6 -  ! Set nOrderByDT = Not nOrderByDT
.head 6 -  ! Call SalTblSortRows( hWndForm, SalTblQueryColumnID( hColumn ), nOrderBy )
.head 6 -  ! Set hColumn = tblLstFiles.colFileDT
.head 6 +  If not SalTblSortRows( tblLstFiles, 5, TBL_SortDecreasing )
.head 7 -  Call Debug('Cannot sort By '||SalNumberToStrX(SalWindowHandleToNumber (hColumn),0))
.head 6 +  ! If not SalTblSortRows( tblLstFiles, SalTblQueryColumnID( hColumn), TBL_SortIncreasing )
.head 7 -          Call Debug(SalNumberToStrX(SalWindowHandleToNumber (hColumn),0))
.head 6 -  ! Call SalTblSetColumnFlags( hColumn, COL_Selected, FALSE )
.head 6 -  ! Call SalWaitCursor( FALSE )
.head 3 +  Custom Control: cSpltMain
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cXSalVSplitter
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   -0.014"
.head 6 -  Top:    0.073"
.head 6 -  Width:  8.7"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 4.0"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Yes
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  DLL Settings
.head 4 -  Message Actions
.head 3 +  Custom Control: cCalendarFrom
.data CLASSPROPSSIZE
0000: 4400
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 646172436F6D626F 426F78002B000100 0000010101010000
0020: 0200000001010101 0101000000000000 01000000000A6464 2F4D4D2F79797979
0040: 00000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cCalendarDropDown
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   5.686"
.head 6 -  Top:    1.24"
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  DLL Settings
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call GetMonthArray( strMonth ) 
.head 6 -  Call GetWeekDayArray( strWeekDays )
.head 6 -  Call cCalendarFrom.SetMonthText( strMonth ) 
.head 6 -  Call cCalendarFrom.SetWeekDayText( strWeekDays )
.head 6 -  ! ! - - - - - - - - - - - - Инициализация дат календаря  cCalendarFrom - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  - -
.head 6 -  Call cCalendarFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset,  COLOR_Black, COLOR_Gray, TRUE)
.head 6 -  Call cCalendarFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
.head 6 -  Call cCalendarFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
.head 6 -  Call cCalendarFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
.head 6 -  Call cCalendarFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
.head 6 -  Call cCalendarFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
.head 6 -  Call cCalendarFrom.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
.head 6 -  Call cCalendarFrom.SpecialDate(SPECIAL_OneTime, GetBankDate(), DAY_Unset, SEQ_Unset, COLOR_Blue,  COLOR_Cyan, TRUE)
.head 6 -  Call SqlPrepareAndExecute(  hSql(), T("SELECT fdat  INTO :dSelect  FROM fdat")  )
.head 6 -  Set i = 0
.head 6 +  While SqlFetchNext(hSql(), nFetchRes)
.head 7 -  Call cCalendarFrom.SpecialDate(SPECIAL_OneTime, dSelect,  DAY_Unset, SEQ_Unset, COLOR_Blue, COLOR_Cyan, TRUE)
.head 7 -  Set i = i + 1
.head 6 +  If i = 0
.head 7 -  Call SalMessageBox('Нет доступных дат для выбора','Внимание',0)

.head 6 -  Call SalSetWindowText(  cCalendarFrom,  strBankDate)
.head 5 +  On SAM_User
.head 6 -  Call SalGetWindowText( hWndItem, strDateFrom, 12 )
.head 6 -  Set nDay=SalDateDay( SalStrToDate(  strDateFrom )) 
.head 6 -  Set nMonth = SalDateMonth( SalStrToDate(  strDateFrom ))
.head 6 -  Set nYear = SalDateYear( SalStrToDate( strDateFrom ))
.head 6 -  Set strDateFrom =IifS(  nDay>9,  SalNumberToStrX(nDay,0),  "0"|| SalNumberToStrX(nDay,0)  )||  '-' || 
                                   IifS( nMonth>9, SalNumberToStrX(nMonth,0), '0'||  SalNumberToStrX(nMonth,0) ) || '-' ||SalNumberToStrX(nYear,0)
.head 3 +  Custom Control: cCalendarTo
.data CLASSPROPSSIZE
0000: 4400
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 646172436F6D626F 426F78002B000100 0000010101010000
0020: 0200000001010101 0101000000000000 01000000000A6464 2F4D4D2F79797979
0040: 00000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cCalendarDropDown
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   7.383"
.head 6 -  Top:    1.274"
.head 6 -  Width:  0.914"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  DLL Settings
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call GetMonthArray( strMonth ) 
.head 6 -  Call GetWeekDayArray( strWeekDays )
.head 6 -  Call cCalendarTo.SetMonthText( strMonth ) 
.head 6 -  Call cCalendarTo.SetWeekDayText( strWeekDays )
.head 6 -  ! ! - - - - - - - - - - - - Инициализация дат календаря  cCalendarTo - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  - -
.head 6 -  Call cCalendarTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Sunday, SEQ_Unset,  COLOR_Black, COLOR_Gray, TRUE)
.head 6 -  Call cCalendarTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Monday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
.head 6 -  Call cCalendarTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Tuesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
.head 6 -  Call cCalendarTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Wednesday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
.head 6 -  Call cCalendarTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Thursday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
.head 6 -  Call cCalendarTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Friday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
.head 6 -  Call cCalendarTo.SpecialDate(SPECIAL_Weekly, DATETIME_Null, DAY_Saturday, SEQ_Unset, COLOR_Black, COLOR_Gray, TRUE)
.head 6 -  Call cCalendarTo.SpecialDate(SPECIAL_OneTime, GetBankDate(), DAY_Unset, SEQ_Unset, COLOR_Blue,  COLOR_Cyan, TRUE)
.head 6 -  Call cCalendarTo.SpecialDate(SPECIAL_OneTime, GetBankDate(), DAY_Unset, SEQ_Unset, COLOR_Blue,  COLOR_Cyan, TRUE)
.head 6 -  Call SqlPrepareAndExecute(  hSql(), T("SELECT fdat  INTO :dSelect  FROM fdat")  )
.head 6 -  Set i = 0
.head 6 +  While SqlFetchNext(hSql(), nFetchRes)
.head 7 -  Call cCalendarTo.SpecialDate(SPECIAL_OneTime, dSelect,  DAY_Unset, SEQ_Unset, COLOR_Blue, COLOR_Cyan, TRUE)
.head 7 -  Set i = i + 1
.head 6 +  If i = 0
.head 7 -  Call SalMessageBox('Нет доступных дат для выбора','Внимание',0)
.head 6 -  Call SalSetWindowText(  cCalendarTo,  strBankDate )
.head 5 +  On SAM_User
.head 6 -  Call SalGetWindowText( hWndItem, strDateTo, 12 )
.head 6 -  Set nDay=SalDateDay( SalStrToDate(  strDateTo )) 
.head 6 -  Set nMonth = SalDateMonth( SalStrToDate(  strDateTo ))
.head 6 -  Set nYear = SalDateYear( SalStrToDate( strDateTo ))
.head 6 -  Set strDateTo =IifS(  nDay>9,  SalNumberToStrX(nDay,0),  "0"|| SalNumberToStrX(nDay,0)  )||  '-' || 
                                   IifS( nMonth>9, SalNumberToStrX(nMonth,0), '0'||  SalNumberToStrX(nMonth,0) ) || '-' ||SalNumberToStrX(nYear,0)
.head 3 +  Custom Control: cSpltRightB
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cXSalHSplitterInvisible
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   5.217"
.head 6 -  Top:    1.702"
.head 6 -  Width:  9.017"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 2.583"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  DLL Settings
.head 4 -  Message Actions
.head 3 +  Custom Control: cSpltRight
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cXSalHSplitter
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   4.917"
.head 6 -  Top:    0.131"
.head 6 -  Width:  9.867"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 4.323"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  DLL Settings
.head 4 -  Message Actions
.head 3 +  Custom Control: cSpltRightT
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cXSalHSplitterInvisible
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   5.217"
.head 6 -  Top:    0.202"
.head 6 -  Width:  9.067"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 1.583"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  DLL Settings
.head 4 -  Message Actions
.head 3 +  Custom Control: cSpltRightTB
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cXSalVSplitterInvisible
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   5.617"
.head 6 -  Top:    1.119"
.head 6 -  Width:  2.9"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 0.51"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  DLL Settings
.head 4 -  Message Actions
.head 3 +  Child Table: tblLstFiles
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   5.383"
.head 6 -  Top:    3.167"
.head 6 -  Width:  5.85"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.857"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: 10
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 50000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: colFileName
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Имя файла
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.383"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colRepDT
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: За 
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.643"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFileDT
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата созд.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.5"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFileSize
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Байт
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.814"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colSort
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 6 -  Call SalTblSetTableFlags( hWndItem, TBL_Flag_GrayedHeaders|TBL_Flag_SingleSelection, FALSE )
.head 6 -  Call SalTblSetTableFlags( hWndItem, TBL_Flag_SuppressRowLines|TBL_Flag_SuppressLastColLine, TRUE )
.head 5 +  On SAM_DoubleClick
.head 6 -  Call SalSendMsg (pbView, SAM_Click, 0, 0 )
.head 2 +  Functions
.head 3 +  ! Function: MinVal
.head 4 -          Description: 
.head 4 -          Returns 
.head 4 +          Parameters 
.head 5 -          Number: nValArr [*]
.head 5 -          Number: nCou
.head 4 -          Static Variables 
.head 4 +          Local variables 
.head 5 -          Number: i
.head 5 -          Number: nMin
.head 4 +          Actions 
.head 5 -  ! Call SalMessageBox(' IN Min =  ' , 'ff',0)
.head 5 -          Set i = 0
.head 5 -          Set nMin = nValArr [ 0 ]
.head 5 +          Loop 
.head 6 -  ! Call SalMessageBox(' i=   '|| SalNumberToStrX ( i ,0) || ' nCou=   '|| SalNumberToStrX ( nCou ,0) , 'ff',0)
.head 6 +          If i > nCou - 1
.head 7 -          Return nMin
.head 6 +          If nMin > nValArr [ i ]
.head 7 -          Set nMin = nValArr [ i ]
.head 6 -          Set i = i + 1
.head 3 +  ! Function: MaxVal
.head 4 -          Description: 
.head 4 -          Returns 
.head 4 +          Parameters 
.head 5 -          Number: nValArr [*]
.head 5 -          Number: nCou
.head 4 -          Static Variables 
.head 4 +          Local variables 
.head 5 -          Number: i
.head 5 -          Number: nMax
.head 4 +          Actions 
.head 5 -          Set i = 0
.head 5 -          Set nMax = 0
.head 5 +          Loop 
.head 6 +          If i > nCou - 1
.head 7 -          Return nMax
.head 6 +          If nMax < nValArr [ i ]
.head 7 -          Set nMax = nValArr [ i ]
.head 6 -          Set i = i + 1
.head 3 +  Function: Sor
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 -  Actions
.head 2 +  Window Parameters
.head 3 -  Number: nMode
.head 2 +  Window Variables
.head 3 -  Number: nWndX
.head 3 -  Number: nWndY
.head 3 -  String: strPath   
.head 3 -  String: strFileMask
.head 3 -  ! - -  Эти переменные есть в главных обьявлениях по возможности их нужно от туда убрать
.head 3 -  Number: tek  !! текущая строка выбраного отчета
.head 3 -  Number: nFilesForPrn[*]       !! Если выбрали для печати несколько файлов
.head 3 -  Number: i
.head 3 -  Date/Time: dSelect                !!
.head 3 -  Date/Time: dFileDT               !!

.head 3 -  ! - - - Переменные для вычитки инфы о файлах 
.head 3 -  String: strFileList[*]
.head 3 -  Number: nNewRow
.head 3 -  Number: nNewAdded   
.head 3 -  String: strFileNewAdded
.head 3 -  Window Handle: hColumn  
.head 3 -  Number: nOrderBy   
.head 3 -  Number: nOrderByDT   
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SetWindowFullSize( hWndForm )
.head 4 -  Call SetWindowFont( hWndForm )
.head 4 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  Call XSalTooltipSetUserDefault()
.head 4 -  !
.head 4 -  Call cSpltMain.setLeftFrame( tblReps)
.head 4 -  Call cSpltMain.setRightFrame( cSpltRight )
.head 4 -  Call cSpltMain.setBarPosition( 650 )

.head 4 -  Call cSpltRight.setBarSize(20)
.head 4 -  Call cSpltRight.setTopFrame(cSpltRightT)
.head 4 -  Call cSpltRight.setBottomFrame(cSpltRightB)
.head 4 -  Call cSpltRight.setBarPosition( 110 )
.head 4 -  Call cSpltRight.setStyle( XSalSplitter_NotResizable | XSalSplitter_Frame1AbsSize, TRUE )

.head 4 -  Call cSpltRightB.setBarSize( 1 )
.head 4 -  Call cSpltRightB.setBarPosition( 84 )
.head 4 -  Call cSpltRightB.setStyle( XSalSplitter_NotResizable | XSalSplitter_Frame1AbsSize, TRUE )
.head 4 -  Call cSpltRightB.setTopFrame(dfPath)
.head 4 -  Call cSpltRightB.setBottomFrame(tblLstFiles)


.head 4 -  Call cSpltRightT.setBarSize( 1 )
.head 4 -  Call cSpltRightT.setBarPosition(490 )
.head 4 -  Call cSpltRightT.setStyle( XSalSplitter_NotResizable | XSalSplitter_Frame1AbsSize, TRUE )
.head 4 -  Call cSpltRightT.setBottomFrame(cSpltRightTB)
.head 4 -  Call cSpltRightT.setTopFrame(  SalCreateWindowEx( frm_Lables, hWndForm, 0,0,0,0, CREATE_AsChild )   )
.head 4 -  Call cSpltRightTB.setRightFrame(cCalendarTo)
.head 4 -  Call cSpltRightTB.setLeftFrame(cCalendarFrom)
.head 4 -  Call cSpltRightTB.setBarSize( 1 )

.head 4 -  ! ! - - - -  Это сделано чтоб перерисвывались Lables
.head 4 -  Call SalGetWindowSize ( hWndForm, nWndX, nWndY)
.head 4 -  Call SalSetWindowSize ( hWndForm, nWndX, nWndY)

.head 4 -  Set strPrintPath = GetPrnDir()
.head 4 -  Set dfPath = strPrintPath
.head 4 -  !
.head 4 -  ! - - - - - - - - - -  Инициализация переменных - - - - - - - - - - - 
.head 4 -  Call SalDisableWindow(pbWord)
.head 4 -  Call SalDisableWindow(pbTxt)
.head 4 -  Set AMFO = GetBankMfo()
.head 4 -  ! Set bFLS = GetAccountStructure(nTmp, nTmp, nTmp, nTmp)
  ! Старый план счетов
.head 4 -  Set tek = 0
.head 4 -  Set FL_FORMAT = FALSE          !! По умолчанию текстовый формат
.head 4 -  Set AQH = GetBankName()
.head 4 -  Set strBankDate = SalFmtFormatDateTime( GetBankDate(), 'dd/MM/yyyy')
.head 4 -  Set app = GetCodeApp()
.head 4 -  Set ID = GetUserId()
.head 4 -  Call SqlPrepareAndExecute(hSql(), T("
     SELECT fio
     INTO :IDNAME
     FROM staff
     WHERE id=:ID"))
.head 4 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 3 +  On WM_Size
.head 4 -  ! Call Debug(SalNumberToStrX(wParam,0))
.head 4 +  If wParam = SIZE_MAXIMIZED
.head 5 -  Call SetWindowFullSize(hWndForm)
.head 5 -  ! Call Debug('IN FullSize')
.head 3 +  On SAM_CreateComplete
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_Destroy
.head 4 +  If SalStrTrimX(SalStrUpperX(GetDBMS())) = 'ORACLE'
.head 5 -  Call XRoleUnset(hSql(), 'ShowOutForms(hWndMDI,' ||
     SalNumberToStrX(nMode,0) || ')')
.head 4 -  Set hFrm_Out=hWndNULL
.head 3 +  On WM_Activate
.head 4 -  Call Debug('In Activate')
.head 1 +  Dialog Box: dlg_mas2
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: ОТБОР  ПРОВОДОК  ДЛЯ  ПЕЧАТИ
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   0.625"
.head 4 -  Top:    0.625"
.head 4 -  Width:  5.533"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 1.76"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Маска отбора
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 -  Background Text: "Маска"  ДЕБЕТА счета:
.head 4 -  Resource Id: 18054
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.186"
.head 5 -  Top:    0.119"
.head 5 -  Width:  3.029"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.19"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Dark Red
.head 4 -  Background Color: Default
.head 3 +  Data Field: masD
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 14
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.257"
.head 6 -  Top:    0.094"
.head 6 -  Width:  2.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Dark Red
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  Background Text: "Маска"  КРЕДИТА счета:
.head 4 -  Resource Id: 61437
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.043"
.head 5 -  Top:    0.488"
.head 5 -  Width:  3.143"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.19"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Midnight Blue
.head 4 -  Background Color: Default
.head 3 +  Data Field: masK
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 14
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.243"
.head 6 -  Top:    0.469"
.head 6 -  Width:  2.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Dark Blue
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Pushbutton: pb1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Утвердить
.head 4 -  Window Location and Size
.head 5 -  Left:   0.557"
.head 5 -  Top:    1.01"
.head 5 -  Width:  1.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.344"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Enter
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set masD=SalStrTrimX(masD)
.head 6 -  Set masK=SalStrTrimX(masK)
.head 6 -  Call SalEndDialog(hWndForm, 0)
.head 3 +  Pushbutton: pb2
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Отказаться
.head 4 -  Window Location and Size
.head 5 -  Left:   2.843"
.head 5 -  Top:    1.01"
.head 5 -  Width:  1.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.344"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Esc
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Dark Red
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set masD='-'
.head 6 -  Call SalEndDialog(hWndForm, 0)
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Receive String: maskD
.head 3 -  Receive String: maskK
.head 2 -  Window Variables
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalCenterWindow(hWndForm)
.head 4 -  Set masD='*'
.head 4 -  Set masK='*'
.head 3 +  On SAM_Destroy
.head 4 -  Set maskD= StrMatches2Like( masD )
.head 4 -  Set maskK= StrMatches2Like( masK )
.head 1 +  Dialog Box: dlg_PROV
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: ОТБОР проводок для печати реестра
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   0.625"
.head 4 -  Top:    0.625"
.head 4 -  Width:  8.883"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 2.167"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 -  Background Text: Код операции:
.head 4 -  Resource Id: 41072
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.183"
.head 5 -  Top:    0.06"
.head 5 -  Width:  2.029"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: TT
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 3
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   2.317"
.head 6 -  Top:    0.024"
.head 6 -  Width:  0.671"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  If SqlPrepareAndExecute( hSql(),
"SELECT tt,name INTO :tt, :sTT FROM  tts WHERE tt=:TT")
and SqlFetchNext( hSql(), nTmp ) 
.head 6 -  Return VALIDATE_Ok
.head 3 +  Data Field: sTT
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.0"
.head 6 -  Top:    0.024"
.head 6 -  Width:  5.614"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  !
.head 3 -  Background Text: Код валюты:
.head 4 -  Resource Id: 41073
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.183"
.head 5 -  Top:    0.274"
.head 5 -  Width:  2.029"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: KV
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 3
.head 5 -  Data Type: Number
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   2.317"
.head 6 -  Top:    0.238"
.head 6 -  Width:  0.671"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  If SqlPrepareAndExecute( hSql(),
  "SELECT kv,name INTO :kv,:sKV FROM tabval WHERE kv=:KV")
and SqlFetchNext(  hSql(), nTmp )
.head 6 -  Return VALIDATE_Ok
.head 3 +  Data Field: sKV
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.0"
.head 6 -  Top:    0.238"
.head 6 -  Width:  5.614"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  !
.head 3 -  Background Text: Маска Сч.дебет:
.head 4 -  Resource Id: 41074
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.183"
.head 5 -  Top:    0.5"
.head 5 -  Width:  2.029"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: NLSD
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   2.317"
.head 6 -  Top:    0.464"
.head 6 -  Width:  2.357"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  Set nlsd=SalStrTrimX(StrMatches2Like( NLSD ))
.head 6 -  Return VALIDATE_Ok
.head 3 -  !
.head 3 -  Background Text: Маска Сч.кредит:
.head 4 -  Resource Id: 41075
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.183"
.head 5 -  Top:    0.738"
.head 5 -  Width:  2.029"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: NLSK
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   2.317"
.head 6 -  Top:    0.702"
.head 6 -  Width:  2.357"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  Set nlsk=SalStrTrimX(StrMatches2Like( NLSK ))
.head 6 -  Return VALIDATE_Ok
.head 3 -  !
.head 3 -  Background Text: Код исполнителя
.head 4 -  Resource Id: 733
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.183"
.head 5 -  Top:    1.0"
.head 5 -  Width:  2.029"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: ISP
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 3
.head 5 -  Data Type: Number
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   2.317"
.head 6 -  Top:    0.964"
.head 6 -  Width:  0.671"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  If SqlPrepareAndExecute( hSql(),
  "SELECT id,fio INTO :isp,:sFIO FROM staff WHERE id=:ISP")
and SqlFetchNext(  hSql(), nTmp )
.head 6 -  Return VALIDATE_Ok
.head 3 +  Data Field: sFIO
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.0"
.head 6 -  Top:    0.964"
.head 6 -  Width:  5.614"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  !
.head 3 +  Pushbutton: pb1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Утвердить
.head 4 -  Window Location and Size
.head 5 -  Left:   3.517"
.head 5 -  Top:    1.44"
.head 5 -  Width:  1.529"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.344"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Enter
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set shap=sTT||" "||sKV
.head 6 -  Call SalEndDialog(hWndForm, 1)
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Receive String: tt
.head 3 -  Receive Number: kv
.head 3 -  Receive String: nlsd
.head 3 -  Receive String: nlsk
.head 3 -  Receive String: shap
.head 3 -  Receive Number: isp
.head 2 +  Window Variables
.head 3 -  Number: nTmp
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalCenterWindow(hWndItem)
.head 4 -  Set KV=kv
.head 4 -  Set ISP=isp
.head 3 -  On SAM_Destroy
.head 1 +  Dialog Box: dlg_mas
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: ОТБОР  СЧЕТОВ  ДЛЯ  ПЕЧАТИ
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   0.625"
.head 4 -  Top:    0.625"
.head 4 -  Width:  5.533"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 1.5"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Маска отбора
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 -  Background Text: "Маска" для отбора:
.head 4 -  Resource Id: 41076
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.057"
.head 5 -  Top:    0.125"
.head 5 -  Width:  2.529"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.19"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: mas
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 14
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   2.657"
.head 6 -  Top:    0.107"
.head 6 -  Width:  2.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Pushbutton: pb1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Утвердить
.head 4 -  Window Location and Size
.head 5 -  Left:   0.557"
.head 5 -  Top:    0.594"
.head 5 -  Width:  1.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.344"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Enter
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set mas=SalStrTrimX(mas)
.head 6 -  Call SalEndDialog(dlg_mas, 0)
.head 3 +  Pushbutton: pb2
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Отказаться
.head 4 -  Window Location and Size
.head 5 -  Left:   2.843"
.head 5 -  Top:    0.594"
.head 5 -  Width:  1.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.344"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Esc
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Dark Red
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set mas='-'
.head 6 -  Call SalEndDialog(dlg_mas, 0)
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Receive String: mask
.head 3 -  String: slovo
.head 2 -  Window Variables
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalCenterWindow(hWndItem)
.head 4 -  Call SalSetWindowText( hWndForm," ОТБОР "||slovo||" для печати")
.head 4 -  Set mas=mask
.head 3 +  On SAM_Destroy
.head 4 -  Set mask=   StrMatches2Like( mas )
.head 4 -  ! Set mask=IifS( mas !='*',  StrMatches2Like( mas ) ,   '' )
.head 4 -  ! Set mask=IifS( mas !='*',  " and trim(Nls) LIKE \'" || StrMatches2Like( mas ) || "\'",   ' ' )
.head 1 +  Dialog Box: dlg_PeriodSet
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Установка периода отчета
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  5.514"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 1.49"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Установить период времени для отчета
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 -  Background Text: С:
.head 4 -  Resource Id: 24847
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.386"
.head 5 -  Top:    0.208"
.head 5 -  Width:  0.457"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfDate1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 10
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.971"
.head 6 -  Top:    0.167"
.head 6 -  Width:  1.586"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 +  If SalIsNull( hWndItem )
.head 7 -  Return VALIDATE_OkClearFlag
.head 6 +  If NOT SalIsValidDateTime( hWndItem )
.head 7 -  Call SalMessageBox('Неверный формат даты!', 'Внимание!', MB_Ok)
.head 7 -  Return VALIDATE_Cancel
.head 6 -  Set strDat1 = dfDate1
.head 6 -  Return VALIDATE_Ok
.head 3 -  Background Text: По:
.head 4 -  Resource Id: 24848
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   2.7"
.head 5 -  Top:    0.208"
.head 5 -  Width:  0.529"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfDate2
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 10
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.314"
.head 6 -  Top:    0.167"
.head 6 -  Width:  1.586"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 +  If SalIsNull( hWndItem )
.head 7 -  Return VALIDATE_OkClearFlag
.head 6 +  If NOT SalIsValidDateTime( hWndItem )
.head 7 -  Call SalMessageBox('Неверный формат даты!', 'Внимание!', MB_Ok)
.head 7 -  Return VALIDATE_Cancel
.head 6 -  Set strDat1 = dfDate2
.head 6 -  Return VALIDATE_Ok
.head 3 +  Pushbutton: pbOk
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Утвердить
.head 4 -  Window Location and Size
.head 5 -  Left:   0.657"
.head 5 -  Top:    0.625"
.head 5 -  Width:  1.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.333"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Enter
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If SalIsNull (dfDate1) Or SalIsNull (dfDate2)
.head 7 -  Call SalMessageBox('Незаполнены поля дат!', 'Внимание!', MB_Ok)
.head 7 -  Return FALSE
.head 6 -  Call SalEndDialog( hWndForm, 1 )
.head 3 +  Pushbutton: pbCancel
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Отказаться
.head 4 -  Window Location and Size
.head 5 -  Left:   3.0"
.head 5 -  Top:    0.625"
.head 5 -  Width:  1.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.333"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Dark Red
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalEndDialog( hWndForm, 0 )
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Receive String: strDat1
.head 3 -  Receive String: strDat2
.head 2 -  Window Variables
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalCenterWindow( hWndForm )
.head 4 -  Set dfDate1 = strDat1
.head 4 -  Set dfDate2 = strDat2
.head 1 +  Form Window: frm_Ndok   
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Баланс банка
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  7.7"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.677"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Документы разные
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: sdat
.head 3 -  String: sdat2
.head 3 -  Number: para
.head 2 +  Window Variables
.head 3 -  String: ss
.head 3 -  String: maska
.head 3 -  Number: GRK 
.head 3 -  Number: KV
.head 3 -  Number: nKV
.head 3 -  Date/Time: PDAT
.head 3 -  Date/Time: VDAT
.head 3 -  Number: UD
.head 3 -  Number: DK
.head 3 -  Number: REF
.head 3 -  String: ND
.head 3 -  String: MFOA
.head 3 -  String: NLSA
.head 3 -  String: MFOB
.head 3 -  String: NLSB
.head 3 -  String: NLS1
.head 3 -  String: NLS2
.head 3 -  String: TT
.head 3 -  String: TT1
.head 3 -  Number: S
.head 3 -  Number: SQ
.head 3 -  Number: UU
.head 3 -  String: NAM
.head 3 -  String: NAMV
.head 3 -  !
.head 3 -  String: tex1
.head 3 -  String: tex2
.head 3 -  String: strTitle2
.head 3 -  !
.head 3 -  Number: nUserId
.head 3 -  String: shap1
.head 3 -  !
.head 3 -  Number: ISP
.head 3 -  String: WHERE_ISP
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set SHAP = SHAP || ' ' || strDateFrom
.head 4 +  If para!=522 or para!=523 or para!=526 or para!=527
.head 5 -  Set strTitle2 = strDateFrom
.head 4 +  If para = 7 or para = 8
.head 5 -  Set shap1 = 'BLK '
.head 4 -  Set nKV = GetBaseVal()
.head 4 -  Set TT1 = GetBankMfo()
.head 4 -  Set strBind = 'GRK,KV,PDAT,UD,DK,REF,ND,MFOA,NLSA,MFOB,NLSB,S,SQ,TT' ! наши переменные
.head 4 -  Set strInput = strBind
.head 4 -  Set nInd = RPT_NoToolbar ! парамерт для управления печатью
                         ! отчета
.head 4 +  If para = 1 ! незавизированные N
.head 5 -  Set ss = T("   
    SELECT c.idchk,o.kv,o.tt,o.pdat,o.userid,o.dk,o.ref,
           o.nd,o.mfoa,o.nlsa,o.mfob,o.nlsb,o.s/100,
           gl.p_icurval(o.kv,o.s, :sdat )/100,c.name,t.name
    FROM oper O, chklist_tts CT, chklist C , tabval T
    INTO :GRK,:KV,:TT,:PDAT,:UD,:DK,:REF,:ND,:MFOA,:NLSA,
         :MFOB,:NLSB,:S,:SQ,:NAM,:NAMV 
    WHERE O.sos=:para and O.tt=CT.tt and
          C.idchk=CT.idchk and t.kv=o.kv and
          date(o.vdat)<= :sdat  and
          C.idchk=p_getcatl(o.tt,length(rtrim(o.chk))/6+1)
    ORDER BY 1,2,3,4,5,6,7,8")
.head 4 +  Else If para = 314 ! реестр для єл кл
.head 5 -  Set ss = T("
    SELECT a.kv,o.nlsa,o.nd,o.nlsb,TO_NUMBER(o.mfob),
           o.nam_b,o.s,o.nazn,TO_NUMBER(c.okpo),c.rnk,c.nmk,
           a.isp,o.pdat
    INTO :KV,:NLSA,:ND,:NLSB,:DK,:MFOB,:S,:MFOA,:SQ,:REF,
         :TT,:UD,:PDAT
    FROM accounts a, oper o, customer c, cust_acc cu
    WHERE a.acc=cu.acc and cu.rnk=c.rnk and a.kv=o.kv and
          a.nls=o.NLSA and o.sos=5 and
          o.tt like 'KL%' and o.vdat= :sdat
    ORDER BY a.isp,c.rnk,a.nls,a.kv,o.s")
.head 4 +  Else If para = 315 ! реестр для єл кл (по виконавцю лише)  
.head 5 -  Set maska = Maska_NLS("счетов")
.head 5 +  If maska='-'
.head 6 -  Call SalDestroyWindow( hWndForm )
.head 6 -  Return FALSE
.head 5 -  Call SqlPrepareAndExecute(hSql(), T("
     SELECT id
     INTO :nUserId
     FROM staff
     WHERE logname=user"))
.head 5 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Set ss = T("
    SELECT a.kv,o.nlsa,o.nd,o.nlsb,TO_NUMBER(o.mfob),
           o.nam_b,o.s,o.nazn,TO_NUMBER(c.okpo),c.rnk,c.nmk,
           a.isp,o.pdat
    INTO :KV,:NLSA,:ND,:NLSB,:DK,:MFOB,:S,:MFOA,:SQ,:REF,
         :TT,:UD,:PDAT
    FROM accounts a, oper o, customer c, cust_acc cu
    WHERE a.acc=cu.acc and cu.rnk=c.rnk and a.kv=o.kv and
          a.nls=o.NLSA and o.sos=5 and
          a.isp=" || Str(nUserId) || " and
          o.tt like 'KL%' and o.vdat= :sdat and 
           ltrim(rtrim(o.nlsa)) LIKE \'" ||
          SalStrTrimX(maska) || "\'
    ORDER BY a.isp,c.rnk,a.nls,a.kv,o.s")
.head 4 +  Else If para = 21 or para = 31 or para = 41 ! РЕЕСТР ПРОВОДОК
                                            ! за день для КБ
                                            ! на Украине
.head 5 -  Set TT1 = ''
.head 5 +  If para = 21
.head 6 -  Set nKV = NUMBER_Null
.head 5 -  Set NLS1 = ''
.head 5 -  Set NLS2 = ''
.head 5 -  Set ISP = NUMBER_Null
.head 5 +  If SalModalDialog(dlg_PROV, hWndForm, TT1, nKV, NLS1, NLS2, SHAP, ISP)!=1
.head 6 -  Call SalDestroyWindow( hWndForm )
.head 6 -  Return FALSE
.head 5 -  Set NAM=" trunc( p.fdat )  between  :sdat   and   :sdat2  "
.head 5 +  If TT1 != ''
.head 6 -  Set NAM = NAM || " and  p.tt='" || TT1 || "' "
.head 5 +  If nKV != NUMBER_Null
.head 6 -  Set NAM = NAM || " and p.kv=" || Str(nKV) 
.head 5 +  If NLS1 != ''
.head 6 -  Set NAM = NAM || " and trim(p.nlsd) LIKE \'" || NLS1 ||
    "\'"
.head 5 +  If NLS2 != ''
.head 6 -  Set NAM = NAM || " and trim(p.nlsk) LIKE \'" || NLS2 ||
    "\'"
.head 5 +  If ISP
.head 6 -  Set WHERE_ISP=' WHERE isp=:ISP '
.head 5 +  Else
.head 6 -  Set WHERE_ISP=''
.head 5 +  If para = 31
.head 6 -  Set ss = T("
    SELECT decode(p.tt,o.tt,o.sk,NVL(t.sk,o.sk)),p.nlsd,
           p.nlsk,p.s
    FROM provodki p, oper o, tts t
    INTO :KV,:NLSA,:NLSB,:S
    WHERE p.ref=o.ref and o.sk>0 and o.sk<40 and
          t.tt=p.tt and " || NAM || "
    ORDER BY 1,2,3")
.head 5 +  Else If para = 41
.head 6 +  If strDateTo !=strDateFrom
.head 7 -  Set strTitle2 = 'період з ' || strDateFrom || ' по ' || strDateTo
.head 6 -  Set ss = T("
    SELECT p.nlsk,p.fdat,p.s,decode(o.nlsa,p.nlsk,o.NAM_A,NAM_B),
           w1.value,'сч.факт: ' || w2.value,p.nazn
    FROM provodki p, oper o, operw w1, operw w2
    INTO :NLSB,:PDAT,:S,:MFOA,:MFOB,:NLSA,:TT
    WHERE p.ref=o.ref and o.sk>0 and o.sk<40 and
          p.ref=w1.ref(+) and w1.tag(+)='FIO' and
          p.ref=w2.ref(+) and w2.tag(+)='KOPL' and " ||
          NAM || "
    ORDER BY 1,2,3")
.head 5 +  Else If para = 21
.head 6 +  If strDateTo != strDateFrom
.head 7 -  Set strTitle2 = 'період з ' || strDateFrom || ' по ' || strDateTo
.head 6 -  Set ss = T("
    SELECT tt,ref,kv,nlsd,s,gl.p_icurval(kv,s,fdat),nlsk,
           nazn, fdat       
    FROM provodki p
    INTO :TT,:REF,:KV,:NLSA,:S,:SQ,:NLSB,:MFOA, :PDAT
    WHERE (accd in (select acc from saldo"|| WHERE_ISP ||") or 
           acck in (select acc from saldo"|| WHERE_ISP ||") ) and "||NAM||"
   ORDER BY kv,tt,fdat,s")
.head 4 +  ! Else If para=-1  ! сторнированные S
.head 5 -                   Set ss=T("   
SELECT c.idchk,o.kv,o.tt,o.pdat,o.userid,o.dk,o.ref,
       o.nd,o.mfoa,o.nlsa,o.mfob,o.nlsb,o.s/100,
       gl.p_icurval(o.kv,o.s, :sdat  )/100,c.name,t.name
FROM  oper O,
      chklist_tts CT,
      chklist C,
      tabval T
INTO :GRK,:KV,:TT,:PDAT,:UD,:DK,:REF,
     :ND,:MFOA,:NLSA,:MFOB,:NLSB,:S,:SQ,:NAM,:NAMV 
WHERE  O.sos=-1 and O.tt=CT.tt and C.idchk= CT.idchk  and 
       t.kv=o.kv and date(o.vdat)= :sdat  and 
       C.idchk =p_getcatl(o.tt, length(rtrim(o.chk))/6 )
ORDER BY 1,2,3,4,5,6,7,8  ")
.head 4 +  ! Else If para=2   ! оплаченные внутренные и начальные V
.head 5 -                   Set ss = T("  SELECT 
 o.kv, o.tt, o.pdat, o.userid,o.dk,  o.ref, o.nd,o.mfoa,o.nlsa,o.mfob,
  o.nlsb, o.s/100,  gl.p_icurval (o.kv, o.s,  :sdat   )/100, t.name
FROM  oper O,  tabval T
INTO :KV, :TT, :PDAT, :UD, :DK,:REF, :ND, :MFOA, :NLSA, :MFOB,  :NLSB, :S, :SQ, :NAMV 
WHERE  o.sos=5 and  o.tt <>'K2A' and o.mfoa = " || AMFO || " and   t.kv=o.kv  and 
 date(o.vdat) =  :sdat                      
ORDER BY 1,2,3,4,5,6 ")
.head 4 +  ! Else If para=2.5 ! оплаченные внутренные
.head 5 -  ! Изменена сортировка (Ivan)
.head 5 -                   Set ss = T("  SELECT 
 o.kv, o.tt, o.pdat, o.userid,o.dk,  o.ref, o.nd,o.mfoa,o.nlsa,o.mfob,
  o.nlsb, o.s/100,  gl.p_icurval (o.kv, o.s,  :sdat   )/100, t.name
FROM  oper O,  tabval T
INTO :KV, :TT, :PDAT, :UD, :DK,:REF, :ND, :MFOA, :NLSA, :MFOB,  :NLSB, :S, :SQ, :NAMV 
WHERE  o.sos=5 and  
       o.tt not in ('K2A','K2Q') and 
       o.mfoa = " || AMFO || " and 
       o.mfob = " || AMFO || " and 
       t.kv=o.kv  and 
       date(o.vdat) =  :sdat                      
ORDER BY o.kv, o.dk, o.s ")
.head 4 +  Else If para = 577
.head 5 -  Set SHAP = SHAP ||"   ---"         ! IifS(para=5, ':' || IDNAME, '')
.head 5 -  Set ss = T("
    SELECT o.userid,o.ref,o.nd,o.dk,o.nlsa,o.mfob,o.nlsb,o.s/100,
                   o.kv, o.tt, t.name,gl.p_icurval(o.kv,o.s, :sdat )/100
    FROM oper O, tts S,tabval t
    INTO :UD,:REF,:ND,:DK,:NLSA,:MFOB,:NLSB,:S,:KV,:TT,:NAMV,:SQ
    WHERE o.tt=s.tt
          and o.kv=t.kv
          and o.vdat= :sdat
          and o.tt<>'PVP'
          and o.sos=5
    ORDER BY 9,1,2")
.head 4 +  ! Else If para=3   ! оплаченные межбанковские M
.head 5 -  ! Изменена сортировка (Ivan)
.head 5 -                   Set ss = T(" SELECT o.dk, o.kv, o.tt, o.pdat, o.userid, o.dk,
      o.ref, o.nd,o.mfoa,o.nlsa,o.mfob,  o.nlsb,
      o.s/100, gl.p_icurval(o.kv, o.s, :sdat  )/100, t.name
FROM  oper O,  tabval T
INTO  :GRK, :KV, :TT, :PDAT, :UD, :DK,:REF, :ND, :MFOA, :NLSA, :MFOB, :NLSB, :S, :SQ, :NAMV 
WHERE  o.sos=5 and   o.mfoa <> o.mfob and o.tt <>'K2A' and
        o.mfoa = " || AMFO || " and  t.kv=o.kv and  date(o.vdat) =  :sdat                     
ORDER BY  1,2,13 ")
.head 5 -  ! Set ss = T(" SELECT o.dk, o.kv, o.tt, o.pdat, o.userid, o.dk,
      o.ref, o.nd,o.mfoa,o.nlsa,o.mfob,  o.nlsb,
      o.s/100, gl.p_icurval(o.kv, o.s, :sdat  )/100, t.name
FROM  oper O,  tabval T
INTO  :GRK, :KV, :TT, :PDAT, :UD, :DK,:REF, :ND, :MFOA, :NLSA, :MFOB, :NLSB, :S, :SQ, :NAMV 
WHERE  o.sos=5 and   o.mfoa <> o.mfob and o.tt <>'K2A' and
        o.mfoa = " || AMFO || " and  t.kv=o.kv and  date(o.vdat) =  :sdat                     
ORDER BY  o.dk, o.kv, o.pdat, o.userid, o.mfob ")
.head 4 +  Else If para = 4 ! оплаченные ответные O
.head 5 -  ! Изменена сортировка (Ivan)
.head 5 -  Set ss = T("
    SELECT o.dk,o.kv,o.dat_a,o.dk,o.ref,o.nd,o.mfoa,o.nlsa,
           o.mfob,o.nlsb,o.s/100,
           gl.p_icurval(o.kv,o.s, :sdat )/100,t.name
    FROM arc_rrp O, tabval T
    INTO :GRK,:KV,:PDAT,:DK,:REF,:ND,:MFOA,:NLSA,:MFOB,
         :NLSB,:S,:SQ,:NAMV
    WHERE o.sos=5 and o.mfoa<>o.mfob and
          o.mfob=" || AMFO || " and t.kv=o.kv and
          date(o.dat_b) = :sdat
    ORDER BY 1,2,11")
.head 5 -  ! Set ss = T(" SELECT o.dk,o.kv,o.dat_a,o.dk,o.ref,o.nd,
  o.mfoa,o.nlsa,o.mfob,o.nlsb,o.s/100,
  gl.p_icurval(o.kv, o.s, :sdat  )/100, t.name
FROM  arc_rrp O,  tabval T
INTO  :GRK,:KV,:PDAT,:DK,:REF,:ND,:MFOA,:NLSA,:MFOB,:NLSB,:S,:SQ,:NAMV 
WHERE  o.sos=5 and  o.mfoa <> o.mfob and
     o.mfob = " || AMFO || " and  t.kv=o.kv and date(o.dat_b) = :sdat                   
ORDER BY o.dk, o.mfoa, o.s ") !!CB!! 174
Else If para = 5 or para = 3 ! ГРН-док исп/ВСЕ введенніе
		                             ! вручную не касса
	Set SHAP = SHAP || IifS(para=5, ':' || IDNAME, '')
	Set ss = T("
			    SELECT o.userid,o.ref,o.nd,o.nlsa,o.mfob,o.nlsb,o.s/100
			    FROM oper O, tts S
			    INTO :UD,:REF,:ND,:NLSA,:MFOB,:NLSB,:S
			    WHERE o.tt=s.tt " || IifS(para=5, "
			          and o.userid=:ID", "") || " and o.kv=:nKV and
			          o.vdat= :sdat and substr(s.flags,1,1)=1 and
			          s.flv=0 and o.sk is null and o.sos=5
			    ORDER BY 1,2")
               
.head 4 +  Else If para = 5 or para = 3 ! ГРН-док исп/ВСЕ введенніе
                             ! вручную не касса
.head 5 -  Set SHAP = SHAP || IifS(para=5, ':' || IDNAME, '')
.head 5 -  Set ss = T("
    SELECT o.userid,o.ref,o.nd,o.nlsa,o.mfob,o.nlsb,o.s/100
    FROM oper O, tts S
    INTO :UD,:REF,:ND,:NLSA,:MFOB,:NLSB,:S
    WHERE o.tt=s.tt " || IifS(para=5, "
          and o.userid=:ID", "") || " and o.kv=:nKV and
          o.vdat= :sdat and substr(s.flags,1,1)=1 and
          s.flv=0 and o.sk is null and o.sos=5
    ORDER BY 1,2")

.head 4 +  Else If para = 6 ! форвард F
.head 5 -  Set ss = T("
    SELECT o.vdat,o.kv,o.tt,o.pdat,o.userid,o.dk,o.ref,o.nd,
           o.mfoa,o.nlsa,o.mfob,o.nlsb,o.s/100,
           gl.p_icurval(o.kv,o.s, :sdat )/100,t.name
    FROM oper O, tabval T
    INTO :VDAT,:KV,:TT,:PDAT,:UD,:DK,:REF,:ND,:MFOA,:NLSA,
         :MFOB,:NLSB,:S,:SQ,:NAMV
    WHERE o.sos=3 and t.kv=o.kv and o.tt <>'K2A' and
          o.pdat<= :sdat
    ORDER BY 1,2,3,4,5,6")
.head 4 +  Else If para = 7 ! межбанковские заблокированые
.head 5 -  Set ss = T("
    SELECT o.kv,o.tt,o.pdat,a.blk,o.dk,o.ref,o.nd,o.mfoa,
           o.nlsa,o.mfob,o.nlsb,o.s/100,
           gl.p_icurval(o.kv,o.s, :sdat )/100,t.name,
           o.userid
    FROM oper O, tabval T, arc_rrp a
    INTO :KV,:TT,:PDAT,:UD,:DK,:REF,:ND,:MFOA,:NLSA,:MFOB,
         :NLSB,:S,:SQ,:NAMV,:UU
    WHERE o.sos=5 and o.mfoa<>o.mfob and a.ref=o.ref and
          a.blk>0 and o.mfoa=" || AMFO || " and
          t.kv=o.kv and date(o.vdat)<= :sdat
          ORDER BY o.kv,o.pdat,o.userid,o.dk,o.mfob")
.head 4 -  ! - - - -  - 71 отчет В КАТАЛОГИЗИРОВАННЫХ на CKTR (ANNY)
.head 4 +  ! Else If para = 71 ! межбанковские Висящие на транзитах
.head 5 -  ! Set name = 1 Начальные незаквитованные
.head 5 -  ! Set name = 2 Начальные неотобранные
.head 5 -  ! Set name = 3 Ответные заблокированные
.head 5 -  ! Set name = 4 Возврат контролера (ждет оплаты бухг.)
.head 5 -          Set ss = "
    SELECT 1,dk,mfoa,nlsa,blk,ref,nd,mfob,nlsb,s/100,DAT_A
    INTO :GRK,:DK,:MFOA,:NLSA,:UD,:REF,:ND,:MFOB,:NLSB,:S,
         :PDAT
    FROM arc_rrp  
    WHERE mfoa= " || AMFO || " and 
          fn_b in (select fn from zag_b
                   where otm<5 and 
                   (nvl(blk,0) >0 or (nvl(blk,0)=0 and sos=3)))
    UNION ALL
    SELECT 2,dk,mfoa,nlsa,blk,ref,nd,mfob,nlsb,s/100,DAT_A
    FROM arc_rrp
    WHERE mfoa= " || AMFO || " and fn_b is null and
          ((nvl(blk,0)=0 and sos=3) or nvl(blk,0)>0)
    UNION ALL
    SELECT 3,dk,mfoa,nlsa,blk,ref,nd,mfob,nlsb,s/100,DAT_A
    FROM arc_rrp
    WHERE mfob= " || AMFO || "  and 
          mfoa!= " || AMFO || " and 
          (nvl(blk,0)>0 or (nvl(blk,0)=0 and sos=3))
    UNION ALL
    SELECT 4,dk,mfoa,nlsa,blk,ref,nd,mfob,nlsb,s/100,DAT_A
    FROM arc_rrp
    WHERE rec in (select rec_in
                  from bp_back
                  where rec_out is null)
    ORDER BY 1,2,3,4"
.head 4 +  Else If para = 72 ! Реестр автопроводок за день
.head 5 -  Set ss = T("
    SELECT p.tt,p.ref,p.s,decode (p.tt,o.tt,o.MFOA,''),
           decode(p.tt,o.tt,nvl(o.NLSA,p.NLSD),p.NLSD),
           decode(p.tt,o.tt,o.MFOB,''),
           decode(p.tt,o.tt,nvl(o.NLSB,p.NLSK),p.NLSK)
    INTO :TT,:REF,:S,:MFOA,:NLSA,:MFOB,:NLSB
    FROM oper o, tts t, (select distinct d1.TT tt, d1.REF ref,
                                d2.NLS nlsd,
                                least(d1.S,k1.S)/100 s,
                                d1.FDAT fdat, k2.NLS nlsk
                         from opldok d1, opldok k1,
                              accounts d2, accounts k2
                         where d1.sos=5 and d1.dk=0 and
                               d1.fdat= :sdat  and
                               d1.acc=d2.acc and
                               k1.sos=5 and k1.dk=1 and
                               k1.fdat= :sdat  and
                               k1.acc=k2.acc and
                               d1.fdat=k1.fdat and
                               d1.ref=k1.ref and
                               d1.tt=k1.tt and
                               d2.kv=k2.kv) p
     WHERE t.tt=p.tt and substr(t.flags,1,1)<>'1' and
           p.ref=o.ref   
     ORDER BY  p.tt,
                 decode (p.tt,o.tt,o.MFOA,''),
                 substr(decode(p.tt,o.tt,nvl(o.NLSA,p.NLSD),p.NLSD),1,4),
                 substr(decode(p.tt,o.tt,nvl(o.NLSA,p.NLSD),p.NLSD),6,9),
                 decode(p.tt,o.tt,o.MFOB,''),    
                 substr(decode(p.tt,o.tt,nvl(o.NLSB,p.NLSK),p.NLSK),1,4),
                 substr(decode(p.tt,o.tt,nvl(o.NLSB,p.NLSK),p.NLSK),6,9)")
.head 4 +  Else If para = 73  ! Реестр документов полученных и оплаченных  
                   ! по системе КЛИЕНТ-БАНК за день (ДНЕПР)
.head 5 -  ! TT = SAB, MFOA = NMK
.head 5 -  Set ss = T("
    SELECT o.nd,o.nlsa,o.mfob,o.nlsb,o.s/100,c.sab,c.nmk
    INTO :ND,:NLSA,:MFOB,:NLSB,:S,:TT,:MFOA
    FROM oper o, arc_rrp r, accounts a, customer c,
         cust_acc u
    WHERE o.vdat= :sdat  and o.sos=5 and o.tt='R00' and
          o.ref=r.ref and r.sos>3 and
          r.ref_a is not null and a.nls=o.nlsa and
          a.kv=:nKV and a.acc=u.acc and u.rnk=c.rnk
    ORDER BY 6,2,5")
.head 5 -  ! Set ss = T("
    SELECT nd,nlsa,mfob,nlsb,s/100,sab,nmk
    INTO :ND,:NLSA,:MFOB,:NLSB,:S,:TT,:MFOA
    FROM temp_pdp    
    ORDER BY 6,2,5")
.head 4 -  ! - - - -  - 74 отчет В КАТАЛОГИЗИРОВАННЫХ на IGR (ANNY)
.head 4 +  ! Else If para = 74  ! Реестр документов полученных и оплаченных
                   ! по системе КЛИЕНТ-БАНК
.head 5 -  ! TT = SAB, MFOA = NMK
.head 5 -          Set ss = T("
    SELECT o.nd,o.nlsa,o.mfob,o.nlsb,o.s/100,c.sab,c.nmk
    INTO :ND,:NLSA,:MFOB,:NLSB,:S,:TT,:MFOA
    FROM oper o, accounts a, customer c, cust_acc u
    WHERE o.vdat= :sdat  and o.sos=5 and (o.tt='KL1' or o.tt='KL2') and
          a.nls=o.nlsa and a.kv=:nKV and a.acc=u.acc and u.rnk=c.rnk
    ORDER BY 6,2,5")
.head 5 -  ! Set ss = T("
    SELECT nd,nlsa,mfob,nlsb,s/100,sab,nmk
    INTO :ND,:NLSA,:MFOB,:NLSB,:S,:TT,:MFOA
    FROM temp_pdp    
    ORDER BY 6,2,5")
.head 4 +  ! Else If para=8   ! межб поверненi казначейством щеНЕ подтвержд бухг
.head 5 -                   Set ss = T(" SELECT  o.kv, o.tt, o.pdat, a.blk,o.dk,
      o.ref, o.nd,o.mfoa,o.nlsa,o.mfob,  o.nlsb,
      o.s/100, gl.p_icurval(o.kv, o.s, :sdat  )/100, t.name,o.userid
FROM  oper O,  tabval T, arc_rrp a 
INTO :KV,:TT,:PDAT,:UD,:DK,:REF,:ND,:MFOA,:NLSA,:MFOB,:NLSB,:S,:SQ,:NAMV,:UU 
WHERE  o.sos=5 and   o.mfoa <> o.mfob and  a.ref =o.ref and a.blk < 0 and 
        o.mfoa = " || AMFO || " and  t.kv=o.kv and  date(o.vdat) =  :sdat                     
ORDER BY  o.kv, o.pdat, o.userid,o.dk, o.mfob ")
.head 4 +  Else If para = 81 ! По образцу о Маршавиной
.head 5 -  Set maska = Maska_NLS("счетов")
.head 5 +  If maska='-'
.head 6 -  Call SalDestroyWindow( hWndForm )
.head 6 -  Return FALSE
.head 5 -  Set ss = T("
    SELECT substr(s.nls,1,4),p.userid,o.ref,o.tt,o.fdat,
           s.kv,s.nls,p.nd,(1-o.dk)*o.s/100,o.dk*o.s/100,
           (1-o.dk)*gl.p_icurval(s.kv,o.s,o.fdat)/100,
           o.dk*gl.p_icurval(s.kv,o.s,o.fdat)/100
    FROM opldok o, sal s, oper p
    INTO :MFOA,:UD,:REF,:TT,:PDAT,:KV,:NLSA,:ND,:S,:DK,:SQ,
         :GRK
    WHERE o.ref=p.ref and o.sos=5 and o.acc=s.acc and
          s.fdat=o.fdat and s.fdat= :sdat  and
          ltrim(rtrim(s.nls)) LIKE \'" ||
          SalStrTrimX(maska) || "\'
    ORDER BY s.fdat,s.kv,s.nls,o.dk,o.s")
.head 4 +  Else If para = 82 ! Реестр опер. K2C - K2D для Черкасс
.head 5 -  Set strTitle2 = 'період з ' || strDateFrom || ' по ' || strDateTo
.head 5 -  Set ss = T("
    SELECT ref,tt,nd,vdat,kv,decode(dk,1,mfoa,mfob),
           decode(dk,1,nlsa,nlsb),decode(dk,1,mfob,mfoa),
           decode(dk,1,nlsb,nlsa),s
    INTO :REF,:TT,:ND,:PDAT,:KV,:MFOA,:NLSA,:MFOB,:NLSB,:S
    FROM oper
    WHERE sos=5 and tt in ('K2C','K2D') and vdat>= :sdat  and
          vdat <= :sdat2
    ORDER BY vdat,tt,kv,mfoa,substr(nlsa,1,4),
             substr(nlsa,6,9),mfob,substr(nlsb,1,4),
             substr(nlsb,6,9)")
.head 5 -  ! Set ss = T("
    SELECT ref, tt, nd, vdat, kv,
                     decode(dk,1,mfoa,mfob),
                     decode (dk,1,nlsa,nlsb),
                     decode(dk,1,mfob,mfoa),
                     decode (dk,1,nlsb,nlsa), s  
    INTO :REF, :TT, :ND, :PDAT, :KV,
                :MFOA, :NLSA,
                :MFOB, :NLSB,  :S 
   FROM  oper   
  WHERE sos=5 and
                 tt in ('015','001') and  
                vdat >= :sdat  and  vdat <= :sdat2   
         ORDER BY   vdat, tt,  kv, mfoa, 
                                  substr(nlsa,1,4),substr(nlsa,6,9),
                                  mfob, substr(nlsb,1,4), substr(nlsb,6,9) ")
.head 4 +  Else If para = 9 ! межб поверненi казначейством подтвержд бухг
.head 5 -  Set ss = T("
    SELECT o.kv,o.tt,o.pdat,a.blk,o.dk,o.ref,o.nd,o.mfoa,
           o.nlsa,o.mfob,o.nlsb,o.s/100,
           gl.p_icurval(o.kv,o.s, :sdat )/100,t.name,
           o.userid
    FROM oper O, tabval T, arc_rrp a
    INTO :KV,:TT,:PDAT,:UD,:DK,:REF,:ND,:MFOA,:NLSA,:MFOB,
         :NLSB,:S,:SQ,:NAMV,:UU
    WHERE o.sos=-1 and o.mfoa<>o.mfob and a.ref=o.ref and
          a.blk<0 and o.mfoa=" || AMFO || " and
          t.kv=o.kv and date(o.vdat)= :sdat
    ORDER BY o.kv,o.pdat,o.userid,o.dk,o.mfob")
.head 4 -  ! по Пользователю
.head 4 +  Else If para=51  ! Внутренние нац вал оплаченные сегодня
.head 5 -  Set SHAP = SHAP || ':'  || IDNAME
.head 5 -  Set ss = T("
SELECT decode(substr(nlsa,1,1),8,8,
       decode(substr(nlsa,1,1),9,9,0)),
       dk,tt,ref,nd,nlsa,nlsb,s/100,nazn,vdat
FROM  oper 
INTO :GRK,:DK,:TT,:REF,:ND,:NLSA,:NLSB,:S,:MFOA,:PDAT
WHERE '100' not in (substr(nlsa,1,3),substr(nlsb,1,3))  AND 
       kv=kv2 AND kv=:nKV AND userid = :ID AND sos=5  AND 
       mfoa=mfob AND vdat =  :sdat                      
ORDER BY 1, s ")
.head 4 +  Else If para=52  ! ВНЕШНИЕ нац вал оплаченные сегодня
.head 5 -  Set SHAP = SHAP || ':'  || IDNAME
.head 5 -  Set ss = T("  SELECT dk,  tt,  ref,     nd,   nlsa,   mfob,  nlsb,   s/100,  nazn, vdat
FROM  oper  INTO :DK, :TT, :REF, :ND, :NLSA, :MFOB, :NLSB,:S,  :MFOA, :PDAT
WHERE  kv=kv2 AND kv=:nKV AND userid = :ID AND sos=5  AND 
    mfoa=:TT1 AND mfoa<>mfob AND vdat =  :sdat                      
ORDER BY   s ")
.head 4 +  Else If para=53  ! ВАЛ оплаченные сегодня
.head 5 -  Set SHAP = SHAP || ':'  || IDNAME
.head 5 -  Set ss = T("
SELECT kv,kv2, dk,  tt,  ref,     nd,   nlsa,     nlsb,   s/100, s2/100,  nazn, vdat
FROM  oper  INTO :KV, :GRK, :DK, :TT, :REF, :ND, :NLSA, :NLSB,:S, :SQ,   :MFOA, :PDAT
WHERE  (kv<>:nKV OR kv2<>:nKV) AND userid=:ID AND sos=5  AND vdat =  :sdat                      
ORDER BY kv,s ")
.head 4 -  ! Все по АБС
.head 4 +  Else If para=777 ! Все внутр оплаченные сегодня
.head 5 -  Set ss = T("
SELECT decode(substr(nlsa,1,1),8,8,
       decode(substr(nlsa,1,1),9,9,0)),
       userid,dk,tt,ref,nd,nlsa,nlsb,s/100,nazn,vdat
FROM  oper 
INTO :GRK,:UD,:DK,:TT,:REF,:ND,:NLSA,:NLSB,:S,:MFOA,:PDAT
WHERE 
     sos=5 AND mfoa=mfob AND vdat =  :sdat                      
ORDER BY 1,s ")
.head 4 +  Else If para=510 ! Внутренние нац вал оплаченные сегодня
.head 5 -  Set ss = T("
SELECT decode(substr(nlsa,1,1),8,8,
       decode(substr(nlsa,1,1),9,9,0)),
       userid,dk,tt,ref,nd,nlsa,nlsb,s/100,nazn,vdat
FROM  oper 
INTO :GRK,:UD,:DK,:TT,:REF,:ND,:NLSA,:NLSB,:S,:MFOA,:PDAT
WHERE '100' not in (substr(nlsa,1,3),substr(nlsb,1,3))  AND 
    kv=kv2 AND kv=:nKV AND sos=5 AND mfoa=mfob AND vdat =  :sdat                      
ORDER BY 1,s ")
.head 4 +  Else If para=520 ! ВНЕШНИЕ нац вал оплаченные сегодня
.head 5 -  Set ss = T("  SELECT userid, dk,  tt,  ref,     nd,   nlsa,  mfob,   nlsb,   s/100, nazn, vdat
FROM  oper  INTO :UD, :DK, :TT, :REF, :ND, :NLSA, :MFOB, :NLSB,:S,    :MFOA , :PDAT
WHERE  kv=kv2 AND kv=:nKV AND sos=5  AND mfoa<>mfob AND 
    mfoa=:TT1 AND vdat =  :sdat                      
ORDER BY  s ")
.head 4 +  Else If para=522 ! Ведомость автом.перекрытия счетов(Kазнач-во)
.head 5 -  Set ss = T(" 
      SELECT o.ref, o.tt, o.vdat, o.nd, o.s/100,
                    o.mfoa, o.nlsa, o.mfob, o.nlsb
     FROM  oper o, accounts a
     INTO :REF, :TT, :PDAT, :ND, :S, :MFOA, :NLSA, :MFOB, :NLSB
     WHERE o.mfoa= :TT1   AND  o.mfoa=o.mfob  AND
                     a.nbs in ('3122','3112','3132') AND o.nlsa=a.nls AND
                     o.kv=o.kv2  AND  o.kv= :nKV  AND 
                     o.sos=5  AND o.vdat =  :sdat  AND       
                     o.ref in (SELECT ref FROM  opldok k
                                    WHERE a.acc=k.acc 
                                    GROUP BY ref HAVING count(*)=1)
       ORDER BY  decode(o.nlsb,'311240101',0,'312286106',1,'312296109',2,3),o.nlsb,o.s  ")
.head 4 +  Else If para=523 ! Реестр поступлений по общ.фонду(Kазнач-во)
.head 5 -  Set strTitle2 = 'період з ' || strDateFrom || ' по ' || strDateTo
.head 5 -  Set ss = T(" 
      SELECT   o.mfoa,  b.nb, sum(o.s)/100, o.vdat
      FROM  oper o, banks b   
      INTO   :MFOA, :NLSA, :S, :PDAT
      WHERE   o.mfoa= b.mfo  AND  o.vdat>= :sdat
              AND o.vdat<= :sdat2
              AND o.nlsb in ( select nls from K_3112  )                        
      GROUP BY  o.mfoa,  b.nb, o.vdat      
      ORDER BY  o.mfoa  ")
.head 5 -  ! Set ss = T(" 
      SELECT   o.mfoa,  b.nb, sum(o.s)/100, o.vdat
      FROM  oper o, banks b   
      INTO   :MFOA, :NLSA, :S, :PDAT
      WHERE   o.mfoa= b.mfo  AND  o.vdat =  :sdat
                        AND o.nlsb in ( select nls from K_3112  )                        
      GROUP BY  o.mfoa,  b.nb, o.vdat      
      ORDER BY  o.mfoa  ")
.head 4 +  Else If para=524 ! Реестр поступлений по 3717
.head 5 +  If SqlPrepareAndExecute( hSql(),
   T("SELECT  :sdat , to_char(  :sdat2  , 'dd-mm-yyyy')
    INTO  :PDAT,:TT FROM dual"))
and SqlFetchNext(  hSql(), KV )
.head 6 -  Set ss = T(
"SELECT o.mfoa,b.nb,o.nlsb,sum(o.s)/100
 FROM  oper o, banks b   
 INTO   :MFOA, :NLSA, :NLSB, :S
 WHERE o.sos=5 AND o.mfoa= b.mfo  AND  substr(o.nlsb,1,4)='3717'  AND
       o.vdat >=  :sdat  AND o.vdat<=  :sdat2  
 GROUP BY  o.mfoa, b.nb, o.nlsb
 ORDER BY  o.mfoa, o.nlsb ")
.head 4 -  ! -- оьтчет 525 перенесла в каталогизированн. 20.05.2002 Anny
.head 4 +  ! Else If para=525 ! Надходження коштів від Держмиткому(ГУДКУ)(Inna)
.head 5 -          Set strBind = 'NLSA,TT,REF,NAM,S,SQ,UU,UD'  ! наши переменные
.head 5 -          Set strInput = strBind
.head 5 -          Set ss = T("
SELECT a.nls, m.id, m.iid, m.name,
sum(decode(o.dk,1,decode(o.fdat, :sdat ,o.s,0),0)),
sum(decode(o.dk,1,decode(trunc(o.fdat,'MM'),trunc( :sdat ,'MM'),o.s,0),0)),
sum(decode(o.dk,1,o.s,0)), sum(decode(o.dk,1,0,o.s))
FROM accounts a, mytkom m, opldok o, specparam s
INTO  :NLSA, :TT, :REF, :NAM, :S, :SQ, :UU, :UD
WHERE a.nbs=3111 and a.acc=s.acc and
      s.s230=m.id and o.acc=s.acc and
      o.sos=5 and o.fdat <= :sdat  and o.fdat >= '23-JUL-2001'
GROUP BY a.nls, m.id, m.iid, m.name
ORDER BY  m.id,a.nls ")
.head 4 +  Else If para=526 ! Реестр поступлений по спец.фонду (ГУДКУ)(Inna)
.head 5 -  Set strTitle2 = 'період з ' || strDateFrom || ' по ' || strDateTo
.head 5 -  Set ss = T("
  SELECT o.mfoa,b.nb,sum(o.s)/100,o.vdat
  FROM oper o, banks b
  INTO :MFOA,:NLSA,:S,:PDAT
  WHERE  o.mfoa= b.mfo AND 
        (o.vdat BETWEEN   :sdat   AND   :sdat2   )   AND
          o.nlsb IN (SELECT a.nls FROM accounts a, fonds f
                     WHERE a.nbs=3122 AND 
                           f.kod=2    AND 
                           substr(a.nls,6,3)=f.s230)
  GROUP BY  o.mfoa,  b.nb, o.vdat
  ORDER BY  o.mfoa  ")
.head 4 +  Else If para=527 ! Реестр поступлений по "позичкам" (ГУДКУ)(Inna)
.head 5 -  Set strTitle2 = 'період з ' || strDateFrom || ' по ' || strDateTo
.head 5 -  Set ss = T("
  SELECT   o.mfoa,  b.nb, sum(o.s)/100, o.vdat
  FROM  oper o, banks b
  INTO   :MFOA, :NLSA, :S, :PDAT
  WHERE o.mfoa=b.mfo AND 
       (o.vdat BETWEEN   :sdat   AND   :sdat2  )  AND
        o.nlsb in  (SELECT a.nls FROM accounts a, fonds f
                    WHERE  a.nbs IN (3123,3122)  AND
                           f.kod=3    AND
                           substr(a.nls,6,3)=f.s230)
  GROUP BY  o.mfoa,  b.nb, o.vdat
  ORDER BY  o.mfoa  ")
.head 4 +  Else If para=530 ! ВАЛ оплаченные сегодня
.head 5 -  Set ss = T(" 
       SELECT userid, kv, kv2, dk, tt, ref, nd,
                        nlsa, nlsb, s/100, s2/100, nazn, vdat
       FROM  oper 
       INTO :UD, :KV, :GRK, :DK, :TT, :REF, :ND,
                :NLSA, :NLSB,:S, :SQ,  :MFOA , :PDAT
WHERE  (kv<>:nKV OR kv2<>:nKV) AND  sos=5  AND  vdat =  :sdat                      
ORDER BY userid, kv, s ")
.head 4 -  ! по Подразделению
.head 4 +  Else If (para=511 or para=521 or para=531) 
     and SqlPrepareAndExecute( hSql(),
         "SELECT o.id,o.name INTO :UU,:tex1 
          FROM otd_user u, otdel o 
          WHERE u.userid=:ID AND o.id=u.otd" )
     and SqlFetchNext(  hSql(), KV )
.head 5 -  Set SHAP = SHAP || ':'  || tex1
.head 5 +  If para=511 ! Внутренние нац вал оплаченные сегодня 
.head 6 -  Set ss = T("
SELECT decode(substr(nlsa,1,1),8,8,
       decode(substr(nlsa,1,1),9,9,0)),
       o.userid,o.dk,o.tt,ref,o.nd,o.nlsa,o.nlsb,o.s/100,o.nazn,o.vdat
FROM  oper o, otd_user u
INTO :GRK,:UD,:DK,:TT,:REF,:ND,:NLSA,:NLSB,:S,:MFOA,:PDAT
WHERE o.sos=5 AND u.userid=o.userid AND u.otd=:UU AND
     '100' not in (substr(o.nlsa,1,3),substr(o.nlsb,1,3))  AND 
     o.kv=o.kv2 AND o.kv=:nKV AND o.mfoa=o.mfob AND o.vdat=  :sdat                      
ORDER BY 1, 2, o.s")
.head 5 +  Else If para=521 ! ВНЕШНИЕ нац вал оплаченные сегодня 
.head 6 -  Set ss = T("
SELECT o.userid,o.dk,o.tt,o.ref,o.nd,o.nlsa,o.mfob,o.nlsb,o.s/100,o.nazn,o.vdat
FROM oper o,otd_user u 
INTO :UD,:DK,:TT,:REF,:ND,:NLSA,:MFOB,:NLSB,:S,:MFOA,:PDAT
WHERE o.sos=5 AND u.userid=o.userid AND u.otd=:UU AND o.mfoa=:TT1 AND 
    o.kv=o.kv2 AND o.kv=:nKV AND o.mfoa<>o.mfob AND o.vdat=  :sdat                      
ORDER BY o.s")
.head 5 +  Else If para=531 ! ВАЛ оплаченные сегодня 
.head 6 -  Set ss = T("
SELECT o.userid,o.kv,o.kv2,o.dk,o.tt,o.ref,o.nd,o.nlsa,o.nlsb,
       o.s/100,o.s2/100,o.nazn,o.vdat
FROM  oper o,otd_user u 
INTO :UD,:KV,:GRK,:DK,:TT,:REF,:ND,:NLSA,:NLSB,:S,:SQ,:MFOA,:PDAT
WHERE u.userid=o.userid AND u.otd=:UU AND 
      (kv<>:nKV OR kv2<>:nKV) AND o.sos=5 AND o.vdat=  :sdat                      
ORDER BY o.kv,o.s ")
.head 4 +  Else If para=540 ! ВАЛ кассовые журналы
.head 5 -  Set maska=Maska_NLS("счета")
.head 5 +  If maska = '-'
.head 6 -  Call SalDestroyWindow(hWndForm)
.head 6 -  Return TRUE
.head 5 -  Set ss = T("
 SELECT p.userid,o.fdat,p.nd,o.dk,o.ref,o.tt,o.s/100,t.lcv||' '||t.name, 
    decode( p.nlsa||a.kv, a.nls||a.kv, p.nlsb, p.nlsa )+0, a.nls,a.nms,
    decode(p.tt,o.tt,p.nazn,tts.name),(1-o.dk)*o.s/100,o.dk*o.s/100
 INTO :UD,:PDAT,:ND,:DK,:REF,:TT,:S,:MFOB,
      :KV,:NLSA,:MFOA,:NLSB,:SQ,:GRK
FROM  opldok o, sal a, tabval t , oper p, tts 
WHERE substr(a.nbs,1,3)='100' AND a.nls LIKE '" || maska || "'   AND  
a.kv<>:nKV AND  o.sos=5  AND  p.ref=o.ref AND 
  tts.tt=p.tt AND o.fdat =  :sdat    AND a.fdat=o.fdat AND o.acc=a.acc AND a.kv=t.kv
ORDER BY a.kv,a.nls,o.dk,o.s ")
.head 4 +  Else If para=20  ! РЕЕСТР ПРОВОДОК задень для ПИКРИИ
.head 5 -  Set ss="
SELECT p.dk, 
       p.ref, 
       p.nls,
       substr('0000000'||g.nls,-9,9),
       t.lcv, 
       p.s/100, 
       gl.p_icurval(p.kv,p.s,p.fdat)/100,
       substr(p.nazn,1,20) ,p.tt
INTO  :DK,:REF,:NLSB,:NLS2,:TT, :S, :SQ, :NAM, :TT1
FROM opl p, tabval t, geo_tab g
WHERE p.sos=5     and 
      p.acc=g.acc and 
      p.kv=t.kv   and 
      DATE(fdat) = :sdat         
 
UNION ALL
SELECT 1,
       to_NUMBER(NULL),
       to_CHAR(NULL),
       substr('0000000'||g.nls,-9,9),
       t.lcv, 
       to_NUMBER(NULL),
       (gl.p_icurval(s.kv,s.ost+s.dos-s.kos,s.fdat)-
        gl.p_icurval(s.kv,s.ost+s.dos-s.kos,s.fdat-1))/100,'' ,''
FROM sal s,tabval t,geo_tab g
WHERE s.acc=g.acc AND 
      s.kv=t.kv   AND
      date(fdat) = :sdat AND s.kv<>"||Str(GetBaseVal()) ||"
ORDER BY 2,9,5,6,1"
.head 5 -  Set ss=T(ss)
.head 5 -  Set strBind='REF,NLSA,NLSB,NLS1,NLS2,TT,S,SQ,NAM'  !! наши переменные
.head 5 -  Set strInput=strBind
.head 4 +  Else
.head 5 -  Set SHAP = ''
.head 4 -  Call SalHideWindow(hWndForm)
.head 4 -  ! ==================================================
.head 4 -  ! Начинаем печать в отчет
.head 4 -  ! ==================================================
.head 4 -  Call SalReportPrintToFile(hWndForm, 
                                                        strTmplPath, 
                                                        strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                                        strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 +  If (nInd > 4 )
.head 5 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 4 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 4 -  Set frm_Out.dfPath = strPrintPath
.head 4 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)

.head 4 -  Call SalDestroyWindow(hWndForm)
.head 3 +  On SAM_ReportStart             !! приготовить SELECT
.head 4 -  Return SqlPrepare(hSql(), ss)
.head 3 +  On SAM_ReportFetchInit   
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext  !! вычитать очередную строку
.head 4 +  If para=20
.head 5 +  While SqlFetchNext(hSql(), nFetchRes)
.head 6 +  If SQ !=0
.head 7 +  If DK=0
.head 8 -  Set NLSA=NLSB
.head 8 -  Set NLS1=NLS2
.head 7 +  Else
.head 8 +  If S = NUMBER_Null 
.head 9 -  Set NLSA=STRING_Null
.head 9 -  Set NLSB=STRING_Null
.head 9 +  If SQ<0
.head 10 -  Set NLS1=NLS2
.head 10 -  Set NLS2='000019404'
.head 10 -  Set SQ=-SQ
.head 9 +  Else
.head 10 -  Set NLS1='000019404'
.head 8 -  Return TRUE
.head 5 -  Return FALSE
.head 4 +  Else
.head 5 +  If SqlFetchNext(hSql(), nFetchRes)
.head 6 +  If para=6
.head 7 -  Set GRK=SalDateYear(VDAT) * 10000 + 
                   SalDateMonth(VDAT) *100 + 
                   SalDateDay(VDAT)
.head 6 +  If para=4
.head 7 -  Set ND=StrDosToWinX(ND)
.head 6 +  If para=5 and TT != TT1
.head 7 -  Set GRK = GRK+1
.head 7 -  Set TT1 = TT
.head 6 -  Return TRUE
.head 5 +  Else
.head 6 -  Return FALSE
.head 3 +  On SAM_ReportNotify	!! информировать ОТЧЕТ о глобальных переменных 
.head 4 +  If lParam=RPT_BeforeReportHeader  !! только для заголовка 
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP',SHAP )
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'AMFO', AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'AQH', AQH)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP1', strTitle2)
.head 4 +  If lParam=RPT_BeforeBreakHeader1 and para <20
.head 5 -  Set rab=''
.head 5 +  If para<2
.head 6 -  Set rab=NAM
.head 5 +  ! Else If para=3 or para=4
.head 6 -                   Call SqlPrepareAndExecute( hSqlAux(), T("
SELECT name INTO :rab FROM dk where dk=:GRK "))
.head 6 -                   Call SqlFetchNext(hSqlAux(), nFetchRes) 
.head 5 +  Else If para=6
.head 6 -  Set rab=SalFmtFormatDateTime(VDAT, 'dd-MM-yyyy')
.head 5 +  Else If para=5
.head 6 -  Set rab= NAM
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'NAM',rab)
.head 4 +  If lParam=RPT_BeforeBreakHeader2 and para <20
                or para =577  !! KV
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'NAMV',NAMV)
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 1 +  Dialog Box: dlg_MonthAdd   !! Исп. в frm_Month
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Выбор исполнителя
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  10.4"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 5.595"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Child Table: tbl1 !! исполнители
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.333"
.head 6 -  Top:    0.238"
.head 6 -  Width:  9.65"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 4.5"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Dark Blue
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 3000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: Kod1
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.786"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NAME1
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: НАИМЕНОВАНИЕ
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  6.786"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  ! Column: sab1
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Адрес
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  7.283"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -                   List Values
.head 6 -                   Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_DoubleClick
.head 6 -  Call SalSendMsg( dlg_MonthAdd.PB1, SAM_Click, 0, 0 )
.head 3 +  Pushbutton: PB1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Печать выбранных
.head 4 -  Window Location and Size
.head 5 -  Left:   3.85"
.head 5 -  Top:    4.845"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Midnight Blue
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  Loop
.head 7 -  Set sExecList=''
.head 7 -  Set nRow=TBL_MinRow
.head 7 +  Loop
.head 8 +  If SalTblFindNextRow (  tbl1, nRow, ROW_Selected, 0 )
.head 9 -  Call SalTblSetContext( tbl1,nRow )
.head 9 +  If sExecList
.head 10 -  Set sExecList=sExecList || ', ' || SalNumberToStrX( tbl1.Kod1, 0 )
.head 9 +  Else
.head 10 -  Set sExecList=' AND ISP IN ( ' || SalNumberToStrX( tbl1.Kod1, 0 )
.head 8 +  Else
.head 9 -  Break
.head 7 +  If sExecList
.head 8 -  Set sExecList=sExecList || ') '
.head 7 +  Else
.head 8 -  Call SalMessageBox( 'Ничего не выбрано!', 'Ошибка', 0 )
.head 8 -  Break
.head 7 -  Call SalEndDialog( dlg_MonthAdd, 99 )
.head 7 -  Break
.head 3 +  Pushbutton: PB2
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Печать ВСЕХ
.head 4 -  Window Location and Size
.head 5 -  Left:   1.25"
.head 5 -  Top:    4.845"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Midnight Blue
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set sExecList=''
.head 6 -  Call SalEndDialog( dlg_MonthAdd, 99 )
.head 3 +  Pushbutton: PB3 !! завершить
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Завершить
.head 4 -  Window Location and Size
.head 5 -  Left:   6.45"
.head 5 -  Top:    4.845"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Black
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalEndDialog( dlg_MonthAdd, 0 )
.head 2 -  Functions
.head 2 -  Window Parameters
.head 2 +  Window Variables
.head 3 -  Number: nRow
.head 3 -  String: sExecList
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set sExecList=''
.head 4 -  Call SalTblPopulate( dlg_MonthAdd.tbl1, hSql(),
'SELECT id, fio INTO :tbl1.Kod1, :tbl1.NAME1 FROM staff WHERE type=1'
, TBL_FillAll )
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_Destroy
.head 4 -  Call WaitCursorOn()
.head 1 +  Table Window: tbl_idprn
.head 2 -  Class: cGenericTable
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Определение ESC-последовательностей для печатных отчетов
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? Class Default
.head 2 -  Visible? Class Default
.head 2 -  Display Settings
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Class Default
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Class Default
.head 3 -  Minimizable? Class Default
.head 3 -  System Menu? Class Default
.head 3 -  Resizable? Class Default
.head 3 -  Window Location and Size
.head 4 -  Left:   0.025"
.head 4 -  Top:    0.427"
.head 4 -  Width:  12.883"
.head 4 -  Width Editable? Class Default
.head 4 -  Height: 5.821"
.head 4 -  Height Editable? Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 3 -  View: Class Default
.head 3 -  Allow Row Sizing? Class Default
.head 3 -  Lines Per Row: Class Default
.head 2 -  Memory Settings
.head 3 -  Maximum Rows in Memory: Class Default
.head 3 -  Discardable? Class Default
.head 2 -  Description: Определение ESC-последовательностей для печатных
отчетов
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Class Default
.head 4 -  Location? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Size: Class Default
.head 4 -  Size Editable? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 3 +  Contents
.head 4 +  Pushbutton: pbIns
.head 5 -  Class Child Ref Key: 33
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDel
.head 5 -  Class Child Ref Key: 34
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbRefresh
.head 5 -  Class Child Ref Key: 35
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbUpdate
.head 5 -  Class Child Ref Key: 36
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 39380
.head 5 -  Class Child Ref Key: 37
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbSearch
.head 5 -  Class Child Ref Key: 38
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbFilter
.head 5 -  Class Child Ref Key: 44
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbDetails
.head 5 -  Class Child Ref Key: 39
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 +  Pushbutton: pbPrint
.head 5 -  Class Child Ref Key: 40
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 39381
.head 5 -  Class Child Ref Key: 41
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 4 +  Pushbutton: pbExit
.head 5 -  Class Child Ref Key: 42
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Property Template:
.head 5 -  Class DLL Name:
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   Class Default
.head 6 -  Top:    Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Keyboard Accelerator: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Picture File Name:
.head 5 -  Picture Transparent Color: Class Default
.head 5 -  Image Style: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Message Actions
.head 4 -  Line
.head 5 -  Resource Id: 39382
.head 5 -  Class Child Ref Key: 43
.head 5 -  Class ChildKey: 0
.head 5 -  Class: cGenericTable
.head 5 -  Coordinates
.head 6 -  Begin X:  Class Default
.head 6 -  Begin Y:  Class Default
.head 6 -  End X:  Class Default
.head 6 -  End Y:  Class Default
.head 5 -  Visible? Class Default
.head 5 -  Line Style: Class Default
.head 5 -  Line Thickness: Class Default
.head 5 -  Line Color: Class Default
.head 2 +  Contents
.head 3 +  Column: col_id
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Код
отчета
.head 4 -  Visible? Yes
.head 4 -  Editable? Yes
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: Number
.head 4 -  Justify: Right
.head 4 -  Width:  0.7"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Drop Down List
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalListPopulate(hWndItem, hSqlAux2(), T('
     SELECT id
     FROM reports'))
.head 3 +  Column: col_printer
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Тип принтера
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  1.317"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: col_12
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Разделение
листов
.head 4 -  Visible? Yes
.head 4 -  Editable? Yes
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  1.117"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Check Box
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value: 1
.head 6 -  Uncheck Value: 0
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: col_escline
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: ESC-последовательность
.head 4 -  Visible? Yes
.head 4 -  Editable? Yes
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  9.283"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: col_rowid
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Rowid
.head 4 -  Visible? No
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  Default
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 2 -  Functions
.head 2 -  Window Parameters
.head 2 +  Window Variables
.head 3 -  String: sDriver
.head 3 -  String: sPort
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  ! Set nFlags = GT_NoRet
.head 4 -  Call SalCenterWindow(hWndForm)
.head 4 -  Call SalDisableWindow(pbSearch)
.head 4 -  Call SalDisableWindow(pbDetails)
.head 4 -  Call SalDisableWindow(pbPrint)
.head 4 -  Set strSqlPopulate = T('
    SELECT id,dvc,cse,chr12,rowid
    INTO :col_id,:col_printer,:col_escline,:col_12,:col_rowid
    FROM reprint
    ORDER BY id,dvc')
.head 4 -  Set strSqlUpdate = T('
    UPDATE reprint
    SET cse=:col_escline,id=:col_id,chr12=:col_12
    WHERE rowid=:col_rowid')
.head 4 -  Set strSqlInsert = T('
    INSERT
    INTO reprint (id,dvc,cse,chr12)
    VALUES (:col_id,:col_printer,:col_escline,:col_12)')
.head 4 -  Set strSqlDelete = T('
    DELETE
    FROM reprint
    WHERE id=:col_id and dvc=:col_printer')
.head 4 -  Call SalSendClassMessage(SAM_Create, wParam, lParam)
.head 4 -  ! Call VisTblAutoSizeColumn(hWndForm, hWndNULL)
.head 3 +  On UM_Insert
.head 4 -  Call SalSendClassMessage(UM_Insert, 0, 0)
.head 4 -  Call SalPrtGetDefault(tbl_idprn.col_printer, sDriver, sPort)
.head 3 +  On SAM_Destroy
.head 4 +  If SalStrTrimX(SalStrUpperX(GetDBMS())) = 'ORACLE'
.head 5 -  Call XRoleUnset(hSql(), 'SetESC(hWndMDI)')
.head 1 +  Form Window: frm_Repbot
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title:
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Yes
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  10.971"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 5.344"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 -  Functions
.head 2 -  Window Parameters
.head 2 -  Window Variables
.head 2 -  Message Actions
.head 1 +  Form Window: frm_Balans    !! Баланс по валютам 32 номинал
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Баланс банка
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  10.0"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 5.5"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Баланс
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Child Table: tbl1 !! исполнители или валюты
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.067"
.head 6 -  Top:    0.048"
.head 6 -  Width:  9.667"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 4.5"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Dark Blue
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 3000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: Kod1
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.567"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NAME1
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: НАИМЕНОВАНИЕ
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  7.283"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalTblPopulate(tbl1,hSql(), T("
     SELECT kv,name
     FROM tabval
     WHERE kv IN (select kv from accounts)
     ORDER BY 1"), TBL_FillAll)
.head 5 +  On SAM_DoubleClick
.head 6 -  Call FU_SAL()
.head 6 -  Call SalSetFocus(tbl1)
.head 5 +  On SAM_User
.head 6 -  Set nRow = TBL_MinRow
.head 6 +  While SalTblFindNextRow(tbl1, nRow, nTmp, 0)
.head 7 -  Call SalTblSetContext(tbl1, nRow)
.head 7 +  If nRow >= 0
.head 8 -  Call FU_SAL()
.head 6 -  Call SalSendMsg(tbl1, SAM_Create, 0, 0)
.head 3 +  Pushbutton: PB1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Печать выбранных
.head 4 -  Window Location and Size
.head 5 -  Left:   3.6"
.head 5 -  Top:    4.643"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Midnight Blue
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set nTmp=ROW_Selected
.head 6 -  Call SalSendMsg( tbl1, SAM_User, 0, 0 )
.head 3 +  Pushbutton: PB2
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Печать ВСЕХ
.head 4 -  Window Location and Size
.head 5 -  Left:   1.0"
.head 5 -  Top:    4.643"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Midnight Blue
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set nTmp = 0
.head 6 -  Call SalSendMsg( tbl1, SAM_User, 0, 0 )
.head 3 +  Pushbutton: PB3 !! завершить
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Завершить
.head 4 -  Window Location and Size
.head 5 -  Left:   6.2"
.head 5 -  Top:    4.643"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalDestroyWindow(frm_Balans)
.head 2 +  Functions
.head 3 +  Function: FU_SAL
.head 4 -  Description: Печать баланса по ОДНОМУ
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  ! ===Старый код======================================
.head 5 -  ! Set strFileName = SalStrLeftX(strFileName,
    SalStrScan(strFileName, '.')+1) ||
    SalNumberToStrX(tbl1.Kod1, 0)
.head 5 -  ! ===^Старый код=====================================


.head 5 -  Set KV = tbl1.Kod1
.head 5 -  ! ==================================================
.head 5 -  ! Начинаем печать в отчет
.head 5 -  ! ==================================================
.head 5 -  Call SalReportPrintToFile( hWndForm, 
                                                     strTmplPath, 
                                                     strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                                     strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 5 +  If (nInd > 4 )
.head 6 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 5 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 5 -  Set frm_Out.dfPath = strPrintPath
.head 5 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 5 -  ! ===Старый код======================================
.head 5 -  ! Call SalReportPrintToFile(hWndForm, strDir, GetPrnDir() ||
     '/' || IifS(FL_FORMAT, strFileName1, strFileName),
     strBind, strInput, 1, RPT_PrintAll, 1, 1, FL_FORMAT,
     nInd)
.head 5 +  ! If not FL_FORMAT
.head 6 -            Call zarez12(GetPrnDir() || '\\' || strFileName, frm_Out.tbl1.Kod,   frm_Out.tbl1.sDeviceDef)
.head 5 -  ! ===^Старый код=====================================


.head 5 +  If not FL_FORMAT
.head 6 -  Call zarez12(  strPrintPath ||'/'|| strFileNameTxt,  frm_Out.tblReps.Kod, sDeviceDef)
.head 5 -  Call SalWaitCursor(FALSE)
.head 2 +  Window Parameters
.head 3 -  String: sdat
.head 2 +  Window Variables
.head 3 -  Number: B1
.head 3 -  Number: KV
.head 3 -  Number: K
.head 3 -  Number: R
.head 3 -  Number: G
.head 3 -  String: NBS
.head 3 -  Number: DOS
.head 3 -  Number: KOS
.head 3 -  Number: OSTD
.head 3 -  Number: OSTK
.head 3 -  Number: nRow
.head 3 -  Number: nTmp
.head 3 -  String: sTmp
.head 3 -  !
.head 3 -  Number: PAGE
.head 3 -  Boolean: fNewClass
.head 3 -  !
.head 3 -  Number: nDig
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set strBind = 'B1,KV,K,R,G,NBS,DOS,KOS,OSTD,OSTK'
.head 4 -  Set strInput = strBind
.head 3 +  On SAM_ReportStart
.head 4 -  Set PAGE = 0
.head 4 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'RUK', GetGlobalOption('BOSS'))
.head 4 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'GLB', GetGlobalOption('ACCMAN'))
.head 4 -  Set sTmp = T("
    SELECT nbs,-SUM(decode(sign(ost),-1,ost,0))/100,
           SUM(decode(sign(ost), 1,ost,0))/100,SUM(dos)/100,
           SUM(kos)/100
    FROM sal
    INTO :NBS,:OSTD,:OSTK,:DOS,:KOS
    WHERE kv=:KV and fdat= :sdat
    GROUP BY nbs
    ORDER BY nbs")
.head 4 -  Call SqlPrepare(hSql(), sTmp)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Set K = SalStrToNumber(SalStrLeftX(NBS, 1))
.head 5 -  Set R = SalStrToNumber(SalStrLeftX(NBS, 2))
.head 5 -  Set G = SalStrToNumber(SalStrLeftX(NBS, 3))
.head 5 -  Set B1 = IifN(K<8, 1, IifN(K<9, 8, 9))
.head 5 -  ! проверка на 3 знака
.head 5 -  Call SqlPrepareAndExecute( hSqlAux(), "
SELECT dig INTO :nDig
FROM tabval
WHERE kv = :KV" )
.head 5 +  If not SqlFetchNext( hSqlAux(), nFetchRes )
.head 6 -  Return FALSE
.head 5 -  Set DOS  = DOS*SalNumberPower( 10,2-nDig )
.head 5 -  Set KOS  = KOS*SalNumberPower( 10,2-nDig )
.head 5 -  Set OSTD = OSTD*SalNumberPower( 10,2-nDig )
.head 5 -  Set OSTK = OSTK*SalNumberPower( 10,2-nDig )
.head 5 -  !
.head 5 -  Return TRUE
.head 4 +  Else
.head 5 -  Return FALSE
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam = RPT_BeforeBreakHeader1
.head 5 -  Set PAGE = 1
.head 5 -  Set fNewClass = TRUE
.head 5 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),
     'PAGE', PAGE)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'aMFO', AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'aQH', AQH)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'Report_date', strRepDate)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'SHAP', SHAP)
.head 5 -  !
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), "
     SELECT lcv || ' ' || name
     INTO :sTmp
     FROM tabval
     WHERE kv=:KV")
.head 5 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'NAMV', sTmp)
.head 5 -  Set sTmp = IifS(B1=1, 'Балансовий', IifS(B1=8,
    'Управлінський', 'Позабалансовий')) || ' облік'
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'ZAGO', sTmp)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'sR', GetUserRealName())
.head 5 -  !
.head 4 +  If lParam = RPT_DoneBreakHeader1
.head 5 -  Set fNewClass = FALSE
.head 4 +  If lParam = RPT_BeforePageHeader
.head 5 +  If not fNewClass
.head 6 -  Set PAGE = PAGE + 1
.head 6 -  Call SalReportSetNumberVar(
     SalNumberToWindowHandle(wParam), 'PAGE', PAGE)
.head 4 +  If lParam = RPT_BeforeBreakHeader2
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), T("
     SELECT name[1,70]
     INTO :sTmp
     FROM ps
     WHERE nbs+0=:K"))
.head 5 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'sK', sTmp)
.head 4 +  If lParam = RPT_BeforeBreakHeader3
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), T("
     SELECT name[1,70]
     INTO :sTmp
     FROM ps
     WHERE nbs+0=:R"))
.head 5 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'sR', sTmp)
.head 4 +  If lParam = RPT_BeforeBreakHeader4
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), T("
     SELECT name[1,70]
     INTO :sTmp
     FROM ps
     WHERE nbs+0=:G"))
.head 5 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'sG', sTmp)
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg(frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 1 +  Form Window: frm_BalansS   !! СВОДНЫЙ  Баланс   31 эквивалент
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Баланс банка
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  7.125"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.563"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: СВОДНЫЙ  Баланс
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: sDat
.head 3 -  Number: nRep
.head 2 +  Window Variables
.head 3 -  Number: n980
.head 3 -  Number: B1
.head 3 -  Number: K
.head 3 -  Number: R
.head 3 -  Number: G
.head 3 -  String: NBS
.head 3 -  String: NBSALT
.head 3 -  String: NBS_3929
.head 3 -  String: sDatMax
.head 3 -  String: sTmp
.head 3 -  String: sid
.head 3 -  String: ss
.head 3 -  Number: DOS
.head 3 -  Number: KOS
.head 3 -  Number: OSTD
.head 3 -  Number: OSTK
.head 3 -  Number: OSTVD
.head 3 -  Number: OSTVK
.head 3 -  Number: PAGE
.head 3 -  Date/Time: dRab
.head 3 -  Boolean: fNewClass
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call WaitCursorOn()
.head 4 -  Set n980 = GetBaseVal()
.head 4 -  If SqlPrepareAndExecute( hSqlAux(),
  "SELECT val Into :NBS_3929 FROM params WHERE par='NBS_3929'" ) 
and SqlFetchNext( hSqlAux(), nFetchRes)
.head 4 -  Set strBind = 'B1,K,R,G,NBS,DOS,KOS,OSTD,OSTK'
.head 4 -  ! !!! Для Казначейства со входящими остатками - Заменить B001S.qrp на B001SV.qrp
.head 4 +  If Left(GetBankMfo(),1) = '8'
.head 5 -  Set strBind =strBind || ',OSTVD,OSTVK'
.head 4 +  If GetBankMfo()='220101107' 
.head 5 -  Set strBind =strBind || ',NBSALT'
.head 4 -  Call SalHideWindow(hWndForm)
.head 4 -  ! ==================================================
.head 4 -  ! Начинаем печать в отчет
.head 4 -  ! ==================================================
.head 4 -  Call SalReportPrintToFile(hWndForm, 
                                                     strTmplPath, 
                                                     strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                                     strBind,strBind,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 +  If (nInd > 4 )
.head 5 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 4 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 4 -  Set frm_Out.dfPath = strPrintPath
.head 4 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 4 -  Call SalDestroyWindow(hWndForm)
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_ReportStart
.head 4 -  Set PAGE = 0
.head 4 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'RUK', GetGlobalOption('BOSS'))
.head 4 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'GLB', GetGlobalOption('ACCMAN'))
.head 4 -  Call SqlPrepareAndExecute(hSql(), "
     SELECT to_char(max(fdat),'mm-dd-yyyy')
     INTO :sDatMax
     FROM fdat")
.head 4 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 4 -  !
.head 4 +  If GetGlobalOption('SALDOB') = '1'
.head 5 +  If GetBankDate()=  SalFmtFormatStrDateTime(sDat,'MM-dd-yyyy')  ! Если тек день то делать
.head 6 -  Call CurBalanceReval()
.head 5 -  Set ss = "
    SELECT s.NBS,sum(s.dos),sum(s.kos),
           -sum(decode(sign(s.ost),-1,s.ost,0)),
           sum(decode(sign(s.ost), 1,s.ost,0))
    INTO :NBS,:DOS,:KOS,:OSTD,:OSTK
    FROM sal s
    WHERE s.kv=:n980 and s.fdat= :sDat  and
          (s.dos>0 or s.kos>0 or s.ost<>0)
    GROUP BY s.NBS
    UNION ALL
    SELECT s.NBS,sum(s.dos),sum(s.kos),
           -sum(decode(sign(s.ost),-1,s.ost,0)),
           sum(decode(sign(s.ost), 1,s.ost,0))
    FROM salB s
    WHERE s.kv<>:n980 and s.fdat= :sDat  and
          (s.dos>0 or s.kos>0 or s.ost<>0)
    GROUP BY s.NBS
    ORDER BY 1"
.head 4 +  Else If Left(GetBankMfo(),1) = '8'
.head 5 -  Set ss = "
 SELECT NBS,
         -sum(decode(sign(ost+dos-kos),-1, ost+dos-kos,0)),
          sum(decode(sign(ost+dos-kos), 1, ost+dos-kos,0)),
          sum(dos),
          sum(kos),
         -sum(decode(sign(ost),-1,ost,0)),
          sum(decode(sign(ost), 1, ost,0))
 INTO :NBS, :OSTVD,:OSTVK, :DOS,:KOS, :OSTD,:OSTK
 FROM sal
 WHERE fdat= :sDat  and (dos>0 or kos>0 or ost<>0) and nbs is not null
 GROUP BY NBS
UNION ALL
 SELECT a.nbs,
        -sum(decode(sign(ost+decode(v1.fdat, :sDat ,v1.dos,0)-decode(v1.fdat, :sDat ,v1.kos,0)),
                     -1,
                     ost+decode(v1.fdat, :sDat ,v1.dos,0)-decode(v1.fdat, :sDat ,v1.kos,0),
                     0)),
         sum(decode(sign(ost+decode(v1.fdat, :sDat ,v1.dos,0)-decode(v1.fdat, :sDat ,v1.kos,0)),
                     1,
                     ost+decode(v1.fdat, :sDat ,v1.dos,0)-decode(v1.fdat, :sDat ,v1.kos,0),
                     0)),
        sum(decode(v1.fdat, :sDat ,v1.dos,0)),
        sum(decode(v1.fdat, :sDat ,v1.kos,0)),
       -sum(decode(sign(ost),-1, ost,0)),
        sum(decode(sign(ost), 1, ost,0))
 FROM accounts_its a, vypiska v1
 WHERE a.nbs>4999 AND a.nls=v1.nls AND
     (a.nls,v1.fdat) = (select v2.nls,max(v2.fdat)
                         from vypiska v2
                         where v2.nls=a.nls and
                               v2.fdat<=  :sDat
                         group by v2.nls)
 GROUP BY a.nbs
 ORDER BY 1"
.head 4 +  Else If GetBankMfo()='220101107' 
.head 5 +  If nRep=31
.head 6 -  Set ss = "
    SELECT s.NBS, substr(s.nlsalt,1,4), sum(gl.p_icurval(s.kv,s.dos,s.fdat)),
           sum(gl.p_icurval(s.kv,s.kos,s.fdat)),
           -sum(decode(sign(s.ost),-1,
           gl.p_icurval(s.kv,s.ost,s.fdat),0)),
           sum(decode(sign(s.ost),1,
           gl.p_icurval(s.kv,s.ost,s.fdat),0))
    INTO :NBS, :NBSALT, :DOS,:KOS,:OSTD,:OSTK
    FROM sal s
    WHERE s.fdat= :sDat and (s.dos>0 or s.kos>0 or s.ost<>0)
          and s.nbs is not null
    GROUP BY s.NBS, substr(s.nlsalt,1,4)
    ORDER BY s.NBS,substr(s.nlsalt,1,4)"
.head 5 +  Else
.head 6 -  Set ss = "
    SELECT s.NBS, substr(s.nlsalt,1,4), sum(gl.p_icurval(s.kv,s.dos,s.fdat)),
           sum(gl.p_icurval(s.kv,s.kos,s.fdat)),
           -sum(decode(sign(s.ost),-1,
           gl.p_icurval(s.kv,s.ost,s.fdat),0)),
           sum(decode(sign(s.ost),1,
           gl.p_icurval(s.kv,s.ost,s.fdat),0))
    INTO :NBS, :NBSALT, :DOS,:KOS,:OSTD,:OSTK
    FROM sal s
    WHERE s.fdat= :sDat and (s.dos>0 or s.kos>0 or s.ost<>0)
          and s.nbs is not null
    GROUP BY s.NBS, substr(s.nlsalt,1,4)
    ORDER BY substr(s.nlsalt,1,4), s.NBS "
.head 4 +  Else
.head 5 -  Set ss = "
    SELECT s.NBS,sum(gl.p_icurval(s.kv,s.dos,s.fdat)),
           sum(gl.p_icurval(s.kv,s.kos,s.fdat)),
           -sum(decode(sign(s.ost),-1,
           gl.p_icurval(s.kv,s.ost,s.fdat),0)),
           sum(decode(sign(s.ost),1,
           gl.p_icurval(s.kv,s.ost,s.fdat),0))
    INTO :NBS,:DOS,:KOS,:OSTD,:OSTK
    FROM sal s
    WHERE s.fdat= :sDat and (s.dos>0 or s.kos>0 or s.ost<>0)
          and s.nbs is not null
    GROUP BY s.NBS
    ORDER BY s.NBS"
.head 4 -  Call SqlPrepare(hSql(), T(ss))
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Set K = SalStrToNumber(SalStrLeftX(NBS, 1))
.head 5 -  Set R = SalStrToNumber(SalStrLeftX(NBS, 2))
.head 5 -  Set G = SalStrToNumber(SalStrLeftX(NBS, 3))
.head 5 -  Set B1 = IifN(K<8, 1, IifN(K<9, 8, 9))
.head 5 +  If NBS_3929 != STRING_Null and  NBS=NBS_3929
.head 6 +  If DOS > KOS
.head 7 -  Set DOS = DOS - KOS
.head 7 -  Set KOS = 0
.head 6 +  Else If DOS < KOS
.head 7 -  Set KOS = KOS - DOS
.head 7 -  Set DOS = 0
.head 6 +  Else
.head 7 -  Set DOS = 0
.head 7 -  Set KOS = 0
.head 5 -  Return TRUE
.head 4 +  Else
.head 5 -  Return FALSE
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam = RPT_BeforeBreakHeader1 !! заголовок баланса
.head 5 -  Set PAGE = 1
.head 5 -  Set fNewClass = TRUE
.head 5 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),
     'PAGE', PAGE)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'SHAP1', GetUserRealName())
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'SHAP', SHAP)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'ZAGO', IifS(B1=1, 'Балансовий', IifS(B1=8,
     'Управлінський', 'Позабалансовий')) || ' облік')
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'aMFO', AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'aQH', AQH)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'Report_date', strRepDate)
.head 4 +  If lParam=RPT_DoneBreakHeader1   !! заголовок баланса
.head 5 -  Set fNewClass = FALSE
.head 4 +  If lParam=RPT_BeforePageHeader	 !! заголовок на странице
.head 5 +  If not fNewClass
.head 6 -  Set PAGE = PAGE + 1
.head 6 -  Call SalReportSetNumberVar(
     SalNumberToWindowHandle(wParam), 'PAGE', PAGE)
.head 4 +  If lParam=RPT_BeforeBreakHeader2 !! заголовок класа
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), "
     SELECT name
     INTO :sTmp
     FROM ps
     WHERE nbs+0=:K")
.head 5 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'sK', sTmp)
.head 4 +  If lParam = RPT_BeforeBreakHeader3 !! заголовок раздела
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), "
     SELECT name
     INTO :sTmp
     FROM ps
     WHERE nbs+0=:R")
.head 5 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'sR', sTmp)
.head 4 +  If lParam = RPT_BeforeBreakHeader4 !! заголовок группы
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), "
     SELECT name
     INTO :sTmp
     FROM ps
     WHERE nbs+0=:G")
.head 5 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'sG', sTmp)
.head 3 +  On SAM_ReportFinish
.head 4 +  ! If sDat != sDatMax
.head 5 -  ! Call SqlPrepareAndExecute(hSqlAux(), "DROP table " || sid)
.head 5 -  ! Call SqlPrepareAndExecute(hSqlAux(), "commit")
.head 4 -  Call SalSendMsg(frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 1 +  Dialog Box: dlg_DirSelect
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Директория отчета
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: System Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  4.267"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.536"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? No
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Pushbutton: pbCancel
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cpbCancel
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left:   2.5"
.head 5 -  Top:    2.667"
.head 5 -  Width:  Class Default
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalEndDialog(hWndForm, 0)
.head 5 +  On SAM_SetFocus
.head 6 -  Call SalStatusSetText(hWndForm, 'Завершить')
.head 3 +  Pushbutton: pbOk
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cpbOk
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Выбрать
.head 4 -  Window Location and Size
.head 5 -  Left:   0.6"
.head 5 -  Top:    2.667"
.head 5 -  Width:  Class Default
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set strPrintPath = SalStrLeftX ( lbDir.GetSelectedDir()   ,  SalStrLength(lbDir.GetSelectedDir() ) - 1 )
.head 6 -  Set frm_Out.dfPath = SalStrUpperX( strPrintPath )
.head 6 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 6 -  Call SalEndDialog(hWndForm, 0)
.head 3 +  Combo Box: cmbDrive
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cDriveComboBox
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left:   -0.014"
.head 5 -  Top:    2.156"
.head 5 -  Width:  4.1"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 1.063"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Editable? Class Default
.head 4 -  String Type: Class Default
.head 4 -  Maximum Data Length: Class Default
.head 4 -  Sorted? Class Default
.head 4 -  Always Show List? Class Default
.head 4 -  Vertical Scroll? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Input Mask: Class Default
.head 4 -  List Initialization
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call lbDir.Populate (cmbDrive.GetSelectedDrive() )
.head 3 -  Frame
.head 4 -  Resource Id: 63313
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   -0.014"
.head 5 -  Top:    2.488"
.head 5 -  Width:  4.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.75"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Border Color: Default
.head 4 -  Background Color: Default
.head 3 -  Frame
.head 4 -  Resource Id: 63314
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   -0.014"
.head 5 -  Top:    0.031"
.head 5 -  Width:  4.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 2.542"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Border Color: Default
.head 4 -  Background Color: Default
.head 3 -  Frame
.head 4 -  Resource Id: 63315
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   -0.014"
.head 5 -  Top:    2.156"
.head 5 -  Width:  4.1"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.333"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Border Color: Default
.head 4 -  Background Color: Default
.head 3 +  List Box: lbDir
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cDirListBox
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left:   -0.014"
.head 5 -  Top:    0.073"
.head 5 -  Width:  4.1"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 2.083"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Multiple selection? Class Default
.head 4 -  Sorted? Class Default
.head 4 -  Vertical Scroll? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Horizontal Scroll? Class Default
.head 4 -  List Initialization
.head 4 -  Message Actions
.head 2 -  Functions
.head 2 -  Window Parameters
.head 2 +  Window Variables
.head 3 -  String: strCurrDir
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalFileGetCurrentDirectory( strCurrDir )
.head 4 -  Call SalFileSetCurrentDirectory( strPrintPath )	
.head 4 -  Call lbDir.Populate (strPrintPath)
.head 4 -  Call SalCenterWindow( hWndForm )
.head 3 +  On SAM_Close
.head 4 -  Call SalFileSetCurrentDirectory( strCurrDir )	
.head 1 +  Form Window: frm_UniSal    !! Универсальная Сальдовка в номинале и в эквиваленте
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Оборотно-сальдовая ведомость
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  5.333"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 2.188"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Оборотно-сальдовая ведомость
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Number: nSortMode	! тип сортировки и группировки
.head 3 -  String: sDat 		! дата
.head 3 -  Number: fAllInUse	! использовать все счета (альтернатива - только SALDO)
.head 2 +  Window Variables
.head 3 -  String: strBankMfo
.head 3 -  String: strBankName
.head 3 -  String: strQuery
.head 3 -  String: strOrderBy
.head 3 -  !
.head 3 -  Number: nPar
.head 3 -  Number: nTmp
.head 3 -  String: sPdat
.head 3 -  Number: nOstF
.head 3 -  Number: nOstQ
.head 3 -  Number: KV
.head 3 -  String: NBS
.head 3 -  Date/Time: DAPP
.head 3 -  String: NLS
.head 3 -  Number: DOS
.head 3 -  Number: KOS
.head 3 -  Number: OSTID
.head 3 -  Number: OSTIK
.head 3 -  Number: DOSQ
.head 3 -  Number: KOSQ
.head 3 -  Number: OSTIDQ
.head 3 -  Number: OSTIKQ
.head 3 -  String: NMS
.head 3 -  Number: ISP
.head 3 -  String: LCV
.head 3 -  ! String: sIsp
.head 3 -  String: sGrB
.head 3 -  String: NAMV
.head 3 -  ! String: sP1
.head 3 -  !
.head 3 -  Number: nRow
.head 3 -  : cQSaldo
.head 4 -  Class: cGenQuery
.head 3 -  : cFSaldo
.head 4 -  Class: cGenFilter
.head 3 -  !
.head 3 -  Number: nDig
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalWaitCursor(TRUE)
.head 4 -  !
.head 4 -  Call SalHideWindow( hWndForm )

.head 4 -  ! ===== Старый код = имя файла формируется при выборкеотчета ===========
.head 4 -  ! Set strFileName = SalStrLeftX(strFileName, SalStrScan(strFileName, '.')+1) ||
                  SalStrRightX( SalNumberToStrX( GetUserId(), 0 ), 3 )

.head 4 -  Set strBind = 'KV,NBS,DAPP,NLS,DOS,KOS,OSTID,OSTIK,DOSQ,KOSQ,OSTIDQ,OSTIKQ,NMS,ISP,LCV'
.head 4 -  Set strInput = strBind
.head 4 -  Call cFSaldo.Init( 'SAL', 'A' )
.head 4 -  !
.head 4 -  Set nPar=0
.head 4 +  If nPar=0 !! Сальдовка
.head 5 -  Set strQuery =
'SELECT a.dapp,a.kv,a.nbs,a.nls,a.ost/100,a.dos/100,a.kos/100,
        gl.p_icurval(a.kv,a.ost,a.fdat)/100,
        gl.p_icurval(a.kv,a.dos,a.fdat)/100,
        gl.p_icurval(a.kv,a.kos,a.fdat)/100,a.nms,a.isp,t.lcv
   INTO :DAPP,:KV,:NBS,:NLS,:nOstF,:DOS,:KOS,:nOstQ,:DOSQ,:KOSQ,:NMS,:ISP,:LCV
   FROM sal a,tabval t
   WHERE (a.dazs IS NULL OR a.dazs > :sDat ) AND a.fdat = :sDat AND a.kv=t.kv '
.head 4 -  !
.head 4 +  Else If nPar=1 !! Деб обороты (сумма и кол) по БС
.head 5 -  ! Set strBind = 'KV,NBS,NLS,DOS,KOS,DOSQ,NMS,ISP'
.head 5 -  Set strQuery =
"SELECT a.kv, a.nbs, a.nls, a.dos/100,
        gl.p_icurval(a.kv,a.dos,a.fdat)/100,
        a.nms, count(*)
 INTO :KV,:NBS,:NLS,:DOS,:DOSQ,:NMS,:ISP,:KOS
 FROM sal a, opldok o
 WHERE o.dk=0 AND o.fdat=a.fdat AND o.acc=a.acc AND a.dos>0 AND a.fdat= :sDat "
.head 4 +  If NOT fAllInUse
.head 5 -  Set strQuery = strQuery || ' AND a.acc IN (SELECT acc FROM saldo)'
.head 5 -  ! Set strOrderBy = 'isp,'
.head 4 +  If nPar=1
.head 5 -  Set strQuery = strQuery ||" GROUP BY a.kv, a.nbs, a.nls, a.dos, a.fdat,a.nms,a.isp"
.head 4 +  Select Case nSortMode
.head 5 +  Case 0		! Балансовый счет, код валюты
.head 6 -  Set strOrderBy = 'SUBSTR(a.nls,1,4)||SUBSTR(a.nls,6),a.kv'
.head 6 -  Break
.head 5 +  Case 1		! Код валюты, балансовый счет
.head 6 -  Set strOrderBy = 'a.kv,SUBSTR(a.nls,1,4)||SUBSTR(a.nls,6)'
.head 6 -  Break
.head 5 +  Default
.head 6 -  Set strOrderBy = 'a.kv,a.nbs'
.head 6 -  Break
.head 4 -  ! Set strOrderBy = strOrderBy || ',substr(nls,1,4)||substr(nls,6)'
.head 4 -  Set strQuery = strQuery || ' ORDER BY ' || strOrderBy
.head 4 -  !
.head 4 -  Call cQSaldo.Init(  strQuery )
.head 4 -  Call SetQueryFilter( cFSaldo )
.head 4 -  !
.head 4 -  ! Call SalReportPrintToFile(hWndForm, strDir, GetPrnDir() || '/' || IifS(FL_FORMAT, strFileName1, strFileName),
     strBind, strBind, 1, RPT_PrintAll, 1, 1, FL_FORMAT, nInd)
.head 4 -  ! ==================================================
.head 4 -  ! Начинаем печать в отчет
.head 4 -  ! ==================================================
.head 4 -  Call SalReportPrintToFile(hWndForm, 
                                                        strTmplPath, 
                                                        strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                                        strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 +  If nInd>4
.head 5 -  Call SalMessageBox( 'Ошибка '||SalNumberToStrX(nInd,0)||' формирования отчета', 'Внимание', MB_IconStop )
.head 4 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 4 -  Set frm_Out.dfPath = strPrintPath
.head 4 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 4 -  !
.head 4 -  Call SalWaitCursor(FALSE)
.head 4 -  Call SalDestroyWindow(hWndForm)
.head 4 -  Return TRUE
.head 3 +  On SAM_ReportStart
.head 4 -  Call SqlPrepare(hSql(), T( cQSaldo.GetFullSQLString( cFSaldo )))
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If NOT fAllInUse
.head 5 -  Set ISP = NUMBER_Null
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 -  ! проверка на 3 знака
.head 5 -  Call SqlPrepareAndExecute( hSqlAux(), "
SELECT dig INTO :nDig
FROM tabval
WHERE kv = :KV" )
.head 5 +  If not SqlFetchNext( hSqlAux(), nFetchRes )
.head 6 -  Return FALSE
.head 5 -  Set nOstF = nOstF*SalNumberPower( 10,2-nDig )
.head 5 -  Set DOS   = DOS*SalNumberPower( 10,2-nDig )
.head 5 -  Set KOS   = KOS*SalNumberPower( 10,2-nDig )
.head 5 -  Set nOstQ = nOstQ*SalNumberPower( 10,2-nDig )
.head 5 -  Set DOSQ  = DOSQ*SalNumberPower( 10,2-nDig )
.head 5 -  Set KOSQ  = KOSQ*SalNumberPower( 10,2-nDig )
.head 5 -  !
.head 5 +  If nOstF<0
.head 6 -  Set OSTID  = -nOstF
.head 6 -  Set OSTIDQ = -nOstQ
.head 6 -  Set OSTIK  = 0
.head 6 -  Set OSTIKQ = 0
.head 5 +  Else
.head 6 -  Set OSTID  = 0
.head 6 -  Set OSTIDQ = 0
.head 6 -  Set OSTIK  = nOstF
.head 6 -  Set OSTIKQ = nOstQ
.head 5 -  Return TRUE
.head 4 +  Else
.head 5 -  Return FALSE
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam=RPT_BeforeReportHeader
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'aMFO',  AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'aNAME', AQH)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'Report_date', strRepDate)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'SHAP', SHAP)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'FIO',  IDNAME)
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 1 +  Form Window: frm_BalansOB  !! Баланс по валютам (без ГРН) номинал в один файл для Ощадбанка
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Баланс банка
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  3.717"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 1.286"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Баланс
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 -  Background Text: Формирование...
.head 4 -  Resource Id: 19793
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.133"
.head 5 -  Top:    0.095"
.head 5 -  Width:  1.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 2 +  Functions
.head 3 +  Function: FU_SAL
.head 4 -  Description: Печать баланса по ОДНОМУ
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  ! ==================================================
.head 5 -  ! Начинаем печать в отчет
.head 5 -  ! ==================================================
.head 5 -  Call SalReportPrintToFile(hWndForm, 
                                              strTmplPath, 
                                               strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                               strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 5 +  If (nInd > 4 )
.head 6 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 5 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 5 -  Set frm_Out.dfPath = strPrintPath
.head 5 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)

.head 5 -  Call SalWaitCursor(FALSE)
.head 2 +  Window Parameters
.head 3 -  String: sdat
.head 2 +  Window Variables
.head 3 -  Number: B1
.head 3 -  Number: KV
.head 3 -  Number: K
.head 3 -  Number: R
.head 3 -  Number: G
.head 3 -  String: NBS
.head 3 -  Number: DOS
.head 3 -  Number: KOS
.head 3 -  Number: OSTD
.head 3 -  Number: OSTK
.head 3 -  Number: nRow
.head 3 -  Number: nTmp
.head 3 -  String: sTmp
.head 3 -  !
.head 3 -  Number: PAGE
.head 3 -  Boolean: fNewClass
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalCenterWindow( frm_BalansOB )
.head 4 -  Set strBind = 'B1,KV,K,R,G,NBS,DOS,KOS,OSTD,OSTK'
.head 4 -  Set strInput = strBind
.head 4 -  Call FU_SAL()
.head 4 -  Call SalDestroyWindow( frm_BalansOB )
.head 3 +  On SAM_ReportStart
.head 4 -  Set PAGE = 0
.head 4 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'RUK', GetGlobalOption('BOSS'))
.head 4 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'GLB', GetGlobalOption('ACCMAN'))
.head 4 -  Set sTmp = T("
    SELECT kv,nbs,-SUM(decode(sign(ost),-1,ost,0))/100,
           SUM(decode(sign(ost), 1,ost,0))/100,SUM(dos)/100,
           SUM(kos)/100
    FROM sal
    INTO :KV,:NBS,:OSTD,:OSTK,:DOS,:KOS
    WHERE fdat= :sdat and kv<>980
    GROUP BY kv,nbs
    HAVING SUM(ost)<>0 OR SUM(dos)<>0 OR SUM(kos)<>0
    ORDER BY kv,nbs")
.head 4 -  Call SqlPrepare(hSql(), sTmp)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Set K = SalStrToNumber(SalStrLeftX(NBS, 1))
.head 5 -  Set R = SalStrToNumber(SalStrLeftX(NBS, 2))
.head 5 -  Set G = SalStrToNumber(SalStrLeftX(NBS, 3))
.head 5 -  Set B1 = IifN(K<8, 1, IifN(K<9, 8, 9))
.head 5 -  Return TRUE
.head 4 +  Else
.head 5 -  Return FALSE
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam = RPT_BeforeReportHeader
.head 5 -  !
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'aMFO', AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'aQH', AQH)
.head 5 -  !
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'Report_date', strRepDate)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'SHAP', SHAP)
.head 4 +  If lParam = RPT_BeforeBreakHeader1
.head 5 -  !
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), "
     SELECT lcv || ' ' || name
     INTO :sTmp
     FROM tabval
     WHERE kv=:KV")
.head 5 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'NAMV', sTmp)
.head 4 +  If lParam = RPT_BeforeBreakHeader2
.head 5 -  Set PAGE = 1
.head 5 -  Set fNewClass = TRUE
.head 5 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),
     'PAGE', PAGE)
.head 5 -  Set sTmp = IifS(B1=1, 'Балансовий', IifS(B1=8,
    'Управлінський', 'Позабалансовий')) || ' облік'
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'ZAGO', sTmp)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'sR', GetUserRealName())
.head 5 -  !
.head 4 +  If lParam = RPT_DoneBreakHeader2
.head 5 -  Set fNewClass = FALSE
.head 4 +  If lParam = RPT_BeforePageHeader
.head 5 +  If not fNewClass
.head 6 -  Set PAGE = PAGE + 1
.head 6 -  Call SalReportSetNumberVar(
     SalNumberToWindowHandle(wParam), 'PAGE', PAGE)
.head 4 +  If lParam = RPT_BeforeBreakHeader3
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), T("
     SELECT name[1,70]
     INTO :sTmp
     FROM ps
     WHERE nbs+0=:K"))
.head 5 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'sK', sTmp)
.head 4 +  If lParam = RPT_BeforeBreakHeader4
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), T("
     SELECT name[1,70]
     INTO :sTmp
     FROM ps
     WHERE nbs+0=:R"))
.head 5 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'sR', sTmp)
.head 4 +  If lParam = RPT_BeforeBreakHeader5
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), T("
     SELECT name[1,70]
     INTO :sTmp
     FROM ps
     WHERE nbs+0=:G"))
.head 5 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'sG', sTmp)
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg(frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 1 +  Form Window: frm_JS        !! журнал открытых счетов
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Баланс банка
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  7.125"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.563"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: sdat
.head 3 -  String: sdat2
.head 3 -  String: sim
.head 2 +  Window Variables
.head 3 -  String: CUT
.head 3 -  Number: RNK
.head 3 -  String: NMK
.head 3 -  String: NLS
.head 3 -  String: NBS
.head 3 -  Number: KV
.head 3 -  Number: KURS
.head 3 -  String: NMS
.head 3 -  Number: SV
.head 3 -  Number: SG
.head 3 -  Number: SK
.head 3 -  Date/Time: DAOS
.head 3 -  String: ISP
.head 3 -  Date/Time: DAZS
.head 3 -  Number: PAP
.head 3 -  Number: POS
.head 3 -  String: CUTN
.head 3 -  String: maska
.head 3 -  String: ss
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set strBind='CUT,RNK,NMK,NLS,KV,NMS,DAOS,ISP,DAZS,PAP,POS'
.head 4 -  Set maska=Maska_NLS("счетов")
.head 4 +  If maska='-'
.head 5 -  Call SalDestroyWindow( hWndForm )
.head 5 -  Return FALSE
.head 4 -  Set strInput=strBind
.head 4 +  If sim='*' 	  !! всех по типу клиента
.head 5 -  Set ss=T("
SELECT a.nbs, t.name, r.rnk, r.nmk[1,38], a.nls,
       a.nms[1,38], a.kv, a.daos, r.okpo, a.dazs, a.pap,a.pos
INTO  :CUT, :CUTN, :RNK, :NMK, :NLS, :NMS, :KV,
      :DAOS, :ISP, :DAZS, :PAP,:POS
FROM  Customer r, Accounts a, Cust_acc ra,  Custtype t
WHERE r.rnk=ra.rnk and a.acc=ra.acc and t.custtype=r.custtype "||
     IifS(maska !='*'," AND trim(a.nls) LIKE \'"||SalStrTrimX(maska)||"\'",'')||"
ORDER BY r.custtype,  r.rnk, a.nls, a.kv")
.head 4 +  Else If sim='B'	  !! всех (сорт.по БС)
.head 5 -  Set strBind='CUT,RNK,NMK,NBS,NLS,KV,NMS,DAOS,ISP,DAZS,PAP,POS'
.head 5 -  Set strInput=strBind
.head 5 -  Set ss=T("
SELECT r.custtype,t.name, r.rnk, r.nmk[1,38],a.nbs, a.nls,
       a.nms[1,38], a.kv, a.daos, r.okpo, a.dazs, a.pap,a.isp
INTO  :CUT, :CUTN, :RNK, :NMK, :NBS, :NLS, :NMS, :KV,
      :DAOS, :ISP, :DAZS, :PAP,:POS
FROM  Customer r, Accounts a, Cust_acc ra,  Custtype t
WHERE r.rnk=ra.rnk and a.acc=ra.acc and t.custtype=r.custtype "||
     IifS(maska !='*'," AND trim(a.nls) LIKE \'"||SalStrTrimX(maska)||"\'",'')||"
ORDER BY a.nbs, substr(a.nls,6,9), a.kv ")
.head 4 +  Else If sim='N'	  !! всех по исполнителям
.head 5 -  Set ss = T("
        SELECT a.isp,t.fio, r.rnk, r.nmk[1,38], a.nls, a.nms[1,38], a.kv,
                 a.daos,r.okpo, a.dazs, a.pap, a.pos
        INTO :CUT,:CUTN,:RNK,:NMK,:NLS,:NMS, :KV,:DAOS,
                   :ISP,:DAZS,:PAP,:POS
        FROM Customer r, Accounts a, Cust_acc ra, Staff t
         WHERE   r.rnk=ra.rnk and a.acc=ra.acc  and  a.isp=t.id "||
      IifS(maska !='*'," AND trim(a.nls) LIKE \'"||SalStrTrimX(maska)||"\'",'')||"
ORDER BY a.isp, r.rnk, a.nls, a.kv")
.head 4 +  Else If sim='D'	  !! всех действующих по исполнителям
.head 5 -  Set ss = T("
SELECT a.isp,t.fio, r.rnk, r.nmk[1,38], a.nls, a.nms[1,38], a.kv,
       a.daos,r.okpo, a.dazs, a.pap, A.POS
INTO :CUT,:CUTN,:RNK,:NMK,:NLS,:NMS, :KV,:DAOS,:ISP,:DAZS,:PAP,:POS
FROM  Customer r, Accounts a, Cust_acc ra, Staff t
WHERE r.rnk=ra.rnk and a.acc=ra.acc and a.dazs is null
and a.isp=t.id "||
IifS(maska !='*'," AND trim(a.nls) LIKE \'"||
SalStrTrimX(maska)||"\'",'')||"
ORDER BY a.isp, r.rnk, a.nls, a.kv")
.head 4 +  Else If sim='ND'  !! всех по исполнителям и по датам
.head 5 -  Set sdat  = SalFmtFormatDateTime(SalFmtFormatStrDateTime( sdat,  "MM-dd-yyyy" ), "dd/MM/yyyy")
.head 5 -  Set sdat2 = SalFmtFormatDateTime(SalFmtFormatStrDateTime( sdat2, "MM-dd-yyyy" ), "dd/MM/yyyy")
.head 5 -  Set sdat  = SalFmtFormatDateTime(SalFmtFormatStrDateTime( sdat,  "dd/MM/yyyy" ), "MM-dd-yyyy")
.head 5 -  Set sdat2 = SalFmtFormatDateTime(SalFmtFormatStrDateTime( sdat2, "dd/MM/yyyy" ), "MM-dd-yyyy")
.head 5 -  Set ss = T("
        SELECT a.isp,t.fio, r.rnk, r.nmk[1,38], a.nls, a.nms[1,38], a.kv,
                 a.daos,r.okpo, a.dazs, a.pap, a.pos
        INTO :CUT,:CUTN,:RNK,:NMK,:NLS,:NMS, :KV,:DAOS,
                   :ISP,:DAZS,:PAP,:POS
        FROM Customer r, Accounts a, Cust_acc ra, Staff t
        WHERE   r.rnk=ra.rnk and a.acc=ra.acc  and
                date(a.daos) >= :sdat  and  date(a.daos) <= :sdat2
                and a.isp=t.id "||
      IifS(maska !='*'," AND trim(a.nls) LIKE \'"||SalStrTrimX(maska)||"\'",'')||"
ORDER BY a.isp, r.rnk, a.nls, a.kv")
.head 4 +  ! Else If sim='U'	  !! обновление счетов
.head 5 -          Set ss = T("
SELECT to_char(a.chgdate,'dd-mm-yyyy'),r.rnk,r.nmk[1,38] ,a.nls,a.nms[1,38] ,
       a.kv,a.daos, r.okpo, a.dazs, a.pap, A.POS
INTO :CUT,:RNK,:NMK,:NLS,:NMS,:KV,:DAOS,:ISP,:DAZS,:PAP,:POS
FROM  Customer r, Accounts_update a, Cust_acc ra
WHERE r.rnk=ra.rnk and a.acc=ra.acc AND a.chgdate>=  :sdat  and a.chgdate<=  :sdat2 "||
      IifS(maska !='*'," AND trim(a.nls) LIKE \'"||SalStrTrimX(maska)||"\'",'')||"
ORDER BY a.chgdate,2,4,6")
.head 4 +  Else If sim='Z'	  !! всех закрытых по исп за период
.head 5 -  Set ss = T("
SELECT a.isp,t.fio, r.rnk, r.nmk[1,38], a.nls, a.nms[1,38], a.kv,
       a.daos,r.okpo, a.dazs, a.pap, A.POS   
INTO :CUT,:CUTN,:RNK,:NMK,:NLS,:NMS, :KV,:DAOS,:ISP,:DAZS,:PAP,:POS   
FROM  Customer r, Accounts a, Cust_acc ra, Staff t   
WHERE r.rnk=ra.rnk and a.acc=ra.acc and a.dazs is not null   
and  a.dazs>=  :sdat  and a.dazs<=  :sdat2     
and a.isp=t.id   "||
IifS(maska !='*'," AND trim(a.nls) LIKE \'"||  
SalStrTrimX(maska)||"\'",'')  ||  "
   ORDER BY a.isp, r.rnk, a.nls, a.kv  ")
.head 4 +  Else !! по датам
.head 5 -  Set sdat  = SalFmtFormatDateTime(SalFmtFormatStrDateTime( sdat,  "MM-dd-yyyy" ), "dd/MM/yyyy")
.head 5 -  Set sdat2 = SalFmtFormatDateTime(SalFmtFormatStrDateTime( sdat2, "MM-dd-yyyy" ), "dd/MM/yyyy")
.head 5 -  Set sdat  = SalFmtFormatDateTime(SalFmtFormatStrDateTime( sdat,  "dd/MM/yyyy" ), "MM-dd-yyyy")
.head 5 -  Set sdat2 = SalFmtFormatDateTime(SalFmtFormatStrDateTime( sdat2, "dd/MM/yyyy" ), "MM-dd-yyyy")
.head 5 -  Set ss = T("
SELECT r.custtype, t.name, r.rnk, r.nmk[1,38], a.nls,
      a.nms[1,38] , a.kv, a.daos, r.okpo, a.dazs, a.pap,A.POS
INTO  :CUT,:CUTN,:RNK,:NMK,:NLS,:NMS,:KV,:DAOS,:ISP,:DAZS,:PAP,:POS
FROM Customer r, Accounts a, Cust_acc ra, Custtype t WHERE
      r.rnk=ra.rnk and a.acc=ra.acc and
      t.custtype=r.custtype and date(a.daos) >= :sdat   and
      date(a.daos) <= :sdat2  "||
      IifS(maska !='*'," AND trim(a.nls) LIKE \'"||SalStrTrimX(maska)||"\'",'')||"
ORDER BY r.custtype, r.rnk, a.nls, a.kv")
.head 4 -  Call WaitCursorOn()
.head 4 -  Call SalHideWindow(hWndForm)
.head 4 -  ! Call SalReportPrintToFile(hWndForm,strDir,GetPrnDir()||
     '/'|| IifS(FL_FORMAT,strFileName1,strFileName),
     strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 -  ! ==================================================
.head 4 -  ! Начинаем печать в отчет
.head 4 -  ! ==================================================
.head 4 -  Call SalReportPrintToFile(hWndForm, strTmplPath, 
 strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
 strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 +  If nInd >4
.head 5 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 4 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 4 -  Set frm_Out.dfPath = strPrintPath
.head 4 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 4 -  Call SalDestroyWindow(hWndForm)
.head 3 +  On SAM_ReportStart ! приготовить SELECT
.head 4 -  Return SqlPrepare(hSql(), ss)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 -  Return SqlFetchNext(hSql(), nFetchRes)
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam=RPT_BeforeBreakHeader1
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'AMFO',AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'AQH',AQH)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP',
SHAP||' ' || IifS( sim='*' or sim='B' or sim='N' or  sim='U', '',strDateFrom||" - "||strDateTo||" " )||
IifS(sim='B','',IifS(sim='U',CUT,CUTN)) )
.head 3 +  On SAM_Destroy
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 1 +  Form Window: frm_KJ
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Баланс банка
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  7.125"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.563"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: sdat
.head 3 -  Number: UD
.head 2 +  Window Variables
.head 3 -  String: ss
.head 3 -  Number: npp
.head 3 -  !
.head 3 -  String: maska
.head 3 -  Number: DK
.head 3 -  String: KAS
.head 3 -  String: ND
.head 3 -  String: NLS
.head 3 -  Number: SK
.head 3 -  Number: S
.head 3 -  Number: S1
.head 3 -  String: FIO
.head 3 -  String: strRBSName
.head 3 -  ! Date/Time: dRab
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set strBind = 'DK,KAS,ND,NLS,SK,S,S1' !! наши переменные
.head 4 -  Set strInput =strBind !! переменные в отчете
.head 4 +  If SalStrTrimX(SalStrUpperX(GetDBMS()))='ORACLE'
.head 5 -  Set strRBSName = GetGlobalOption( 'RNBURBCK' )
.head 5 -  Set ID = GetUserId()
.head 5 +  If strRBSName
.head 6 -  ! ! Make end of transaction and start new
.head 6 -  Call SqlCommit( hSql() )
.head 6 -  ! ! to avoid error with set transaction...
.head 6 -  Call SqlPrepareAndExecute( hSql(), 'SET TRANSACTION USE ROLLBACK SEGMENT ' || SalStrUpperX(strRBSName) )
.head 5 +  If not SqlPLSQLCommand(hSql(), "P_KJ(ID,sdat,sdat)")
.head 6 -  Return FALSE
.head 4 +  If UD>0
.head 5 -  Set ss =
"SELECT DK,kas,ND,nls,sk,S/100
 INTO :DK,:KAS,:ND,:NLS,:SK,:S FROM tmp_kj
WHERE id=:ID and ud=id ORDER BY 2,1,3,4"
.head 4 +  Else
.head 5 -  Set maska=Maska_NLS("счетов")
.head 5 +  If maska = '-'
.head 6 -  Call SalDestroyWindow(hWndForm)
.head 6 -  Return TRUE
.head 5 -  Set ss =
"SELECT DK,kas,ND,nls,sk,S/100
 INTO :DK,:KAS,:ND,:NLS,:SK,:S FROM tmp_kj
WHERE id=:ID and kas LIKE '" || maska || "'
 ORDER BY 2,1,3,4"
.head 4 -  ! Set ss = T("/
SELECT p.dk, s.kv||' '||s.nls||' '||s.nms, o.ND,
       decode(s.nls, o.nlsa, o.nlsb, o.nlsa ),
       decode(p.tt,o.tt,o.SK,t.sk), p.S/100
  FROM  OPER O, OPLDOK P, accounts S, tts t
   INTO :DK,:KAS,:ND,:NLS,:SK,:S
   WHERE  p.acc=s.acc AND
          s.tip='KAS' AND
          p.fdat = :sdat  AND
          t.tt=p.tt AND
          o.ref=p.ref AND p.SOS=5"||
IifS(ID=0, ""," and o.userid= :ID ") || "
ORDER BY 2,1,3,4 ")
.head 4 -  Call WaitCursorOn()
.head 4 -  Call SalHideWindow(hWndForm)
.head 4 -  ! Call SalReportPrintToFile(hWndForm,strDir,
                      GetPrnDir()||'/'|| IifS(FL_FORMAT,strFileName1,strFileName),strBind,strInput,
                        1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 -  ! ==================================================
.head 4 -  ! Начинаем печать в отчет
.head 4 -  ! ==================================================
.head 4 -  Call SalReportPrintToFile(hWndForm, 
                                                        strTmplPath, 
                                                        strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                                        strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 +  If (nInd > 4 )
.head 5 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 4 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 4 -  Set frm_Out.dfPath = strPrintPath
.head 4 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 4 -  Call SalDestroyWindow(hWndForm)
.head 3 +  On SAM_ReportStart
.head 4 -  Call SqlPrepare(hSql(), ss)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Set S1=S*(1-DK)
.head 5 -  Return TRUE
.head 4 +  Else
.head 5 -  Return FALSE
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam=RPT_BeforeBreakHeader1  !! KAS
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'AMFO', AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'AQH', AQH)
.head 5 -  ! Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP',SHAP||' '||sd1)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP',SHAP||' '||strDateFrom)
.head 5 +  If ID !=0
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'FIO', GetUserRealName())
.head 3 +  On SAM_Destroy
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 1 +  Form Window: frm_KRED
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Подразделение для печати документов
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   1.75"
.head 4 -  Top:    0.927"
.head 4 -  Width:  10.0"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 5.5"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Кредиты
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Child Table: tbl1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.067"
.head 6 -  Top:    0.048"
.head 6 -  Width:  9.683"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 4.5"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Dark Blue
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 3000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: Kod1
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.567"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NAME1
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: НАИМЕНОВАНИЕ
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  7.3"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 -  Message Actions
.head 3 +  Pushbutton: pb1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Сводный документ
.head 4 -  Window Location and Size
.head 5 -  Left:   0.983"
.head 5 -  Top:    4.679"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Dark Blue
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set N= 0
.head 6 -  Call PRINT()
.head 3 +  Pushbutton: pb2
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: По подразделению
.head 4 -  Window Location and Size
.head 5 -  Left:   3.6"
.head 5 -  Top:    4.679"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Midnight Blue
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set N=tbl1.Kod1
.head 6 -  Set strFileNameTxt=SalStrLeftX( strFileNameTxt, 5 ) || NumberToStrFormat(N,3) 
.head 6 -  ! Set strFileName=SalStrLeftX( strFileName, 
SalStrScan(strFileName, '.' )+1 ) || Str(N)
.head 6 -  Call PRINT()
.head 3 +  Pushbutton: pb3
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Завершить
.head 4 -  Window Location and Size
.head 5 -  Left:   6.2"
.head 5 -  Top:    4.679"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalDestroyWindow(hWndForm)
.head 2 +  Functions
.head 3 +  Function: PRINT
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  ! Для налоговой декларации
.head 5 +  If para>85 and para<100
.head 6 +  If P4 = 1 !! 1 кв для одиночек и для свода - одинаковый
.head 7 -  Set TIPD = "
    SELECT 0
    INTO :S2
    FROM dual"
.head 6 +  Else
.head 7 +  If N > 0 !! одиночка
.head 8 -  Set TIPD = "
    SELECT " || IifS(P4=2, "s1", IifS(P4=3, "s1+s2",
           "s1+s2+s3")) || "
    INTO :S2
    FROM nal_it
    WHERE rnk(+)=:N and gg=:P5 and dd=:DD and rr=:RR"
.head 7 +  Else !! свод
.head 8 -  Set TIPD = "
    SELECT " || IifS(P4=2, "SUM(s1)", IifS(P4=3,
           "SUM(s1+s2)", "SUM(s1+s2+s3)")) || "
    INTO :S2
    FROM nal_it
    WHERE gg=:P5 and dd=:DD and rr=:RR"
.head 6 -  ! сброс показателей
.head 6 -  If SqlPrepareAndExecute(hSql(),
   "SELECT BARS.NAL.nal_null FROM DUAL")
and SqlFetchNext(hSql(), nFetchRes)
.head 5 -  !
.head 5 -  ! ==================================================
.head 5 -  ! Начинаем печать в отчет
.head 5 -  ! ==================================================
.head 5 -  Call SalReportPrintToFile(hWndForm, 
                                              strTmplPath, 
                                              strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                              strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 5 +  If nInd >4
.head 6 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 5 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 5 -  Set frm_Out.dfPath = strPrintPath
.head 5 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 5 +  If not FL_FORMAT
.head 6 -  Call zarez12(  strPrintPath || '\\' || strFileNameTxt,  frm_Out.tblReps.Kod,  sDeviceDef)
.head 5 -  Call SalWaitCursor(FALSE)
.head 2 +  Window Parameters
.head 3 -  String: sdat
.head 3 -  String: sdat2
.head 3 -  Number: para
.head 2 +  Window Variables
.head 3 -  Number: nKto  !! 1-гл НБУ, 2-обл НБУ, 3 -КБ
.head 3 -  Number: NN
.head 3 -  Number: KV
.head 3 -  String: ISO
.head 3 -  String: CC_ID
.head 3 -  String: NLS
.head 3 -  String: NAME
.head 3 -  Number: S
.head 3 -  Number: PRO
.head 3 -  Date/Time: DATN
.head 3 -  Date/Time: DATP
.head 3 -  String: NAMV
.head 3 -  Number: S1
.head 3 -  Number: S2
.head 3 -  Number: SS1
.head 3 -  Number: SS2
.head 3 -  String: TIPD
.head 3 -  String: VIDO
.head 3 -  String: maska
.head 3 -  Number: P
.head 3 -  Number: PP1
.head 3 -  Number: N
.head 3 -  Number: N1
.head 3 -  Number: N2
.head 3 -  Number: NN1
.head 3 -  Date/Time: DAT0
.head 3 -  Date/Time: DAT1
.head 3 -  Date/Time: DAT2
.head 3 -  Date/Time: DAT3
.head 3 -  Date/Time: DAT4
.head 3 -  Date/Time: DAT5
.head 3 -  Date/Time: DAT6
.head 3 -  Number: V1
.head 3 -  Number: V2
.head 3 -  Number: V3
.head 3 -  Number: V4
.head 3 -  Number: V5
.head 3 -  Number: V6
.head 3 -  Number: P1
.head 3 -  Number: P2
.head 3 -  Number: P3
.head 3 -  Number: P4
.head 3 -  Number: P5
.head 3 -  Number: P6
.head 3 -  String: DDR[*]
.head 3 -  ! ДЛЯ НАЛОГОВОЙ ДЕКЛАРАЦИИ
.head 3 -  String: RR
.head 3 -  String: ss
.head 3 -  String: DD
.head 3 -  String: PP
.head 3 -  Long String: NMS
.head 3 -  String: SDD
.head 3 -  String: sdat3
.head 3 -  !
.head 3 -  String: ISNULL
.head 3 -  String: CTYPE
.head 3 -  String: CNUM_CST
.head 3 -  String: CNUM_YEAR
.head 3 -  String: CNUM_NUM
.head 3 -  String: MVM_FEAT
.head 3 -  !
.head 3 -  String: S_OKPO
.head 3 -  String: S_NAME
.head 3 -  String: S_ADRES
.head 3 -  String: S_TYPE
.head 3 -  String: S_TAXID
.head 3 -  !
.head 3 -  String: R_OKPO
.head 3 -  String: R_NAME
.head 3 -  String: R_ADRES
.head 3 -  String: R_TYPE
.head 3 -  String: R_TAXID
.head 3 -  !
.head 3 -  String: F_OKPO
.head 3 -  String: F_NAME
.head 3 -  String: F_ADRES
.head 3 -  String: F_TYPE
.head 3 -  String: F_TAXID
.head 3 -  !
.head 3 -  String: F_COUNTRY
.head 3 -  String: UAH_NLS
.head 3 -  String: UAH_MFO
.head 3 -  String: CCY_NLS
.head 3 -  String: CCY_MFO
.head 3 -  Number: KURS
.head 3 -  Number: CMODE_CODE
.head 3 -  String: DOC
.head 3 -  !
.head 3 -  Date/Time: CDAT
.head 3 -  Date/Time: NDAT
.head 3 -  Date/Time: MDAT
.head 3 -  Date/Time: ALLOW_DAT
.head 3 -  Date/Time: BEG_DATE
.head 3 -  Date/Time: END_DATE
.head 3 -  !
.head 3 -  Number: nDig
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  ! Call SalWaitCursor( TRUE )
.head 4 -  Call SalHideWindow(tbl1)
.head 4 -  Set CC_ID=strDateTo
.head 4 +  If para = 31 or para = 58 or para = 59 or para = 60 or para=33
.head 5 -  Set strBind='V6,NAME,V5,NAMV,V1,V2,V3,S,P1,P2,P3,P4'
.head 5 +  If para = 31     ! - - - - - - перешел в каталогизированные  на CKTR
.head 6 -  Set ss =T(
"SELECT a.CLASS, c.NAME, decode(a.pap,1,-1,1),
        substr(b.NBS,1,1), substr(b.NBS,1,2),substr(b.NBS,1,3),b.NBS,
        decode(a.pap,1,-1,1)*sum(b.OST+b.DOS-b.KOS),
        sum(b.DOS), sum(b.KOS), decode(a.pap,1,-1,1)*sum(b.OST)
 INTO  :V6,:NAME,:V5,:V1,:V2,:V3,:S,:P1,:P2,:P3,:P4
 FROM (SELECT nbs NBS, sum(dos) DOS,sum(kos) KOS,sum(ost) OST
       FROM sal WHERE (ost<>0 or dos+kos>0) AND fdat= :sdat  GROUP BY nbs
     UNION ALL
       SELECT a.nbs, sum(decode(v.fdat, :sdat ,v.dos,0)),
              sum(decode(v.fdat, :sdat ,v.kos,0)), sum(v.ost)
       FROM accounts_its a, vypiska v
       WHERE a.nbs>4999 AND v.nls=a.nls AND (a.nls,v.fdat) =
         (select nls,max(fdat) from vypiska
          where nls=a.nls and fdat<=  :sdat  group by nls)
       GROUP BY a.nbs
       ) b,
       ps a, cs c
WHERE b.nbs=a.nbs and a.class=c.class
GROUP BY a.CLASS,c.NAME,decode(a.pap,1,-1,1),b.NBS
ORDER BY a.CLASS,c.NAME,decode(a.pap,1,-1,1),b.NBS ")
.head 5 +  Else If para = 58 or para = 59  or para = 60
.head 6 +  If para = 58
.head 7 -  Set TIPD=
"SELECT min(fdat),max(fdat) INTO :DAT1,:DAT2 FROM fdat
 WHERE to_char(fdat,'MMYYYY')=to_char( :sdat  ,'MMYYYY')"
.head 6 +  If para = 59
.head 7 -  Set TIPD=
"SELECT min(fdat),max(fdat) INTO :DAT1,:DAT2 FROM fdat
 WHERE to_char(fdat,'QYYYY')=to_char( :sdat  ,'QYYYY')"
.head 6 +  If para = 60
.head 7 -  Set TIPD=
"SELECT min(fdat),max(fdat) INTO :DAT1,:DAT2 FROM fdat
 WHERE to_char(fdat,'YYYY')=to_char( :sdat  ,'YYYY')"
.head 6 +  ! If SqlPrepareAndExecute( hSqlAux2(), T(TIPD) )
and SqlFetchNext( hSqlAux2(),N )
.head 7 -          Set ss =
"SELECT a.CLASS,c.NAME, decode(a.pap,1,-1,1),
        substr(b.NBS,1,1), substr(b.NBS,1,2),substr(b.NBS,1,3),b.NBS,
        sum(b.OST+b.DOS-b.KOS)* decode(a.pap,1,-1,1),
        sum(b.DOS), sum(b.KOS), sum(b.OST)* decode(a.pap,1,-1,1)
 INTO  :V6,:NAME,:V5,  :V1,:V2,:V3,:S, :P1,:P2,:P3,:P4
 FROM (SELECT nbs NBS,sum(fdos(acc,:DAT1,:DAT2)) DOS,
              sum(fkos(acc,:DAT1,:DAT2)) KOS, sum(ost) OST
       FROM sal WHERE (dapp>=:DAT1 or ost<>0) AND fdat=:DAT2
       GROUP BY nbs
     UNION ALL
       SELECT a.nbs,
              sum(fdos_its(a.nls,:DAT1,:DAT2)),sum(fkos_its(a.nls,:DAT1,:DAT2)), sum(v.ost)
       FROM accounts_its a, vypiska v
       WHERE a.nbs>4999 AND v.nls=a.nls AND (a.nls,v.fdat) =
             (select nls,max(fdat) from vypiska
              where nls=a.nls and fdat<=:DAT2 group by nls)
       GROUP BY a.nbs
       ) b,
       ps a, cs c
WHERE b.nbs=a.nbs and a.class=c.class
GROUP BY a.CLASS,c.NAME,decode(a.pap,1,-1,1),b.NBS
ORDER BY a.CLASS,c.NAME,decode(a.pap,1,-1,1),b.NBS "
.head 6 +  If SqlPrepareAndExecute( hSqlAux2(), T(TIPD) )
and SqlFetchNext( hSqlAux2(),N )
.head 7 -  Set ss =
"SELECT a.CLASS,c.NAME, decode(a.pap,1,-1,1),
        substr(b.NBS,1,1), substr(b.NBS,1,2),substr(b.NBS,1,3),b.NBS,
        sum(b.OST+b.DOS-b.KOS)* decode(a.pap,1,-1,1),
        sum(b.DOS), sum(b.KOS), sum(b.OST)* decode(a.pap,1,-1,1)
 INTO  :V6,:NAME,:V5,  :V1,:V2,:V3,:S, :P1,:P2,:P3,:P4
 FROM (SELECT nbs NBS,sum(fdos(acc,:DAT1,:DAT2)) DOS,
              sum(fkos(acc,:DAT1,:DAT2)) KOS, sum(ost) OST
       FROM sal WHERE fdat=:DAT2 
       GROUP BY nbs
     UNION ALL
       SELECT a.nbs,
              sum(fdos_its(a.nls,:DAT1,:DAT2)),sum(fkos_its(a.nls,:DAT1,:DAT2)), sum(v.ost)
       FROM accounts_its a, vypiska v
       WHERE a.nbs>4999 AND v.nls=a.nls AND (a.nls,v.fdat) =
             (select nls,max(fdat) from vypiska
              where nls=a.nls and fdat<=:DAT2 group by nls)
       GROUP BY a.nbs
       ) b,
       ps a, cs c
WHERE b.nbs=a.nbs and a.class=c.class  
GROUP BY a.CLASS,c.NAME,decode(a.pap,1,-1,1),b.NBS
HAVING (sum(b.DOS)>0 or sum(b.KOS)>0 or sum(b.OST)>0)
ORDER BY a.CLASS,c.NAME,decode(a.pap,1,-1,1),b.NBS "
.head 5 +  Else If para = 33
.head 6 -  Set strBind='ISO,DAT1,NLS,V1,V2,S1,S2,NAME,N'
.head 6 -  Set PP=SalStrTrimX(Maska_NLS("счетов"))
.head 6 +  If PP='-'
.head 7 -  Call SalDestroyWindow( hWndForm )
.head 7 -  Return FALSE
.head 6 -  Set ss =T(
"SELECT substr(NLS,1,4), DAPP, NLS,
    decode(Sign(ost),-1,OST/100,0),  decode(Sign(ost),1,OST/100,0),
    DOS/100, KOS/100, NMS, ISP
 INTO :ISO,:DAT1,:NLS,:V1,:V2,:S1,:S2,:NAME,:N
 FROM (SELECT dapp DAPP, nls NLS, ost OST, dos DOS,kos KOS, nms NMS,isp ISP
       FROM sal  WHERE (ost<>0 or dos+kos>0) AND fdat = :sdat
      UNION ALL
       SELECT to_date(null),a.nls,v.ost,
              decode(v.fdat, :sdat ,v.dos,0),
              decode(v.fdat, :sdat ,v.kos,0), '', 0
       FROM accounts_its a, vypiska v
       WHERE a.nbs>4999 AND v.nls=a.nls AND (a.nls,v.fdat) =
         (select nls,max(fdat) from vypiska
          where nls=a.nls and fdat<=  :sdat  group by nls)
        ) " || IifS(PP !='%', "
 WHERE trim(NLS) LIKE \'" ||PP|| "\'",'') || "
 ORDER BY substr(nls,1,4), substr(nls,6,9)")
.head 5 -  Set strInput=strBind
.head 4 +  If para=20 ! бюджет КБ
.head 5 -  Set strBind='P5,V5,ISO,TIPD,VIDO,P,P1,P2,N,NAME,S1,S2,S'
.head 5 -  Set CC_ID= Subs(sdat,7,4) || Subs(sdat,1,2)
.head 5 +  If SqlPrepareAndExecute( hSql(),
  "SELECT min(fdat),max(fdat)  INTO :DAT1,:DAT2
   FROM fdat   WHERE to_char(fdat,'YYYYMM')=:CC_ID" )
and SqlFetchNext( hSql(), nFetchRes )
.head 6 -  Set ss=
"SELECT substr(k.kekb,1,1)*100000,
        substr(k.kekb,1,2)*10000,
        substr(k.kekb,1,4)*100, k.kekb, k.name,
        count(s.acc),
        nvl(ABS(sum( fkosn(s.kv, s.acc, s.fdat, s.fdat )-
                                fdosn(s.kv, s.acc, s.fdat, s.fdat )
                              )        ),0)
 INTO :P,:P1,:P2,:N,:NAME , :S,:S2
 FROM kekb k,sal s
 WHERE substr(k.kekb,5,2) <>'00' AND
       s.nlsalt=k.kekb AND to_char(s.fdat,'YYYYMM')=:CC_ID
GROUP BY k.kekb,k.name"
.head 6 -  Set PP=Subs(CC_ID,5,2)
.head 6 +  If SqlPrepareAndExecute( hSql(),
"SELECT name_rus INTO :SDD FROM META_MONTH where n="||PP )
.head 7 -  Call SqlFetchNext( hSql(), nFetchRes )
.head 7 -  Set SDD=SDD || ' ' || Subs(CC_ID,1,4) || ' р.'
.head 4 +  If para=23 ! Там декл
.head 5 -  Set strBind=
'CDAT,ISNULL,NDAT,MDAT,CTYPE,CNUM_CST,CNUM_YEAR,CNUM_NUM,MVM_FEAT,'||
'S_OKPO,S_NAME,S_ADRES,S_TYPE,S_TAXID,R_OKPO,R_NAME,R_ADRES,R_TYPE,'||
'R_TAXID,F_OKPO,F_NAME,F_ADRES,F_TYPE,F_TAXID,F_COUNTRY,UAH_NLS,'||
'UAH_MFO,CCY_NLS,CCY_MFO,KV,KURS,S,ALLOW_DAT,CMODE_CODE,DOC,'||
'BEG_DATE,END_DATE'
.head 5 -  Set strInput=strBind
.head 5 -  Set ss=T("select  DOC,S,
CDAT, ISNULL, NDAT, MDAT, CTYPE, CNUM_CST,
CNUM_YEAR, CNUM_NUM, MVM_FEAT,
S_OKPO,S_NAME,S_ADRES,S_TYPE,S_TAXID,
R_OKPO,R_NAME,R_ADRES,R_TYPE,R_TAXID,
F_OKPO,F_NAME,F_ADRES,F_TYPE,F_TAXID,
F_COUNTRY,UAH_NLS,UAH_MFO,CCY_NLS,CCY_MFO,
KV, KURS,ALLOW_DAT,CMODE_CODE,
beg_DATE,end_DATE
into :DOC,:S,
:CDAT,:ISNULL,:NDAT,:MDAT,:CTYPE,:CNUM_CST,
:CNUM_YEAR,:CNUM_NUM,:MVM_FEAT,
:S_OKPO,:S_NAME,:S_ADRES,:S_TYPE,:S_TAXID,
:R_OKPO,:R_NAME,:R_ADRES,:R_TYPE,:R_TAXID,
:F_OKPO,:F_NAME,:F_ADRES,:F_TYPE,:F_TAXID,
:F_COUNTRY,:UAH_NLS,:UAH_MFO,:CCY_NLS,:CCY_MFO,
:KV, :KURS, :ALLOW_DAT, :CMODE_CODE,
:BEG_DATE,:END_DATE
from vmd
WHERE dat >= :sdat AND dat-0.9999 <= :sdat2 order by F_OKPO, CDAT" )
.head 4 +  If para=0
.head 5 -  Call SqlPrepareAndExecute( hSqlAux(),T("SELECT count(*) INTO :S FROM customer
WHERE custtype in (2,3) and (date_off is null or date_off > :sdat  ) "))
.head 5 -  Call SqlFetchNext(hSqlAux(),nFetchRes)
.head 5 -  Set strBind='NAME,S,S1,S2'
.head 5 -  Set strInput=strBind
.head 5 +  If SalStrTrimX(SalStrUpperX( GetDBMS()  )) = 'ORACLE'
.head 6 -  Set ss="
SELECT oe.oe, substr(oe.name, 1,40),
       sum(iif_n(c.custtype,2,0,1,0)),sum(iif_n(c.custtype,3,0,1,0))
INTO :NN,:NAME,:S1,:S2
FROM customer c, corps co, oe
WHERE c.custtype in (2,3) AND
      (date_off is null or date_off  > to_date( :sdat  )  )  AND
      c.rnk = co.rnk (+) AND
      oe.oe (+) = trunc(co.oe/1000)*1000
GROUP BY oe.oe, substr(oe.name,1,40)  
ORDER BY 1 "
.head 5 +  Else
.head 6 -  Set ss="
SELECT oe.oe, oe.name[1,40],
       sum(iif_n(c.custtype,2,0,1,0)),sum(iif_n(c.custtype,3,0,1,0))
INTO :NN,:NAME,:S1,:S2
FROM customer c, OUTER corps co, OUTER oe oe
WHERE c.custtype in (2,3) AND
      (date_off is null or date_off > to_date( :sdat )  )  AND
      c.rnk = co.rnk (+) AND
      oe.oe (+) = trunc(co.oe/1000)*1000
GROUP BY oe.oe, oe.name[1,40]
ORDER BY 1 "
.head 4 +  If para=-1
.head 5 -  Set maska=Maska_NLS("счетов")
.head 5 +  If maska = '-'
.head 6 -  Call SalDestroyWindow(hWndForm)
.head 6 -  Return FALSE
.head 5 -  Set strBind='NLS,SK,VDAT,S1,S2,NAZN,NLS2'
.head 5 -  Set strInput='NLS,KV,DATN,S1,S2,NAME,ISO'
.head 5 -  Set ss=T("SELECT nlsa,sk,vdat,s,nazn[1,40],nlsb
INTO :NLS,:SK,:VDAT,:S,:NAZN,:NLS2
INTO :NLS,:KV,:DATN,:S,:NAME,:ISO
 FROM oper WHERE sk>0 AND sos=5 AND vdat >= :sdat  AND vdat <= :sdat2  AND
        trim( nlsa) LIKE '" || maska || "'  ORDER BY 1,2,3 " )
.head 5 -  Set ss=T("SELECT nlsa,sk,vdat,s,nazn[1,40],nlsb
INTO :NLS,:KV,:DATN,:S,:NAME,:ISO
FROM oper WHERE sk>0 AND sos=5 AND vdat >= :sdat  AND vdat <= :sdat2  AND
        trim( nlsa) LIKE '" || maska || "'  ORDER BY 1,2,3 " )
.head 5 -  ! Set ss=T("SELECT nlsa,sk,vdat,s,nazn[1,40],nlsb
INTO :NLS,:SK,:VDAT,:S,:NAZN,:NLS2
 FROM oper WHERE sk>0 AND sos=5 AND vdat >= :sdat  AND vdat <= :sdat2  AND
        trim( nlsa) LIKE '" || maska || "'  ORDER BY 1,2,3 " )
.head 4 -  ! Для налоговой декларации
.head 4 +  If para>85 and para<100
.head 5 -  Set strBind='DD,RR,PP,NMS,S2,S1,SS1'
.head 5 +  If para=99
.head 6 -  Set SDD='@ '
.head 5 +  Else
.head 6 -  Set SDD=Subs(SHAP,5,2)
.head 5 -  Set ss=
"SELECT dd,rr, pp,nms||NVL(nms1,''), formula,nls,formul1
 INTO :DD,:RR,:PP,:NMS,              :maska, :NLS,:VIDO
 FROM  nal_dec
 WHERE dd='"||SalStrTrimX(SDD)||"' ORDER BY ord "
.head 5 -  !
.head 5 -  Set N=GetIdRnk()
.head 5 -  Set N1=Val(GetOurRnk())
.head 5 +  If SqlPrepareAndExecute( hSql(),"SELECT val INTO :ISO FROM params WHERE par='APP'")
.head 6 -  Call SqlFetchNext( hSql(), nFetchRes )
.head 5 -  !
.head 5 -  Set P4= Val(SalStrLeftX(sdat,2)) /3 !! Тек.квартал
.head 5 -  Set P5=Val(SalStrRightX(sdat,4))    !! Тек год
.head 5 +  If ISO='NU'  !!  НБУ
.head 6 -  Set P4= Val(SalStrLeftX(sdat,2)) /3 !! Тек.квартал
.head 6 +  If N1 = N  !!  в центре
.head 7 -  Set nKto=1
.head 7 -  Call SalTblPopulate(tbl1,hSql(),
 "SELECT rnk,nmk FROM customer
 WHERE rnk in (SELECT rnk FROM cust_acc) AND rnk<>:N
 ORDER BY 1", TBL_FillAll)
.head 7 -  Call SalWaitCursor( FALSE)
.head 7 -  Call SalShowWindow(tbl1)
.head 6 +  Else !!  в области
.head 7 -  Set nKto=2
.head 7 -  Call PRINT()
.head 7 -  Call SalDestroyWindow(hWndForm)
.head 5 +  Else !! в КБ
.head 6 -  Set nKto=3
.head 6 -  Set P4= SalNumberRound( (Val(Subs(sdat,1,2))+1) /3 )
.head 6 -  Call PRINT()
.head 6 -  Call SalDestroyWindow(hWndForm)
.head 5 -  !
.head 4 +  Else
.head 5 -  Call PRINT()
.head 5 -  Call SalDestroyWindow(hWndForm)
.head 4 -  !
.head 4 -  Set strInput=strBind
.head 4 -  !
.head 3 +  On SAM_ReportStart
.head 4 -  Call SqlPrepare(hSql(), ss )
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 +  If para=-1
.head 6 +  If KV<40
.head 7 -  Set S1=S/100
.head 7 -  Set S2=NUMBER_Null
.head 6 +  Else
.head 7 -  Set S1=NUMBER_Null
.head 7 -  Set S2=S/100
.head 6 -  Return TRUE
.head 5 +  If para=0
.head 6 +  If NN=NUMBER_Null
.head 7 -  Set NAME='Не визначено'
.head 5 +  If para>85 and para<100
.head 6 +  If NLS =STRING_Null and maska = STRING_Null !! нет показателя
.head 7 -  Set S1=0
.head 7 -  Set S2=0
.head 7 -  Set SS1=0
.head 6 +  Else
.head 7 -  ! S1 - Сальдо или формула на дату (нарастающий итог)
.head 7 +  If maska=STRING_Null !! первичный
.head 8 -  Set NAME="SELECT BARS.NAL.nal1(:N,:DD,:RR, :sdat ) INTO :S1 FROM DUAL"
.head 7 +  Else !! сложный
.head 8 -  Set NAME="SELECT BARS.NAL."|| maska || "(:N, :sdat ) INTO :S1 FROM DUAL"
.head 7 -  If SqlPrepareAndExecute( hSqlAux(),T(NAME))
and SqlFetchNext(hSqlAux(), nFetchRes)
.head 7 +  Else
.head 8 -  Set S1=0
.head 7 -  Set SS1=S1
.head 7 -  !
.head 7 -  ! S2 - сумма пред периодов
.head 7 +  If SqlPrepareAndExecute( hSqlAux(),TIPD)
and SqlFetchNext(hSqlAux(), nFetchRes)
and S2 !=NUMBER_Null
.head 8 +  If VIDO != STRING_Null
.head 9 -  Set V5 = S1 - S2 !! текущий квартал
.head 9 -  If SqlPrepareAndExecute( hSqlAux(),
"SELECT BARS.NAL." || VIDO || "(:N, :P4, :P5, :V5)
 INTO :SS1 FROM DUAL" )
and SqlFetchNext(hSqlAux(), nFetchRes)
.head 9 +  Else
.head 10 -  Set SS1=0
.head 7 +  Else
.head 8 -  Set S2=0
.head 5 +  If para=23 ! Там декл
.head 6 -  Set S_NAME=StrDosToWinX( S_NAME)
.head 6 -  Set R_NAME=StrDosToWinX( R_NAME)
.head 6 -  Set F_NAME=StrDosToWinX( F_NAME)
.head 6 -  Set CTYPE=StrDosToWinX( CTYPE)
.head 6 -  Set S_ADRES=StrDosToWinX( S_ADRES)
.head 6 -  Set R_ADRES=StrDosToWinX( R_ADRES)
.head 6 -  Set F_ADRES=StrDosToWinX( F_ADRES)
.head 6 -  Set DOC=StrDosToWinX( DOC)
.head 5 +  If para=20 ! бюджет КБ
.head 6 -  If SqlPrepareAndExecute( hSqlAux(),
  "SELECT k0.name, k1.name,k2.name
   INTO :ISO,:TIPD,:VIDO
   FROM  kekb k0, kekb k1, kekb k2
   WHERE k0.kekb=:P AND k1.kekb=:P1 AND k2.kekb=:P2")
and SqlFetchNext(hSqlAux(), nFetchRes)
.head 6 -  Else
.head 6 -  If SqlPrepareAndExecute( hSqlAux(),
  "SELECT s INTO :S1 FROM kekb_plan WHERE kekb=:N AND yyyymm=:CC_ID")
and SqlFetchNext(hSqlAux(), nFetchRes)
.head 6 +  Else
.head 7 -  Set S1=0
.head 6 -  Set V5=-1
.head 6 -  Set P5=0
.head 6 +  If P<300000
.head 7 -  Set P5=1
.head 7 +  If P<200000
.head 8 -  Set V5=1
.head 5 +  If para=33
.head 6 -  ! проверка на 3 знака
.head 6 -  Call SqlPrepareAndExecute( hSqlAux(), "
SELECT DISTINCT t.dig INTO :nDig
FROM tabval t, sal s
WHERE t.kv=s.kv and s.nls=:NLS " )
.head 6 +  If not SqlFetchNext( hSqlAux(), nFetchRes )
.head 7 -  Return FALSE
.head 6 -  Set V1 = V1*SalNumberPower( 10,2-nDig )
.head 6 -  Set V2 = V2*SalNumberPower( 10,2-nDig )
.head 6 -  Set S1 = S1*SalNumberPower( 10,2-nDig )
.head 6 -  Set S2 = S2*SalNumberPower( 10,2-nDig )
.head 6 -  !
.head 5 -  Return TRUE
.head 4 -  Return FALSE
.head 3 +  On SAM_ReportNotify
.head 4 +  If para<0
.head 5 +  If lParam=RPT_BeforeReportHeader
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'AMFO',AMFO)
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'AQH',AQH)
.head 6 -  ! Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP',SHAP||' з '||sd1||' по '||sd2 )
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP',SHAP||' з '||strDateFrom||' по '||strDateTo )
.head 5 +  If lParam=RPT_BeforeBreakHeader1
.head 6 +  If para=-1
.head 7 -  Set ss="SELECT nms INTO :NAMV FROM accounts WHERE nls=:NLS AND kv="||Str(GetBaseVal())
.head 7 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP1',
'СКП    Дата   Рах.каси          Надходження         Видача    Призначення платежу')
.head 6 +  If para=-2
.head 7 -  Set ss="SELECT NAME INTO :NAMV FROM SK WHERE SK=:KV"
.head 7 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP1',
'СК Рах.каси       Рах.клієнта      Дата          Надходження          Видача')
.head 6 +  If para=-3
.head 7 -  Set ss="SELECT nms INTO :NAMV FROM accounts WHERE nls=:ISO AND kv="||Str(GetBaseVal())
.head 7 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP1',
'СК   Рах.клієнта       Дата            Надходження             Видача')
.head 6 -  Call SqlPrepareAndExecute( hSqlAux(),T(ss))
.head 6 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'NMS',NAMV)
.head 4 +  Else
.head 5 +  If lParam=RPT_BeforeReportHeader
.head 6 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'NREP',para)
.head 6 -  ! Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SDAT',sd1)
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SDAT',strDateFrom)
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'strBankName',GetBankName())
.head 6 -  Call SalReportSetDateTimeVar(SalNumberToWindowHandle(wParam),'DAT1',DAT1)
.head 6 -  Call SalReportSetDateTimeVar(SalNumberToWindowHandle(wParam),'DAT2',DAT2)
.head 6 +  If para=20
.head 7 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'sd1',SDD)
.head 7 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'strBankName',GetBankName())
.head 6 +  If para>85 and para<100
.head 7 +  If nKto=2 and
SqlPrepareAndExecute( hSqlAux(),
"SELECT c.nmk,c.okpo,c.adr,p.telr||', '||p.telb,p.ruk,p.buh
 INTO :DDR[1], :DDR[2], :DDR[3], :DDR[4], :DDR[5], :DDR[6]
 FROM customer c, corps p
 WHERE c.rnk=p.rnk (+) AND c.rnk=:N " )
.head 8 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 7 -  !
.head 7 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'KV',P4)
.head 7 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'GOD',P5)
.head 7 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'NBANK',
IifS(nKto=2,DDR[1],GetBankName()))
.head 7 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'OKPO',
IifS(nKto=2,DDR[2],Str(GetBankOkpo())))
.head 7 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'ADR',  DDR[3])
.head 7 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'TEL',  DDR[4])
.head 7 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP',SHAP )
.head 5 +  If lParam=RPT_BeforeBreakHeader1 and para=14
.head 6 -  Call SqlPrepareAndExecute( hSqlAux(), T("SELECT lcv,name INTO :ISO,:NAMV FROM tabval where kv=:KV"))
.head 6 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'ISO',ISO)
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'NAMV',NAMV)
.head 5 +  If lParam=RPT_BeforeBreakFooter1 and  para=9
.head 6 -  Set ss="
SELECT  sum(gl.p_icurval(a.kv,a.s,  :sdat  ))/100,
       -sum(fostn(a.accs,  :sdat ,  :sdat  ))/100
INTO :S1,:S2    FROM cc_accp z, cc_add a
WHERE z.nd=a.nd  AND  a.adds=0  AND z.mpawn=:NN "
.head 6 -  Call SqlPrepareAndExecute( hSqlAux(), T(ss))
.head 6 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 6 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'S1',S1)
.head 6 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'S2',S2)
.head 4 +  If lParam=RPT_BeforeReportFooter
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'FIO',GetUserRealName())
.head 5 +  If para=9
.head 6 -  Call SqlPrepareAndExecute( hSqlAux(),T("
SELECT sum(gl.p_icurval(a.kv,a.s,  :sdat  ))/100,
      -sum(fostn(a.accs,  :sdat ,  :sdat  ))/100
INTO :S1,:S2 FROM cc_accp z,cc_add a WHERE z.nd=a.nd AND a.adds=0"))
.head 6 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 6 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'S1',S1)
.head 6 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'S2',S2)
.head 5 +  If para>85 and para<100
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RUK',
IifS(nKto=2,DDR[5],GetGlobalOption('BOSS')))
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'GLB',
IifS(nKto=2,DDR[6],GetGlobalOption('ACCMAN')))
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 3 +  On SAM_Destroy
.head 4 -  Call SalWaitCursor( FALSE )
.head 1 +  Form Window: frm_MANY
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Лицевые счета
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  6.767"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.988"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Денежное обращение
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: sdat
.head 3 -  String: sdat2
.head 3 -  Number: para
.head 2 +  Window Variables
.head 3 -  String: maska
.head 3 -  String: maska1
.head 3 -  String: NMS
.head 3 -  String: NLS
.head 3 -  String: NLS2
.head 3 -  String: NLS_KAS
.head 3 -  Number: SK
.head 3 -  String: TT
.head 3 -  Date/Time: VDAT
.head 3 -  Number: S
.head 3 -  Number: BASEVAL
.head 3 -  Number: S1
.head 3 -  Number: S2
.head 3 -  Number: S02_32
.head 3 -  Number: S40_61
.head 3 -  Number: KOL_
.head 3 -  Number: REF
.head 3 -  Number: DOS
.head 3 -  Number: KOS
.head 3 -  Number: OSTI
.head 3 -  Number: OSTV
.head 3 -  String: NAZN
.head 3 -  String: ss1
.head 3 -  String: strRBSName
.head 3 -  String: ss2
.head 3 -  String: ND
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set BASEVAL = GetBaseVal()
.head 4 -  Set maska = Maska_NLS(  IifS( para=2, "СКП" ,  "счетов" ) )
.head 4 -  ! If ( para=2 or para=1) 
.head 4 +  ! Else
.head 5 -          Set maska = Maska_NLS(  "счетов"  )
.head 4 +  If SalStrTrimX(SalStrUpperX(GetDBMS()))='ORACLE'
.head 5 -  Set strRBSName = GetGlobalOption( 'RNBURBCK' )
.head 5 -  Set ID = GetUserId()
.head 5 +  If strRBSName
.head 6 -  ! ! Make end of transaction and start new
.head 6 -  Call SqlCommit( hSql() )
.head 6 -  ! ! to avoid error with set transaction...
.head 6 -  Call SqlPrepareAndExecute( hSql(), 'SET TRANSACTION USE ROLLBACK SEGMENT ' || SalStrUpperX( strRBSName ) )
.head 5 +  If not SqlPLSQLCommand(hSql(), "P_KJ(ID, sdat,sdat2)")
.head 6 -  Return FALSE
.head 5 +  ! If not SqlPLSQLCommand(hSql(), "P_KJ(ID, '11-09-2001','11-09-2001')")   --- this works 
.head 6 -          Return FALSE
.head 4 -  Set strBind = 'NLS,SK,VDAT,S1,S2,S,NAZN,NLS2,REF,TT'
.head 4 -  Set strInput=strBind
.head 4 +  If para = 1 !! 84
.head 5 +  If maska = '-'
.head 6 -  Call SalDestroyWindow(hWndForm)
.head 5 -  Set maska1 = Maska_NLS("СКП")
.head 5 +  If maska1 = '-'
.head 6 -  Call SalDestroyWindow(hWndForm)
.head 5 -  Set ss1 = T("
    SELECT nls, sk, fdat ,s, kas,ref, tt
    INTO :NLS,:SK,:VDAT,:S,:NLS2,:REF, :TT
    FROM tmp_kj
    WHERE id=:ID and nls LIKE '" || maska || "'
             and sk LIKE '" || maska1 || "'
   ORDER BY 1,2,3")
.head 4 +  If para = 2
.head 5 +  ! If maska = '-'
.head 6 -          Call SalDestroyWindow(hWndForm)
.head 5 -  Set ss1 = T("
    SELECT kas,sk,nls, fdat ,s,ref
    INTO :NLS2,:SK,:NLS,:VDAT,:S,:REF
    FROM tmp_kj
    WHERE id=:ID and sk LIKE '" || maska || "'
    ORDER BY 2,1,3,4,5")
.head 4 +  If para = 3 !! 7
.head 5 +  If maska = '-'
.head 6 -  Call SalDestroyWindow(hWndForm)
.head 5 -  Set ss1 = T("
    SELECT kas, sk, nls,fdat, s , ref
    INTO :NLS2,:SK,:NLS,:VDAT,:S,:REF
    FROM tmp_kj
    WHERE id=:ID and kas LIKE '" || maska || "'
    ORDER BY 1,2,3,4,5")
.head 4 +  If para = 4 !! 131
.head 5 -  Set strBind =
'NLS,SK,VDAT,S1,S2,DOS,KOS,OSTV,OSTI,S02_32,S40_61'
.head 5 -  Set ss1 = T("
    SELECT s.dos,s.kos,s.ost,s.ost+s.dos-s.kos,
          t.kas,t.sk, t.fdat, Sum(t.s)
    INTO :DOS,:KOS,:OSTI,:OSTV,:NLS,:SK,:VDAT,:S
    FROM tmp_kj t, sal s
    WHERE t.id=:ID and t.fdat=s.fdat and t.acc=s.acc AND
          s.nls LIKE '" || maska || "'
    GROUP BY s.dos,s.kos,s.ost,s.ost+s.dos-s.kos, t.kas,t.sk,t.fdat
    ORDER BY t.kas,t.sk")
.head 4 +  If para = 5 !! 141   (OAB 17.12.2001)
.head 5 -  Set strBind =
'NLS,SK,VDAT,S1,S2,DOS,KOS,OSTV,OSTI,S02_32,S40_61'
.head 5 -  Set ss1 = T("
    SELECT substr(t.kas,1,4), t.sk, t.fdat, Sum(t.s),
           Sum(s.dos),Sum(s.kos),Sum(s.ost),Sum(s.ost+s.dos-s.kos)
    INTO :NLS,:SK,:VDAT,:S,:DOS,:KOS,:OSTI,:OSTV
    FROM tmp_kj t, sal s
    WHERE t.id=:ID and t.fdat=s.fdat and t.acc=s.acc AND
          substr(s.nls,1,4) LIKE '" || maska || "'
    GROUP BY substr(t.kas,1,4),t.sk,t.fdat
    ORDER BY substr(t.kas,1,4) ,t.sk")
.head 4 +  If para=10
.head 5 -  Set strBind='NLS2,NMS,NLS,S,VDAT,ND,SK'
.head 5 -  Set ss1 = T("
SELECT t.kas,  t.nls,  c.nmk,  t.fdat,   t.SK,  t.s/100, t.nd
 FROM customer c, cust_acc cu, tmp_kj t
 INTO :NLS2, :NLS, :NMS, :VDAT, :SK,  :S,  :ND
WHERE C.RNK=Cu.RNK and Cu.ACC=t.ACC and
       t.fdat >=  :sdat   and t.fdat <=  :sdat2   AND
          t.nls LIKE '" || maska || "'
      ORDER BY t.kas,  t.nls,   t.fdat,   t.nd,  t.sk")
.head 4 +  If para = 11 !! 134
.head 5 +  If maska = '-'
.head 6 -  Call SalDestroyWindow(hWndForm)
.head 5 -  Set ss1 = T("
    SELECT p.nls,decode(p.tt,o.tt,o.sk,t.sk),p.fdat,p.s,
           o.nlsb,p.ref, p.tt
    INTO :NLS,:SK,:VDAT,:S,:NLS2,:REF,:TT
    FROM oper o, opl p, tts t
    WHERE o.ref=p.ref and o.sk>0 and p.sos=5 and
          p.fdat>= :sdat  and p.fdat<= :sdat2  and
          p.nls<>o.nlsb and p.tt=t.tt and p.kv=980 and
          p.nls LIKE '" || maska || "'
    ORDER BY 1,2,3")
.head 4 -  ! ==================================================
.head 4 -  ! Начинаем печать в отчет
.head 4 -  ! ==================================================
.head 4 -  Set strInput = strBind
.head 4 -  Call SalReportPrintToFile(hWndForm, 
                                             strTmplPath, 
                                             strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                             strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 -  Call SalWaitCursor( FALSE )
.head 4 +  If (nInd > 0 )
.head 5 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )
.head 5 -  Return -1
.head 4 -  ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 4 -  Set frm_Out.dfPath = strPrintPath
.head 4 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 4 -  Call SalDestroyWindow(hWndForm)
.head 3 +  On SAM_ReportStart
.head 4 -  Call SqlPrepare(hSql(), ss1)
.head 4 -  Set NLS_KAS=''
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 +  If NLS_KAS!=NLS
.head 6 -  Set S02_32=0
.head 6 -  Set S40_61=0
.head 6 -  Set NLS_KAS=NLS
.head 5 +  If SK<40
.head 6 -  Set S1=S/100
.head 6 -  Set S2=NUMBER_Null
.head 6 -  Set S40_61=NUMBER_Null
.head 6 +  If SK<33
.head 7 -  Set S02_32=S02_32+S1
.head 7 -  Set NLS_KAS=NLS
.head 7 -  Set KOL_=NUMBER_Null
.head 6 +  If SK>=32
.head 7 -  Set KOL_=KOL_+1
.head 6 +  If SK>32 AND KOL_>=1
.head 7 -  Set S02_32=NUMBER_Null
.head 5 +  Else
.head 6 -  Set S1=NUMBER_Null
.head 6 -  Set S2=S/100
.head 6 +  If (S40_61>0) OR (NLS != NLS_KAS) OR KOL_>=1
.head 7 -  Set S02_32=NUMBER_Null
.head 6 +  If SK>61 AND KOL_>=1
.head 7 -  Set S40_61=NUMBER_Null
.head 6 +  If SK>39 and SK<62
.head 7 -  Set S40_61=S40_61+S2
.head 7 -  Set NLS_KAS=NLS
.head 7 -  Set KOL_=NUMBER_Null
.head 6 +  If SK>=61
.head 7 -  Set KOL_=KOL_+1
.head 5 -  Return TRUE
.head 4 +  Else
.head 5 -  Return FALSE
.head 3 +  On SAM_ReportNotify
.head 4 +  If S02_32>0 AND SK>39
.head 5 -  Set S02_32=NUMBER_Null
.head 5 -  Set S40_61=NUMBER_Null
.head 4 +  If lParam=RPT_BeforeReportHeader
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'AMFO',AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'AQH',AQH)
.head 5 +  If para = 4 or para = 5 !! 131,141
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP',SHAP||' за '||strDateFrom )
.head 5 +  Else
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP',SHAP||' з '||strDateFrom||' по '||strDateTo )
.head 4 +  If lParam=RPT_BeforeBreakHeader1
.head 5 +  If para=1
.head 6 -  Set ss2="SELECT nms INTO :NMS FROM accounts WHERE nls=:NLS AND kv=:BASEVAL"
.head 5 +  If para=2
.head 6 -  Set ss2="SELECT NAME INTO :NMS FROM SK WHERE SK=:SK"
.head 5 +  If para=11
.head 6 -  Set ss2="SELECT  nms INTO :NMS FROM accounts  WHERE nls=:NLS AND kv=:BASEVAL"
.head 5 +  If para=3
.head 6 -  Set ss2="SELECT nms INTO :NMS FROM accounts WHERE nls=:NLS2 AND kv=:BASEVAL"
.head 5 +  If para<4 or para=11
.head 6 -  Call SqlPrepareAndExecute( hSqlAux2(),T(ss2))
.head 6 -  Call SqlFetchNext(hSqlAux2(), nFetchRes)
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'NMS',NMS)
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 3 +  On SAM_Destroy
.head 4 -  Call SalWaitCursor( FALSE )
.head 1 +  Form Window: frm_Month     !! Сумма накопленых оборотов за месяц
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Баланс банка
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  7.125"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.563"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Сумма накопленых оборотов за месяц
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 +  Functions
.head 3 +  Function: GetExecList
.head 4 -  Description: Получение списка исполнителей в виде условия к SQL SELECT
.head 4 +  Returns
.head 5 -  Number:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Return SalModalDialog( dlg_MonthAdd, hWndMDI )
.head 2 +  Window Parameters
.head 3 -  String: sdat
.head 3 -  String: sdat2
.head 3 -  Number: para
.head 2 +  Window Variables
.head 3 -  Number: KV
.head 3 -  Number: NBS
.head 3 -  Number: DOS
.head 3 -  Number: KOS
.head 3 -  Number: OSTVD
.head 3 -  Number: OSTVK
.head 3 -  Number: OSTID
.head 3 -  Number: OSTIK
.head 3 -  String: NMS
.head 3 -  String: maska
.head 3 -  !
.head 3 -  Boolean: fFetch
.head 3 -  ! !
.head 3 -  String: sEqSimble
.head 3 -  !
.head 3 -  Number: nDig
.head 3 -  String: sExecList
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set maska='-'
.head 4 -  Set maska=Maska_NLS("счетов")
.head 4 +  If maska='-'
.head 5 -  Call SalDestroyWindow(hWndForm)
.head 5 -  Call WaitCursorOff()
.head 4 -  Call WaitCursorOn()
.head 4 -  Set strInput='KV,NBS,OSTVD,OSTVK,DOS,KOS,OSTID,OSTIK,NMS'
.head 4 -  Set strBind=strInput
.head 4 -  ! Значение para:
0(>2) - лиц. счет все счета
1 - бал. счет все счета
3 - лиц. счет нац. валюта
4 - лиц. счет ин. валюта
5 - лиц. счет нац. валюта по исп.
6 - лиц. счет ин. валюта по исп.
.head 4 -  ! Символ сравнения
.head 4 -  Set sEqSimble=''
.head 4 -  ! Доп. условие SQL SELECT для выбора исполнителей
.head 4 -  Set sExecList=''
.head 4 +  If para>2
.head 5 +  Select Case para
.head 6 +  Case 3
.head 7 -  Set sEqSimble='='
.head 7 -  Set para=1
.head 7 -  Break
.head 6 +  Case 4
.head 7 -  Set sEqSimble='<>'
.head 7 -  Set para=1
.head 7 -  Break
.head 6 +  Case 5
.head 7 -  Set sEqSimble='='
.head 7 -  Set para=1
.head 7 +  If GetExecList() !=99
.head 8 -  Call SalDestroyWindow(hWndForm)
.head 8 -  Call WaitCursorOff()
.head 7 -  Break
.head 6 +  Case 6
.head 7 -  Set sEqSimble='<>'
.head 7 -  Set para=1
.head 7 +  If GetExecList() !=99
.head 8 -  Call SalDestroyWindow(hWndForm)
.head 8 -  Call WaitCursorOff()
.head 7 -  Break
.head 4 -  ! Call SalReportPrintToFile(hWndForm, strDir, GetPrnDir() || '/'
     || IifS(FL_FORMAT, strFileName1, strFileName), strBind,
     strInput, 1, RPT_PrintAll, 1, 1, FL_FORMAT, nInd)
.head 4 -  ! ==================================================
.head 4 -  ! Начинаем печать в отчет
.head 4 -  ! ==================================================
.head 4 -  Call SalReportPrintToFile(hWndForm, 
                                              strTmplPath, 
                                              strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                              strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 +  If (nInd > 4 )
.head 5 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 4 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 4 -  Set frm_Out.dfPath = strPrintPath
.head 4 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 4 -  Call SalDestroyWindow(hWndForm)
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_ReportStart
.head 4 +  If sEqSimble
.head 5 -  Call SqlPrepare(hSql(), T(
"SELECT NLS,kv,
  NVL(fost(acc, :sdat )+
      fdos(acc, :sdat , :sdat )-
      fkos(acc, :sdat , :sdat ), 0),
  NVL(fost(acc, :sdat2 ),0),
  NVL(fdos(acc, :sdat , :sdat2 ),0),
  NVL(fkos(acc, :sdat , :sdat2 ),0),
  nms
 INTO :NBS,:KV,:OSTVD,:OSTID,:DOS,:KOS,:NMS
 FROM accounts
WHERE (dazs IS NULL or dazs>= :sdat  ) AND trim(nls) LIKE '"||maska||"' AND
  kv " || sEqSimble || SalNumberToStrX( GetBaseVal(), 0 ) ||
  sExecList || "
ORDER BY kv, SUBSTR(nls,1,4),SUBSTR(nls,6,9)"))
.head 4 +  Else
.head 5 -  Call SqlPrepare(hSql(), T(
"SELECT "||IifS(para=1,"nbs+0","NLS+0")||",kv,
  NVL(fost(acc, :sdat )+
      fdos(acc, :sdat , :sdat )-
      fkos(acc, :sdat , :sdat ), 0),
  NVL(fost(acc, :sdat2 ),0),
  NVL(fdos(acc, :sdat , :sdat2 ),0),
  NVL(fkos(acc, :sdat , :sdat2 ),0),
  nms
 INTO :NBS,:KV,:OSTVD,:OSTID,:DOS,:KOS,:NMS
 FROM accounts
WHERE (dazs IS NULL or dazs>= :sdat  ) AND trim(nls) LIKE '"||maska||"'
 " ||
sExecList || "
ORDER BY kv,SUBSTR(nls,1,4),SUBSTR(nls,6,9)"))
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  Loop
.head 5 +  If SqlFetchNext(hSql(), nFetchRes)
.head 6 -  ! проверка на 3 знака
.head 6 -  Call SqlPrepareAndExecute( hSqlAux(), "
SELECT dig INTO :nDig
FROM tabval
WHERE kv = :KV" )
.head 6 +  If not SqlFetchNext( hSqlAux(), nFetchRes )
.head 7 -  Return FALSE
.head 6 -  Set OSTVD = OSTVD*SalNumberPower( 10,2-nDig )
.head 6 -  Set OSTID = OSTID*SalNumberPower( 10,2-nDig )
.head 6 -  Set DOS   = DOS*SalNumberPower( 10,2-nDig )
.head 6 -  Set KOS   = KOS*SalNumberPower( 10,2-nDig )
.head 6 -  !
.head 6 +  If OSTVD !=0 or OSTID !=0 or DOS !=0 or KOS !=0
.head 7 +  If OSTVD <0
.head 8 -  Set OSTVK=0
.head 8 -  Set OSTVD=-OSTVD
.head 7 +  Else
.head 8 -  Set OSTVK=OSTVD
.head 8 -  Set OSTVD=0
.head 7 +  If OSTID <0
.head 8 -  Set OSTIK=0
.head 8 -  Set OSTID=-OSTID
.head 7 +  Else
.head 8 -  Set OSTIK=OSTID
.head 8 -  Set OSTID=0
.head 7 -  Return TRUE
.head 5 +  Else
.head 6 -  Return FALSE
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam=RPT_BeforeReportHeader
.head 5 -  ! Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'B_date', sd1)
.head 5 -  ! Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'E_date', sd2)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'B_date', strDateFrom)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'E_date', strDateTo)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'SHAP1',SHAP)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'aMFO', AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'aQH', AQH)
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 3 -  On SAM_Destroy
.head 1 +  Form Window: frm_NLS       !! Информация по ЛС
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Лицевые счета
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  7.1"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 4.083"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Особовi рахунки
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Number: ni    !! 1 -сальдовка: 2-Только сумма оборотов: 3-средний остаток
.head 3 -  String: sdat    !! С даты
.head 3 -  String: sdat2   !! По дату
.head 2 +  Window Variables
.head 3 -  Number: KV
.head 3 -  String: NLS
.head 3 -  String: NMS
.head 3 -  Date/Time: FDAT1
.head 3 -  Number: VS1
.head 3 -  Number: DOS1
.head 3 -  Number: KOS1
.head 3 -  Number: IX1
.head 3 -  String: ss
.head 3 -  String: SHAP1
.head 3 -  String: maska
.head 3 -  Boolean: asd
.head 3 -  !
.head 3 -  Number: nDig
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set maska = Maska_NLS("счетов")
.head 4 +  If maska='-'
.head 5 -  Call SalDestroyWindow( hWndForm )
.head 5 -  Return FALSE
.head 4 -  Set strBind = 'KV,NLS,NMS,FDAT1,VS1,DOS1,KOS1,IX1'
.head 4 -  Set strInput=strBind
.head 4 +  If maska = '*'
.head 5 -  Call SalDestroyWindow(hWndForm)
.head 4 +  If ni = 1 !! -сальдовка
.head 5 -  Set ss = T("
    SELECT kv,nls,nms,fdat,(ost+dos-kos)/100,dos/100,
           kos/100,ost/100
    INTO :KV,:NLS,:NMS,:FDAT1,:VS1,:DOS1,:KOS1,:IX1
    FROM SAL
    WHERE DATE(fdat)>= :sdat  and date(fdat)<= :sdat2  and
          ((ost+dos-kos)<>0 or dos<>0 or kos<>0) and
          trim(nls) LIKE \'" || SalStrTrimX(maska) || "\'
    ORDER BY kv,nls,fdat")
.head 5 -  Set SHAP1 = 'Дата        Вхідний залишок         Дебет' ||
    '           Кредит    Вихідний залишок'
.head 4 +  If ni = 2 !! Только сумма оборотов
.head 5 -  Set ss = T("
    SELECT kv,nls,nms,SUM(dos)/100,SUM(kos)/100,
           SUM(gl.p_icurval(kv,dos,fdat))/100,
           SUM(gl.p_icurval(kv,kos,fdat))/100
    INTO :KV,:NLS,:NMS,:DOS1,:KOS1,:VS1,:IX1
    FROM SAL
    WHERE date(fdat)>= :sdat  and date(fdat) <= :sdat2  and
          dos+kos<>0 and trim(nls) LIKE \'" ||
          SalStrTrimX(maska) || "\'
    GROUP BY kv,nls,nms
    ORDER BY nls,kv")
.head 5 -  Set SHAP1 = '  ВАЛ             Обороти-Дебет         ' ||
    'Обороти-Кредит'
.head 4 +  If ni = 3 !! средний остаток
.head 5 -  Set ss = T("
    SELECT kv,nls,nms,SUM(ost)/100,COUNT(fdat),
           (ROUND(SUM(ost)/COUNT(fdat),0))/100
    INTO :KV,:NLS,:NMS,:VS1,:DOS1,:IX1
    FROM SAL
    WHERE date(fdat)>= :sdat  and date(fdat) <= :sdat2  and
          trim(nls) LIKE \'" || SalStrTrimX(maska) || "\'
    GROUP BY kv,nls,nms
    ORDER BY nls,kv")
.head 5 -  Set SHAP1 = ' ВАЛ          Сума залишків       Кількість' ||
    ' дат     Середній залишок'
.head 4 +  If ni = 4 !! -сальдовка  исполнителя
.head 5 -  Set ss = T("
    SELECT kv,nls,nms,fdat,(ost+dos-kos)/100,dos/100,
           kos/100,ost/100
    INTO :KV,:NLS,:NMS,:FDAT1,:VS1,:DOS1,:KOS1,:IX1
    FROM SAL
    WHERE DATE(fdat)>= :sdat  and date(fdat)<= :sdat2  and
          ((ost+dos-kos)<>0 or dos<>0 or kos<>0) and  isp=:ID and
          trim(nls) LIKE \'" || SalStrTrimX(maska) || "\'
    ORDER BY kv,nls,fdat")
.head 5 -  Set SHAP1 = 'Дата        Вхідний залишок         Дебет' ||
    '           Кредит    Вихідний залишок'
.head 4 -  Call SalHideWindow(hWndForm)
.head 4 -  Call SalWaitCursor(TRUE)
.head 4 -  ! Call SalReportPrintToFile(hWndForm, strDir, GetPrnDir() || '/'
     || IifS(FL_FORMAT, strFileName1, strFileName), strBind,
     strInput, 1, RPT_PrintAll, 1, 1, FL_FORMAT, nInd)
.head 4 -  ! ==================================================
.head 4 -  ! Начинаем печать в отчет
.head 4 -  ! ==================================================
.head 4 -  Call SalReportPrintToFile(hWndForm, 
                                              strTmplPath, 
                                              strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                              strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 +  If (nInd > 4 )
.head 5 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 4 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 4 -  Set frm_Out.dfPath = strPrintPath
.head 4 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 4 -  Call SalWaitCursor(FALSE)
.head 4 -  Call SalDestroyWindow(hWndForm)
.head 3 +  On SAM_ReportStart
.head 4 -  Return SqlPrepare(hSql(),ss)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 -  ! Return SqlFetchNext(hSql(), nFetchRes)
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 -  ! проверка на 3 знака
.head 5 -  Call SqlPrepareAndExecute( hSqlAux(), "
SELECT dig INTO :nDig
FROM tabval
WHERE kv = :KV" )
.head 5 +  If not SqlFetchNext( hSqlAux(), nFetchRes )
.head 6 -  Return FALSE
.head 5 -  Set VS1  = VS1*SalNumberPower( 10,2-nDig )
.head 5 -  Set DOS1 = DOS1*SalNumberPower( 10,2-nDig )
.head 5 -  Set KOS1 = KOS1*SalNumberPower( 10,2-nDig )
.head 5 -  Set IX1  = IX1*SalNumberPower( 10,2-nDig )
.head 5 -  !
.head 5 -  Return TRUE
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam = RPT_BeforeReportHeader
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'AMFO', AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'AQH', AQH)
.head 5 -  ! Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'SHAP', SHAP || ' з ' || sd1 || ' по ' || sd2)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'SHAP', SHAP || ' з ' || strDateFrom || ' по ' || strDateTo)
.head 5 +  If ni=4
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'IDNAME', IDNAME)
.head 4 +  If lParam = RPT_BeforeBreakHeader1
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'SHAP1', SHAP1)
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg(frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 3 +  On SAM_Destroy
.head 4 -  Call SalWaitCursor(FALSE)
.head 1 +  Form Window: frm_OBMEN     !! отчет по обмену наличной валюты
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Баланс банка
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  7.125"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.563"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Number: ni
.head 3 -  String: sdat
.head 3 -  String: sdat2
.head 2 +  Window Variables
.head 3 -  String: FIO
.head 3 -  String: ss
.head 3 -  String: ISO
.head 3 -  String: NAME
.head 3 -  Number: DIG
.head 3 -  Number: BSUM
.head 3 -  Number: NPP
.head 3 -  Number: DIGN
.head 3 -  Number: KV
.head 3 -  Number: SV1
.head 3 -  Number: SN1
.head 3 -  Number: SV2
.head 3 -  Number: SN2
.head 3 -  Number: K1
.head 3 -  Number: K2
.head 3 -  Number: n980
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call WaitCursorOn()
.head 4 -  Set n980=GetBaseVal()
.head 4 -  Set strBind = 'NPP,KV,ISO,NAME,SV1,SN1,K1,SV2,SN2,K2' !! наши переменные
.head 4 -  Set strInput=strBind
.head 4 -  !
.head 4 +  If ni=0 !! По банку
.head 5 -  Set ss=T("
 SELECT o.KV,SUM(o.S*o.dk),SUM(o.S2*o.dk),SUM(o.S*(1-o.dk)),SUM(o.S2*(1-o.dk))
 INTO :KV,:SV1,:SN1,:SV2,:SN2
 FROM oper o, tts t
 WHERE o.sos=5 AND o.tt=t.tt  AND t.flv=1 AND o.nlsa[1,3]='100' AND o.nlsb[1,3]='100' AND
   o.kv<>:n980 AND o.kv2=:n980 AND
   o.vdat >= :sdat  AND o.vdat<= :sdat2
 GROUP BY o.KV ORDER BY o.KV ")
.head 4 +  Else If ni<0 !! По отделу
.head 5 +  If SqlPrepareAndExecute( hSql(),
   "SELECT o.id,o.name   INTO :K1,:FIO
    FROM otd_user u, otdel o
    WHERE u.userid=:ID AND o.id=u.otd" )
and SqlFetchNext(  hSql(), KV )
.head 6 -  Set ss=T("
 SELECT o.KV,SUM(o.S*o.dk),SUM(o.S2*o.dk),SUM(o.S*(1-o.dk)),SUM(o.S2*(1-o.dk))
 INTO :KV,:SV1,:SN1,:SV2,:SN2
 FROM oper o, tts t, otd_user u
 WHERE u.userid=o.userid AND u.otd="||Str(K1)||" AND
   o.sos=5 AND o.tt=t.tt  AND t.flv=1 AND o.nlsa[1,3]='100' AND
   o.kv<>:n980 AND o.kv2=:n980 AND
   o.vdat>= :sdat  AND o.vdat<= :sdat2
 GROUP BY o.KV ORDER BY o.KV ")
.head 4 +  Else !! По испол
.head 5 -  Set ss=T("
 SELECT o.KV,SUM(o.S*o.dk),SUM(o.S2*o.dk),SUM(o.S*(1-o.dk)),SUM(o.S2*(1-o.dk))
 INTO :KV,:SV1,:SN1,:SV2,:SN2
 FROM oper o, tts t
 WHERE o.userid=:ID AND o.sos=5 AND o.tt=t.tt
       AND t.flv=1 AND o.nlsa[1,3]='100' AND
   o.kv<>:n980 AND o.kv2=:n980 AND
   o.vdat>= :sdat  AND o.vdat<= :sdat2
 GROUP BY o.KV ORDER BY o.KV ")
.head 4 -  !
.head 4 -  Set NPP=0
.head 4 -  Set DIGN=100
.head 4 -  Call SalHideWindow(hWndForm)
.head 4 -  ! ==================================================
.head 4 -  ! Начинаем печать в отчет
.head 4 -  ! ==================================================
.head 4 -  Call SalReportPrintToFile(hWndForm, 
                                                        strTmplPath, 
                                                        strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                                        strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 +  If (nInd > 4 )
.head 5 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 4 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 4 -  Set frm_Out.dfPath = strPrintPath
.head 4 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 4 -  Call SalDestroyWindow(hWndForm)
.head 3 +  On SAM_ReportStart
.head 4 -  Return SqlPrepare(hSql(),ss)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext  !! вычитать очередную строку
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(),
T("SELECT t.lcv,t.name[1,16],POWER(10,t.dig), c.bsum
   INTO :ISO,:NAME,:DIG,:BSUM
   FROM tabval t, cur_rates c
   WHERE t.kv=:KV AND t.kv=c.kv AND
         c.vdate in
(SELECT MAX(c1.vdate) FROM cur_rates c1 WHERE c1.kv=c.kv)"))
.head 5 -  Call SqlFetchNext(hSqlAux(),nFetchRes)
.head 5 -  ! Set NAME=StrWinToDosX(NAME)
.head 5 -  Set NPP=NPP+1
.head 5 -  !
.head 5 +  If SV1>0
.head 6 -  Set K1=(SN1*DIG*BSUM)/(SV1*DIGN)
.head 6 -  Set SV1=SV1/DIG
.head 5 +  Else
.head 6 -  Set K1=0
.head 5 +  If SV2>0
.head 6 -  Set K2=(SN2*DIG*BSUM)/(SV2*DIGN)
.head 6 -  Set SV2=SV2/DIG
.head 5 +  Else
.head 6 -  Set K2=0
.head 5 -  !
.head 5 -  Set SN1=SN1/DIGN
.head 5 -  Set SN2=SN2/DIGN
.head 5 -  Return TRUE
.head 4 +  Else
.head 5 -  Return FALSE
.head 3 +  On SAM_ReportNotify           !! информировать ОТЧЕТ о глобальных переменных
.head 4 +  If lParam=RPT_BeforeReportHeader  !! только для заголовка
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'AMFO',AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'AQH',AQH)
.head 5 -  ! Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP',SHAP||
" "||sd1||IifS(sdat=sdat2,''," - "||sd2))
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP',SHAP||
" "||strDateFrom||IifS(sdat=sdat2,''," - "||strDateTo))
.head 5 +  If ni != 0
.head 6 -  Call SqlPrepareAndExecute(hSqlAux(),T("SELECT fio INTO :FIO FROM staff WHERE id=:ni"))
.head 6 -  Call SqlFetchNext(hSqlAux(),nFetchRes)
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'FIO',SalNumberToStrX(ni,0)||"." ||FIO)
.head 3 +  On SAM_Destroy
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 1 +  Form Window: frm_Okrug     !! Сальдовка по ВЕШАЛКАМ
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Пустышка
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   1.55"
.head 4 -  Top:    0.344"
.head 4 -  Width:  6.767"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 0.857"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Сальдовка по Веш (MIK 29-03-2001)
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: sdat
.head 2 +  Window Variables
.head 3 -  String: LCV
.head 3 -  String: NLS
.head 3 -  Number: DOS
.head 3 -  Number: KOS
.head 3 -  Number: OSTD
.head 3 -  Number: OSTK
.head 3 -  !
.head 3 -  Number: nDig
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call WaitCursorOn()
.head 4 -  Set strBind = 'LCV,NLS,DOS,KOS,OSTD,OSTK'
.head 4 -  Set strInput = strBind
.head 4 -  ! Call SalReportPrintToFile(hWndForm,strDir,GetPrnDir()||'/'|| IifS(FL_FORMAT,strFileName1,strFileName),strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 -  ! ==================================================
.head 4 -  ! Начинаем печать в отчет
.head 4 -  ! ==================================================
.head 4 -  Call SalReportPrintToFile(hWndForm, 
                                                        strTmplPath, 
                                                        strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                                        strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 +  If (nInd > 4 )
.head 5 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 4 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 4 -  Set frm_Out.dfPath = strPrintPath
.head 4 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 4 -  Call SalDestroyWindow(hWndForm)
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_ReportStart
.head 4 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'RUK',GetGlobalOption('BOSS'))
.head 4 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'GLB',GetGlobalOption('ACCMAN'))
.head 4 -  Return SqlPrepare(hSql(), T("
     SELECT t.lcv,b.nls, b.dos,b.kos,
      -decode(sign(b.ost),-1,b.ost,0),
       decode(sign(b.ost), 1,b.ost,0)
     FROM salb b,tabval t
     WHERE b.kv=t.kv AND b.fdat=:sdat AND
          (b.nls,b.kv) IN (SELECT s0000,kv from tabval)
     ORDER BY t.lcv
     INTO :LCV,:NLS,:DOS,:KOS,:OSTD,:OSTK"))
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 -  !
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 -  ! проверка на 3 знака
.head 5 -  Call SqlPrepareAndExecute( hSqlAux(), "
SELECT dig INTO :nDig
FROM tabval
WHERE lcv = :LCV" )
.head 5 +  If not SqlFetchNext( hSqlAux(), nFetchRes )
.head 6 -  Return FALSE
.head 5 -  Set DOS  = DOS*SalNumberPower( 10,-nDig )
.head 5 -  Set KOS  = KOS*SalNumberPower( 10,-nDig )
.head 5 -  Set OSTD = OSTD*SalNumberPower( 10,-nDig )
.head 5 -  Set OSTK = OSTK*SalNumberPower( 10,-nDig )
.head 5 -  !
.head 5 -  Return TRUE
.head 4 -  !
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam = RPT_BeforeReportHeader
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'aMFO', AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'aQH', AQH)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'Report_date', strRepDate)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
     'SHAP', SHAP)
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg(frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 1 +  Form Window: frm_Saldo     !! Сальдовка в номинале 33,34,35,38
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Оборотно-сальдовая ведомость
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  10.0"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 5.5"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Оборотно-сальдовая ведомость
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Child Table: tbl1 !! исполнители или валюты
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.083"
.head 6 -  Top:    0.393"
.head 6 -  Width:  9.633"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 4.155"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Dark Blue
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 3000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: Kod1
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.567"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NAME1
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: НАИМЕНОВАНИЕ
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  7.283"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set SS=T( " SELECT " || IifS(para=0,
 " id,fio FROM staff  WHERE type=1", "kv,name FROM tabval " )  || " order by 1" )
.head 6 -  Call SalTblPopulate(tbl1,hSql(), SS , TBL_FillAll)
.head 5 +  On SAM_DoubleClick
.head 6 -  Call FU_SAL(tbl1.Kod1)
.head 6 -  Call SalSetFocus(tbl1)
.head 5 +  On SAM_User
.head 6 -  Set nRow=TBL_MinRow
.head 6 +  Loop
.head 7 +  If SalTblFindNextRow (  tbl1, nRow, nTmp, 0 )
.head 8 -  Call SalTblSetContext( tbl1,nRow )
.head 8 +  If nRow >=0
.head 9 -  Call FU_SAL(tbl1.Kod1)
.head 7 +  Else
.head 8 -  Break
.head 6 -  Call SalSendMsg( tbl1, SAM_Create, 0, 0 )
.head 3 +  Pushbutton: PB1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Печать выбранных
.head 4 -  Window Location and Size
.head 5 -  Left:   3.6"
.head 5 -  Top:    4.69"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Midnight Blue
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set nTmp=ROW_Selected
.head 6 -  Call SalSendMsg( tbl1, SAM_User, 0, 0 )
.head 3 +  Pushbutton: PB2
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Печать ВСЕХ
.head 4 -  Window Location and Size
.head 5 -  Left:   1.0"
.head 5 -  Top:    4.69"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Midnight Blue
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set nTmp=0
.head 6 -  Call SalSendMsg( tbl1, SAM_User, 0, 0 )
.head 3 +  Pushbutton: PB3 !! завершить
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Завершить
.head 4 -  Window Location and Size
.head 5 -  Left:   6.2"
.head 5 -  Top:    4.69"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Black
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalDestroyWindow(frm_Saldo)
.head 3 +  Radio Button: rb_All
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Все счета
.head 4 -  Window Location and Size
.head 5 -  Left:   0.1"
.head 5 -  Top:    0.071"
.head 5 -  Width:  2.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Radio Button: rb_Rab
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Рабочие счета
.head 4 -  Window Location and Size
.head 5 -  Left:   3.017"
.head 5 -  Top:    0.071"
.head 5 -  Width:  2.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Radio Button: rb_Ob
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Счета с оборотами
.head 4 -  Window Location and Size
.head 5 -  Left:   5.933"
.head 5 -  Top:    0.071"
.head 5 -  Width:  2.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 2 +  Functions
.head 3 +  Function: FU_SAL
.head 4 -  Description: Печать сальдовки по ОДНОМУ
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nP11
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  Set strFileNameTxt  = SalStrLeftX( strFileNameTxt, 5) || NumberToStrFormat (nP11, 3) || '.txt'
.head 5 +  If para=3
.head 6 -  Set SS = T("
 SELECT app,kv,nbs+0,nls,ost/100,dos/100,kos/100,nms,isp
 INTO :dtFdat,:nKv,:nBal,:nNls,:nOstf,:nDos,:nKos,:sNms,:ISPO
 FROM sal
 WHERE " || "kv=" || Str(nP11) ||
      IifS(rb_Rab, " and (dos>0 or kos>0 or ost<>0)",
      IifS(rb_Ob, " AND (dos>0 or kos>0)", "")) || " and
      (dazs IS NULL or dazs> :sDat ) and
      fdat= :sDat " || IifS(maska!='%', " and
      trim(nls) LIKE \'" || SalStrTrimX(maska) || "\'", '') || "
 ORDER BY kv,SUBSTR(nls,1,4) || SUBSTR(nls,6,9)")
.head 5 +  Else
.head 6 -  Set SS = T("
    SELECT dapp,kv,nbs+0,nls,ost/100,dos/100,kos/100,nms,isp
    INTO :dtFdat,:nKv,:nBal,:nNls,:nOstf,:nDos,:nKos,:sNms,
         :ISPO
    FROM sal
    WHERE " || IifS(para=0, "isp=", "kv=") || Str(nP11) ||
          IifS(rb_Rab, " and (dos>0 or kos>0 or ost<>0)",
          IifS(rb_Ob, " AND (dos>0 or kos>0)", "")) || " and
          (dazs IS NULL or dazs> :sDat ) and
          fdat= :sDat " || IifS(maska!='%', " and
          trim(nls) LIKE \'" || SalStrTrimX(maska) || "\'",
          '') || "
    ORDER BY kv,SUBSTR(nls,1,4) || SUBSTR(nls,6,9)")
.head 5 -  ! ==================================================
.head 5 -  ! Начинаем печать в отчет
.head 5 -  ! ==================================================
.head 5 -  Call SalReportPrintToFile(hWndForm, strTmplPath, 
      strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
      strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 5 +  If (nInd > 4 )
.head 6 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 5 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 5 -  Set frm_Out.dfPath = strPrintPath
.head 5 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 5 +  If not FL_FORMAT
.head 6 -  Call zarez12( strPrintPath || '\\' || strFileNameTxt, frm_Out.tblReps.Kod, sDeviceDef)
.head 5 -  Call SalWaitCursor(FALSE)
.head 2 +  Window Parameters
.head 3 -  Number: para
.head 3 -  ! !! 0 -  сортировано по ИСП, ВАЛ,БС, СЧЕТУ
.head 3 -  ! !! 1 -  сортировано по 0, ВАЛ,БС, СЧЕТУ
.head 3 -  ! !! 2 - для АПБ
.head 3 -  ! !! 3 -  то же, что и 1 , но дата посл.движения- это ДЕЙСТВИТ.дата посл.движения(а не DAPP) 
.head 3 -  String: sDat ! дата
.head 3 -  Number: nP1 ! код ИСП
.head 3 -  Number: nP2 ! код ВАЛ
.head 2 +  Window Variables
.head 3 -  String: strBankMfo
.head 3 -  String: strBankName
.head 3 -  !
.head 3 -  Number: nKv
.head 3 -  Number: nBal
.head 3 -  Number: nTmp
.head 3 -  Number: ISPO
.head 3 -  String: ISP
.head 3 -  String: sPdat
.head 3 -  Date/Time: dtFdat
.head 3 -  Number: nNls
.head 3 -  Number: nDos
.head 3 -  Number: nKos
.head 3 -  Number: nOstf
.head 3 -  Number: nOstfD
.head 3 -  Number: nOstfK
.head 3 -  Number: nOsti
.head 3 -  Number: nOstiD
.head 3 -  Number: nOstiK
.head 3 -  String: sNms
.head 3 -  String: sKv
.head 3 -  String: sIsp
.head 3 -  String: sGrB
.head 3 -  String: SS
.head 3 -  String: maska
.head 3 -  String: NAMV
.head 3 -  String: sP1
.head 3 -  ! Number: nto
.head 3 -  Number: nRow
.head 3 -  !
.head 3 -  Number: nDig
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set strBind = 'nKv,nBal,dtFdat,nNls,nDos,nKos,nOstiD,nOstiK,sNms,ISPO'
.head 4 -  Set rb_Rab = TRUE
.head 4 -  Set strInput = 'KV,NBS,FDAT,NLS,DOS,KOS,OSTID,OSTIK,NMS,ISPO'
.head 4 -  Call SalHideWindow(tbl1)
.head 4 -  Call SalHideWindow(PB1)
.head 4 -  Call SalHideWindow(PB3)
.head 4 +  If para=2  !! сальдовка АПБ
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  Set sP1 = IifS(para=2, 'c.nls[12,14]', 'c.nls[7,8]')
.head 5 -  Set SS = T("
    SELECT iif_d(a.fdat, :sDat ,a.pdat,a.fdat,a.fdat),
           a.fdat," || sP1 ||
           ",c.nls,(a.ostf-a.dos+a.kos)/100,
           iif_d(a.fdat, :sDat ,0,a.dos,0)/100,
           iif_d(a.fdat, :sDat ,0,a.kos,0)/100,c.nms,t.name
    FROM saldoa a, accounts c, tabval t
    WHERE c.acc=a.acc and c.kv=t.kv and c.kv=980 and
          a.fdat IN (SELECT max(b.fdat)
                     FROM saldoa b
                     WHERE a.acc=b.acc and b.fdat<= :sDat
                     GROUP BY b.acc) and " || sP1 ||
                           " >= 0 and c.nls[1,4] in
                           ('3902','3903')
    ORDER BY 3,4
    INTO :sPdat,:dtFdat,:nBal,:nNls,:nOstf,:nDos,:nKos,
         :sNms,:NAMV")
.head 5 -  ! Call SalReportPrintToFile(hWndForm, strDir, GetPrnDir() ||
     '/'|| IifS(FL_FORMAT, strFileName1, strFileName),
     strBind, strInput, 1, RPT_PrintAll, 1, 1, FL_FORMAT,
     nInd)
.head 5 -  ! ==================================================
.head 5 -  ! Начинаем печать в отчет
.head 5 -  ! ==================================================
.head 5 -  Call SalReportPrintToFile(hWndForm, 
                                              strTmplPath, 
                                              strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                              strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 5 +  If (nInd > 4 )
.head 6 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 5 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 5 -  Set frm_Out.dfPath = strPrintPath
.head 5 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 5 -  Call SalWaitCursor(FALSE)
.head 5 -  Call SalDestroyWindow(frm_Saldo)
.head 4 +  Else
.head 5 -  Set maska = Maska_NLS("счетов")
.head 5 +  If maska = '-'
.head 6 -  Call SalDestroyWindow(hWndForm)
.head 6 -  Return FALSE
.head 5 +  If nP1 > 0
.head 6 -  Call FU_SAL(nP1)
.head 6 -  Call SalDestroyWindow(frm_Saldo)
.head 5 +  Else
.head 6 -  Call SalShowWindow(tbl1)
.head 6 -  Call SalShowWindow(PB1)
.head 6 -  Call SalShowWindow(PB3)
.head 3 +  On SAM_ReportStart
.head 4 -  Call SqlPrepare(hSql(),SS)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 -  ! проверка на 3 знака
.head 5 -  Call SqlPrepareAndExecute( hSqlAux(), "
SELECT dig INTO :nDig
FROM tabval
WHERE kv = :nKv" )
.head 5 +  If not SqlFetchNext( hSqlAux(), nFetchRes )
.head 6 -  Return FALSE
.head 5 -  Set nOstf = nOstf*SalNumberPower( 10,2-nDig )
.head 5 -  Set nDos  = nDos*SalNumberPower( 10,2-nDig )
.head 5 -  Set nKos  = nKos*SalNumberPower( 10,2-nDig )
.head 5 -  !
.head 5 -  Set nOstiD = IifN(nOstf<0,-nOstf,0)
.head 5 -  Set nOstiK = IifN(nOstf<0,0,nOstf)
.head 5 +  If para = 1 or para=3
.head 6 -  Set ISPO =NUMBER_Null
.head 5 -  Return TRUE
.head 5 -  !
.head 4 +  Else
.head 5 -  Return FALSE
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam=RPT_BeforeBreakHeader1  !! исполнитель
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'aMFO',  AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'aNAME', AQH)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'Report_date', strRepDate)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'SHAP',  SHAP)
.head 5 -  Call SqlPrepareAndExecute( hSqlAux(),T("SELECT fio INTO :ISP FROM  staff WHERE id=:ISPO "  ) )
.head 5 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'ISP',ISP)
.head 4 +  If lParam=RPT_BeforeBreakHeader2
.head 5 -  Call SqlPrepareAndExecute( hSqlAux(),T("SELECT lcv||' '||name INTO :NAMV FROM  tabval WHERE kv=:nKv" ) )
.head 5 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'NAMV',NAMV)
.head 4 +  If lParam=RPT_BeforeBreakFooter1
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'ISP',IifS(para=0,ISP,''))
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 3 -  On SAM_Destroy
.head 1 +  Form Window: frm_SaldoB    !! Сальдовка по БС в номинале и экв
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Оборотно-сальдовая ведомость
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  5.35"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 2.583"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Оборотно-сальдовая ведомость по БС 71,22,60
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Radio Button: rb_All
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Все счета
.head 4 -  Window Location and Size
.head 5 -  Left:   1.217"
.head 5 -  Top:    0.226"
.head 5 -  Width:  2.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Radio Button: rb_Rab
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Рабочие счета
.head 4 -  Window Location and Size
.head 5 -  Left:   1.217"
.head 5 -  Top:    0.595"
.head 5 -  Width:  2.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Radio Button: rb_Ob
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Счета с оборотами
.head 4 -  Window Location and Size
.head 5 -  Left:   1.217"
.head 5 -  Top:    0.976"
.head 5 -  Width:  2.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Pushbutton: pb_Print
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cpbExecute
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Формировать
.head 4 -  Window Location and Size
.head 5 -  Left:   1.85"
.head 5 -  Top:    1.595"
.head 5 -  Width:  1.6"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call WaitCursorOn()
.head 6 +  If GetBankMfo()='220101107' 
.head 7 +  If xx = 60 ! отчет 60
.head 8 -  Set rab = T("
    SELECT s.nbs, substr(s.NLSALT, 1, 4), t.lcv, t.kv,
           SUM(s.ost)/100, SUM( gl.p_icurval(T.kv,s.ost,s.fdat))/100           
    INTO :BAL, :NLSALT, :LCV, :KV, :OSTID,:EOSD
    FROM sal s, tabval t
    WHERE (s.dazs IS NULL OR s.dazs> :sDat  ) AND 
          s.kv=t.kv and s.fdat= :sDat  AND
         trim(s.nls) LIKE '" || maska || "'
    group BY s.nbs, substr(s.NLSALT, 1, 4 ), t.lcv, T.KV 
    ORDER BY 1,2,3")
.head 7 +  Else If xx = 160 
.head 8 -  Set rab = T("
    SELECT s.nbs, substr(s.NLSALT, 1, 4), t.lcv, t.kv,
           SUM(s.ost)/100, SUM( gl.p_icurval(T.kv,s.ost,s.fdat))/100           
    INTO :BAL, :NLSALT, :LCV, :KV, :OSTID,:EOSD
    FROM sal s, tabval t
    WHERE " ||
          IifS(NBS>0, "substr(s.nls,1,1)<>:NBS and ", "") ||
      IifS(frm_SaldoB.rb_Rab," (s.dos>0 or s.kos>0 or s.ost<>0) and ",
      IifS(frm_SaldoB.rb_Ob, " (s.dos>0 or s.kos>0) and ", "")) ||
         " (s.dazs IS NULL OR s.dazs> :sDat  ) AND 
          s.kv=t.kv and s.fdat= :sDat  AND
         trim(s.nls) LIKE '" || maska || "'
    group BY s.nbs, substr(s.NLSALT, 1, 4 ), t.lcv, T.KV 
    ORDER BY 2,1,3")
.head 7 +  Else If xx = 57 
.head 8 -  Set rab = T("
    SELECT s.nbs,s.nls,s.kv,t.lcv,s.nms, s.dapp, s.ost/100,
           gl.p_icurval(s.kv,s.ost,s.fdat)/100,
           s.NLSALT, TO_NUMBER(SUBSTR(S.NLSALT,1,4) )
    INTO :BAL, :NLS, :KV, :LCV, :NMS, :FDAT, :OSTID,:EOSD,
         :NLSALT, :ISP
    FROM sal s, tabval t
    WHERE " ||
      IifS(NBS>0, "substr(s.nls,1,1)<>:NBS and ", "") ||
      IifS(frm_SaldoB.rb_Rab," (s.dos>0 or s.kos>0 or s.ost<>0) and ",
      IifS(frm_SaldoB.rb_Ob, " (s.dos>0 or s.kos>0) and ", "")) ||
      " (s.dazs IS NULL OR s.dazs> :sDat  ) AND s.kv=t.kv and s.fdat= :sDat  AND
        trim(s.nls) LIKE '" || maska || "'
    ORDER BY s.nbs, substr(s.NLSALT,1,4), s.kv, SUBSTR(nls,6)")
.head 7 +  Else If xx = 157 
.head 8 -  Set rab = T("
    SELECT s.nbs,s.nls,s.kv,t.lcv,s.nms, s.dapp, s.ost/100,
           gl.p_icurval(s.kv,s.ost,s.fdat)/100,
           s.NLSALT, TO_NUMBER(SUBSTR(S.NLSALT,1,4) )
    INTO :BAL, :NLS, :KV, :LCV, :NMS, :FDAT, :OSTID,:EOSD,
         :NLSALT, :ISP
    FROM sal s, tabval t
    WHERE " ||
      IifS(NBS>0, "substr(s.nls,1,1)<>:NBS and ", "") ||
      IifS(frm_SaldoB.rb_Rab," (s.dos>0 or s.kos>0 or s.ost<>0) and ",
      IifS(frm_SaldoB.rb_Ob, " (s.dos>0 or s.kos>0) and ", "")) ||
      " (s.dazs IS NULL OR s.dazs> :sDat  ) AND s.kv=t.kv and s.fdat= :sDat  AND
        trim(s.nls) LIKE '" || maska || "'
    ORDER BY substr(s.NLSALT,1,4), s.nbs, s.kv, SUBSTR(nls,6)")
.head 7 +  Else If xx = 58
.head 8 -  Set rab = T("
    SELECT s.nbs,s.nls,s.kv,t.lcv,s.nms, s.dapp, s.ost/100,
           gl.p_icurval(s.kv,s.ost,s.fdat)/100,
           s.NLSALT, TO_NUMBER(SUBSTR(S.NLSALT,1,4) )
    INTO :BAL, :NLS, :KV, :LCV, :NMS, :FDAT, :OSTID,:EOSD,
         :NLSALT, :ISP
    FROM sal s, tabval t
    WHERE " ||
      IifS(NBS>0, "substr(s.nls,1,1)<>:NBS and ", "") ||
      IifS(frm_SaldoB.rb_Rab," (s.dos>0 or s.kos>0 or s.ost<>0) and ",
      IifS(frm_SaldoB.rb_Ob, " (s.dos>0 or s.kos>0) and ", "")) ||
      " (s.dazs IS NULL OR s.dazs> :sDat  ) AND s.kv=t.kv and s.fdat= :sDat  AND
        trim(s.nls) LIKE '" || maska || "'
    ORDER BY s.nbs, substr(s.NLSALT,1,4), nls, s.kv" )
.head 7 +  Else If xx = 158 
.head 8 -  Set rab = T("
    SELECT s.nbs,s.nls,s.kv,t.lcv,s.nms, s.dapp, s.ost/100,
           gl.p_icurval(s.kv,s.ost,s.fdat)/100,
           s.NLSALT, TO_NUMBER(SUBSTR(S.NLSALT,1,4) )
    INTO :BAL, :NLS, :KV, :LCV, :NMS, :FDAT, :OSTID,:EOSD,
         :NLSALT, :ISP
    FROM sal s, tabval t
    WHERE " ||
      IifS(NBS>0, "substr(s.nls,1,1)<>:NBS and ", "") ||
      IifS(frm_SaldoB.rb_Rab," (s.dos>0 or s.kos>0 or s.ost<>0) and ",
      IifS(frm_SaldoB.rb_Ob, " (s.dos>0 or s.kos>0) and ", "")) ||
      " (s.dazs IS NULL OR s.dazs> :sDat  ) AND s.kv=t.kv and s.fdat= :sDat  AND
        trim(s.nls) LIKE '" || maska || "'
    ORDER BY substr(s.NLSALT,1,4), s.nbs,  nls, s.kv ")
.head 6 +  Else
.head 7 +  If xx = 0 !! Сальдовка
.head 8 -  Set rab = T("
    SELECT s.nbs,s.nls,s.kv,t.lcv,s.nms,s.dapp, s.dos/100,s.kos/100,s.ost/100,
           gl.p_icurval(s.kv,s.ost,s.fdat)/100,s.isp
    INTO :BAL,:NLS,:KV,:LCV,:NMS,:FDAT,:DOS,:KOS,:OSTID,:EOSD,:ISP
    FROM sal s, tabval t
    WHERE " ||
      IifS(NBS>0, "substr(s.nls,1,1)<>:NBS and ", "") ||
      IifS(frm_SaldoB.rb_Rab," (s.dos>0 or s.kos>0 or s.ost<>0) and ",
      IifS(frm_SaldoB.rb_Ob, " (s.dos>0 or s.kos>0) and ", "")) ||
      " (s.dazs IS NULL OR s.dazs> :sDat  ) AND s.kv=t.kv and s.fdat= :sDat  AND
        trim(s.nls) LIKE '" || maska || "'
    ORDER BY 1,3,SUBSTR(nls,6)")
.head 7 +  Else If xx = 1 !! Баланс
.head 8 -  Set rab = T("
    SELECT s.nbs,s.kv,t.lcv,SUM(s.dos)/100,
           SUM(s.kos)/100,SUM(s.ost)/100,
           SUM(gl.p_icurval(s.kv,s.ost,s.fdat))/100
    INTO :BAL,:KV,:LCV,:DOS,:KOS,:OSTID,:EOSD
    FROM sal s, tabval t
    WHERE " ||
     IifS(rb_Rab, "(s.dos>0 or s.kos>0 or s.ost<>0) and ",
     IifS(rb_Ob,  "(s.dos>0 or s.kos>0) and ", "")) ||
      " s.kv=t.kv and s.fdat= :sDat  and trim(s.nls) LIKE '" ||
          maska || "'
    GROUP BY s.nbs,s.kv,t.lcv
    ORDER BY 1,3,2")
.head 7 +  Else If xx = 4 !! Оборотно-сальдовая ведомость c эквивалентами
.head 8 -  Set strBind = 'BAL,NLS,KV,LCV,NAMV,NMS,FDAT,DOS,EDOS,KOS,EKOS,OSTID,EOSD,OSTIK,EOSK,ISP'
.head 8 -  Set strInput=strBind
.head 8 -  Set rab = T("
    SELECT s.nbs, s.nls, s.kv, t.lcv, t.name, s.nms, s.app, 
           s.dos/100,gl.p_icurval(s.kv,s.dos,s.fdat)/100,
           s.kos/100,gl.p_icurval(s.kv,s.kos,s.fdat)/100,
           s.ost/100,gl.p_icurval(s.kv,s.ost,s.fdat)/100,s.isp
    INTO :BAL,:NLS,:KV,:LCV,:NAMV,:NMS,:FDAT,:DOS,:EDOS,:KOS,:EKOS,
         :OSTID,:EOSD,:ISP
    FROM sal s, tabval t
    WHERE " ||
      IifS(NBS>0, "substr(s.nls,1,1)<>:NBS and ", "") ||
      IifS(frm_SaldoB.rb_Rab," (s.dos>0 or s.kos>0 or s.ost<>0) and ",
      IifS(frm_SaldoB.rb_Ob, " (s.dos>0 or s.kos>0) and ", "")) ||
      " (s.dazs IS NULL OR s.dazs> :sDat  ) AND s.kv=t.kv AND s.fdat= :sDat  AND
        trim(s.nls) LIKE '" || maska || "'
    ORDER BY 1,3,SUBSTR(nls,6)")
.head 7 +  Else
.head 8 -  Set rab = T(
"SELECT s.nbs,s.nls,s.kv,t.lcv,s.nms,s.dapp,s.dos/100,s.kos/100,s.ost, s.isp
 INTO :BAL, :NLS,:KV,:LCV,:NMS,:FDAT,:DOS,:KOS,:OSTID, :ISP
 FROM sal s, tabval t  WHERE " ||
  IifS(NBS>0, "substr(s.nls,1,1)<>:NBS and ", "") ||
  IifS(frm_SaldoB.rb_Rab," (s.dos>0 or s.kos>0 or s.ost<>0) and ",
  IifS(frm_SaldoB.rb_Ob, " (s.dos>0 or s.kos>0) and ", "")) ||
  IifS(xx=3," s.acc in (select acc from saldo) AND ","") ||
  " s.kv=t.kv and s.fdat= :sDat  and trim(s.nls) LIKE '" || maska || "'
    ORDER BY kv, substr(nls,1,4)||substr(nls,6,9)" )
.head 6 -  ! ==================================================
.head 6 -  ! Начинаем печать в отчет
.head 6 -  ! ==================================================
.head 6 -  Call SalReportPrintToFile(hWndForm, 
                                              strTmplPath, 
                                              strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                              strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 6 +  If (nInd > 4 )
.head 7 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 6 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 6 -  Set frm_Out.dfPath = strPrintPath
.head 6 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 6 -  Call WaitCursorOff()
.head 6 -  Call SalDestroyWindow(hWndForm)
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Number: xx
.head 3 -  String: sDat
.head 3 -  String: NAMB
.head 3 -  Number: NBS
.head 2 +  Window Variables
.head 3 -  String: maska
.head 3 -  String: BAL
.head 3 -  String: KLA
.head 3 -  String: RAZ
.head 3 -  String: GRU
.head 3 -  String: NLS
.head 3 -  String: NLSALT
.head 3 -  Number: KV
.head 3 -  String: LCV
.head 3 -  String: NAMV
.head 3 -  Date/Time: FDAT
.head 3 -  Date/Time: DAPP
.head 3 -  Number: DOS
.head 3 -  Number: KOS
.head 3 -  Number: OSTID
.head 3 -  Number: OSTIK
.head 3 -  Number: EDOS
.head 3 -  Number: EKOS
.head 3 -  String: NMS
.head 3 -  Number: EOSD
.head 3 -  Number: EOSK
.head 3 -  Number: ISP
.head 3 -  !
.head 3 -  Number: nDig
.head 3 -  Number: n980
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 +  If xx = 1
.head 5 -  Call SalSetWindowText( hWndForm, 'Оборотно-сальдовый баланс' )
.head 4 -  Set n980=GetBaseVal()
.head 4 -  Set strBind = 'KLA,RAZ,GRU,BAL,NLS,KV,LCV,FDAT,DOS,KOS,OSTID,'
    || 'OSTIK,NMS,EOSD,EOSK,ISP'||
IifS( GetBankMfo()='220101107', ",NLSALT",  "")
.head 4 -  Set strInput = strBind
.head 4 -  Set nInd = RPT_NoToolbar
.head 4 -  Set maska = Maska_NLS("счетов")
.head 4 +  If maska = '-'
.head 5 -  Call SalDestroyWindow(hWndForm)
.head 5 -  Return FALSE
.head 4 -  Set rb_Rab = TRUE
.head 3 +  On SAM_ReportStart
.head 4 -  Call SqlPrepare(hSql(),rab)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 +  ! While (OSTID= 0 and  DOS = 0  and  KOS = 0)
.head 6 +              If NOT SqlFetchNext(hSql(), nFetchRes)
.head 7 -              Return FALSE
.head 5 -  ! проверка на 3 знака
.head 5 -  Call SqlPrepareAndExecute( hSqlAux(), "
SELECT dig INTO :nDig
FROM tabval
WHERE kv = :KV" )
.head 5 +  If not SqlFetchNext( hSqlAux(), nFetchRes )
.head 6 -  Return FALSE
.head 5 -  Set DOS  = DOS*SalNumberPower( 10,2-nDig )
.head 5 -  Set KOS  = KOS*SalNumberPower( 10,2-nDig )
.head 5 -  Set OSTID= OSTID*SalNumberPower( 10,2-nDig )
.head 5 -  Set EOSD = EOSD*SalNumberPower( 10,2-nDig )
.head 5 -  !
.head 5 +  If OSTID < 0
.head 6 -  Set OSTID = -OSTID
.head 6 -  Set OSTIK  = 0
.head 6 -  Set EOSD = -EOSD
.head 6 -  Set EOSK  = 0
.head 5 +  Else
.head 6 -  Set OSTIK = OSTID
.head 6 -  Set OSTID = 0
.head 6 -  Set EOSK  = EOSD
.head 6 -  Set EOSD = 0
.head 5 -  Set KLA=SalStrLeftX( BAL, 1 )
.head 5 -  Set RAZ=SalStrLeftX( BAL, 2 )
.head 5 -  Set GRU=SalStrLeftX( BAL, 3 )
.head 5 -  Return TRUE
.head 4 +  Else
.head 5 -  Return FALSE
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam=RPT_BeforeReportHeader
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'aMFO', AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'aNAME', AQH)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'Report_date',StrWinToDosX(strRepDate))
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'SHAP',SHAP)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'SHAP1',GetUserRealName())
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 1 +  Form Window: frm_SKP       !! ЗВІТ по СКП 5, 40
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Баланс банка
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  7.125"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.563"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: sdat
.head 3 -  String: sdat2
.head 2 +  Window Variables
.head 3 -  String: ss2
.head 3 -  String: NAME
.head 3 -  Number: VX
.head 3 -  Number: KV
.head 3 -  Number: SK
.head 3 -  Number: DOS
.head 3 -  Number: KOS
.head 3 -  Number: S02_32
.head 3 -  Number: S40_61
.head 3 -  String: strRBSName
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalWaitCursor(TRUE)
.head 4 -  Set S02_32=NUMBER_Null
.head 4 -  Set S40_61=NUMBER_Null
.head 4 -  Set KV=GetBaseVal()
.head 4 +  If SalStrTrimX(SalStrUpperX(GetDBMS()))='ORACLE'
.head 5 -  Set strRBSName = GetGlobalOption( 'RNBURBCK' )
.head 5 -  Set ID = GetUserId()
.head 5 +  If strRBSName
.head 6 -  ! ! Make end of transaction and start new
.head 6 -  Call SqlCommit( hSql() )
.head 6 -  ! ! to avoid error with set transaction...
.head 6 -  Call SqlPrepareAndExecute( hSql(), 'SET TRANSACTION USE ROLLBACK SEGMENT ' || SalStrUpperX( strRBSName ) )
.head 5 +  If not SqlPLSQLCommand(hSql(), "P_KJ(ID,sdat,sdat2)")
.head 6 -  Return FALSE
.head 4 -  Set strBind = 'VX,SK,DOS,KOS,S02_32,S40_61' !! наши переменные
.head 4 -  Set strInput=strBind
.head 4 -  Set ss2=T("SELECT -SUM(ost+dos-kos)/100
 INTO :VX FROM sal WHERE tip='KAS' AND kv=:KV AND fdat= :sdat ")
.head 4 +  If SqlPrepareAndExecute( hSql(),ss2 )
.head 5 -  Call SqlFetchNext(hSql(), nFetchRes)
.head 4 -  Set ss2 = T("
    SELECT t.sk, Sum(decode(t.DK,0,t.S,0))/100, SUM(decode(t.DK,1,t.S,0))/100
    INTO :SK, :DOS, :KOS
    FROM tmp_kj t
    WHERE t.id=:ID
    GROUP BY t.sk
    ORDER BY t.sk")
.head 4 -  ! Set ss2=T("
SELECT SK, SUM(decode(DK,0,S,0))/100, SUM(decode(DK,1,S,0))/100
INTO :SK, :DOS, :KOS
FROM ( Select decode(p.tt,o.tt,o.sk,t.sk) SK, p.dk DK,  p.s S
       From opldok p, oper o, tts t, accounts a
       Where o.ref=p.ref and t.tt=p.tt and a.acc=p.acc and a.tip='KAS' and
             p.fdat BETWEEN  :sdat  AND  :sdat2  and  o.sos=5 and
            ( p.dk=0 and decode( p.tt,o.tt,o.sk,t.sk)<40 or
              p.dk=1 and decode( p.tt,o.tt,o.sk,t.sk)>39    )
       Union all
       Select decode(p.dk,0,39,66),           p.dk,     p.s
       From opldok p, oper o, tts t, accounts a
       Where o.ref=p.ref and t.tt=p.tt and a.acc=p.acc and a.tip='KAS' and
             p.fdat BETWEEN  :sdat  AND  :sdat2  and  o.sos=5 and
            (           decode(p.tt,o.tt,o.sk,t.sk) is null or
             p.dk=1 and decode( p.tt,o.tt,o.sk,t.sk)<40     or
             p.dk=0 and decode( p.tt,o.tt,o.sk,t.sk)>39 )
      )
GROUP BY SK
ORDER BY SK")
.head 4 -  ! Set ss2=T("
SELECT decode(p.tt,o.tt,o.SK,t.sk),
       SUM(decode(p.dk,0,p.s,0))/100,
       SUM(decode(p.dk,1,p.s,0))/100
INTO :SK, :DOS, :KOS
FROM  accounts a, OPER O, OPLDOK P, tts t
WHERE  a.kv=:KV  and  p.acc=a.acc AND a.tip='KAS' AND
       p.fdat >= :sdat   AND  p.fdat <= :sdat2  AND
       o.ref=p.ref  AND  p.SOS = 5  AND t.tt=p.tt
GROUP BY decode(p.tt,o.tt,o.SK,t.sk)
ORDER BY 1")
.head 4 -  Call SalWaitCursor(FALSE)
.head 4 -  Call SalHideWindow(hWndForm)
.head 4 -  ! Call SalReportPrintToFile(hWndForm,strDir,GetPrnDir()||'/'|| IifS(FL_FORMAT,strFileName1,strFileName),strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 -  ! ==================================================
.head 4 -  ! Начинаем печать в отчет
.head 4 -  ! ==================================================
.head 4 -  Call SalReportPrintToFile(hWndForm, 
                                              strTmplPath, 
                                              strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                              strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 +  If (nInd > 4 )
.head 5 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 4 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 4 -  Set frm_Out.dfPath = strPrintPath
.head 4 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 4 -  Call SalDestroyWindow(hWndForm)
.head 3 +  On SAM_ReportStart             !! приготовить SELECT
.head 4 -  Return SqlPrepare(hSql(), ss2)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 +  If SK<40
.head 6 -  Set S40_61=NUMBER_Null
.head 6 +  If SK<33
.head 7 -  Set S02_32=S02_32+DOS
.head 6 +  If SK>32
.head 7 -  Set S02_32=NUMBER_Null
.head 5 +  Else
.head 6 +  If S40_61>0
.head 7 -  Set S02_32=NUMBER_Null
.head 6 +  If SK>39 and SK<62
.head 7 -  Set S40_61=S40_61+KOS
.head 6 +  If SK>61
.head 7 -  Set S40_61=NUMBER_Null
.head 5 -  Return TRUE
.head 4 +  Else
.head 5 -  Return FALSE
.head 4 -  ! Return SqlFetchNext(hSql(), nFetchRes)
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam=RPT_BeforeReportHeader
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'AMFO', AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'AQH', AQH)
.head 5 -  ! Set rab=SHAP||' '|| sd1 || IifS(sdat=sdat2,'',' - '||sd2)
.head 5 -  Set rab=SHAP||' '|| strDateFrom || IifS(sdat=sdat2,'',' - '||strDateTo)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP', rab)
.head 4 +  If lParam=RPT_BeforeDetail
.head 5 -  Call SqlPrepareAndExecute( hSqlAux2(),
"SELECT name INTO :NAME FROM sk WHERE sk=:SK")
.head 5 -  Call SqlFetchNext(hSqlAux2(), nFetchRes)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'NAME',NAME)
.head 3 +  On SAM_Destroy
.head 4 -  ! Set bFrmTorg=FALSE
.head 4 -  ! Set dlg_OutForms.rb0=TRUE
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 1 +  Form Window: frm_Staff     !! Карточка пользователя
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: КАРТОЧКА ПОЛЬЗОВАТЕЛЯ
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  10.217"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 5.655"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Карточка пользователя
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Child Table: tbl1 !!Карточка пользователя
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.067"
.head 6 -  Top:    0.036"
.head 6 -  Width:  9.667"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 4.5"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Dark Blue
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 3000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: Kod1
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.567"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NAME1
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: НАИМЕНОВАНИЕ
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  7.283"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalTblPopulate(tbl1,hSql(), T( " SELECT  id,fio FROM staff  order by 1" ) , TBL_FillAll)
.head 5 +  On SAM_DoubleClick
.head 6 -  Call FU_SAL(tbl1.Kod1)
.head 6 -  Call SalSetFocus(tbl1)
.head 5 +  On SAM_User
.head 6 -  Set nRow=TBL_MinRow
.head 6 +  Loop
.head 7 +  If SalTblFindNextRow (  tbl1, nRow, nTmp, 0 )
.head 8 -  Call SalTblSetContext( tbl1,nRow )
.head 8 +  If nRow >=0
.head 9 -  Call FU_SAL(tbl1.Kod1)
.head 7 +  Else
.head 8 -  Break
.head 6 -  Call SalSendMsg( tbl1, SAM_Create, 0, 0 )
.head 3 +  Pushbutton: PB1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Печать выбранных
.head 4 -  Window Location and Size
.head 5 -  Left:   3.6"
.head 5 -  Top:    4.655"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Midnight Blue
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set nTmp=ROW_Selected
.head 6 -  Call SalSendMsg( tbl1, SAM_User, 0, 0 )
.head 3 +  Pushbutton: PB2
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Печать ВСЕХ
.head 4 -  Window Location and Size
.head 5 -  Left:   1.0"
.head 5 -  Top:    4.655"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Midnight Blue
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set nTmp=0
.head 6 -  Call SalSendMsg( tbl1, SAM_User, 0, 0 )
.head 3 +  Pushbutton: PB3 !! завершить
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Завершить
.head 4 -  Window Location and Size
.head 5 -  Left:   6.2"
.head 5 -  Top:    4.655"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Black
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalDestroyWindow(  frm_Staff )
.head 2 +  Functions
.head 3 +  Function: FU_SAL
.head 4 -  Description: !! Карточка пользователя
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nP11
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: aa
.head 5 -  String: subst
.head 5 -  !
.head 5 -  String: strSecurApp
.head 5 -  String: strSecurTts
.head 5 -  String: strSecurChk
.head 5 -  String: strSecurGrp
.head 4 +  Actions
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 +  If EnhancedSecurity()
.head 6 -  Set strSecurApp = " AND NVL(R.approve,0)=1 AND date_is_valid(R.adate1,R.adate2,R.rdate1,R.rdate2)=1 "
.head 6 -  Set strSecurTts = " AND NVL(T.approve,0)=1 AND date_is_valid(T.adate1,T.adate2,T.rdate1,T.rdate2)=1 "
.head 6 -  Set strSecurChk = " AND NVL(H.approve,0)=1 AND date_is_valid(H.adate1,H.adate2,H.rdate1,H.rdate2)=1 "
.head 6 -  Set strSecurGrp = " AND NVL(G.approve,0)=1 AND date_is_valid(G.adate1,G.adate2,G.rdate1,G.rdate2)=1 "
.head 5 -  Set aa = SalNumberToStrX(nP11, 0)
.head 5 -  Set subst = GetSubstListId(nP11, TRUE)
.head 5 -  ! Set strFileName = SalStrLeftX(strFileName,
    SalStrScan(strFileName, '.')+1 ) || SalStrRightX(aa, 3)
.head 5 -  Set strFileNameTxt = SalStrLeftX( strFileNameTxt, 5 ) || NumberToStrFormat (nP11, 3) || '.txt'
.head 5 -  Set SS = "
    SELECT id,fio,logname,type,tabn
    INTO :ID1,:FIO,:LOGN,:ISP,:TABN
    FROM staff
    WHERE id=" || aa
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), T(SS))
.head 5 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Set SS = T("
    SELECT 1,a.codeapp,a.name
    INTO :NNP,:KODP,:NAMEP
    FROM applist_staff R, applist A
    WHERE r.id IN (" || subst || ") and r.codeapp=a.codeapp
    UNION ALL
    SELECT 2,b.tt,b.name
    FROM staff_tts T, tts B
    WHERE t.id IN (" || subst || ") and t.tt=b.tt
    UNION ALL
    SELECT 3,c.idchk || '',c.name
    FROM staff_chk H, chklist C
    WHERE h.id IN (" || subst || ") and h.chkid=c.idchk
    UNION ALL
    SELECT 4,d.id || '',d.name
    FROM groups_staff G, groups D
    WHERE g.idu IN (" || subst || ") and g.idg=d.id
    ORDER BY 1,2")
.head 5 -  ! Call SalReportPrintToFile(hWndForm, strDir, GetPrnDir() ||
     '/'|| IifS(FL_FORMAT, strFileName1, strFileName),
     strBind, strInput, 1, RPT_PrintAll, 1, 1, FL_FORMAT,
     nInd)
.head 5 -  ! ==================================================
.head 5 -  ! Начинаем печать в отчет
.head 5 -  ! ==================================================
.head 5 -  Call SalReportPrintToFile(hWndForm, 
                                              strTmplPath, 
                                              strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                              strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 5 +  If (nInd > 4 )
.head 6 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 5 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 5 -  Set frm_Out.dfPath = strPrintPath
.head 5 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)

.head 5 +  If not FL_FORMAT
.head 6 -  ! Call zarez12(GetPrnDir() || '\\' || strFileName, frm_Out.tbl1.Kod,
     frm_Out.tbl1.sDeviceDef)
.head 6 -  Call zarez12(  strPrintPath || '\\' || strFileNameTxt, frm_Out.tblReps.Kod, sDeviceDef)
.head 5 -  Call SalWaitCursor(FALSE)
.head 2 +  Window Parameters
.head 3 -  Number: nP1
.head 2 +  Window Variables
.head 3 -  Number: NNP
.head 3 -  String: KODP
.head 3 -  String: NAMEP
.head 3 -  Number: ID1
.head 3 -  String: FIO
.head 3 -  String: LOGN
.head 3 -  String: SS
.head 3 -  String: TABN
.head 3 -  Number: ISP
.head 3 -  Number: nRow
.head 3 -  Number: nTmp
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set strBind = 'NNP,KODP,NAMEP'
.head 4 -  Set strInput=strBind
.head 4 -  Call SalHideWindow(  tbl1 )
.head 4 -  Call SalHideWindow(  PB1 )
.head 4 -  Call SalHideWindow(  PB3 )
.head 4 +  If nP1 > 0 !! по одному
.head 5 -  Call FU_SAL(nP1)
.head 5 -  Call SalDestroyWindow( frm_Staff)
.head 4 -  Call SalShowWindow(  tbl1 )
.head 4 -  Call SalShowWindow(  PB1 )
.head 4 -  Call SalShowWindow(  PB3 )
.head 3 +  On SAM_ReportStart
.head 4 -  Call SqlPrepare(hSql(), SS)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 +  ! If not bFLS
.head 6 -                          Set NAMEP=StrWinToDosX(NAMEP)
.head 5 -  Return TRUE
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam=RPT_BeforeReportHeader
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP',SHAP)
.head 5 -  Call SalReportSetNumberVar( SalNumberToWindowHandle(wParam),'ID', ID1)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'TABN',TABN)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'LOGN',LOGN)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'FIO', FIO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
 'ISPO', IifS(ISP=1,"ISP",""))
.head 4 +  If lParam=RPT_BeforeBreakHeader1
.head 5 -  Set FIO=IifS(NNP=1,'АРМы:',
 IifS(NNP=2,'ОПЕРАЦИИ',IifS(NNP=3,'ГРУППЫ КОНТРОЛЯ ОПЕРАЦИЙ','ГРУППЫ ДОСТУПА К СЧЕТАМ')))
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'RESU', FIO)
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 3 +  On SAM_Destroy
.head 4 -  Call SalWaitCursor( FALSE )
.head 1 +  Form Window: frm_Stat      !! Статистика Переоценка 9,..
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Баланс банка
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  7.125"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.563"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: sdat
.head 3 -  Number: para
.head 2 +  Window Variables
.head 3 -  ! Number: nInd
.head 3 -  String: ss
.head 3 -  !
.head 3 -  Number: VP
.head 3 -  Number: TIP
.head 3 -  Number: ISP
.head 3 -  Number: DK
.head 3 -  Number: KV
.head 3 -  Number: KOL
.head 3 -  Number: S
.head 3 -  Number: SQ
.head 3 -  Number: n980
.head 3 -  String: NLS
.head 3 -  String: sTmp
.head 3 -  String: maska
.head 3 -  !
.head 3 -  Date/Time: dtPrev
.head 3 -  !
.head 3 -  Number: nDig
.head 3 -  String: sTmp1
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set n980=GetBaseVal()
.head 4 -  Set nInd = RPT_NoToolbar !! парамерт для управления печатью отчета
.head 4 +  If para=1  !! Протокол оплаты
.head 5 -  Set strBind = 'TIP,ISP,DK,KV,KOL,S,SQ,VP'  !! наши переменные
.head 5 -  Set ss="
SELECT '1',o.userid,o.dk,o.kv,o.vp,count(*),sum(o.s)/100 ,sum(o.s)/100   
INTO :TIP,:ISP,:DK,:KV,:VP,:KOL,:S,:SQ    
FROM oper o WHERE o.sos=5 and    
     o.kv=:n980 and o.mfoa=o.mfob and  TRUNC(o.pdat) = :sdat    GROUP BY o.userid,o.dk,o.kv,o.vp    
UNION all    
SELECT '2',o.userid,o.dk,o.kv,o.vp, count(*),sum(o.s)/100, sum(o.s)/100    
FROM  OPER o WHERE o.sos=5 and o.kv=:n980 and o.mfoa <>o.mfob and   
      o.mfoa= " || AMFO || " and TRUNC(o.pdat) = :sdat    GROUP BY o.userid,o.dk,o.kv,o.vp    
UNION all    
SELECT '5',0,o.dk,o.kv,0,count(*),sum(o.s)/100,sum(o.s)/100     
FROM  arc_rrp o WHERE o.sos=5 and o.kv=:n980 and o.mfoa <> o.mfob and    
      o.mfob = " || AMFO || " and  TRUNC(o.dat_b) = :sdat  GROUP BY  o.dk,o.kv    
UNION all    
SELECT '6',o.userid,o.dk,o.kv,o.vp,count(*),sum(o.s)/100 ,sum( gl.p_icurval(o.kv, o.s,  :sdat  )/100)     
FROM  oper o WHERE o.sos=5 and o.kv<>:n980 and  TRUNC(o.pdat) =:sdat    GROUP BY  o.userid,o.dk,o.kv,o.vp   ORDER BY 1,2,3,4"     
.head 5 -  ! Set ss="
SELECT '1',o.userid,o.dk,o.kv,o.vp,count(*),sum(o.s)/100 ,sum(o.s)/100   
INTO :TIP,:ISP,:DK,:KV,:VP,:KOL,:S,:SQ    
FROM oper o WHERE o.sos=5 and    
     o.kv=:n980 and o.mfoa=o.mfob and  TRUNC(o.pdat) = :sdat    
GROUP BY o.userid,o.dk,o.kv,o.vp    
UNION all    
SELECT '2',o.userid,o.dk,o.kv,o.vp, count(*),sum(o.s)/100, sum(o.s)/100    
FROM  OPER o WHERE o.sos=5 and o.kv=:n980 and o.mfoa <>o.mfob and   
      o.mfoa= " || AMFO || " and TRUNC(o.pdat) =  TO_DATE(:sdat, 'MM-DD-YYYY')       
GROUP BY o.userid,o.dk,o.kv,o.vp    
UNION all   
SELECT '5',0,o.dk,o.kv,0,count(*),sum(o.s)/100,sum(o.s)/100   
FROM  arc_rrp o WHERE o.sos=5 and o.kv=:n980 and o.mfoa <> o.mfob and   
      o.mfob = " || AMFO || " and  TRUNC(o.dat_b) =  TO_DATE(:sdat, 'MM-DD-YYYY')       
GROUP BY  o.dk,o.kv   
UNION all   
SELECT '6',o.userid,o.dk,o.kv,o.vp,count(*),sum(o.s)/100 ,sum( gl.p_icurval(o.kv, o.s,  :sdat  )/100)    
FROM  oper o WHERE o.sos=5 and o.kv<>:n980 and  TRUNC(o.pdat) =  TO_DATE(:sdat, 'MM-DD-YYYY')      
GROUP BY  o.userid,o.dk,o.kv,o.vp    
ORDER BY 1,2,3,4"    
.head 4 +  Else If para=2 !! Ведомость курсовых разниц
.head 5 +  If SqlPrepareAndExecute(hSql(),
T('SELECT max(fdat) INTO :dtPrev FROM fdat WHERE fdat < :sdat '))     
.head 6 -  Call SqlFetchNext( hSql(), nFetchRes )
.head 5 -  Set maska=Maska_NLS("счетов")   
.head 5 -  Call SalDateToStr ( dtPrev, sTmp1 )
.head 5 +  If maska='-'
.head 6 -  Call SalDestroyWindow( hWndForm )
.head 6 -  Return FALSE
.head 5 -  Set strBind = 'KV,NLS,S,SQ,KOL'  !! наши переменные
.head 5 -  Set ss="SELECT
kv,nls,ost/100,gl.p_icurval(kv,ost,fdat)/100,
( gl.p_icurval(kv,ost+dos-kos,fdat)-
  gl.p_icurval(kv,ost+dos-kos,:dtPrev))/100
INTO :KV,:NLS,:S,:SQ,:KOL FROM sal
WHERE  kv<>"||Str(GetBaseVal())||" AND fdat= :sdat  "||
IifS(maska !='%'," AND trim(nls) LIKE \'"||SalStrTrimX(maska)||"\'",'')||"
ORDER BY kv,nbs,nls "
.head 4 -  Set strInput =strBind
.head 4 -  Call WaitCursorOn()
.head 4 -  Call SalHideWindow(hWndForm)
.head 4 -  ! ==================================================
.head 4 -  ! Начинаем печать в отчет
.head 4 -  ! ==================================================
.head 4 -  Call SalReportPrintToFile(hWndForm, 
                                              strTmplPath, 
                                              strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                              strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 +  If (nInd > 4 )
.head 5 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 4 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 4 -  Set frm_Out.dfPath = strPrintPath
.head 4 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 4 -  Call SalDestroyWindow(hWndForm)
.head 3 +  On SAM_ReportStart             !! приготовить SELECT
.head 4 -  Return SqlPrepare(hSql(),T(ss))
.head 4 -  ! Return SqlPrepare(hSql(),ss)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext  !! вычитать очередную строку
.head 4 +  If para=1
.head 5 -  ! Return SqlFetchNext(hSql(), nFetchRes)
.head 5 -  !
.head 5 +  If SqlFetchNext(hSql(), nFetchRes)
.head 6 -  ! проверка на 3 знака
.head 6 -  Call SqlPrepareAndExecute( hSqlAux(), "
SELECT dig INTO :nDig  
FROM tabval   
WHERE kv = :KV" )  
.head 6 +  If not SqlFetchNext( hSqlAux(), nFetchRes )
.head 7 -  Return FALSE
.head 6 -  Set S  = S*SalNumberPower( 10,2-nDig )
.head 6 -  Set SQ = SQ*SalNumberPower( 10,2-nDig )
.head 6 -  !
.head 6 -  Return TRUE
.head 5 -  !
.head 4 +  Else If para=2
.head 5 +  While SqlFetchNext(hSql(), nFetchRes)
.head 6 -  ! проверка на 3 знака
.head 6 -  Call SqlPrepareAndExecute( hSqlAux(), "
SELECT dig INTO :nDig
FROM tabval
WHERE kv = :KV" )
.head 6 +  If not SqlFetchNext( hSqlAux(), nFetchRes )
.head 7 -  Return FALSE
.head 6 -  Set S  = S*SalNumberPower( 10,2-nDig )
.head 6 -  Set SQ = SQ*SalNumberPower( 10,2-nDig )
.head 6 -  Set KOL= KOL*SalNumberPower( 10,2-nDig )
.head 6 -  !
.head 6 +  If KOL != 0
.head 7 -  Return TRUE
.head 5 -  Return FALSE
.head 3 +  On SAM_ReportNotify           !! информировать ОТЧЕТ о глобальных переменных
.head 4 +  If lParam=RPT_BeforeReportHeader and para=1 !! только для заголовка
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'AMFO', AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'AQH', AQH)
.head 5 -  ! Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP', SHAP||' '||sd1)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'SHAP', SHAP||' '||strDateFrom)
.head 4 +  If lParam=RPT_BeforeBreakHeader1 and para=1
.head 5 +  If TIP=1
.head 6 -  Set rab='ВНУТРЕННИЕ'
.head 5 +  Else If TIP=2
.head 6 -  Set rab='НАЧАЛЬНЫЕ МЕЖБАНКОВСКИЕ'
.head 5 +  Else If TIP=3
.head 6 -  Set rab='КАССА-ПРИХОД'
.head 5 +  Else If TIP=4
.head 6 -  Set rab='КАСА-ВИДАТКИ'
.head 5 +  Else If TIP=5
.head 6 -  Set rab='ОТВЕТНЫЕ МЕЖБАНКОВСКИЕ'
.head 5 +  Else If TIP=6
.head 6 -  Set rab='ИНВАЛЮТНЫЕ'
.head 5 +  Else
.head 6 -  Set rab=''
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'MAKET',rab)
.head 4 -  !
.head 4 +  If lParam=RPT_BeforeReportHeader and para=2
.head 5 -  ! Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'DAT',sd1)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'DAT',strDateFrom)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'aMFO',GetBankMfo())
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'aQH',GetBankName())
.head 4 +  If lParam=RPT_BeforeBreakHeader1 and para=2
.head 5 -  Call SqlPrepareAndExecute( hSqlAux2(), T(
"SELECT t.name||'  '||r.bsum||' '||t.lcv||' = '||r.rate_o
 INTO  :sTmp  FROM cur_rates r, tabval t
 WHERE t.kv=r.kv and r.kv=:KV and r.vdate =
  (select MAX(vdate) FROM cur_rates WHERE kv=:KV and vdate<=  :sdat )" ))
.head 5 +  If SqlFetchNext(hSqlAux2(),nFetchRes)
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'NAMV',sTmp||' '||GetBaseLcv())
.head 3 +  On SAM_Destroy
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 1 +  Form Window: frm_Torg
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Баланс банка
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  7.125"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.563"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Торговая выручка
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: sdat
.head 3 -  String: sdat2
.head 2 +  Window Variables
.head 3 -  Number: nInd
.head 3 -  String: ss
.head 3 -  !
.head 3 -  String: NMK
.head 3 -  Number: SK
.head 3 -  Number: S
.head 3 -  String: ND
.head 3 -  String: NAZN
.head 3 -  Date/Time: DAT
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set strBind='NMK,SK,S,ND,NAZN,DAT' ! наши                                                                    ! переменные
.head 4 -  Set ss = T("
SELECT trim(c.nmk)||'('|| trim(a.nls)||')',
     o.SK, p.fdat, o.s/100, o.nd, o.nazn[1,40]
 FROM CUSTOMER C,CUST_ACC CA,ACCOUNTS A,OPER O,OPLDOK P
 INTO :NMK, :SK, :DAT, :S, :ND, :NAZN
WHERE C.RNK=CA.RNK and CA.ACC=A.ACC and
      A.NLS=O.NLSA and A.ACC=P.ACC  and
      A.kv=o.KV AND o.kv=o.kv2 AND a.kv=980 AND
      P.SOS=5 and P.REF=O.REF and P.DK = 1 AND
      o.SK in (2,3) and
      p.fdat >= :sdat  and p.fdat <= :sdat2
      ORDER BY 1,2,3,4 ")
.head 4 -  Call WaitCursorOn()
.head 4 -  Call SalHideWindow(hWndForm)
.head 4 -  ! Call SalReportPrintToFile(hWndForm,strDir,GetPrnDir()||'/'|| IifS(FL_FORMAT,strFileName1,strFileName),strBind,strBind,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 -  ! ==================================================
.head 4 -  ! Начинаем печать в отчет
.head 4 -  ! ==================================================
.head 4 -  Call SalReportPrintToFile(hWndForm, 
                                              strTmplPath, 
                                              strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                              strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 +  If (nInd > 4 )
.head 5 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 4 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 4 -  Set frm_Out.dfPath = strPrintPath
.head 4 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 4 -  Call SalDestroyWindow(hWndForm)
.head 3 +  On SAM_ReportStart ! приготовить SELECT
.head 4 -  Return SqlPrepare(hSql(), ss)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext ! вычитать очередную строку
.head 4 -  Return SqlFetchNext(hSql(), nFetchRes)
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam = RPT_BeforeReportHeader !  только для заголовка
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'AMFO',AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'AQH', AQH)
.head 5 -  ! Set rab = SHAP||' ' || sd1||' - '||sd2
.head 5 -  Set rab = SHAP||' ' || strDateFrom||' - '||strDateTo
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'SHAP',rab)
.head 3 +  On SAM_Destroy
.head 4 -  ! Set bFrmTorg=FALSE
.head 4 -  ! Set dlg_OutForms.rb0=TRUE
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 1 +  Table Window: tbl_LicSep   !! Выписки - участникам ВПС
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Банки
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? Yes
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   1.413"
.head 4 -  Top:    0.083"
.head 4 -  Width:  8.067"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 5.381"
.head 4 -  Height Editable? Yes
.head 3 -  Font Name: MS Sans Serif
.head 3 -  Font Size: 8
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 3 -  View: Table
.head 3 -  Allow Row Sizing? No
.head 3 -  Lines Per Row: Default
.head 2 -  Memory Settings
.head 3 -  Maximum Rows in Memory: 1000
.head 3 -  Discardable? No
.head 2 -  Description: Выписки - участникам ВПС
.head 2 -  Named Menus
.head 2 +  Menu
.head 3 +  Menu Item: Всех
.head 4 -  Resource Id: 61222
.head 4 -  Keyboard Accelerator: F1
.head 4 -  Status Text:
.head 4 +  Menu Settings
.head 5 -  Enabled when:
.head 5 -  Checked when:
.head 4 +  Menu Actions
.head 5 -  Set nRowType=0
.head 5 -  Call SalSendMsg(hWndForm, SAM_User, 0, 0)
.head 4 -  Menu Item Name:
.head 3 +  Menu Item: Выбранные
.head 4 -  Resource Id: 61223
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Status Text:
.head 4 +  Menu Settings
.head 5 -  Enabled when:
.head 5 -  Checked when:
.head 4 +  Menu Actions
.head 5 -  Set nRowType=ROW_Selected
.head 5 -  Call SalSendMsg(hWndForm, SAM_User, 0, 0)
.head 4 -  Menu Item Name:
.head 3 +  Menu Item: Выход
.head 4 -  Resource Id: 61224
.head 4 -  Keyboard Accelerator: F10
.head 4 -  Status Text:
.head 4 +  Menu Settings
.head 5 -  Enabled when:
.head 5 -  Checked when:
.head 4 +  Menu Actions
.head 5 -  Call SalSetFocus(hWndLicParent)
.head 5 -  Call SalDestroyWindow(tbl_LicSep)
.head 4 -  Menu Item Name:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Bottom
.head 4 -  Visible? No
.head 4 -  Size: 0.4"
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Column: mfo
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: МФО
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: 9
.head 4 -  Data Type: String
.head 4 -  Justify: Right
.head 4 -  Width:  0.967"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: sab
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Код
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: 4
.head 4 -  Data Type: String
.head 4 -  Justify: Center
.head 4 -  Width:  0.643"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: nb
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Наименование банка
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  5.717"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 2 +  Functions
.head 3 +  Function: MIK
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  ! Set strFileName = '@_' || sab ||
    Sep98md( SalDateConstruct  (  SalStrToNumber(SalStrRightX(sdat, 4)), 
                                                             SalStrToNumber(SalStrLeftX(sdat, 2)), 
                                                             SalStrToNumber( SalStrMidX(sdat, 3, 2)), 
                                                             0, 0, 0)
                      ) || '.L00'
.head 5 -  Set strFileNameTxt = '@_' || sab ||
    Sep98md( SalDateConstruct  (  SalStrToNumber(SalStrRightX(sdat, 4)), 
                                                             SalStrToNumber(SalStrLeftX(sdat, 2)), 
                                                             SalStrToNumber( SalStrMidX(sdat, 3, 2)), 
                                                             0, 0, 0)
                      ) || '.L00'
.head 5 -  Call WaitCursorOn()
.head 5 -  ! Call SalReportPrintToFile(hWndForm, strDir, GetPrnDir() ||
     '/' || strFileName, strBind, strInput, 1, RPT_PrintAll,
     1, 1, FALSE, nInd)
.head 5 -  ! ==================================================
.head 5 -  ! Начинаем печать в отчет
.head 5 -  ! ==================================================
.head 5 -  Call SalReportPrintToFile(hWndForm, 
                                              strTmplPath, 
                                              strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                              strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 5 +  If (nInd > 4 )
.head 6 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 5 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 5 -  Set frm_Out.dfPath = strPrintPath
.head 5 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 5 +  If not FL_FORMAT
.head 6 -  ! Call zarez12(GetPrnDir() || '\\' || strFileName, frm_Out.tbl1.Kod,
     frm_Out.tbl1.sDeviceDef)
.head 6 -  Call zarez12( strPrintPath  || '\\' || strFileNameTxt, frm_Out.tblReps.Kod, sDeviceDef)
.head 5 -  Call WaitCursorOff()
.head 3 +  ! Function: to32x
.head 4 -                         Description:
.head 4 +                         Returns
.head 5 -                         String:
.head 4 +                         Parameters
.head 5 -                         Number: n1
.head 4 -                         Static Variables
.head 4 +                         Local variables
.head 5 -                         String: s1
.head 5 -                         Number: n2
.head 4 +                         Actions
.head 5 -                         Set s1=''
.head 5 +                         While n1>=36
.head 6 -                         Set n2=SalNumberMod(n1, 36)
.head 6 -                         Set n1=(n1-SalNumberMod(n1, 36))/36
.head 6 +                         If n2<10
.head 7 -                         Set n2=n2+48
.head 6 +                         Else
.head 7 -                         Set n2=n2+55
.head 6 -                         Set s1=SalNumberToChar( n2)||s1
.head 5 -                         Set s1=s1||SalStrRepeatX( '0', 12)
.head 5 -                         Return SalStrLeftX(s1,8) || '.' || SalStrMidX( s1, 9,3)
.head 2 +  Window Parameters
.head 3 -  String: sdat
.head 2 +  Window Variables
.head 3 -  String: sKv
.head 3 -  Number: nIsp
.head 3 -  Number: nNls
.head 3 -  Number: nDk
.head 3 -  Number: nS
.head 3 -  Number: nOstf
.head 3 -  Date/Time: dtPdat
.head 3 -  String: sNms
.head 3 -  Number: nRef
.head 3 -  String: sText
.head 3 -  String: sTt
.head 3 -  String: strBankMfo
.head 3 -  Number: nRow
.head 3 -  String: strBankName
.head 3 -  !
.head 3 -  Number: nKv
.head 3 -  Number: nNlsk
.head 3 -  Number: nDos
.head 3 -  Number: nKos
.head 3 -  Date/Time: dtFdat
.head 3 -  Number: nAcc
.head 3 -  Number: nVob
.head 3 -  Number: nMfo
.head 3 -  Number: nMfoB
.head 3 -  String: sNd
.head 3 -  String: sNda
.head 3 -  String: sNdb
.head 3 -  String: sSql
.head 3 -  String: sIsp
.head 3 -  String: sNls
.head 3 -  Number: nInd
.head 3 -  String: sNd1
.head 3 -  String: sMfo1
.head 3 -  String: sNamk1
.head 3 -  String: lmfo
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalCenterWindow(hWndForm)
.head 4 -  Call SetWindowFont(hWndForm)
.head 4 -  !
.head 4 -  Set strBankMfo=GetBankMfo()
.head 4 -  ! Set bTblLicSep = TRUE
.head 4 -  !
.head 4 -  Set strBind='sKv,nIsp,nNls,nDos,nKos,sText,sTt'
.head 4 -  Set strInput='KV,ISP,NLS,DOS,KOS,TEXT,TT'
.head 4 -  Set sSql=
T("SELECT UNIQUE t.lcv,c.isp,c.nls,o.dk,o.s,a.ostf,a.pdat,c.nms, o.ref,o.txt, o.tt
 INTO  :sKv,  :nIsp,:nNls,:nDk,:nS,:nOstf,:dtPdat,:sNms,:nRef,:sText,:sTt
FROM opldok o,saldoa a,accounts c,bank_acc k,tabval t,
OUTER zag_a za,OUTER zag_b zb
where  c.kv=t.kv and o.acc=a.acc  and o.acc=c.acc and  o.acc=k.acc and
o.sos=5 and  k.mfo=:lmfo and
((c.tip='TUR' or c.tip='TUD') and a.dos<>a.kos or c.tip = 'L00') and
   o.fdat=a.fdat and a.fdat=:sdat  and o.ref=za.ref (+) and o.ref=zb.ref (+)
order by 1,2,3,4,5")
.head 4 -  Call WaitCursorOn()
.head 4 -  Call SalTblPopulate(hWndForm, hSql(),T("
SELECT mfo, sab, nb FROM Banks
 WHERE mfop=:strBankMfo AND (kodn=0 OR kodn=4 OR kodn=6)
 INTO  :tbl_LicSep.mfo, :tbl_LicSep.sab, :tbl_LicSep.nb"), TBL_FillAll)
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_User
.head 4 -  Call WaitCursorOn()
.head 4 -  Set nRow=TBL_MinRow
.head 4 +  Loop
.head 5 +  If SalTblFindNextRow(hWndForm, nRow, nRowType, 0)
.head 6 -  Call SalTblFetchRow(hWndForm, nRow)
.head 6 -  Call SalStatusSetText(hWndForm, sab)
.head 6 -  Call MIK()
.head 5 +  Else
.head 6 -  Break
.head 4 -  Call WaitCursorOff()
.head 4 -  Call SalStatusSetText(hWndForm, 'Готово')
.head 3 +  ! On SAM_Destroy
.head 4 -                         Set bTblLicSep = FALSE
.head 3 +  On SAM_ReportStart
.head 4 -  Set lmfo=tbl_LicSep.mfo
.head 4 -  Return SqlPrepare( hSqlAux(), sSql)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute( hSqlAux())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If SqlFetchNext( hSqlAux(), nFetchRes)
.head 5 -  Set nOstf=nOstf/100
.head 5 +  If nDk=0
.head 6 -  Set nDos=nS/100
.head 6 -  Set nKos=0
.head 5 +  Else
.head 6 -  Set nDos=0
.head 6 -  Set nKos=nS/100
.head 5 -  Set sText=SalStrLeftX( sText,12 )||SalStrRightX( SalStrRepeatX( ' ',18)|| SalNumberToStrX( nRef, 0),18)
.head 5 -  Return TRUE
.head 4 -  Return FALSE
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam=RPT_BeforeBreakHeader2
.head 5 -  Call SalReportSetStringVar( SalNumberToWindowHandle( wParam), 'aMFO', GetBankMfo() )
.head 5 -  Call SalReportSetStringVar( SalNumberToWindowHandle( wParam ), 'aQH', GetBankName())
.head 4 +  If lParam=RPT_BeforeBreakHeader3
.head 5 -  Call SalReportSetNumberVar( SalNumberToWindowHandle( wParam ), 'ACC', nAcc )
.head 5 -  Call SalReportSetNumberVar( SalNumberToWindowHandle( wParam ), 'OSTF', nOstf )
.head 5 -  Call SalReportSetStringVar( SalNumberToWindowHandle( wParam ), 'NMS', sNms )
.head 5 -  Call SalReportSetDateTimeVar( SalNumberToWindowHandle( wParam ), 'FDAT', dtFdat )
.head 5 -  Call SalReportSetDateTimeVar( SalNumberToWindowHandle( wParam ), 'PDAT', dtPdat )
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle( wParam ), 'DETAIL', "Iм'я  файлу         Референцiя" )
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 1 +  Form Window: frm_LicAcc    !! Особовi рахунки
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Лицевые счета
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  10.933"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 5.702"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Особовi рахунки
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Child Table: tbl1 !! исполнители или валюты
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.067"
.head 6 -  Top:    0.048"
.head 6 -  Width:  9.65"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 4.5"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Dark Blue
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 3000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: Kod1
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.786"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NAME1
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: НАИМЕНОВАНИЕ
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  6.786"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  ! Column: sab1
.winattr
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Адрес
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  7.283"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -             List Values
.head 6 -             Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 +  If sXXX = "K"
.head 7 -  Call SalTblPopulate(tbl1,hSql(),
"SELECT rnk,nmk FROM customer WHERE stmt=3 order by 1"  , TBL_FillAll)
.head 6 +  Else
.head 7 -  Call SalTblPopulate(tbl1,hSql(),
 "SELECT " || IifS(nOpt =0," id,fio FROM staff  WHERE type=1",
   "kv,name FROM tabval " )  || " order by 1"  , TBL_FillAll)
.head 5 +  On SAM_DoubleClick
.head 6 -  Call FU_SAL(tbl1.Kod1)
.head 6 -  Call SalSetFocus(tbl1)
.head 5 +  On SAM_User
.head 6 -  Set nRow=TBL_MinRow
.head 6 +  Loop
.head 7 +  If SalTblFindNextRow (  tbl1, nRow, nTmp, 0 )
.head 8 -  Call SalTblSetContext( tbl1,nRow )
.head 8 +  If nRow >=0
.head 9 -  ! Для выписки НБУ создаем файл если есть данные
.head 9 +  If para=201 
.head 10 +  If SqlPrepareAndExecute( hSql(),
"select acc from tmp_lic where
acc in (SELECT acc FROM cust_acc WHERE rnk=:tbl1.Kod1)
and ID=:ID") and SqlFetchNext( hSql(), nFetchRes ) 
.head 11 -  Call FU_SAL(tbl1.Kod1)
.head 9 +  Else
.head 10 -  Call FU_SAL(tbl1.Kod1) 
.head 7 +  Else
.head 8 -  Break
.head 6 -  Call SalSendMsg( tbl1, SAM_Create, 0, 0 )
.head 3 +  Pushbutton: PB1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Печать выбранных
.head 4 -  Window Location and Size
.head 5 -  Left:   3.583"
.head 5 -  Top:    4.655"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Midnight Blue
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set nTmp=ROW_Selected
.head 6 -  Call SalSendMsg( tbl1, SAM_User, 0, 0 )
.head 3 +  Pushbutton: PB2
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Печать ВСЕХ
.head 4 -  Window Location and Size
.head 5 -  Left:   0.983"
.head 5 -  Top:    4.655"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Midnight Blue
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set nTmp=0
.head 6 -  Call SalSendMsg( tbl1, SAM_User, 0, 0 )
.head 3 +  Pushbutton: PB3 !! завершить
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Завершить
.head 4 -  Window Location and Size
.head 5 -  Left:   6.183"
.head 5 -  Top:    4.655"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Black
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalDestroyWindow( frm_LicAcc )
.head 2 +  Functions
.head 3 +  ! Function: to32x
.head 4 -             Description:
.head 4 +             Returns
.head 5 -             String:
.head 4 +             Parameters
.head 5 -             Number: n1
.head 4 -             Static Variables
.head 4 +             Local variables
.head 5 -             String: s1
.head 5 -             Number: n2
.head 4 +             Actions
.head 5 -             Set s1=''
.head 5 +             While n1>=36
.head 6 -             Set n2=SalNumberMod(n1, 36 )
.head 6 -             Set n1=(n1-SalNumberMod(n1, 36 ))/36
.head 6 +             If n2<10
.head 7 -             Set n2=n2+48
.head 6 +             Else
.head 7 -             Set n2=n2+55
.head 6 -             Set s1 = SalNumberToChar(n2) || s1
.head 5 -             Set s1=s1||SalStrRepeatX('0', 12)
.head 5 -             Return SalStrLeftX(s1,8) || '.' || SalStrMidX(s1, 9,3)
.head 3 +  Function: FU_SAL
.head 4 -  Description: Печать ЛС по ОДНОМУ
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nP11
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: Rnk
.head 5 -  Number: H2
.head 5 -  String: Sab3
.head 5 -  ! String: Sabtemp
.head 4 +  Actions
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  ! Set strFileName = SalStrLeftX(strFileName,
    SalStrScan(strFileName, '.')+1 ) ||
    SalStrRightX( SalNumberToStrX(nP11, 0), 3)
.head 5 -  Set strFileNameTxt = SalStrLeftX(strFileNameTxt, 5) ||  NumberToStrFormat( nP11, 3) || '.txt'
.head 5 -  Set RNK1 = -1
.head 5 -  Set ISP1 = -1
.head 5 -  Set KV = -1
.head 5 +  If sXXX = "k" or sXXX = "K"
.head 6 +  If sXXX = "k"
.head 7 -  Set Rnk=Val(Subs(maska,2,8))
.head 6 +  Else
.head 7 -  Set Rnk=tbl1.Kod1
.head 6 +  If SqlPrepareAndExecute( hSql(),
 "SELECT substr(sab ,1,4) INTO :Sab3 FROM customer
  WHERE rnk=:Rnk AND stmt=3" )
and SqlFetchNext( hSql(), nFetchRes )
.head 7 +  If fNBU !! лицевые счета в файл для НБУ
.head 8 -  Set H2=SalDateHour (SalDateCurrent())
.head 8 -  Set H2=H2 + IifN(H2<10, 48, 55)
.head 8 -  ! ***   Выписка для НБУ - имя файла   *** 
.head 8 -  ! их SAB + наш SAB + '.l' +день 
.head 8 -  Set strFileNameTxt= Sab3||GetBankSab()||'.l'||SalStrRightX(SalNumberToStrX((SalDateDay(SalDateCurrent ())+100),0),2)
.head 8 -  ! ***********************************
.head 7 +  Else
.head 8 -  Set H2=SalDateHour (SalDateCurrent())
.head 8 -  Set H2=H2 + IifN(H2<10, 48, 55)
.head 8 +  If GetBankMfo()='300465'
.head 9 -  ! Эксклюзивно для ОЩАДБАНКА (Иван)
.head 9 -  Set strFileNameTxt='LS' || IifS(para=1, '$', '^') || SalStrRightX( Sab3, 3 ) ||
Sep98md(SalDateCurrent()) || '.' ||
SalNumberToChar( H2 ) ||
SalStrRightX(
'00' || SalNumberToStrX( SalDateMinute( SalDateCurrent() ),0),
2 )
.head 8 +  Else
.head 9 -  Set strFileNameTxt='LS' || IifS(para=1, '$', '^') || Sab3 ||
Sep98md(SalDateCurrent()) || '.' ||
SalNumberToChar( H2 ) ||
SalStrRightX(
'00' || SalNumberToStrX( SalDateMinute( SalDateCurrent() ),0),
2 )
.head 5 -  ! ==================================================
.head 5 -  ! Начинаем печать в отчет
.head 5 -  ! ==================================================
.head 5 -  Call SalReportPrintToFile(hWndForm, 
                                                        strTmplPath, 
                                                        strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                                        strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 5 +  If (nInd > 4 )
.head 6 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 5 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 5 -  Set frm_Out.dfPath = strPrintPath
.head 5 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 5 +  If not FL_FORMAT
.head 6 -  ! Call zarez12(GetPrnDir() || '\\' || strFileName,frm_Out.tbl1.Kod,frm_Out.tbl1.sDeviceDef)
.head 6 -  Call zarez12(  strPrintPath ||'/'|| strFileNameTxt, frm_Out.tblReps.Kod, sDeviceDef)
.head 5 -  Call SalWaitCursor(FALSE)
.head 3 +  Function: StrToDateX
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Date/Time:
.head 4 +  Parameters
.head 5 -  String: sDate
.head 5 -  String: sFormat
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Date/Time: Result
.head 5 -  : cCnc
.head 6 -  Class: cABSConnect
.head 5 -  Number: nFetchRes
.head 4 +  Actions
.head 5 -  Set Result=DATETIME_Null
.head 5 -  Call XConnectGetParams( cCnc )
.head 5 +  If cCnc.Connect()
.head 6 +  If SqlPrepareAndExecute( cCnc.hSql(),
"
SELECT TO_DATE('" || sDate || "','" || sFormat || "')
INTO :Result
FROM dual "  )
.head 7 -  Call SqlFetchNext( cCnc.hSql(), nFetchRes )
.head 6 -  Call cCnc.Disconnect()
.head 5 -  Return Result
.head 3 +  Function: DateToStrX
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  Date/Time: dDate
.head 5 -  String: sFormat
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: Result
.head 4 +  Actions
.head 5 -  Call SalFmtFormatDateTime( dDate, Result )
.head 5 -  Return Result
.head 2 +  Window Parameters
.head 3 -  Number: ID      !! пользователь
.head 3 -  Number: nOpt    !! =0 - сортировать по исп, =2 - сортировать по счетам
.head 3 -  String: sFdat   !! С даты
.head 3 -  String: sFdat2  !! По дату
.head 3 -  String: sXX     !! ='8' для ВКлючения 8, #'8' для ИСКлючения
.head 3 -  Number: nP1     !! исполнитель (0-все)
.head 3 -  Number: nXX     !! 1 cо всеми переоценками
.head 3 -  String: sXXX    !! "k"  - ПО КЛИЕНТУ, иначе - по маске счета
.head 3 -  Number: para
.head 3 -  Number: nSpace
.head 2 +  Window Variables
.head 3 -  ! cGenFilter: cF
.head 3 -  !
.head 3 -  String: sSql
.head 3 -  String: sSqlW
.head 3 -  String: sSqlR
.head 3 -  String: sSqlS
.head 3 -  String: sSqlT
.head 3 -  String: sSqlK
.head 3 -  String: sIsp
.head 3 -  String: oIsp
.head 3 -  Number: nRow
.head 3 -  Number: nTmp
.head 3 -  String: NLS
.head 3 -  String: NAMV
.head 3 -  String: NMS
.head 3 -  String: NMK
.head 3 -  String: ND
.head 3 -  String: MFO
.head 3 -  String: NLSK
.head 3 -  String: NAMK
.head 3 -  String: NLSALT
.head 3 -  String: NLSKALT
.head 3 -  String: NAZN
.head 3 -  String: TT
.head 3 -  String: ISO
.head 3 -  String: MF
.head 3 -  String: NB
.head 3 -  String: OKPO
.head 3 -  Date/Time: FDAT
.head 3 -  Date/Time: DAPP
.head 3 -  Date/Time: DATD
.head 3 -  Number: ISP
.head 3 -  Number: ISP1
.head 3 -  Number: RNK
.head 3 -  Number: RNK1
.head 3 -  Number: KV
.head 3 -  Number: KV1
.head 3 -  Number: ACC
.head 3 -  Number: WD
.head 3 -  Number: USI
.head 3 -  Number: REF
.head 3 -  Number: SK
.head 3 -  Number: VOB
.head 3 -  Number: BIS
.head 3 -  Number: OSTF
.head 3 -  Number: OSTF1
.head 3 -  Number: S
.head 3 -  Number: SQ
.head 3 -  Number: SQV
.head 3 -  Number: SQY
.head 3 -  Number: SQY1
.head 3 -  Number: OBD
.head 3 -  Number: OBK
.head 3 -  Number: OBDQ
.head 3 -  Number: OBKQ
.head 3 -  String: PROB
.head 3 -  String: PROB3
.head 3 -  String: FIO
.head 3 -  String: maska
.head 3 -  String: maska2
.head 3 -  Number: nrab
.head 3 -  String: sTmp2
.head 3 -  Date/Time: dTmp2
.head 3 -  Number: OBD_P
.head 3 -  Number: OBK_P
.head 3 -  Number: OST_P
.head 3 -  Number: OBDQ_P
.head 3 -  Number: OBKQ_P
.head 3 -  Number: OSTQ_P
.head 3 -  Number: nDig
.head 3 -  Boolean: fNBU
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalHideWindow(tbl1)
.head 4 -  If SqlPrepareAndExecute( hSql(),
 "SELECT val FROM params
  WHERE par='NBUBANK' and val='1'" )
.head 4 -  Set fNBU=SqlFetchNext( hSql(), nFetchRes )
.head 4 -  Set PROB3 = '            ' 
.head 4 -  ! Set PROB3 = Spac(nSpace)
.head 4 -  Call SalStrRepeatX( ' ', nSpace)
.head 4 -  Call SalHideWindow(PB1)
.head 4 -  Call SalHideWindow(PB3)
.head 4 -  Set nrab = SalStrLength(sXX)
.head 4 -  ! Set sSqlW = " FROM tmp_lic  WHERE " || IifS(nrab=0, "", "substr(nls,1,1)<>:sXX and ")
.head 4 +  If para = 12 !! отчет для ПИКРИИ
.head 5 -  Call SalModalDialog(dlg_mas2, hWndForm, maska, maska2)
.head 5 +  If maska = '-'
.head 6 -  Call SalDestroyWindow(frm_LicAcc)
.head 6 -  Return TRUE
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 +  If not Podgot_LICS(ID, sFdat, sFdat2, maska, 1) !! накопление  во временные таблицы
.head 6 -  Call SalMessageBox('Не выполнена процедура P_LIC1' , 'Ошибка', MB_IconStop)
.head 5 +  Else
.head 6 -  Set strBind = 'NLS,KV,ISO,FDAT,S,SQ,ND,NLSK,REF,NAZN'
.head 6 -  Set strInput = strBind
.head 6 -  Set sSql = "
    SELECT l.nls,l.kv,l.fdat,l.s/100,
           gl.p_icurval(l.kv,l.s,l.fdat)/100,l.nd,l.nlsk,
           l.ref,l.nazn,t.lcv
    INTO :NLS,:KV,:FDAT,:S,:SQ,:ND,:NLSK,:REF,:NAZN,:ISO
    FROM tmp_lic l, tabval t
    WHERE l.kv=t.kv and l.s<0 and
          ltrim(rtrim(l.nlsk)) LIKE \'" ||
          SalStrTrimX(maska2) || "\' and
          ltrim(rtrim(l.nls))  LIKE \'" ||
          SalStrTrimX(maska) || "\'
    ORDER BY l.kv,l.fdat,l.ref "
.head 6 -  Call FU_SAL(1)
.head 5 -  Call SalDestroyWindow(frm_LicAcc)
.head 5 -  Return TRUE
.head 4 -  !
.head 4 -  Set maska = Maska_NLS("счетов") 
.head 4 +  If maska = '-'
.head 5 -  Call SalDestroyWindow(frm_LicAcc)
.head 5 -  Return TRUE
.head 4 -  !
.head 4 -  ! *** Ветка для обработки отчета входящих документов
.head 4 -  Call SalWaitCursor( TRUE )
.head 4 +  If not Podgot_LICS(ID,sFdat,sFdat2, maska, 1 ) !!  накопление  во временные таблицы
.head 5 -  Call SalMessageBox( 'Не выполнена процедура P_LIC'|| Str(IifN(para=1 and nXX=1,11, para) ), 'Ошибка', MB_IconStop )
.head 5 -  Call SalDestroyWindow(frm_LicAcc)
.head 5 -  Return TRUE
.head 4 -  ! ***
.head 4 -  Set sSqlS= T("SELECT fio INTO :FIO FROM staff WHERE id = :ISP " )
.head 4 -  Set sSqlT= T("SELECT lcv,name INTO :ISO,:NAMV FROM tabval WHERE kv=:KV")
.head 4 -  Set sSqlR= T("SELECT r.nmk,r.rnk  INTO :NMK,:RNK  FROM customer r,cust_acc ra WHERE ra.acc=:ACC and ra.rnk=r.rnk ")
.head 4 -  !
.head 4 -  Set strBind=
'ACC,NLS,KV,ISO,FDAT,S,SQ,ND,NLSK,NAMK,USI,REF,RNK,NAZN,OSTF,SQV,SQY,TT,DAPP,NLSALT,NLSKALT'
.head 4 -  Set sSql="
 SELECT isp,nls,kv,nms,acc,fdat,wd,s/100,
        gl.p_icurval(kv,s,fdat)/100,
        nd,nlsk,namk,userid,ref,nazn,tt,ostf/100,
        gl.p_icurval(kv,ostf,dapp)/100,
        gl.p_icurval(kv,osti,fdat)/100,
        dapp, nlsalt, nlskalt
  INTO :ISP,:NLS,:KV,:NMS,:ACC,:FDAT,:WD,:S,
       :SQ,:ND,:NLSK,:NAMK,:USI,:REF,:NAZN,:TT,:OSTF,
       :SQV,:SQY,:DAPP,:NLSALT,:NLSKALT 
  FROM tmp_lic  
  WHERE id=:ID "||
IifS( nP1 >0, " and isp=:nP1 ", "")  ||"
  ORDER BY nls, kv, fdat, s/100 " 
.head 4 -  ! Call Debug(sSql)
.head 4 -  ! Call DebugN(nP1)
.head 4 -  ! Call DebugN(ID)
.head 4 -  !
.head 4 -  Set strInput=strBind
.head 4 -  Call FU_SAL(ID)
.head 4 -  ! Call FU_SAL(IifN( nP1 >0, nP1, ID)  )
.head 4 -  Call SalDestroyWindow(frm_LicAcc)
.head 4 -  Return TRUE
.head 4 -  ! Call SalShowWindow(  tbl1 )
.head 4 -  ! Call SalShowWindow(  PB1 )
.head 4 -  ! Call SalShowWindow(  PB3 )
.head 3 +  On SAM_ReportStart
.head 4 -  ! Call Debug(sSql)
.head 4 -  Call SqlPrepare(hSql(), sSql)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  ! Call Debug(sSql)
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 -  ! Call Debug(Nazn)
.head 5 +  If para =1
.head 6 +  If RNK1 != ACC
.head 7 -  Set RNK1 = ACC
.head 7 -  If SqlPrepareAndExecute( hSqlAux(), sSqlR) and SqlFetchNext(hSqlAux(), nFetchRes)
.head 6 +  If KV1 != KV
.head 7 -  Set KV1 = KV
.head 7 -  If SqlPrepareAndExecute( hSqlAux(), sSqlT) and SqlFetchNext(hSqlAux(), nFetchRes)
.head 6 +  If ISP1 != ISP
.head 7 -  Set ISP1 = ISP
.head 7 -  If SqlPrepareAndExecute( hSqlAux(), sSqlS) and SqlFetchNext(hSqlAux(), nFetchRes)
.head 6 -  ! Call Debug(NLSALT)
.head 6 -  ! Call Debug(NLSKALT)
.head 5 -  ! проверка на 3 знака
.head 5 +  If SqlPrepareAndExecute( hSqlAux(), "SELECT dig INTO :nDig FROM tabval WHERE kv = :KV" )
and not SqlFetchNext( hSqlAux(), nFetchRes )
.head 6 -  Return FALSE
.head 5 -  Set S    = S*SalNumberPower( 10,2-nDig )
.head 5 -  Set SQ   = SQ*SalNumberPower( 10,2-nDig )
.head 5 -  Set OSTF = OSTF*SalNumberPower( 10,2-nDig )
.head 5 -  Set SQV  = SQV*SalNumberPower( 10,2-nDig )
.head 5 -  Set SQY  = SQY*SalNumberPower( 10,2-nDig )
.head 5 -  !
.head 5 -  Return TRUE
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam=RPT_BeforeReportHeader !! Перед началом формирования
.head 5 -  Call SalReportSetStringVar( SalNumberToWindowHandle(wParam), 'SDAT1',
	SalFmtFormatDateTime( StrToDateX( sFdat, 'MM-DD-YYYY' ), 'dd/MM/yyyy' ) )
.head 5 -  Call SalReportSetStringVar( SalNumberToWindowHandle(wParam), 'SDAT2',
	SalFmtFormatDateTime( StrToDateX( sFdat2, 'MM-DD-YYYY' ), 'dd/MM/yyyy' ) )
.head 4 +  If lParam=RPT_BeforeBreakHeader1 !! смена счета
.head 5 -  ! Для итога за период (EVE)
.head 5 -  Set OBD_P=0
.head 5 -  Set OBK_P=0
.head 5 -  Set OBDQ_P=0
.head 5 -  Set OBKQ_P=0
.head 5 -  Set OST_P=OSTF
.head 5 -  Set OSTQ_P=SQV
.head 5 -  !
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'AMFO', AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'AQH', AQH)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'NMK', NMK)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'NMS', NMS)
.head 5 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam), 'ISP', ISP)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'FIO', FIO)
.head 5 +  If para=1 !! инвалюта
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'NAMV',NAMV)
.head 5 +  ! If para=201 ! ! Для НБУ SDAT2 равно дате последнего движения на счету
.head 6 -  ! If SqlPrepareAndExecute( hSql(),
 "SELECT pdat, INTO :LastDate FROM saldoa
  WHERE acc=:ACC AND fdat=:FDAT" )
and SqlFetchNext( hSql(), nFetchRes )
.head 6 -          Call SalReportSetStringVar( SalNumberToWindowHandle(wParam), 'SDAT2',
	 'dd/MM/yyyy' )
.head 4 +  If lParam=RPT_BeforeBreakHeader2 !! Смена даты
.head 5 -  Set OBD=0
.head 5 -  Set OBK=0
.head 5 -  Set OBDQ=0
.head 5 -  Set OBKQ=0
.head 5 +  If para=1
.head 6 -  ! информация о курсе
.head 6 +  If SqlPrepareAndExecute( hSqlAux(),
     "SELECT bsum||' '||'"||ISO||"'||' = '||rate_o INTO :rab FROM cur_rates
      WHERE kv=:KV and vdate=
        (select MAX(vdate) from cur_rates where vdate<=:FDAT)")
and SqlFetchNext(hSqlAux(), nFetchRes)
.head 7 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
'KURS','Курс:'||SalStrLeftX( rab, 30) )
.head 6 -  ! информация о переоценке
.head 6 +  If SqlPrepareAndExecute(hSqlAux(),
   "SELECT gl.p_icurval(:KV,dos-kos,:FDAT)/100 INTO :nrab
    FROM saldoa WHERE acc=:ACC and fdat=:FDAT")
.head 7 +  If not SqlFetchNext(hSqlAux(), nFetchRes)
.head 8 -  Set nrab=0
.head 6 +  Else
.head 7 -  Set nrab=0
.head 6 -  Set nrab = SQY - SQV + nrab
.head 6 -  Set PROB=''
.head 6 +  If nrab !=0
.head 7 -  Set PROB = SalNumberToStrX(SalNumberAbs(nrab),2)
.head 7 +  If nrab < 0
.head 8 -  Set PROB=PROB || PROB3
.head 8 -  Set OBDQ= - nrab
.head 8 -  ! Переоценка за период (EVE)
.head 8 -  Set OBDQ_P=OBDQ_P - nrab
.head 7 +  Else
.head 8 -  Set OBKQ= nrab
.head 8 -  ! Переоценка за период (EVE)
.head 8 -  Set OBKQ_P=OBKQ_P + nrab
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'PEREOC',PROB)
.head 6 -  ! Set OBDQ=0
.head 6 -  ! Set OBKQ=0
.head 6 +  ! If SqlPrepareAndExecute(hSqlAux(),
"SELECT (-sum(gl.p_icurval(:KV,decode(o.dk,0,o.s,0), :FDAT))
         +  gl.p_icurval(:KV,s.dos,:FDAT))/100,
        (-sum(gl.p_icurval(:KV,decode(o.dk,1,o.s,0), :FDAT))
         +  gl.p_icurval(:KV,s.kos,:FDAT) )/100
 INTO :OBDQ,:OBKQ
 FROM opldok o, saldoa s
 WHERE s.acc=:ACC and s.fdat=:FDAT and s.acc=o.acc AND s.fdat=o.fdat
 GROUP BY s.dos,s.kos" )
and SqlFetchNext(hSqlAux(), nFetchRes)
.head 7 -             Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'OBDQ', OBDQ)
.head 7 -             Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'OBKQ', OBKQ)
.head 6 -  !
.head 5 -  Set rab=IifS(OSTF<0,'Дб:',IifS(OSTF>0,'Кр:',''))
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'VS',rab)
.head 5 -  Set OSTF1 = OSTF - OBD + OBK
.head 4 +  If lParam=RPT_BeforeDetail  
.head 5 +  If S<0
.head 6 -  Set OBD=OBD-S
.head 6 -  ! Для итога за период (EVE)
.head 6 -  Set OBD_P=OBD_P-S
.head 6 -  Set OBDQ_P=OBDQ_P-SQ
.head 6 -  !
.head 6 -  Set OBDQ=OBDQ-SQ
.head 6 -  Set PROB=PROB3
.head 5 +  Else
.head 6 -  Set OBK=OBK+S
.head 6 -  ! Для итога за период (EVE)
.head 6 -  Set OBK_P=OBK_P+S
.head 6 -  Set OBKQ_P=OBKQ_P+SQ
.head 6 -  !
.head 6 -  Set OBKQ=OBKQ+SQ
.head 6 -  Set PROB=''
.head 5 -  Set rab = SalNumberToStrX(SalNumberAbs(S),2) || PROB
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam), 'SS', rab)
.head 5 +  If S<0
.head 6 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam), 'S_D', SalNumberAbs(S))
.head 6 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam), 'S_K', 0)
.head 5 +  Else
.head 6 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam), 'S_D', 0)
.head 6 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam), 'S_K', SalNumberAbs(S))
.head 5 +  If para=1
.head 6 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
 'SSQ', SalNumberToStrX(SalNumberAbs(SQ),2) || PROB)
.head 6 +  If S<0
.head 7 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam), 'SQ_D', SalNumberAbs(SQ))
.head 7 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam), 'SQ_K', 0)
.head 6 +  Else
.head 7 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam), 'SQ_D', 0)
.head 7 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam), 'SQ_K', SalNumberAbs(SQ))
.head 4 +  If lParam=RPT_BeforeBreakFooter2
.head 5 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),  'OBD', OBD)
.head 5 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),  'OBK', OBK)
.head 5 -  Set rab=IifS(OSTF1<0,'Дб:',IifS(OSTF1>0,'Кр:',''))
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'VYS',rab)
.head 5 +  If para=1
.head 6 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'OBDQ', OBDQ)
.head 6 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),'OBKQ', OBKQ)
.head 4 +  If lParam=RPT_BeforeBreakFooter1
.head 5 -  ! Для итога за период (EVE)
.head 5 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),  'OBD_P', OBD_P)
.head 5 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),  'OBK_P', OBK_P)
.head 5 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),  'OBDQ_P', OBDQ_P)
.head 5 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),  'OBKQ_P', OBKQ_P)
.head 5 -  Set rab=IifS(OSTF1<0,'Дб:',IifS(OSTF1>0,'Кр:',''))
.head 5 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),  'OST_P', OST_P-OBD_P+OBK_P)
.head 5 -  Call SalReportSetNumberVar(SalNumberToWindowHandle(wParam),  'OSTQ_P', OSTQ_P-OBDQ_P+OBKQ_P)
.head 5 -  !
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'FIO',FIO)
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 3 +  On SAM_Destroy
.head 4 -  ! Call SqlPrepareAndExecute(hSql(), '
     DELETE
     FROM TMP_LIC
     WHERE ID=' || SalNumberToStrX(GetUserId(), 0))
.head 4 -  ! Call SqlCommit(hSql())
.head 4 -  Call SalWaitCursor(FALSE)
.head 1 +  Table Window: tbl_LicSepOB !! Выписки - участникам ВПС для ОЩАДБАНКА
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Банки
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? Yes
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   1.413"
.head 4 -  Top:    0.083"
.head 4 -  Width:  8.067"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 5.381"
.head 4 -  Height Editable? Yes
.head 3 -  Font Name: MS Sans Serif
.head 3 -  Font Size: 8
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 3 -  View: Table
.head 3 -  Allow Row Sizing? No
.head 3 -  Lines Per Row: Default
.head 2 -  Memory Settings
.head 3 -  Maximum Rows in Memory: 1000
.head 3 -  Discardable? No
.head 2 -  Description: Выписки - участникам ВПС
.head 2 -  Named Menus
.head 2 +  Menu
.head 3 +  Menu Item: Всех
.head 4 -  Resource Id: 60213
.head 4 -  Keyboard Accelerator: F1
.head 4 -  Status Text:
.head 4 +  Menu Settings
.head 5 -  Enabled when:
.head 5 -  Checked when:
.head 4 +  Menu Actions
.head 5 -  Set nRowType=0
.head 5 -  Call SalSendMsg(hWndForm, SAM_User, 0, 0)
.head 4 -  Menu Item Name:
.head 3 +  Menu Item: Выбранные
.head 4 -  Resource Id: 60214
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Status Text:
.head 4 +  Menu Settings
.head 5 -  Enabled when:
.head 5 -  Checked when:
.head 4 +  Menu Actions
.head 5 -  Set nRowType=ROW_Selected
.head 5 -  Call SalSendMsg(hWndForm, SAM_User, 0, 0)
.head 4 -  Menu Item Name:
.head 3 +  Menu Item: Выход
.head 4 -  Resource Id: 60215
.head 4 -  Keyboard Accelerator: F10
.head 4 -  Status Text:
.head 4 +  Menu Settings
.head 5 -  Enabled when:
.head 5 -  Checked when:
.head 4 +  Menu Actions
.head 5 -  Call SalSetFocus(hWndLicParent)
.head 5 -  Call SalDestroyWindow(tbl_LicSepOB)
.head 4 -  Menu Item Name:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Bottom
.head 4 -  Visible? No
.head 4 -  Size: 0.4"
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Column: mfo
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: МФО
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: 9
.head 4 -  Data Type: String
.head 4 -  Justify: Right
.head 4 -  Width:  0.967"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: sab
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Код
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: 4
.head 4 -  Data Type: String
.head 4 -  Justify: Center
.head 4 -  Width:  0.643"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 3 +  Column: nb
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Наименование банка
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  Maximum Data Length: Default
.head 4 -  Data Type: String
.head 4 -  Justify: Left
.head 4 -  Width:  5.717"
.head 4 -  Width Editable? Yes
.head 4 -  Format: Unformatted
.head 4 -  Country: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  Cell Options
.head 5 -  Cell Type? Standard
.head 5 -  Multiline Cell? No
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Yes
.head 6 -  Vertical Scroll? Yes
.head 6 -  Auto Drop Down? No
.head 6 -  Allow Text Editing? Yes
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Yes
.head 4 -  List Values
.head 4 -  Message Actions
.head 2 +  Functions
.head 3 +  Function: MIK
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  ! Для Ощадбанка изменено имя файла
.head 5 -  Set strFileNameTxt= '$W' || sab || Sep98md(SalDateConstruct(
    SalStrToNumber(SalStrRightX(sdat, 4)), SalStrToNumber(
    SalStrLeftX(sdat, 2)), SalStrToNumber(
    SalStrMidX(sdat, 3, 2)), 0, 0, 0)) || '.001'
.head 5 -  Call WaitCursorOn()
.head 5 -  ! Call SalReportPrintToFile(hWndForm, strDir, GetPrnDir() ||
     '/' || strFileName, strBind, strInput, 1, RPT_PrintAll,
     1, 1, FALSE, nInd)
.head 5 -  ! ==================================================
.head 5 -  ! Начинаем печать в отчет
.head 5 -  ! ==================================================
.head 5 -  Call SalReportPrintToFile(hWndForm, 
                                                        strTmplPath, 
                                                        strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                                        strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 5 +  If (nInd > 4 )
.head 6 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 5 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 5 -  Set frm_Out.dfPath = strPrintPath
.head 5 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 5 +  If not FL_FORMAT
.head 6 -  ! Call zarez12(GetPrnDir() || '\\' || strFileName, frm_Out.tbl1.Kod,
     frm_Out.tbl1.sDeviceDef)
.head 6 -  Call zarez12(  strPrintPath ||'/'|| strFileNameTxt,  frm_Out.tblReps.Kod, sDeviceDef)
.head 5 -  Call WaitCursorOff()
.head 3 +  ! Function: to32x
.head 4 -                        Description:
.head 4 +                        Returns
.head 5 -                        String:
.head 4 +                        Parameters
.head 5 -                        Number: n1
.head 4 -                        Static Variables
.head 4 +                        Local variables
.head 5 -                        String: s1
.head 5 -                        Number: n2
.head 4 +                        Actions
.head 5 -                        Set s1=''
.head 5 +                        While n1>=36
.head 6 -                        Set n2=SalNumberMod(n1, 36)
.head 6 -                        Set n1=(n1-SalNumberMod(n1, 36))/36
.head 6 +                        If n2<10
.head 7 -                        Set n2=n2+48
.head 6 +                        Else
.head 7 -                        Set n2=n2+55
.head 6 -                        Set s1=SalNumberToChar( n2)||s1
.head 5 -                        Set s1=s1||SalStrRepeatX( '0', 12)
.head 5 -                        Return SalStrLeftX(s1,8) || '.' || SalStrMidX( s1, 9,3)
.head 2 +  Window Parameters
.head 3 -  String: sdat
.head 2 +  Window Variables
.head 3 -  String: sKv
.head 3 -  Number: nIsp
.head 3 -  Number: nNls
.head 3 -  Number: nDk
.head 3 -  Number: nS
.head 3 -  Number: nOstf
.head 3 -  Date/Time: dtPdat
.head 3 -  String: sNms
.head 3 -  Number: nRef
.head 3 -  String: sText
.head 3 -  String: sTt
.head 3 -  String: strBankMfo
.head 3 -  Number: nRow
.head 3 -  String: strBankName
.head 3 -  !
.head 3 -  Number: nKv
.head 3 -  Number: nNlsk
.head 3 -  Number: nDos
.head 3 -  Number: nKos
.head 3 -  Date/Time: dtFdat
.head 3 -  Number: nAcc
.head 3 -  Number: nVob
.head 3 -  Number: nMfo
.head 3 -  Number: nMfoB
.head 3 -  String: sNd
.head 3 -  String: sNda
.head 3 -  String: sNdb
.head 3 -  String: sSql
.head 3 -  String: sIsp
.head 3 -  String: sNls
.head 3 -  Number: nInd
.head 3 -  String: sNd1
.head 3 -  String: sMfo1
.head 3 -  String: sNamk1
.head 3 -  String: lmfo
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalCenterWindow(hWndForm)
.head 4 -  Call SetWindowFont(hWndForm)
.head 4 -  !
.head 4 -  Set strBankMfo=GetBankMfo()
.head 4 -  ! Set bTblLicSep = TRUE
.head 4 -  !
.head 4 -  Set strBind='sKv,nIsp,nNls,nDos,nKos,sText,sTt'
.head 4 -  Set strInput='KV,ISP,NLS,DOS,KOS,TEXT,TT'
.head 4 -  Set sSql=
T("SELECT UNIQUE t.lcv,c.isp,c.nls,o.dk,o.s,a.ostf,a.pdat,c.nms, o.ref,o.txt, o.tt
 INTO  :sKv,  :nIsp,:nNls,:nDk,:nS,:nOstf,:dtPdat,:sNms,:nRef,:sText,:sTt
FROM opldok o,saldoa a,accounts c,bank_acc k,tabval t,
OUTER zag_a za,OUTER zag_b zb
where  c.kv=t.kv and o.acc=a.acc  and o.acc=c.acc and  o.acc=k.acc and
o.sos=5 and  k.mfo=:lmfo and
((c.tip='TUR' or c.tip='TUD') and a.dos<>a.kos or c.tip = 'L00') and
   o.fdat=a.fdat and a.fdat=:sdat  and o.ref=za.ref (+) and o.ref=zb.ref (+)
order by 1,2,3,4,5")
.head 4 -  Call WaitCursorOn()
.head 4 -  Call SalTblPopulate(hWndForm, hSql(),T("
SELECT mfo, sab, nb FROM Banks
 WHERE mfop=:strBankMfo AND (kodn=0 OR kodn=4 OR kodn=6)
 INTO  :tbl_LicSepOB.mfo, :tbl_LicSepOB.sab, :tbl_LicSepOB.nb"), TBL_FillAll)
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_User
.head 4 -  Call WaitCursorOn()
.head 4 -  Set nRow=TBL_MinRow
.head 4 +  Loop
.head 5 +  If SalTblFindNextRow(hWndForm, nRow, nRowType, 0)
.head 6 -  Call SalTblFetchRow(hWndForm, nRow)
.head 6 -  Call SalStatusSetText(hWndForm, sab)
.head 6 -  Call MIK()
.head 5 +  Else
.head 6 -  Break
.head 4 -  Call WaitCursorOff()
.head 4 -  Call SalStatusSetText(hWndForm, 'Готово')
.head 3 +  ! On SAM_Destroy
.head 4 -                        Set bTblLicSep = FALSE
.head 3 +  On SAM_ReportStart
.head 4 -  Set lmfo=tbl_LicSepOB.mfo
.head 4 -  Return SqlPrepare( hSqlAux(), sSql)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute( hSqlAux())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If SqlFetchNext( hSqlAux(), nFetchRes)
.head 5 -  Set nOstf=nOstf/100
.head 5 +  If nDk=0
.head 6 -  Set nDos=nS/100
.head 6 -  Set nKos=0
.head 5 +  Else
.head 6 -  Set nDos=0
.head 6 -  Set nKos=nS/100
.head 5 -  Set sText=SalStrLeftX( sText,12 )||SalStrRightX( SalStrRepeatX( ' ',18)|| SalNumberToStrX( nRef, 0),18)
.head 5 -  Return TRUE
.head 4 -  Return FALSE
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam=RPT_BeforeBreakHeader2
.head 5 -  Call SalReportSetStringVar( SalNumberToWindowHandle( wParam), 'aMFO', GetBankMfo() )
.head 5 -  Call SalReportSetStringVar( SalNumberToWindowHandle( wParam ), 'aQH', GetBankName())
.head 4 +  If lParam=RPT_BeforeBreakHeader3
.head 5 -  Call SalReportSetNumberVar( SalNumberToWindowHandle( wParam ), 'ACC', nAcc )
.head 5 -  Call SalReportSetNumberVar( SalNumberToWindowHandle( wParam ), 'OSTF', nOstf )
.head 5 -  Call SalReportSetStringVar( SalNumberToWindowHandle( wParam ), 'NMS', sNms )
.head 5 -  Call SalReportSetDateTimeVar( SalNumberToWindowHandle( wParam ), 'FDAT', dtFdat )
.head 5 -  Call SalReportSetDateTimeVar( SalNumberToWindowHandle( wParam ), 'PDAT', dtPdat )
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle( wParam ), 'DETAIL', "Iм'я  файлу         Референцiя" )
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 1 +  Form Window: frm_ARM       !! Карточка ARM-a
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: КАРТОЧКА ПОЛЬЗОВАТЕЛЯ
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  10.067"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 5.69"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Карточка ARM-a
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Child Table: tbl1 !!
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.083"
.head 6 -  Top:    0.048"
.head 6 -  Width:  9.6"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 4.5"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Dark Blue
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 3000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: Kod1
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Код
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.567"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: NAME1
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: НАИМЕНОВАНИЕ
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  7.283"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalTblPopulate(tbl1,hSql(),T("SELECT codeapp,name FROM applist order by 1" ) , TBL_FillAll)
.head 5 +  On SAM_DoubleClick
.head 6 -  Call FU_SAL(tbl1.Kod1)
.head 6 -  Call SalSetFocus(tbl1)
.head 5 +  On SAM_User
.head 6 -  Set nRow=TBL_MinRow
.head 6 +  Loop
.head 7 +  If SalTblFindNextRow (  tbl1, nRow, nTmp, 0 )
.head 8 -  Call SalTblSetContext( tbl1,nRow )
.head 8 +  If nRow >=0
.head 9 -  Call FU_SAL(tbl1.Kod1)
.head 7 +  Else
.head 8 -  Break
.head 6 -  Call SalSendMsg( tbl1, SAM_Create, 0, 0 )
.head 3 +  Pushbutton: PB1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Печать выбранных
.head 4 -  Window Location and Size
.head 5 -  Left:   3.583"
.head 5 -  Top:    4.714"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Midnight Blue
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set nTmp=ROW_Selected
.head 6 -  Call SalSendMsg( tbl1, SAM_User, 0, 0 )
.head 3 +  Pushbutton: PB2
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Печать ВСЕХ
.head 4 -  Window Location and Size
.head 5 -  Left:   0.983"
.head 5 -  Top:    4.714"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Midnight Blue
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set nTmp=0
.head 6 -  Call SalSendMsg( tbl1, SAM_User, 0, 0 )
.head 3 +  Pushbutton: PB3 !! завершить
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Завершить
.head 4 -  Window Location and Size
.head 5 -  Left:   6.183"
.head 5 -  Top:    4.714"
.head 5 -  Width:  2.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: 10
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalDestroyWindow(  frm_ARM )
.head 2 +  Functions
.head 3 +  Function: FU_SAL
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sP11
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call SalWaitCursor(TRUE)
.head 5 -  Set aa = sP11
.head 5 -  ! Set strFileName = aa || '.' || SalStrRightX(
    SalNumberToStrX(ID, 0), 3)
.head 5 -  Set strFileNameTxt = '#'||aa ||NumberToStrFormat (ID,3) || '.txt'
.head 5 -  Call SqlPrepareAndExecute(hSqlAux(), T("
     SELECT name
     INTO :FIO
     FROM applist
     WHERE codeapp=:aa"))
.head 5 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Set SS = T("
    SELECT 1,a.codeoper,a.name
    INTO :NNP,:KODP,:NAMEP
    FROM operlist a, operapp p
    WHERE a.codeoper=p.codeoper and p.codeapp='" || aa || "'
    UNION ALL
    SELECT 2,a.id,a.description
    FROM reports a, app_rep p
    WHERE a.id=p.coderep and p.codeapp='" || aa || "'
    UNION ALL
    SELECT 4,a.id,a.fio
    FROM staff a, applist_staff p
    WHERE a.id=p.id and p.codeapp='" || aa || "'
    UNION ALL
    SELECT 3,a.tabid,a.semantic
    FROM meta_tables a, refapp p
    WHERE a.tabid=p.tabid and p.codeapp='" || aa || "'
    ORDER BY 1,2")
.head 5 -  ! Call SalReportPrintToFile(hWndForm, strDir, GetPrnDir() ||
     '/' || IifS(FL_FORMAT, strFileName1, strFileName),
     strBind, strInput, 1, RPT_PrintAll, 1, 1, FL_FORMAT,
     nInd)
.head 5 -  ! ==================================================
.head 5 -  ! Начинаем печать в отчет
.head 5 -  ! ==================================================
.head 5 -  Call SalReportPrintToFile(hWndForm, 
                                                        strTmplPath, 
                                                        strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                                        strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 5 +  If (nInd > 4 )
.head 6 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 5 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 5 -  Set frm_Out.dfPath = strPrintPath
.head 5 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 5 +  If not FL_FORMAT
.head 6 -  Call zarez12(GetPrnDir() || '\\' || strFileNameTxt, frm_Out.tblReps.Kod,  sDeviceDef)
.head 5 -  Call SalWaitCursor(FALSE)
.head 2 +  Window Parameters
.head 3 -  String: sP1
.head 2 +  Window Variables
.head 3 -  Number: NNP
.head 3 -  Number: KODP
.head 3 -  String: NAMEP
.head 3 -  Number: ID1
.head 3 -  String: FIO
.head 3 -  String: SS
.head 3 -  String: aa
.head 3 -  Number: ISP
.head 3 -  Number: nRow
.head 3 -  Number: nTmp
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set strBind = 'NNP,KODP,NAMEP'
.head 4 -  Set strInput=strBind
.head 4 -  Call SalHideWindow(  tbl1 )
.head 4 -  Call SalHideWindow(  PB1 )
.head 4 -  Call SalHideWindow(  PB3 )
.head 4 +  If sP1 !=''
.head 5 -  Call FU_SAL(sP1)
.head 5 -  Call SalDestroyWindow( frm_ARM)
.head 4 -  Call SalShowWindow(  tbl1 )
.head 4 -  Call SalShowWindow(  PB1 )
.head 4 -  Call SalShowWindow(  PB3 )
.head 3 +  On SAM_ReportStart
.head 4 -  Call SqlPrepare(hSql(), SS)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 +  If not bFLS
.head 6 -  Set NAMEP=StrWinToDosX(NAMEP)
.head 5 -  Return TRUE
.head 3 +  On SAM_ReportNotify
.head 4 +  If lParam=RPT_BeforeReportHeader
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
 'SHAP',IifS(bFLS,SHAP,StrWinToDosX(SHAP)))
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'ID', aa)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
'FIO', IifS(bFLS,FIO,StrWinToDosX(FIO)))
.head 4 +  If lParam=RPT_BeforeBreakHeader1
.head 5 -  Set FIO=IifS(NNP=1,'ФУНКЦИЙ',
 IifS(NNP=2,'ОТЧЕТОВ',IifS(NNP=3,'СПРАВОЧНИКОВ',
'ПОЛЬЗОВАТЕЛЕЙ')))||':'
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),
'RESU', IifS(bFLS,FIO,StrWinToDosX(FIO)))
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 3 +  On SAM_Destroy
.head 4 -  Call SalWaitCursor( FALSE )
.head 1 +  Form Window: frm_Lables
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title:
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  1.867"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 0.321"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Data Field: dfFrom
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cFieldLabel
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.283"
.head 6 -  Top:    0.071"
.head 6 -  Width:  0.01"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.01"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 10
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfTo
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cFieldLabel
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   1.083"
.head 6 -  Top:    0.095"
.head 6 -  Width:  0.4"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.167"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 10
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Custom Control: cSpltMain
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cXSalVSplitterInvisible
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   0.186"
.head 6 -  Top:    0.073"
.head 6 -  Width:  4.1"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 1.0"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Yes
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  DLL Settings
.head 4 -  Message Actions
.head 2 -  Functions
.head 2 -  Window Parameters
.head 2 +  Window Variables
.head 3 -  Number: nWndX
.head 3 -  Number: nWndY
.head 3 -  Number: nWndH
.head 3 -  Number: nWndW
.head 3 -  Number: nWndX2
.head 3 -  Number: nWndY2
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SetWindowFont( hWndForm )
.head 4 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  Call cSpltMain.setLeftFrame( dfFrom)
.head 4 -  Call cSpltMain.setRightFrame( dfTo )
.head 4 -  Call cSpltMain.setStyle( XSalSplitter_NotResizable , TRUE )
.head 1 +  Form Window: frm_UniReport	!! Универсальный отчет 
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title:
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Yes
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  1.933"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 0.321"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Универсальный отчет 
строится на базе каталогизированных запросов
см. Q:\BARS98.DOC\MANUAL\QURY_SYS.DOC
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  ! Номер каталогизированного запроса
.head 3 -  Number: nQueryNo
.head 3 -  ! Формат экспорта каталогизированного запроса
.head 3 -  Number: nFormat
.head 3 -  ! C 
.head 3 -  String: sFdat
.head 3 -  ! По
.head 3 -  String: sFdat2
.head 3 -  ! Значения параметров
.head 3 -  String: sParams
.head 3 -  ! Показывать диалог ввода параметров
.head 3 -  Boolean: fAskParams
.head 3 -  ! Не использовать стандартное имя файла, предлагаемое генератором отчетов
  если TRUE - имя формируемого файла берется из настройки запроса или из параметров отчета
.head 3 -  Boolean: fOverrideFilename
.head 2 +  Window Variables
.head 3 -  Date/Time: dDate
.head 3 -  Date/Time: dDate2
.head 3 -  String: sAddParams
.head 3 -  String: sOutFile
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalWaitCursor( TRUE )
.head 4 -  ! Проц. формирования лицевых
.head 4 -  ! Определяем имя файла
.head 4 -  Set dDate=MMddyyyyToDate( sFdat )
.head 4 -  Set dDate2=MMddyyyyToDate( sFdat2 )
.head 4 -  Set sAddParams=
":sFdat1='" || SalFmtFormatDateTime( dDate, 'dd/MM/yyyy' )|| "'," ||
":sFdat2='" || SalFmtFormatDateTime( dDate2, 'dd/MM/yyyy' )|| "'"
.head 4 +  If sParams
.head 5 -  Set sParams = sParams || sAddParams
.head 4 +  Else
.head 5 -  Set sParams = sAddParams
.head 4 -  ! Использую каталогизированный запрос
.head 4 +  If (nFormat=3 OR nFormat=6) AND NOT fOverrideFilename
.head 5 +  If nFormat=6 AND NOT strFileNameRtf
.head 6 -  Set sOutFile=VisStrSubstitute( strFileNameTxt, '.txt', '.rtf' ) 
.head 5 +  Else If nFormat=3 AND NOT strFileNameTxt
.head 6 -  Set sOutFile=VisStrSubstitute( strFileNameRtf, '.rtf', '.txt' ) 
.head 5 +  Else
.head 6 -  Set sOutFile=IifS( nFormat=6, strFileNameRtf,  strFileNameTxt)
.head 4 +  Else
.head 5 -  Set sOutFile=""
.head 4 -  Call ExportCatQuery( 
   nQueryNo, 
   sOutFile,
   nFormat,
   sParams,
   fAskParams )
.head 4 -  ! Финиш
.head 4 -  ! Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 4 -  Set frm_Out.dfPath = strPrintPath
.head 4 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
.head 4 -  !
.head 4 -  Call SalWaitCursor( FALSE )
.head 4 -  Call SalDestroyWindow( hWndForm )
.head 1 +  Form Window: frm_Blok       !! НБУ.Перелiк блокованих рахункiв
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title:
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? No
.head 3 -  Automatically Created at Runtime? No
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   0.838"
.head 4 -  Top:    0.688"
.head 4 -  Width:  7.7"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.677"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Блокированние счета
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 -  Contents
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Number: para
.head 3 -  ! String: sdat2
.head 3 -  ! String: sdat
.head 2 +  Window Variables
.head 3 -  String: ss
.head 3 -  !
.head 3 -  String: BLOK
.head 3 -  Number: ISP
.head 3 -  String: NLS
.head 3 -  Number: OST
.head 3 -  Number: KL
.head 3 -  String: NMS
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set strBind = 'BLOK,ISP,NLS,OST,KL,NMS'
.head 4 -  Set strInput = strBind
.head 4 -  Set nInd = RPT_NoToolbar ! парамерт для управления печатью отчета
.head 4 +  If para = 0
.head 5 -  Set ss = T("
   SELECT 'Бл. Дт', A.ISP, A.NLS, A.OSTC,
        C.RNK , A.NMS
   INTO :BLOK, :ISP, :NLS, :OST, :KL, :NMS
   FROM ACCOUNTS A, CUST_ACC B, CUSTOMER C
   WHERE A.BLKD<>0 AND A.ACC=B.ACC AND B.RNK=C.RNK
   UNION ALL
   SELECT 'Бл. Кт', A.ISP, A.NLS, A.OSTC,
        C.RNK , A.NMS
   FROM ACCOUNTS A, CUST_ACC B, CUSTOMER C
   WHERE A.BLKK<>0 AND A.ACC=B.ACC AND B.RNK=C.RNK
   ORDER BY 1,2,3")
.head 4 -  Call SalHideWindow(hWndForm)
.head 4 -  ! ==================================================
.head 4 -  ! Начинаем печать в отчет
.head 4 -  ! ==================================================
.head 4 -  Call SalReportPrintToFile(hWndForm,
                                                        strTmplPath,
                                                        strPrintPath ||'/'|| IifS(FL_FORMAT, strFileNameRtf,  strFileNameTxt),
                                                        strBind,strInput,1,RPT_PrintAll,1,1,FL_FORMAT,nInd)
.head 4 +  If (nInd > 4 )
.head 5 -  Call SalMessageBox(' SalReportPrintToFile - возвратил ошибку '|| SalNumberToStrX(nInd,0) ,'Внимание',0 )

.head 4 -  ! ! ==== Посылаем сообщение чтоб перечитался список файлов для новой директории
.head 4 -  Set frm_Out.dfPath = strPrintPath
.head 4 -  Call SalSendMsg(frm_Out.dfPath, SAM_User, 0, 0)

.head 4 -  Call SalDestroyWindow(hWndForm)
.head 3 +  On SAM_ReportStart             !! приготовить SELECT
.head 4 -  Return SqlPrepare(hSql(), ss)
.head 3 +  On SAM_ReportFetchInit
.head 4 -  Return SqlExecute(hSql())
.head 3 +  On SAM_ReportFetchNext  !! вычитать очередную строку
.head 4 +  If SqlFetchNext(hSql(), nFetchRes)
.head 5 -  Return TRUE
.head 4 +  Else
.head 5 -  Return FALSE
.head 3 +  On SAM_ReportNotify	!! информировать ОТЧЕТ о глобальных переменных
.head 4 +  If lParam=RPT_BeforeReportHeader  !! только для заголовка
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'AMFO', AMFO)
.head 5 -  Call SalReportSetStringVar(SalNumberToWindowHandle(wParam),'AQH', AQH)
.head 3 +  On SAM_ReportFinish
.head 4 -  Call SalSendMsg( frm_Out.tblReps, UM_ReportFinish, 0, 0)
