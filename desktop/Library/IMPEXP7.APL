.head 0 +  Application Description: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
! Импорт / Экспорт данных в АБС  !
! ООО Унити-Барс (C) 1996-2000   !
! Разработчик: Костров С.В. & Ko !
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
.head 1 -  Outline Version - 4.0.26
.head 1 +  Design-time Settings
.data VIEWINFO
0000: 6F00000001000000 FFFF01000D004347 5458566965775374 6174650400010000
0020: 0000000000B20000 002C000000020000 0003000000000000 0029020000FCFFFF
0040: FFE9FFFFFF000000 00000000002C0300 0025000000010000 0000000000010000
0060: 000F4170706C6963 6174696F6E497465 6D00000000
.enddata
.data DT_MAKERUNDLG
0000: 0200000000001C71 3A5C626172733938 5C6C696272617279 5C524547434C4E2E
0020: 646C6C1C713A5C62 61727339385C6C69 62726172795C5245 47434C4E2E617063
0040: 00000101011C713A 5C6261727339385C 6C6962726172795C 524547434C4E2E72
0060: 756E1C713A5C6261 727339385C6C6962 726172795C524547 434C4E2E646C6C1C
0080: 713A5C6261727339 385C6C6962726172 795C524547434C4E 2E61706300000101
00A0: 01175C4241525339 385C42494E5C696D 70657870372E6170 64165C4241525339
00C0: 385C42494E5C696D 706578702E646C6C 165C424152533938 5C42494E5C696D70
00E0: 6578702E61706300 00010101001C713A 5C6261727339385C 6C6962726172795C
0100: 524547434C4E2E64 6C6C1C713A5C6261 727339385C6C6962 726172795C524547
0120: 434C4E2E61706300 00010101
.enddata
.head 2 -  Outline Window State: Normal
.head 2 +  Outline Window Location and Size
.data VIEWINFO
0000: 6600040003002D00 0000000000000000 0000B71E5D0E0500 1D00FFFF4D61696E
0020: 0000000000000000 0000000000000000 0000003B00010000 00000000000000E9
0040: 1E800A00008600FF FF496E7465726E61 6C2046756E637469 6F6E730000000000
0060: 0000000000000000 0000000000003200 0100000000000000 0000E91E800A0000
0080: DF00FFFF56617269 61626C6573000000 0000000000000000 0000000000000000
00A0: 3000010000000000 00000000F51E100D 0000F400FFFF436C 6173736573000000
00C0: 0000000000000000 0000000000000000
.enddata
.data VIEWSIZE
0000: D000
.enddata
.head 3 -  Left:   -0.013"
.head 3 -  Top:    0.0"
.head 3 -  Width:  8.013"
.head 3 -  Height: 4.969"
.head 2 +  Options Box Location
.data VIEWINFO
0000: 1018B80BB80B2500
.enddata
.data VIEWSIZE
0000: 0800
.enddata
.head 3 -  Visible? Yes
.head 3 -  Left:   4.15"
.head 3 -  Top:    1.885"
.head 3 -  Width:  3.8"
.head 3 -  Height: 2.073"
.head 2 +  Class Editor Location
.head 3 -  Visible? No
.head 3 -  Left:   0.575"
.head 3 -  Top:    0.094"
.head 3 -  Width:  5.063"
.head 3 -  Height: 2.719"
.head 2 +  Tool Palette Location
.head 3 -  Visible? No
.head 3 -  Left:   6.388"
.head 3 -  Top:    0.729"
.head 2 -  Fully Qualified External References? No
.head 2 -  Reject Multiple Window Instances? Yes
.head 2 -  Enable Runtime Checks Of External References? Yes
.head 2 -  Use Release 4.0 Scope Rules? No
.head 1 +  Libraries
.head 2 -  Dynalib: Global.apd
.head 2 -  Dynalib: Message.apd
.head 2 -  Dynalib: Absapi.apd
.head 2 -  Dynalib: Nsiapi.apd
.head 2 -  Dynalib: DOCVIEW.APD
.head 2 -  !
.head 2 -  File Include: Docfun6.apl
.head 2 -  File Include: Constant.apl
.head 2 -  File Include: GenButn.apl
.head 2 -  File Include: GenFcls.apl
.head 2 -  File Include: Gentbl.apl
.head 2 -  File Include: Gentimer.apl
.head 2 -  File Include: Winbars2.apl
.head 2 -  File Include: Vtmeter.apl
.head 2 -  File Include: Vtdos.apl
.head 2 -  File Include: Vtlbx.apl
.head 2 -  File Include: Vttblwin.apl
.head 2 -  File Include: Vtfile.apl
.head 2 -  File Include: Vtarray.apl
.head 2 -  File Include: XSALIMG.APL
.head 1 +  Global Declarations
.head 2 +  Window Defaults
.head 3 +  Tool Bar
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Form Window
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Dialog Box
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Top Level Table Window
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Data Field
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Multiline Field
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Spin Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Background Text
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Pushbutton
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Radio Button
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Check Box
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Option Button
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Group Box
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Child Table Window
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  List Box
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Combo Box
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Line
.head 4 -  Line Color: Use Parent
.head 3 +  Frame
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: 3D Face Color
.head 3 +  Picture
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 2 +  Formats
.head 3 -  Number: 0'%'
.head 3 -  Number: #0
.head 3 -  Number: ###000
.head 3 -  Number: ###000;'($'###000')'
.head 3 -  Date/Time: hh:mm:ss AMPM
.head 3 -  Date/Time: M/d/yy
.head 3 -  Date/Time: MM-dd-yy
.head 3 -  Date/Time: dd-MMM-yyyy
.head 3 -  Date/Time: MMM d, yyyy
.head 3 -  Date/Time: MMM d, yyyy hh:mm AMPM
.head 3 -  Date/Time: MMMM d, yyyy hh:mm AMPM
.head 3 -  Number: #0.
.head 2 +  External Functions
.head 3 +  Library name: IctBob.Dll
.head 4 +  Function: llopen
.head 5 -  Description: открытие файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: HANDLE
.head 5 +  Parameters
.head 6 -  ! первый параметр: имя файла, второй: тип открытия
.head 6 -  String: LPCSTR
.head 6 -  Number: INT
.head 4 +  Function: llcreat
.head 5 -  Description: создание файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: HANDLE
.head 5 +  Parameters
.head 6 -  ! первый параметр: имя файла, второй: тип открытия
.head 6 -  String: LPCSTR
.head 6 -  Number: INT
.head 4 +  Function: llclose
.head 5 -  Description: закрытие файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: HANDLE
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 4 +  Function: llread
.head 5 -  Description: чтение файла (C++)
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: UINT
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 6 -  String: LPVOID
.head 6 -  Number: UINT
.head 4 +  Function: llwrite
.head 5 -  Description:
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: UINT
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 6 -  String: LPCSTR
.head 6 -  Number: UINT
.head 4 +  Function: lllseek
.head 5 -  Description:
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: LONG
.head 5 +  Parameters
.head 6 -  Number: HANDLE
.head 6 -  Number: LONG
.head 6 -  Number: INT
.head 4 +  Function: llstr2str
.head 5 -  Description: преобразование строки HEXtoBIN
.head 5 -  Export Ordinal: 0
.head 5 -  Returns
.head 5 +  Parameters
.head 6 -  String: LPSTR
.head 6 -  Receive String: LPVOID
.head 6 -  Number: ULONG
.head 2 +  Constants
.data CCDATA
0000: 3000000000000000 0000000000000000 00000000
.enddata
.data CCSIZE
0000: 1400
.enddata
.head 3 +  System
.head 3 +  User
.head 2 +  Resources
.head 2 +  Variables
.head 3 -  ! Переменные для обязательных реквизитов клиентов банка
.head 3 -  Number: nRnk
.head 3 -  Number: nCusttype
.head 3 -  Number: nCountry
.head 3 -  String: strNmk
.head 3 -  String: strNmkv
.head 3 -  String: strNmkk
.head 3 -  Number: nCodcagent
.head 3 -  Number: nPrinsider
.head 3 -  Number: nOkpo
.head 3 -  String: strAdr
.head 3 -  String: strSab
.head 3 -  String: sTaxf
.head 3 -  Number: nTaxf
.head 3 -  Number: nC_reg
.head 3 -  Number: nC_dst
.head 3 -  ! Number: nRgtax
.head 3 -  ! String: sRgtax
.head 3 -  Date/Time: dtDateA
.head 3 -  String: strAdm
.head 3 -  Date/Time: dtDateT
.head 3 -  Number: nStmt
.head 3 -  Date/Time: dtDateOn
.head 3 -  Date/Time: dtDateOff
.head 3 -  String: strNotes
.head 3 -  Number: nCrisk
.head 3 -  Long String: lstrNotesSec
.head 3 -  String: strPinCode
.head 3 -  Date/Time: dTempDate
.head 3 -  ! Переменные для дополнительных реквизитов клиентов
  (Юридические лица)
.head 3 -  String: strNmku
.head 3 -  String: strRuk
.head 3 -  String: strTelr
.head 3 -  String: strBuh
.head 3 -  String: strTelb
.head 3 -  String: strIse
.head 3 -  String: strFs
.head 3 -  String: strOe
.head 3 -  String: strSed
.head 3 -  String: strVed
.head 3 -  ! Переменные для дополнительных реквизитов клиентов
  (Физические лица)
.head 3 -  Number: nSex
.head 3 -  Number: nPassp
.head 3 -  String: strSer
.head 3 -  String: strNumDoc
.head 3 -  Date/Time: dtPdate
.head 3 -  String: strOrgan
.head 3 -  Date/Time: dtBday
.head 3 -  String: strBplace
.head 3 -  String: strTeld
.head 3 -  String: strTelw
.head 3 -  ! Переменные для дополнительных реквизитов клиентов (Банки)
.head 3 -  String: strMfoEx
.head 3 -  String: strBic
.head 3 -  String: strAltBic
.head 3 -  Number: nFetchRes
.head 3 -  String: sText
.head 2 +  Internal Functions
.head 3 +  Function: ImpOper7				! __exported
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Window Handle: hW
.head 5 -  Number: nOper
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If nOper = 0      ! OPER
.head 6 -  Call SalModalDialog(dlg_ImpOper, hW, 5)
.head 5 +  Else If nOper = 1 ! OPERV
.head 6 -  Call SalModalDialog(dlg_ImpOperV, hW, 5)
.head 5 +  Else If nOper = 2 ! OPERNB
.head 6 -  Call SalModalDialog(dlg_ImpOperNB, hW, 5)
.head 5 +  Else
.head 6 -  Return FALSE
.head 3 +  Function: Perenos
.head 4 -  Description: Разбиение назначения платежа
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  String: sTxt	! текст
.head 5 -  Number: nLen	! длина
.head 5 -  Number: nSpaces ! количество пробелов слева
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sNana[*]
.head 5 -  Number: nL
.head 5 -  String: sI
.head 5 -  Number: nJ
.head 5 -  Number: nC
.head 5 -  String: sRes
.head 4 +  Actions
.head 5 -  Set nL = 0
.head 5 -  Set sI = SalStrTrimX(sTxt)
.head 5 +  Loop
.head 6 +  If Len(sI) = 0
.head 7 -  Break
.head 6 +  If Len(sI) < nLen+1
.head 7 -  Set sNana[nL] = sI
.head 7 -  Break
.head 6 -  Set nJ = nLen + 1
.head 6 -  Set sNana[nL] = Left(sI, nJ)
.head 6 +  While nJ > 0
.head 7 +  If Subs(sNana[nL], nJ, 1) = ' ' or
   Subs(sNana[nL], nJ, 1) = ',' or
   Subs(sNana[nL], nJ, 1) = '.' or
   Subs(sNana[nL], nJ, 1) = ';' or
   Subs(sNana[nL], nJ, 1) = ':' or
   Subs(sNana[nL], nJ, 1) = '-'
.head 8 -  Set sNana[nL] = SalStrTrimX(Left(sNana[nL], nJ))
.head 8 -  Set sI = SalStrTrimX(Subs(sI, nJ+1, Len(sI)-nJ))
.head 8 -  Break
.head 7 -  Set nJ = nJ - 1
.head 7 +  If nJ = 0
.head 8 -  Set sI = SalStrTrimX(Subs(sI, nLen+1, Len(sI)-nLen))
.head 6 -  Set nL = nL + 1
.head 5 -  Set nC = 0
.head 5 -  Set sRes = ''
.head 5 +  While nC <= nL
.head 6 -  Set sRes = sRes || Spac(nSpaces) || sNana[nC] || PutCrLf()
.head 6 -  Set nC = nC + 1
.head 5 -  Return sRes
.head 2 +  Named Menus
.head 2 +  Class Definitions
.data RESOURCE 0 0 1 1398196587
0000: 6702000036010000 0000000000000000 0200000400FFFF01 00160000436C6173
0020: 73566172004F7574 6C696E6552006567 496E666F0D003C00 00086300446F634E
0040: 4F4B4B1E80000000 0100000047010D00 00FFFF0101804D00 000001C200000463
0060: 4400D40000000800 00000F02040000FE 00FF9304000002FB 00FF6F0800EE0200
0080: FF3F0C00B0000001 0D00FFFFE0190000 0001FE00FF832600 000001FB00FF0F33
00A0: 000000EE0100FF3F 4000B800000100FF FF00018041000000 02000000000D6352
00C0: 616469006F4C6973 74426F7800860000 0005000000CF010D FE00FF930D000001
00E0: FB00FF0F1A000000 EE0100FF3F2700B8 00000100FFFFE034 00000001FE00FF03
0100: 0180220000000003 0000000A63476500 6E46696C74657274 B000000004006702
0120: 0400F40100000F80 010000FE008D0400 010DFD00FF071100 000002F700FF1F15
0140: 0000DC000100FF7F
.enddata
.head 3 +  Functional Class: cDocNOKK
.head 4 -  Description: Класс документа для электронных клиентов
.head 4 +  Derived From
.head 5 -  Class: cDoc
.head 4 -  Class Variables
.head 4 +  Instance Variables
.head 5 -  Boolean: bSignInited
.head 4 +  Functions
.head 5 +  Function: sIni
.head 6 -  Description: Инициализировать ЭЦП
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 -  Parameters
.head 6 +  Static Variables
.head 7 -  ! Boolean: bSignInited
.head 7 -  Number: nTim
.head 6 +  Local variables
.head 7 -  ! String: strUxDateTime
.head 7 -  String: strDay
.head 7 -  Number: nDay
.head 7 -  Number: nErrorSign
.head 7 -  String: strErrorSign
.head 7 -  String: strPinCode
.head 6 +  Actions
.head 7 -  ! Call Debug('bSignInited:'||Str(bSignInited))
.head 7 +  If bSignInited
.head 8 -  Return TRUE
.head 7 +  If GetSignType() = 'UKR' or GetSignType() = 'NBU'
.head 8 -  Set nErrorSign = NUMBER_Null
.head 8 -  Set strPinCode = ''
.head 8 +  While TRUE
.head 9 +  If SalModalDialog(dlgAskPinCode, hWndForm,strPinCode)
.head 10 +  If GetSignType() = 'NBU'
.head 11 +  If bSignInited
.head 12 -  Set nErrorSign = CLOSE_ZAH()
.head 11 -  ! Set strUxDateTime = '1998/01/18 08:08:08'
    !!! ТОЛЬКО ДЛЯ ОТЛАДКИ !!!
.head 11 -  ! Set strUxDateTime = SalFmtFormatDateTime(
    GetBankDate(), 'yyyy/MM/dd') ||
    ' 07:07:07'
.head 11 -  Set nErrorSign = INIT_ZAH(GetOpenKeyDir(),
    GetSecretKeyDrv(), GetIdOper(),
    GetKeyDate(), strPinCode)
.head 11 +  If nErrorSign = -70
.head 12 -  Call MessageErrorEx('>> RSA. Последний ' ||
     'день действия секретного ключа')
.head 11 +  Else If nErrorSign > -77 And nErrorSign < -70
.head 12 -  Set nDay = - nErrorSign - 70
.head 12 +  If nDay = 1
.head 13 -  Set strDay = 'день'
.head 12 +  Else If nDay = 2 Or nDay = 3 Or nDay = 4
.head 13 -  Set strDay = 'дня'
.head 12 +  Else If nDay = 5 Or nDay = 6
.head 13 -  Set strDay = 'дней'
.head 12 -  Call MessageErrorEx('>> RSA. Срок действия'
     || 'секретного ключа прекращается ' ||
     'через ' || NumberToStr(nDay) || ' '
     || strDay)
.head 11 +  Else If nErrorSign != 0
.head 12 -  Break
.head 10 +  Else
.head 11 +  If bSignInited
.head 12 -  Set nErrorSign = nsignExitOPSign()
.head 11 -  ! Cipher 98
.head 11 -  ! Set nErrorSign = nsignInitOPSign(
    GetOpenKeyDir(), GetSecretKeyDrv(),
    strPinCode, GetBankMfo())
.head 11 -  ! Cipher 99 с ОперИдом
.head 11 -  Set nErrorSign = nsignInitOPSign(
    GetOpenKeyDir(), GetSecretKeyDrv(),
    strPinCode, GetBankMfo(),GetIdOper())
.head 11 -  ! Отладка
.head 11 -  ! Set nErrorSign = nsignInitOPSign(
    GetOpenKeyDir(), GetSecretKeyDrv(),
    strPinCode, '351447', GetIdOper())
.head 11 +  If nErrorSign != 0
.head 12 -  Break
.head 10 -  Call SaveInfoToLog('>> RSA - инициализация - OK')
.head 10 -  Set bSignInited = TRUE
.head 10 -  Return TRUE
.head 9 +  Else
.head 10 -  Break
.head 8 +  If nErrorSign != NUMBER_Null ! обработка ошибок ЭЦП
.head 9 +  If GetSignType() = 'NBU'
.head 10 -  Set strErrorSign = '>> RSA. Ошибка инициализации ЭЦП: '||NumberToStr(nErrorSign)
.head 10 -  ! Call CLOSE_ZAH()
.head 10 -  Call MessageErrorEx(strErrorSign)
.head 9 +  Else
.head 10 -  Set strErrorSign = Spac(129)
.head 10 -  Call nsignMapError2Text(strErrorSign,
     nErrorSign)
.head 10 -  Call MessageErrorEx('>> CIP. ' ||
     StrDosToWinX(strErrorSign))
.head 10 -  Call nsignExitOPSign()
.head 8 -  Return FALSE
.head 7 +  Else
.head 8 -  Return MessageErrorEx('Неизвестная система ЭЦП: '|| GetSignType())
.head 7 +  ! Комментарий
.head 8 -  ! 'NBU' -- используется ЭЦП НБУ
.head 8 -  ! 'UKR' -- используется ЭЦП Банка 'Украина'
.head 2 +  Default Classes
.head 3 -  MDI Window: cBaseMDI
.head 3 -  Form Window:
.head 3 -  Dialog Box:
.head 3 -  Table Window:
.head 3 -  Quest Window:
.head 3 -  Data Field:
.head 3 -  Spin Field:
.head 3 -  Multiline Field:
.head 3 -  Pushbutton:
.head 3 -  Radio Button:
.head 3 -  Option Button:
.head 3 -  Check Box:
.head 3 -  Child Table:
.head 3 -  Quest Child Window: cQuickDatabase
.head 3 -  List Box:
.head 3 -  Combo Box:
.head 3 -  Picture:
.head 3 -  Vertical Scroll Bar:
.head 3 -  Horizontal Scroll Bar:
.head 3 -  Column:
.head 3 -  Background Text:
.head 3 -  Group Box:
.head 3 -  Line:
.head 3 -  Frame:
.head 3 -  Custom Control: cMeter
.head 2 -  Application Actions
.head 1 +  Dialog Box: dlg_ImpOper
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Прием документов  из 'старого' БАРСа (BARS-3.01 ОДБ-БАРС 1.98.01)
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   0.138"
.head 4 -  Top:    0.094"
.head 4 -  Width:  12.983"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 6.798"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Прием документов и оплата документов из 'старого' БАРСа
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? No
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 -  Background Text: Всего:
.head 4 -  Resource Id: 35602
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.083"
.head 5 -  Top:    0.119"
.head 5 -  Width:  1.317"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.226"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: 12
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfReccount
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 6
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   1.583"
.head 6 -  Top:    0.095"
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.226"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  Background Text: Выбрано:
.head 4 -  Resource Id: 6452
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   4.783"
.head 5 -  Top:    0.095"
.head 5 -  Width:  1.65"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.226"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: 12
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Blue
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfAll
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 6
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   6.583"
.head 6 -  Top:    0.095"
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.226"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  Background Text: Обработано:
.head 4 -  Resource Id: 6453
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   9.083"
.head 5 -  Top:    0.095"
.head 5 -  Width:  2.267"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.226"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: 12
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Dark Green
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfCurrent
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 6
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   11.583"
.head 6 -  Top:    0.095"
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.226"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbExecute
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Выполнить
.head 4 -  Window Location and Size
.head 5 -  Left:   1.983"
.head 5 -  Top:    5.821"
.head 5 -  Width:  1.5"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Enter
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalDisableWindow(dfBD)
.head 6 +  If IsBankDayOpen()
.head 7 -  Set sAn = dfAn
.head 7 +  If MessageQuestion('Прием/Оплата ' || IifS(nISOS=5, '', 'M') || 'OPER ' || sAn ||
   ' ?') = IDNO
.head 8 -  Return FALSE
.head 7 -  Call WaitCursorOn()
.head 7 -  Call SalDisableWindow(pbExecute)
.head 7 -  Call SalDisableWindow(pbExit)
.head 7 -  Set dfDone = ""
.head 7 -  Call SalUseRegistry(FALSE, '')
.head 7 -  Call SalGetProfileString('Import', 'OperPath', Left(SalFileGetDrive(), 1) ||
     ':\\BARS98\\ODBC.DSN\\OPER', sODBCDir, GetIniFileName())
.head 7 -  Call SaveInfoToLog('Прием документов из ' || IifS(nISOS=5, '', 'M') || 'OPER' ||
     sAn)
.head 7 +  If SalFileSetCurrentDirectory(sODBCDir)
.head 8 -  Set SqlDatabase = 'dBase_Files'
.head 8 +  If SalFileGetDateTime(sODBCDir || '\\' || IifS(nISOS=5, '', 'M') || 'OPER' || sAn
   || '.dbf', dTmp)
.head 9 -  ! проверить, есть ли поле ref99bm в operxx если нет, то добавить его
.head 9 -  Set n99 = -1
.head 9 -  Set dfDone = "Подождите ..."
.head 9 -  Call SalLoadAppAndWait("FindVar " || sODBCDir || '\\' || IifS(nISOS=5, '', 'M')
     || 'OPER' || sAn || " ref99bm", Window_NotVisible, n99)
.head 9 -  Set dfDone = ""
.head 9 +  If SqlConnect(hSqlA) and SqlConnect(hSqlB)
.head 10 -  Call SqlPrepareAndExecute(hSqlA, "
     SELECT DA
     FROM " || IifS(nISOS=5, '', 'm') || "oper" || sAn || "
     INTO :dTempDate")
.head 10 -  Call SqlFetchNext(hSqlA, nFetchRes)
.head 10 +  If dTempDate != dfBD
.head 11 -  Call SqlDisconnect(hSqlA)
.head 11 -  Call SqlDisconnect(hSqlB)
.head 11 -  Call MessageAttention(sODBCDir || '\\' || IifS(nISOS=5, '', 'M') || 'OPER'
     || sAn || '.dbf не за требуемую (текущую) дату. Выход.')
.head 11 -  Call SalEnableWindow(pbExit)
.head 11 -  Return FALSE
.head 10 -  !
.head 10 -  Call SqlPrepareAndExecute(hSqlA, "
     SELECT count(*)
     FROM " || IifS(nISOS=5, '', 'm') || "oper" || sAn || "
     INTO :nRecCount")
.head 10 -  Call SqlFetchNext(hSqlA, nFetchRes)
.head 10 -  Call SalShowWindow(dfStart)
.head 10 -  Call SalShowWindow(dfEnd)
.head 10 -  Set nTimeStart = SalDateHour(SalDateCurrent())*3600 + SalDateMinute(
    SalDateCurrent())*60 + SalDateSecond(SalDateCurrent())
.head 10 -  Set dfStart = 'Старт: ' || SalFmtFormatDateTime(SalDateCurrent(), 'hhh:mm:ss')
.head 10 -  Set dfReccount = nRecCount
.head 10 -  Set dfCurrent = 0
.head 10 -  Set dfAll = 0
.head 10 -  Set nPos = 0
.head 10 -  Set nTek = 0
.head 10 -  Set nRecn = 1
.head 10 -  Set nDelta = 100 / nRecCount
.head 10 -  Call SqlPrepareAndExecute(hSql(), "
     SELECT fdat
     FROM fdat
     WHERE fdat=:dfBD")
.head 10 +  If not SqlFetchNext(hSql(), nFetchRes)
.head 11 -  Call SqlPrepareAndExecute(hSql(), "
     INSERT
     INTO fdat (fdat)
     VALUES (:dfBD)")
.head 10 +  If dfBD != dBat
.head 11 -  Call Pl_dat(dfBD) ! Установить банковскую дату равной dfBD (но не совсем)
.head 10 -  Call SqlSetResultSet(hSqlA, FALSE)
.head 10 -  Call SqlPrepare(hSqlA, "
     SELECT rowid,nm,dk,mfo,nd,vob,nls,nlsk,sk,s,datd,da,plat,polu,naz1,vspo,
            kod,kodb,kisp,sign,ns,np,sos,ref99bm,vdate,tp,kw
     INTO :nRow,:nNm,:nDk,:nMfo,:sNd,:nVob,:sNls,:sNlsk,:nSk,:nS,:dDat,:dPat,
          :sPlat,:sPolu,:sNaz1,:sVspo,:sKod,:sKodB,:sKisp,:sSign,:NS,:nNp,
          :nSos,:nRef99bm,:dVdate,:sTp,:nKw
     FROM " || IifS(nISOS=5, '', 'm') || "oper" || sAn || "
     FOR UPDATE OF sos")
.head 10 -  Call SqlOpen(hSqlA, IifS(nISOS=5, '', 'm') || "oper")
.head 10 +  While SqlFetchNext(hSqlA, nFetchRes)
.head 11 -  Set sNls = SalStrTrimX(sNls)
.head 11 -  Set sNlsk = SalStrTrimX(sNlsk)
.head 11 -  ! Перекодировка
.head 11 -  Set sNd = SalStrTrimX(StrDosToWinX(sNd))
.head 11 -  Set sPlat = SalStrTrimX(StrDosToWinX(sPlat))
.head 11 -  Set sPolu = SalStrTrimX(StrDosToWinX(sPolu))
.head 11 -  Set sNaz1 = SalStrTrimX(StrDosToWinX(sNaz1))
.head 11 -  Set sVspo = SalStrTrimX(StrDosToWinX(sVspo))
.head 11 -  !
.head 11 -  Set sMfo = Str(nMfo)
.head 11 +  If dDat = DATETIME_Null
.head 12 -  Set dDat = dBat
.head 11 +  If dPat = DATETIME_Null
.head 12 -  Set dPat = dBat
.head 11 -  Set sKod = SalStrTrimX(sKod)
.head 11 -  Set sKodB = SalStrTrimX(sKodB)
.head 11 -  Set lsSign = sSign
.head 11 -  Set nNewRow = SalTblInsertRow(tbl1, TBL_MaxRow)
.head 11 -  Call SalTblSetFocusRow(tbl1, nNewRow)
.head 11 -  Set tbl1.colNPP = nRecn
.head 11 -  Set tbl1.colND = sNd
.head 11 -  Set tbl1.colVOB = nVob
.head 11 -  Set tbl1.colMFOA = IifS(Val(sNls)=0, '', GetBankMfo())
.head 11 -  Set tbl1.colNLSA = sNls
.head 11 -  Set tbl1.colNAMA = sPlat
.head 11 +  If Val(sNls) = 0
.head 12 -  Set tbl1.colVALA = NUMBER_Null
.head 11 +  Else
.head 12 -  Set tbl1.colVALA = 980
.head 11 -  Set tbl1.colMFOB = IifS(Val(sNls)=0, '', IifS(nMfo=0, GetBankMfo(), sMfo))
.head 11 -  Set tbl1.colNLSB = sNlsk
.head 11 -  Set tbl1.colNAMB = sPolu
.head 11 +  If Val(sNls) = 0
.head 12 -  Set tbl1.colVALB = NUMBER_Null
.head 11 +  Else
.head 12 -  Set tbl1.colVALB = 980
.head 11 -  Set tbl1.colS = nS/100
.head 11 -  Set tbl1.colVDATE = dVdate
.head 11 -  Set tbl1.colNAZN = sNaz1
.head 11 -  Set tbl1.colREF98 = nRef99bm
.head 11 -  Call SalTblSetRowFlags(tbl1, nNewRow, ROW_Edited | ROW_New, FALSE)
.head 11 +  If Val(sNls) = 0
.head 12 -  Call VisTblSetRowColor(tbl1, nNewRow, COLOR_Gray)
.head 11 -  ! обход автопроводок для НБУ старого Барса
.head 11 +  If SqlPrepareAndExecute(hSqlAux2(), "
   SELECT val
   FROM params
   WHERE par='NBUBANK'") and SqlFetchNext(hSqlAux2(), nFetchRes)
.head 12 +  If (nNm = 1 or nNm = 2) and nSos = nISOS and nS > 0
.head 13 -  ! If nNm = 1 and (nNp = 380 or nNp = 301 or nNp = 309 or nNp = 326)
.head 13 +  ! Else
.head 14 -   Call PROVODKA()
.head 13 -  If nNm = 1 and (nNp = 380 or nNp = 301 or (sTp = '99' and nVob = 66))
.head 13 +  Else
.head 14 -  Call PROVODKA()
.head 11 -  ! обход автопроводок для КБ старого Барса
.head 11 +  Else
.head 12 +  If (nNm = 1 or nNm = 2) and nSos = nISOS and nS > 0 and
   (not (nNp = 380 and nNm = 1 and (Left(sNls,4) = '3801' or
   Left(sNlsk,4) = '3801')) and not (nNp = 991 and nNm = 1 and
   (Left(sNls,4) = '1200' or Left(sNlsk,4) = '1200')))
.head 13 -  Call PROVODKA()
.head 11 -  !
.head 11 -  Call SalTblSetCellTextColor(tbl1.colNPP,COLOR_Charcoal, TRUE)
.head 11 -  Set nPos = nPos + nDelta
.head 11 -  Set nRecn = nRecn + 1
.head 11 +  If Int(nPos) != nTek
.head 12 -  Set nTek = Int(nPos)
.head 12 -  Set nTimeCurrent = SalDateHour(SalDateCurrent())*3600 + SalDateMinute(
    SalDateCurrent())*60 + SalDateSecond(SalDateCurrent())
.head 12 -  Set nTimeEnd = Int(100 * (nTimeCurrent-nTimeStart) / nPos + nTimeStart)
.head 12 -  ! Call Debug('nPos=' || Str(nPos) || ', nTimeStart=' || Str(nTimeStart) ||
    ', nTimeEnd=' || Str(nTimeEnd))
.head 12 -  Set nHour = Int(nTimeEnd/3600)
.head 12 -  Set nTemp = nTimeEnd - nHour*3600
.head 12 -  Set nMinu = Int(nTemp/60)
.head 12 -  Set dfStart = dfStart
.head 12 -  Set dfEnd = 'Финиш: ' || Right(Str(100+nHour), 2) || ':' || Right(
    Str(100+nMinu), 2) || ':' || Right(Str(100+nTemp-nMinu*60), 2) ||
    ' (прогноз)'
.head 12 -  Set dfReccount = dfReccount
.head 12 -  Set dfCurrent = dfCurrent
.head 12 -  Set dfAll = dfAll
.head 11 -  Call ccProgressBar.SetProgress(nPos)
.head 11 -  Call SalUpdateWindow(hWndForm)
.head 10 -  ! Set dfCurrent = NUMBER_Null
.head 10 -  Call ccProgressBar.SetProgress(100)
.head 10 -  Call SqlCommitEx(hSql(), 'OK')
.head 10 -  Call SqlCommit(hSqlB)
.head 10 -  Call SqlDisconnect(hSqlA)
.head 10 -  Call SqlDisconnect(hSqlB)
.head 10 -  Call SaveInfoToLog('Прием документов из ' || IifS(nISOS=5, '', 'M') || 'OPER'
     || sAn || ' ОКОНЧЕН')
.head 10 -  Set dfDone = "Готово"
.head 10 -  Set dfEnd = Left(dfEnd, 15)
.head 10 +  If dfCurrent > 0
.head 11 -  ! сформировать файл оплаченных документов
.head 11 -  Set nCurrentRow = TBL_MinRow
.head 11 -  Set nP = 1
.head 11 -  Set nItog = 0
.head 11 -  Set sFr = GetPrnDir() || '\\' || IifS(nISOS=5, 'O', 'M') || 'O' || Right(
    Str(SalDateMonth(dBat)+100), 2) || Right(Str(SalDateDay(dBat)+100), 2)
    || Right(Str(SalDateHour(SalDateCurrent())+100), 2) || '.' || Right(Str(
    SalDateMinute(SalDateCurrent())+100), 2)
.head 11 -  Call SalFileOpen(hF, sFr, OF_Create | OF_Write)
.head 11 -  Set sBuff = StrWinToDosX(SalStrTrimX(GetBankName()) || ' ' || SalStrTrimX(
    GetBankMfo()) || PutCrLf() || 'Дата и время формирования ' ||
    SalFmtFormatDateTime(SalDateCurrent(), 'dd/MM/yyyy ') || Right('0' ||
    SalFmtFormatDateTime(SalDateCurrent(), 'hhhh:mm:ss'), 8) || PutCrLf() ||
    PutCrLf() || Spac(15) || 'Реестр оплаченных платежных документов' ||
    PutCrLf() || Spac(15) || '(' || IifS(nISOS=5, '', 'M') ||
    'OPER) сеанс (с ' || Right(dfStart, 8) || ' по ') || Right(dfEnd, 8) ||
    ')' || PutCrLf() || Repl('-', 69) || PutCrLf()
.head 11 -  Call SalFileWrite(hF, sBuff, Len(sBuff))
.head 11 +  While SalTblFindNextRow(tbl1, nCurrentRow, 0, 0)
.head 12 -  Call SalTblSetFocusRow(tbl1, nCurrentRow)
.head 12 -  Set nColor = SalColorGet(tbl1.colNLSA,
    COLOR_IndexCellText)
.head 12 +  If nColor = COLOR_DarkGreen
.head 13 -  Set sLev = tbl1.colTT || ' реф.' || Str(tbl1.colREF98) || ', док.' ||
    SalStrTrimX(tbl1.colND) || ', оп.' || Str(tbl1.colVOB)
.head 13 -  Set sBuff = PadR(Str(nP) || '.', 4) || GetBankMfo() || ' ' ||
    PadR(tbl1.colNLSA || '(' || Right(Str(tbl1.colVALA+1000), 3) ||
    ')', 20) || StrWinToDosX(SalStrTrimX(tbl1.colNAMA) || PutCrLf() ||
    '    ' || IifS(Val(tbl1.colMFOB)=0, GetBankMfo(), tbl1.colMFOB) ||
    ' ' || PadR(tbl1.colNLSB || '(' || Right(Str(tbl1.colVALB+1000), 3)
    || ')', 20) || SalStrTrimX(tbl1.colNAMB) || PutCrLf() || sLev ||
    PadL('сумма ' || SalNumberToStrX(tbl1.colS, 2), 69-Len(sLev)) ||
    PutCrLf() || Perenos(tbl1.colNAZN, 65, 4)) || PutCrLf()
.head 13 -  Call SalFileWrite(hF, sBuff, Len(sBuff))
.head 13 -  Set nP = nP + 1
.head 13 -  Set nItog = nItog + tbl1.colS
.head 11 -  Set sBuff = Repl('-', 69) || PutCrLf() || StrWinToDosX('    Итого: ' ||
    PadR(Str(nP-1), 20) || 'На сумму:') || PadL(
    SalNumberToStrX(nItog, 2), 29) || PutCrLf() || Repl('-', 69) || Repl(
    PutCrLf(), 3)
.head 11 -  Call SalFileWrite(hF, sBuff, Len(sBuff))
.head 11 -  Call SalFileClose(hF)
.head 10 -  Call SalMessageBeep(-1)
.head 10 +  If dfAll > dfCurrent
.head 11 -  Call MessageNoWait('ВНИМАНИЕ ! Обработаны не ВСЕ выбранные документы. ' ||
     'Примите меры для исправления ошибок.', 'Строгое предупреждение', 0, 1)
.head 10 -  Call SalSetFocus(tbl1)
.head 10 -  Call VisTblAutoSizeColumn(tbl1, hWndNULL)
.head 10 -  ! Call SalSetWindowText(hWndForm, sText)
.head 10 -  Call SalDisableWindow(pbExecute)
.head 9 +  Else
.head 10 -  Call MessageAttention('Ошибка подсоединения к Базе данных: ' || SqlDatabase)
.head 8 +  Else
.head 9 -  Call MessageAttention('Нет файла: ' || sODBCDir || '\\' ||
     IifS(nISOS=5, '', 'M') || 'OPER' || sAn ||
     '.dbf или он занят другим пользователем.')
.head 7 +  Else
.head 8 -  Call MessageAttention('Нет каталога: ' || sODBCDir)
.head 7 -  ! Call SalEnableWindow(pbExecute)
.head 7 -  Call SalEnableWindow(pbExit)
.head 7 -  Call SalSetFocus(pbExit)
.head 7 -  Call WaitCursorOff()
.head 6 +  Else
.head 7 -  Call Debug("День закрыт !")
.head 3 +  Pushbutton: pbExit
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Выход
.head 4 -  Window Location and Size
.head 5 -  Left:   11.383"
.head 5 -  Top:    5.821"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Esc
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalEndDialog(hWndForm, FALSE)
.head 3 -  Frame
.head 4 -  Resource Id: 29213
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.083"
.head 5 -  Top:    5.738"
.head 5 -  Width:  12.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.667"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Corners: Square
.head 4 -  Border Style: Drop-Shadow
.head 4 -  Border Thickness: 1
.head 4 -  Border Color: Default
.head 4 -  Background Color: 3D Face Color
.head 3 +  Data Field: dfStart
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.583"
.head 6 -  Top:    5.762"
.head 6 -  Width:  3.8"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.167"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Fixedsys
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Periwinkle
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfEnd
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.583"
.head 6 -  Top:    6.012"
.head 6 -  Width:  3.8"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.167"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Fixedsys
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Periwinkle
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfAn
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 2
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   1.317"
.head 6 -  Top:    5.81"
.head 6 -  Width:  0.567"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.31"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Arial Cyr
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfDone
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   8.283"
.head 6 -  Top:    5.845"
.head 6 -  Width:  3.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.298"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Purple
.head 5 -  Background Color: Gray
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Custom Control: ccProgressBar
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cMeter
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   0.083"
.head 6 -  Top:    5.321"
.head 6 -  Width:  10.9"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 0.333"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Royal Blue
.head 5 -  Background Color: Gray
.head 5 -  DLL Settings
.head 4 -  Message Actions
.head 3 +  Child Table: tbl1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.05"
.head 6 -  Top:    0.405"
.head 6 -  Width:  12.733"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 4.833"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 333333
.head 5 -  Discardable? Yes
.head 4 +  Contents
.head 5 +  Column: colNPP
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Nпп
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.471"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colND
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Номер док.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.114"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVOB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вид оп.
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colMFOA
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО-А
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Right
.head 6 -  Width:  0.743"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNLSA
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Счет-А
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.529"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNAMA
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наим.А
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.714"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVALA
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вал
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  0.4"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colMFOB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО-Б
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Right
.head 6 -  Width:  0.743"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNLSB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Счет-Б
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.529"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNAMB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наим.Б
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.714"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVALB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вал
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  0.4"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colS
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Сумма
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  1.386"
.head 6 -  Width Editable? Yes
.head 6 -  Format: ###000
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVDATE
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата вал.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Left
.head 6 -  Width:  1.017"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNAZN
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Назначение пл.
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 160
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.357"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colREF98
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Референс
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.943"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colTT
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Транзакция
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.943"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 +  Window Variables
.head 5 -  Number: nFocusRow
.head 5 -  Window Handle: hWndCol
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected, FALSE)
.head 6 -  Call VisTblAutoSizeColumn(tbl1, hWndNULL)
.head 5 +  On SAM_CornerClick
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected, FALSE)
.head 5 +  On SAM_CornerDoubleClick
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected, FALSE)
.head 5 +  On SAM_DoubleClick
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected, FALSE)
.head 5 +  On SAM_RowHeaderClick
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected, FALSE)
.head 5 +  On SAM_RowHeaderDoubleClick
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected, FALSE)
.head 5 +  On SAM_EndCellTab
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected, FALSE)
.head 5 +  On WM_LbuttonUp
.head 6 -  ! Узнать текущую строку
.head 6 -  ! Call SalTblQueryFocus(tbl1, nFocusRow, hWndCol)
.head 6 -  ! Set nFocusRow = SalTblQueryContext(tbl1)
.head 6 -  ! Почистить все
.head 6 -  Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, FALSE, 0, 0)
.head 6 -  ! Call SalTblSetFocusRow (tbl1, nFocusRow)
.head 6 -  ! Стать на нее (что выше)
.head 6 -  ! Call SalTblSetRowFlags(tbl1, nFocusRow, ROW_Selected, FALSE)
.head 6 -  ! Call SalSendMsg(tbl1, SAM_RowHeaderClick, 0, Max(TBL_MaxRow, nFocusRow+1))
.head 5 +  On VTM_KeyUp
.head 6 -  Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, FALSE, 0, 0)
.head 6 -  Call VisTblAutoSizeColumn(tbl1, hWndNULL)
.head 5 +  On WM_NCMouseMove ! 160
.head 6 -  Call VisTblAutoSizeColumn(tbl1, hWndNULL)
.head 3 +  Data Field: dfOPER
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.283"
.head 6 -  Top:    5.845"
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Right
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 10
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfBD
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Date/Time
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   11.083"
.head 6 -  Top:    5.321"
.head 6 -  Width:  1.733"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.333"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Date
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 +  If dfBD > dBat
.head 7 -  Call MessageNoWait('Локальная дата не может быть больше текущей банковской даты !',
     'ОШИБКА', 30, 1)
.head 7 -  Return VALIDATE_Cancel
.head 3 +  Pushbutton: pbBD
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left:   9.783"
.head 5 -  Top:    5.321"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.333"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: F12
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If SalIsWindowEnabled(dfBD)
.head 7 -  Call SalDisableWindow(dfBD)
.head 6 +  Else
.head 7 -  Call SalEnableWindow(dfBD)
.head 7 -  Call SalSetFocus(dfBD)
.head 3 +  Check Box: cbRevPP
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Не переворачивать Плательщика и Получателя для кассовых документов
.head 4 -  Window Location and Size
.head 5 -  Left:   0.217"
.head 5 -  Top:    6.143"
.head 5 -  Width:  6.9"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 2 +  Functions
.head 3 +  Function: PROVODKA
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If nNm = 1
.head 6 -  Set sMfo = sBankMfo
.head 5 +  If sMfo = sBankMfo
.head 6 -  Set nNm = 1
.head 5 -  Set sTT = ''
.head 5 +  If nSk > 0
.head 6 -  Set sTmp = sNls
.head 6 -  Set sNls = sNlsk
.head 6 -  Set sNlsk = sTmp
.head 6 +  If NOT cbRevPP
.head 7 -  Set sTmp = sPolu
.head 7 -  Set sPolu = sPlat
.head 7 -  Set sPlat = sTmp
.head 6 +  If nDk = 1
.head 7 -  Set nDk = 0
.head 6 +  Else If nDk = 0
.head 7 -  Set nDk = 1
.head 6 -  Set nNm = nDk + 1085 ! добавлено для UPB и для всех остальных
.head 6 -  ! свежак
.head 6 +  If Len(sNLSKASSA) > 0
.head 7 -  Call SalArrayGetUpperBound(smNLSKASSA, 1, nI)
.head 7 -  Set nC = 0
.head 7 +  While nC <= nI
.head 8 +  If SalStrScan(sNlsk, smNLSKASSA[nC]) and Len(smDK0KASSA[nC]) = 3 and
   Len(smDK1KASSA[nC]) = 3
.head 9 -  Set sTT = IifS(nDk=1, smDK0KASSA[nC], smDK1KASSA[nC])
.head 9 -  Break
.head 8 -  Set nC = nC + 1
.head 5 +  Else
.head 6 -  Set nSk = NUMBER_Null
.head 6 +  If nDk = nKw
.head 7 -  Set nDk = nDk + 2
.head 5 +  If nNm = 2 and NS = 8
.head 6 -  If SqlPrepareAndExecute(hSqlAux(), "
   SELECT nls
   INTO :sNls
   FROM accounts
   WHERE tip='90D'") and SqlFetchNext(hSqlAux(), nFetchRes)
.head 5 -  Set nRef = NUMBER_Null
.head 5 -  Call VisTblSetRowColor(tbl1, nNewRow, COLOR_Blue)
.head 5 +  If (Len(sTT) = 0 and Len(sNLSKASSA) > 0) or Len(sNLSKASSA) = 0
.head 6 -  Set sTT = Right('NM' || IifS(nDk=0 and nNm=2, 'D', Str(nNm)), 3)
.head 5 +  If (sTT = '085' or sTT = '086' or
   VisArrayFindString(smDK0KASSA, sTT) >= 0 or
   VisArrayFindString(smDK1KASSA, sTT) >= 0) and nISOS != 5 and
   SqlPrepareAndExecute(hSqlAux(), T("
   SELECT vob
   INTO :nVOBtts
   FROM tts_vob
   WHERE tt=:sTT")) and SqlFetchNext(hSqlAux(), nFetchRes)
.head 6 -  Set nVob = nVOBtts
.head 6 -  Set tbl1.colVOB = nVob
.head 5 +  If sKod = '' or sKod != V_Okpo(sKod) or sKodB = '' or
   sKodB != V_Okpo(sKodB)
.head 6 -  Call SalMessageBox('Документ на сумму ' || Str(nS) ||
     ' не принят. Отсутствует(ош) ОКРО А или ОКРО Б', 'Внимание', 0)
.head 5 -  ! Modify by ANNY 18-10-2001
.head 5 +  Else
.head 6 -  Call ccDoc.SetDoc(0, sTT, nDk, nVob, sNd, dDat, dfBD, dfBD, dfBD, sNls, sPlat,
     sBankMfo, '', 980, nS, sKod, sNlsk, sPolu, sMfo, '', 980, nS, sKodB, sNaz1,
     sVspo, GetIdOper(), '', nSk, 0)
.head 6 -  Set dfAll = dfAll + 1
.head 6 +  If ccDoc.oDoc() 
.head 7 +  If SqlPrepareAndExecute(hSqlB, "
   UPDATE " || IifS(nISOS=5, '', 'm') || "oper" || sAn || "
   SET sos=9
   WHERE CURRENT OF " || IifS(nISOS=5, '', 'm') || "oper")
.head 8 -  Call SqlCommit(hSql())
.head 8 -  Set tbl1.colREF98 = ccDoc.m_nRef
.head 8 -  Set tbl1.colTT = sTT
.head 8 -  Call VisTblSetRowColor(tbl1, nNewRow, COLOR_DarkGreen)
.head 8 -  Set dfCurrent = dfCurrent + 1
.head 8 +  If n99 = 0
.head 9 -  Call SqlPrepareAndExecute(hSqlB, "
     UPDATE " || IifS(nISOS=5, '', 'm') || "oper" || sAn || "
     SET sos=9,ref99bm=:ccDoc.m_nRef
     WHERE CURRENT OF " || IifS(nISOS=5, '', 'm') || "oper")
.head 7 +  Else
.head 8 -  Call SqlRollback(hSql())
.head 6 +  Else
.head 7 -  Call SqlRollback(hSql())
.head 2 +  Window Parameters
.head 3 -  Number: nISOS
.head 2 +  Window Variables
.head 3 -  : ccDoc
.head 4 -  Class: cDoc
.head 3 -  String: ND
.head 3 -  String: NLS
.head 3 -  String: NLSK
.head 3 -  Number: KVS
.head 3 -  Number: SK
.head 3 -  Number: REF
.head 3 -  Number: ISV
.head 3 -  String: NAZN
.head 3 -  String: sTmp
.head 3 -  Number: nCount
.head 3 -  Number: NS
.head 3 -  String: sAn
.head 3 -  String: sNbw
.head 3 -  Number: nNls
.head 3 -  String: sMfo
.head 3 -  String: sMdl
.head 3 -  Number: nMfop
.head 3 -  Number: nFetchRes
.head 3 -  String: sBlk
.head 3 -  String: sFv
.head 3 -  String: sFs
.head 3 -  String: sBankDay
.head 3 -  String: sBankMfo
.head 3 -  Number: nDocs
.head 3 -  Sql Handle: hSqlA
.head 3 -  Sql Handle: hSqlB
.head 3 -  Number: nPos
.head 3 -  Number: nDelta
.head 3 -  Number: nRecCount
.head 3 -  String: strMessage
.head 3 -  Number: nNm
.head 3 -  Number: nDk
.head 3 -  Number: nMfo
.head 3 -  String: sNd
.head 3 -  Number: nVob
.head 3 -  String: sNls
.head 3 -  String: sNlsk
.head 3 -  Number: nSk
.head 3 -  Number: nS
.head 3 -  Date/Time: dDat
.head 3 -  Date/Time: dPat
.head 3 -  Date/Time: dBat
.head 3 -  String: sPlat
.head 3 -  String: sPolu
.head 3 -  String: sNaz1
.head 3 -  String: sVspo
.head 3 -  String: sKod
.head 3 -  String: sKodB
.head 3 -  String: sKisp
.head 3 -  String: sSign
.head 3 -  Long String: lsSign
.head 3 -  Number: nRow
.head 3 -  Number: nRef
.head 3 -  String: sODBCDir
.head 3 -  Date/Time: dTmp
.head 3 -  Number: nNp
.head 3 -  Number: n99
.head 3 -  Number: nSos
.head 3 -  !
.head 3 -  Number: nRef99bm
.head 3 -  Date/Time: dVdate
.head 3 -  !
.head 3 -  Number: nNewRow
.head 3 -  !
.head 3 -  Number: nTimeStart
.head 3 -  Number: nTimeCurrent
.head 3 -  Number: nTimeEnd
.head 3 -  Number: nHour
.head 3 -  Number: nMinu
.head 3 -  Number: nTemp
.head 3 -  Number: nTek
.head 3 -  Number: nRecn
.head 3 -  !
.head 3 -  Number: nCurrentRow
.head 3 -  Number: nP
.head 3 -  Number: nItog
.head 3 -  File Handle: hF
.head 3 -  Number: nColor
.head 3 -  String: sBuff
.head 3 -  String: sFr
.head 3 -  String: sTT
.head 3 -  String: sLev
.head 3 -  !
.head 3 -  String: sTp
.head 3 -  !
.head 3 -  Number: nKw
.head 3 -  !
.head 3 -  Number: nVOBtts
.head 3 -  !
.head 3 -  String: sTemp
.head 3 -  Number: n3
.head 3 -  Number: nC
.head 3 -  Number: nI
.head 3 -  String: sNLSKASSA
.head 3 -  String: smNLSKASSA[*]
.head 3 -  String: smDK0KASSA[*]
.head 3 -  String: smDK1KASSA[*]
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set cbRevPP = FALSE
.head 4 -  Call WaitCursorOn()
.head 4 -  Call ConPara('PUSH')
.head 4 -  Set dfOPER = IifS(nISOS=5, '', 'M') || 'OPER'
.head 4 -  Set sBankDay = GetBankDateEx()
.head 4 -  Set sBankMfo = GetBankMfo()
.head 4 -  Set dBat = GetBankDate()
.head 4 -  Set dfBD = dBat
.head 4 -  Call SalUseRegistry(FALSE, '')
.head 4 -  Call SalGetProfileString('Import', 'NLSKASSA', '', sNLSKASSA, GetIniFileName())
.head 4 -  Call SalArraySetUpperBound(smNLSKASSA, 1, -1)
.head 4 -  Call SalArraySetUpperBound(smDK0KASSA, 1, -1)
.head 4 -  Call SalArraySetUpperBound(smDK1KASSA, 1, -1)
.head 4 -  Set sTemp = sNLSKASSA
.head 4 +  If Len(sTemp) > 0
.head 5 -  Set n3 = 0
.head 5 -  Set nC = 0
.head 5 +  Loop
.head 6 -  Set nI = At(',', sTemp)
.head 6 +  If nI = 0
.head 7 +  If Len(sTemp) > 0
.head 8 +  If n3 = 0
.head 9 -  Set smNLSKASSA[nC] = SalStrTrimX(sTemp)
.head 9 -  Set smDK0KASSA[nC] = ''
.head 9 -  Set smDK1KASSA[nC] = ''
.head 8 +  Else If n3 = 1
.head 9 -  Set smDK0KASSA[nC] = SalStrTrimX(sTemp)
.head 9 -  Set smDK1KASSA[nC] = ''
.head 8 +  Else
.head 9 -  Set smDK1KASSA[nC] = SalStrTrimX(sTemp)
.head 7 -  Break
.head 6 +  If n3 = 0
.head 7 -  Set smNLSKASSA[nC] = SalStrTrimX(Left(sTemp, nI-1))
.head 6 +  Else If n3 = 1
.head 7 -  Set smDK0KASSA[nC] = SalStrTrimX(Left(sTemp, nI-1))
.head 6 +  Else
.head 7 -  Set smDK1KASSA[nC] = SalStrTrimX(Left(sTemp, nI-1))
.head 6 -  Set n3 = n3 + 1
.head 6 +  If n3 = 3
.head 7 -  Set nC = nC + 1
.head 7 -  Set n3 = 0
.head 6 -  Set sTemp = Right(sTemp, Len(sTemp)-nI)
.head 4 -  Call SalDisableWindow(dfBD)
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 4 -  Call SalHideWindow(dfStart)
.head 4 -  Call SalHideWindow(dfEnd)
.head 4 -  Call SalSetFocus(pbExit)
.head 3 +  On SAM_CreateComplete
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_Destroy
.head 4 -  Call ConPara('POP')
.head 4 -  Call Pl_dat(dBat)
.head 4 -  ! Disactivation of function's role, which activated for
  calling window
.head 4 +  ! If SalStrTrimX(SalStrUpperX(GetDBMS())) = 'ORACLE'
.head 5 -   Call XRoleUnset(hSql(), 'ImpOper(hWndMDI, ' || IifS(nISOS=5, '', '1') || '0)')
.head 4 -  Call WaitCursorOff()
.head 1 +  Dialog Box: dlg_ImpOperNB
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Прием документов  из 'старого' БАРСа (BARS-3.01 ОДБ-БАРС 1.98.01)
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   0.138"
.head 4 -  Top:    0.094"
.head 4 -  Width:  12.983"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 6.607"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Прием документов и оплата внебалансовых документов из 'старого' БАРСа
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? No
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 -  Background Text: Всего:
.head 4 -  Resource Id: 35607
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.083"
.head 5 -  Top:    0.095"
.head 5 -  Width:  1.317"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.226"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: 12
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfReccount
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 6
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   1.583"
.head 6 -  Top:    0.095"
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.226"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  Background Text: Выбрано:
.head 4 -  Resource Id: 35603
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   4.783"
.head 5 -  Top:    0.095"
.head 5 -  Width:  1.65"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.226"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: 12
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Blue
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfAll
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 6
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   6.583"
.head 6 -  Top:    0.095"
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.226"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  Background Text: Обработано:
.head 4 -  Resource Id: 35604
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   9.083"
.head 5 -  Top:    0.095"
.head 5 -  Width:  2.267"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.226"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: 12
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Dark Green
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfCurrent
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 6
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   11.583"
.head 6 -  Top:    0.095"
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.226"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbExecute
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Выполнить
.head 4 -  Window Location and Size
.head 5 -  Left:   2.383"
.head 5 -  Top:    5.821"
.head 5 -  Width:  1.5"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Enter
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If IsBankDayOpen()
.head 7 -  Set sAn = dfAn
.head 7 +  If MessageQuestion('Прием/Оплата ' || IifS(nISOS=5, '', 'M') || 'OPERNB ' || sAn ||
   ' ?') = IDNO
.head 8 -  Return FALSE
.head 7 -  Call WaitCursorOn()
.head 7 -  Call SalDisableWindow(pbExecute)
.head 7 -  Call SalDisableWindow(pbExit)
.head 7 -  Set dfDone = ""
.head 7 -  Call SalUseRegistry(FALSE, '')
.head 7 -  Call SalGetProfileString('Import', 'OperNBPath', SalStrLeftX(SalFileGetDrive(), 1)
     || ':\\BARS98\\ODBC.DSN\\OPER', sODBCDir, GetIniFileName())
.head 7 -  Call SaveInfoToLog('Прием документов из ' || IifS(nISOS=5, '', 'M') || 'OPERNB' ||
     sAn)
.head 7 +  If SalFileSetCurrentDirectory(sODBCDir)
.head 8 -  Set SqlDatabase = 'dBase_Files'
.head 8 +  If SalFileGetDateTime(sODBCDir || '\\' || IifS(nISOS=5, '', 'M') || 'OPERNB' ||
   sAn || '.dbf', dTmp)
.head 9 -  ! проверить, есть ли поле ref99bm в operxx если нет, то добавить его
.head 9 -  Set n99 = -1
.head 9 -  Set dfDone = "Подождите ..."
.head 9 -  Call SalLoadAppAndWait("FindVar " || sODBCDir || '\\' || IifS(nISOS=5, '', 'M')
     || 'OPERNB' || sAn || " ref99bm", Window_NotVisible, n99)
.head 9 -  Set dfDone = ""
.head 9 +  If SqlConnect(hSqlA) and SqlConnect(hSqlB)
.head 10 -  Call SqlPrepareAndExecute(hSqlA, "
     SELECT VDATE
     FROM " || IifS(nISOS=5, '', 'm') || "opernb" || sAn || "
     INTO :dTempDate")
.head 10 -  Call SqlFetchNext(hSqlA, nFetchRes)
.head 10 +  If dTempDate != dfBD
.head 11 -  Call SqlDisconnect(hSqlA)
.head 11 -  Call SqlDisconnect(hSqlB)
.head 11 -  Call MessageAttention(sODBCDir || '\\' || IifS(nISOS=5, '', 'M') || 'OPERNB'
     || sAn || '.dbf не за требуемую (текущую) дату. Выход.')
.head 11 -  Return FALSE
.head 10 -  Call SqlPrepareAndExecute(hSqlA, "
     SELECT count(*)
     FROM " || IifS(nISOS=5, '', 'm') || "opernb" || sAn || "
     INTO :nRecCount")
.head 10 -  Call SqlFetchNext(hSqlA, nFetchRes)
.head 10 -  ! Call SalGetWindowText(hWndForm, sText, 100)
.head 10 -  ! Call SalSetWindowText(hWndForm, sText || ' (' || Str(nRecCount) || ')')
.head 10 -  Call SalShowWindow(dfStart)
.head 10 -  Call SalShowWindow(dfEnd)
.head 10 -  Set nTimeStart = SalDateHour(SalDateCurrent())*3600 + SalDateMinute(
    SalDateCurrent())*60 + SalDateSecond(SalDateCurrent())
.head 10 -  Set dfStart = 'Старт: ' || SalFmtFormatDateTime(SalDateCurrent(), 'hhh:mm:ss')
.head 10 -  Set dfReccount = nRecCount
.head 10 -  Set dfCurrent = 0
.head 10 -  Set dfAll = 0
.head 10 -  Set nPos = 0
.head 10 -  Set nTek = 0
.head 10 -  Set nRecn = 1
.head 10 -  Set nDelta = 100 / nRecCount
.head 10 -  Call SqlPrepareAndExecute(hSql(), "
     SELECT fdat
     FROM fdat
     WHERE fdat=:dfBD")
.head 10 +  If not SqlFetchNext(hSql(), nFetchRes)
.head 11 -  Call SqlPrepareAndExecute(hSql(), "
     INSERT
     INTO fdat (fdat)
     VALUES (:dfBD)")
.head 10 +  If dfBD != dBat
.head 11 -  Call Pl_dat(dfBD) ! Установить банковскую дату равной dfBD (но не совсем)
.head 10 -  Call SqlSetResultSet(hSqlA, FALSE)
.head 10 -  Call SqlPrepare(hSqlA, "
     SELECT rowid,nd,nbsd,nbsk,s,nazn,kv,sos,ref99bm,vdate,vob
     INTO :nRow,:sNd,:sNls,:sNlsk,:nS,:sNaz1,:nKv,:nSos,:nRef99bm,:dVdate,
          :nVob
     FROM " || IifS(nISOS=5, '', 'm') || "opernb" || sAn || "
     FOR UPDATE OF sos")
.head 10 -  Call SqlOpen(hSqlA, IifS(nISOS=5, '', 'm') || "opernb")
.head 10 +  While SqlFetchNext(hSqlA, nFetchRes)
.head 11 +  If nKv = 0 or nKv = NUMBER_Null
.head 12 -  Set nKv = 980
.head 11 -  Set sNls = SalStrTrimX(sNls)
.head 11 -  Set sNlsk = SalStrTrimX(sNlsk)
.head 11 -  Set sNd = SalStrTrimX(StrDosToWinX(sNd))
.head 11 -  Set sNaz1 = SalStrTrimX(StrDosToWinX(sNaz1))
.head 11 -  Set sMfo = sBankMfo
.head 11 -  Set sDatP = sDatA
.head 11 -  Set nNewRow = SalTblInsertRow(tbl1, TBL_MaxRow)
.head 11 -  Call SalTblSetFocusRow(tbl1, nNewRow)
.head 11 -  Set tbl1.colNPP = nRecn
.head 11 -  Set tbl1.colND = sNd
.head 11 -  Set tbl1.colVOB = nVob
.head 11 -  Set tbl1.colMFOA = IifS(Val(sNls)=0, '', sBankMfo)
.head 11 -  Set tbl1.colNLSA = sNls
.head 11 +  If Val(sNls) = 0
.head 12 -  Set tbl1.colVALA = NUMBER_Null
.head 11 +  Else
.head 12 -  Set tbl1.colVALA = nKv
.head 11 -  Set tbl1.colNAMA = ''
.head 11 -  Set tbl1.colMFOB = IifS(Val(sNls)=0, '', sBankMfo)
.head 11 -  Set tbl1.colNLSB = sNlsk
.head 11 +  If Val(sNls) = 0
.head 12 -  Set tbl1.colVALB = NUMBER_Null
.head 11 +  Else
.head 12 -  Set tbl1.colVALB = nKv
.head 11 -  Set tbl1.colNAMB = ''
.head 11 -  Set tbl1.colS = nS/100
.head 11 -  Set tbl1.colVDATE = dVdate
.head 11 -  Set tbl1.colNAZN = sNaz1
.head 11 -  Set tbl1.colREF98 = nRef99bm
.head 11 -  Call SalTblSetRowFlags(tbl1, nNewRow, ROW_Edited | ROW_New, FALSE)
.head 11 +  If Val(sNls) = 0
.head 12 -  Call VisTblSetRowColor(tbl1, nNewRow, COLOR_Gray)
.head 11 +  If nSos = nISOS and nS > 0 and Val(sNls) > 0
.head 12 -  Set nRef = NUMBER_Null
.head 12 +  If nKv ! =GetBaseVal()
.head 13 -  If SqlPrepareAndExecute(hSqlAux2(), "
   SELECT gl.p_icurval(:nKv,:nS,:dfBD)
   INTO :nSQ FROM dual") and SqlFetchNext(hSqlAux2(), nFetchRes)
.head 12 +  Else
.head 13 -  Set nSQ = nS
.head 12 -  Call VisTblSetRowColor(tbl1, nNewRow, COLOR_Blue)
.head 12 -  Call ccDoc.SetDoc(0, 'VMO', 1, nVob, sNd, dfBD, dfBD, dfBD, dfBD, sNls,
     '', sBankMfo, '', nKv, nS, '', sNlsk, '', sBankMfo, '', nKv, nS, '',
     sNaz1, '', '', '', 0, 0)
.head 12 +  If ccDoc.oDoc()
.head 13 +  If SqlPrepareAndExecute(hSqlB, "
   UPDATE " || IifS(nISOS=5, '', 'm') || "opernb" || sAn || "
   SET sos=9
   WHERE CURRENT OF " || IifS(nISOS=5, '', 'm') || "opernb")
.head 14 -  Call SqlCommit(hSql())
.head 14 -  Set tbl1.colREF98 = ccDoc.m_nRef
.head 14 -  Set tbl1.colTT = 'VMO'
.head 14 -  Call VisTblSetRowColor(tbl1, nNewRow, COLOR_DarkGreen)
.head 14 -  Set dfCurrent = dfCurrent + 1
.head 14 +  If n99 = 0
.head 15 -  Call SqlPrepareAndExecute(hSqlB, "
     UPDATE " || IifS(nISOS=5, '', 'm') || "opernb" || sAn || "
     SET sos=9,ref99bm=:ccDoc.m_nRef
     WHERE CURRENT OF " || IifS(nISOS=5, '', 'm') || "opernb")
.head 13 +  Else
.head 14 -  Call SqlRollback(hSql())
.head 12 +  Else
.head 13 -  Call SqlRollback(hSql())
.head 12 -  Set dfAll = dfAll + 1
.head 11 -  Call SalTblSetCellTextColor(tbl1.colNPP, COLOR_Charcoal, TRUE)
.head 11 -  Set nPos = nPos + nDelta
.head 11 -  Set nRecn = nRecn + 1
.head 11 +  If Int(nPos) != nTek
.head 12 -  Set nTek = Int(nPos)
.head 12 -  Set nTimeCurrent = SalDateHour(SalDateCurrent())*3600 + SalDateMinute(
    SalDateCurrent())*60 + SalDateSecond(SalDateCurrent())
.head 12 -  Set nTimeEnd = Int(100 * (nTimeCurrent-nTimeStart) / nPos + nTimeStart)
.head 12 -  ! Call Debug('nPos=' || Str(nPos) || ', nTimeStart=' || Str(nTimeStart) ||
    ', nTimeEnd=' || Str(nTimeEnd))
.head 12 -  Set nHour = Int(nTimeEnd/3600)
.head 12 -  Set nTemp = nTimeEnd - nHour*3600
.head 12 -  Set nMinu = Int(nTemp/60)
.head 12 -  Set dfStart = dfStart
.head 12 -  Set dfEnd = 'Финиш: ' || Right(Str(100+nHour), 2) || ':' || Right(
    Str(100+nMinu), 2) || ':' || Right(Str(100+nTemp-nMinu*60), 2) ||
    ' (прогноз)'
.head 12 -  Set dfReccount = dfReccount
.head 12 -  Set dfCurrent = dfCurrent
.head 12 -  Set dfAll = dfAll
.head 11 -  Call ccProgressBar.SetProgress(nPos)
.head 11 -  Call SalUpdateWindow(hWndForm)
.head 10 -  Call ccProgressBar.SetProgress(100)
.head 10 -  Call SqlCommitEx(hSql(), 'OK')
.head 10 -  Call SqlCommit(hSqlB)
.head 10 -  Call SqlDisconnect(hSqlA)
.head 10 -  Call SqlDisconnect(hSqlB)
.head 10 -  Call SaveInfoToLog('Прием документов из ' || IifS(nISOS=5, '', 'M') ||
     'OPERNB' || sAn || ' ОКОНЧЕН')
.head 10 -  Set dfDone = "Готово"
.head 10 -  Set dfEnd = Left(dfEnd, 15)
.head 10 +  If dfCurrent > 0
.head 11 -  ! сформировать файл оплаченных документов
.head 11 -  Set nCurrentRow = TBL_MinRow
.head 11 -  Set nP = 1
.head 11 -  Set nItog = 0
.head 11 -  Set sFr = GetPrnDir() || '\\' || IifS(nISOS=5, 'O', 'M') || 'N' || Right(
    Str(SalDateMonth(dBat)+100), 2) || Right(Str(SalDateDay(dBat)+100), 2)
    || Right(Str(SalDateHour(SalDateCurrent())+100), 2) || '.' || Right(Str(
    SalDateMinute(SalDateCurrent())+100), 2)
.head 11 -  Call SalFileOpen(hF, sFr, OF_Create | OF_Write)
.head 11 -  Set sBuff = StrWinToDosX(SalStrTrimX(GetBankName()) || ' ' || SalStrTrimX(
    GetBankMfo()) || PutCrLf() || 'Дата и время формирования ' ||
    SalFmtFormatDateTime(SalDateCurrent(), 'dd/MM/yyyy ') || Right('0' ||
    SalFmtFormatDateTime(SalDateCurrent(), 'hhhh:mm:ss'), 8) || PutCrLf() ||
    PutCrLf() || Spac(15) || 'Реестр оплаченных платежных документов' ||
    PutCrLf() || Spac(15) || '(' || IifS(nISOS=5, '', 'M') ||
    'OPERNB) сеанс (с ' || Right(dfStart, 8) || ' по ') || Right(dfEnd, 8)
    || ')' || PutCrLf() || Repl('-', 69) || PutCrLf()
.head 11 -  Call SalFileWrite(hF, sBuff, Len(sBuff))
.head 11 +  While SalTblFindNextRow(tbl1, nCurrentRow, 0, 0)
.head 12 -  Call SalTblSetFocusRow(tbl1, nCurrentRow)
.head 12 -  Set nColor = SalColorGet(tbl1.colNLSA, COLOR_IndexCellText)
.head 12 +  If nColor = COLOR_DarkGreen
.head 13 -  Set sLev = tbl1.colTT || ' реф.' || Str(tbl1.colREF98) || ', док.' ||
    SalStrTrimX(tbl1.colND) || ', оп.' || Str(tbl1.colVOB)
.head 13 -  Set sBuff = PadR(Str(nP) || '.', 4) || GetBankMfo() || ' ' || IifS(
    Len(tbl1.colNAMA)=0, tbl1.colNLSA || '(' || Right(
    Str(tbl1.colVALA+1000), 3) || ')', PadR(tbl1.colNLSA || '(' ||
    Right(Str(tbl1.colVALA+1000), 3) || ')', 20) || StrWinToDosX(
    SalStrTrimX(tbl1.colNAMA))) || PutCrLf() || '    ' || IifS(
    Val(tbl1.colMFOB)=0, GetBankMfo(), tbl1.colMFOB) || ' ' ||
    IifS(Len(tbl1.colNAMB)=0, tbl1.colNLSB || '(' || Right(
    Str(tbl1.colVALB+1000), 3) || ')', PadR(tbl1.colNLSB || '(' ||
    Right(Str(tbl1.colVALB+1000), 3) || ')', 20) || StrWinToDosX(
    SalStrTrimX(tbl1.colNAMB))) || PutCrLf() || StrWinToDosX(sLev ||
    PadL('сумма ' || SalNumberToStrX(tbl1.colS, 2), 69-Len(sLev)) ||
    PutCrLf() || Perenos(tbl1.colNAZN, 65, 4)) || PutCrLf()
.head 13 -  Call SalFileWrite(hF, sBuff, Len(sBuff))
.head 13 -  Set nP = nP + 1
.head 13 -  Set nItog = nItog + tbl1.colS
.head 11 -  Set sBuff = Repl('-', 69) || PutCrLf() || StrWinToDosX('    Итого: ' ||
    PadR(Str(nP-1), 20) || 'На сумму:') || PadL(
    SalNumberToStrX(nItog, 2), 29) || PutCrLf() || Repl('-', 69) || Repl(
    PutCrLf(), 3)
.head 11 -  Call SalFileWrite(hF, sBuff, Len(sBuff))
.head 11 -  Call SalFileClose(hF)
.head 10 -  Call SalMessageBeep(-1)
.head 10 +  If dfAll > dfCurrent
.head 11 -  Call MessageNoWait('ВНИМАНИЕ ! Обработаны не ВСЕ выбранные документы. ' ||
     'Примите меры для исправления ошибок.', 'Строгое предупреждение', 0, 1)
.head 10 -  Call SalSetFocus(tbl1)
.head 10 -  Call VisTblAutoSizeColumn(tbl1, hWndNULL)
.head 10 -  ! Call SalSetWindowText(hWndForm, sText)
.head 10 -  Call SalDisableWindow(pbExecute)
.head 9 +  Else
.head 10 -  Call MessageAttention('Ошибка подсоединения к Базе данных: ' || SqlDatabase)
.head 8 +  Else
.head 9 -  Call MessageAttention('Нет файла: ' || sODBCDir || '\\' ||
     IifS(nISOS=5, '', 'M') || 'OPERNB' || sAn ||
     '.dbf или он занят другим пользователем.')
.head 7 +  Else
.head 8 -  Call MessageAttention('Нет каталога: ' || sODBCDir)
.head 7 -  ! Call SalEnableWindow(pbExecute)
.head 7 -  Call SalEnableWindow(pbExit)
.head 7 -  Call SalSetFocus(pbExit)
.head 7 -  Call WaitCursorOff()
.head 6 +  Else
.head 7 -  Call Debug("День закрыт !")
.head 3 +  Pushbutton: pbExit
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Выход
.head 4 -  Window Location and Size
.head 5 -  Left:   11.383"
.head 5 -  Top:    5.821"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Esc
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalEndDialog(hWndForm, FALSE)
.head 3 -  Frame
.head 4 -  Resource Id: 35605
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.083"
.head 5 -  Top:    5.738"
.head 5 -  Width:  12.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.512"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Corners: Square
.head 4 -  Border Style: Drop-Shadow
.head 4 -  Border Thickness: 1
.head 4 -  Border Color: Default
.head 4 -  Background Color: 3D Face Color
.head 3 +  Data Field: dfStart
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.983"
.head 6 -  Top:    5.762"
.head 6 -  Width:  3.8"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.167"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Fixedsys
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Periwinkle
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfEnd
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.983"
.head 6 -  Top:    6.012"
.head 6 -  Width:  3.8"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.167"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Fixedsys
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Periwinkle
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfAn
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 2
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   1.617"
.head 6 -  Top:    5.81"
.head 6 -  Width:  0.567"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.31"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Arial Cyr
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfDone
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   8.383"
.head 6 -  Top:    5.845"
.head 6 -  Width:  3.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.298"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Purple
.head 5 -  Background Color: Gray
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Custom Control: ccProgressBar
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cMeter
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   0.083"
.head 6 -  Top:    5.321"
.head 6 -  Width:  11.0"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 0.333"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Royal Blue
.head 5 -  Background Color: Gray
.head 5 -  DLL Settings
.head 4 -  Message Actions
.head 3 +  Child Table: tbl1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.05"
.head 6 -  Top:    0.405"
.head 6 -  Width:  12.733"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 4.833"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 333333
.head 5 -  Discardable? Yes
.head 4 +  Contents
.head 5 +  Column: colNPP
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Nпп
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.471"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colND
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Номер док.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.114"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVOB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вид оп.
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colMFOA
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО-А
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Right
.head 6 -  Width:  0.743"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNLSA
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Счет-А
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.529"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVALA
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вал
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  0.4"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNAMA
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наим.А
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.714"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colMFOB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО-Б
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Right
.head 6 -  Width:  0.743"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNLSB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Счет-Б
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.529"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVALB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вал
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  0.4"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNAMB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наим.Б
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.714"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colS
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Сумма
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  1.386"
.head 6 -  Width Editable? Yes
.head 6 -  Format: ###000
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVDATE
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата вал.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Left
.head 6 -  Width:  1.017"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNAZN
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Назначение пл.
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 160
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.357"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colREF98
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Референс
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.983"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colTT
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Транзакция
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.943"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 +  Window Variables
.head 5 -  Number: nFocusRow
.head 5 -  Window Handle: hWndCol
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected, FALSE)
.head 6 -  Call VisTblAutoSizeColumn(tbl1, hWndNULL)
.head 5 +  On SAM_CornerClick
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected, FALSE)
.head 5 +  On SAM_CornerDoubleClick
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected, FALSE)
.head 5 +  On SAM_DoubleClick
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected, FALSE)
.head 5 +  On SAM_RowHeaderClick
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected, FALSE)
.head 5 +  On SAM_RowHeaderDoubleClick
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected, FALSE)
.head 5 +  On SAM_EndCellTab
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected, FALSE)
.head 5 +  On WM_LbuttonUp
.head 6 -  ! Узнать текущую строку
.head 6 -  ! Call SalTblQueryFocus(tbl1, nFocusRow, hWndCol)
.head 6 -  ! Set nFocusRow = SalTblQueryContext(tbl1)
.head 6 -  ! Почистить все
.head 6 -  Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, FALSE, 0, 0)
.head 6 -  ! Call SalTblSetFocusRow (tbl1, nFocusRow)
.head 6 -  ! Стать на нее (что выше)
.head 6 -  ! Call SalTblSetRowFlags(tbl1, nFocusRow, ROW_Selected, FALSE)
.head 6 -  ! Call SalSendMsg(tbl1, SAM_RowHeaderClick, 0, Max(TBL_MaxRow, nFocusRow+1))
.head 5 +  On VTM_KeyUp
.head 6 -  Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, FALSE, 0, 0)
.head 6 -  Call VisTblAutoSizeColumn(tbl1, hWndNULL)
.head 5 +  On WM_NCMouseMove ! 160
.head 6 -  Call VisTblAutoSizeColumn(tbl1, hWndNULL)
.head 3 +  Data Field: dfOPERNB
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.183"
.head 6 -  Top:    5.845"
.head 6 -  Width:  1.4"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.226"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Right
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 10
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfBD
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Date/Time
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   11.083"
.head 6 -  Top:    5.321"
.head 6 -  Width:  1.7"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.333"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Date
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 +  If dfBD > dBat
.head 7 -  Call MessageNoWait('Локальная дата не может быть больше текущей банковской даты !',
     'ОШИБКА', 30, 1)
.head 7 -  Return VALIDATE_Cancel
.head 3 +  Pushbutton: pbBD
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left:   10.083"
.head 5 -  Top:    5.321"
.head 5 -  Width:  0.5"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.333"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: F12
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If SalIsWindowEnabled(dfBD)
.head 7 -  Call SalDisableWindow(dfBD)
.head 6 +  Else
.head 7 -  Call SalEnableWindow(dfBD)
.head 7 -  Call SalSetFocus(dfBD)
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Number: nISOS
.head 2 +  Window Variables
.head 3 -  : ccDoc
.head 4 -  Class: cDoc
.head 3 -  Number: nSQ
.head 3 -  String: ND
.head 3 -  String: NLS
.head 3 -  String: NLSK
.head 3 -  Number: KVS
.head 3 -  Number: SK
.head 3 -  Number: nKv
.head 3 -  Number: nKvD
.head 3 -  Number: nKvK
.head 3 -  Number: REF
.head 3 -  Number: ISV
.head 3 -  String: NAZN
.head 3 -  String: sTmp
.head 3 -  Number: nCount
.head 3 -  String: sAn
.head 3 -  String: sNbw
.head 3 -  Number: nNls
.head 3 -  String: sMfo
.head 3 -  String: sMdl
.head 3 -  Number: nMfop
.head 3 -  ! Number: nFetchRes
.head 3 -  String: sBlk
.head 3 -  String: sFv
.head 3 -  String: sFs
.head 3 -  String: sBankDay
.head 3 -  String: sBankMfo
.head 3 -  Number: nDocs
.head 3 -  Sql Handle: hSqlA
.head 3 -  Sql Handle: hSqlB
.head 3 -  Number: nPos
.head 3 -  Number: nDelta
.head 3 -  Number: nRecCount
.head 3 -  String: strMessage
.head 3 -  Number: nNm
.head 3 -  Number: nDk
.head 3 -  Number: nMfo
.head 3 -  String: sNd
.head 3 -  Number: nVob
.head 3 -  String: sNls
.head 3 -  String: sNlsk
.head 3 -  Number: nSk
.head 3 -  Number: nS
.head 3 -  Number: nS1
.head 3 -  Number: SD1
.head 3 -  Number: SK1
.head 3 -  Date/Time: dBat
.head 3 -  Date/Time: dPat
.head 3 -  String: sDatA
.head 3 -  String: sDatP
.head 3 -  String: sPlat
.head 3 -  String: sPolu
.head 3 -  String: sNaz1
.head 3 -  String: sVspo
.head 3 -  String: sKod
.head 3 -  String: sKisp
.head 3 -  ! String: sSign
.head 3 -  ! Long String: lsSign
.head 3 -  Number: nRow
.head 3 -  Number: nRef
.head 3 -  String: sODBCDir
.head 3 -  Date/Time: dTmp
.head 3 -  Number: nNd
.head 3 -  Number: n99
.head 3 -  Number: nSos
.head 3 -  !
.head 3 -  Number: nRef99bm
.head 3 -  Date/Time: dVdate
.head 3 -  !
.head 3 -  Number: nNewRow
.head 3 -  !
.head 3 -  Number: nTimeStart
.head 3 -  Number: nTimeCurrent
.head 3 -  Number: nTimeEnd
.head 3 -  Number: nHour
.head 3 -  Number: nMinu
.head 3 -  Number: nTemp
.head 3 -  Number: nTek
.head 3 -  Number: nRecn
.head 3 -  !
.head 3 -  Number: nCurrentRow
.head 3 -  Number: nP
.head 3 -  Number: nItog
.head 3 -  File Handle: hF
.head 3 -  Number: nColor
.head 3 -  String: sBuff
.head 3 -  String: sFr
.head 3 -  String: sTT
.head 3 -  String: sLev
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call WaitCursorOn()
.head 4 -  Call ConPara('PUSH')
.head 4 -  Set dfOPERNB = IifS(nISOS=5, '', 'M') || 'OPERNB'
.head 4 -  Set sDatA = SalFmtFormatDateTime(GetBankDate(), 'MM/dd/yyyy')
.head 4 -  Set dBat = GetBankDate()
.head 4 -  Set dfBD = dBat
.head 4 -  Call SalDisableWindow(dfBD)
.head 4 -  Set sBankDay = GetBankDateEx()
.head 4 -  Set sBankMfo = GetBankMfo()
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 4 -  Call SalHideWindow(dfStart)
.head 4 -  Call SalHideWindow(dfEnd)
.head 4 -  Call SalSetFocus(pbExit)
.head 3 +  On SAM_CreateComplete
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_Destroy
.head 4 -  Call ConPara('POP')
.head 4 -  Call Pl_dat(dBat)
.head 4 -  ! Disactivation of function's role, which activated for calling window
.head 4 +  ! If SalStrTrimX(SalStrUpperX(GetDBMS())) = 'ORACLE'
.head 5 -   Call XRoleUnset(hSql(), 'ImpOper(hWndMDI, ' || IifS(nISOS=5, '', '1') || '2)')
.head 4 -  Call WaitCursorOff()
.head 1 +  Dialog Box: dlg_ImpOperV
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Прием документов  из 'старого' БАРСа (BARS-3.01 ОДБ-БАРС 1.98.01)
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   0.138"
.head 4 -  Top:    0.094"
.head 4 -  Width:  12.983"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 6.607"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Прием документов и оплата "валютных" документов из 'старого' БАРСа
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? No
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 -  Background Text: Всего:
.head 4 -  Resource Id: 30472
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.083"
.head 5 -  Top:    0.095"
.head 5 -  Width:  1.317"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.226"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: 12
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfReccount
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 6
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   1.583"
.head 6 -  Top:    0.095"
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.226"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  Background Text: Выбрано:
.head 4 -  Resource Id: 30473
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   4.783"
.head 5 -  Top:    0.095"
.head 5 -  Width:  1.65"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.226"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: 12
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Blue
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfAll
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 6
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   6.583"
.head 6 -  Top:    0.095"
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.226"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  Background Text: Обработано:
.head 4 -  Resource Id: 30474
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   9.083"
.head 5 -  Top:    0.095"
.head 5 -  Width:  2.267"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.226"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Arial Cyr
.head 4 -  Font Size: 12
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Dark Green
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfCurrent
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 6
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   11.583"
.head 6 -  Top:    0.095"
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.226"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbExecute
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Выполнить
.head 4 -  Window Location and Size
.head 5 -  Left:   2.283"
.head 5 -  Top:    5.821"
.head 5 -  Width:  1.5"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Enter
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalDisableWindow(dfBD)
.head 6 +  If IsBankDayOpen()
.head 7 -  Set sAn = dfAn
.head 7 +  If MessageQuestion('Прием/Оплата ' || IifS(nISOS=5, '',   'M') || 'OPERV' || sAn ||
   ' ?') = IDNO
.head 8 -  Return FALSE
.head 7 -  Call WaitCursorOn()
.head 7 -  Call SalDisableWindow(pbExecute)
.head 7 -  Call SalDisableWindow(pbExit)
.head 7 -  Set dfDone = ""
.head 7 -  Call SalUseRegistry(FALSE, '')
.head 7 -  Call SalGetProfileString('Import', 'OperVPath', SalStrLeftX(SalFileGetDrive(), 1) ||
     ':\\BARS98\\ODBC.DSN\\OPER', sODBCDir, GetIniFileName())
.head 7 -  ! разбор параметра описания транзакций
.head 7 -  Call SalGetProfileString('Import', IifS(nISOS=5, 'O', 'Mo') || 'perVTTS', '', sTTSi,
     GetIniFileName())
.head 7 -  Call SalGetProfileString('Import', IifS(nISOS=5, 'O', 'Mo') || 'perVTTV', '', sTTSv,
     GetIniFileName())
.head 7 -  Call SalArraySetUpperBound(smNT, 1, -1)
.head 7 -  Call SalArraySetUpperBound(smNO, 1, -1)
.head 7 -  Call SalArraySetUpperBound(smTT, 1, -1)
.head 7 -  Set sTemp = ''
.head 7 +  If Len(sTTSi) > 0
.head 8 -  Set sTemp = sTTSi
.head 7 +  Else If Len(sTTSv) > 0
.head 8 -  Set sTemp = sTTSv
.head 7 +  If Len(sTemp) > 0
.head 8 -  Set n3 = 0
.head 8 -  Set nC = 0
.head 8 +  Loop
.head 9 -  Set nI = At(',', sTemp)
.head 9 +  If nI = 0
.head 10 +  If Len(sTemp) > 0
.head 11 +  If n3 = 0
.head 12 -  Set smNT[nC] = SalStrTrimX(sTemp)
.head 12 -  Set smNO[nC] = ''
.head 12 -  Set smTT[nC] = ''
.head 11 +  Else If n3 = 1
.head 12 -  Set smNO[nC] = SalStrTrimX(sTemp)
.head 12 -  Set smTT[nC] = ''
.head 12 -  ! Call Debug(Str(nC) || Str(n3) || ' '|| smNO[nC])
.head 11 +  Else
.head 12 -  Set smTT[nC] = SalStrTrimX(sTemp)
.head 12 -  ! Call Debug(Str(nC) || Str(n3) || ' '|| smTT[nC])
.head 10 -  Break
.head 9 +  If n3 = 0
.head 10 -  Set smNT[nC] = SalStrTrimX(Left(sTemp, nI-1))
.head 10 -  ! Call Debug(Str(nC) || Str(n3) || ' '|| smNT[nC])
.head 9 +  Else If n3 = 1
.head 10 -  Set smNO[nC] = SalStrTrimX(Left(sTemp, nI-1))
.head 10 -  ! Call Debug(Str(nC) || Str(n3) || ' '|| smNO[nC])
.head 9 +  Else
.head 10 -  Set smTT[nC] = SalStrTrimX(Left(sTemp, nI-1))
.head 10 -  ! Call Debug(Str(nC) || Str(n3) || ' '|| smTT[nC])
.head 9 -  Set n3 = n3 + 1
.head 9 +  If n3 = 3
.head 10 -  Set nC = nC + 1
.head 10 -  Set n3 = 0
.head 9 -  Set sTemp = Right(sTemp, Len(sTemp)-nI)
.head 7 -  Call SaveInfoToLog('Прием документов из ' || IifS(nISOS=5, '', 'M') || 'OPERV' ||
     sAn)
.head 7 +  If SalFileSetCurrentDirectory(sODBCDir)
.head 8 -  Set SqlDatabase = 'dBase_Files'
.head 8 +  If SalFileGetDateTime(sODBCDir || '\\' || IifS(nISOS=5, '', 'M') || 'OPERV' || sAn
   || '.dbf',   dTmp)
.head 9 -  ! проверить, есть ли поле ref99bm в operxx если нет, то добавить его
.head 9 -  Set n99 = -1
.head 9 -  Set dfDone = "Подождите ..."
.head 9 -  Call SalLoadAppAndWait("FindVar " || sODBCDir || '\\' || IifS(nISOS=5, '', 'M')
     || 'OPERV' || sAn || " ref99bm", Window_NotVisible, n99)
.head 9 -  Set dfDone = ""
.head 9 +  If SqlConnect(hSqlA) and SqlConnect(hSqlB)
.head 10 +  If File(sODBCDir || '\\S1S2.dbf')
.head 11 -  Call SqlPrepareAndExecute(hSqlA, "
     SELECT S2
     FROM s1s2
     INTO :nS2")
.head 11 -  Call SqlFetchNext(hSqlA, nFetchRes)
.head 11 -  ! Set bS1S2 = SalDateConstruct((nS2-Mod(nS2, 10000))/10000,
    Mod((nS2-Mod(nS2, 100))/100,100), Mod(nS2, 100), 0, 0, 0) = dBat
.head 11 -  Set bS1S2 = SalFmtFormatStrDateTime(Str(nS2), 'yyyyMMdd') = dBat
.head 10 +  Else
.head 11 -  Set bS1S2 = FALSE
.head 10 +  If bS1S2
.head 11 -  Call SqlPrepareAndExecute(hSqlA, "
     SELECT REF,S2
     FROM s1s2
     INTO :nREFO,:nS2")
.head 11 -  Call SqlFetchNext(hSqlA, nFetchRes)
.head 11 -  Set nIs2 = 0
.head 11 +  While SqlFetchNext(hSqlA, nFetchRes)
.head 12 -  Set nmREF[nIs2] = nREFO
.head 12 -  Set nmS2[nIs2] = nS2
.head 12 -  Set nIs2 = nIs2 + 1
.head 11 -  ! Call MessageNoWait('Lines=' || SalStrTrimX(Str(nIs2)),
     'S1S2 exist and Ok', 3, 0)
.head 10 -  Call SqlPrepareAndExecute(hSqlA, "
     SELECT VDATE
     FROM " || IifS(nISOS=5, '', 'm') || "operv" || sAn || "
     INTO :dTempDate")
.head 10 -  Call SqlFetchNext(hSqlA, nFetchRes)
.head 10 +  If dTempDate != dfBD
.head 11 -  Call SqlDisconnect(hSqlA)
.head 11 -  Call SqlDisconnect(hSqlB)
.head 11 -  Call MessageAttention(sODBCDir || '\\' || IifS(nISOS=5, '', 'M') || 'OPERV'
     || sAn || '.dbf не за требуемую (текущую) дату. ' || 'Выход.')
.head 11 -  Return FALSE
.head 10 -  Call SqlPrepareAndExecute(hSqlA, "
     SELECT count(*)
     FROM " || IifS(nISOS=5, '', 'm') || "operv" || sAn || "
     INTO :nRecCount")
.head 10 -  Call SqlFetchNext(hSqlA, nFetchRes)
.head 10 -  Call SalShowWindow(dfStart)
.head 10 -  Call SalShowWindow(dfEnd)
.head 10 -  Set nTimeStart = SalDateHour(SalDateCurrent())*3600 + SalDateMinute(
    SalDateCurrent())*60 + SalDateSecond(SalDateCurrent())
.head 10 -  Set dfStart = 'Старт: ' || SalFmtFormatDateTime(SalDateCurrent(), 'hhh:mm:ss')
.head 10 -  Set dfReccount = nRecCount
.head 10 -  Set dfCurrent = 0
.head 10 -  Set dfAll = 0
.head 10 -  Set nPos = 0
.head 10 -  Set nTek = 0
.head 10 -  Set nRecn = 1
.head 10 -  Set nDelta = 100 / nRecCount
.head 10 -  Call SqlPrepareAndExecute(hSql(), "
     SELECT fdat
     FROM fdat
     WHERE fdat=:dfBD")
.head 10 +  If not SqlFetchNext(hSql(), nFetchRes)
.head 11 -  Call SqlPrepareAndExecute(hSql(), "
     INSERT
     INTO fdat (fdat)
     VALUES (:dfBD)")
.head 10 +  If dfBD != dBat
.head 11 -  Call Pl_dat(dfBD) ! Установить банковскую дату равной dfBD (но не совсем)
.head 10 -  Call SqlSetResultSet(hSqlA, FALSE)
.head 10 -  Call SqlPrepare(hSqlA, "
     SELECT rowid,nd,nls,nlsk,isv,nazn,kvS,kvD,kvK,isr,sk,nlst,nlso,kod_s,
            kod_n,kod_b,ref,sos,ref99bm,vdate,vob,NP
     INTO :nRow,:nNd,:sNls,:sNlsk,:nS,:sNaz1,:nKv,:nKvD,:nKvK,:nS1,:nSk,
          :sNLST,:sNLSO,:sKod_G,:sKod_N,:sKod_B,:nRefOperv,:nSos,:nRef99bm,
          :dVdate,:nVob,:NP
     FROM " || IifS(nISOS=5, '', 'M') || "operv" || sAn || "
     FOR UPDATE OF sos")
.head 10 -  Call SqlOpen(hSqlA, IifS(nISOS=5, '', 'm') || "operv")
.head 10 +  While SqlFetchNext(hSqlA, nFetchRes)
.head 11 -  Set nKvD = IifN(nKvD=NUMBER_Null, 0, nKvD)
.head 11 -  Set nKvK = IifN(nKvK=NUMBER_Null, 0, nKvK)
.head 11 -  Set sNLST = SalStrTrimX(sNLST)
.head 11 -  Set sNLSO = SalStrTrimX(sNLSO)
.head 11 -  Set sNls = SalStrTrimX(sNls)
.head 11 -  Set sNlsk = SalStrTrimX(sNlsk)
.head 11 -  Set sNd = SalNumberToStrX(nNd, 0)
.head 11 -  Set sNaz1 = SalStrLeftX(SalStrTrimX( StrDosToWinX(sNaz1)), 160)
.head 11 -  Set sMfo = sBankMfo
.head 11 -  Set sDatP = sDatA
.head 11 -  Set nNewRow = SalTblInsertRow(tbl1, TBL_MaxRow)
.head 11 -  Call SalTblSetFocusRow(tbl1, nNewRow)
.head 11 -  Set tbl1.colNPP = nRecn
.head 11 -  Set tbl1.colND = sNd
.head 11 -  Set tbl1.colVOB = nVob
.head 11 -  Set tbl1.colMFOA = IifS(Val(sNls)=0, '', sBankMfo)
.head 11 -  Set tbl1.colNLSA = sNls
.head 11 +  If Val(sNls) = 0
.head 12 -  Set tbl1.colVALA = NUMBER_Null
.head 11 +  Else
.head 12 -  Set tbl1.colVALA = IifN(nKvD=0, 980, nKvD)
.head 11 -  Set tbl1.colNAMA = ''
.head 11 -  Set tbl1.colMFOB = IifS(Val(sNls)=0, '', sBankMfo)
.head 11 -  Set tbl1.colNLSB = sNlsk
.head 11 +  If Val(sNls) = 0
.head 12 -  Set tbl1.colVALB = NUMBER_Null
.head 11 +  Else
.head 12 -  Set tbl1.colVALB = IifN(nKvK=0, 980, nKvK)
.head 11 -  Set tbl1.colNAMB = ''
.head 11 -  Set tbl1.colS = nS / 100
.head 11 -  Set tbl1.colSE = nS1 / 100
.head 11 -  Set tbl1.colVDATE = dVdate
.head 11 -  Set tbl1.colNAZN = sNaz1
.head 11 -  Set tbl1.colREF98 = nRef99bm
.head 11 -  Call SalTblSetRowFlags(tbl1, nNewRow,  ROW_Edited | ROW_New, FALSE)
.head 11 +  If Val(sNls) = 0
.head 12 -  Call VisTblSetRowColor(tbl1, nNewRow,  COLOR_Gray)
.head 11 +  If nSos = nISOS and (nS > 0 or NP !=990 )and Val(sNls) > 0
.head 12 -  ! это ручная переоценка (NP!=990) ее принимаем,
! автоматическую (NP=990) не принимаем
.head 12 +  If nS = 0 
.head 13 +  If nKvD = 0
.head 14 -  Set nKvD = nKvK
.head 14 -  Set nKv = nKvK
.head 13 +  Else
.head 14 -  Set nKvK = nKvD
.head 14 -  Set nKv = nKvD
.head 12 -  !
.head 12 -  Set nDk = 1
.head 12 -  Set nRef = NUMBER_Null
.head 12 -  Call VisTblSetRowColor(tbl1, nNewRow, COLOR_Blue)
.head 12 +  If nKvD != nKvK ! разновалютная
.head 13 +  If nKvK = 0
.head 14 -  Set nKvK = 980
.head 14 -  Set SD1 = nS
.head 14 -  Set SK1 = nS1
.head 13 +  Else If nKvD = 0
.head 14 -  Set nDk = 0
.head 14 -  Set nKvK = 980
.head 14 -  Set nKvD = nKv
.head 14 -  Set SK1 = nS1
.head 14 -  Set SD1 = nS
.head 14 -  Set sTmp = sNls
.head 14 -  Set sNls = sNlsk
.head 14 -  Set sNlsk = sTmp
.head 13 +  Else
.head 14 +  If nKvD = nKv
.head 15 -  Set SD1 = nS
.head 15 -  Set SK1 = -1
.head 15 +  If bS1S2 and nIs2 > 0
.head 16 -  Set n12 = 0
.head 16 +  While n12 < nIs2
.head 17 +  If nmREF[n12] = nRefOperv
.head 18 -  Set SK1 = nmS2[n12]
.head 18 -  ! Call Debug('SK1=' || Str(SK1))
.head 18 -  Break
.head 17 -  Set n12 = n12 + 1
.head 15 +  If SK1 = -1
.head 16 -  Call SqlPrepareAndExecute(hSqlAux(), T("
     SELECT gl.p_Ncurval(:nKvK,:nS1,:dBat)
     INTO :SK1
     FROM dk
     WHERE dk=1"))
.head 16 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 14 +  Else
.head 15 -  Set SK1 = nS
.head 15 -  Set SD1 = -1
.head 15 +  If bS1S2 and nIs2 > 0
.head 16 -  Set n12 = 0
.head 16 +  While n12 < nIs2
.head 17 +  If nmREF[n12] = nRefOperv
.head 18 -  Set SD1 = nmS2[n12]
.head 18 -  ! Call Debug('SD1=' || Str(SD1))
.head 18 -  Break
.head 17 -  Set n12 = n12 + 1
.head 15 +  If SD1 = -1
.head 16 -  Call SqlPrepareAndExecute(hSqlAux(), T("
     SELECT gl.p_Ncurval(:nKvD,:nS1,:dBat)
     INTO :SD1
     FROM dk
     WHERE dk=1"))
.head 16 -  Call SqlFetchNext(hSqlAux(), nFetchRes)
.head 13 +  ! If sNLST = '380062' ! ТОЛЬКО ДЛЯ АЖИО
.head 14 -   Set sTT = 'VM2'
.head 13 +  ! Else If sNLST = '380091'
.head 14 -   Set sTT = 'VM3'
.head 13 +  ! Else
.head 14 -   Set sTT = 'VM1'
.head 13 -  Set sTT = 'VM1'
.head 13 +  If Len(sTTSi) > 0
.head 14 -  Call SalArrayGetUpperBound(smTT, 1, nI)
.head 14 -  Set nC = 0
.head 14 +  While nC <= nI
.head 15 +  If sNLST = smNT[nC] and
   sNLSO = smNO[nC] and
   Len(smTT[nC]) = 3
.head 16 -  Set sTT = smTT[nC]
.head 16 -  Break
.head 15 -  Set nC = nC + 1
.head 13 +  Else If Len(sTTSv) > 0
.head 14 -  Call SalArrayGetUpperBound(smTT, 1, nI)
.head 14 -  Set nC = 0
.head 14 +  While nC <= nI
.head 15 +  If ((nDk = 1 and Left(smNT[nC], 1) = '?' and Val(smNO[nC]) = 0) or
   (nDk = 0 and Val(smNT[nC]) = 0 and Left(smNO[nC], 1) = '?')) and
   Len(smTT[nC]) = 3
.head 16 -  Set sTT = smTT[nC]
.head 16 -  Break
.head 15 -  Set nC = nC + 1
.head 13 -  ! ВМЕСТО закомментареного выше в Ini-файл в секцию [IMPORT] добавлены
  параметры:
  для OPERV -  OperVTTS
  для MOPERV - MoperVTTS
  для OPERV -  OperVTTV
  для MOPERV - MoperVTTV
  ОПИСЫВАЕТСЯ СЛЕДУЮЩИМ ОБРАЗОМ:
  ------------------------------------------
OperVTTS=3800X,6204X,VM2,3800Y,6204Y,VM3...
  т.е. указываются триады через ',':
  - счет валютной позиции (3800) / NLST;
  - счет доходов/расходов (6204) / NLSO;
  - код транзакции для разновалютной проводки.
  По умолчанию устанавливается код транзакции VM1 (валюная позиция и
  доходы/расходы по TABVAL).
  ------------------------------------------
  Вторая возможность (для разделения ПОКУПКИ и ПРОДАЖИ наличной валюты
  на различные операции/транзакции):
OperVTTV=?,0,VM4,0,?,VM5
  В этом параметре ОБЯЗАТЕЛЬНО описываются ДВЕ триады !!!
  Первая триада указывает на ПОКУПКУ(операция - VM4), а вторая триада -
  на ПРОДАЖУ (операция - VM5).
  ------------------------------------------
  Следует обратить внимание на то, что приоритет имеет параметр
  {Mo,O}perVTTS при наличии обеих параметров, т.е. если в Ini-файле
  присутствуют, например, такие строки:
OperVTTS=380001,620401,VR0,380002,620402,VS0
OperVTTV=?,0,VR0,0,?,VS0
  ------------------------------------------
  При отсутствии описанных параметров для разновалютных проводок
  используется транзакция VM1. 
.head 13 +  If SqlPrepareAndExecute( hSqlAux2(), "
   SELECT decode(D.pos,0,gl.p_icurval(:nKvD,:SD1,:dfBD),:nS1),
          decode(K.pos,0,gl.p_icurval(:nKvK,:SK1,:dfBD),:nS1)
   INTO :nS1Q,:nS2Q
   FROM accounts D, accounts K
   WHERE D.kv=:nKvD and D.nls=:sNls and K.kv=:nKvK and K.nls=:sNlsk")
   and SqlFetchNext(hSqlAux2(), nFetchRes)
.head 14 -  Call ccDoc.SetDoc(0, sTT, nDk, nVob, sNd, dfBD, dfBD, dfBD, dfBD,
     sNls, '', sBankMfo, '', nKvD, SD1, '', sNlsk, '', sBankMfo, '',
     nKvK, SK1, '', sNaz1, '', '', '',nSk, 0)
.head 14 +  If ccDoc.oDoc()
.head 15 +  If SqlPrepareAndExecute(hSqlB, "
   UPDATE " || IifS(nISOS=5, '', 'm') || "operv" || sAn || "
   SET sos=9
   WHERE CURRENT OF " || IifS(nISOS=5, '', 'm') || "operv")
.head 16 -  Call SqlCommit(hSql())
.head 16 -  Set tbl1.colREF98 = ccDoc.m_nRef
.head 16 -  Set tbl1.colTT = sTT
.head 16 -  Call VisTblSetRowColor(tbl1, nNewRow, COLOR_DarkGreen)
.head 16 -  Set dfCurrent = dfCurrent + 1
.head 16 +  If n99 = 0
.head 17 -  Call SqlPrepareAndExecute(hSqlB, "
     UPDATE " || IifS(nISOS=5, '', 'm') || "operv" || sAn || "
     SET sos=9,ref99bm=:ccDoc.m_nRef
     WHERE CURRENT OF " || IifS(nISOS=5, '', 'm') || "operv")
.head 16 +  If Len(SalStrTrimX(sKod_N)) > 0
.head 17 -  Call SqlPrepareAndExecute(hSql(), "
     INSERT
     INTO operw (ref,tag,value)
     VALUES (:ccDoc.m_nRef,'KOD_N',:sKod_N)")
.head 16 +  If Len(SalStrTrimX(sKod_G)) > 0
.head 17 -  Call SqlPrepareAndExecute(hSql(), "
     INSERT
     INTO operw (ref,tag,value)
     VALUES (:ccDoc.m_nRef,'KOD_G',:sKod_G)")
.head 16 +  If Len(SalStrTrimX(sKod_B)) > 0
.head 17 -  Call SqlPrepareAndExecute(hSql(), "
     INSERT
     INTO operw (ref,tag,value)
     VALUES (:ccDoc.m_nRef,'KOD_B',:sKod_B)")
.head 16 -  Call SqlCommit(hSql())
.head 15 +  Else
.head 16 -  Call SqlRollback(hSql())
.head 14 +  Else
.head 15 -  Call SqlRollback(hSql())
.head 12 +  Else ! одновалютная
.head 13 -  Set sTT = 'VMO'
.head 13 -  ! Эквивалент берем из OPERV (ISR)
.head 13 -  Call ccDoc.SetDoc(0, sTT, 1, nVob, sNd, dfBD, dfBD, dfBD, dfBD, sNls,
     '', sBankMfo, '', nKv, nS, '', sNlsk, '', sBankMfo, '', nKv, nS,
     '', sNaz1, '', '', '', 0, 0)
.head 13 +  If ccDoc.oDoc()
.head 14 -  ! ccDoc.m_nRef
.head 14 +  If SqlPrepareAndExecute(hSqlB, "
   UPDATE " || IifS(nISOS=5, '', 'm') || "operv" || sAn || "
   SET sos=9
   WHERE CURRENT OF " || IifS(nISOS=5, '', 'm') || "operv")
.head 15 -  Call SqlCommit(hSql())
.head 15 -  Set tbl1.colREF98 = ccDoc.m_nRef
.head 15 -  Set tbl1.colTT = sTT
.head 15 -  Call VisTblSetRowColor(tbl1, nNewRow, COLOR_DarkGreen)
.head 15 -  Set dfCurrent = dfCurrent + 1
.head 15 +  If n99 = 0
.head 16 -  Call SqlPrepareAndExecute(hSqlB, "
     UPDATE " || IifS(nISOS=5, '', 'm') || "operv" || sAn || "
     SET sos=9,ref99bm=:ccDoc.m_nRef
     WHERE CURRENT OF " || IifS(nISOS=5, '', 'm') || "operv")
.head 15 +  If Len(SalStrTrimX(sKod_N)) > 0
.head 16 -  Call SqlPrepareAndExecute(hSql(), "
     INSERT
     INTO operw (ref,tag,value)
     VALUES (:ccDoc.m_nRef,'KOD_N',:sKod_N)")
.head 15 +  If Len(SalStrTrimX(sKod_G)) > 0
.head 16 -  Call SqlPrepareAndExecute(hSql(), "
     INSERT
     INTO operw (ref,tag,value)
     VALUES (:ccDoc.m_nRef,'KOD_G',:sKod_G)")
.head 15 +  If Len(SalStrTrimX(sKod_B)) > 0
.head 16 -  Call SqlPrepareAndExecute(hSql(), "
     INSERT
     INTO operw (ref,tag,value)
     VALUES (:ccDoc.m_nRef,'KOD_B',:sKod_B)")
.head 15 -  Call SqlCommit(hSql())
.head 14 +  Else
.head 15 -  Call SqlRollback(hSql())
.head 13 +  Else
.head 14 -  Call SqlRollback(hSql())
.head 12 -  Set dfAll = dfAll + 1
.head 11 -  Call SalTblSetCellTextColor(tbl1.colNPP, COLOR_Charcoal, TRUE)
.head 11 -  Set nPos = nPos + nDelta
.head 11 -  Set nRecn = nRecn + 1
.head 11 +  If Int(nPos) != nTek
.head 12 -  Set nTek = Int(nPos)
.head 12 -  Set nTimeCurrent = SalDateHour(SalDateCurrent())*3600 + SalDateMinute(
    SalDateCurrent())*60 + SalDateSecond(SalDateCurrent())
.head 12 -  Set nTimeEnd = Int(100 * (nTimeCurrent-nTimeStart) / nPos + nTimeStart)
.head 12 -  ! Call Debug('nPos=' || Str(nPos) || ', nTimeStart=' || Str(nTimeStart) ||
    ', nTimeEnd=' || Str(nTimeEnd))
.head 12 -  Set nHour = Int(nTimeEnd/3600)
.head 12 -  Set nTemp = nTimeEnd - nHour*3600
.head 12 -  Set nMinu = Int(nTemp/60)
.head 12 -  Set dfStart = dfStart
.head 12 -  Set dfEnd = 'Финиш: ' || Right(Str(100+nHour), 2) || ':' || Right(
    Str(100+nMinu), 2) || ':' || Right(Str(100+nTemp-nMinu*60), 2) ||
    ' (прогноз)'
.head 12 -  Set dfReccount = dfReccount
.head 12 -  Set dfCurrent = dfCurrent
.head 12 -  Set dfAll = dfAll
.head 11 -  Call ccProgressBar.SetProgress(nPos)
.head 11 -  Call SalUpdateWindow(hWndForm)
.head 10 -  Call ccProgressBar.SetProgress(100)
.head 10 -  Call SqlCommitEx(hSql(), 'OK')
.head 10 -  Call SqlCommit(hSqlB)
.head 10 -  Call SqlDisconnect(hSqlA)
.head 10 -  Call SqlDisconnect(hSqlB)
.head 10 -  Call SaveInfoToLog('Прием документов из ' || IifS(nISOS=5, '', 'M') || 'OPERV'
     || sAn || ' ОКОНЧЕН')
.head 10 -  Set dfDone = "Готово"
.head 10 -  Set dfEnd = Left(dfEnd, 15)
.head 10 +  If dfCurrent > 0
.head 11 -  ! сформировать файл оплаченных документов
.head 11 -  Set nCurrentRow = TBL_MinRow
.head 11 -  Set nP = 1
.head 11 -  Set nItog = 0
.head 11 -  Set sFr = GetPrnDir() || '\\' || IifS(nISOS=5, 'O', 'M') || 'V' || Right(
    Str(SalDateMonth(dBat)+100), 2) || Right(Str(SalDateDay(dBat)+100), 2)
    || Right(Str(SalDateHour(SalDateCurrent())+100), 2) || '.' || Right(Str(
    SalDateMinute(SalDateCurrent())+100), 2)
.head 11 -  Call SalFileOpen(hF, sFr, OF_Create | OF_Write)
.head 11 -  Set sBuff = StrWinToDosX(SalStrTrimX(GetBankName()) || ' ' || SalStrTrimX(
    GetBankMfo()) || PutCrLf() || 'Дата и время формирования ' ||
    SalFmtFormatDateTime(SalDateCurrent(), 'dd/MM/yyyy ') || Right('0' ||
    SalFmtFormatDateTime(SalDateCurrent(), 'hhhh:mm:ss'), 8) || PutCrLf() ||
    PutCrLf() || Spac(15) || 'Реестр оплаченных платежных документов' ||
    PutCrLf() || Spac(15) || '(' || IifS(nISOS=5, '', 'M') ||
    'OPERV) сеанс (с ' || Right(dfStart, 8) || ' по ') || Right(dfEnd, 8) ||
    ')' || PutCrLf() || Repl('-', 69) || PutCrLf()
.head 11 -  Call SalFileWrite(hF, sBuff, Len(sBuff))
.head 11 +  While SalTblFindNextRow(tbl1, nCurrentRow, 0, 0)
.head 12 -  Call SalTblSetFocusRow(tbl1, nCurrentRow)
.head 12 -  Set nColor = SalColorGet(tbl1.colNLSA, COLOR_IndexCellText)
.head 12 +  If nColor = COLOR_DarkGreen
.head 13 -  Set sLev = tbl1.colTT || ' реф.' || Str(tbl1.colREF98) || ', док.' ||
    SalStrTrimX(tbl1.colND) || ', оп.' || Str(tbl1.colVOB)
.head 13 -  Set sBuff = PadR(Str(nP) || '.', 4) || GetBankMfo() || ' ' || IifS(
    Len(tbl1.colNAMA)=0, tbl1.colNLSA || '(' || Right(
    Str(tbl1.colVALA+1000), 3) || ')', PadR(tbl1.colNLSA || '(' ||
    Right(Str(tbl1.colVALA+1000), 3) || ')', 20) || StrWinToDosX(
    SalStrTrimX(tbl1.colNAMA))) || PutCrLf() || '    ' || IifS(
    Val(tbl1.colMFOB)=0, GetBankMfo(), tbl1.colMFOB) || ' ' || IifS(
    Len(tbl1.colNAMB)=0, tbl1.colNLSB || '(' || Right(
    Str(tbl1.colVALB+1000), 3) || ')', PadR(tbl1.colNLSB || '(' ||
    Right(Str(tbl1.colVALB+1000), 3) || ')', 20) || StrWinToDosX(
    SalStrTrimX(tbl1.colNAMB))) || PutCrLf() || StrWinToDosX(sLev ||
    PadL('сумма ' || SalNumberToStrX(tbl1.colS, 2), 69-Len(sLev)) ||
    PutCrLf() || Perenos(tbl1.colNAZN, 65, 4)) || PutCrLf()
.head 13 -  Call SalFileWrite(hF, sBuff, Len(sBuff))
.head 13 -  Set nP = nP + 1
.head 13 -  Set nItog = nItog + tbl1.colS
.head 11 -  Set sBuff = Repl('-', 69) || PutCrLf() || StrWinToDosX('    Итого: ' ||
    PadR(Str(nP-1), 20) || 'На сумму:') || PadL(
    SalNumberToStrX(nItog, 2), 29) || PutCrLf() || Repl('-', 69) || Repl(
    PutCrLf(), 3)
.head 11 -  Call SalFileWrite(hF, sBuff, Len(sBuff))
.head 11 -  Call SalFileClose(hF)
.head 10 -  Call SalMessageBeep(-1)
.head 10 +  If dfAll > dfCurrent
.head 11 -  Call MessageNoWait('ВНИМАНИЕ ! Обработаны не ВСЕ выбранные документы. ' ||
     'Примите меры для исправления ошибок.', 'Строгое предупреждение', 0, 1)
.head 10 -  Call SalSetFocus(tbl1)
.head 10 -  Call VisTblAutoSizeColumn(tbl1, hWndNULL)
.head 10 -  ! Call SalSetWindowText(hWndForm, sText)
.head 10 -  Call SalDisableWindow(pbExecute)
.head 9 +  Else
.head 10 -  Call MessageAttention('Ошибка подсоединения к Базе данных: ' || SqlDatabase)
.head 8 +  Else
.head 9 -  Call MessageAttention('Нет файла: ' || sODBCDir || '\\' ||
     IifS(nISOS=5, '', 'M') || 'OPERV' || sAn ||
     '.dbf или он занят другим пользователем.')
.head 7 +  Else
.head 8 -  Call MessageAttention('Нет каталога: ' || sODBCDir)
.head 7 -  ! Call SalEnableWindow(pbExecute)
.head 7 -  Call SalEnableWindow(pbExit)
.head 7 -  Call SalSetFocus(pbExit)
.head 7 -  Call WaitCursorOff()
.head 6 +  Else
.head 7 -  Call Debug("День закрыт !")
.head 3 +  Pushbutton: pbExit
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Выход
.head 4 -  Window Location and Size
.head 5 -  Left:   11.383"
.head 5 -  Top:    5.821"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Esc
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalEndDialog(hWndForm, FALSE)
.head 3 -  Frame
.head 4 -  Resource Id: 30475
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.083"
.head 5 -  Top:    5.738"
.head 5 -  Width:  12.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.512"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Corners: Square
.head 4 -  Border Style: Drop-Shadow
.head 4 -  Border Thickness: 1
.head 4 -  Border Color: Default
.head 4 -  Background Color: 3D Face Color
.head 3 +  Data Field: dfStart
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.883"
.head 6 -  Top:    5.762"
.head 6 -  Width:  3.8"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.167"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Fixedsys
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Periwinkle
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfEnd
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.883"
.head 6 -  Top:    6.012"
.head 6 -  Width:  3.8"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.167"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Fixedsys
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Periwinkle
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfAn
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 2
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   1.517"
.head 6 -  Top:    5.81"
.head 6 -  Width:  0.567"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.31"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Arial Cyr
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfDone
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   8.283"
.head 6 -  Top:    5.845"
.head 6 -  Width:  3.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.298"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Purple
.head 5 -  Background Color: Gray
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Custom Control: ccProgressBar
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cMeter
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   0.086"
.head 6 -  Top:    5.323"
.head 6 -  Width:  10.8"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 0.333"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Royal Blue
.head 5 -  Background Color: Gray
.head 5 -  DLL Settings
.head 4 -  Message Actions
.head 3 +  Child Table: tbl1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.05"
.head 6 -  Top:    0.405"
.head 6 -  Width:  12.733"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 4.833"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 333333
.head 5 -  Discardable? Yes
.head 4 +  Contents
.head 5 +  Column: colNPP
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Nпп
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.471"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colND
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Номер док.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVOB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вид оп.
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colMFOA
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО-А
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Right
.head 6 -  Width:  0.714"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNLSA
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Счет-А
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.3"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVALA
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вал
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  0.386"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNAMA
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наим.А
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.714"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colMFOB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: МФО-Б
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Right
.head 6 -  Width:  0.714"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNLSB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Счет-Б
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.3"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVALB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Вал
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  0.386"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNAMB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Наим.Б
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.714"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colS
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Сумма
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  1.143"
.head 6 -  Width Editable? Yes
.head 6 -  Format: ###000
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colSE
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Сумма экв.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Right
.head 6 -  Width:  1.143"
.head 6 -  Width Editable? Yes
.head 6 -  Format: ###000
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVDATE
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Дата вал.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Left
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Date
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNAZN
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Назначение пл.
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: 160
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.357"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colREF98
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Референс
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colTT
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Транзакция
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.943"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 +  Window Variables
.head 5 -  Number: nFocusRow
.head 5 -  Window Handle: hWndCol
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected,
     FALSE)
.head 6 -  Call VisTblAutoSizeColumn(tbl1, hWndNULL)
.head 5 +  On SAM_CornerClick
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected,
     FALSE)
.head 5 +  On SAM_CornerDoubleClick
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected,
     FALSE)
.head 5 +  On SAM_DoubleClick
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected,
     FALSE)
.head 5 +  On SAM_RowHeaderClick
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected,
     FALSE)
.head 5 +  On SAM_RowHeaderDoubleClick
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected,
     FALSE)
.head 5 +  On SAM_EndCellTab
.head 6 -  Call SalTblSetRowFlags(tbl1, lParam, ROW_Selected,
     FALSE)
.head 5 +  On WM_LbuttonUp
.head 6 -  ! Узнать текущую строку
.head 6 -  ! Call SalTblQueryFocus(tbl1, nFocusRow, hWndCol)
.head 6 -  ! Set nFocusRow = SalTblQueryContext(tbl1)
.head 6 -  ! Почистить все
.head 6 -  Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, FALSE,
     0, 0)
.head 6 -  ! Call SalTblSetFocusRow (tbl1, nFocusRow)
.head 6 -  ! Стать на нее (что выше)
.head 6 -  ! Call SalTblSetRowFlags(tbl1, nFocusRow,
     ROW_Selected, FALSE)
.head 6 -  ! Call SalSendMsg(tbl1, SAM_RowHeaderClick, 0,
     Max(TBL_MaxRow, nFocusRow+1))
.head 5 +  On VTM_KeyUp
.head 6 -  Call SalTblSetFlagsAnyRows(tbl1, ROW_Selected, FALSE,
     0, 0)
.head 6 -  Call VisTblAutoSizeColumn(tbl1, hWndNULL)
.head 5 +  On WM_NCMouseMove ! 160
.head 6 -  Call VisTblAutoSizeColumn(tbl1, hWndNULL)
.head 3 +  Data Field: dfOPERV
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.183"
.head 6 -  Top:    5.845"
.head 6 -  Width:  1.333"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Right
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 10
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfBD
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Date/Time
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   10.986"
.head 6 -  Top:    5.323"
.head 6 -  Width:  1.8"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.333"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Date
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 +  If dfBD > dBat
.head 7 -  Call MessageNoWait('Локальная дата не может быть больше'
     || ' текущей банковской даты !', 'ОШИБКА', 30, 1)
.head 7 -  Return VALIDATE_Cancel
.head 3 +  Pushbutton: pbBD
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left:   10.386"
.head 5 -  Top:    5.323"
.head 5 -  Width:  0.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.0"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: F12
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If SalIsWindowEnabled(dfBD)
.head 7 -  Call SalDisableWindow(dfBD)
.head 6 +  Else
.head 7 -  Call SalEnableWindow(dfBD)
.head 7 -  Call SalSetFocus(dfBD)
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Number: nISOS
.head 2 +  Window Variables
.head 3 -  : ccDoc
.head 4 -  Class: cDoc
.head 3 -  Number: nS1Q
.head 3 -  Number: nS2Q
.head 3 -  String: ND
.head 3 -  String: NLS
.head 3 -  String: NLSK
.head 3 -  Number: KVS
.head 3 -  Number: SK
.head 3 -  Number: NP
.head 3 -  Number: nKv
.head 3 -  Number: nKvD
.head 3 -  Number: nKvK
.head 3 -  Number: REF
.head 3 -  Number: ISV
.head 3 -  String: NAZN
.head 3 -  String: sTmp
.head 3 -  Number: nCount
.head 3 -  String: sAn
.head 3 -  String: sNbw
.head 3 -  Number: nNls
.head 3 -  String: sMfo
.head 3 -  String: sMdl
.head 3 -  Number: nMfop
.head 3 -  Number: nFetchRes
.head 3 -  String: sBlk
.head 3 -  String: sFv
.head 3 -  String: sFs
.head 3 -  String: sBankDay
.head 3 -  String: sBankMfo
.head 3 -  Number: nDocs
.head 3 -  Sql Handle: hSqlA
.head 3 -  Sql Handle: hSqlB
.head 3 -  Number: nPos
.head 3 -  Number: nDelta
.head 3 -  Number: nRecCount
.head 3 -  String: strMessage
.head 3 -  Number: nNm
.head 3 -  Number: nDk
.head 3 -  Number: nMfo
.head 3 -  String: sNd
.head 3 -  Number: nVob
.head 3 -  String: sNls
.head 3 -  String: sNlsk
.head 3 -  String: sNLST
.head 3 -  String: sNLSO
.head 3 -  String: sTT
.head 3 -  Number: nSk
.head 3 -  Number: nS
.head 3 -  Number: nS1
.head 3 -  Number: SD1
.head 3 -  Number: SK1
.head 3 -  Date/Time: dBat
.head 3 -  Date/Time: dPat
.head 3 -  String: sDatA
.head 3 -  String: sDatP
.head 3 -  String: sPlat
.head 3 -  String: sPolu
.head 3 -  String: sNaz1
.head 3 -  String: sVspo
.head 3 -  String: sKod
.head 3 -  String: sKisp
.head 3 -  ! String: sSign
.head 3 -  ! Long String: lsSign
.head 3 -  Number: nRow
.head 3 -  Number: nRef
.head 3 -  String: sODBCDir
.head 3 -  Date/Time: dTmp
.head 3 -  Number: nNd
.head 3 -  String: sKod_B
.head 3 -  String: sKod_N
.head 3 -  String: sKod_G
.head 3 -  Number: n99
.head 3 -  Boolean: bS1S2
.head 3 -  Number: nIs2
.head 3 -  Number: nmREF[*]
.head 3 -  Number: nmS2[*]
.head 3 -  Number: n12
.head 3 -  Number: nS2
.head 3 -  Number: nREFO
.head 3 -  Number: nRefOperv
.head 3 -  Number: nSos
.head 3 -  !
.head 3 -  Number: nRef99bm
.head 3 -  Date/Time: dVdate
.head 3 -  !
.head 3 -  Number: nNewRow
.head 3 -  !
.head 3 -  Number: nTimeStart
.head 3 -  Number: nTimeCurrent
.head 3 -  Number: nTimeEnd
.head 3 -  Number: nHour
.head 3 -  Number: nMinu
.head 3 -  Number: nTemp
.head 3 -  Number: nTek
.head 3 -  Number: nRecn
.head 3 -  !
.head 3 -  Number: nCurrentRow
.head 3 -  Number: nP
.head 3 -  Number: nItog
.head 3 -  File Handle: hF
.head 3 -  Number: nColor
.head 3 -  String: sBuff
.head 3 -  String: sFr
.head 3 -  String: sLev
.head 3 -  !
.head 3 -  String: sTTSi
.head 3 -  String: sTTSv
.head 3 -  String: smNT[*]
.head 3 -  String: smNO[*]
.head 3 -  String: smTT[*]
.head 3 -  String: sTemp
.head 3 -  Number: n3
.head 3 -  Number: nC
.head 3 -  Number: nI
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call WaitCursorOn()
.head 4 -  Call ConPara('PUSH')
.head 4 -  Set dfOPERV = IifS(nISOS=5, '', 'M') || 'OPERV'
.head 4 -  Set sDatA = SalFmtFormatDateTime(GetBankDate(),
    'MM/dd/yyyy')
.head 4 -  Set dBat = GetBankDate()
.head 4 -  Set dfBD = dBat
.head 4 -  Call SalDisableWindow(dfBD)
.head 4 -  Set sBankDay = GetBankDateEx()
.head 4 -  Set sBankMfo = GetBankMfo()
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 4 -  Call SalHideWindow(dfStart)
.head 4 -  Call SalHideWindow(dfEnd)
.head 4 -  Call SalSetFocus(pbExit)
.head 3 +  On SAM_CreateComplete
.head 4 -  Call WaitCursorOff()
.head 3 +  On SAM_Destroy
.head 4 -  Call ConPara('POP')
.head 4 -  Call Pl_dat(dBat)
.head 4 -  ! Disactivation of function's role, which activated for
  calling window
.head 4 +  If SalStrTrimX(SalStrUpperX(GetDBMS())) = 'ORACLE'
.head 5 -  Call XRoleUnset(hSql(), 'ImpOper(hWndMDI, ' ||
     IifS(nISOS=5, '', '1') || '1)')
.head 4 -  Call WaitCursorOff()
