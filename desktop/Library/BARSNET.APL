.head 0 +  Application Description: Общие функции АБС БАРС
***********************************
* (C) Унити-БАРС, 1997-2004       *
*********************************** 
.head 1 -  Outline Version - 4.0.26
.head 1 +  Design-time Settings
.data VIEWINFO
0000: 6F00000003000000 FFFF01000D004347 5458566965775374 6174650400010000
0020: 0000000000C90000 002C000000030000 00030000004B0000 00C6000000F8FFFF
0040: FFE2FFFFFFFCFFFF FFFEFFFFFF720200 00C3010000010000 0000000000010000
0060: 000F4170706C6963 6174696F6E497465 6D02000000075769 6E646F77730E6672
0080: 6D5F424D5353656E 644D736700000180 0200010000000000 0000000000002C00
00A0: 0000000000000100 0000FFFFFFFFFFFF FFFFFCFFFFFFE9FF FFFF420000004200
00C0: 000024040000B102 0000000000000000 0000030000000F41 70706C6963617469
00E0: 6F6E4974656D1249 6E7465726E616C20 46756E6374696F6E 730A496E69426172
0100: 734E657400000000
.enddata
.data DT_MAKERUNDLG
0000: 0200000000001C51 3A5C424152533938 5C4C494252415259 5C4162736170692E
0020: 646C6C1C513A5C42 41525339385C4C49 42524152595C4162 736170692E617063
0040: 00000101011C513A 5C4241525339385C 4C4942524152595C 4162736170692E72
0060: 756E1C513A5C4241 525339385C4C4942 524152595C416273 6170692E646C6C1C
0080: 513A5C4241525339 385C4C4942524152 595C416273617069 2E61706300000101
00A0: 01175C4261727339 385C42696E5C6261 72736E65742E6170 64165C4261727339
00C0: 385C42696E5C4162 736170692E646C6C 165C426172733938 5C42696E5C416273
00E0: 6170692E61706300 00010101001C513A 5C4241525339385C 4C4942524152595C
0100: 4162736170692E64 6C6C1C513A5C4241 525339385C4C4942 524152595C416273
0120: 6170692E61706300 00010101
.enddata
.head 2 -  Outline Window State: Normal
.head 2 +  Outline Window Location and Size
.data VIEWINFO
0000: 6600040003002D00 0000000000000000 0000B71E5D0E0500 1D00FFFF4D61696E
0020: 0000000000000000 0000000000000000 0000003B00010000 00000000000000E9
0040: 1E800A00008600FF FF496E7465726E61 6C2046756E637469 6F6E730000000000
0060: 0000000000000000 0000000000003200 0100000000000000 0000E91E800A0000
0080: DF00FFFF56617269 61626C6573000000 0000000000000000 0000000000000000
00A0: 3000010000000000 00000000F51E100D 0000F400FFFF436C 6173736573000000
00C0: 0000000000000000 0000000000000000
.enddata
.data VIEWSIZE
0000: D000
.enddata
.head 3 -  Left:   -0.013"
.head 3 -  Top:    0.0"
.head 3 -  Width:  8.013"
.head 3 -  Height: 4.969"
.head 2 +  Options Box Location
.data VIEWINFO
0000: 0218B80BB80B2500
.enddata
.data VIEWSIZE
0000: 0800
.enddata
.head 3 -  Visible? Yes
.head 3 -  Left:   4.15"
.head 3 -  Top:    1.885"
.head 3 -  Width:  3.8"
.head 3 -  Height: 2.073"
.head 2 +  Class Editor Location
.head 3 -  Visible? No
.head 3 -  Left:   0.575"
.head 3 -  Top:    0.094"
.head 3 -  Width:  5.063"
.head 3 -  Height: 2.719"
.head 2 +  Tool Palette Location
.head 3 -  Visible? No
.head 3 -  Left:   6.388"
.head 3 -  Top:    0.729"
.head 2 -  Fully Qualified External References? Yes
.head 2 -  Reject Multiple Window Instances? No
.head 2 -  Enable Runtime Checks Of External References? Yes
.head 2 -  Use Release 4.0 Scope Rules? No
.head 1 +  Libraries
.head 2 -  Dynalib: Absapi.apd
.head 2 -  Dynalib: Global.apd
.head 2 -  Dynalib: nsiapi.apd
.head 2 -  Dynalib: Dfltrapi.apd
.head 2 -  File Include: VTCAL.APL
.head 2 -  !
.head 2 -  File Include: Constant.apl
.head 2 -  File Include: Genbutn.apl
.head 2 -  File Include: Genlbutn.apl
.head 2 -  File Include: GENLABEL.APL
.head 2 -  File Include: Genlist.apl
.head 2 -  File Include: vtmeter.apl
.head 1 +  Global Declarations
.head 2 +  Window Defaults
.head 3 +  Tool Bar
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Form Window
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Dialog Box
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Top Level Table Window
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Data Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Multiline Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Spin Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Background Text
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Pushbutton
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Radio Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Check Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Option Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Group Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Child Table Window
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  List Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Combo Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Line
.head 4 -  Line Color: Use Parent
.head 3 +  Frame
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: 3D Face Color
.head 3 +  Picture
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 2 +  Formats
.head 3 -  Number: 0'%'
.head 3 -  Number: #0
.head 3 -  Number: ###000
.head 3 -  Number: ###000;'($'###000')'
.head 3 -  Date/Time: hh:mm:ss AMPM
.head 3 -  Date/Time: M/d/yy
.head 3 -  Date/Time: MM-dd-yy
.head 3 -  Date/Time: dd-MMM-yyyy
.head 3 -  Date/Time: MMM d, yyyy
.head 3 -  Date/Time: MMM d, yyyy hh:mm AMPM
.head 3 -  Date/Time: MMMM d, yyyy hh:mm AMPM
.head 2 +  External Functions
.head 3 +  Library name: BarsNet.Dll
.head 4 +  Function: BarsNetInit
.head 5 -  Description: Инициализация сетевого интерфейса
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: INT
.head 5 +  Parameters
.head 6 -  Window Handle: HWND
.head 6 -  Number: UINT
.head 6 -  String: LPSTR
.head 6 -  String: LPSTR
.head 4 +  Function: BarsNetDown
.head 5 -  Description: Деинициализировать сетевой интерфейс
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: INT
.head 5 -  Parameters
.head 4 +  Function: BarsNetGetMsg
.head 5 -  Description: Получить принятое сообщение
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: INT
.head 5 +  Parameters
.head 6 -  Number: ULONG
.head 6 -  Receive String: LPSTR
.head 6 -  Receive Number: LPINT
.head 6 -  Receive String: LPSTR
.head 6 -  Receive String: LPSTR
.head 4 +  Function: BarsNetSendMsg
.head 5 -  Description: Послать сообщение
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: INT
.head 5 +  Parameters
.head 6 -  String: LPSTR
.head 6 -  Number: UINT
.head 6 -  String: LPSTR
.head 6 -  String: LPSTR
.head 4 +  Function: BarsNetGetParams
.head 5 -  Description: Получить параметры сетевого интерфейса
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: INT
.head 5 +  Parameters
.head 6 -  Receive Window Handle: LPHWND
.head 6 -  Receive Number: LPINT
.head 6 -  String: LPSTR
.head 4 +  Function: BarsNetGetLsnrStatus
.head 5 -  Description: Получиь статус нити слушалки
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: INT
.head 5 -  Parameters
.head 4 +  Function: BarsNetGetMainStatus
.head 5 -  Description: Получить общий статус работоспособности интерфейса
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: INT
.head 5 -  Parameters
.head 4 +  Function: BarsNetBeeper
.head 5 -  Description: Маячок
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  Number: INT
.head 5 -  Parameters
.head 4 +  Function: BarsNetGetIpAddr
.head 5 -  Description: Получить собственный IP адрес
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  String: LPSTR
.head 5 -  Parameters
.head 4 +  Function: BarsNetGetHost
.head 5 -  Description: Получить собственное имя хоста
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  String: LPSTR
.head 5 -  Parameters
.head 4 +  Function: BarsNetGetMAC
.head 5 -  Description: Получить список МАС-адресов
в виде "(0)53-0a-67-5f-34-b5 (1)..."
.head 5 -  Export Ordinal: 0
.head 5 +  Returns
.head 6 -  String: LPSTR
.head 5 -  Parameters
.head 2 +  Constants
.data CCDATA
0000: 3000000000000000 0000000000000000 00000000
.enddata
.data CCSIZE
0000: 1400
.enddata
.head 3 +  System
.head 3 +  User
.head 4 -  !
.head 4 -  ! ***** BarsNet NetCommand Code Constants *****
.head 4 -  !
.head 4 -  Number: BNTC_READMSG	= 0
.head 4 -  Number: BNTC_DAYCLOSE	= 1
.head 4 -  Number: BNTC_DAYOPEN	= 2
.head 4 -  Number: BNTC_DATECHANGE = 3
.head 4 -  Number: BNTC_APPQUIT	= 4
.head 4 -  !
.head 4 -  String: MSG_BDP_ParErrorText = 'Ошибка параметров'
.head 2 -  Resources
.head 2 +  Variables
.head 3 -  Boolean: bApdInited
.head 3 -  !
.head 3 -  Window Handle: hWin1
.head 3 -  Number: nFetchRes
.head 3 -  Boolean: fNoBroadcast		! В сети запрещены широковещательные сообщения
.head 3 -  Boolean: fInited		! Системв проинициализирована и функционирует
.head 3 -  String: strNetUser[*]		! Список работающих в сети с базой
.head 3 -  Number: nNumUsers		! Количество пользователей.
.head 3 -  !
.head 3 -  Sql Handle: hConnect		! Хэндл коннетка
.head 3 -  String: strDBMSType		! Тип субд
.head 2 +  Internal Functions
.head 3 +  Function: IniBarsNet
.head 4 -  Description: инициализация библиотеки
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: strPathToLangResources
.head 5 -  String: strLangId
.head 5 -  String: strFileName
.head 4 +  Actions
.head 5 +  If not bApdInited
.head 6 -  Set bStaticsAsWindows = TRUE
.head 6 -  Set strPathToLangResources = GetLangPath()
.head 6 -  Set strLangId = GetLang()
.head 6 -  Set strFileName = strPathToLangResources || "\\" || strLangId || "\\barsnet.lng"
.head 6 +  If (NOT strLangId) OR (NOT CurrentLangTable.InitFromFile(strFileName, strLangId))
.head 7 -  Call CurrentLangTable.Init()
.head 7 -  ! ====================================================
.head 7 -  Call CurrentLangTable.AddAtom('cTErr','Ошибка!')
.head 7 -  Call CurrentLangTable.AddAtom('cTAt','Внимание!')
.head 7 -  Call CurrentLangTable.AddAtom('cTInfo','Информация')
.head 7 -  ! ====================================================
.head 7 -  ! dlg_NetUsersList
.head 7 -  Call CurrentLangTable.AddAtom('dlg_NetUsersList.cTWndTitle','Активные пользователи')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_NetUsersList.pbSearch','Поиск')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_NetUsersList.pbReread','Перечитать')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_NetUsersList.pbSelect','Выбрать')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_NetUsersList.pbClose','Закрыть')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_NetUsersList.tblNetUsers.colLogin','Рабочее имя')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_NetUsersList.tblNetUsers.colRealName','Ф.И.О.')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_NetUsersList.tblNetUsers.colMachine','Имя сетевой~станции')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_NetUsersList.tblNetUsers.colIpAdres','IP Adres')
.head 7 -  ! ====================================================
.head 7 -  ! dlg_SendNetMessage
.head 7 -  Call CurrentLangTable.AddAtom('dlg_SendNetMessage.cTWndTitle','Послать сообщение')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_SendNetMessage.cbToAll','Всем!')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_SendNetMessage.pbSend','Отправить!')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_SendNetMessage.pbAbort','Отменить')
.head 7 -  ! bg
.head 7 -  Call CurrentLangTable.AddAtom('dlg_SendNetMessage.gboxTo','Кому:')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_SendNetMessage.bgHost','Станция:')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_SendNetMessage.bgText','Сообщение:')
.head 7 -  ! constants
.head 7 -  Call CurrentLangTable.AddAtom('dlg_SendNetMessage.cTList','Список')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_SendNetMessage.cTSend','Посылается')
.head 7 -  ! ====================================================
.head 7 -  ! dlg_ShowNetMessage
.head 7 -  Call CurrentLangTable.AddAtom('dlg_ShowNetMessage.cTWndTitle','Сообщение от')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_ShowNetMessage.pbReply','Ответить')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_ShowNetMessage.pbDone','Закрыть')
.head 7 -  ! ====================================================
.head 7 -  Call CurrentLangTable.AddAtom('XNetInit.cTErrInit','Ошибка при инициализации межстанционного интерфейса')
.head 7 -  Call CurrentLangTable.AddAtom('XNetSendMsg.cTErrSend','Ошибка при попытке послать сообщение')
.head 7 -  ! ====================================================
.head 7 -  ! frm_BMSSendMsg
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.cTWndTitle','Рассылка сообщений')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.pbSend','Отправить')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.rbToDate','Сообщение действует до')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.rbPeriod','Сообщение действует')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.rbUsers','Пользователи')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.rbGroups','Группы пользователей')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.cbAll','Отметить всех')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.tblUsers.colCheck','Выбрать')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.bgMsg','Сообщение')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.bgDatFrom','Сообщение действует с')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.bgDay','дней')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.bgHour','ч')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.bgMin','мин')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.bgReceiver','Получатель')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.bgSearch','Поиск')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.cBTipMsg','Выбрать шаблон')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.cBTipSaveMsg','Сохранить шаблон сообщения')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.cTUserName','ФИО пользователя')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.cTGroupName','Группа пользователей')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.cTMsgUncorrectValue','Неверное значение!')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.cTMsgCheckDat','Проверьте дату действия сообщения!')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.cTMsgMsgIsNull','Не заполнен текст сообщения!')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.cTMsgNotReceiver','Не выбран получатель!')
.head 7 -  Call CurrentLangTable.AddAtom('frm_BMSSendMsg.cTMsgMsgSend','Сообщение отправлено')
.head 7 -  ! ====================================================
.head 7 -  ! dlg_BMSSaveMsg
.head 7 -  Call CurrentLangTable.AddAtom('dlg_BMSSaveMsg.cTWndTitle','Сохранение сообщения')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_BMSSaveMsg.pbSave','Сохранить')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_BMSSaveMsg.bgMsgCode','Код сообщения')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_BMSSaveMsg.bgMsg','Сообщение')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_BMSSaveMsg.cTMsgMsgExists','Сообщение с таким кодом уже существует!')
.head 7 -  ! ====================================================
.head 7 -  ! dlg_BMSShowMsg
.head 7 -  Call CurrentLangTable.AddAtom('dlg_BMSShowMsg.pbCancel','Закрыть')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_BMSShowMsg.cTMsgSend','Отправлено')
.head 7 -  Call CurrentLangTable.AddAtom('dlg_BMSShowMsg.cTMsgReceive','Получено')
.head 7 -  ! ====================================================
.head 6 -  ! Call CurrentLangTable.SaveToFile('C:\\TEMP\\barsnet.lng','RUS')
.head 6 -  Set bApdInited = TRUE
.head 5 -  Return bApdInited
.head 3 +  Function: XNetInit		!__exported
.head 4 -  Description: Инициализация сетевого интерфейса
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  Window Handle: hWnd
.head 5 -  Number: nCmd
.head 5 -  String: strUser
.head 5 -  !
.head 5 -  Boolean: fNoBCast
.head 5 -  Sql Handle: hSql
.head 5 -  String: strDBMS
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nRet
.head 5 -  Number: nFetchRes
.head 5 -  Number: nCount
.head 5 -  String: strSubNetMask
.head 5 -  String: strHost
.head 5 -  String: strHostIp
.head 4 +  Actions
.head 5 -  Call IniBarsNet()
.head 5 -  Set fNoBroadcast = fNoBCast
.head 5 -  Set nNumUsers    = 0
.head 5 -  Set hConnect     = hSql
.head 5 -  Set strDBMSType  = SalStrUpperX(SalStrTrimX(strDBMS))
.head 5 -  !
.head 5 -  Set strSubNetMask = '255.255.255.0'
.head 5 +  If SqlPrepareAndExecute( hSql, "SELECT val INTO :strSubNetMask FROM params WHERE par='SUBNET'" )
.head 6 -  Call SqlFetchNext( hSql, nFetchRes )
.head 6 +  If strSubNetMask = STRING_Null
.head 7 -  Set strSubNetMask = '255.255.255.0'
.head 5 -  !
.head 5 -  Set nRet = BarsNetInit( hWnd, nCmd, strUser, strSubNetMask )
.head 5 +  If nRet
.head 6 -  ! Call SalMessageBox("Ошибка при инициализации межстанционного интерфейса " ||
"(" || SalNumberToStrX( nRet, 0 ) || ")", "BarsNet: Ошибка!", MB_Ok )
.head 6 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('XNetInit.cTErrInit') || " (" || SalNumberToStrX(nRet, 0) || ")",
     "BarsNet: " || CurrentLangTable.GetAtomTitle('cTErr'), MB_Ok )
.head 5 +  Else
.head 6 -  Set strHost   = SalStrUpperX( XNetGetHostName(  ))
.head 6 -  Set strHostIp = XNetGetIpAdress(  )
.head 6 -  !
.head 6 +  If strHostIp
.head 7 -  Set nCount = 0
.head 7 +  If SqlPrepareAndExecute( hSql, "SELECT count(*) INTO :nCount FROM host_ip_adres WHERE UPPER(hostname)=:strHost" )
.head 8 -  Call SqlFetchNext( hSql, nFetchRes )
.head 8 +  If nCount = NUMBER_Null
.head 9 -  Set nCount = 0
.head 7 +  If nCount
.head 8 -  Call SqlPrepareAndExecute( hSql, "UPDATE host_ip_adres SET ip=:strHostIp WHERE UPPER(hostname)=:strHost" )
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute( hSql, "INSERT INTO host_ip_adres (hostname, ip) VALUES (:strHost, :strHostIp)" )
.head 7 -  Call SqlCommit( hSql )
.head 6 -  !
.head 6 -  Set fInited = TRUE
.head 5 -  Return nRet
.head 3 +  Function: XNetDown		!__exported
.head 4 -  Description: Деинициализировать сетевой интерфейс
.head 4 +  Returns
.head 5 -  Number:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If fInited
.head 6 -  Set fInited = FALSE
.head 6 -  Return BarsNetDown(  )
.head 5 +  Else
.head 6 -  Return -1
.head 3 +  Function: XNetGetMsg		!__exported
.head 4 -  Description: Получить принятое сообщение
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  Number: hMsg
.head 5 -  Receive String: strMsg
.head 5 -  Receive Number: nCmd
.head 5 -  Receive String: strUser
.head 5 -  Receive String: strHost
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: strM
.head 5 -  Number: nC
.head 5 -  String: strU
.head 5 -  String: strH
.head 5 -  !
.head 5 -  Number: nRet
.head 4 +  Actions
.head 5 +  If NOT fInited
.head 6 -  Return -1
.head 5 -  Set strM = SalStrRepeatX(' ', 512)
.head 5 -  Set strU = SalStrRepeatX(' ', 30)
.head 5 -  Set strH = SalStrRepeatX(' ', 128)
.head 5 -  Set nC = 0
.head 5 -  Set nRet = BarsNetGetMsg( hMsg, strM, nC, strU, strH )
.head 5 +  If NOT nRet
.head 6 -  Set strMsg = strM
.head 6 -  Set strUser = strU
.head 6 -  Set strHost = strH
.head 6 -  Set nCmd = nC
.head 5 -  Return nRet
.head 3 -  !
.head 3 +  Function: XNetSendMsg		!__exported
.head 4 -  Description: Послать сообщение
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  String: strMsg
.head 5 -  Number: nCmd
.head 5 -  String: strUser
.head 5 -  String: strHost
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nRet
.head 5 -  Number: nFetchRes
.head 5 -  Number: nIterator
.head 5 -  Long String: strIp
.head 4 +  Actions
.head 5 +  If NOT fInited
.head 6 -  Return -1
.head 5 -  Set nRet = 0
.head 5 +  If SalStrTrimX( strHost ) = '*' AND fNoBroadcast
.head 6 -  Call XNetGetNetUserList(  )
.head 6 +  If nNumUsers
.head 7 -  Set nIterator = 0
.head 7 +  While nIterator < nNumUsers AND nRet = 0
.head 8 -  Set nRet = BarsNetSendMsg( strMsg, nCmd, strUser, strNetUser[nIterator] )
.head 8 -  Set nIterator = nIterator + 1
.head 5 +  Else
.head 6 +  If SalStrScan( strHost, '.' ) = -1 AND strDBMSType = 'ORACLE'
.head 7 -  Call SalWaitCursor( TRUE )
.head 7 -  Call SqlSetLongBindDatatype( 2, 22 )
.head 7 +  If SqlPrepareAndExecute( hConnect, 'SELECT gethostipadress( :strHost ) INTO :strIp FROM dual' )
.head 8 +  If SqlFetchNext( hConnect, nFetchRes ) AND strIp
.head 9 -  Set strHost = strIp
.head 7 -  Call SalWaitCursor( FALSE )
.head 6 -  Set nRet = BarsNetSendMsg(strMsg, nCmd, strUser, strHost)
.head 5 +  If nRet
.head 6 -  ! Ошибка при попытке послать сообщение (nRet)
.head 6 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('XNetSendMsg.cTErrSend') || " (" || SalNumberToStrX( nRet, 0 ) || ")",
     "BarsNet: " || CurrentLangTable.GetAtomTitle('cTErr'), MB_Ok)
.head 5 -  Return nRet
.head 3 +  Function: XNetSendBroadcastMsg	!__exported
.head 4 -  Description: Послать широковещательное сообщение
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  String: strText
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Return XNetSendMsg( strText, BNTC_READMSG, '*', '*' )
.head 3 +  Function: XNetSendDayOpenMsg	!__exported
.head 4 -  Description: Послать широковещательное сообщение
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  String: strText
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Return XNetSendMsg( strText, BNTC_DAYOPEN, '*', '*' )
.head 3 +  Function: XNetSendDayCloseMsg	!__exported
.head 4 -  Description: Послать широковещательное сообщение
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  String: strText
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Return XNetSendMsg( strText, BNTC_DAYCLOSE, '*', '*' )
.head 3 +  Function: XNetSendDateChangeMsg	!__exported
.head 4 -  Description: Послать широковещательное сообщение
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  String: strText
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Return XNetSendMsg( strText, BNTC_DATECHANGE, '*', '*' )
.head 3 +  Function: XNetSendEjectMsg	!__exported
.head 4 -  Description: Послать широковещательное сообщение
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  String: strText
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Return XNetSendMsg( strText, BNTC_APPQUIT, '*', '*' )
.head 3 -  !
.head 3 +  Function: XNetGetParams		!__exported
.head 4 -  Description: Получить параметры сетевого интерфейса
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  Receive Window Handle: hWnd
.head 5 -  Receive Number: nCmd
.head 5 -  Receive String: strUser
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Window Handle: hW
.head 5 -  Number: nC
.head 5 -  String: strU
.head 5 -  !
.head 5 -  Number: nRet
.head 4 +  Actions
.head 5 +  If NOT fInited
.head 6 -  Return -1
.head 5 -  Set hW = hWndNULL
.head 5 -  Set nC = 0
.head 5 -  Set strU = SalStrRepeatX(' ', 30)
.head 5 -  Set nRet = BarsNetGetParams( hW, nC, strU )
.head 5 +  If nRet = 0
.head 6 -  Set hWnd = hW
.head 6 -  Set nCmd = nC
.head 6 -  Set strUser = strU
.head 5 -  Return nRet
.head 3 +  Function: XNetGetLsnrStatus	!__exported
.head 4 -  Description: Получиь статус нити слушалки
.head 4 +  Returns
.head 5 -  Number:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Return BarsNetGetLsnrStatus( )
.head 3 +  Function: XNetGetMainStatus	!__exported
.head 4 -  Description: Получить общий статус работоспособности интерфейса
.head 4 +  Returns
.head 5 -  Number:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Return BarsNetGetMainStatus(  )
.head 3 -  !
.head 3 +  Function: XNetDispatchMessage	!__exported
.head 4 -  Description: Обработать сообщение
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  Number: MsgHandle
.head 5 -  Window Handle: hWndParent
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: strFromUser
.head 5 -  String: strFromHost
.head 5 -  String: strMessage
.head 5 -  Number: nCommand
.head 4 +  Actions
.head 5 +  If NOT fInited
.head 6 -  Return -1
.head 5 +  If XNetGetMsg(MsgHandle, strMessage, nCommand, strFromUser, strFromHost) = 0
.head 6 +  If nCommand = 9999
.head 7 -  Call BarsNetBeeper()
.head 6 +  Else
.head 7 -  Return SalModalDialog(dlg_ShowNetMessage, hWndParent, strMessage,
                      nCommand, strFromUser, strFromHost)
.head 5 +  Else
.head 6 -  Return FALSE
.head 3 +  Function: XNetDispatchMessageEx	!__exported
.head 4 -  Description: Обработать сообщение из параметров
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  Window Handle: hWndParent
.head 5 -  String: strFromUser
.head 5 -  String: strFromHost
.head 5 -  String: strMessage
.head 5 -  Number: nCommand
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Return SalModalDialog(dlg_ShowNetMessage, hWndParent, strMessage, nCommand, strFromUser, strFromHost)
.head 3 -  !
.head 3 +  Function: XNetEditMessage	!__exported
.head 4 -  Description: Составить и послать сообщение
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Window Handle: hWndParent
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If NOT fInited
.head 6 -  Return -1
.head 5 -  Return SalModalDialog( dlg_SendNetMessage, hWndParent, '', '' )
.head 3 +  Function: XNetEditMessageTo	!__exported
.head 4 -  Description: Составить и послать сообщение
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Window Handle: hWndParent
.head 5 -  String: strUser
.head 5 -  String: strHost
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If NOT fInited
.head 6 -  Return -1
.head 5 -  Return SalModalDialog( dlg_SendNetMessage, hWndParent, strUser, strHost )
.head 3 -  !
.head 3 +  Function: XNetGetNetUserList	!__exported
.head 4 -  Description: Сформировать список сетевых пользователей
работающих с БД
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Long String: strIp
.head 5 -  String: strMachine
.head 5 -  Number: nFetchRes
.head 4 +  Actions
.head 5 +  If NOT hConnect
.head 6 -  Return FALSE
.head 5 +  If strDBMSType = 'ORACLE'
.head 6 -  Call SalWaitCursor( TRUE )
.head 6 -  Call SqlSetLongBindDatatype( 2, 22 )
.head 6 +  If SqlPrepareAndExecute(hConnect,
'SELECT DISTINCT terminal, gethostipadress(terminal) INTO :strMachine, :strIp FROM v_active_users')
.head 7 -  Set nNumUsers = 0
.head 7 +  While SqlFetchNext( hConnect, nFetchRes )
.head 8 -  Set nNumUsers = nNumUsers + 1
.head 8 +  If strIp
.head 9 -  Set strNetUser[nNumUsers-1] = strIp
.head 8 +  Else
.head 9 -  Set strNetUser[nNumUsers-1] = strMachine
.head 6 -  Call SalWaitCursor( FALSE )
.head 5 -  Return TRUE
.head 3 +  Function: XNetGetIpAdress	!__exported
.head 4 -  Description: Получить свой IP адрес
.head 4 +  Returns
.head 5 -  String:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Return BarsNetGetIpAddr( )
.head 3 +  Function: XNetGetHostName	!__exported
.head 4 -  Description: Получить имя собственного хоста
.head 4 +  Returns
.head 5 -  String:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: strTerminal
.head 5 -  Number: nRet
.head 4 +  Actions
.head 5 -  ! Return BarsNetGetHost(  )
.head 5 -  Set strTerminal = ''
.head 5 +  If SqlPrepareAndExecute( hConnect, "SELECT userenv('TERMINAL') INTO :strTerminal FROM dual")
.head 6 -  Call SqlFetchNext( hConnect, nRet )
.head 5 -  Return strTerminal
.head 3 +  Function: XNetGetMACList	!__exported
.head 4 -  Description: Получить список МАС адресов
.head 4 +  Returns
.head 5 -  String:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Return BarsNetGetMAC(  )
.head 3 -  !
.head 3 +  Function: BMS_AddRecipient 	!__exported
.head 4 -  Description: добавляет получателя сообщения во временную таблицу tmp_msg_uids
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Number: nUserId
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If not SqlPLSQLCommand(hSql(), "bms.add_recipient(nUserId)")
.head 6 -  Call SqlRollbackEx(hSql(), "BMS. Ошибка добавления получателя id=" || Str(nUserId))
.head 6 -  Return FALSE
.head 5 -  ! commit не нужен, т.к. добавление в tmp-таблицу
.head 5 -  Call SaveInfoToLog("BMS. Добавлен получатель id=" || Str(nUserId))
.head 5 -  Return TRUE
.head 3 +  Function: BMS_EnqueueMsg 	!__exported
.head 4 -  Description: процедура для помещения сообщения в очередь
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  ! тело сообщения
.head 5 -  String: sMsg
.head 5 -  ! кол-во секунд, после которых сообщение становится доступным для прочтения
.head 5 -  Number: nDelay
.head 5 -  ! длительность в секундах доступности сообщения
.head 5 -  Number: nExpiration
.head 5 -  ! id пользователя получателя сообщения / null (список получателей составляется из таблицы tmp_msg_uids)
.head 5 -  Number: nRecipientId
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If not SqlPLSQLCommand(hSql(), "bms.enqueue_msg(sMsg, nDelay, nExpiration, nRecipientId)")
.head 6 -  Call SqlRollbackEx(hSql(), "BMS_EnqueueMsg. Ошибка отправки сообщения")
.head 6 -  Return FALSE
.head 5 +  Else
.head 6 -  Call SqlCommitEx(hSql(), "BMS_EnqueueMsg. Отправлено сообщение: " || sMsg)
.head 6 -  Return TRUE
.head 3 +  Function: BMS_DequeueMsg 	!__exported
.head 4 -  Description: получение сообщения из очереди
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Receive String: sRetMsg
.head 5 -  Receive Number: nRetId
.head 5 -  Receive Date/Time: nRetDat
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  ! сообщение
.head 5 -  String: sMsg
.head 5 -  ! id пользователя - отправителя сообщения
.head 5 -  Number: nSenderId
.head 5 -  ! время рассылки сообщения
.head 5 -  Date/Time: dSendTime
.head 5 -  ! !
.head 5 -  String: strErrorText
.head 5 -  Number: nErrorNum
.head 5 -  Number: nPos
.head 5 -  Sql Handle: hSqlError
.head 4 +  Actions
.head 5 -  Set sRetMsg = STRING_Null
.head 5 -  Set nRetId  = NUMBER_Null
.head 5 +  If not SqlPLSQLCommand(hSql(), "bms.dequeue_msg(sMsg, nSenderId, dSendTime)")
.head 6 -  ! Call SqlRollback(hSql())
.head 6 -  Return FALSE
.head 5 +  Else
.head 6 +  If sMsg = STRING_Null
.head 7 -  ! Call SqlRollback(hSql())
.head 7 -  Return FALSE
.head 6 -  ! Call SaveInfoToLog("BMS_DequeueMsg. Получено сообщение от пользователя " || Str(nSenderId) || ": " || sMsg)
.head 6 -  Set sRetMsg = sMsg
.head 6 -  Set nRetId  = nSenderId
.head 6 -  Set nRetDat = dSendTime
.head 5 -  Return TRUE
.head 3 +  Function: BMS_ShowMsg		!__exported
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Window Handle: hWndParent
.head 5 -  String: strMessage
.head 5 -  Number: nSenderId
.head 5 -  Date/Time: dSendTime
.head 5 -  String: strUser
.head 5 -  String: strHost
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Return SalModalDialog(dlg_BMSShowMsg, hWndParent, strMessage, nSenderId, dSendTime, strUser, strHost)
.head 5 -  Return TRUE
.head 3 +  Function: BMS_Func		!__exported
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Window Handle: hWndParent
.head 5 -  Number: nMode
.head 5 -  Number: nPar
.head 5 -  String: strPar01
.head 5 -  String: strPar02
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call IniBarsNet()
.head 5 +  Select Case nMode
.head 6 +  Case 1  ! Отправка сообщение
.head 7 +  If not IsWindow(hWin1)
.head 8 -  Set hWin1 = SalCreateWindow(frm_BMSSendMsg, hWndParent)
.head 7 +  Else
.head 8 -  Call SalBringWindowToTop(hWin1)
.head 7 -  Break
.head 6 +  Default
.head 7 -  Break
.head 2 -  Named Menus
.head 2 +  Class Definitions
.head 2 +  Default Classes
.head 3 -  MDI Window: cBaseMDI
.head 3 -  Form Window:
.head 3 -  Dialog Box:
.head 3 -  Table Window:
.head 3 -  Quest Window:
.head 3 -  Data Field:
.head 3 -  Spin Field:
.head 3 -  Multiline Field:
.head 3 -  Pushbutton: cPushButtonLabeled
.head 3 -  Radio Button:
.head 3 -  Option Button:
.head 3 -  Check Box: cCheckBoxLabeled
.head 3 -  Child Table:
.head 3 -  Quest Child Window: cQuickDatabase
.head 3 -  List Box:
.head 3 -  Combo Box: cGenComboBox_StrId
.head 3 -  Picture:
.head 3 -  Vertical Scroll Bar:
.head 3 -  Horizontal Scroll Bar:
.head 3 -  Column:
.head 3 -  Background Text:
.head 3 -  Group Box:
.head 3 -  Line:
.head 3 -  Frame:
.head 3 -  Custom Control:
.head 2 -  Application Actions
.head 1 +  Dialog Box: dlg_ShowNetMessage
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: System Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  5.957"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.042"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Multiline Field: mlMessage
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 512
.head 5 -  String Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Border? Yes
.head 5 -  Word Wrap? Yes
.head 5 -  Vertical Scroll? Yes
.head 5 -  Window Location and Size
.head 6 -  Left:   0.057"
.head 6 -  Top:    0.042"
.head 6 -  Width:  5.743"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 2.156"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbReply
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: &Ответить
.head 4 -  Window Location and Size
.head 5 -  Left:   3.043"
.head 5 -  Top:    2.323"
.head 5 -  Width:  1.3"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.292"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: F9
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalModalDialog( dlg_SendNetMessage, hWndForm, strUser, strHost )
.head 6 -  Call SalPostMsg( pbDone, SAM_Click, 0, 0 )
.head 3 +  Pushbutton: pbDone
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: &Закрыть
.head 4 -  Window Location and Size
.head 5 -  Left:   4.471"
.head 5 -  Top:    2.323"
.head 5 -  Width:  1.3"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.292"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Enter
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 +  If nCommand
.head 7 -  Call SalTimerSet( hWndItem, 9000, 12000 )
.head 5 +  On SAM_Click
.head 6 -  Call SalEndDialog( hWndForm, nCommand )
.head 5 +  On SAM_Timer
.head 6 -  Call SalTimerKill( hWndItem, 9000 )
.head 6 -  Call SalPostMsg( hWndItem, SAM_Click, 0, 0 )
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: strMessage
.head 3 -  Number: nCommand
.head 3 -  String: strUser
.head 3 -  String: strHost
.head 2 -  Window Variables
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call IniBarsNet()
.head 4 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  ! Call SalSetWindowText( hWndForm, "BarsNet: Сообщение от " || strUser || "@" || strHost  )
.head 4 -  Call SalSetWindowText(hWndForm, "BarsNet: " || CurrentLangTable.GetAtomTitle('dlg_ShowNetMessage.cTWndTitle') ||" " || strUser || "@" || strHost)
.head 4 -  Call PrepareWindow(hWndForm)
.head 4 -  Call SalBringWindowToTop(hWndForm)
.head 4 +  If nCommand
.head 5 -  Call SalDisableWindow(pbReply)
.head 5 -  Call SalSetFocus(pbDone)
.head 4 +  Else
.head 5 -  Call SalSetFocus(pbReply)
.head 4 -  Set mlMessage = SalFmtFormatDateTime(SalDateCurrent(), 'dd/MM/yyyy hhh:mm:ss') ||
    SalNumberToChar(13) || SalNumberToChar(10) || strMessage
.head 3 +  On SAM_CreateComplete
.head 4 -  Call SalMessageBeep(MB_IconAsterisk)
.head 4 -  Call SalWaitCursor(FALSE)
.head 1 +  Dialog Box: dlg_SendNetMessage
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: BarsNet: Послать сообщение
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  6.3"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.45"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? No
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Picture: pic1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.05"
.head 5 -  Top:    0.1"
.head 5 -  Width:  6.1"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.8"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  File Name:
.head 4 -  Storage: External
.head 4 -  Picture Transparent Color: None
.head 4 -  Fit: Scale
.head 4 -  Scaling
.head 5 -  Width:  100
.head 5 -  Height:  100
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Tile To Parent? No
.head 4 -  Border Color: 3D Shadow Color
.head 4 -  Background Color: 3D Face Color
.head 4 -  Message Actions
.head 3 -  Background Text: Кому:
.head 4 -  Resource Id: 5063
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.2"
.head 5 -  Top:    0.05"
.head 5 -  Width:  0.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: gboxTo
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cLabelControl
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Class Default
.head 5 -  Data Type: Class Default
.head 5 -  Editable? Class Default
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Justify: Class Default
.head 5 -  Format: Class Default
.head 5 -  Country: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Input Mask: Class Default
.head 4 -  Message Actions
.head 3 +  Check Box: cbToAll
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cCheckBoxLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Всем!
.head 4 -  Window Location and Size
.head 5 -  Left:   0.2"
.head 5 -  Top:    0.25"
.head 5 -  Width:  1.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If MyValue
.head 7 -  Set strBakTo = dfTo
.head 7 -  Set strBakHost = dfHost
.head 7 -  Set dfTo = "*"
.head 7 -  Set dfHost = "*"
.head 7 -  Call SalDisableWindow( dfTo )
.head 7 -  Call SalDisableWindow( dfHost )
.head 7 -  Call SalDisableWindow( pbGetUserHost )
.head 6 +  Else
.head 7 -  Set dfTo = strBakTo
.head 7 -  Set dfHost = strBakHost
.head 7 -  Call SalEnableWindow( dfTo )
.head 7 -  Call SalEnableWindow( dfHost )
.head 7 -  Call SalEnableWindow( pbGetUserHost )
.head 3 +  Data Field: dfTo
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 30
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   1.3"
.head 6 -  Top:    0.25"
.head 6 -  Width:  4.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_AnyEdit
.head 6 +  If NOT SalIsWindowEnabled( dfHost )
.head 7 -  Call SalEnableWindow( dfHost )
.head 3 -  Background Text: Станция:
.head 4 -  Resource Id: 5064
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.2"
.head 5 -  Top:    0.6"
.head 5 -  Width:  1.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: bgHost
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cLabelControl
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Class Default
.head 5 -  Data Type: Class Default
.head 5 -  Editable? Class Default
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Justify: Class Default
.head 5 -  Format: Class Default
.head 5 -  Country: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Input Mask: Class Default
.head 4 -  Message Actions
.head 3 +  Data Field: dfHost
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 128
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   1.3"
.head 6 -  Top:    0.55"
.head 6 -  Width:  4.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbGetUserHost
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: &?
.head 4 -  Window Location and Size
.head 5 -  Left:   5.4"
.head 5 -  Top:    0.25"
.head 5 -  Width:  0.543"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.292"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If strDBMSType = 'ORACLE'
.head 7 +  If SalModalDialog(dlg_NetUsersList, hWndForm, strSelected, nSelected)
.head 8 +  If nSelected != 0
.head 9 +  If nSelected = 1
.head 10 -  Set dfTo = strSelected[0,0]
.head 10 -  Set dfHost = strSelected[0,1]
.head 10 -  Set strX = strSelected[0,2]
.head 9 +  Else
.head 10 -  ! <Список>
.head 10 -  Set dfTo = '<'||CurrentLangTable.GetAtomTitle('dlg_SendNetMessage.cTList')||'>'
.head 10 -  ! <Список>
.head 10 -  Set dfHost = '<'||CurrentLangTable.GetAtomTitle('dlg_SendNetMessage.cTList')||'>'
.head 6 +  Else
.head 7 -  Call SalMessageBeep( MB_IconAsterisk )
.head 7 -  Call SalMessageBox( 'Не реализовано для Informix!', 'Under construction!', MB_Ok | MB_IconAsterisk )
.head 3 -  !
.head 3 -  Background Text: Сообщение:
.head 4 -  Resource Id: 5065
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.05"
.head 5 -  Top:    0.95"
.head 5 -  Width:  2.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: Default
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: bgText
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cLabelControl
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Class Default
.head 5 -  Data Type: Class Default
.head 5 -  Editable? Class Default
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Justify: Class Default
.head 5 -  Format: Class Default
.head 5 -  Country: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Input Mask: Class Default
.head 4 -  Message Actions
.head 3 +  Multiline Field: mlText
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 440
.head 5 -  String Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Border? Yes
.head 5 -  Word Wrap? Yes
.head 5 -  Vertical Scroll? Yes
.head 5 -  Window Location and Size
.head 6 -  Left:   0.05"
.head 6 -  Top:    1.15"
.head 6 -  Width:  6.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 1.4"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 4 -  Message Actions
.head 3 -  !
.head 3 +  Picture: pic2
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.05"
.head 5 -  Top:    2.6"
.head 5 -  Width:  6.1"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  File Name:
.head 4 -  Storage: External
.head 4 -  Picture Transparent Color: None
.head 4 -  Fit: Scale
.head 4 -  Scaling
.head 5 -  Width:  100
.head 5 -  Height:  100
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Tile To Parent? No
.head 4 -  Border Color: 3D Shadow Color
.head 4 -  Background Color: 3D Face Color
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbSend
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: &Отправить!
.head 4 -  Window Location and Size
.head 5 -  Left:   3.1"
.head 5 -  Top:    2.7"
.head 5 -  Width:  1.4"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.292"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Enter
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalWaitCursor(TRUE)
.head 6 -  Set strUser = dfTo
.head 6 -  Set strHost = dfHost
.head 6 -  Set strText = mlText
.head 6 -  !
.head 6 -  ! <Список>
.head 6 +  If dfTo = '<'||CurrentLangTable.GetAtomTitle('dlg_SendNetMessage.cTList')||'>'
.head 7 -  Call SalGetWindowSize( hWndForm, nX, nY )
.head 7 -  Call SalSetWindowSize( hWndForm, nX, nY + 0.7 )
.head 7 -  Call SalStatusSetVisible( hWndForm, TRUE )
.head 7 -  Set nIterator = 0
.head 7 +  While nIterator < nSelected
.head 8 -  ! Посылается strSelected[nIterator,0] @strSelected[nIterator,1] (strSelected[nIterator, 2])
.head 8 -  Call SalStatusSetText( hWndForm, CurrentLangTable.GetAtomTitle('dlg_SendNetMessage.cTSend')||' ' || strSelected[nIterator,0] || '@' || strSelected[nIterator,1]  || '(' || strSelected[nIterator, 2] || ')')
.head 8 +  If strSelected[nIterator, 2]
.head 9 -  Set strX = strSelected[nIterator, 2]
.head 8 +  Else
.head 9 -  Set strX = strSelected[nIterator, 1]
.head 8 -  Call XNetSendMsg(strText, 0, strSelected[nIterator,0], strX)
.head 8 -  Set nIterator = nIterator + 1
.head 8 -  Call VisWinSetMeter(cSendMeter, nIterator*100/(nSelected-1))
.head 6 +  Else
.head 7 +  If NOT strX
.head 8 -  Set strX = strHost
.head 7 -  Call XNetSendMsg(strText, 0, strUser, strX)
.head 6 -  Call SalWaitCursor(FALSE)
.head 6 -  Call SalEndDialog(hWndForm, 1)
.head 3 +  Pushbutton: pbAbort
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: О&тменить
.head 4 -  Window Location and Size
.head 5 -  Left:   4.6"
.head 5 -  Top:    2.7"
.head 5 -  Width:  1.4"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.292"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Esc
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalEndDialog(hWndForm, 0)
.head 3 +  Custom Control: cSendMeter
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cMeter
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   0.017"
.head 6 -  Top:    3.5"
.head 6 -  Width:  6.217"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: 3D Shadow Color
.head 5 -  Background Color: System Window Color
.head 5 -  DLL Settings
.head 4 -  Message Actions
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: strToUser
.head 3 -  String: strToHost
.head 2 +  Window Variables
.head 3 -  String: strBakTo
.head 3 -  String: strBakHost
.head 3 -  !
.head 3 -  String: strSelected[*,3]
.head 3 -  Number: nSelected
.head 3 -  Number: nIterator
.head 3 -  !
.head 3 -  ! To avoid values lost
.head 3 -  String: strUser
.head 3 -  String: strHost
.head 3 -  String: strText
.head 3 -  String: strX
.head 3 -  !
.head 3 -  ! Windows location variables
.head 3 -  Number: nX
.head 3 -  Number: nY
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call IniBarsNet()
.head 4 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  Call SalSetWindowText(hWndForm, 'BarsNet: ' || CurrentLangTable.GetAtomTitle('dlg_SendNetMessage.cTWndTitle'))
.head 4 -  Call PrepareWindow(hWndForm)
.head 4 +  If strToUser OR strToHost
.head 5 -  Call SalDisableWindow(cbToAll)
.head 5 -  Call SalDisableWindow(dfTo)
.head 5 -  Call SalDisableWindow(dfHost)
.head 5 -  Call SalDisableWindow(pbGetUserHost)
.head 5 -  Set dfTo = strToUser
.head 5 -  Set dfHost = strToHost
.head 3 +  On SAM_CreateComplete
.head 4 -  Call SalWaitCursor(FALSE)
.head 1 +  Dialog Box: dlg_NetUsersList
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Активные пользователи
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  7.743"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.292"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? No
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description: Список пользователей, работающих с БД
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Child Table: tblNetUsers
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.043"
.head 6 -  Top:    0.042"
.head 6 -  Width:  7.571"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 2.521"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 500
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: colLogin
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Рабочее имя
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.571"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colRealName
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Ф.И.О.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  3.329"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colMachine
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Имя сетевой
станции
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.957"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Uppercase
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colIpAdres
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: IP Adres
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Long String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 +  Window Variables
.head 5 -  Number: nSortOrder
.head 5 -  Number: nBkSlashPos
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 6 -  Call SalTblSetTableFlags( hWndItem, TBL_Flag_SelectableCols, TRUE )
.head 5 +  On SAM_ColumnSelectClick
.head 6 -  Call SalTblSetColumnFlags( SalNumberToWindowHandle(wParam), COL_Selected, FALSE )
.head 6 -  Set nSortOrder = not nSortOrder
.head 6 -  Call SalTblSortRows(hWndItem, SalTblQueryColumnID(SalNumberToWindowHandle(wParam)), nSortOrder)
.head 5 +  On SAM_DoubleClick
.head 6 -  Call SalSendMsg( pbSelect, SAM_Click, 0, 0 )
.head 5 +  On SAM_ContextMenu
.head 6 -  Call TblFindString( hWndItem, 1 )
.head 5 +  On SAM_FetchRowDone
.head 6 -  Set nBkSlashPos = SalStrScan( colMachine, '\\\\' )
.head 6 +  If nBkSlashPos >= 0	! Обрезаем GROUPNAME или DOMAIN
.head 7 -  Set colMachine = SalStrRightX( colMachine, SalStrLength( colMachine ) - (nBkSlashPos+1) )
.head 3 +  Pushbutton: pbSearch
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: &Поиск
.head 4 -  Window Location and Size
.head 5 -  Left:   0.05"
.head 5 -  Top:    2.631"
.head 5 -  Width:  1.333"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call TblFindString( tblNetUsers, 1 )
.head 3 +  Pushbutton: pbReread
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Пе&речитать
.head 4 -  Window Location and Size
.head 5 -  Left:   1.433"
.head 5 -  Top:    2.631"
.head 5 -  Width:  1.333"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalWaitCursor( TRUE )
.head 6 -  Call SalSendMsg( hWndForm, SAM_User, 0, 0 )
.head 6 -  Call SalWaitCursor( FALSE )
.head 3 +  Pushbutton: pbSelect
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: &Выбрать
.head 4 -  Window Location and Size
.head 5 -  Left:   4.717"
.head 5 -  Top:    2.625"
.head 5 -  Width:  1.333"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.292"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Enter
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set nRow = TBL_MinRow
.head 6 -  Set nSelected = 0
.head 6 +  While SalTblFindNextRow( tblNetUsers, nRow, ROW_Selected, 0 )
.head 7 -  Call SalTblSetContext( tblNetUsers, nRow )
.head 7 -  Set strUsers[nSelected,0] = tblNetUsers.colLogin
.head 7 -  Set strUsers[nSelected,1] = tblNetUsers.colMachine
.head 7 -  Set strUsers[nSelected,2] = tblNetUsers.colIpAdres
.head 7 -  Set nSelected = nSelected + 1
.head 6 -  Call SalEndDialog( hWndForm, 1 )
.head 3 +  Pushbutton: pbClose
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: &Закрыть
.head 4 -  Window Location and Size
.head 5 -  Left:   6.143"
.head 5 -  Top:    2.625"
.head 5 -  Width:  1.333"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.292"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Esc
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set nSelected = 0
.head 6 -  Call SalEndDialog( hWndForm, 0 )
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  Receive String: strUsers[*,3]
.head 3 -  Receive Number: nSelected
.head 2 +  Window Variables
.head 3 -  Number: nRow
.head 3 -  !
.head 3 -  Number: nPX
.head 3 -  Number: nPY
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call IniBarsNet()
.head 4 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  Call SalSetWindowText(hWndForm, CurrentLangTable.GetAtomTitle('dlg_NetUsersList.cTWndTitle'))
.head 4 -  Call PrepareWindow(hWndForm)
.head 4 -  Call SalGetWindowLoc(SalParentWindow( hWndForm ), nPX, nPY)
.head 4 -  Call SalSetWindowLoc(hWndForm, nPX-0.5, nPY+0.84)
.head 4 -  Call SalSendMsg(hWndForm, SAM_User, 0, 0)
.head 3 +  On SAM_User
.head 4 -  Call SqlSetLongBindDatatype(4, 22)
.head 4 -  Call SalTblPopulate(tblNetUsers, hConnect,
"SELECT DISTINCT username, terminal, fio, gethostipadress(terminal) ip
 INTO :tblNetUsers.colLogin, :tblNetUsers.colMachine, :tblNetUsers.colRealName, :tblNetUsers.colIpAdres
 FROM v_active_users ", TBL_FillAll)
.head 3 +  On SAM_CreateComplete
.head 4 -  Call SalWaitCursor(FALSE)
.head 1 -  !
.head 1 +  Form Window: frm_BMSSendMsg
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Рассылка сообщений
.head 2 -  Icon File:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Yes
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? Yes
.head 3 -  Minimizable? Yes
.head 3 -  System Menu? Yes
.head 3 -  Resizable? Yes
.head 3 -  Window Location and Size
.head 4 -  Left:   3.488"
.head 4 -  Top:    3.354"
.head 4 -  Width:  13.467"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 5.964"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Picture: picMsg
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.1"
.head 5 -  Top:    0.1"
.head 5 -  Width:  5.25"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 4.45"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  File Name:
.head 4 -  Storage: External
.head 4 -  Picture Transparent Color: None
.head 4 -  Fit: Scale
.head 4 -  Scaling
.head 5 -  Width:  100
.head 5 -  Height:  100
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Tile To Parent? No
.head 4 -  Border Color: 3D Shadow Color
.head 4 -  Background Color: 3D Face Color
.head 4 -  Message Actions
.head 3 -  Background Text: Сообщение
.head 4 -  Resource Id: 5066
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.2"
.head 5 -  Top:    0.05"
.head 5 -  Width:  2.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: bgMsg
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cLabelControl
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Class Default
.head 5 -  Data Type: Class Default
.head 5 -  Editable? Class Default
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Justify: Class Default
.head 5 -  Format: Class Default
.head 5 -  Country: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Input Mask: Class Default
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbMsg
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: ctb_pbFilter
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.2"
.head 5 -  Top:    0.3"
.head 5 -  Width:  Class Default
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\HELP.BMP
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  ! Выбрать шаблон
.head 6 -  Set strTip = CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cBTipMsg')
.head 5 +  On SAM_Click
.head 6 +  If FunNSIGet('bms_msg', 'msg', sPK, sSem)
.head 7 -  Set mlMsg = sSem
.head 3 +  Pushbutton: pbSaveMsg
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: ctb_pbUpdate
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.7"
.head 5 -  Top:    0.3"
.head 5 -  Width:  Class Default
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  ! Сохранить шаблон сообщения
.head 6 -  Set strTip = CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cBTipSaveMsg')
.head 5 +  On SAM_Click
.head 6 -  Call SalModalDialog(dlg_BMSSaveMsg, hWndForm, mlMsg)
.head 3 +  Multiline Field: mlMsg
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 254
.head 5 -  String Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Border? Yes
.head 5 -  Word Wrap? Yes
.head 5 -  Vertical Scroll? Yes
.head 5 -  Window Location and Size
.head 6 -  Left:   0.2"
.head 6 -  Top:    0.7"
.head 6 -  Width:  5.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 1.6"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 4 -  Message Actions
.head 3 -  Line
.head 4 -  Resource Id: 5067
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Coordinates
.head 5 -  Begin X:  0.1"
.head 5 -  Begin Y:  2.4"
.head 5 -  End X:  5.3"
.head 5 -  End Y:  2.4"
.head 4 -  Visible? Yes
.head 4 -  Line Style: Etched
.head 4 -  Line Thickness: 1
.head 4 -  Line Color: 3D Shadow Color
.head 3 -  Background Text: Сообщение действует с
.head 4 -  Resource Id: 5068
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.2"
.head 5 -  Top:    2.5"
.head 5 -  Width:  3.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: bgDatFrom
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cLabelControl
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Class Default
.head 5 -  Data Type: Class Default
.head 5 -  Editable? Class Default
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Justify: Class Default
.head 5 -  Format: Class Default
.head 5 -  Country: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Input Mask: Class Default
.head 4 -  Message Actions
.head 3 +  Custom Control: cDatFrom
.data INHERITPROPS
0000: 0100
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 646172001B000100 0000000100010000 0200000001000001
0020: 0101000000000000 00000000
.enddata
.data CLASSPROPSSIZE
0000: 2C00
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cCalendar
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   0.2"
.head 6 -  Top:    3.05"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? No
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  DLL Settings
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call GetMonthArray(strMonth)
.head 6 -  Call GetWeekDayArray(strWeekDays)
.head 6 -  Call cDatFrom.SetMonthText(strMonth)
.head 6 -  Call cDatFrom.SetWeekDayText(strWeekDays)
.head 5 +  On SAM_Click
.head 6 -  Call cDatFrom.GetFocusDate(dfDatFrom)
.head 6 -  Call SalHideWindow(cDatFrom)
.head 6 -  Call SalShowWindow(rbToDate)
.head 6 -  Call SalShowWindow(rbPeriod)
.head 6 -  Call SalShowWindow(dfDatTo)
.head 6 -  Call SalShowWindow(pbDatTo)
.head 6 -  Call SalShowWindow(dfHourTo)
.head 6 -  Call SalShowWindow(dfDay)
.head 6 -  Call SalShowWindow(dfHour)
.head 6 -  Call SalShowWindowAndLabel(bgDay)
.head 6 -  Call SalShowWindowAndLabel(bgHour)
.head 6 +  If rbToDate
.head 7 -  Call SetDatePeriod()
.head 6 +  Else
.head 7 -  Call SetDateFrom()
.head 3 +  Data Field: dfDatFrom
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Date/Time
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.2"
.head 6 -  Top:    2.8"
.head 6 -  Width:  1.4"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Date
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 +  If rbToDate
.head 7 +  If not SetDatePeriod()
.head 8 -  Return VALIDATE_Cancel
.head 6 +  Else
.head 7 +  If not SetDateFrom()
.head 8 -  Return VALIDATE_Cancel
.head 6 -  Return VALIDATE_Ok
.head 3 +  Pushbutton: pbDatFrom
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left:   1.6"
.head 5 -  Top:    2.8"
.head 5 -  Width:  0.4"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\PUTD.bmp
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  ! Прячем лишнее, чтоб ненароком не нажать
.head 6 -  Call SalHideWindow(rbToDate)
.head 6 -  Call SalHideWindow(rbPeriod)
.head 6 -  Call SalHideWindow(cDatTo)
.head 6 -  Call SalHideWindow(dfDatTo)
.head 6 -  Call SalHideWindow(pbDatTo)
.head 6 -  Call SalHideWindow(dfHourTo)
.head 6 -  Call SalHideWindow(dfDay)
.head 6 -  Call SalHideWindow(dfHour)
.head 6 -  Call SalHideWindowAndLabel(bgDay)
.head 6 -  Call SalHideWindowAndLabel(bgHour)
.head 6 -  Call SalShowWindow(cDatFrom)
.head 6 -  Call cDatFrom.SetFocusDate(dfDatFrom)
.head 3 +  Data Field: dfHourFrom
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 2
.head 5 -  Data Type: Number
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   2.2"
.head 6 -  Top:    2.8"
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 +  If SalIsNull(dfHourFrom)
.head 7 -  Set dfHourFrom = SalDateHour(dSysDate)
.head 6 +  If dfHourFrom < 0 or dfHourFrom > 24
.head 7 -  ! Неверное значение!
.head 7 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 7 -  Return VALIDATE_Cancel
.head 6 +  If dfDatFrom = dCurrDate and dfHourFrom < SalDateHour(dSysDate)
.head 7 -  ! Неверное значение!
.head 7 -  ! Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 7 -  ! Return VALIDATE_Cancel
.head 7 -  Set dfHourFrom = SalDateHour(dSysDate)
.head 7 -  Set dfMinFrom  = PadL('00' || Str(SalDateMinute(dSysDate)), 2)
.head 6 +  If rbToDate
.head 7 -  Call SetDatePeriod()
.head 6 +  Else
.head 7 -  Call SetDateFrom()
.head 6 -  Return VALIDATE_Ok
.head 3 -  Background Text: :
.head 4 -  Resource Id: 5069
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   3.3"
.head 5 -  Top:    2.85"
.head 5 -  Width:  0.3"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Center
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfMinFrom
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 2
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.7"
.head 6 -  Top:    2.8"
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 +  If SalIsNull(dfMinFrom)
.head 7 -  Set dfMinFrom = PadL('00' || Str(SalDateMinute(dSysDate)), 2)
.head 6 +  If not SalIsValidNumber(dfMinFrom)
.head 7 -  ! Неверное значение!
.head 7 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 7 -  Return VALIDATE_Cancel
.head 6 +  If Val(dfMinFrom) < 0 or Val(dfMinFrom) >= 60
.head 7 -  ! Неверное значение!
.head 7 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 7 -  Return VALIDATE_Cancel
.head 6 +  If dfHourFrom = 24 and  Val(dfMinFrom) > 0
.head 7 -  ! Неверное значение!
.head 7 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 7 -  Return VALIDATE_Cancel
.head 6 +  If dfDatFrom = dCurrDate and dfHourFrom = SalDateHour(dSysDate)
and Val(dfMinFrom) < SalDateMinute(dSysDate)
.head 7 -  ! Неверное значение!
.head 7 -  ! Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 7 -  ! Return VALIDATE_Cancel
.head 7 -  Set dfMinFrom = PadL('00' || Str(SalDateMinute(dSysDate)), 2)
.head 6 -  Set dfMinFrom = PadL('00' || dfMinFrom, 2)
.head 6 +  If rbToDate
.head 7 -  Call SetDatePeriod()
.head 6 +  Else
.head 7 -  Call SetDateFrom()
.head 6 -  Return VALIDATE_Ok
.head 3 -  Line
.head 4 -  Resource Id: 5070
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Coordinates
.head 5 -  Begin X:  0.1"
.head 5 -  Begin Y:  3.2"
.head 5 -  End X:  5.3"
.head 5 -  End Y:  3.2"
.head 4 -  Visible? Yes
.head 4 -  Line Style: Etched
.head 4 -  Line Thickness: 1
.head 4 -  Line Color: 3D Shadow Color
.head 3 +  Radio Button: rbToDate
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cRadioButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Сообщение действует до
.head 4 -  Window Location and Size
.head 5 -  Left:   0.2"
.head 5 -  Top:    3.3"
.head 5 -  Width:  4.133"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalEnableWindow(dfDatTo)
.head 6 -  Call SalEnableWindow(pbDatTo)
.head 6 -  Call SalEnableWindow(dfHourTo)
.head 6 -  Call SalEnableWindow(dfMinTo)
.head 6 -  Call SalDisableWindow(dfDay)
.head 6 -  Call SalDisableWindow(dfHour)
.head 6 -  Call SalDisableWindow(dfMin)
.head 3 +  Radio Button: rbPeriod
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cRadioButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Сообщение действует
.head 4 -  Window Location and Size
.head 5 -  Left:   0.2"
.head 5 -  Top:    3.9"
.head 5 -  Width:  3.0"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalDisableWindow(dfDatTo)
.head 6 -  Call SalDisableWindow(pbDatTo)
.head 6 -  Call SalDisableWindow(dfHourTo)
.head 6 -  Call SalDisableWindow(dfMinTo)
.head 6 -  Call SalEnableWindow(dfDay)
.head 6 -  Call SalEnableWindow(dfHour)
.head 6 -  Call SalEnableWindow(dfMin)
.head 3 +  Custom Control: cDatTo
.data INHERITPROPS
0000: 0100
.enddata
.data CLASSPROPS
0000: 56543A43616C656E 646172001B000100 0000000100010000 0200000001000001
0020: 0101000000000000 00000000
.enddata
.data CLASSPROPSSIZE
0000: 2C00
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cCalendar
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:   0.2"
.head 6 -  Top:    3.85"
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? No
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  DLL Settings
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call GetMonthArray(strMonth)
.head 6 -  Call GetWeekDayArray(strWeekDays)
.head 6 -  Call cDatFrom.SetMonthText(strMonth)
.head 6 -  Call cDatFrom.SetWeekDayText(strWeekDays)
.head 5 +  On SAM_Click
.head 6 -  Call cDatTo.GetFocusDate(dfDatTo)
.head 6 -  Call SalHideWindow(cDatTo)
.head 6 -  Call SalShowWindow(rbPeriod)
.head 6 -  Call SalShowWindow(dfDay)
.head 6 -  Call SalShowWindow(dfHour)
.head 6 -  Call SalShowWindowAndLabel(bgDay)
.head 6 -  Call SalShowWindowAndLabel(bgHour)
.head 6 -  Call SetDatePeriod()
.head 3 +  Data Field: dfDatTo
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Date/Time
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.2"
.head 6 -  Top:    3.6"
.head 6 -  Width:  1.4"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Date
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 +  If not SetDatePeriod()
.head 7 -  Return VALIDATE_Cancel
.head 6 -  Return VALIDATE_Ok
.head 3 +  Pushbutton: pbDatTo
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left:   1.617"
.head 5 -  Top:    3.6"
.head 5 -  Width:  0.4"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\PUTD.bmp
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  ! Прячем лишнее, чтоб ненароком не нажать
.head 6 -  Call SalHideWindow(rbPeriod)
.head 6 -  Call SalHideWindow(dfDay)
.head 6 -  Call SalHideWindow(dfHour)
.head 6 -  Call SalHideWindowAndLabel(bgDay)
.head 6 -  Call SalHideWindowAndLabel(bgHour)
.head 6 -  Call SalShowWindow(cDatTo)
.head 6 -  Call cDatTo.SetFocusDate(dfDatTo)
.head 3 +  Data Field: dfHourTo
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 2
.head 5 -  Data Type: Number
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   2.2"
.head 6 -  Top:    3.6"
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 +  If SalIsNull(dfHourTo)
.head 7 -  Set dfHourTo = SalDateHour(dSysDate)
.head 6 +  If dfHourTo < 0 or dfHourTo > 24
.head 7 -  ! Неверное значение!
.head 7 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 7 -  Return VALIDATE_Cancel
.head 6 +  If dfDatTo = dCurrDate and dfHourTo < SalDateHour(dSysDate)
.head 7 -  ! Неверное значение!
.head 7 -  ! Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 7 -  ! Return VALIDATE_Cancel
.head 7 -  Set dfHourTo = SalDateHour(dSysDate)
.head 7 -  Set dfMinTo  = PadL('00' || Str(SalDateMinute(dSysDate)), 2)
.head 6 -  Call SetDatePeriod()
.head 6 -  Return VALIDATE_Ok
.head 3 -  Background Text: :
.head 4 -  Resource Id: 5071
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   3.3"
.head 5 -  Top:    3.65"
.head 5 -  Width:  0.3"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Center
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfMinTo
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 2
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.7"
.head 6 -  Top:    3.6"
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 +  If SalIsNull(dfMinTo)
.head 7 -  Set dfMinTo = PadL('00' || Str(SalDateMinute(dSysDate)), 2)
.head 6 +  If not SalIsValidNumber(dfMinTo)
.head 7 -  ! Неверное значение!
.head 7 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 7 -  Return VALIDATE_Cancel
.head 6 +  If dfHourTo = 24 and  Val(dfMinTo) > 0
.head 7 -  ! Неверное значение!
.head 7 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 7 -  Return VALIDATE_Cancel
.head 6 +  If Val(dfMinTo) < 0 or Val(dfMinTo) >= 60
.head 7 -  ! Неверное значение!
.head 7 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 7 -  Return VALIDATE_Cancel
.head 6 +  If dfDatTo = dCurrDate and dfHourTo = SalDateHour(dSysDate) 
and Val(dfMinTo) < SalDateMinute(dSysDate)
.head 7 -  ! Неверное значение!
.head 7 -  ! Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 7 -  ! Return VALIDATE_Cancel
.head 7 -  Set dfMinTo = PadL('00' || Str(SalDateMinute(dSysDate)), 2)
.head 6 -  Set dfMinTo = PadL('00' || dfMinTo, 2)
.head 6 -  Call SetDatePeriod()
.head 6 -  Return VALIDATE_Ok
.head 3 +  Data Field: dfDay
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 3
.head 5 -  Data Type: Number
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   0.2"
.head 6 -  Top:    4.2"
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  Call SetDateFrom()
.head 6 -  Return VALIDATE_Ok
.head 3 -  Background Text: дней
.head 4 -  Resource Id: 5072
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   1.3"
.head 5 -  Top:    4.25"
.head 5 -  Width:  0.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: bgDay
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cLabelControl
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Class Default
.head 5 -  Data Type: Class Default
.head 5 -  Editable? Class Default
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Justify: Class Default
.head 5 -  Format: Class Default
.head 5 -  Country: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Input Mask: Class Default
.head 4 -  Message Actions
.head 3 +  Data Field: dfHour
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 2
.head 5 -  Data Type: Number
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   2.2"
.head 6 -  Top:    4.2"
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 +  If dfHour < 0 or dfHour > 24
.head 7 -  ! Неверное значение!
.head 7 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 7 -  Return VALIDATE_Cancel
.head 6 -  Call SetDateFrom()
.head 6 -  Return VALIDATE_Ok
.head 3 -  Background Text: ч
.head 4 -  Resource Id: 5073
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   3.3"
.head 5 -  Top:    4.25"
.head 5 -  Width:  0.3"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: bgHour
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cLabelControl
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Class Default
.head 5 -  Data Type: Class Default
.head 5 -  Editable? Class Default
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Justify: Class Default
.head 5 -  Format: Class Default
.head 5 -  Country: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Input Mask: Class Default
.head 4 -  Message Actions
.head 3 +  Data Field: dfMin
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 2
.head 5 -  Data Type: Number
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   3.7"
.head 6 -  Top:    4.2"
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 +  If dfMin < 0 or dfMin >= 60
.head 7 -  ! Неверное значение!
.head 7 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 7 -  Return VALIDATE_Cancel
.head 6 -  Call SetDateFrom()
.head 6 -  Return VALIDATE_Ok
.head 3 -  Background Text: мин
.head 4 -  Resource Id: 5074
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   4.8"
.head 5 -  Top:    4.25"
.head 5 -  Width:  0.4"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: bgMin
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cLabelControl
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Class Default
.head 5 -  Data Type: Class Default
.head 5 -  Editable? Class Default
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Justify: Class Default
.head 5 -  Format: Class Default
.head 5 -  Country: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Input Mask: Class Default
.head 4 -  Message Actions
.head 3 +  Picture: picReciever
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left:   5.45"
.head 5 -  Top:    0.1"
.head 5 -  Width:  7.45"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 4.45"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  File Name:
.head 4 -  Storage: External
.head 4 -  Picture Transparent Color: None
.head 4 -  Fit: Scale
.head 4 -  Scaling
.head 5 -  Width:  100
.head 5 -  Height:  100
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Tile To Parent? No
.head 4 -  Border Color: 3D Shadow Color
.head 4 -  Background Color: 3D Face Color
.head 4 -  Message Actions
.head 3 -  Background Text: Получатель
.head 4 -  Resource Id: 5075
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   5.55"
.head 5 -  Top:    0.05"
.head 5 -  Width:  2.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: bgReceiver
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cLabelControl
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Class Default
.head 5 -  Data Type: Class Default
.head 5 -  Editable? Class Default
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Justify: Class Default
.head 5 -  Format: Class Default
.head 5 -  Country: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Input Mask: Class Default
.head 4 -  Message Actions
.head 3 +  Radio Button: rbUsers
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cRadioButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Пользователи
.head 4 -  Window Location and Size
.head 5 -  Left:   5.55"
.head 5 -  Top:    0.3"
.head 5 -  Width:  3.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalSendMsg(tblUsers, UM_Populate, 0, 0)
.head 3 +  Radio Button: rbGroups
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cRadioButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Группы пользователей
.head 4 -  Window Location and Size
.head 5 -  Left:   8.65"
.head 5 -  Top:    0.3"
.head 5 -  Width:  3.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalSendMsg(tblUsers, UM_Populate, 0, 0)
.head 3 -  Line
.head 4 -  Resource Id: 5076
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Coordinates
.head 5 -  Begin X:  5.5"
.head 5 -  Begin Y:  1.2"
.head 5 -  End X:  12.85"
.head 5 -  End Y:  1.2"
.head 4 -  Visible? No
.head 4 -  Line Style: Etched
.head 4 -  Line Thickness: 1
.head 4 -  Line Color: 3D Shadow Color
.head 3 +  ! cRadioButtonLabeled: rbActiveUsers
.head 4 +         Message Actions
.head 5 +         On SAM_Click
.head 6 -         Call SalSendMsg(tblUsers, UM_Populate, 0, 0)
.head 3 +  ! cRadioButtonLabeled: rbAllUsers
.head 4 +         Message Actions
.head 5 +         On SAM_Click
.head 6 -         Call SalSendMsg(tblUsers, UM_Populate, 0, 0)
.head 3 -  Line
.head 4 -  Resource Id: 5077
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Coordinates
.head 5 -  Begin X:  5.5"
.head 5 -  Begin Y:  1.1"
.head 5 -  End X:  12.85"
.head 5 -  End Y:  1.1"
.head 4 -  Visible? Yes
.head 4 -  Line Style: Etched
.head 4 -  Line Thickness: 1
.head 4 -  Line Color: 3D Shadow Color
.head 3 -  Background Text: Відділення
.head 4 -  Resource Id: 20498
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   5.55"
.head 5 -  Top:    0.75"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Combo Box: cmbBranch
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cGenComboBox_StrId
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left:   6.8"
.head 5 -  Top:    0.7"
.head 5 -  Width:  5.883"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 3.821"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Editable? Class Default
.head 4 -  String Type: Class Default
.head 4 -  Maximum Data Length: Class Default
.head 4 -  Sorted? Class Default
.head 4 -  Always Show List? Class Default
.head 4 -  Vertical Scroll? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Input Mask: Class Default
.head 4 -  List Initialization
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set sBranch='-'
.head 6 +  If cmbBranch.Init(hWndItem)
.head 7 -  Call cmbBranch.Populate(hSql(), "branch", "name", "V_USER_BRANCHES", "order by branch")
.head 7 -  Call cmbBranch.Add('-','Всі')
.head 7 -  Call cmbBranch.SetSelectById('-')
.head 7 -  Call SalSendMsg(cmbBranch, SAM_Click,0,0)
.head 5 +  On SAM_Click
.head 6 -  Call SalSendClassMessage(SAM_Click,0,0)
.head 6 -  Set sBranch = cmbBranch.strCurrentId
.head 6 -  Call SalSendMsg(tblUsers, UM_Populate, 0, 0)
.head 3 +  Check Box: cbAll
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cCheckBoxLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Отметить всех
.head 4 -  Window Location and Size
.head 5 -  Left:   5.55"
.head 5 -  Top:    1.2"
.head 5 -  Width:  3.0"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call tblUsers.CheckReceiver(cbAll)
.head 3 -  Background Text: Поиск
.head 4 -  Resource Id: 5078
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   8.65"
.head 5 -  Top:    1.25"
.head 5 -  Width:  1.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Right
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: bgSearch
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cLabelControl
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Class Default
.head 5 -  Data Type: Class Default
.head 5 -  Editable? Class Default
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Justify: Class Default
.head 5 -  Format: Class Default
.head 5 -  Country: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Input Mask: Class Default
.head 4 -  Message Actions
.head 3 +  Data Field: dfName
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   9.75"
.head 6 -  Top:    1.2"
.head 6 -  Width:  3.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_AnyEdit
.head 6 -  Call SalSendMsg(tblUsers, UM_Populate, 0, 0)
.head 3 +  Child Table: tblUsers
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   5.55"
.head 6 -  Top:    1.571"
.head 6 -  Width:  7.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 2.881"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 20000
.head 5 -  Discardable? Yes
.head 4 +  Contents
.head 5 +  Column: colCheck
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Выбрать
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  1.2"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Check Box
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value: 1
.head 8 -  Uncheck Value: 0
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colId
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: UserId
.head 6 -  Visible? No
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Class Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colName
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: ФИО пользователя
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Class Default
.head 6 -  Width:  5.0"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  ! cColumnLabeled: colGroupId
.winattr class Column:
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: GroupId
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -  List Values 
.head 6 -  Message Actions 
.head 5 +  ! cColumnLabeled: colGroupName
.winattr class Column:
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: cColumnLabeled
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Группа пользователей
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  5.0"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.end
.head 6 -  List Values 
.head 6 -  Message Actions 
.head 4 +  Functions
.head 5 +  Function: SendMsg
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Date/Time: dDatFrom
.head 7 -  Date/Time: dDatTo
.head 7 -  Number: nRow
.head 7 -  Number: nUserId
.head 7 -  Number: nCount
.head 7 -  ! кол-во секунд, после которых сообщение становится доступным для прочтения
.head 7 -  Number: nDelay
.head 7 -  ! длительность в секундах доступности сообщения
.head 7 -  Number: nExpiration
.head 7 -  Number: nmUsers[*]
.head 7 -  Number: i
.head 6 +  Actions
.head 7 -  Set mlMsg = SalStrTrimX(mlMsg)
.head 7 +  If SalIsNull(mlMsg)
.head 8 -  ! Не заполнен текст сообщения!
.head 8 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgMsgIsNull'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 8 -  Return FALSE
.head 7 -  Set dDatFrom = SalDateConstruct(
    SalDateYear(dfDatFrom), SalDateMonth(dfDatFrom), SalDateDay(dfDatFrom),
    dfHourFrom, Val(dfMinFrom), 0)
.head 7 +  If SalDateCurrent() > dDatFrom
.head 8 -  Set dSysDate   = SalDateCurrent()
.head 8 -  Set dfDatFrom  = dSysDate
.head 8 -  Set dfHourFrom = SalDateHour(dSysDate)
.head 8 -  Set dfMinFrom  = PadL('00' || Str(SalDateMinute(dSysDate)), 2)
.head 8 -  Set dCurrDate  = dfDatFrom
.head 8 -  Call SetDatePeriod()
.head 8 -  Set nDelay = 0
.head 7 +  Else
.head 8 -  Set dDatFrom = SalDateConstruct(
    SalDateYear(dfDatFrom), SalDateMonth(dfDatFrom), SalDateDay(dfDatFrom),
    dfHourFrom, Val(dfMinFrom), 0)
.head 8 -  Set nDelay = SalNumberRound((dDatFrom-SalDateCurrent()) * 24 * 60 * 60)
.head 7 -  Set dDatTo = SalDateConstruct(
    SalDateYear(dfDatTo), SalDateMonth(dfDatTo), SalDateDay(dfDatTo),
    dfHourTo, Val(dfMinTo), 0)
.head 7 +  If SalDateCurrent() > dDatTo
.head 8 -  ! Проверьте дату действия сообщения!
.head 8 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgCheckDat'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 8 -  Return FALSE
.head 7 +  If dDatFrom = dDatTo
.head 8 -  ! Проверьте дату действия сообщения!
.head 8 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgCheckDat'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 8 -  Return FALSE
.head 7 -  Set nExpiration = dfDay * 24 * 60 * 60 + dfHour * 60 * 60 + dfMin * 60
.head 7 -  Set nCount = 0
.head 7 -  Set nRow = TBL_MinRow
.head 7 +  While SalTblFindNextRow(hWndForm, nRow, 0, 0)
.head 8 -  Call SalTblSetContext(hWndForm, nRow)
.head 8 +  If rbUsers
.head 9 +  If colCheck
.head 10 -  ! добавляет получателя сообщения во временную таблицу(закоментив), пробуем відсилати напряму із за НБУ
.head 10 +  ! If not BMS_AddRecipient(colId)
.head 11 -  Return FALSE
.head 10 +  If not BMS_EnqueueMsg(mlMsg, nDelay, nExpiration, colId)
.head 11 -  Return FALSE
.head 10 -  Set nCount = nCount + 1
.head 8 +  Else
.head 9 +  If colCheck
.head 10 -  Call SqlPrepareAndExecute(hSqlAux2(),
"select userid into :nUserId
   from otd_user
  where otd = :colId and userid in(select id from staff where case when current_branch is null then branch else current_branch end  like "||IifS(sBranch='-', "'%'", "'"||sBranch||"'")||")")
.head 10 +  While SqlFetchNext(hSqlAux2(), nFetchRes)
.head 11 -  ! добавляет получателя сообщения во временную таблицу
.head 11 +  ! If not BMS_AddRecipient(nUserId)
.head 12 -  Return FALSE
.head 11 -  Set nmUsers[nCount] = nUserId
.head 11 -  ! Call Debug("До отправки")
.head 11 +  ! If not BMS_EnqueueMsg(mlMsg, nDelay, nExpiration, nUserId)
.head 12 -  Return FALSE
.head 11 -  ! Call Debug("После отправки")
.head 11 -  Set nCount = nCount + 1
.head 10 +  If nCount
.head 11 -  Set i = 0
.head 11 +  While i <= nCount
.head 12 -  ! Call Debug("До отправки")
.head 12 +  If not BMS_EnqueueMsg(mlMsg, nDelay, nExpiration, nmUsers[i])
.head 13 -  Return FALSE
.head 12 -  ! Call Debug("После отправки")
.head 12 -  Set i = i + 1
.head 7 +  If nCount
.head 8 -  ! помещение сообщения в очередь
.head 8 +  ! If not BMS_EnqueueMsg(mlMsg, nDelay, nExpiration, NUMBER_Null)
.head 9 -  Return FALSE
.head 8 -  ! Сообщение отправлено
.head 8 -  ! Call Debug("Количество "||Str(nCount))
.head 8 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgMsgSend'),
     CurrentLangTable.GetAtomTitle('cTInfo'), MB_IconAsterisk)
.head 8 -  ! Call Debug("Количество 2")
.head 7 +  Else
.head 8 -  ! Не выбран получатель!
.head 8 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgNotReceiver'),
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 8 -  Return FALSE
.head 7 -  Return TRUE
.head 5 +  Function: CheckReceiver
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  Boolean: bCheck
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: nRow
.head 6 +  Actions
.head 7 -  Set nRow = TBL_MinRow
.head 7 +  While SalTblFindNextRow(hWndForm, nRow, 0, 0)
.head 8 -  Call SalTblSetContext(hWndForm, nRow)
.head 8 -  Set colCheck = bCheck
.head 8 -  Call SalTblSetRowFlags(hWndForm, nRow, ROW_Edited, FALSE)
.head 7 -  Return TRUE
.head 5 +  Function: Init
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: nId
.head 7 -  String: sName
.head 7 -  Number: i
.head 6 +  Actions
.head 7 +  If rbUsers
.head 8 -  Set sStrPopulate = "select id, fio into :nId, :sName from staff where case when current_branch is null then branch else current_branch end  like "||IifS(sBranch='-', "'%'", "'"||sBranch||"'")||" order by fio"
.head 8 -  Call SalTblSetColumnTitle(colName, CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTUserName'))
.head 7 +  Else
.head 8 -  Set sStrPopulate = "select id, name into :nId, :sName from otdel where branch like "||IifS(sBranch='-', "'%'", "'"||sBranch||"'")||" order by name"
.head 8 -  Call SalTblSetColumnTitle(colName, CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTGroupName'))
.head 7 -  Set i = 0
.head 7 -  Call SqlPrepareAndExecute(hSql(), sStrPopulate)
.head 7 +  While SqlFetchNext(hSql(), nFetchRes)
.head 8 -  Set nmRec[i] = nId
.head 8 -  Set smRec[i] = sName
.head 8 -  Set i = i + 1
.head 7 -  Set nRecNum = i
.head 7 -  Return TRUE
.head 5 +  Function: Populate
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  String: sName
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: i
.head 7 -  Number: nRow
.head 6 +  Actions
.head 7 -  Call SalTblReset(hWndForm)
.head 7 +  While i < nRecNum
.head 8 +  If sName = ''
.head 9 -  Set nRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 9 -  Call SalTblSetRowFlags(hWndForm, nRow, ROW_New, FALSE)
.head 9 -  Call SalTblSetContext(hWndForm, nRow)
.head 9 -  Set colCheck = cbAll
.head 9 -  Set colId    = nmRec[i]
.head 9 -  Set colName  = smRec[i]
.head 8 +  Else
.head 9 +  If SalStrScan(SalStrUpperX(smRec[i]), SalStrUpperX(sName)) = 0
.head 10 -  Set nRow = SalTblInsertRow(hWndForm, TBL_MaxRow)
.head 10 -  Call SalTblSetRowFlags(hWndForm, nRow, ROW_New, FALSE)
.head 10 -  Call SalTblSetContext(hWndForm, nRow)
.head 10 -  Set colCheck = cbAll
.head 10 -  Set colId    = nmRec[i]
.head 10 -  Set colName  = smRec[i]
.head 8 -  Set i = i + 1
.head 7 -  Return TRUE
.head 4 +  Window Variables
.head 5 -  String: sStrPopulate
.head 5 -  Number: nmRec[*]
.head 5 -  String: smRec[*]
.head 5 -  Number: nRecNum
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 6 -  Call SalSendMsg(hWndForm, UM_Populate, 0, 0)
.head 5 +  On UM_Populate
.head 6 -  Call Init()
.head 6 -  Call Populate(dfName)
.head 3 +  Picture: picPb
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.1"
.head 5 -  Top:    4.6"
.head 5 -  Width:  12.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.7"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  File Name:
.head 4 -  Storage: External
.head 4 -  Picture Transparent Color: None
.head 4 -  Fit: Scale
.head 4 -  Scaling
.head 5 -  Width:  100
.head 5 -  Height:  100
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Tile To Parent? No
.head 4 -  Border Color: 3D Shadow Color
.head 4 -  Background Color: 3D Face Color
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbSend
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cpbLabeledOk
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Отправить
.head 4 -  Window Location and Size
.head 5 -  Left:   10.1"
.head 5 -  Top:    4.75"
.head 5 -  Width:  Class Default
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\TOMAIL.BMP
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If tblUsers.SendMsg()
.head 7 -  Set mlMsg = ''
.head 7 -  Call SalSendMsg(tblUsers, UM_Populate, 0, 0)
.head 3 +  Pushbutton: pbCancel
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cpbLabeledCancel
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left:   11.5"
.head 5 -  Top:    4.76"
.head 5 -  Width:  Class Default
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalDestroyWindow(hWndForm)
.head 2 +  Functions
.head 3 +  Function: DatFromValidate
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If dfDatFrom < dCurrDate
.head 6 -  ! Неверное значение!
.head 6 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 6 -  Return FALSE
.head 5 +  If dfDatFrom > dfDatTo
.head 6 -  Set dfDatTo = dfDatFrom + 1
.head 5 +  If dfDatFrom = dCurrDate
.head 6 +  If dfHourFrom < SalDateHour(dSysDate)
.head 7 -  Set dfHourFrom = SalDateHour(dSysDate)
.head 7 -  Set dfMinFrom  = PadL('00' || Str(SalDateMinute(dSysDate)), 2)
.head 6 +  Else If dfHourFrom = SalDateHour(dSysDate) and Val(dfMinFrom) < SalDateMinute(dSysDate)
.head 7 -  Set dfMinFrom  = PadL('00' || Str(SalDateMinute(dSysDate)), 2)
.head 5 +  If dfHourFrom = 24
.head 6 -  Set dfMinFrom = '00'
.head 5 -  Return TRUE
.head 3 +  Function: DatToValidate
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If dfDatTo < dCurrDate or dfDatTo < dfDatFrom
.head 6 -  ! Неверное значение!
.head 6 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTMsgUncorrectValue'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 6 -  Return FALSE
.head 5 +  ! If dfDatTo = dCurrDate
.head 6 +  If dfHourTo < SalDateHour(dSysDate)
.head 7 -  Set dfHourTo = SalDateHour(dSysDate)
.head 7 -  Set dfMinTo  = PadL('00' || Str(SalDateMinute(dSysDate)), 2)
.head 6 +  Else If dfHourTo = SalDateHour(dSysDate) and Val(dfMinTo) < SalDateMinute(dSysDate)
.head 7 -  Set dfMinTo  = PadL('00' || Str(SalDateMinute(dSysDate)), 2)
.head 5 +  If dfDatTo = dfDatFrom
.head 6 +  If dfHourTo < dfHourFrom
.head 7 -  Set dfHourTo = 24
.head 7 -  Set dfMinTo  = '00'
.head 6 +  Else If dfHourTo = dfHourFrom and Val(dfMinTo) < Val(dfMinFrom)
.head 7 -  Set dfMinTo = dfMinFrom
.head 5 +  If dfHourTo = 24
.head 6 -  Set dfMinTo = '00'
.head 5 -  Return TRUE
.head 3 +  Function: SetDatePeriod
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If not DatFromValidate()
.head 6 -  Set dfDatFrom = dCurrDate
.head 6 -  Return FALSE
.head 5 +  If not DatToValidate()
.head 6 -  Set dfDatTo = dfDatFrom + 1
.head 6 -  Return FALSE
.head 5 -  Set dfMin  = Val(dfMinTo) - Val(dfMinFrom)
.head 5 -  Set dfHour = dfHourTo - dfHourFrom
.head 5 -  Set dfDay  = dfDatTo - dfDatFrom
.head 5 +  If dfMin < 0
.head 6 -  Set dfMin = 60 + dfMin
.head 6 -  Set dfHour = dfHour - 1
.head 5 +  If dfHour < 0
.head 6 -  Set dfHour = 24 + dfHour
.head 6 -  Set dfDay = dfDay - 1
.head 5 -  Return TRUE
.head 3 +  Function: SetDateFrom
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nMinTo
.head 4 +  Actions
.head 5 +  If not DatFromValidate()
.head 6 -  Return FALSE
.head 5 -  Set nMinTo   = Val(dfMinFrom) + dfMin
.head 5 -  Set dfHourTo = dfHourFrom + dfHour
.head 5 -  Set dfDatTo  = dfDatFrom + dfDay
.head 5 +  If nMinTo >= 60
.head 6 -  Set dfMinTo = Str(nMinTo - 60)
.head 6 -  Set dfHourTo = dfHourTo + 1
.head 5 +  Else
.head 6 -  Set dfMinTo = Str(nMinTo)
.head 5 -  Set dfMinTo = PadL('00' || dfMinTo, 2)
.head 5 +  If dfHourTo >= 24
.head 6 -  Set dfHourTo = dfHourTo - 24
.head 6 -  Set dfDatTo = dfDatTo + 1
.head 5 -  Return TRUE
.head 2 -  Window Parameters
.head 2 +  Window Variables
.head 3 -  String: strMonth[12]	!! Наименов. месяце для календаря
.head 3 -  String: strWeekDays[7]	!! Дни недели для календаря
.head 3 -  String: sPK
.head 3 -  String: sSem
.head 3 -  String: sBranch
.head 3 -  Date/Time: dSysDate
.head 3 -  Date/Time: dCurrDate
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  Call SalSetWindowText(hWndForm, CurrentLangTable.GetAtomTitle('frm_BMSSendMsg.cTWndTitle'))
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 4 -  Set rbToDate = TRUE
.head 4 -  Set rbUsers = TRUE
.head 4 -  ! Set rbActiveUsers = TRUE
.head 4 -  Set dSysDate = SalDateCurrent()
.head 4 -  ! сообщение действует с (дата)
.head 4 -  Set dfDatFrom  = dSysDate
.head 4 -  Set dfHourFrom = SalDateHour(dSysDate)
.head 4 -  Set dfMinFrom  = PadL('00' || Str(SalDateMinute(dSysDate)), 2)
.head 4 -  ! сообщение действует до (дата)
.head 4 -  Set dfDatTo  = dfDatFrom + 1
.head 4 -  Set dfHourTo = dfHourFrom
.head 4 -  Set dfMinTo  = dfMinFrom
.head 4 -  ! сообщение действует (кол-во времени)
.head 4 -  Call SetDatePeriod()
.head 4 -  Call SalDisableWindow(dfDay)
.head 4 -  Call SalDisableWindow(dfHour)
.head 4 -  Call SalDisableWindow(dfMin)
.head 4 -  Set dCurrDate = dfDatFrom
.head 1 +  Dialog Box: dlg_BMSSaveMsg
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Сохранение сообщения
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  5.5"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 3.5"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 -  Frame
.head 4 -  Resource Id: 47366
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.1"
.head 5 -  Top:    0.05"
.head 5 -  Width:  5.25"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 2.3"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Border Color: Default
.head 4 -  Background Color: Default
.head 3 -  Background Text: Код сообщения:
.head 4 -  Resource Id: 47367
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.2"
.head 5 -  Top:    0.15"
.head 5 -  Width:  1.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: bgMsgCode
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cLabelControl
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Class Default
.head 5 -  Data Type: Class Default
.head 5 -  Editable? Class Default
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Justify: Class Default
.head 5 -  Format: Class Default
.head 5 -  Country: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Input Mask: Class Default
.head 4 -  Message Actions
.head 3 +  Data Field: dfCode
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 30
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   2.1"
.head 6 -  Top:    0.1"
.head 6 -  Width:  3.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Uppercase
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  Set dfCode = SalStrTrimX(dfCode)
.head 6 +  If not SalIsNull(dfCode)
.head 7 -  Call SqlPrepareAndExecute(hSql(), "select code into :sCode from bms_msg where code = :dfCode")
.head 7 +  If SqlFetchNext(hSql(), nFetchRes)
.head 8 -  ! Сообщение с таким кодом уже существует!
.head 8 -  Call SalMessageBox(CurrentLangTable.GetAtomTitle('dlg_BMSSaveMsg.cTMsgMsgExists'), 
     CurrentLangTable.GetAtomTitle('cTAt'), MB_IconExclamation)
.head 8 -  Set dfCode = ''
.head 8 -  Return VALIDATE_Cancel
.head 6 -  Return VALIDATE_Ok
.head 3 -  Background Text: Сообщение:
.head 4 -  Resource Id: 47368
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.2"
.head 5 -  Top:    0.4"
.head 5 -  Width:  1.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: bgMsg
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cLabelControl
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Class Default
.head 5 -  Data Type: Class Default
.head 5 -  Editable? Class Default
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:   Default
.head 6 -  Top:    Default
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Justify: Class Default
.head 5 -  Format: Class Default
.head 5 -  Country: Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  Input Mask: Class Default
.head 4 -  Message Actions
.head 3 +  Multiline Field: mlMsg
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 254
.head 5 -  String Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Border? Yes
.head 5 -  Word Wrap? Yes
.head 5 -  Vertical Scroll? Yes
.head 5 -  Window Location and Size
.head 6 -  Left:   0.2"
.head 6 -  Top:    0.65"
.head 6 -  Width:  5.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 1.6"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 4 -  Message Actions
.head 3 -  Frame
.head 4 -  Resource Id: 47369
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left:   0.1"
.head 5 -  Top:    2.4"
.head 5 -  Width:  5.25"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.7"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Border Color: Default
.head 4 -  Background Color: Default
.head 3 +  Pushbutton: pbSave
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Сохранить
.head 4 -  Window Location and Size
.head 5 -  Left:   2.7"
.head 5 -  Top:    2.5"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 0.452"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name: \BARS98\RESOURCE\BMP\SAVE.BMP
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If mlMsg
.head 7 +  If not SqlPrepareAndExecute(hSql(), "insert into bms_msg(code, msg) values(:dfCode, :mlMsg)")
.head 8 -  Call SqlRollback(hSql())
.head 7 +  Else
.head 8 -  Call SqlCommit(hSql())
.head 8 -  Call SalEndDialog(hWndForm, TRUE)
.head 3 +  Pushbutton: pbCancel
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cpbLabeledCancel
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left:   4.0"
.head 5 -  Top:    2.5"
.head 5 -  Width:  Class Default
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalEndDialog(hWndForm, FALSE)
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: sMsg
.head 2 +  Window Variables
.head 3 -  String: sCode
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  Call SalSetWindowText(hWndForm, CurrentLangTable.GetAtomTitle('dlg_BMSSaveMsg.cTWndTitle'))
.head 4 -  Call SalCenterWindow(hWndForm)
.head 4 -  Set mlMsg = sMsg
.head 1 +  Dialog Box: dlg_BMSShowMsg
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title:
.head 2 -  Accesories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: System Modal
.head 3 -  Window Location and Size
.head 4 -  Left:   Default
.head 4 -  Top:    Default
.head 4 -  Width:  5.8"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 2.9"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Multiline Field: mlMessage
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 512
.head 5 -  String Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Border? Yes
.head 5 -  Word Wrap? Yes
.head 5 -  Vertical Scroll? Yes
.head 5 -  Window Location and Size
.head 6 -  Left:   0.1"
.head 6 -  Top:    0.05"
.head 6 -  Width:  5.5"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 2.0"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbCancel
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cPushButtonLabeled
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: &Закрыть
.head 4 -  Window Location and Size
.head 5 -  Left:   4.4"
.head 5 -  Top:    2.15"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SaveInfoToLog("BMS. Прочитано сообщение от пользователя " || Str(nSenderId) || ": " || strMessage)
.head 6 -  Call SalEndDialog(hWndForm, TRUE)
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: strMessage
.head 3 -  Number: nSenderId
.head 3 -  Date/Time: dSendTime
.head 3 -  String: strUser
.head 3 -  String: strHost
.head 2 -  Window Variables
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  ! Call SalSendMsgToChildren(hWndForm, UM_QueryLabelText, 0, 0)
.head 4 -  ! BMS: Сообщение от " || strUser || "@" || strHost
.head 4 -  ! Call Debug("BMS: " || CurrentLangTable.GetAtomTitle('dlg_ShowNetMessage.cTWndTitle') ||" " || strUser || "@" || strHost)
.head 4 -  Call SalSetWindowText(hWndForm, "BMS: " || CurrentLangTable.GetAtomTitle('dlg_ShowNetMessage.cTWndTitle') || " " || strUser
     || "@" || strHost)
.head 4 -  Call PrepareWindowEx(hWndForm)
.head 4 -  Call SalSetFocus(pbCancel)
.head 4 -  ! Отправлено dSendTime, Получено SalDateCurrent(), strMessage
.head 4 -  Set mlMessage = CurrentLangTable.GetAtomTitle('dlg_BMSShowMsg.cTMsgSend') || ' ' ||
    SalFmtFormatDateTime(dSendTime, 'dd/MM/yyyy hhhh:mm:ss') || PutCrLf() ||
    CurrentLangTable.GetAtomTitle('dlg_BMSShowMsg.cTMsgReceive') || ' ' || SalFmtFormatDateTime(
    SalDateCurrent(), 'dd/MM/yyyy hhhh:mm:ss') || PutCrLf() || strMessage
.head 3 +  On SAM_CreateComplete
.head 4 -  Call SalMessageBeep(MB_IconAsterisk)
