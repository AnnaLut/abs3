

PROMPT ===================================================================================== 
PROMPT *** Run *** ========== Scripts /Sql/BARS/Trigger/TAIUD_CMCLIENTQUE.sql =========*** R
PROMPT ===================================================================================== 


PROMPT *** Create  trigger TAIUD_CMCLIENTQUE ***

  CREATE OR REPLACE TRIGGER BARS.TAIUD_CMCLIENTQUE 
after insert or update or delete on cm_client_que
for each row
declare
  l_idupd     number;
  l_chgaction number;
begin
  select s_cmclient.nextval into l_idupd from dual;

  -- история изменения
  if inserting or updating then
     if inserting then
        l_chgaction := 1;
     else
        l_chgaction := 2;
     end if;
     insert into cm_client_que_arc (idupd, doneby, chgaction,
        id,
        rnk,
        datein,
        datemod,
        oper_type,
        oper_status,
        resp_txt,
        branch,
        opendate,
        regnumberclient,
        regnumberowner,
        clienttype,
        taxpayeridentifier,
        shortname,
        firstname,
        lastname,
        middlename,
        engfirstname,
        englastname,
        country,
        resident,
        work,
        office,
        date_w,
        isvip,
        k060,
        companyname,
        shortcompanyname,
        personalisationname,
        klas_client_id,
        contactperson,
        birthdate,
        birthplace,
        gender,
        addr1_cityname,
        addr1_pcode,
        addr1_domain,
        addr1_region,
        addr1_street,
        addr2_cityname,
        addr2_pcode,
        addr2_domain,
        addr2_region,
        addr2_street,
        email,
        phonenumber,
        phonenumber_mob,
        phonenumber_dod,
        fax,
        typedoc,
        paspnum,
        paspseries,
        paspdate,
        paspissuer,
        foreignpaspnum,
        foreignpaspseries,
        foreignpaspdate,
        foreignpaspenddate,
        foreignpaspissuer,
        contractnumber,
        productcode,
        card_type,
        cntm,
        pind,
        okpo_sysorg,
        kod_sysorg,
        cl_rnk,
        cl_dt_iss,
        card_br_iss,
        card_addr_iss,
        delivery_br,
        acc,
        kk_flag,
        kk_secret_word,
        kk_regtype,
        kk_cityareaid,
        kk_streettypeid,
        kk_streetname,
        kk_apartment,
        kk_postcode,
        add_info,
        idcardenddate,
        eddr_id,
        shortnameowner)
     values (l_idupd, user, l_chgaction,
        :new.id,
        :new.rnk,
        :new.datein,
        :new.datemod,
        :new.oper_type,
        :new.oper_status,
        :new.resp_txt,
        :new.branch,
        :new.opendate,
        :new.regnumberclient,
        :new.regnumberowner,
        :new.clienttype,
        :new.taxpayeridentifier,
        :new.shortname,
        :new.firstname,
        :new.lastname,
        :new.middlename,
        :new.engfirstname,
        :new.englastname,
        :new.country,
        :new.resident,
        :new.work,
        :new.office,
        :new.date_w,
        :new.isvip,
        :new.k060,
        :new.companyname,
        :new.shortcompanyname,
        :new.personalisationname,
        :new.klas_client_id,
        :new.contactperson,
        :new.birthdate,
        :new.birthplace,
        :new.gender,
        :new.addr1_cityname,
        :new.addr1_pcode,
        :new.addr1_domain,
        :new.addr1_region,
        :new.addr1_street,
        :new.addr2_cityname,
        :new.addr2_pcode,
        :new.addr2_domain,
        :new.addr2_region,
        :new.addr2_street,
        :new.email,
        :new.phonenumber,
        :new.phonenumber_mob,
        :new.phonenumber_dod,
        :new.fax,
        :new.typedoc,
        :new.paspnum,
        :new.paspseries,
        :new.paspdate,
        :new.paspissuer,
        :new.foreignpaspnum,
        :new.foreignpaspseries,
        :new.foreignpaspdate,
        :new.foreignpaspenddate,
        :new.foreignpaspissuer,
        :new.contractnumber,
        :new.productcode,
        :new.card_type,
        :new.cntm,
        :new.pind,
        :new.okpo_sysorg,
        :new.kod_sysorg,
        :new.cl_rnk,
        :new.cl_dt_iss,
        :new.card_br_iss,
        :new.card_addr_iss,
        :new.delivery_br,
        :new.acc,
        :new.kk_flag,
        :new.kk_secret_word,
        :new.kk_regtype,
        :new.kk_cityareaid,
        :new.kk_streettypeid,
        :new.kk_streetname,
        :new.kk_apartment,
        :new.kk_postcode,
        :new.add_info,
        :new.idcardenddate,
        :new.eddr_id,
        :new.shortnameowner);
  elsif deleting and :old.oper_status <> 3 then
     insert into cm_client_que_arc (idupd, doneby, chgaction,
        id,
        rnk,
        datein,
        datemod,
        oper_type,
        oper_status,
        resp_txt,
        branch,
        opendate,
        regnumberclient,
        regnumberowner,
        clienttype,
        taxpayeridentifier,
        shortname,
        firstname,
        lastname,
        middlename,
        engfirstname,
        englastname,
        country,
        resident,
        work,
        office,
        date_w,
        isvip,
        k060,
        companyname,
        shortcompanyname,
        personalisationname,
        klas_client_id,
        contactperson,
        birthdate,
        birthplace,
        gender,
        addr1_cityname,
        addr1_pcode,
        addr1_domain,
        addr1_region,
        addr1_street,
        addr2_cityname,
        addr2_pcode,
        addr2_domain,
        addr2_region,
        addr2_street,
        email,
        phonenumber,
        phonenumber_mob,
        phonenumber_dod,
        fax,
        typedoc,
        paspnum,
        paspseries,
        paspdate,
        paspissuer,
        foreignpaspnum,
        foreignpaspseries,
        foreignpaspdate,
        foreignpaspenddate,
        foreignpaspissuer,
        contractnumber,
        productcode,
        card_type,
        cntm,
        pind,
        okpo_sysorg,
        kod_sysorg,
        cl_rnk,
        cl_dt_iss,
        card_br_iss,
        card_addr_iss,
        delivery_br,
        acc,
        kk_flag,
        kk_secret_word,
        kk_regtype,
        kk_cityareaid,
        kk_streettypeid,
        kk_streetname,
        kk_apartment,
        kk_postcode,
        add_info,
        idcardenddate,
        eddr_id,
        shortnameowner)
     values (l_idupd, user, 3,
        :old.id,
        :old.rnk,
        :old.datein,
        :old.datemod,
        :old.oper_type,
        :old.oper_status,
        :old.resp_txt,
        :old.branch,
        :old.opendate,
        :old.regnumberclient,
        :old.regnumberowner,
        :old.clienttype,
        :old.taxpayeridentifier,
        :old.shortname,
        :old.firstname,
        :old.lastname,
        :old.middlename,
        :old.engfirstname,
        :old.englastname,
        :old.country,
        :old.resident,
        :old.work,
        :old.office,
        :old.date_w,
        :old.isvip,
        :old.k060,
        :old.companyname,
        :old.shortcompanyname,
        :old.personalisationname,
        :old.klas_client_id,
        :old.contactperson,
        :old.birthdate,
        :old.birthplace,
        :old.gender,
        :old.addr1_cityname,
        :old.addr1_pcode,
        :old.addr1_domain,
        :old.addr1_region,
        :old.addr1_street,
        :old.addr2_cityname,
        :old.addr2_pcode,
        :old.addr2_domain,
        :old.addr2_region,
        :old.addr2_street,
        :old.email,
        :old.phonenumber,
        :old.phonenumber_mob,
        :old.phonenumber_dod,
        :old.fax,
        :old.typedoc,
        :old.paspnum,
        :old.paspseries,
        :old.paspdate,
        :old.paspissuer,
        :old.foreignpaspnum,
        :old.foreignpaspseries,
        :old.foreignpaspdate,
        :old.foreignpaspenddate,
        :old.foreignpaspissuer,
        :old.contractnumber,
        :old.productcode,
        :old.card_type,
        :old.cntm,
        :old.pind,
        :old.okpo_sysorg,
        :old.kod_sysorg,
        :old.cl_rnk,
        :old.cl_dt_iss,
        :old.card_br_iss,
        :old.card_addr_iss,
        :old.delivery_br,
        :old.acc,
        :old.kk_flag,
        :old.kk_secret_word,
        :old.kk_regtype,
        :old.kk_cityareaid,
        :old.kk_streettypeid,
        :old.kk_streetname,
        :old.kk_apartment,
        :old.kk_postcode,
        :old.add_info,
        :old.idcardenddate,
        :old.eddr_id,
        :old.shortnameowner);
  end if;

end;
/
ALTER TRIGGER BARS.TAIUD_CMCLIENTQUE ENABLE;


PROMPT ===================================================================================== 
PROMPT *** End *** ========== Scripts /Sql/BARS/Trigger/TAIUD_CMCLIENTQUE.sql =========*** E
PROMPT ===================================================================================== 
