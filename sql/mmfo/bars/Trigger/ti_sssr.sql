

PROMPT ===================================================================================== 
PROMPT *** Run *** ========== Scripts /Sql/BARS/Trigger/TI_SSSR.sql =========*** Run *** ===
PROMPT ===================================================================================== 


PROMPT *** Create  trigger TI_SSSR ***

  CREATE OR REPLACE TRIGGER BARS.TI_SSSR 
  BEFORE INSERT ON "BARS"."ARC_RRP"
  REFERENCING FOR EACH ROW
    WHEN (
SUBSTR(NEW.fn_a,2,1)='A' AND new.mfoa<>'300465' AND new.mfob=300465
      ) DECLARE
   ern  CONSTANT POSITIVE := 338; -- Trigger err code
   err  EXCEPTION;
   erm  VARCHAR2(80);
BEGIN
   IF ( :NEW.nlsb in ('2906501202',
                      '290650101',  '290660201',
                      '290620102',  '290630202',
                      '290690103',  '290600203',
                      '290660104',  '290670204',
                      '290630105',  '290640205',
                      '290600106',  '290610206',
                      '290670107',  '290680207',
                      '290640108',  '290650208',
                      '290610109',  '290620209',
                      '290640111',  '290650211',
                      '290610112',  '290620212',
                      '290680113',  '290690213',
                      '290650114',  '290660214',
                      '290620115',  '290630215',
                      '290690116',  '290600216',
                      '290660117',  '290670217',
                      '290630118',  '290640218',
                      '290600119',  '290610219',
                      '290660120',  '290670220',
                      '290630121',  '290640221',
                      '290600122',  '290610222',
                      '290670123',  '290680223',
                      '290640124',  '290650224',
                      '290610125',  '290620225',
                      '290680126',  '290690226',
                      '2906301301', '290670301',
                      '290640315',  '290640302',
                      '290610316',  '290610303',
                      '290680317',  '290680304',
                      '290650318',  '290650305',
                      '290620319',  '290620306',
                      '290680320',  '290690307',
                      '290650321',  '290660308',
                      '290620322',  '290630309',
                      '290690323',  '290660311',
                      '290660324',  '290630312',
                      '290630325',  '290600313',
                      '290600326',  '290670314',
                      '2906401201', '2906601203',
                      '2906401',
                      '290642012',
                      '2906603'
                      ) and
        :NEW.dk < 2
      )
   THEN
      erm := '0992 - Недопустимый счет клиента Б';
      raise_application_error(-(20000+ern),'\'||erm,TRUE);
   END IF;
END;


/
ALTER TRIGGER BARS.TI_SSSR ENABLE;


PROMPT ===================================================================================== 
PROMPT *** End *** ========== Scripts /Sql/BARS/Trigger/TI_SSSR.sql =========*** End *** ===
PROMPT ===================================================================================== 
