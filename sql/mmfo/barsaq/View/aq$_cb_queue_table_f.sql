

PROMPT ===================================================================================== 
PROMPT *** Run *** ========== Scripts /Sql/BARSAQ/View/AQ$_CB_QUEUE_TABLE_F.sql =========***
PROMPT ===================================================================================== 


PROMPT *** Create  view AQ$_CB_QUEUE_TABLE_F ***

  CREATE OR REPLACE FORCE VIEW BARSAQ.AQ$_CB_QUEUE_TABLE_F ("Q_NAME", "ROW_ID", "MSGID", "CORRID", "PRIORITY", "STATE", "DELAY", "EXPIRATION", "ENQ_TIME", "ENQ_UID", "ENQ_TID", "DEQ_TIME", "DEQ_UID", "DEQ_TID", "RETRY_COUNT", "EXCEPTION_QSCHEMA", "EXCEPTION_QUEUE", "CSCN", "DSCN", "CHAIN_NO", "LOCAL_ORDER_NO", "TIME_MANAGER_INFO", "STEP_NO", "USER_DATA", "SENDER_NAME", "SENDER_ADDRESS", "SENDER_PROTOCOL", "DEQUEUE_MSGID", "DELIVERY_MODE", "SEQUENCE_NUM", "MSG_NUM", "QUEUE_ID", "USER_PROP", "SUBSCRIBER_ID", "SUBSCRIBER_NAME", "QUEUE_EVTID") AS 
  SELECT  /*+ NO_MERGE (qo) USE_NL(iot) */ qt.q_name Q_NAME, qt.rowid ROW_ID, qt.msgid MSGID, qt.corrid CORRID, qt.priority PRIORITY, qt.state STATE, cast(FROM_TZ(qt.delay, '00:00') at time zone sessiontimezone as timestamp) DELAY, qt.expiration EXPIRATION, cast(FROM_TZ(qt.enq_time, '00:00') at time zone sessiontimezone as timestamp) ENQ_TIME, qt.enq_uid ENQ_UID, qt.enq_tid ENQ_TID, cast(FROM_TZ(qt.deq_time, '00:00') at time zone sessiontimezone as timestamp) DEQ_TIME, qt.deq_uid DEQ_UID, qt.deq_tid DEQ_TID, qt.retry_count RETRY_COUNT, qt.exception_qschema EXCEPTION_QSCHEMA, qt.exception_queue EXCEPTION_QUEUE, qt.cscn CSCN, qt.dscn DSCN, qt.chain_no CHAIN_NO, qt.local_order_no LOCAL_ORDER_NO, cast(FROM_TZ(qt.time_manager_info, '00:00') at time zone sessiontimezone as timestamp)   TIME_MANAGER_INFO, qt.step_no STEP_NO, qt.user_data USER_DATA, qt.sender_name SENDER_NAME, qt.sender_address SENDER_ADDRESS, qt.sender_protocol SENDER_PROTOCOL, qt.dequeue_msgid DEQUEUE_MSGID, 'PERSISTENT' DELIVERY_MODE, 0 SEQUENCE_NUM, 0 MSG_NUM, qo.qid QUEUE_ID, qt.user_prop USER_PROP, iot.subscriber# SUBSCRIBER_ID, iot.name SUBSCRIBER_NAME, iot.queue# QUEUE_EVTID FROM "CB_QUEUE_TABLE" qt, "AQ$_CB_QUEUE_TABLE_I" iot, SYS.USER_AQ_AGENT_PRIVS up, SYS.ALL_INT_DEQUEUE_QUEUES qo  WHERE qt.msgid=iot.msgid  and (iot.name = up.agent_name or  iot.subscriber# = (select s.subscriber_id from "AQ$_CB_QUEUE_TABLE_S" s  where s.name = up.agent_name and  bitand(s.subscriber_type, 8) = 0)) and qt.q_name = qo.name  AND qo.owner = 'BARSAQ' AND iot.msg_enq_tid = qt.enq_tid AND  iot.txn_step# = qt.step_no AND  iot.sender# = 0 AND  iot.msg_local_order_no = qt.local_order_no AND  iot.msg_chain_no = qt.chain_no  UNION ALL SELECT  qo.name Q_NAME,  cast (null as rowid) ROW_ID,  b.msgid MSGID,  b.corrid CORRID,  b.priority PRIORITY,  decode(b.state, 4, 0, 5, 8, 12, 10, 0) STATE,  cast (null as TIMESTAMP) DELAY,  b.expiration EXPIRATION,  cast(FROM_TZ(b.enq_time, '00:00')  at time zone sessiontimezone as timestamp) ENQ_TIME, b.enq_user_name ENQ_UID,  cast(null as varchar2(30)) ENQ_TID,  cast(null as timestamp) DEQ_TIME,  cast (null as varchar2(30))  DEQ_UID,  cast (null as varchar2(30)) DEQ_TID,  0 RETRY_COUNT, b.exceptionq_schema EXCEPTION_QUEUE_OWNER, b.exceptionq_name EXCEPTION_QUEUE,  0 CSCN,  0 DSCN,  0 CHAIN_NO,  0 LOCAL_ORDER_NO,  cast (null as TIMESTAMP) TIME_MANAGER_INFO,  0 STEP_NO, sys.dbms_aq_bqview.get_opaque_payload(b.queue_id, b.msg_num, SYS.ANYDATA.ConvertNumber(0)) USER_DATA, b.sender_name SENDER_NAME, b.sender_address SENDER_ADDRESS, b.sender_protocol SENDER_PROTOCOL,  cast(null as raw(16)) DEQUEUE_MSGID, 'BUFFERED' DELIVERY_MODE, b.sequence_num SEQUENCE_NUM, b.msg_num MSG_NUM, qo.qid QUEUE_ID,  null USER_PROP, b.subscriber_id SUBSCRIBER_ID,  cast (null as varchar2(30)) SUBSCRIBER_NAME, 0 QUEUE_EVTID  FROM SYS.qt756831_BUFFER b,  sys.all_int_dequeue_queues qo  WHERE bitand(b.state, 4) = 4 AND qo.qid =b.queue_id  UNION ALL SELECT  p.q_name Q_NAME,  cast (null as rowid) ROW_ID,  p.msgid MSGID,  p.corrid CORRID,  p.priority PRIORITY,  p.state STATE,  cast(FROM_TZ(p.delay, '00:00')  at time zone sessiontimezone as timestamp) DELAY,  p.expiration EXPIRATION,  cast(FROM_TZ(p.enq_time, '00:00')  at time zone sessiontimezone as timestamp) ENQ_TIME,  p.enq_uid ENQ_UID,  p.enq_tid ENQ_TID,  cast(FROM_TZ(p.deq_time, '00:00')  at time zone sessiontimezone as timestamp) DEQ_TIME,  p.deq_uid DEQ_UID,  p.deq_tid DEQ_TID,  p.retry_count RETRY_COUNT,  p.exception_qschema EXCEPTION_QSCHEMA,  p.exception_queue EXCEPTION_QUEUE,  p.cscn CSCN,  p.dscn DSCN,  p.chain_no CHAIN_NO,  p.local_order_no LOCAL_ORDER_NO,  cast(FROM_TZ(p.time_manager_info, '00:00') at time zone sessiontimezone as timestamp)   TIME_MANAGER_INFO,  p.step_no STEP_NO,  p.user_data USER_DATA,  p.sender_name SENDER_NAME,  p.sender_address SENDER_ADDRESS,  p.sender_protocol SENDER_PROTOCOL,  cast (null as RAW(16)) DEQUEUE_MSGID, 'BUFFERED' DELIVERY_MODE,  b.sequence_num SEQUENCE_NUM,  b.msg_num MSG_NUM,  qo.qid QUEUE_ID,  null USER_PROP,  b.subscriber_id SUBSCRIBER_ID,  cast (null as varchar2(30)) SUBSCRIBER_NAME,  0 QUEUE_EVTID  FROM "AQ$_CB_QUEUE_TABLE_P" p,  SYS.qt756831_BUFFER b,  sys.all_int_dequeue_queues qo  WHERE bitand(b.state, 2) = 2 AND p.msgid = b.msgid AND  qo.qid = b.queue_id and p.q_name = qo.name  WITH READ ONLY;



PROMPT ===================================================================================== 
PROMPT *** End *** ========== Scripts /Sql/BARSAQ/View/AQ$_CB_QUEUE_TABLE_F.sql =========***
PROMPT ===================================================================================== 
